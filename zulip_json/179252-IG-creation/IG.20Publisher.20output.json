[
    {
        "content": "<p>Is there a flag that you use on the IG Publisher when generating an official build ready to publish?<br>\n(wanting to do it for an internal IG - so it doesn't put the CI warning box in it)</p>",
        "id": 177403408,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570261531
    },
    {
        "content": "<p>it is a two step process:</p>\n<ol>\n<li>-publish</li>\n<li>-publish-update<br>\nI documented it for our publication setup: <a href=\"https://github.com/ahdis/k8s-fhir.ch\" target=\"_blank\" title=\"https://github.com/ahdis/k8s-fhir.ch\">https://github.com/ahdis/k8s-fhir.ch</a></li>\n</ol>",
        "id": 177403796,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1570262353
    },
    {
        "content": "<p>Did you end up with any clarity on <code>TODO: not 100% sure what needs to be in -registry and -root parameter</code></p>",
        "id": 177413384,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570280484
    },
    {
        "content": "<p>I use a site variable in the _config.yml file</p>",
        "id": 177417603,
        "sender_full_name": "Eric Haas",
        "timestamp": 1570287078
    },
    {
        "content": "<p><code>build: ci  # choice of ci|ballot|version</code></p>\n<p>aomng other things this updates the title based  on the value of {{site.build}}</p>",
        "id": 177417668,
        "sender_full_name": "Eric Haas",
        "timestamp": 1570287203
    },
    {
        "content": "<p>hope to incorporate this stuff into the standard template</p>",
        "id": 177417714,
        "sender_full_name": "Eric Haas",
        "timestamp": 1570287259
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> is right - you run the publish update on whole site. It does more than just update the publish box. But there's things I haven't sorted yet for use by <a href=\"http://hl7.ch\" target=\"_blank\" title=\"http://hl7.ch\">hl7.ch</a> - what server software are you using?</p>",
        "id": 177428398,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570304605
    },
    {
        "content": "<blockquote>\n<p>Did you end up with any clarity on <code>TODO: not 100% sure what needs to be in -registry and -root parameter</code></p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> sorry no, it worked for my case with the provided parameter</p>",
        "id": 177447817,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1570343747
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191478\">Oliver Egger</span> is right - you run the publish update on whole site. It does more than just update the publish box. But there's things I haven't sorted yet for use by <a href=\"http://hl7.ch\" target=\"_blank\" title=\"http://hl7.ch\">hl7.ch</a> - what server software are you using?</p>\n</blockquote>\n<p>I use nginx in glcoud as a reverse proxy for a google drive, all config is published in this <a href=\"https://github.com/ahdis/k8s-fhir.ch\" target=\"_blank\" title=\"https://github.com/ahdis/k8s-fhir.ch\">repo</a>. The only thing I noticed, that I had to add to template a specific <a href=\"https://github.com/ahdis/ig-template/blob/master/content/history.html\" target=\"_blank\" title=\"https://github.com/ahdis/ig-template/blob/master/content/history.html\">history.html/js</a> to our ig's instead of the  history.cfml and do a rewrite for the <a href=\"https://github.com/ahdis/k8s-fhir.ch/blob/master/nginx_fhir-ch.conf\" target=\"_blank\" title=\"https://github.com/ahdis/k8s-fhir.ch/blob/master/nginx_fhir-ch.conf\">history.cfml</a>. Is there anything which would be server specific?</p>",
        "id": 177449634,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1570347333
    },
    {
        "content": "<p>the redirects are server specific. nginx will use php redirects. Does your server support PHP? </p>\n<p>As for the history page, you provide the <a href=\"http://history.xxx\" target=\"_blank\" title=\"http://history.xxx\">history.xxx</a> set up for whatever works for the server; the IGpubisher leaves that untouched (just updates package-list.json)</p>",
        "id": 177452939,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570353382
    },
    {
        "content": "<p>I have a simple folder shared on Azure websites (essentially IIS) but was going to add some code around the outside.<br>\nWhat extra stuff did you have to do with publishing?</p>",
        "id": 177453829,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570355187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> i assume you're out of town at the moment.</p>",
        "id": 177453835,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570355218
    },
    {
        "content": "<p>(planning on publishing the first snapshot this week, so will need to cross these issues off)</p>",
        "id": 177453846,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570355256
    },
    {
        "content": "<p>so the basic process goes like this:<br>\n- you have a local copy of the web site <br>\n- you do your local build with a -web flag which generates some additional stuff<br>\n- you copy the output into [ig]/XXXX where [ig] is the root for this ig, and XXXX is your version<br>\n- you edit the package-list.json file<br>\n- you point the igpublisher at the root directory (usually something that can contain several [ig] directories</p>\n<p>It does the following:</p>\n<ul>\n<li>check the package-list.json</li>\n<li>it checks that all the directories are correct </li>\n<li>updates all the publish boxes so that the text is correct, and refers to the latest copy of that page (it there is one)</li>\n<li>it generates all the appropriate redirects</li>\n<li>it creates/updates the entry for the ig in the master ig registry as well</li>\n</ul>",
        "id": 177453917,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570355401
    },
    {
        "content": "<p>I am in the air on the way to Bangkok for a HIMSS meeting. Then St Petersberg, Moscow, Miami, Houston and then home</p>",
        "id": 177453963,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570355434
    },
    {
        "content": "<p>the IG publisher is only tested to do this correctly for <a href=\"http://Hl7.org\" target=\"_blank\" title=\"http://Hl7.org\">Hl7.org</a> and <a href=\"http://fhir.org\" target=\"_blank\" title=\"http://fhir.org\">fhir.org</a>, but it's on my todo list to extend this for other circumstances as required</p>",
        "id": 177453976,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570355490
    },
    {
        "content": "<p>and one more thing it will do this week:</p>\n<ul>\n<li>adds the IG to the package feed so that the IG gets picked up by the fhir registry</li>\n</ul>",
        "id": 177454020,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570355524
    },
    {
        "content": "<p>(both the package server and the registry itself)</p>",
        "id": 177454024,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570355541
    },
    {
        "content": "<p>I wouldn't want this internal one sent to the registry...</p>",
        "id": 177482298,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570407186
    },
    {
        "content": "<p>then you don't need to commit the changes. I'll make it so that bit can be turned off</p>",
        "id": 177482400,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570407367
    },
    {
        "content": "<p>How are the redirects generated? (so I can work out if these will apply to the AzureWebSites deploy)</p>",
        "id": 177482401,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570407367
    },
    {
        "content": "<p>for IIS, I generate an ASP. For Apache, I generate a PHP. You'll have to figure out, for an AzureWebSites, if there's any way to do media type dependent redirects. I expect that there isn't though</p>",
        "id": 177482404,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570407419
    },
    {
        "content": "<p>I can probably work out what to do from the ASP.  Is that through an output flag, or does it just generate all of them?</p>",
        "id": 177482466,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570407589
    },
    {
        "content": "<blockquote>\n<p>Is that through an output flag, or does it just generate all of them?</p>\n</blockquote>\n<p>I don't know what you are asking</p>",
        "id": 177486913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570416309
    },
    {
        "content": "<p>The redirect stuff that you create, does it just output ASP and PHP and you pick what you want. Or is there a flag to choose, or is that done manually.</p>",
        "id": 177486960,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570416409
    },
    {
        "content": "<p>at the moment, it's hard coded to know what server is what software</p>",
        "id": 177486974,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570416474
    },
    {
        "content": "<p>no. you can specify using -server-type X where X is \"ASP\" or \"Apache\".</p>",
        "id": 177525815,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570459502
    },
    {
        "content": "<p>it knows some servers so you don't have to specify.</p>",
        "id": 177525828,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570459513
    },
    {
        "content": "<p>if you want other software listed, we'll have to work out how to generate the redirects for the server</p>",
        "id": 177525867,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570459538
    },
    {
        "content": "<p>Thanks, I can take a look in the code for what it does and take a swing at it once I work out what is needed in Azure websites. Probably pretty close to asp I'd guess.</p>",
        "id": 177547732,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570473859
    },
    {
        "content": "<p>I'd bet <em>not</em>. I bet you're stuck. These websites are static content only, at least all the ones I've reviewed are</p>",
        "id": 177573213,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570493629
    },
    {
        "content": "<p>and I haven't figured out how to pull of a different redirect for different values of the Accept: header without server side active content</p>",
        "id": 177573269,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570493663
    },
    {
        "content": "<p>I do have room for active content...</p>",
        "id": 177580158,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570503586
    },
    {
        "content": "<p>ok what kind? ASP?</p>",
        "id": 177581003,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570504807
    },
    {
        "content": "<p>I'll be checking what the ASP generates then make up my mind how I do it...<br>\n(I may be building some simple server code - for simple auth)</p>",
        "id": 177582424,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570507359
    },
    {
        "content": "<p>here's a typical redirect, at <a href=\"http://hl7.org/fhir/StructureDefinition/Account\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Account\">http://hl7.org/fhir/StructureDefinition/Account</a>:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;%@</span> <span class=\"n\">language</span><span class=\"o\">=</span><span class=\"s\">&quot;javascript&quot;</span><span class=\"nt\">%&gt;</span>\n\n<span class=\"nt\">&lt;%</span>\n  <span class=\"n\">var</span> <span class=\"n\">s</span> <span class=\"o\">=</span> <span class=\"kt\">String</span><span class=\"p\">(</span><span class=\"n\">Request</span><span class=\"p\">.</span><span class=\"n\">ServerVariables</span><span class=\"p\">(</span><span class=\"s\">&quot;HTTP_ACCEPT&quot;</span><span class=\"p\">))</span><span class=\"err\">;</span>\n  <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"n\">indexOf</span><span class=\"p\">(</span><span class=\"s\">&quot;json&quot;</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"n\">Response</span><span class=\"p\">.</span><span class=\"n\">Redirect</span><span class=\"p\">(</span><span class=\"s\">&quot;http://hl7.org/fhir/account.json&quot;</span><span class=\"p\">)</span><span class=\"err\">;</span>\n  <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">s</span><span class=\"p\">.</span><span class=\"n\">indexOf</span><span class=\"p\">(</span><span class=\"s\">&quot;html&quot;</span><span class=\"p\">)</span> <span class=\"o\">&gt;</span> <span class=\"o\">-</span><span class=\"mi\">1</span><span class=\"p\">)</span>\n    <span class=\"n\">Response</span><span class=\"p\">.</span><span class=\"n\">Redirect</span><span class=\"p\">(</span><span class=\"s\">&quot;http://hl7.org/fhir/account.html&quot;</span><span class=\"p\">)</span><span class=\"err\">;</span>\n  <span class=\"k\">else</span>\n    <span class=\"n\">Response</span><span class=\"p\">.</span><span class=\"n\">Redirect</span><span class=\"p\">(</span><span class=\"s\">&quot;http://hl7.org/fhir/account.xml&quot;</span><span class=\"p\">)</span><span class=\"err\">;</span>\n\n<span class=\"nt\">%&gt;</span>\n\n<span class=\"cp\">&lt;!DOCTYPE html&gt;</span>\n<span class=\"nt\">&lt;html&gt;</span>\n<span class=\"nt\">&lt;body&gt;</span>\nYou should not be seeing this page. If you do, ASP has failed badly.\n<span class=\"nt\">&lt;/body&gt;</span>\n<span class=\"nt\">&lt;/html&gt;</span>\n</pre></div>",
        "id": 177582731,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570507895
    },
    {
        "content": "<p>Is it really just the URL free addresses and versioning URLS and content type negotiations?</p>",
        "id": 177582877,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570508111
    },
    {
        "content": "<p>that's all the redirects are.</p>",
        "id": 177588085,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570516868
    },
    {
        "content": "<p>Cool, no need to generate anything then.<br>\nI should be able to create some .net middleware to do it.</p>",
        "id": 177593241,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570523391
    },
    {
        "content": "<p>ok. and I changed around the way you invoke it. Now, you need a file publish.ini in the root of your web site. It has the following format:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">[website]</span>\n<span class=\"na\">style</span><span class=\"o\">=</span><span class=\"s\">fhir.layout</span>\n<span class=\"na\">url</span><span class=\"o\">=</span><span class=\"s\">{public url for this folder}</span>\n<span class=\"na\">no-registry</span><span class=\"o\">=</span><span class=\"s\">1  ; only if the IGs in this directory are not registered in the public IG registry</span>\n<span class=\"na\">server</span><span class=\"o\">=</span><span class=\"s\">{asp | apache}</span>\n\n<span class=\"c1\">; both entries are optional, and are the names of files to produce as RSS feeds in the folder</span>\n<span class=\"c1\">; for people who want to subscribe to any new versions. The FHIR IG registry uses the package</span>\n<span class=\"c1\">; file if it&#39;s registered in the IG feed directory</span>\n<span class=\"k\">[feeds]</span>\n<span class=\"na\">package</span><span class=\"o\">=</span><span class=\"s\">{filename}</span>\n<span class=\"na\">publication</span><span class=\"o\">=</span><span class=\"s\">{filename}</span>\n</pre></div>",
        "id": 177602891,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570532737
    },
    {
        "content": "<p>and you invoke it with only 2 parameters -publish-update {folder} -registry {path | n/a}</p>",
        "id": 177602948,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570532772
    },
    {
        "content": "<p>Is that url the one at the root, or the one inside the version/dev folder?<br>\nroot/dev<br>\nroot/0.1.0<br>\nroot/0.2.0</p>",
        "id": 177683938,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570598930
    },
    {
        "content": "<p>(and I should imagine this hasn't been pushed yet too)<br>\nthe  {root}/{realm}/{code} was getting me, as the paths we use in our registry won't be 3 deep.</p>",
        "id": 177684055,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570599097
    },
    {
        "content": "<p>We are planning to use {root}/th-ncsr/dev/index.html<br>\n(and then replace dev with the versions of each of the published ones)</p>",
        "id": 177684115,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570599137
    },
    {
        "content": "<p>root</p>",
        "id": 177695605,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570612476
    },
    {
        "content": "<p>I think you should use current rather than dev. It might not matter, but current and dev are two special package versions - current, the current build. dev, the build you have on your local drive (not yet committed)</p>",
        "id": 177695675,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570612534
    },
    {
        "content": "<p>you don't need {realm}, or even {code} but the infrastructure expects you to have {code} for a reason</p>",
        "id": 177695750,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570612582
    },
    {
        "content": "<p>registry with a path of <code>n/a</code> kinda breaks heaps. Have done some debugging, and some obvious stuff in there which I tried fixing and it gets a lot further, but then there is no IGRegistryMaintainer reg object, so nothing appears to be able to process.<br>\nOr am I missing something here, Is this maintaining an external registry outside the folders its processing (i.e. updating the fhir registry or something in <a href=\"http://build.org\" target=\"_blank\" title=\"http://build.org\">build.org</a> etc)</p>",
        "id": 177775967,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570677882
    },
    {
        "content": "<p>I haven't finished all this yet</p>",
        "id": 177777743,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570680902
    },
    {
        "content": "<p>I guesses as much ;)</p>",
        "id": 177779048,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1570682874
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> re the use of RSS for feeds, did you consider ATOM as an alternative, and did you consider adding additional metadata to the feed to allow for entries that contain things other than packages or with a different MIME type/format (e.g., future proofing)?  Even knowing (machine readably) what FHIR version the package contents consist of would be useful for automation.</p>",
        "id": 178060789,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1571011047
    },
    {
        "content": "<p>no because we were working with the RSS format as already used in the NPM community. I expect we can add things to that as long as don't change anything it already has</p>",
        "id": 178083065,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571041513
    },
    {
        "content": "<p>but you can get all that from the package, so it's more convenience than anything else</p>",
        "id": 178083094,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571041535
    },
    {
        "content": "<p>Yes, if you go and get the package, but not great if you want your UI to only display STU3 packages, for example, or other manifest-based filtering.<br>\nBut I see this is RSS 2.0 so the spec allows for extension elements as long as they are namespaced</p>",
        "id": 178169652,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1571126511
    },
    {
        "content": "<p>npm seems a little more structured in that the <code>&lt;title&gt;</code> elements are essentially the logical identity (I'm reverse engineering this; documentation seems very hard to find)</p>",
        "id": 178171047,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1571127752
    },
    {
        "content": "<p>hmm. you're right. I'll fix that and extend while I'm at it.</p>",
        "id": 178175088,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571131562
    },
    {
        "content": "<p>I am adding the namespace fhir as <code>http://hl7.org/fhir/feed\\</code>, with the following elements:</p>\n<ul>\n<li><code>fhir:version</code>: the version of FHIR the package is for (may repeat in the future)</li>\n<li><code>fhir:kind</code>: the kind of package</li>\n</ul>\n<p>Kind of package:</p>\n<ul>\n<li><code>fhir.core</code>: a core specification</li>\n<li><code>fhir.ig</code>:  a IG</li>\n<li><code>fhir.tool</code>: release of a tool (e.g. validator) - none at the moment</li>\n<li><code>fhir.template</code>: an IG template</li>\n<li><code>fhir.subset</code>: a subset of an IG for some purpose</li>\n</ul>",
        "id": 178175649,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571132101
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Publisher.20output/near/177453917\">said</a>:</p>\n<blockquote>\n<p>so the basic process goes like this:</p>\n<ul>\n<li>you have a local copy of the web site </li>\n<li>you do your local build with a -web flag which generates some additional stuff</li>\n</ul>\n</blockquote>\n<p>Should I be running <code>-web</code> before/after/same time as the <code>-publish</code> or <code>-publish-update</code> option? </p>\n<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/IG.20Publisher.20output/near/177453917\">said</a>:</p>\n<blockquote>\n<ul>\n<li>it generates all the appropriate redirects</li>\n</ul>\n</blockquote>\n<p>Is this done with the <code>-web</code> option? or with the <code>-publish</code>, <code>-publish-output</code> parameters? Should I be seeing php code generated in my local site?</p>",
        "id": 200430171,
        "sender_full_name": " Bob Milius",
        "timestamp": 1591802212
    },
    {
        "content": "<p>so there's a 2 step process - you generate your IG in whatever directory you cloned the git repo into</p>",
        "id": 200792820,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592095128
    },
    {
        "content": "<p>that's when you use -web</p>",
        "id": 200792822,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592095133
    },
    {
        "content": "<p>for your final build. it does a few little background things a little different but the output is almost completely the same</p>",
        "id": 200793806,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592097023
    }
]