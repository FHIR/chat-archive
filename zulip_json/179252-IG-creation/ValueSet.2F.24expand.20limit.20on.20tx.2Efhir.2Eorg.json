[
    {
        "content": "<p>Does anyone know why <code>tx.fhir.org</code> only returns 200 items when trying to find the LOINC codes with <code>LP31412-7</code> as an ancestor? There are 214 codes that are descendants per the flatfiles on <a href=\"http://loinc.org\">loinc.org</a>.</p>\n<p>Here's the request in question -- note that <code>_limit</code> has no effect on the number of items in the response as far as I can tell:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>curl -X <span class=\"s2\">\"POST\"</span> <span class=\"s2\">\"http://tx.fhir.org/r4/ValueSet/</span><span class=\"nv\">$expand</span><span class=\"s2\">\"</span> <span class=\"se\">\\</span>\n     -H <span class=\"s1\">'Accept: application/json'</span> <span class=\"se\">\\</span>\n     -H <span class=\"s1\">'Content-Type: application/fhir+xml;charset=UTF-8'</span> <span class=\"se\">\\</span>\n     -H <span class=\"s1\">'Accept-Charset: UTF-8'</span> <span class=\"se\">\\</span>\n     -H <span class=\"s1\">'Accept-Encoding: gzip'</span> <span class=\"se\">\\</span>\n     -H <span class=\"s1\">'User-Agent: hapi-fhir-tooling-client'</span> <span class=\"se\">\\</span>\n -d <span class=\"s2\">\"&lt;?xml version=\\\"1.0\\\" encoding=\\\"UTF-8\\\"?&gt;&lt;Parameters xmlns=\\\"http://hl7.org/fhir\\\"&gt;&lt;id value=\\\"exp-params\\\"/&gt;&lt;parameter&gt;&lt;name value=\\\"system-version\\\"/&gt;&lt;valueUri value=\\\"http://snomed.info/sct|http://snomed.info/sct/731000124108\\\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\\\"includeDefinition\\\"/&gt;&lt;valueBoolean value=\\\"false\\\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\\\"excludeNested\\\"/&gt;&lt;valueBoolean value=\\\"false\\\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\\\"valueSet\\\"/&gt;&lt;resource&gt;&lt;ValueSet&gt;&lt;status value=\\\"active\\\"/&gt;&lt;compose&gt;&lt;include&gt;&lt;system value=\\\"http://loinc.org\\\"/&gt;&lt;filter&gt;&lt;property value=\\\"ancestor\\\"/&gt;&lt;op value=\\\"=\\\"/&gt;&lt;value value=\\\"LP31412-7\\\"/&gt;&lt;/filter&gt;&lt;/include&gt;&lt;/compose&gt;&lt;/ValueSet&gt;&lt;/resource&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\\\"_limit\\\"/&gt;&lt;valueString value=\\\"1000\\\"/&gt;&lt;/parameter&gt;&lt;parameter&gt;&lt;name value=\\\"_incomplete\\\"/&gt;&lt;valueString value=\\\"true\\\"/&gt;&lt;/parameter&gt;&lt;/Parameters&gt;\"</span>\n</code></pre></div>\n<p>(cc <span class=\"user-mention\" data-user-id=\"191447\">@Mark Kramer</span>)</p>",
        "id": 219877303,
        "sender_full_name": "Max Masnick",
        "timestamp": 1607968316
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span></p>",
        "id": 219878724,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607968924
    },
    {
        "content": "<p>theres' no built in limit to the server. The server thinks that there's 200 codes in that value set expansion, and returns them to you</p>",
        "id": 219899943,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607978970
    },
    {
        "content": "<p>So that does raise a further question - if the server actually isn't returning the full set of concepts that it should in the expansion.</p>",
        "id": 219900249,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1607979160
    },
    {
        "content": "<p>if you think that the expansion is actually wrong, what's missing?</p>",
        "id": 219900769,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607979404
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span>?</p>",
        "id": 219900840,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1607979449
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Ah, sorry to jump to conclusions. There are 14 codes that  appear in the LOINC hierarchy that don't appear in the <a href=\"http://tx.fhir.org\">tx.fhir.org</a> expansion. Here they are: <a href=\"/user_uploads/10155/OIf92W0qZIvbHR7UYyAjZmtI/missing_loinc.txt\">missing_loinc.txt</a> </p>\n<p>I'm not going to claim that these 14 codes should <em>for sure</em> appear in the <a href=\"http://tx.fhir.org\">tx.fhir.org</a> expansion -- there very well may be a good reason they shouldn't. But here they are in case it is indicative of an actual problem. Thanks!</p>",
        "id": 219913346,
        "sender_full_name": "Max Masnick",
        "timestamp": 1607985974
    },
    {
        "content": "<p>Is this a difference between loinc versions?</p>",
        "id": 219914773,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607986828
    },
    {
        "content": "<p>The LOINC versions should be the same.  The <a href=\"http://tx.fhir.org\">tx.fhir.org</a> server is on 2.68, which is the latest.  When I post the query to <a href=\"http://tx.fhir.org\">tx.fhir.org</a> it returns the parameter \"limitedExpansion\", so it's obviously not returning everything.  If I post the query to <a href=\"https://fhir.loinc.org\">https://fhir.loinc.org</a> it tells me that 'total' = 500.  The value set definition of the ancestors of LP31412-7 is being interpreted differently by the two servers (looking for ancestors is somewhat unusual, as typically we're looking for descendants - but in this case it may make sense to do that to get what you're wanting in LOINC).  The <a href=\"http://fhir.loinc.org\">fhir.loinc.org</a> server is returning some codes from the Multi-axial hierarchy like:</p>\n<div class=\"codehilite\"><pre><span></span><code>      &lt;contains&gt;\n         &lt;system value=&quot;http://loinc.org&quot;/&gt;\n         &lt;code value=&quot;LP381385-6&quot;/&gt;\n         &lt;display value=&quot;Choriogonadotropin.alpha subunit free | Serum or Plasma | Chemistry - non-challenge&quot;/&gt;\n      &lt;/contains&gt;\n</code></pre></div>\n<p>That's perfectly legitimate, but <a href=\"http://tx.fhir.org\">tx.fhir.org</a> apparently isn't doing that (which is also legitimate).  So I think there are apples to oranges comparisons going on here.  And it probably doesn't affect the results, but I also note that the 'system-version' expansion parameter value is for a SNOMED CT version, while we're expanding a value set defined on the LOINC (I assume that system-version is being ignored, but it's hard to be certain).</p>",
        "id": 219935146,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1608004377
    },
    {
        "content": "<p>yes it's ignored</p>",
        "id": 219940644,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608011818
    },
    {
        "content": "<p>limitedExpansion is only saying that a limited expansion would be ok, but we don't actually have a limited expansion in this context</p>",
        "id": 219940700,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608011899
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> ancestor is correct when you are looking for descendants. It is saying, get me all codes whose ancestor is LP31412-7:<br>\n<code>* include codes from system LNC where ancestor = \"LP101591-8\"</code></p>",
        "id": 219974034,
        "sender_full_name": "Mark Kramer",
        "timestamp": 1608037018
    },
    {
        "content": "<p>Re: <code>&lt;name value=\\\"system-version\\\"/&gt;&lt;valueUri value=\\\"http://snomed.info/sct|http://snomed.info/sct/731000124108\\\"/&gt;</code>, this comes from the IG publisher -- this is exactly the same request the publisher makes to expand the value set, but in <code>curl</code> format.</p>",
        "id": 219986597,
        "sender_full_name": "Max Masnick",
        "timestamp": 1608042710
    },
    {
        "content": "<p>The <a href=\"http://fhir.loinc.org\">fhir.loinc.org</a> expansion returns 280 LOINC (and some additional LOINC Part codes), which is 64 <strong>additional</strong> codes than I found when looking at <code>MultiAxialHierarchy.csv</code>. I'm not sure where these additional codes are coming from yet....maybe some of the LP codes are being used recursively to find additional codes that don't show up if you only search the hierarchy for <code>LP31412-7</code>?</p>",
        "id": 219990712,
        "sender_full_name": "Max Masnick",
        "timestamp": 1608044519
    },
    {
        "content": "<p>So we have:</p>\n<ul>\n<li><code>tx.fhir.org</code>: 200 codes (and no LP codes)</li>\n<li><code>MultiAxialHierarchy.csv</code>: 14 additional LOINC (so 214 total), and some additional LP codes</li>\n<li><code>fhir.loinc.org</code>:  64 additional LOINC (so 280 total),  and some additional LP codes</li>\n</ul>\n<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> I don't think we care about the LP codes for the purposes of expanding the value set for the IG. But we still have different counts of the non-LP codes depending on the source, which I believe should be apples-to-apples.</p>",
        "id": 219991277,
        "sender_full_name": "Max Masnick",
        "timestamp": 1608044740
    },
    {
        "content": "<p>Right, to all of the above points.  I was forgetting the details on limitedExpansion.  And I think I might not have ever actually tried to use the LOINC 'ancestor' property before.  Thinking about it more, it's somewhat similar to using a filter op of 'descendent-of', but states it from the opposite end of the relationships (could be a little confusing).  So we're still getting different behavior from the servers in regard to the Multi-axial hierarchy.</p>",
        "id": 219993716,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1608045807
    },
    {
        "content": "<p>I confirm that this is an indexing bug in <a href=\"http://tx.fhir.org\">tx.fhir.org</a></p>",
        "id": 220050031,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608070241
    },
    {
        "content": "<p>ok is fixed now.</p>",
        "id": 220322915,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1608251427
    }
]