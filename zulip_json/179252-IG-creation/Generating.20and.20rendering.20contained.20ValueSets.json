[
    {
        "content": "<p>Does anyone have an IG that has a contained ValueSet? </p>\n<p>The valueset xml.html, json.html, and  ttl.html links are not being generated, and I'm getting QA errors about it.</p>",
        "id": 218789585,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607051514
    },
    {
        "content": "<p>There are a couple of examples in the SDC IG</p>",
        "id": 218789653,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607051565
    },
    {
        "content": "<p>For IG publisher, I assume that they aren't in a separate json from the enclosing resource, correct?</p>",
        "id": 218789686,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607051639
    },
    {
        "content": "<p>Contained resources couldn't be</p>",
        "id": 218790166,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607052187
    },
    {
        "content": "<p>Right. So IG publisher should be extracting the contained resources from the enclosing, and generating narrative, xml, json, and ttl forms. For some reason it's only generating the narrative html.</p>",
        "id": 218790304,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607052334
    },
    {
        "content": "<p>no it should only generate the html</p>",
        "id": 218790312,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607052350
    },
    {
        "content": "<p>It's actually broken in SDC too: <a href=\"http://build.fhir.org/ig/HL7/sdc/ValueSet-questionnaire-sdc-profile-example-PHQ9_VSPHQ9.html\">http://build.fhir.org/ig/HL7/sdc/ValueSet-questionnaire-sdc-profile-example-PHQ9_VSPHQ9.html</a>. I wonder if there were QA error for that too.</p>\n<p>I'm guessing the issue is that the template doesn't know not to generate the other forms for contained resources.</p>",
        "id": 218790558,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607052666
    },
    {
        "content": "<p>right. The source is contained, so it would be wrong to generate that. The template should referencer the contained content in the owning resource.</p>",
        "id": 218790580,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607052715
    },
    {
        "content": "<p>Is this an issue with the template or the publisher?</p>",
        "id": 218860553,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607101261
    },
    {
        "content": "<p>No.  There'd be no expectation that the contained references would generate as separate files.  They're 'contained'.  That means they live only in the containing resource.</p>",
        "id": 218880951,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607110445
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> , if you look at <a href=\"https://build.fhir.org/ig/HL7/sdc/Questionnaire-questionnaire-sdc-profile-example-PHQ9.html\">https://build.fhir.org/ig/HL7/sdc/Questionnaire-questionnaire-sdc-profile-example-PHQ9.html</a>, you'll see that all the answers are from the VSPHQ9 value set (with a funny closing bracket on the url). Looking at <a href=\"https://build.fhir.org/ig/HL7/sdc/Questionnaire-questionnaire-sdc-profile-example-PHQ9.json.html\">https://build.fhir.org/ig/HL7/sdc/Questionnaire-questionnaire-sdc-profile-example-PHQ9.json.html</a>, I can see that this value set is contained in the questionnaire.</p>\n<p>Clicking on the VSPHQ9 link in the questionnaire narrative, it takes me to a page for the value set. This page has tabs for narrative, xml, json, and ttl, but only the narrative page exists. This it does generate a separate file for at least the narrative page. Clicking on any of the other formats leads to a 404 error.</p>\n<p>(It might be nice to visually differentiate contained resources from non-contained ones, both where they are linked to from the containing resource narrative, and on the contained resource page.)</p>",
        "id": 218885005,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607112544
    },
    {
        "content": "<p>As far as I can tell, the templates have no awareness of contained resources. Is this a capability they're missing, or something that should be handled upstream in the publisher?</p>",
        "id": 219170991,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607402565
    },
    {
        "content": "<p>What sort of awareness should they have?</p>",
        "id": 219171281,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607402961
    },
    {
        "content": "<p>Contained resources shouldn't have XML or JSON representations, they should link back to the containing resource's XML or JSON.</p>",
        "id": 219171334,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607403022
    },
    {
        "content": "<p>not to generate links for their base source</p>",
        "id": 219171338,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607403031
    },
    {
        "content": "<p>I've now spent more time looking at templates, temp/pages,  and the IG publisher than is safe. I don't think Jekyll has the information needed to omit the XML/JSON tabs for contained resources, or to link to the containing resources' pages. By the time the template processing is happening, contained resources are indistinguishable (to me at least) from standalone. My suspicion is that the publisher needs to generate a data file for contained resources, which includes the containing resource. Once that is in place, the template can be updated to make use of that new information.</p>\n<p>Or I could be totally wrong, and in way over my head. I'm not going to put money on which is more likely.</p>",
        "id": 219175713,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607409203
    },
    {
        "content": "<p>there is a data file just like that</p>",
        "id": 219176570,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607410376
    },
    {
        "content": "<p>for that reason</p>",
        "id": 219176572,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607410382
    },
    {
        "content": "<p>Which one? I couldnâ€™t find it.</p>",
        "id": 219176916,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607410869
    },
    {
        "content": "<p>Should we add to the resources.json the contained resources (or  anywhere else)?<br>\nwe could do:</p>\n<ol>\n<li>Just add the contained resources to the resources.json, addding a <code>{{\"contained\":\"true\",{\"containedIn\"=\"Questionnaire/myQuestionnaire\"}}</code></li>\n<li>Add a <code>{\"containedResources\":[\"ValueSet/Valueset1\"]}</code> to the containing resources</li>\n<li>A separate json file?</li>\n</ol>",
        "id": 219229109,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607445322
    },
    {
        "content": "<p>I'm not sure that \"contained\" is needed, the presence of the \"containing\" is sufficient. (And I'd change \"containing\" to \"containedIn\" for clarity.) I hadn't thought about \"containedResources\" but that would help with decorating the link to the contained resource, or adding a list of contained resources to the containing resource. <br>\nI envisioned a separate json file, since that has lower risk of breaking things that use resources.json.</p>",
        "id": 219232232,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607446862
    },
    {
        "content": "<p>(updated option 1 to \"containedIn\").</p>",
        "id": 219233998,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607447643
    },
    {
        "content": "<p>I'd think it's safer for the template to look at one single file, otherwise the liquid becomes more complicated, I guess..</p>",
        "id": 219234184,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607447718
    },
    {
        "content": "<p>Fair enough, and as far as I can tell, it's only the history attribute that is being used in the resources.json. There are plenty of other things in there, but none are used by the templates.</p>",
        "id": 219235754,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607448398
    },
    {
        "content": "<p>...yet</p>",
        "id": 219258544,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607459505
    },
    {
        "content": "<p>Correct. The resources JSON is not used for much but should be used to add cool stuff as we go, like \"testing\"</p>",
        "id": 219258677,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607459569
    },
    {
        "content": "<p>Or maybe 'this resource was inherited as a dependency, it is not defined here'</p>",
        "id": 219259022,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607459720
    },
    {
        "content": "<p>hmm so apparently I had not not put this in resources.json. Looks like contained resources are just listed there at all...</p>",
        "id": 219259372,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607459894
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Generating.20and.20rendering.20contained.20ValueSets/near/219259372\">said</a>:</p>\n<blockquote>\n<p>Looks like contained resources are just listed there at all...</p>\n</blockquote>\n<p>Are <em>not</em> listed there?</p>",
        "id": 219259457,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607459947
    },
    {
        "content": "<p>err, that's what I meant</p>",
        "id": 219259475,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607459957
    },
    {
        "content": "<p>I've got template changes that will skip the nav tabs for contained resources, if you can include them in resources.json. Ideally with the containing resource as Jose and I were theorizing above.</p>",
        "id": 219259779,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607460119
    },
    {
        "content": "<p>What should the resources JSON look like?</p>",
        "id": 219259872,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1607460150
    },
    {
        "content": "<ul>\n<li>Contained resource should be included in <code>resources.json</code> along with the other resources, with all the regular attributes.  (The only odd thing for contained resources will be the \"source\" attribute, which will be the containing resource.)</li>\n<li>Contained resources also have a \"containedIn\" attribute with the id of the containing resource.</li>\n<li>Containing resources should have a \"contains\" attribute which is an array of contained resource ids.</li>\n<li>add a \"path\" attribute for contained or containing resources which is the relative url of the base page for the resource.</li>\n</ul>\n<p>(edited to reflect what I ended up needing.)</p>",
        "id": 219260321,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607460388
    },
    {
        "content": "<p>Here is a contained and a containing sample resource.</p>",
        "id": 219260425,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607460455
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>&quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireReasonForTesting&quot;: {\n    &quot;containedIn&quot;: &quot;Questionnaire/WhoCrQuestionnaireCovid19Surveillance&quot;,\n    &quot;path&quot; : &quot;ValueSet-WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireReasonForTesting.html&quot;,\n    &quot;history&quot;: false,\n    &quot;index&quot;: 99,\n    &quot;source&quot;: &quot;/Users/elliot/src/covid-ig/fsh-generated/resources/questionnaire-WhoCrQuestionnaireCovid19Surveillance.json&quot;,\n    &quot;url&quot;: &quot;http://openhie.github.io/covid-19/Questionnaire/WhoCrQuestionnaireCovid19Surveillance#WhoCrValueSetQuestionnaireReasonForTesting&quot;,\n    &quot;name&quot;: &quot;WhoCrValueSetQuestionnaireReasonForTesting&quot;,\n    &quot;title&quot;: &quot;WhoCrValueSetQuestionnaireReasonForTesting&quot;,\n    &quot;version&quot;: &quot;0.1.0&quot;,\n    &quot;date&quot;: &quot;2020-12-07T19:50:36-08:00&quot;,\n    &quot;status&quot;: {\n      &quot;class&quot;: &quot;colstu&quot;,\n      &quot;owner&quot;: &quot;OpenHIE&quot;,\n      &quot;link&quot;: &quot;http://www.ohie.org&quot;,\n      &quot;status&quot;: &quot;Active&quot;\n    }\n},\n&quot;Questionnaire/WhoCrQuestionnaireCovid19Surveillance&quot;: {\n    &quot;contains&quot;: [\n      &quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireCountry&quot;,\n      &quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireReasonForTesting&quot;,\n      &quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireComorbidity&quot;,\n      &quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnairePatientOutcome&quot;,\n      &quot;ValueSet/WhoCrQuestionnaireCovid19Surveillance_WhoCrValueSetQuestionnaireAdmin1&quot;\n      ],\n    &quot;path&quot; : &quot;Questionnaire-WhoCrQuestionnaireCovid19Surveillance.html&quot;,\n    &quot;history&quot;: false,\n    &quot;index&quot;: 80,\n    &quot;source&quot;: &quot;/Users/elliot/src/covid-ig/fsh-generated/resources/questionnaire-WhoCrQuestionnaireCovid19Surveillance.json&quot;,\n    &quot;url&quot;: &quot;http://openhie.github.io/covid-19/Questionnaire/WhoCrQuestionnaireCovid19Surveillance&quot;,\n    &quot;name&quot;: &quot;WhoCrQuestionnaireCovid19Surveillance&quot;,\n    &quot;version&quot;: &quot;0.1.0&quot;,\n    &quot;date&quot;: &quot;2020-12-08T22:22:09-08:00&quot;,\n    &quot;status&quot;: {\n      &quot;class&quot;: &quot;colsd&quot;,\n      &quot;owner&quot;: &quot;OpenHIE&quot;,\n      &quot;link&quot;: &quot;http://www.ohie.org&quot;,\n      &quot;status&quot;: &quot;Draft&quot;\n    }\n}\n</code></pre></div>\n<p>(edited to reflect \"as built\")</p>",
        "id": 219260448,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607460467
    },
    {
        "content": "<p>By the way, I've found some other issues with contained resources:</p>\n<ul>\n<li>Section numbering is broken. The sections are \".1\", \".1.2\", etc. instead of a proper numbering. I don't know how sections should be numbered for contained resources (sequential after all the standalone resources? alphabetical within the containing resource?), but this looks wrong.</li>\n<li>There are no breadcrumb links</li>\n<li>The text element is not rendered</li>\n<li>The contained resource is not processed correctly by jekyll. I've got <code>\"copyright\": \"{{{year}}}\"</code> which doesn't get converted to <code>\"copyright\": \"2020\"</code> in either the XML/JSON representation of the containing resource, or the separate narrative rendering of the contained resource. However, the same line in the containing resource does get converted correctly.</li>\n</ul>",
        "id": 219261144,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607460838
    },
    {
        "content": "<p>I'll look at this next week after final content deadline for HL7 ballot is due</p>",
        "id": 219261736,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607461147
    },
    {
        "content": "<p>Thank you.</p>",
        "id": 219261809,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607461192
    },
    {
        "content": "<p>For the list:</p>\n<ul>\n<li>\"References\" for contained resources are incorrect. I suspect the references should list the (a) containing resource, as well as (b) any resource contained by (a) which references this contained resource.</li>\n</ul>",
        "id": 219279605,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607470881
    },
    {
        "content": "<p>OK, I've got something working to link between the contained and containing resources, and have updated my comments above for what it actually needs. I'll create a pull request for ig-template-base once the contents of resource.json are confirmed.</p>",
        "id": 219302288,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1607495983
    },
    {
        "content": "<p>Along the lines of my previous \"References\" issue, I've just noticed that in my IG that a regular (i.e., not contained) CodeSystem which is only used by ValueSets which are contained in a Questionnaire displays:</p>\n<blockquote>\n<p>This Code system is referenced in the content logical definition of the following value sets:</p>\n<p>This CodeSystem is not used here; it may be used elsewhere (e.g. specifications and/or implementations that use this content)</p>\n</blockquote>\n<p>It definitely is used, but I don't know if it should be pointing to the containing or contained resource.</p>",
        "id": 224427221,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1611891174
    },
    {
        "content": "<p>Capture a Git issue against the publisher</p>",
        "id": 224430790,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1611895910
    }
]