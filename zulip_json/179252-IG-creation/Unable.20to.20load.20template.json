[
    {
        "content": "<p>If I were to copy \"ig-template-base\" contents and dump it into a directory in my IG called \"custom-template\", and then have my ig.ini file say <code>template = custom-template</code> why would I get the following error?<br>\n<code>Error loading template custom-template: Unable to load template from custom-template</code></p>",
        "id": 199646119,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591203398
    },
    {
        "content": "<p>It would have to be #custom-template</p>",
        "id": 199647470,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591204021
    },
    {
        "content": "<p>If you're planning to do that for playing around, that's fine, but don't plant to publish an HL7 IG doing that...</p>",
        "id": 199647512,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591204048
    },
    {
        "content": "<p>nope, don't plan to</p>",
        "id": 199655982,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208008
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> , I did that... now I get this:<br>\n<code>Error loading template #custom-template: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path</code></p>",
        "id": 199656556,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208294
    },
    {
        "content": "<p>Did you make any changes to the template?  Can you provide more of a stack trace?</p>",
        "id": 199657383,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591208705
    },
    {
        "content": "<p>sure</p>",
        "id": 199657615,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208821
    },
    {
        "content": "<p>no changes to template</p>",
        "id": 199657624,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208824
    },
    {
        "content": "<p>here is stack trace:</p>",
        "id": 199657627,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208827
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Load Template from custom-template                                               (00:01.0425)\nPublishing Content Failed: Error loading template custom-template: Unable to load template from custom-template (00:01.0426)\n(00:01.0426)\nUse -? to get command line help                                                  (00:01.0426)\n(00:01.0426)\nStack Dump (for debugging):                                                      (00:01.0426)\norg.hl7.fhir.exceptions.FHIRException: Error loading template custom-template: Unable to load template from custom-template\nat org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:265)\n    at org.hl7.fhir.igtools.templates.TemplateManager.installTemplate(TemplateManager.java:93)\n    at org.hl7.fhir.igtools.templates.TemplateManager.loadTemplate(TemplateManager.java:79)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1479)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1322)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:690)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7430)\nCaused by: org.hl7.fhir.exceptions.FHIRException: Unable to load template from custom-template\nat org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:263)\n    ... 6 more\nIG Publisher finished with code 1\n</code></pre></div>",
        "id": 199657655,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208842
    },
    {
        "content": "<p><code>FHIR IG Publisher Version 1.0.99-SNAPSHOT (Git# 1a0cb452d00e). Built 2020-06-01T17:41:49.314+10:00 (39 hours old)</code></p>",
        "id": 199657690,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591208861
    },
    {
        "content": "<p>I just tried doing this locally with sample-ig and it worked fine.  You grabbed the content from the Git project, not from the template package, correct?</p>",
        "id": 199659520,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591209741
    },
    {
        "content": "<p>correct</p>",
        "id": 199662355,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591211253
    },
    {
        "content": "<p>from <a href=\"https://github.com/hl7/ig-template-base/archive/master.zip\">https://github.com/hl7/ig-template-base/archive/master.zip</a></p>",
        "id": 199662374,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591211265
    },
    {
        "content": "<p>extracted the sub-folder into custom-template directory</p>",
        "id": 199662385,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591211275
    },
    {
        "content": "<p>that may have to do with the way folders are structured</p>",
        "id": 199666275,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1591213071
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191505\">@Sean McIlvenna</span> what do you have in the custom-templaet directory?</p>",
        "id": 199667249,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1591213469
    },
    {
        "content": "<p>that is not the correct stack trace. It's the stack trace for template = custom-template, not template=#custom-template</p>",
        "id": 199668499,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591214037
    },
    {
        "content": "<p>crap yah</p>",
        "id": 199669099,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591214337
    },
    {
        "content": "<p>my bad</p>",
        "id": 199669102,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591214338
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> here it comes</p>",
        "id": 199669107,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591214342
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Running latest IG Publisher: -jar E:\\Code\\trifolia-on-fhir\\apps\\server\\src\\assets\\ig-publisher\\1.0.99-SNAPSHOT.jar -ig C:\\Users\\sean.mcilvenna\\AppData\\Local\\Temp\\tmp-28580nzZfmSXw42bm\\ig.ini -tx N/A\nFHIR IG Publisher Version 1.0.99-SNAPSHOT (Git# 1a0cb452d00e). Built 2020-06-01T17:41:49.314+10:00 (58 hours old)\nDetected Java version: 13.0.2 from C:\\Program Files\\Java\\jdk-13.0.2 on amd64 (64bit). 12228MB available\nParameters: -ig XXX\\tmp-28580nzZfmSXw42bm\\ig.ini -tx N/A\ndir = E:\\Code\\trifolia-on-fhir\\dist\\apps\\server, path = C:\\Program Files (x86)\\Microsoft SDKs\\Azure\\CLI2\\wbin;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Windows\\System32\\OpenSSH\\;C:\\Program Files\\Microsoft SQL Server\\130\\Tools\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\Client SDK\\ODBC\\170\\Tools\\Binn\\;C:\\cmder;c:\\apache-maven-3.6.2\\bin;C:\\Program Files\\Java\\jdk-13.0.2\\bin;C:\\Program Files\\PuTTY\\;C:\\Program Files (x86)\\Microsoft SQL Server\\110\\Tools\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\110\\Tools\\Binn\\;C:\\Program Files\\Microsoft SQL Server\\110\\DTS\\Binn\\;C:\\Program Files (x86)\\Microsoft SQL Server\\110\\Tools\\Binn\\ManagementStudio\\;C:\\Program Files (x86)\\Microsoft SQL Server\\110\\DTS\\Binn\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\nodejs\\;C:\\Program Files\\dotnet\\;C:\\WINDOWS\\system32;C:\\WINDOWS;C:\\WINDOWS\\System32\\Wbem;C:\\WINDOWS\\System32\\WindowsPowerShell\\v1.0\\;C:\\WINDOWS\\System32\\OpenSSH\\;C:\\PROGRA~1\\IBM\\SQLLIB\\BIN;C:\\PROGRA~1\\IBM\\SQLLIB\\FUNCTION;C:\\Program Files (x86)\\NVIDIA Corporation\\PhysX\\Common;C:\\Program Files\\Docker\\Docker\\resources\\bin;C:\\ProgramData\\DockerDesktop\\version-bin;C:\\Ruby25-x64\\bin;C:\\Ruby26-x64\\bin;XXX\\AppData\\Local\\Microsoft\\WindowsApps;;C:\\Program Files\\JetBrains\\WebStorm 2019.2.4\\bin;;C:\\Program Files\\JetBrains\\IntelliJ IDEA 2019.2.4\\bin;;C:\\Users\\sean.mcilvenna\\AppData\\Roaming\\npm;C:\\Program Files\\JetBrains\\RubyMine 2019.3.3\\bin;\nRun time = Wednesday, June 3, 2020 at 11:16:34 AM Pacific Daylight Time (2020-06-03T11:16:34-07:00)\nPackage Cache: XXX\\.fhir\\packages                            (00:00.0007)\nLoad Template from #custom-template                                              (00:00.0525)\nPublishing Content Failed: Error loading template #custom-template: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $ (00:00.0541)\n(00:00.0541)\nUse -? to get command line help                                                  (00:00.0542)\n                                                                                 (00:00.0542)\nStack Dump (for debugging):                                                      (00:00.0542)\norg.hl7.fhir.exceptions.FHIRException: Error loading template #custom-template: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $\n    at org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:265)\n    at org.hl7.fhir.igtools.templates.TemplateManager.installTemplate(TemplateManager.java:93)\n    at org.hl7.fhir.igtools.templates.TemplateManager.loadTemplate(TemplateManager.java:79)\n    at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1479)\n    at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1322)\n    at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:690)\n    at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:7430)\nCaused by: com.google.gson.JsonSyntaxException: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $\nat com.google.gson.JsonParser.parse(JsonParser.java:65)\n    at com.google.gson.JsonParser.parse(JsonParser.java:45)\n    at org.hl7.fhir.utilities.cache.NpmPackage.fromFolder(NpmPackage.java:289)\n    at org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:232)\n    ... 6 more\nCaused by: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $\n    at com.google.gson.stream.JsonReader.syntaxError(JsonReader.java:1568)\n    at com.google.gson.stream.JsonReader.checkLenient(JsonReader.java:1409)\n    at com.google.gson.stream.JsonReader.doPeek(JsonReader.java:542)\n    at com.google.gson.stream.JsonReader.peek(JsonReader.java:425)\n    at com.google.gson.JsonParser.parse(JsonParser.java:60)\n    ... 9 more\nIG Publisher finished with code 1\nThe HL7 IG Publisher failed. The HL7 IG Publisher tool is not developed as part of Trifolia-on-FHIR; it is developed by HL7. If you are still having issues after having reviewed and addressed ToF errors reported in the log above, go to chat.fhir.org to get more information on how to proceed.\n</code></pre></div>",
        "id": 199669127,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591214352
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> This is what I have in the custom-template folder:</p>\n<div class=\"codehilite\"><pre><span></span><code>.gitignore\ncache.ini\nconfig/\nconfig.json\ncontent/\nincludes/\nlayouts/\npackage/\npackage-list.json\nREADME.md\nscripts/\n</code></pre></div>",
        "id": 199669482,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591214499
    },
    {
        "content": "<p>Take a look at package/package.json</p>",
        "id": 199670380,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591214885
    },
    {
        "content": "<p>Is it valid json?</p>",
        "id": 199670395,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591214892
    },
    {
        "content": "<p>yup</p>",
        "id": 199676738,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591218332
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;name&quot;: &quot;fhir.base.template&quot;,\n  &quot;type&quot;: &quot;fhir.template&quot;,\n  &quot;license&quot;: &quot;CC0-1.0&quot;,\n  &quot;description&quot;: &quot;FHIR IG Base Template - foundational for use by anyone&quot;,\n  &quot;author&quot;: &quot;http://hl7.org/fhir&quot;,\n  &quot;canonical&quot;: &quot;http://fhir.org/templates/fhir.base.template&quot;,\n  &quot;version&quot;: &quot;0.1.0&quot;\n}\n</code></pre></div>",
        "id": 199676743,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591218335
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span></p>",
        "id": 199676886,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1591218402
    },
    {
        "content": "<p>I don't know what you are trying to do here, but something has gone wrong and the java stack is not enough to resolve it. You'll either have to:</p>\n<ul>\n<li>debug, and identify the actual filename that it's trying to load</li>\n<li>instead of trying to nest it, simply clone the git repository and refer to your local copy</li>\n</ul>",
        "id": 199677786,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591218989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> we are having this issue getting the mCODE IG to build on <span class=\"user-mention\" data-user-id=\"193599\">@Lynn Laakso</span>'s system.</p>\n<p>I'm not sure why the stacktrace doesn't identify the path to the file with the JSON error -- it's really hard to debug this without that info. But in any case, I did some investigation:</p>\n<ol>\n<li>The IG builds without this error on multiple systems: Mac, Windows, and <a href=\"http://build.fhir.org\">build.fhir.org</a></li>\n<li>I set up the IG publisher + dependencies on a fresh Windows install, and _was_ able to reproduce the error. Removing the custom template fixed it. Adding it back in caused it again.</li>\n<li>I then tried to create a smaller sample IG with the same custom template to try to reproduce the issue. I _could not_ reproduce the error int he sample IG.</li>\n<li>I then went back to the mCODE IG to troubleshoot further -- but <strong>I could no longer reproduce the error</strong> <span aria-label=\"thinking\" class=\"emoji emoji-1f914\" role=\"img\" title=\"thinking\">:thinking:</span> Git shows no changes to the code.</li>\n<li>I deleted <code>.fhir</code> and re-cloned the mCODE IG into a new folder. I _still_ can't reproduce the error.</li>\n</ol>\n<p>Here's the stack trace from Lynn's machine. I saw the same exception on mine.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Stack trace</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>C:\\Users\\Administrator&gt;java -jar C:\\GitHub\\publisher.jar -ig C:\\GitHub\\hl7.fhir.us.mcode#1.16.0 -resetTx -publish <a href=\"http://hl7.org/fhir/us/mcode/2021May\">http://hl7.org/fhir/us/mcode/2021May</a><br>\nFHIR IG Publisher Version 1.1.65 (Git# dc2d569155cd). Built 2021-03-29T10:53:43.506Z (14 days old)<br>\nDetected Java version: 1.8.0_281 from C:\\Program Files\\Java\\jre1.8.0_281 on Windows Server 2016/amd64 (64bit). 7204MB available<br>\ndir = C:\\Users\\Administrator, path = C:\\Python39\\Scripts\\;C:\\Python39\\;C:\\Ruby26-x64\\bin;C:\\Program Files\\Java\\jre1.8.0_231\\bin;C:\\Program Files (x86)\\Common Files\\Oracle\\Java\\javapath;C:\\Python38\\Scripts\\;C:\\Python38\\;C:\\Windows\\system32;C:\\Windows;C:\\Windows\\System32\\Wbem;C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\;C:\\Program Files\\Amazon\\cfn-bootstrap\\;C:\\Program Files\\Microsoft VS Code\\bin;C:\\ProgramData\\chocolatey\\bin;C:\\Program Files\\Microsoft\\Web Platform Installer\\;C:\\Program Files\\Git\\cmd;C:\\Program Files\\nodejs\\;C:\\Program Files\\WireGuard\\;C:\\Program Files\\TortoiseGit\\bin;C:\\Ruby26-x64\\bin;C:\\Users\\Administrator\\AppData\\Local\\Microsoft\\WindowsApps;C:\\Users\\Administrator\\AppData\\Local\\Atlassian\\SourceTree\\git_local\\bin;C:\\Program Files\\Java\\jre1.8.0_231\\bin;C:\\Users\\Administrator\\AppData\\Local\\GitHubDesktop\\bin;C:\\Users\\Administrator\\AppData\\Roaming\\npm<br>\nParameters: -ig C:\\GitHub\\hl7.fhir.us.mcode#1.16.0 -resetTx -publish <a href=\"http://hl7.org/fhir/us/mcode/2021May\">http://hl7.org/fhir/us/mcode/2021May</a><br>\nStart Clock @ Monday, April 12, 2021 2:53:37 PM UTC (2021-04-12T14:53:37Z)<br>\nBuild Formal Publication package, intended for <a href=\"http://hl7.org/fhir/us/mcode/2021May\">http://hl7.org/fhir/us/mcode/2021May</a> (00:00.0010)<br>\nAPI keys loaded from C:\\Users\\Administrator\\apikeys.ini                          (00:00.0014)<br>\nPackage Cache: C:\\Users\\Administrator\\.fhir\\packages                             (00:00.0017)<br>\nRun Sushi on C:\\GitHub\\hl7.fhir.us.mcode#1.16.0                                  (00:00.0018)<br>\nSushi: info  Running SUSHI v1.3.1 (implements FHIR Shorthand specification v1.1.0) (00:01.0055)<br>\nSushi: info  Arguments:                                                          (00:01.0056)<br>\nSushi: info    --out C:\\GitHub\\hl7.fhir.us.mcode#1.16.0                          (00:01.0058)<br>\nSushi: info    C:\\GitHub\\hl7.fhir.us.mcode#1.16.0                                (00:01.0059)<br>\nSushi: info  Using configuration file: C:\\GitHub\\hl7.fhir.us.mcode#1.16.0\\sushi-config.yaml (00:01.0202)<br>\nSushi: info  Importing FSH text...                                               (00:01.0234)<br>\nSushi: info  Preprocessed 32 documents with 50 aliases.                          (00:02.0441)<br>\nSushi: info  Imported 123 definitions and 107 instances.                         (00:02.0664)<br>\nSushi: info  Checking local cache for hl7.fhir.us.core#3.1.0...                  (00:02.0665)<br>\nSushi: info  Found hl7.fhir.us.core#3.1.0 in local cache.                        (00:02.0727)<br>\nSushi: info  Loaded package hl7.fhir.us.core#3.1.0                               (00:02.0728)<br>\nSushi: info  Checking local cache for hl7.fhir.r4.core#4.0.1...                  (00:02.0729)<br>\nSushi: info  Found hl7.fhir.r4.core#4.0.1 in local cache.                        (00:03.0417)<br>\nSushi: info  Loaded package hl7.fhir.r4.core#4.0.1                               (00:03.0418)<br>\nSushi: info  Converting FSH to FHIR resources...                                 (00:03.0484)<br>\nSushi: info  Converted 43 FHIR StructureDefinitions.                             (00:09.0673)<br>\nSushi: info  Converted 4 FHIR CodeSystems.                                       (00:09.0691)<br>\nSushi: info  Converted 76 FHIR ValueSets.                                        (00:10.0232)<br>\nSushi: info  Converted 107 FHIR instances.                                       (00:17.0151)<br>\nSushi: info  Exporting FHIR resources as JSON...                                 (00:17.0152)<br>\nSushi: info  Exported 230 FHIR resources as JSON.                                (00:17.0558)<br>\nSushi: info  Assembling Implementation Guide sources...                          (00:17.0559)<br>\nSushi: info  Generated ImplementationGuide-hl7.fhir.us.mcode.json                (00:17.0574)<br>\nSushi: info  Assembled Implementation Guide sources; ready for IG Publisher.     (00:17.0575)<br>\nSushi:                                                                           (00:17.0576)<br>\nSushi: ========================= SUSHI RESULTS ===========================       (00:17.0587)<br>\nSushi: |  -------------------------------------------------------------  |       (00:17.0591)<br>\nSushi: | | Profiles | Extensions | ValueSets | CodeSystems | Instances | |       (00:17.0597)<br>\nSushi: | |-------------------------------------------------------------| |       (00:17.0598)<br>\nSushi: | |    30    |     13     |    76     |      4      |    107    | |       (00:17.0602)<br>\nSushi: |  -------------------------------------------------------------  |       (00:17.0604)<br>\nSushi: |                                                                 |       (00:17.0606)<br>\nSushi: ===================================================================       (00:17.0607)<br>\nSushi: | Everything is ship-shape!              0 Errors      0 Warnings |       (00:17.0614)<br>\nSushi: ===================================================================       (00:17.0619)<br>\nLoad Template from #custom-template                                              (00:18.0720)<br>\nPublishing Content Failed: Error loading template #custom-template: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $ (00:18.0751)<br>\n                                                                                 (00:18.0752)<br>\nUse -? to get command line help                                                  (00:18.0755)<br>\n                                                                                 (00:18.0755)<br>\nStack Dump (for debugging):                                                      (00:18.0756)<br>\norg.hl7.fhir.exceptions.FHIRException: Error loading template #custom-template: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $<br>\n        at org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:277)<br>\n        at org.hl7.fhir.igtools.templates.TemplateManager.installTemplate(TemplateManager.java:93)<br>\n        at org.hl7.fhir.igtools.templates.TemplateManager.loadTemplate(TemplateManager.java:79)<br>\n        at org.hl7.fhir.igtools.publisher.Publisher.initializeFromIg(Publisher.java:1646)<br>\n        at org.hl7.fhir.igtools.publisher.Publisher.initialize(Publisher.java:1461)<br>\n        at org.hl7.fhir.igtools.publisher.Publisher.execute(Publisher.java:729)<br>\n        at org.hl7.fhir.igtools.publisher.Publisher.main(Publisher.java:8429)<br>\nCaused by: com.google.gson.JsonSyntaxException: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $<br>\n        at com.google.gson.JsonParser.parse(JsonParser.java:65)<br>\n        at com.google.gson.JsonParser.parse(JsonParser.java:45)<br>\n        at org.hl7.fhir.utilities.npm.NpmPackage.fromFolder(NpmPackage.java:354)<br>\n        at org.hl7.fhir.igtools.templates.TemplateManager.loadPackage(TemplateManager.java:241)<br>\n        ... 6 more<br>\nCaused by: com.google.gson.stream.MalformedJsonException: Use JsonReader.setLenient(true) to accept malformed JSON at line 1 column 5 path $<br>\n        at com.google.gson.stream.JsonReader.syntaxError(JsonReader.java:1568)<br>\n        at com.google.gson.stream.JsonReader.checkLenient(JsonReader.java:1409)<br>\n        at com.google.gson.stream.JsonReader.doPeek(JsonReader.java:542)<br>\n        at com.google.gson.stream.JsonReader.peek(JsonReader.java:425)<br>\n        at com.google.gson.JsonParser.parse(JsonParser.java:60)<br>\n        ... 9 more</p>\n</div></div>",
        "id": 234479938,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618398378
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> this seems to build OK.</p>",
        "id": 234484456,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618401001
    },
    {
        "content": "<p>The template only have one json file - the package.json.</p>",
        "id": 234484640,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618401086
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> do you want to try removing the custom template and letting me try again?</p>",
        "id": 234492556,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618404706
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191832\">Jose Costa Teixeira</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Unable.20to.20load.20template/near/234484456\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"322501\">Max Masnick</span> this seems to build OK.</p>\n</blockquote>\n<p>It builds ok on my system, and on <a href=\"http://build.fhir.org\">build.fhir.org</a>. But it does not on Lynn's system, and <strong>did</strong> not on my Windows test system (as described above) -- but it does now.</p>",
        "id": 234535104,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618419344
    },
    {
        "content": "<p>ok what did you do to get it to build on windows the second time?</p>",
        "id": 234535380,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618419443
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"193599\">Lynn Laakso</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Unable.20to.20load.20template/near/234535380\">said</a>:</p>\n<blockquote>\n<p>ok what did you do to get it to build on windows the second time?</p>\n</blockquote>\n<p>I'm not sure. The <strong>only</strong> thing I did on the system was trying to build the IG with the custom template removed, and then trying to reproduce in a sample IG with the same test template.</p>",
        "id": 234535574,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618419510
    },
    {
        "content": "<p>Here's a branch with the custom template removed: <a href=\"https://github.com/HL7/fhir-mCODE-ig/tree/no-custom-template\">https://github.com/HL7/fhir-mCODE-ig/tree/no-custom-template</a></p>",
        "id": 234535606,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618419523
    },
    {
        "content": "<p>to remove the custom template yo can just edit the ig.ini and change #custom-template by fhir.base.template</p>",
        "id": 234535979,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618419641
    },
    {
        "content": "<p>(I thought this was a transient issue, I did not read that it doesn't work on Lynn's machine)</p>",
        "id": 234536107,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618419691
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193599\">@Lynn Laakso</span> is this still broken?</p>",
        "id": 234537256,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618420107
    },
    {
        "content": "<p>yes; working with Max and Mark now</p>",
        "id": 234537292,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618420125
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I am still getting the error, and also 70 new ones on my dev environment for Valudation_VAL_Profile_MatchMultiple</p>",
        "id": 234540052,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618421175
    },
    {
        "content": "<p>@grahame these errors do not show up on the ci-build</p>",
        "id": 234541510,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618421693
    },
    {
        "content": "<p>I found a way to reproduce it :)</p>",
        "id": 234541925,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618421848
    },
    {
        "content": "<p>on my machine this breaks when i do a java -jar ..\\publisher.jar -ig &lt;ig-path&gt; -resetTx -publish <a href=\"http://hl7.org/fhir/us/mcode/2021May\">http://hl7.org/fhir/us/mcode/2021May</a></p>",
        "id": 234542204,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618421952
    },
    {
        "content": "<p>it does NOT break when I run  <code>.\\_genonce.bat -resetTx -publish http://hl7.org/fhir/us/mcode/2021May</code></p>",
        "id": 234542263,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618421978
    },
    {
        "content": "<p>the _genonce.bat script does nothing but run <code>java -jar &lt;publisher&gt; ig .</code></p>",
        "id": 234542444,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618422034
    },
    {
        "content": "<p>which makes it weird &amp; interesting</p>",
        "id": 234542473,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618422045
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> I was able to reproduce with that same command...and then I couldn't reproduce anymore (as described above). So if  you can get into the Java debugger or something to see what file is the source of the JSON parsing issue while it's still reproducing, you might want to :)</p>\n<p>Otherwise you'll be in my shoes where I can no longer reproduce, so I can't further debug.</p>",
        "id": 234543335,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618422307
    },
    {
        "content": "<p>Murphy was right.</p>",
        "id": 234545301,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618422989
    },
    {
        "content": "<p>i can get into the Java debugger, but it does not break on the debugger</p>",
        "id": 234545344,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618423010
    },
    {
        "content": "<p>I think i found it</p>",
        "id": 234551956,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618425529
    },
    {
        "content": "<p>can I make a PR?</p>",
        "id": 234552574,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618425799
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> Awesome! This issue is a blocker for getting the mCODE IG to ballot (or we have to take out our custom template, which we would prefer not to do) so if it's possible to get this merged into a publisher release to allow <span class=\"user-mention\" data-user-id=\"193599\">@Lynn Laakso</span> to build the IG to publish the ballot version, we would really appreciate it.</p>",
        "id": 234554234,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618426458
    },
    {
        "content": "<p>can i do that PR later? or <span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> if you don't mind doing it:<br>\n(that was not deliberate suspense. Issue is fixed, I believe)</p>",
        "id": 234554344,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618426504
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193599\">@Lynn Laakso</span> is this fixed?</p>",
        "id": 234576284,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618434530
    },
    {
        "content": "<p>was there an update to the publisher?</p>",
        "id": 234576416,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618434567
    },
    {
        "content": "<p>no, the error was in mcode</p>",
        "id": 234576450,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618434576
    },
    {
        "content": "<p>if you download it again and try, it should work</p>",
        "id": 234576589,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618434606
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"322501\">@Max Masnick</span> was the repo updated?</p>",
        "id": 234576594,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618434607
    },
    {
        "content": "<p>yes</p>",
        "id": 234576618,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618434613
    },
    {
        "content": "<p>45 minutes ago there was a commit to master (merging a PR)</p>",
        "id": 234576817,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618434665
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193599\">@Lynn Laakso</span> yes the repo is updated. If you <code>git pull</code> or just delete and re-clone the repo it should finish building</p>",
        "id": 234577237,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618434751
    },
    {
        "content": "<p>OK it builds, though it has 77 errors and they are not on the ci-build</p>",
        "id": 234579749,
        "sender_full_name": "Lynn Laakso",
        "timestamp": 1618435744
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"193599\">Lynn Laakso</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Unable.20to.20load.20template/near/234579749\">said</a>:</p>\n<blockquote>\n<p>OK it builds, though it has 77 errors and they are not on the ci-build</p>\n</blockquote>\n<p>Grahame emailed us about this, but for anyone not on the email thread, this is what is going on:</p>\n<p>There's <a href=\"https://github.com/HL7/fhir-ig-publisher/issues/231\">a bug in the IG publisher</a> that <strong>makes builds non-deterministic</strong> -- in other words, if you run <code>java -jar &lt;publisher&gt; ig .</code> twice in a row with exactly the same input, you may get <strong>different</strong> output.</p>\n<p>This bug has to do with the state of the <code>txcache/</code> folder: it appears a \"throw-away\" build is needed to get the <code>txcache/</code> folder into the \"correct\" state, and then subsequent builds work as expected.</p>\n<p>The mCODE IG checks the <code>txcache/</code> folder into git, which means that builds using <code>genonce</code> and <a href=\"http://build.fhir.org\">build.fhir.org</a> already have <code>txcache/</code> in the \"correct\" state even with a fresh clone of the mCODE GitHub repo.</p>\n<p>But <a href=\"https://confluence.hl7.org/display/FHIR/Process+for+Publishing+a+FHIR+IG#ProcessforPublishingaFHIRIG-LocalBuild\">the command Lynn has to run to publish the IG</a> includes the <code>-resetTx</code> option, which deletes <code>txcache/</code> prior to build.</p>\n<p>The solution is to:</p>\n<ol>\n<li>Run the standard build command for publishing, e.g., <code>java -jar publisher.jar -ig hl7.fhir.us.mcode#1.16.0 -resetTx -publish http://hl7.org/fhir/us/mcode/2021May</code></li>\n<li>Run the same command again, but without the <code>-resetTx</code> option: <code>java -jar publisher.jar -ig hl7.fhir.us.mcode#1.16.0 -publish http://hl7.org/fhir/us/mcode/2021May</code></li>\n</ol>\n<p>The first build has 77 QA errors. The second build has 0.</p>\n<p>Here's the GitHub issue for this bug: <a href=\"https://github.com/HL7/fhir-ig-publisher/issues/231\">https://github.com/HL7/fhir-ig-publisher/issues/231</a></p>",
        "id": 234645229,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618479499
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> Do you think we need something added to the publisher to catch the issue you found in the mCode IG to make it easier to diagnose the next time the same problem shows up?  If so, might be good to submit a Git issue against the publisher.</p>",
        "id": 234750421,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1618519885
    },
    {
        "content": "<p>The issue was a strange unexpected character in the beginning of the JSON (could not even delete it in my IDE). The exception was from the json parser.<br>\nWe could try to get the extension trapping more explicit about which JSON it was parsing -if that is easy it would solve other JSONs, not only that in the template. If that is easy, it would be worth it.</p>",
        "id": 234751503,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618520339
    },
    {
        "content": "<p>but I hope this is a rare issue, so I don't know if it is worth going out of our way.</p>",
        "id": 234751582,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618520377
    },
    {
        "content": "<p>In other parts of the publisher, a more verbose output or an indication of which file it is working, would be helpful. I presume that malformed conformance JSONs would be more common than malformed JSONs for custom templates</p>",
        "id": 234752109,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618520484
    },
    {
        "content": "<p>that, or perhaps a new feature like a \"pre-sanitizing  / pre-check\" of all the IG files for basic syntax checking (forgotten commas in JSON, quotes in XML..)</p>",
        "id": 234753030,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618520656
    },
    {
        "content": "<p>But this is just spitballing. I didn't think of a way to fix this and I presume this would be very very rare compared to other issues.</p>",
        "id": 234753401,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618520755
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> if the publisher could identify the path of the file with invalid JSON as part of the stack trace, that would have saved probably 10 person-hours for this bug, and would be helpful for all other JSON parsing issues as well.</p>",
        "id": 234764582,
        "sender_full_name": "Max Masnick",
        "timestamp": 1618525853
    },
    {
        "content": "<p>which file was it?</p>",
        "id": 234805177,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1618556900
    },
    {
        "content": "<p>The local template's package.json</p>",
        "id": 234808487,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618558550
    },
    {
        "content": "<p>My  PR shows the change</p>",
        "id": 234808568,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1618558585
    },
    {
        "content": "<p>which PR?</p>",
        "id": 234809300,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1618559061
    }
]