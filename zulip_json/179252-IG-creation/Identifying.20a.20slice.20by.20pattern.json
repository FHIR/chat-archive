[
    {
        "content": "<p>I have a <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/StructureDefinition-ncdhc-observation-fetal-movement.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/StructureDefinition-ncdhc-observation-fetal-movement.html\">Fetal Movement </a> profile that slices (STU3) Observation.code.coding by value:system and pattern:code. <br>\nWhen I identify a slice <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/StructureDefinition-ncdhc-observation-fetal-movement-definitions.html#Observation.code.coding:FetalMovementsSNOMED-CT\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/StructureDefinition-ncdhc-observation-fetal-movement-definitions.html#Observation.code.coding:FetalMovementsSNOMED-CT\">FetalMovementsSNOMED-CT</a> using fixed values in the discriminator it works fine.</p>\n<div class=\"codehilite\"><pre><span></span>      {\n        &quot;id&quot;: &quot;Observation.code.coding:FetalMovementsSNOMED-CT&quot;,\n        &quot;path&quot;: &quot;Observation.code.coding&quot;,\n        &quot;sliceName&quot;: &quot;FetalMovementsSNOMED-CT&quot;,\n        &quot;min&quot;: 1,\n        &quot;max&quot;: &quot;1&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Observation.code.coding:FetalMovementsSNOMED-CT.system&quot;,\n        &quot;path&quot;: &quot;Observation.code.coding.system&quot;,\n        &quot;min&quot;: 1,\n        &quot;fixedUri&quot;: &quot;http://snomed.info/sct&quot;\n      },\n      {\n        &quot;id&quot;: &quot;Observation.code.coding:FetalMovementsSNOMED-CT.code&quot;,\n        &quot;path&quot;: &quot;Observation.code.coding.code&quot;,\n        &quot;min&quot;: 1,\n        &quot;fixedCode&quot;: &quot;364617005&quot;\n      },\n</pre></div>",
        "id": 189085530,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582691613
    },
    {
        "content": "<p>We would like to identify slices using patternCoding. </p>\n<div class=\"codehilite\"><pre><span></span>      {\n        &quot;id&quot;: &quot;Observation.code.coding:FetalMovementsSNOMED-CT&quot;,\n        &quot;path&quot;: &quot;Observation.code.coding&quot;,\n        &quot;sliceName&quot;: &quot;FetalMovementsSNOMED-CT&quot;,\n        &quot;min&quot;: 1,\n        &quot;max&quot;: &quot;1&quot;,\n        &quot;patternCoding&quot;: {\n          &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n          &quot;code&quot;: &quot;364617005&quot;\n        }\n      },\n</pre></div>\n\n\n<p>But the validator does not recognise the slice.</p>\n<blockquote>\n<p>Could not match any discriminators ([system, code]) for slice Observation.code.coding:FetalMovementsSNOMED-CT in profile <a href=\"http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-fetal-movement\" target=\"_blank\" title=\"http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-fetal-movement\">http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-fetal-movement</a> - None of the discriminator [system, code] have fixed value, binding or existence assertions</p>\n</blockquote>",
        "id": 189085591,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582691742
    },
    {
        "content": "<p>Though the IGpublisher produces a differential table that recognises system and code as 1..1 with fixed values.<br>\n<a href=\"/user_uploads/10155/H0drUztLCOgK1aJxFRk4Mavr/image.png\" target=\"_blank\" title=\"image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/H0drUztLCOgK1aJxFRk4Mavr/image.png\" target=\"_blank\" title=\"image.png\"><img src=\"/user_uploads/10155/H0drUztLCOgK1aJxFRk4Mavr/image.png\"></a></div>",
        "id": 189085721,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582691901
    },
    {
        "content": "<p>If you're slicing by pattern, the discriminator should just be coding - no need for both system and code as both would be covered by the pattern</p>",
        "id": 189085744,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1582691945
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 189086000,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582692473
    },
    {
        "content": "<p>We are slicing Observation.code.coding, not Observation.code</p>",
        "id": 189086063,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582692554
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>      {\n        &quot;id&quot;: &quot;Observation.code.coding&quot;,\n        &quot;path&quot;: &quot;Observation.code.coding&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;value&quot;,\n              &quot;path&quot;: &quot;system&quot;\n            },\n            {\n              &quot;type&quot;: &quot;pattern&quot;,\n              &quot;path&quot;: &quot;code&quot;\n            }\n          ],\n          &quot;rules&quot;: &quot;closed&quot;\n        }\n      },\n</pre></div>",
        "id": 189086124,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582692688
    },
    {
        "content": "<p>Observation.code is 1..1, so it cannot be sliced by coding.</p>",
        "id": 189086183,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582692796
    },
    {
        "content": "<p>But why are you declaring two discriminators?  Why not:<br>\n    \"slicing\": {<br>\n      \"discriminator\": [<br>\n        {<br>\n          \"type\": \"pattern\"<br>\n          \"path\": \"$this\"<br>\n        }<br>\n      ]<br>\n    }</p>",
        "id": 189086251,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1582692953
    },
    {
        "content": "<p>And then just declare patterns on the codings for your slices?</p>",
        "id": 189086296,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1582692974
    },
    {
        "content": "<p>I did not know that was an option.</p>",
        "id": 189086303,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582693018
    },
    {
        "content": "<p>Thanks. I'll investigate that option.</p>",
        "id": 189086318,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582693082
    },
    {
        "content": "<p>That replaces the old error (Could not match any discriminators ...) with</p>\n<blockquote>\n<p>Unsupported fixed pattern type for discriminator($this) for slice Observation.code.coding:FetalMovementsSNOMED-CT: org.hl7.fhir.r5.model.Coding</p>\n</blockquote>",
        "id": 189086645,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582693678
    },
    {
        "content": "<p>That's very weird.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 189086756,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1582693835
    },
    {
        "content": "<p>I ran into exactly the same thing a few days ago.  Apparently pattern is not currently supported with the Coding data type (fixed value constraints are also not supported for Coding, but pattern is what I was looking for).  I had to constrain Coding.system and Coding.code in order to get it to work.</p>",
        "id": 189156823,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1582749842
    },
    {
        "content": "<p>I did the same thing as <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  all of our profiles  (except vital sings) are following pattern and we are living with this work around. <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/profiles.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/profiles.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/profiles.html</a></p>",
        "id": 189171054,
        "sender_full_name": "Shovan Roy",
        "timestamp": 1582758849
    },
    {
        "content": "<blockquote>\n<p>pattern is not currently supported with the Coding data type</p>\n</blockquote>\n<p>what happens if you try?</p>",
        "id": 189173631,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582761202
    },
    {
        "content": "<p>You get the <code>Unsupported fixed pattern type for discriminator</code> error that <span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span> reported.</p>",
        "id": 189173773,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1582761339
    },
    {
        "content": "<p>Does someone want to contribute a test case?that would be:</p>\n<ul>\n<li>a profile based of R4 base resource that defines a pattern with a Coding based discriminator</li>\n<li>an instance that conforms to the profile</li>\n<li>an instance that doesn't conform to the profile</li>\n</ul>",
        "id": 189174014,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582761526
    },
    {
        "content": "<p>or a similar error message (I could try to reproduce it again on my end if needed)</p>",
        "id": 189174036,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1582761558
    },
    {
        "content": "<p>that's the error. I found it and will fix it for next release if someone provides test cases</p>",
        "id": 189174174,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582761614
    },
    {
        "content": "<p>I or <span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span>  will get you the test cases</p>",
        "id": 189174218,
        "sender_full_name": "Shovan Roy",
        "timestamp": 1582761661
    },
    {
        "content": "<p>sure - I'll try to find some time tonight to do it (unless someone else is able to do it first)</p>",
        "id": 189174219,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1582761662
    },
    {
        "content": "<p>one of us should be able to</p>",
        "id": 189174228,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1582761674
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ,</p>\n<p>Please see the two Profiles and the examples as provided below:</p>\n<p>--Failing with Pattern--<br>\nFor <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-urinalysis-protein.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-urinalysis-protein.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-urinalysis-protein.html</a> , we have slice discriminator on pattern = code the sample is failing with error:<br>\n\"Could not match discriminator ([code]) for slice Observation.code.coding:Urinalysis-SNOMED-CT in profile <a href=\"http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-urinalysis-protein\" target=\"_blank\" title=\"http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-urinalysis-protein\">http://hl7.org.au/fhir/ch/v1/StructureDefinition/ncdhc-observation-urinalysis-protein</a> - the discriminator [code] does not have fixed value, binding or existence assertions\"<br>\nhere is the link for the sample: <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-urinalysis-protein-example.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-urinalysis-protein-example.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-urinalysis-protein-example.html</a></p>\n<p>--Working with Pattern (with workaround)--<br>\nAs <span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span>  mentioned in this discussion thread, For  <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-fetal-movement.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-fetal-movement.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/StructureDefinition-ncdhc-observation-fetal-movement.html</a>  we have slice discriminator on pattern = code and value=system, the sample is working. </p>\n<p>here is the sample: <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-fetal-movement-example.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-fetal-movement-example.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/ncdhc-observation-fetal-movement-example.html</a></p>\n<p>Here is the link for QA page : <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/qa.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/qa.html\">http://build.fhir.org/ig/hl7au/au-fhir-childhealth/branches/master/qa.html</a></p>\n<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>, fyi.. on profile/samples we are using</p>",
        "id": 189176546,
        "sender_full_name": "Shovan Roy",
        "timestamp": 1582763861
    },
    {
        "content": "<p>ok.. fixed next release</p>",
        "id": 189208202,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582805843
    },
    {
        "content": "<p>thanks.</p>",
        "id": 189208206,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582805848
    },
    {
        "content": "<p>btw i had to hack the profile - check the test cases at <a href=\"https://github.com/FHIR/fhir-test-cases/commit/1d95524a886c2704ebdc6dd4361634a35a4626f8\" target=\"_blank\" title=\"https://github.com/FHIR/fhir-test-cases/commit/1d95524a886c2704ebdc6dd4361634a35a4626f8\">https://github.com/FHIR/fhir-test-cases/commit/1d95524a886c2704ebdc6dd4361634a35a4626f8</a></p>",
        "id": 189211314,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582808428
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  I can see that you are using  pattern = $this as the discriminator, we will apply this to our profiles once the fix is published. Did I miss anything else?</p>",
        "id": 189253833,
        "sender_full_name": "Shovan Roy",
        "timestamp": 1582835553
    },
    {
        "content": "<p>In commit 1d95524a886c2704ebdc6dd4361634a35a4626f8<br>\nvalidator/profile-slicing-coding-bad.json and validator/profile-slicing-coding-good.json have the same value for <a href=\"http://Observation.id\" target=\"_blank\" title=\"http://Observation.id\">Observation.id</a></p>",
        "id": 189269140,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582846415
    },
    {
        "content": "<p>it does. doesn't really matter but I'll fix it</p>",
        "id": 189272050,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582849220
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span><br>\nI feared that unique ids were important to validation.</p>",
        "id": 189272217,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1582849378
    },
    {
        "content": "<p>I took the latest IG Publisher, I can see the slicing with 'patern=$this' is coming out nicely. thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\n<a href=\"/user_uploads/10155/QrOpBYb5-PSw58q7U2-8m2z8/image.png\" target=\"_blank\" title=\"image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/QrOpBYb5-PSw58q7U2-8m2z8/image.png\" target=\"_blank\" title=\"image.png\"><img src=\"/user_uploads/10155/QrOpBYb5-PSw58q7U2-8m2z8/image.png\"></a></div>",
        "id": 189450242,
        "sender_full_name": "Shovan Roy",
        "timestamp": 1583101044
    }
]