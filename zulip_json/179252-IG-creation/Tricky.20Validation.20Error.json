[
    {
        "content": "<p>Grahame  <br>\nI have a tricky error remaining in one of my IGs for ballot. </p>\n<p><a href=\"https://build.fhir.org/ig/HL7/fhir-central-cancer-registry-reporting-ig/qa.html\">https://build.fhir.org/ig/HL7/fhir-central-cancer-registry-reporting-ig/qa.html</a><br>\n<a href=\"https://github.com/HL7/fhir-central-cancer-registry-reporting-ig\">https://github.com/HL7/fhir-central-cancer-registry-reporting-ig</a> </p>\n<p>I am using 2 profiles (One each from US Core and mCode)</p>\n<p>Profile 1 - US Core Condition profile.<br>\nProfile 2 - mCode Primary Cancer Condition profile -----&gt; Derived from US Core profile if we follow its inheritance hierarchy.</p>\n<p>Now I have a Cancer Report Bundle that  contains the following:</p>\n<p>Bundle <br>\n  ---- mCode Primary Cancer Condition  (Mandatory 1..*)<br>\n  ---- problem List (for all other conditions) (Optional 0..*)</p>\n<p>When I include a mCode Primary Cancer Condition example in the bundle that meets the Bundle requirement, I get an error saying that the Condition example matches both profiles (mCode and US Core). </p>\n<p>The error is reporting the right thing, but I am not sure what I can do about it , because the above bundle structure is what we want to have.</p>\n<p>Any options or thoughts you may have would be greatly appreciated. <br>\nEverything is checked in and is available in the above links in case you want to take a peek.</p>\n<p>Thanks<br>\nDragon</p>",
        "id": 262416739,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1637647804
    },
    {
        "content": "<p>You're inheriting US Core by setting the dependencies to US Core IGs.  You may not need to set the US Core dependency directly.  Try removing it and see what happens.</p>",
        "id": 262467771,
        "sender_full_name": "David Pyke",
        "timestamp": 1637680045
    },
    {
        "content": "<p>Tried the suggestion, but did not work. Any other thoughts ?</p>",
        "id": 262573739,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1637751882
    },
    {
        "content": "<p>if you slice by profile you need to have distinct profiles, that's why you get the error message. The validator (or even the receiver) would not know if the condition is for the problemList or for the primaryCancerCondtion. if you need to differentiate that maybe introduce sections and slice the entries in the section.</p>",
        "id": 262575334,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1637752808
    },
    {
        "content": "<p>Introducing sections along composition is something that I thought about as an answer but that makes it a little more complex and I am not sure if the community will go for it. <br>\nAs far as distinguishing the different resources included, I was thinking that the receiver would be able to distinguish by using the profile indicated in the meta element. So if someone sends a condition with just US Core as the profile in the meta, then it is just a generic problem list item, however if they indicated it is a primaryCancerCondition, then it is an mCode Primary Cancer Condition profile.<br>\nThe fact that the included Condition element meets the requirement for both slices should not give an error, I am not understanding the rationale behind the error unless it is just code complexity that is preventing the error from going away.</p>",
        "id": 262591701,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1637762417
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192017\">Nagesh Bashyam</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Tricky.20Validation.20Error/near/262591701\">said</a>:</p>\n<blockquote>\n<p>As far as distinguishing the different resources included, I was thinking that the receiver would be able to distinguish by using the profile indicated in the meta element. </p>\n</blockquote>\n<p>sending the profile in meta is not required (and I think not recommended as best practice). but if you would add this requirement to the mCode primary Cancer Condition (or a derived profile of it) your slicing would give no errors because now the slices are distinct.</p>",
        "id": 262595849,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1637764236
    },
    {
        "content": "<blockquote>\n<p>The fact that the included Condition element meets the requirement for both slices should not give an error, I am not understanding the rationale behind the error unless it is just code complexity that is preventing the error from going away.</p>\n</blockquote>\n<p>its required by the specification, see <a href=\"https://www.hl7.org/fhir/profiling.html#discriminator\">https://www.hl7.org/fhir/profiling.html#discriminator</a></p>\n<blockquote>\n<p>When a constraining structure designates one or more discriminators, it SHALL ensure that the possible values for each slice are different and non-overlapping, so that the slices can easily be distinguished.</p>\n</blockquote>",
        "id": 262596422,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1637764560
    },
    {
        "content": "<p>You're not allowed to use meta.profile to establish meaning.  It must <em>always</em> be possible to strip the meta.profiles, validate against all candidates, re-assert the ones that are true and not lose information.  Validation cares about what's valid against the profile, not what profiles are declared.</p>",
        "id": 262663153,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637810467
    },
    {
        "content": "<p>If you need to assert a difference between two instances, it needs to be in the data values for the instances.  If necessary, create an extension that disambiguates <span class=\"user-mention\" data-user-id=\"192017\">@Nagesh Bashyam</span></p>",
        "id": 262663175,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637810508
    },
    {
        "content": "<p>Thank you for all the suggestions, let me think about how to make it happen.</p>",
        "id": 262667044,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1637816233
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179252-IG-creation/topic/Tricky.20Validation.20Error/near/262663153\">said</a>:</p>\n<blockquote>\n<p>You're not allowed to use meta.profile to establish meaning.  It must <em>always</em> be possible to strip the meta.profiles, validate against all candidates, re-assert the ones that are true and not lose information. </p>\n</blockquote>\n<p>Is this stated somewhere? This approached is already used in profiled bundle ig's, I see:</p>\n<ol>\n<li>IHE uses this concept for indicating the type of a specific transaction for the <a href=\"https://profiles.ihe.net/ITI/MHD/ITI-65.html#23654121-bundle-resources\">'Provide Document Bundle' - Transaction</a>:</li>\n</ol>\n<blockquote>\n<p>The FHIR Bundle.meta.profile shall have the following value depending on the Actor implementation of no options (Minimal Metadata), Comprehensive Metadata Option, or UnContained References Option.</p>\n</blockquote>\n<ol start=\"2\">\n<li>Usage on Bundle.meta.profile to indicate what kind of document it is, eg <a href=\"https://simplifier.net/erezept/kbvprerpbundle\">German eRezept</a></li>\n</ol>\n<p>For documents we are currently using Composition.type to fix to a specific document, however this very coarse and we are also considering to include some requirements to further specify to which specifications this documents belongs to, any alternative recommendations highly appreciated.</p>",
        "id": 262674508,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1637826241
    },
    {
        "content": "<blockquote>\n<p>For this reason, applications processing resources SHOULD always depend on the contents of the resource when processing them, and/or check resources against the StructureDefinitions directly rather than relying the existence of profile tags for meaning. Profile Tags are provided as a method of finding resources that conform to a particular StructureDefinition, not statements of meaning about the resource.</p>\n</blockquote>",
        "id": 262681315,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637831153
    },
    {
        "content": "<p><a href=\"https://build.fhir.org/resource.html#profile-tags\">https://build.fhir.org/resource.html#profile-tags</a></p>",
        "id": 262681318,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637831160
    },
    {
        "content": "<p>looking at the profiles, this isn't resolved. I think it's naturally a category thing - what kind of category is this condition?</p>\n<p>US core has category 1..* with an extensible binding to problem-list-item, encounter-diagnosis, health-concern, and death-diagnosis.</p>\n<p>mCode doesn't say anything about category, just describes what a primary cancer diagnosis looks like. So mCode tells you nothing about how to know whether a Condition is a Primary Cancer Condition - and that's your actual problem.</p>\n<p>So when a consumer is looking at a bundle with a list of conditions, some of which are the patient's problem list, and some of which are the primary cancer diagnosis. (aside: there seems like a language issue here, if primary can be 0..*. Also, a primary cancer diagnosis would also be in the problem list? So will it be present twice? or just once?). So how do consumers tell them apart? And I note that a problem in the problem list might well conform to the mCode primacy cancer condition without being 'the primary cancer condition' in this context.</p>\n<p>You have to disambiguate them - and you can't do it with a profile label, since those are fluid, and conforming the profile is not enough to say that it's the focus here. I think you have to re-profile mcode primary Cancer Condition and add a category to it, that is used to mark a Condition as (one of) the condition you're focused on</p>",
        "id": 262966575,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638160908
    },
    {
        "content": "<p>Thanks Grahame and others for the feedback, I am evaluating the best way to move forward here, like a category or composition section to disambiguate the various resources which get included and ensuring that they get included only once in the given bundle.</p>",
        "id": 263021962,
        "sender_full_name": "Nagesh Bashyam",
        "timestamp": 1638199250
    }
]