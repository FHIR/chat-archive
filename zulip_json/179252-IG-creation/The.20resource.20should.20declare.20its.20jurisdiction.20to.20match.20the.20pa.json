[
    {
        "content": "<p>Sharing this for posterity (I didn't find anything relevant searching through Zulip history).</p>\n<p>I saw this warning in <code>qa.html</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>The resource should declare its jurisdiction to match the package id (hl7.fhir.uv.smart-web-messaging, jurisdiction = http://unstats.un.org/unsd/methods/m49/m49.htm#001: World)\n</code></pre></div>\n\n\n<p>I thought, no problem - I'll use that value in my sushi <code>config.yaml</code> and rebuild.  Unfortunately, that didn't quite work.</p>\n<p>I added this line:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"nt\">jurisdiction</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">http://unstats.un.org/unsd/methods/m49/m49.htm#001</span><span class=\"p p-Indicator\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">World</span>\n</code></pre></div>\n\n\n<p>Rebuilding gave me this sushi error:</p>\n<div class=\"codehilite\"><pre><span></span><code>error Error parsing configuration: Nested mappings are not allowed in compact mappings.\n  File: fsh/config.yaml\n</code></pre></div>\n\n\n<p>Unfortunately, I didn't see the simple fix right away due to unfamiliarity with the URN code systems.  I tried all kinds of silly things before I recognized that what I <em>needed</em> was very close to what the error suggested.</p>\n<p>This works:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"nt\">jurisdiction</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">http://unstats.un.org/unsd/methods/m49/m49.htm#001 &quot;World&quot;</span>\n</code></pre></div>\n\n\n<p>A better suggestion in the error message would have saved me some time, so I looked into the publisher code hoping to find a suggestion for an edit.  I found <a href=\"https://github.com/HL7/fhir-ig-publisher/blob/f2b3f4d1bf75713d9d489c9cc655dbd096c79e9d/org.hl7.fhir.publisher.core/src/main/java/org/hl7/fhir/igtools/publisher/Publisher.java#L3767\">this line of code</a>, which was taken from this method:</p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">checkJurisdiction</span><span class=\"p\">(</span><span class=\"n\">FetchedFile</span> <span class=\"n\">f</span><span class=\"p\">,</span> <span class=\"n\">CanonicalResource</span> <span class=\"n\">resource</span><span class=\"p\">,</span> <span class=\"n\">IssueSeverity</span> <span class=\"n\">error</span><span class=\"p\">,</span> <span class=\"n\">String</span> <span class=\"n\">verb</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n    <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">expectedJurisdiction</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n      <span class=\"kt\">boolean</span> <span class=\"n\">ok</span> <span class=\"o\">=</span> <span class=\"kc\">false</span><span class=\"p\">;</span>\n      <span class=\"k\">for</span> <span class=\"p\">(</span><span class=\"n\">CodeableConcept</span> <span class=\"n\">cc</span> <span class=\"p\">:</span> <span class=\"n\">resource</span><span class=\"p\">.</span><span class=\"na\">getJurisdiction</span><span class=\"p\">())</span> <span class=\"p\">{</span>\n        <span class=\"n\">ok</span> <span class=\"o\">=</span> <span class=\"n\">ok</span> <span class=\"o\">||</span> <span class=\"n\">cc</span><span class=\"p\">.</span><span class=\"na\">hasCoding</span><span class=\"p\">(</span><span class=\"n\">expectedJurisdiction</span><span class=\"p\">);</span>\n      <span class=\"p\">}</span>\n      <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"o\">!</span><span class=\"n\">ok</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n        <span class=\"n\">f</span><span class=\"p\">.</span><span class=\"na\">getErrors</span><span class=\"p\">().</span><span class=\"na\">add</span><span class=\"p\">(</span><span class=\"k\">new</span> <span class=\"n\">ValidationMessage</span><span class=\"p\">(</span><span class=\"n\">Source</span><span class=\"p\">.</span><span class=\"na\">Publisher</span><span class=\"p\">,</span> <span class=\"n\">IssueType</span><span class=\"p\">.</span><span class=\"na\">BUSINESSRULE</span><span class=\"p\">,</span> <span class=\"n\">resource</span><span class=\"p\">.</span><span class=\"na\">fhirType</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s\">&quot;.jurisdiction&quot;</span><span class=\"p\">,</span> <span class=\"s\">&quot;The resource &quot;</span><span class=\"o\">+</span><span class=\"n\">verb</span><span class=\"o\">+</span><span class=\"s\">&quot; declare its jurisdiction to match the package id (&quot;</span><span class=\"o\">+</span><span class=\"n\">npmName</span><span class=\"o\">+</span><span class=\"s\">&quot;, jurisdiction = &quot;</span><span class=\"o\">+</span><span class=\"n\">expectedJurisdiction</span><span class=\"p\">.</span><span class=\"na\">toString</span><span class=\"p\">()</span><span class=\"o\">+</span><span class=\"s\">&quot;)&quot;</span><span class=\"p\">,</span>\n            <span class=\"n\">error</span><span class=\"p\">).</span><span class=\"na\">setMessageId</span><span class=\"p\">(</span><span class=\"n\">I18nConstants</span><span class=\"p\">.</span><span class=\"na\">RESOURCE_JURISDICTION_MISMATCH</span><span class=\"p\">));</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>I spent a few minutes digging in to how the <code>toString</code> logic works for <code>expectedJurisdiction</code>, which is an <code>o.h.f.r5.model.Coding</code>, but I can't follow it just by browsing on GitHub.</p>\n<p>Anyway, I don't see a clean way to transform the jurisdiction hint from <code>http://unstats.un.org/unsd/methods/m49/m49.htm#001: World</code> to <code>http://unstats.un.org/unsd/methods/m49/m49.htm#001 \"World\"</code> without doing something hacky in the publisher code.</p>\n<p>I did submit an issue to track this: <a href=\"https://github.com/HL7/fhir-ig-publisher/issues/135\">https://github.com/HL7/fhir-ig-publisher/issues/135</a></p>",
        "id": 204290884,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1595060304
    }
]