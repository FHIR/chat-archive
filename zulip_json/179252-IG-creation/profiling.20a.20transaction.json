[
    {
        "content": "<p>I have a problem that might be a tooling issue, but might also be a mistake in the way I have profiled a transaction. In my IG (IHE MHD profile), I have profiled a transaction Bundle as having 1 DocumentManifest, 0..* DocumentReference, 0..* List, 0..* Binary, and 0..1 Patient. The problem I have is with my examples. An example of this Bundle seems to not like having the profile indicated at the Bundle level, and also doesn't like Bundle.entity that are DocumentReference where that instance is a profile indicated.<br>\n    IG is published <a href=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/index.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/index.html\">http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/index.html</a><br>\n    all of my bundle examples have the problem, but most simple is <a href=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-NT2L2T_repo_input_examples_pdb-minimalSubmission\" target=\"_blank\" title=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-NT2L2T_repo_input_examples_pdb-minimalSubmission\">http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-NT2L2T_repo_input_examples_pdb-minimalSubmission</a></p>\n<p>I can eliminate the first \"information\" by removing the profile declaration on that DocumentReference<br>\nNote I do not get these kind of \"information\" on DocumentManifest or List.... which leads me to think I have messed up, but can't figure out what the mess up is.</p>",
        "id": 184939493,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578340261
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> ?</p>",
        "id": 185068499,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578441934
    },
    {
        "content": "<p>When you say \"doesn't like\", do you mean the \"doesn't match any known slice\" messages?</p>",
        "id": 185131677,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578502056
    },
    {
        "content": "<p>I was JUST about to start writing a post about a similar problem (I think)... Are you talking about the slicing of Bundle.entry?</p>\n<p>We have this bundle: <a href=\"https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-ChildhoodNutritionReferralFeedbackSupportingInformation.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-ChildhoodNutritionReferralFeedbackSupportingInformation.html\">https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-ChildhoodNutritionReferralFeedbackSupportingInformation.html</a> with a slice on entry. The slices are: 2 Observations and one MedicationStatement:</p>\n<p><a href=\"/user_uploads/10155/InijCh-j6hyY6MaTF0EabMVJ/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/InijCh-j6hyY6MaTF0EabMVJ/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/InijCh-j6hyY6MaTF0EabMVJ/pasted_image.png\"></a></div><p>I was getting an error on my example: <code>Element matches more than one slice.</code></p>\n<p>I tried every permutation and combination of discriminator.type and discrininator.value and they all had various errors, none worked. </p>\n<p>I eventually went back to the original type=profile and path=resource and ended up having to change the Observations to get it to work. </p>\n<p>I feel that this is a total hack though - what I had to do was to fix the value  of Observation.meta.profile to the uri of the Observation profile. <a href=\"https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-EarlyChildhoodNutritionFeedbackObservation.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-EarlyChildhoodNutritionFeedbackObservation.html\">https://build.fhir.org/ig/HL7/bser/StructureDefinition-BSeR-EarlyChildhoodNutritionFeedbackObservation.html</a>:</p>\n<p><a href=\"/user_uploads/10155/fSfPgjm14Wtg-LOs41HWvxtB/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/fSfPgjm14Wtg-LOs41HWvxtB/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/fSfPgjm14Wtg-LOs41HWvxtB/pasted_image.png\"></a></div><p>I thought that maybe it wasn't able to differentiate between slices because Observation.code is bound to a value set (extensible). But I'm pretty sure the same pattern works in a Composition.section.entry slice and there isn't an issue. (ETA: It's not quite the same pattern with the Composition.section.entry.slice because the type is Reference there whereas in the Bundle.entry it's Resource)</p>\n<p>So - not sure if this is the same issue, but it's similar?</p>",
        "id": 185164285,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1578522586
    },
    {
        "content": "<p>seems similar.</p>",
        "id": 185166840,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578524257
    },
    {
        "content": "<p>I noticed today that <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> has done something similar in the IPS implementation guide for a Composition Bundle. SO I am going to look into that. He doesn't get any informational or warnings.</p>",
        "id": 185166935,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578524325
    },
    {
        "content": "<p>Funny, I just looked at his IG too - saw a commit message that made me think it might be similar. But I can't see a Bundle profile in that IG. There is a Composition that slices on section.entry, but it's not quite the same - and the slicing there has always worked fine (reference vs resource maybe).</p>",
        "id": 185169990,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1578527092
    },
    {
        "content": "<p>Right.  We do use Bundle in IPS, but it's the base and didn't see a need to profile it.  The IPS Composition profile is working, as you both described.  Is it possible to profile Composition (doesn't necessarily need to be a \"document\") for what you're doing, <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span>?</p>",
        "id": 185171372,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1578528299
    },
    {
        "content": "<p>I have an equivalent in that I have  in the MHD transaction (Bundle) there MUST be one and only one DocumentManifest, and that DocumentManifest is similar to Composition in that it  links to everything else... However the IHE MHD specification requires that some of these references to within and some are allowed to be external..  <br>\nI tried that with a \"degenerate\" profile and example -- see <a href=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-UN3UJS_repo_input_examples_pdb-degenerateSubmission\" target=\"_blank\" title=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-UN3UJS_repo_input_examples_pdb-degenerateSubmission\">http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-UN3UJS_repo_input_examples_pdb-degenerateSubmission</a></p>",
        "id": 185173999,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578530998
    },
    {
        "content": "<p>I'm not sure I follow all this. Can you make a test case? E.g. a profile, and a bundle that fails the profile, with a reason why?</p>",
        "id": 185469184,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578898583
    },
    {
        "content": "<p>I'll create a test case tomorrow...</p>",
        "id": 185469546,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1578899249
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> my MHD ig has this problem.</p>",
        "id": 185497200,
        "sender_full_name": "John Moehrke",
        "timestamp": 1578925536
    },
    {
        "content": "<p>where?</p>",
        "id": 185529960,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578944826
    },
    {
        "content": "<p>I am trying to slice in a Bundle to assure that it has ONE DocumentManifest profiled according to a profile in my IG. I have the following slice in my profile on Bundle, but it doesn't seem to work.<br>\n        &lt;element id=\"Bundle.entry\"&gt;<br>\n            &lt;path value=\"Bundle.entry\" /&gt;<br>\n            &lt;slicing&gt;<br>\n                &lt;discriminator&gt;<br>\n                    &lt;type value=\"profile\" /&gt;<br>\n                    &lt;path value=\"$this.resource\" /&gt;<br>\n                &lt;/discriminator&gt;<br>\n                &lt;description value=\"Everything in a proper Bundle\"/&gt;<br>\n                &lt;ordered value=\"false\"/&gt;<br>\n                &lt;!-- TODO: This should be closed, but because of the warnings on DocumentReference not being found I need to leave it open --&gt;<br>\n                &lt;rules value=\"open\" /&gt;<br>\n            &lt;/slicing&gt;<br>\n        &lt;/element&gt;<br>\n        &lt;element id=\"Bundle.entry:ManifestSlice\"&gt;<br>\n            &lt;path value=\"Bundle.entry\" /&gt;<br>\n            &lt;sliceName value=\"ManifestSlice\" /&gt;<br>\n            &lt;short value=\"Manifest Slice\" /&gt;<br>\n            &lt;definition value=\"The DocumentManifest defining this submission.\"/&gt;<br>\n            &lt;alias value=\"SubmissionSet\" /&gt;<br>\n            &lt;min value=\"1\" /&gt;<br>\n            &lt;max value=\"1\" /&gt;<br>\n        &lt;/element&gt;<br>\n        &lt;element id=\"Bundle.entry:ManifestSlice.resource\"&gt;<br>\n            &lt;path value=\"Bundle.entry.resource\" /&gt;<br>\n            &lt;min value=\"1\" /&gt;<br>\n            &lt;type&gt;<br>\n                &lt;code value=\"Reference\" /&gt;<br>\n                &lt;profile value=\"<a href=\"http://ihe.net/fhir/ihe.mhd.fhir/StructureDefinition/IHE.MHD.Minimal.DocumentManifest\" target=\"_blank\" title=\"http://ihe.net/fhir/ihe.mhd.fhir/StructureDefinition/IHE.MHD.Minimal.DocumentManifest\">http://ihe.net/fhir/ihe.mhd.fhir/StructureDefinition/IHE.MHD.Minimal.DocumentManifest</a>\" /&gt;<br>\n            &lt;/type&gt;<br>\n        &lt;/element&gt;</p>",
        "id": 185656066,
        "sender_full_name": "John Moehrke",
        "timestamp": 1579047636
    },
    {
        "content": "<p>should be type=type, not type = profile</p>",
        "id": 185657480,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579049214
    },
    {
        "content": "<p>tried that still not finding the DocumentManifest that is in the example</p>",
        "id": 185657877,
        "sender_full_name": "John Moehrke",
        "timestamp": 1579049690
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-OG2IBB_repo_input_examples_pdb-degenerateSubmission\" target=\"_blank\" title=\"http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-OG2IBB_repo_input_examples_pdb-degenerateSubmission\">http://build.fhir.org/ig/IHE/ITI.MHD/branches/master/qa.html#_scratch_ig-build-temp-OG2IBB_repo_input_examples_pdb-degenerateSubmission</a></p>",
        "id": 185657902,
        "sender_full_name": "John Moehrke",
        "timestamp": 1579049745
    },
    {
        "content": "<p>Sorry <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - I meant to create an example for this yesterday... </p>\n<p>I tried every single permutation and combination of discriminator type and path and finally ended up wtih profile/resource. <br>\nAnd the only way that combination worked was if I hard coded meta.profile in the Observation profile that is referenced by the slice. (The code on the Observation comes from a value set that is extensibly bound).</p>\n<p>This bundle profile works and the example doesn't error (with the meta.profile hack) <a href=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TobaccoUseCessationReferralSupportingInformation.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TobaccoUseCessationReferralSupportingInformation.html\">http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TobaccoUseCessationReferralSupportingInformation.html</a> <br>\nand here is the Observation that I put the meta.profile hard coded onto: <a href=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TelcomCommunicationPreferences.html#tabs-diff\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TelcomCommunicationPreferences.html#tabs-diff\">http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-TelcomCommunicationPreferences.html#tabs-diff</a><br>\nThe example QA: <a href=\"http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-tobacco-referral-eve-everywoman\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-tobacco-referral-eve-everywoman\">http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-tobacco-referral-eve-everywoman</a></p>\n<p>I've edited this bundle profile (<a href=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-DiabetesPreventionReferralFeedbackSupportingInformation.html#tabs-diff\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-DiabetesPreventionReferralFeedbackSupportingInformation.html#tabs-diff\">http://build.fhir.org/ig/HL7/bser/branches/master/StructureDefinition-BSeR-DiabetesPreventionReferralFeedbackSupportingInformation.html#tabs-diff</a>) to be type/$this.resource as you suggest, and removed the meta.profile constraint.<br>\nAnd the example errors: <a href=\"http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-diabetes-referral-feedback-eve-everywoman\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-diabetes-referral-feedback-eve-everywoman\">http://build.fhir.org/ig/HL7/bser/branches/master/qa.html#_scratch_ig-build-temp-M7QR6H_repo_source_resources_bundle_bundle-bser-diabetes-referral-feedback-eve-everywoman</a></p>",
        "id": 185662948,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579056229
    },
    {
        "content": "<p>hmm. I'm working on this. I'm going to use this test profile:</p>",
        "id": 185671967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579069287
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span>\n<span class=\"nt\">&lt;StructureDefinition</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;bundle-slice-profile-master&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/test/StructureDefinition/bundle-slice-profile-master&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;active&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;experimental</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;date</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2020-01-06&quot;</span> <span class=\"nt\">/&gt;</span>\n\n    <span class=\"nt\">&lt;fhirVersion</span> <span class=\"na\">value=</span><span class=\"s\">&quot;4.0.0&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;kind</span> <span class=\"na\">value=</span><span class=\"s\">&quot;resource&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;abstract</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;baseDefinition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;derivation</span> <span class=\"na\">value=</span><span class=\"s\">&quot;constraint&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;differential&gt;</span>\n<span class=\"c\">&lt;!-- slice definition for the Bundle content --&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;slicing&gt;</span>\n                <span class=\"nt\">&lt;discriminator&gt;</span>\n                    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;profile&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;$this.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/discriminator&gt;</span>\n                <span class=\"nt\">&lt;ordered</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;closed&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/slicing&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n<span class=\"c\">&lt;!-- Patient - a simply profiled resource --&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;elemen&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/test/StructureDefinition/bundle-slice-profile-patient&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n<span class=\"c\">&lt;!-- Observation1 - make sure can differentiate same type but different profile --&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Obs1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;elemen&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/test/StructureDefinition/bundle-slice-profile-obs1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n<span class=\"c\">&lt;!-- Observation2 - 2nd observation --&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Obs2&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;elemen&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/test/StructureDefinition/bundle-slice-profile-obs2&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n<span class=\"c\">&lt;!-- Procedure (base resource) --&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;elemen&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/Procedure&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;/differential&gt;</span>\n<span class=\"nt\">&lt;/StructureDefinition&gt;</span>\n</pre></div>",
        "id": 185671970,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579069291
    },
    {
        "content": "<p>that tests out the range of things we need to test, I think?</p>",
        "id": 185671974,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579069312
    },
    {
        "content": "<p>You might want to fix typo in &lt;elemen&gt;<br>\nI think that will do it... <br>\nThough one of the reasons I think mine is failing is because Observation.code of one of the slices is bound to a value set and the binding is extensible. Not sure if that has anything to do with it - but it doesn't seem to fail if Observation.code is a fixed value - so if you could make one of your obs similar...</p>",
        "id": 185672780,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579070529
    },
    {
        "content": "<p>no. profile testing simply didn't work on a direct resource boundary. I've been working on code and test cases for several hours now</p>",
        "id": 185673128,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579071154
    },
    {
        "content": "<p>Any ideas what is wrong? I've spent may hours trying to get it to work too...</p>",
        "id": 185673598,
        "sender_full_name": "Sarah Gaunt",
        "timestamp": 1579071955
    },
    {
        "content": "<p>we have slight variation on <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> testcase which works for document and I think should work also for a transaction</p>\n<div class=\"codehilite\"><pre><span></span>        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Bundle.entry&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;slicing&gt;</span>\n                <span class=\"nt\">&lt;discriminator&gt;</span>\n                    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;profile&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;resource&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/discriminator&gt;</span>\n                <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;open&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/slicing&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Bundle.entry:Composition&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Composition&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Composition&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Bundle.entry:Composition.resource&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry.resource&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Composition&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-composition&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>\n\n\n<p>test sample is here: <a href=\"http://build.fhir.org/ig/hl7ch/ch-core/branches/master/qa.html#_scratch_ig-build-temp-ZH5SXM_repo_examples_bundle_1-ZuweisungZurRadiologischenDiagnostik-FHIR\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7ch/ch-core/branches/master/qa.html#_scratch_ig-build-temp-ZH5SXM_repo_examples_bundle_1-ZuweisungZurRadiologischenDiagnostik-FHIR\">http://build.fhir.org/ig/hl7ch/ch-core/branches/master/qa.html#_scratch_ig-build-temp-ZH5SXM_repo_examples_bundle_1-ZuweisungZurRadiologischenDiagnostik-FHIR</a>, entry[0] is matched</p>",
        "id": 185674350,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1579072879
    },
    {
        "content": "<p>difference:</p>\n<ul>\n<li>discriminator path: resource instead of $this.resource</li>\n<li>type.code: resource name (Composition) instead of 'Resource'</li>\n</ul>",
        "id": 185674446,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1579072997
    },
    {
        "content": "<p>the validator will reject that now, after todays work .... code must be Resource</p>",
        "id": 185690203,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579088878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/profiling.20a.20transaction/near/185690203\">said</a>:</p>\n<blockquote>\n<p>the validator will reject that now, after todays work .... code must be Resource</p>\n</blockquote>\n<p>With the latest publisher (v1.1.35), there is an error (Profile <a href=\"http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-composition\">http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-composition</a> is for type Composition, but this element has type Resource) when we do it this way. Do we have to adjust our profile or is it an error in the publisher?</p>\n<div class=\"codehilite\"><pre><span></span><code>         &lt;element id=&quot;Bundle.entry&quot;&gt;\n            &lt;path value=&quot;Bundle.entry&quot; /&gt;\n            &lt;slicing&gt;\n                &lt;discriminator&gt;\n                    &lt;type value=&quot;profile&quot; /&gt;\n                    &lt;path value=&quot;resource&quot; /&gt;\n                &lt;/discriminator&gt;\n                &lt;rules value=&quot;open&quot; /&gt;\n            &lt;/slicing&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry:Composition&quot;&gt;\n            &lt;path value=&quot;Bundle.entry&quot; /&gt;\n            &lt;sliceName value=&quot;Composition&quot; /&gt;\n            &lt;short value=&quot;Composition&quot; /&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry:Composition.resource&quot;&gt;\n            &lt;path value=&quot;Bundle.entry.resource&quot; /&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;type&gt;\n                &lt;code value=&quot;Resource&quot; /&gt;\n                &lt;profile value=&quot;http://fhir.ch/ig/ch-core/StructureDefinition/ch-core-composition&quot; /&gt;\n            &lt;/type&gt;\n        &lt;/element&gt;\n</code></pre></div>",
        "id": 213392373,
        "sender_full_name": "Michaela Ziegler",
        "timestamp": 1602749675
    },
    {
        "content": "<p>oh dear I'm sorry</p>",
        "id": 213395513,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1602751612
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179252-IG-creation/topic/profiling.20a.20transaction/near/213395513\">said</a>:</p>\n<blockquote>\n<p>oh dear I'm sorry</p>\n</blockquote>\n<p>Does \"oh dear\" mean, that I have to change the profile?</p>\n<ul>\n<li>The discriminator of the slice will stay</li>\n<li>type.code will change from 'Resource' to 'Composition'</li>\n</ul>\n<p>Will that be the correct way how to do it?</p>",
        "id": 213430764,
        "sender_full_name": "Michaela Ziegler",
        "timestamp": 1602770943
    },
    {
        "content": "<p>no that's an oversight on my part. you don't need to  change anything</p>",
        "id": 213473298,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1602788843
    },
    {
        "content": "<blockquote>\n<p>the validator will reject that now, after todays work .... code must be Resource</p>\n</blockquote>\n<p>Sorry for resurrecting an old thread, but it appears that this may have implications for SUSHI (<a href=\"#narrow/stream/215610-shorthand/topic/Support.20for.20slicing.20with.20type.20code.20'Resource'.20and.20profile.20.3F\">SUSHI thread</a>). If SUSHI sees a FSH rule like <code>* entry.resource only MyObservationProfile</code>, then it will a) set the <code>type.code</code> to <code>Observation</code>, and b) set the <code>type.profile</code> to the canonical for <code>MyObservationProfile</code>. If you only allow that profile, I don't see why you <em>wouldn't</em> also narrow the <code>type.code</code> to be more specific. This might be helpful to human reviewers if the profile name doesn't so obviously mark its resource type -- and also potentially allows for more efficient processing if mismatched types can be outright rejected before even getting into the profile definition.</p>\n<p>But if I understand <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> correctly, he is saying that for some reason, narrowing <code>Resource</code> to <code>Observation</code> would fail validation of a slice that differentiates on type <code>profile</code>?  I don't understand why since it does not affect the set of valid instances at all. Grahame, did I understand you correctly, and if so, can you explain why this is the case?</p>",
        "id": 232265369,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1617023609
    },
    {
        "content": "<p>I'm not sure, the details have slipped from my mind. What's the current state of play?</p>",
        "id": 232341718,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1617054512
    }
]