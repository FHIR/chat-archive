[
    {
        "content": "<p>We like to host our own FHIR Terminology Server. According to the CapabilityStatement, <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> is run by the Reference Server. If so, is there an simple way to deploy the reference server, say through a Docker container? Or are there other options to run a Terminology Server?</p>",
        "id": 173126124,
        "sender_full_name": "Alexander Kiel",
        "timestamp": 1565711783
    },
    {
        "content": "<p>you can download and install it from <a href=\"http://www.healthintersections.com.au/FhirServer\" target=\"_blank\" title=\"http://www.healthintersections.com.au/FhirServer\">http://www.healthintersections.com.au/FhirServer</a>, but the process is not as smooth as it should be. Contributions welcome....</p>",
        "id": 173152818,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565731325
    },
    {
        "content": "<p>i did have a \"portable / no install\" version of the fhir server. is that useful?</p>",
        "id": 173168943,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565748557
    },
    {
        "content": "<p>Not sure. The install doesnâ€™t do that much</p>",
        "id": 173169447,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565749319
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Thanks. Does it only run under Windows or is Linux also possible with some work?</p>",
        "id": 173182779,
        "sender_full_name": "Alexander Kiel",
        "timestamp": 1565769770
    },
    {
        "content": "<p>it's possible, but it's more than a little work</p>",
        "id": 173184832,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565771884
    },
    {
        "content": "<p>According to <a href=\"https://wiki.hl7.org/Open_Source_FHIR_implementations\" target=\"_blank\" title=\"https://wiki.hl7.org/Open_Source_FHIR_implementations\">https://wiki.hl7.org/Open_Source_FHIR_implementations</a> there is not really an Open Source terminology server available. Is that right?</p>",
        "id": 173185851,
        "sender_full_name": "Alexander Kiel",
        "timestamp": 1565772988
    },
    {
        "content": "<p>I do not recall the details, but there is a VocabTxServer in Grahame's server tools that is open source</p>",
        "id": 173187300,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565774375
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197470\">@Alexander Kiel</span> what is your need? Perhaps we need the same thing at Belgium and then i can help with the effort of getting it running.</p>",
        "id": 173187418,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565774471
    },
    {
        "content": "<p>Currently I need ValueSet $expand to determine the CodeSystem of plain codes like gender with ValueSet binding. I like to host such a server myself because we also have our own custom ValueSets and I'm not sure whether <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> is considered production ready.</p>",
        "id": 173188204,
        "sender_full_name": "Alexander Kiel",
        "timestamp": 1565775203
    },
    {
        "content": "<p>Grahame can advise on the servers and the maturity, but I will take a look at the terminology server meanwhile</p>",
        "id": 173188439,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565775418
    },
    {
        "content": "<p>but AFAIK Grahame's open source server is the one that is running in <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a></p>",
        "id": 173188914,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565776023
    },
    {
        "content": "<ul>\n<li><a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> is fully open source</li>\n<li>The install is a little messy, yes, but it works otherwise</li>\n<li>the code is production ready from my pov.</li>\n<li>but <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> is not for production use; I (and <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> ) feel free to take it down at any time that suits us</li>\n</ul>",
        "id": 173239843,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565815033
    },
    {
        "content": "<p>Note that you need delphi to compile the server (the free version is sufficient). but the free version doesn't cover osx/unix - that's expensive. It's been my intent to get it compiling under freepascal / Lazarus, but there's a bit where it was supposed to work under fpc 3.0, but doesn't, and I haven't had time to get it sorted...</p>",
        "id": 173240110,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565815178
    },
    {
        "content": "<p>I've recently gone through the steps to get it set up and compile it, so if I can help with anything let me know.</p>",
        "id": 173245707,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565819468
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> Thanks for your work. I'll try to run the server from <a href=\"http://www.healthintersections.com.au/FhirServer/\" target=\"_blank\" title=\"http://www.healthintersections.com.au/FhirServer/\">http://www.healthintersections.com.au/FhirServer/</a> under Windows.</p>",
        "id": 173304882,
        "sender_full_name": "Alexander Kiel",
        "timestamp": 1565887455
    },
    {
        "content": "<p>I am getting an issue converting loinc cache. or using the cache already in the download page (v261).</p>",
        "id": 173647346,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1566298543
    },
    {
        "content": "<p>Not sure what you're trying to do, <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span>.</p>",
        "id": 173684846,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1566327114
    },
    {
        "content": "<p>Just trying to get the tx server to run locally. It says it needs the loinc cache which needs to be regenerated using serverutils.exe</p>",
        "id": 173685318,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1566327383
    },
    {
        "content": "<p>And I cannot walk through the code because the current commit has an issue (on my machine)</p>",
        "id": 173685410,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1566327451
    },
    {
        "content": "<p>Got it.   I've compiled but haven't tried to stand up an instance de novo, so hadn't run into that requirement.  Yes, you use the FhirServer Tools LOINC Import to create the LOINC cache (from the distribution).  I can help you work through that if you want.</p>",
        "id": 173791751,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1566392848
    },
    {
        "content": "<p>I would like that. Is there any functional description of what the terminology server does?</p>",
        "id": 174200235,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1566887295
    },
    {
        "content": "<p>for example, how does it fit in this<br>\n<a href=\"https://confluence.ihtsdotools.org/display/FHIR/Features+of+Known+Servers\" target=\"_blank\" title=\"https://confluence.ihtsdotools.org/display/FHIR/Features+of+Known+Servers\">https://confluence.ihtsdotools.org/display/FHIR/Features+of+Known+Servers</a></p>",
        "id": 174200255,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1566887338
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> I did what ou suggested (and IIRC i had successfully done before) but not it ain't working</p>",
        "id": 174390560,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567018142
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> FHIR.Server.Context.pas lines 323 (and 324 and 325) are missing something</p>",
        "id": 174390716,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567018234
    },
    {
        "content": "<p>(i think)</p>",
        "id": 174390723,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567018244
    },
    {
        "content": "<p>what i saw: Upon server initialisation, TxServerFormUnit calls <br>\n     ctxt := TFHIRServerContext.Create(store.Link, nil); <br>\n(line 427)</p>",
        "id": 174390908,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567018370
    },
    {
        "content": "<p>but TFHIRServerContext.Create needs serverFactory to be assigned:</p>\n<div class=\"codehilite\"><pre><span></span>constructor TFHIRServerContext.Create(storage: TFHIRStorageService; serverFactory : TFHIRServerFactory);\n...\n  FValidator := serverFactory.makeValidator;\n  FValidatorContext := FValidator.Context.link;\n  FIndexes := TFHIRIndexInformation.create(FValidatorContext.factory.link, ServerFactory.link);\n</pre></div>",
        "id": 174391187,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567018536
    },
    {
        "content": "<p>how are you running this?</p>",
        "id": 174393651,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567020349
    },
    {
        "content": "<p>Jose and I were just discussing getting together on Friday to go over the issues that he's having.  But if you have thoughts or solutions now that's great.</p>",
        "id": 174394110,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1567020662
    },
    {
        "content": "<p>not sure... I guess you're running the vocab server?</p>",
        "id": 174394511,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567020980
    },
    {
        "content": "<p>yes, trying to</p>",
        "id": 174398862,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567024512
    },
    {
        "content": "<p>ok I learned that I was talking about something different. I was looking at the Voc TX POC thing, ut i understand now that the terminology server features are built in the main FHIR server. is that correct?</p>",
        "id": 174698852,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567411774
    },
    {
        "content": "<p>it is. that should be what you generally use, not the vocab one, which is for a special purpose</p>",
        "id": 174708085,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567421941
    },
    {
        "content": "<p>ok thanks</p>",
        "id": 174708199,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567422032
    },
    {
        "content": "<p>It seems that the FHIR server configuration is changed (ini files etc). My \"PortableFhirServer\" no longer works...<br>\nI will try to get it back to a working state. Any advice what to look for?</p>",
        "id": 174779256,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567510234
    },
    {
        "content": "<p>I have made no changes in anything like that</p>",
        "id": 174818688,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567536942
    },
    {
        "content": "<p>ok i start digging</p>",
        "id": 174819662,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567537581
    },
    {
        "content": "<p>I try to install the terminology server (fhirserver 1.0.288) on Win 7 Enterprise and got some problems:</p>\n<p>First I installed the visual c++ redistributables which the installer recomments and rebooted the system, but vcredist is still not detected from the installer.</p>\n<p>After configuration of database-server the installer informs \"databse exists but is not initialized\". <br>\nThe 2 optional package for initialization of the database are not available (1 shows 'Socket error 10060' and 2 shows 'connection timeout'). We have a proxy server activated, could be the reason for this?</p>\n<p><a href=\"/user_uploads/10155/La9pwc_Quq9SooXSzC3bemSo/vc-not-detected.PNG\" target=\"_blank\" title=\"vc-not-detected.PNG\">vc-not-detected.PNG</a> <a href=\"/user_uploads/10155/JAN34BllTncJ01XjLPq7bMgq/db-init.PNG\" target=\"_blank\" title=\"db-init.PNG\">db-init.PNG</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/La9pwc_Quq9SooXSzC3bemSo/vc-not-detected.PNG\" target=\"_blank\" title=\"vc-not-detected.PNG\"><img src=\"/user_uploads/10155/La9pwc_Quq9SooXSzC3bemSo/vc-not-detected.PNG\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/JAN34BllTncJ01XjLPq7bMgq/db-init.PNG\" target=\"_blank\" title=\"db-init.PNG\"><img src=\"/user_uploads/10155/JAN34BllTncJ01XjLPq7bMgq/db-init.PNG\"></a></div>",
        "id": 174953676,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567671175
    },
    {
        "content": "<p>yes proxy server problem there. I'm not sure what do about that</p>",
        "id": 174954376,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567671862
    },
    {
        "content": "<p>i will ask someohne without proxy in  the network to try the installation. later we will run on a real server, i just want to tryout how dificult the installation is.</p>\n<p>i also got an error from MySQL-service (MySQL CE 5.7) because of the line<br>\ninnodb_flush_method = O_DIRECT</p>\n<p>which is described in the manual <a href=\"http://www.healthintersections.com.au/wiki/index.php?title=Install_FHIR_server_with_MySQL\" target=\"_blank\" title=\"http://www.healthintersections.com.au/wiki/index.php?title=Install_FHIR_server_with_MySQL\">http://www.healthintersections.com.au/wiki/index.php?title=Install_FHIR_server_with_MySQL</a> under <br>\nsection 2b.</p>\n<p>error-message in windows-log was: InnoDB: Unrecognized value O_DIRECT for innodb_flush_method</p>\n<p>I removed this line and hope it is not very importend</p>",
        "id": 174955173,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567672688
    },
    {
        "content": "<p>innodb_flush_method should not matter</p>",
        "id": 174958831,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567676887
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"236913\">@Christoph Dolch</span> are you using mysql or mariadb?</p>",
        "id": 174958864,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567676940
    },
    {
        "content": "<p>I think my recent issues may also be due to the database/odbc/vc++redist... stack. I will investigate</p>",
        "id": 174959005,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567677110
    },
    {
        "content": "<p>I have no idea what innodb_flush_method is or where it enters the picture</p>",
        "id": 174960313,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567678444
    },
    {
        "content": "<p>it is for the mysql / mariadb setup</p>",
        "id": 174962341,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567680835
    },
    {
        "content": "<p>but is it from something we do? where?</p>",
        "id": 174962440,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567680926
    },
    {
        "content": "<p>when i was starting to use mysql there was some tuning needed in my.ini, so I guess that is just a copy-paste leftover. I remember I trimmed down as much as possible at the time.</p>",
        "id": 174962449,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567680936
    },
    {
        "content": "<p>but we don't make up my.ini?</p>",
        "id": 174962472,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567680952
    },
    {
        "content": "<p>It was written in the instructions. We could, i hadn't thought of it</p>",
        "id": 174962534,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567680980
    },
    {
        "content": "<p>(i presume you are talking about creating the my.ini from code / during the installer..?)</p>",
        "id": 174962546,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567680996
    },
    {
        "content": "<p>im using mysql</p>",
        "id": 174962554,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567681006
    },
    {
        "content": "<p>ok i will see if I can get it working. which mysql version?</p>",
        "id": 174962586,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567681048
    },
    {
        "content": "<p>(not sure if I can do something today, though.)</p>",
        "id": 174962649,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567681087
    },
    {
        "content": "<p>i use MySQL 5.2.27</p>",
        "id": 174962766,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567681213
    },
    {
        "content": "<p>oh and one thing: this was optimized for mariadb which at the time had a really stupid bug</p>",
        "id": 174962824,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567681296
    },
    {
        "content": "<p>you may want to remove <br>\noptimizer_switch=orderby_uses_equalities=off</p>",
        "id": 174962841,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567681313
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"236913\">@Christoph Dolch</span> I can't find that version of mysql to test. can you send me a link where you downloaded it?</p>",
        "id": 174965997,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567684581
    },
    {
        "content": "<p><a href=\"https://dev.mysql.com/downloads/file/?id=487685\" target=\"_blank\" title=\"https://dev.mysql.com/downloads/file/?id=487685\">https://dev.mysql.com/downloads/file/?id=487685</a></p>",
        "id": 174966866,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567685359
    },
    {
        "content": "<p>ah 5.7.27 :)</p>",
        "id": 174967877,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567686199
    },
    {
        "content": "<p>ah, sorry, typo, not 5.2.27, yes 5.7.27</p>",
        "id": 174968964,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567687176
    },
    {
        "content": "<p>ok i have an issue with the connection on my end.</p>",
        "id": 174992466,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567702021
    },
    {
        "content": "<p>i think it may be due to the VcRedist stuff (they come out as not detected)</p>",
        "id": 174992489,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567702040
    },
    {
        "content": "<p>this was working a long time ago so I do not know what changed. Possibly my PC has updated something. <br>\nI will check my other servers to see if they work and go from there.</p>",
        "id": 174992620,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567702141
    },
    {
        "content": "<p>so <span class=\"user-mention\" data-user-id=\"236913\">@Christoph Dolch</span> I am one step behind you and I cannot help more today. sorry</p>",
        "id": 174992651,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567702178
    },
    {
        "content": "<h1>DeathByODBC...</h1>",
        "id": 175020497,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722377
    },
    {
        "content": "<p>?</p>",
        "id": 175020507,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567722391
    },
    {
        "content": "<p>I think the mother of all my issues today is the ODBC + VCRedist that we need for ODBC...</p>",
        "id": 175020541,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722425
    },
    {
        "content": "<p>I'm on it but will have to continue tomorrow.</p>",
        "id": 175020562,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722449
    },
    {
        "content": "<p>this don't work:<br>\n<a href=\"/user_uploads/10155/JXNF8btePAGbm65EYJgnf0WE/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/JXNF8btePAGbm65EYJgnf0WE/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/JXNF8btePAGbm65EYJgnf0WE/pasted_image.png\"></a></div>",
        "id": 175020652,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722507
    },
    {
        "content": "<p>direct works<br>\n<a href=\"/user_uploads/10155/PBgqCJ7dd8OcUed5CtlJaId2/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/PBgqCJ7dd8OcUed5CtlJaId2/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/PBgqCJ7dd8OcUed5CtlJaId2/pasted_image.png\"></a></div>",
        "id": 175020684,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722547
    },
    {
        "content": "<p>and obcd itself says it's ok<br>\n<a href=\"/user_uploads/10155/N1YOFqOuAftVTk9KWxI9cqaq/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/N1YOFqOuAftVTk9KWxI9cqaq/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/N1YOFqOuAftVTk9KWxI9cqaq/pasted_image.png\"></a></div>",
        "id": 175020782,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567722614
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"236913\">@Christoph Dolch</span> did you fix your issue?</p>",
        "id": 175044522,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567757860
    },
    {
        "content": "<p>not yet.</p>",
        "id": 175046642,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567759902
    },
    {
        "content": "<p>is this a proxy thing?</p>",
        "id": 175048296,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567761926
    },
    {
        "content": "<p>(as in : confirmed there is a proxy issue? Or do you want to do some manual tests?)</p>",
        "id": 175048309,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567761957
    },
    {
        "content": "<p>i think i can guide you through some of the steps. I still have some issues on my run but those are now just a config thing</p>",
        "id": 175048376,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567762011
    },
    {
        "content": "<p>it seen that the problem with the database initialisation <br>\n<a href=\"/user_uploads/10155/0umP4_8vEodz0MKdSeO4FZe8/db-init.PNG\" target=\"_blank\" title=\"db-init.PNG\">db-init.PNG</a> <br>\nis a proxy thing</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/0umP4_8vEodz0MKdSeO4FZe8/db-init.PNG\" target=\"_blank\" title=\"db-init.PNG\"><img src=\"/user_uploads/10155/0umP4_8vEodz0MKdSeO4FZe8/db-init.PNG\"></a></div>",
        "id": 175048959,
        "sender_full_name": "Christoph Dolch",
        "timestamp": 1567762608
    },
    {
        "content": "<p>i am getting this screen now<br>\n<a href=\"/user_uploads/10155/NySb2EP4DrD3kjQHMyndi-La/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/NySb2EP4DrD3kjQHMyndi-La/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/NySb2EP4DrD3kjQHMyndi-La/pasted_image.png\"></a></div>",
        "id": 175055389,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567769234
    },
    {
        "content": "<p>this is because I selected the tx package</p>",
        "id": 175055393,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567769245
    },
    {
        "content": "<p>ok i se a few things:</p>",
        "id": 175055502,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567769374
    },
    {
        "content": "<p>the installer runs on win32 architecture, which explains my problems. I had the ODBC stuff on 64.bit</p>",
        "id": 175055513,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567769398
    },
    {
        "content": "<p>so you may want to check if you are using a 32-bit stack completely. odbc+vcredist at least</p>",
        "id": 175055578,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567769436
    },
    {
        "content": "<p>yes the installer is win32 :-(</p>",
        "id": 175057091,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771061
    },
    {
        "content": "<p>Proxy is tough - I have to ask that in the installer and pass it through various interfaces</p>",
        "id": 175057113,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771082
    },
    {
        "content": "<p>could it be that it is trying to init the DB and gets the error i had<br>\nEDefinitionException: Unknown base profile: \"<a href=\"http://hl7.org/fhir/StructureDefinition/Composition\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Composition\">http://hl7.org/fhir/StructureDefinition/Composition</a>\"<br>\nand then thinks it is a connection issue?</p>",
        "id": 175057973,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567771822
    },
    {
        "content": "<p>no.</p>",
        "id": 175057995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771857
    },
    {
        "content": "<p>that one is gone if you use the latest code anyway</p>",
        "id": 175058020,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771865
    },
    {
        "content": "<p>i was going to build a new installer to send to <span class=\"user-mention\" data-user-id=\"236913\">@Christoph Dolch</span> with the latest changes</p>",
        "id": 175058077,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567771898
    },
    {
        "content": "<p>i am not sure I have everything in place to do that, but I am almost done building stuff</p>",
        "id": 175058125,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567771923
    },
    {
        "content": "<p>do you have anything to commit? I can build a new release</p>",
        "id": 175058149,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771927
    },
    {
        "content": "<p>have you ever built the installer before? it's a pretty big task</p>",
        "id": 175058182,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771972
    },
    {
        "content": "<p>i did, for the dependencies check (not my best work, i admit.. ) <br>\nbut building installer is ok even if risky (it is a pretty big checklist indeed)</p>",
        "id": 175058277,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567772057
    },
    {
        "content": "<p>i am now working to see why my fhirserver.exe for 64 bit ends up with 172 MB. must be the optimisation things that i did not set correctly</p>",
        "id": 175058340,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567772136
    },
    {
        "content": "<p>73 MB now. that's better</p>",
        "id": 175058475,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567772265
    },
    {
        "content": "<p>debugging installer, to me it fails here:<br>\nmsg := MyDllInstallDatabase(ExpandConstant('{app}')+'\\fhirserver.exe', ExpandConstant('{app}')+'\\fhirserver.ini', pw, 'r4', pl2, mode, @InitCallback)</p>",
        "id": 175060195,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567773766
    },
    {
        "content": "<p>with values:</p>\n<div class=\"codehilite\"><pre><span></span>msg := MyDllInstallDatabase(&#39;C:\\Program Files\\FHIRServer\\fhirserver.exe&#39;, &#39;C:\\Program Files\\FHIRServer\\fhirserver.ini&#39;, &#39;x&#39;, &#39;r4&#39;, &#39;,hl7.fhir.core#4.0.0&#39;, &#39;open&#39;, @InitCallback)\n</pre></div>",
        "id": 175060462,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567773995
    },
    {
        "content": "<p>so, a few things I see here: <br>\n1. in my case the server admin password is \"x\". But my db password is \"pass\". It seems the parameter in the function call should be the DB password, and not the server admin password, right?</p>",
        "id": 175063307,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567776005
    },
    {
        "content": "<p>2. I don't like the comma in ',hl7.fhir.core#4.0.0'</p>",
        "id": 175063339,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567776047
    },
    {
        "content": "<p>3. </p>\n<div class=\"codehilite\"><pre><span></span>MyDllDownloadPackages(&#39;system&#39;, pl2, @InitCallback)\n</pre></div>\n\n\n<p>also fails. <br>\n<a href=\"/user_uploads/10155/bhLvsoVZ2mf3D84DSyPkLpSZ/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/bhLvsoVZ2mf3D84DSyPkLpSZ/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/bhLvsoVZ2mf3D84DSyPkLpSZ/pasted_image.png\"></a></div>",
        "id": 175063708,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567776258
    },
    {
        "content": "<p>where did the h in hl7 go? is that a pchar/string thing?</p>",
        "id": 175063770,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567776313
    },
    {
        "content": "<p>password is the server admin password; the database password is already in the ini file</p>",
        "id": 175098815,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567800231
    },
    {
        "content": "<p>the comma is ok. I think</p>",
        "id": 175098826,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567800237
    },
    {
        "content": "<p>but the hl7 thing... maybe there is a problem around the comma</p>",
        "id": 175098879,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567800255
    },
    {
        "content": "<p>ok. I can confirm that the installer is where i have the connection issue. The server itself is almost fine</p>",
        "id": 175099112,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567800465
    },
    {
        "content": "<p>almost= if I run the server without installing, then the server starts ok but has no resources, and the capabilitystatement says only reads are allowed. no create or update</p>",
        "id": 175099202,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567800515
    },
    {
        "content": "<p>the missing h was my bad. I hadn't realised that the list of packages always starts with a comma and you remove it in the DLL (clever but derailed my brain)</p>",
        "id": 175134876,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567850914
    },
    {
        "content": "<p>...and there's something wrong with that thing. the comma may not be welcome in the \"install databases\" part. I am looking at it</p>",
        "id": 175135450,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567852148
    },
    {
        "content": "<p>apparently comma is ok. I have one issue that I cannot work around: there is a transaction  timeout somwhere when installing the r4 package</p>",
        "id": 175141003,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567863288
    },
    {
        "content": "<p>I committed some changes to installer - the download urls were hardcoded - so that would not work well</p>",
        "id": 175141018,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567863341
    },
    {
        "content": "<p>for the lock / transaction timeout, I will try with another DB server</p>",
        "id": 175141058,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567863364
    },
    {
        "content": "<p>no luck. <br>\nSo: the comma/ missing \"h\" is OK (there is always a comma, but it has no impact. the missing H was that I had removed the first comma in the string and the DLL removed the first character as expected. Now it works.)</p>",
        "id": 175149927,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567879777
    },
    {
        "content": "<p>I have an issue with a transaction on mariaDB (presumably also mysql) during initialisation of r4 database. it seems the transaction is  never committed, and eventually the DB server gives up. I think I will need help for that.</p>",
        "id": 175149992,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567879880
    },
    {
        "content": "<p>and the installer is not recognizing the database for some reason. Says it cannot connect. When i do it manually outside the installer,it connects ok (except for the timeout that i mention above)</p>",
        "id": 175150037,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567879925
    },
    {
        "content": "<p>why change FastMM_FullDebugMode to FastMM_FullDebugMode64? that's wrong</p>",
        "id": 175154997,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567889377
    },
    {
        "content": "<blockquote>\n<p>I have an issue with a transaction on mariaDB (presumably also mysql) during initialisation of r4 database. it seems the transaction is never committed, and eventually the DB server gives up. I think I will need help for that</p>\n</blockquote>\n<p>What's your evidence?</p>",
        "id": 175155107,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567889552
    },
    {
        "content": "<blockquote>\n<p>why change FastMM_FullDebugMode to FastMM_FullDebugMode64? that's wrong</p>\n</blockquote>\n<p>Right. In my machine i did not have the 32 and 64 execs and dll so i think i just changed it without thinking</p>",
        "id": 175167749,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567915787
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>MariaDB [(none)]&gt; SHOW PROCESSLIST;\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+-----------------------------------------------------------+----------+\n| Id | User        | Host                              | db     | Command | Time | State                    | Info                                                      | Progress |\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+-----------------------------------------------------------+----------+\n|  1 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge coordinator | NULL                                                      |    0.000 |\n|  3 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  4 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  2 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  5 | system user |                                   | NULL   | Daemon  | NULL | InnoDB shutdown handler  | NULL                                                      |    0.000 |\n| 16 | sa          | fe80::20e4:bdf7:9d4:16c0%34:54568 | fhirdb | Sleep   |  458 |                          | NULL                                                      |    0.000 |\n| 17 | sa          | fe80::20e4:bdf7:9d4:16c0%34:54575 | fhirdb | Query   |  458 | Updating                 | Update Types set LastId = 201 where ResourceTypeKey = 108 |    0.000 |\n| 19 | sa          | ::1:54591                         | NULL   | Query   |    0 | Init                     | SHOW PROCESSLIST                                          |    0.000 |\n| 20 | sa          | fe80::20e4:bdf7:9d4:16c0%34:54595 | fhirdb | Sleep   |  345 |                          | NULL                                                      |    0.000 |\n</pre></div>",
        "id": 175167791,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567915829
    },
    {
        "content": "<p>the \"Update Types set LastId = 201 where ResourceTypeKey = 108\" is there forever and I cannot find out why</p>",
        "id": 175167800,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567915878
    },
    {
        "content": "<p>at the time this happens, the server is showing this</p>\n<div class=\"codehilite\"><pre><span></span>##&gt; 60 Process hl7.fhir.core#4.0.0 CarePlan/gpvisit\n15:23:52 49: CarePlan/gpvisit\n##&gt; 60 Process hl7.fhir.core#4.0.0 CatalogEntry/example\n15:23:52 50: CatalogEntry/example\n##&gt; 60 Process hl7.fhir.core#4.0.0 Claim/100150\n15:23:52 51: Claim/100150\n##&gt; 60 Process hl7.fhir.core#4.0.0 Claim/100152\n15:23:52 52: Claim/100152\n</pre></div>\n\n\n<p>and does not move forward</p>",
        "id": 175167845,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567915947
    },
    {
        "content": "<p>I could not track where this happens in the code</p>",
        "id": 175167950,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567916162
    },
    {
        "content": "<p>deadlock?</p>",
        "id": 175175496,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567930548
    },
    {
        "content": "<p>hmm</p>",
        "id": 175175499,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567930555
    },
    {
        "content": "<p>I will try and find time to investigate tomorrow</p>",
        "id": 175175529,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567930563
    },
    {
        "content": "<p>thanks. or we can look at this in Atlanta if you have time</p>",
        "id": 175175543,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567930622
    },
    {
        "content": "<p>perhaps easier, since I have the whole setup and perhaps you can spot something easily</p>",
        "id": 175175551,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567930659
    },
    {
        "content": "<p>whole setup = this happens on mariadb. I can try tomorrow to see if i have the same with mysql</p>",
        "id": 175175593,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567930705
    },
    {
        "content": "<p>btw, do you want me to revert the  FastMM_FullDebugMode64 thing? i can quickly commit now</p>",
        "id": 175175613,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567930762
    },
    {
        "content": "<p>actually, the last change I made yesterday might  do this. Look in resolveReferenceForIndexing( in FHIR.Server.Database, and put a break point on FRepository.DB.GetConnection('Indexing Lookup') - if that fires just before it hangs.... then I know what the problem is (but not the solution)</p>",
        "id": 175175614,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567930767
    },
    {
        "content": "<p>and yes please revert it</p>",
        "id": 175175616,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567930770
    },
    {
        "content": "<p>what is \"just before it hangs\"?</p>",
        "id": 175176661,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567932890
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>MariaDB [(none)]&gt; show processlist;\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+-----------------------------------------------------------+----------+\n| Id | User        | Host                              | db     | Command | Time | State                    | Info                                                      | Progress |\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+-----------------------------------------------------------+----------+\n|  1 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge coordinator | NULL                                                      |    0.000 |\n|  2 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  3 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  4 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL                                                      |    0.000 |\n|  5 | system user |                                   | NULL   | Daemon  | NULL | InnoDB shutdown handler  | NULL                                                      |    0.000 |\n| 10 | root        | ::1:60026                         | NULL   | Query   |    0 | Init                     | show processlist                                          |    0.000 |\n| 21 | sa          | fe80::20e4:bdf7:9d4:16c0%34:61087 | fhirdb | Sleep   |   84 |                          | NULL                                                      |    0.000 |\n| 22 | sa          | fe80::20e4:bdf7:9d4:16c0%34:61107 | fhirdb | Query   |   84 | Updating                 | Update Types set LastId = 201 where ResourceTypeKey = 108 |    0.000 |\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+-----------------------------------------------------------+----------+\n8 rows in set (0.000 sec)\n</pre></div>",
        "id": 175176671,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567932914
    },
    {
        "content": "<p>after X seconds of inactivity, or when the db server gives a timeout?</p>",
        "id": 175176676,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567932954
    },
    {
        "content": "<p>before that. Just does the breakpoint fire?</p>",
        "id": 175177122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567933831
    },
    {
        "content": "<p>i am looking at thisÂ«</p>",
        "id": 175178118,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567935963
    },
    {
        "content": "<p>the breakpoint is never reached</p>",
        "id": 175178124,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567935980
    },
    {
        "content": "<p>problem is when indexing claim100152, and contained Practitioner provider-1</p>",
        "id": 175178134,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567936052
    },
    {
        "content": "<p>ok so before i get another BSOD,</p>",
        "id": 175179000,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567937859
    },
    {
        "content": "<p>stack:<br>\nFHIR.Server.Database.TFHIRNativeStorageService.NextResourceKeyGetId('Practitioner','')<br>\nFHIR.Server.Database.TFHIRNativeStorageService.GetNextKey(ktResource,'Practitioner','')<br>\nFHIR.Server.IndexingR4.TFhirIndexManager4.index($38A253B0,$1BE1A7F0,'Claim',66,0,$24014990,'care-team','')<br>\nFHIR.Server.IndexingR4.TFhirIndexManager4.evaluateByFHIRPath(66,$1BE1A7F0,$1BE1A7F0,$38A253B0)<br>\nFHIR.Server.IndexingR4.TFhirIndexManager4.execute(66,'100152',$1BE1A7F0,$3CA59790,$38A253B0)<br>\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteCreate($243E35B0,$38A253B0,$19A0EDA0,idMaybeNew,0)<br>\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteUpdate($243E35B0,$38A253B0,$19A0EDA0)<br>\nFHIR.Server.Database.TFHIRNativeOperationEngine.commitResource($38A253B0,$19A0EDA0,True,$391FAA40,52,$372BD3A0,$B43E720,$39518780)<br>\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteTransaction($1EFF5660,$38A253B0,$19A0EDA0)<br>\nFHIR.Server.Storage.TFHIROperationEngine.Execute($1EFF5660,$38A253B0,$19A0EDA0)<br>\nFHIR.Server.Web.TFhirWebServerEndpoint.ProcessRequest($1EFF5660,$38A253B0,$19A0EDA0)<br>\nFHIR.Server.Web.TFhirWebServerEndpoint.Transaction($B44CE60,True,'hl7.fhir.core#4.0.0','',(nil,nil))<br>\nFHIR.Server.Kernel.TFHIRService.Load('r4','hl7.fhir.core#4.0.0',ismOpenAccess)<br>\nFHIR.Server.Kernel.ExecuteFhirServer</p>",
        "id": 175179038,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567937884
    },
    {
        "content": "<p>it fails on <br>\nDB.ExecSQL('Update Types set LastId = '+inttostr(key)+' where ResourceTypeKey = '+inttostr(cfg.key), 'key-update');</p>",
        "id": 175179041,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567937896
    },
    {
        "content": "<p>for some reason at this mometn the database does not accept that</p>",
        "id": 175179049,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567937926
    },
    {
        "content": "<p>tried using another client, and if I issue the query at this moment, also crashes</p>",
        "id": 175179057,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567937955
    },
    {
        "content": "<p>breakpoint: FHIR.Server.IndexingR4,<br>\nline 1085, condition = key=66 <br>\n(that is the resource where the issue appears)</p>",
        "id": 175179122,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567938068
    },
    {
        "content": "<p>then the \"offending / offended\" line is FHIR.Server.Database, 6939</p>",
        "id": 175179166,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567938178
    },
    {
        "content": "<p>at this time, the database looks like this:</p>\n<div class=\"codehilite\"><pre><span></span>MariaDB [(none)]&gt; show processlist;\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+------------------+----------+\n| Id | User        | Host                              | db     | Command | Time | State                    | Info             | Progress |\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+------------------+----------+\n|  1 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge coordinator | NULL             |    0.000 |\n|  2 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL             |    0.000 |\n|  3 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL             |    0.000 |\n|  4 | system user |                                   | NULL   | Daemon  | NULL | InnoDB purge worker      | NULL             |    0.000 |\n|  5 | system user |                                   | NULL   | Daemon  | NULL | InnoDB shutdown handler  | NULL             |    0.000 |\n| 16 | sa          | fe80::20e4:bdf7:9d4:16c0%34:50436 | fhirdb | Sleep   |   97 |                          | NULL             |    0.000 |\n| 17 | sa          | fe80::20e4:bdf7:9d4:16c0%34:50440 | fhirdb | Sleep   |   97 |                          | NULL             |    0.000 |\n| 18 | root        | ::1:50481                         | NULL   | Query   |    0 | Init                     | show processlist |    0.000 |\n+----+-------------+-----------------------------------+--------+---------+------+--------------------------+------------------+----------+\n8 rows in set (0.000 sec)\n</pre></div>",
        "id": 175179332,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567938555
    },
    {
        "content": "<p>(so rather OK, it seems). Guess the problem is on my db setup</p>",
        "id": 175179334,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567938582
    },
    {
        "content": "<p>hmm remind me how it fails?</p>",
        "id": 175180441,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567940807
    },
    {
        "content": "<p>hanging, right? it really looks like a sql deadlock...</p>",
        "id": 175180443,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567940819
    },
    {
        "content": "<p>trying mysql.</p>",
        "id": 175182079,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567944417
    },
    {
        "content": "<p>mysql gives more info</p>\n<div class=\"codehilite\"><pre><span></span>14:43:00 52: Claim/100152\n14:43:58 EODBC: [MySQL][ODBC 5.3(w) Driver][mysqld-5.7.27]Lock wait timeout exceeded; try restarting transaction\n</pre></div>",
        "id": 175182087,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1567944450
    },
    {
        "content": "<p>still hanging... :(</p>",
        "id": 175216104,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568007465
    },
    {
        "content": "<p>you're installing R4, right?</p>",
        "id": 175216291,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568007841
    },
    {
        "content": "<p>yes</p>",
        "id": 175216343,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568007902
    },
    {
        "content": "<p>what's your command line parameters?</p>",
        "id": 175216471,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568008084
    },
    {
        "content": "<p>-cmd remount -password sa -ini \".\\fhirserver.ini\" -packages hl7.fhir.core#4.0.0 -endpoint r4 -mode open</p>",
        "id": 175216504,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568008177
    },
    {
        "content": "<p>\"sa\" is the admin password, not the DB password</p>",
        "id": 175216509,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568008192
    },
    {
        "content": "<p>k thx</p>",
        "id": 175216558,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568008227
    },
    {
        "content": "<p>it could be the problem is in my db setup.. but seems more likely in the application, no?</p>",
        "id": 175217017,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568009018
    },
    {
        "content": "<p>yes in the app. what's the last thing on the console when it hangs?</p>",
        "id": 175217076,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568009091
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>##&gt; 60 Process hl7.fhir.core#4.0.0 CarePlan/gpvisit\n15:23:52 49: CarePlan/gpvisit\n##&gt; 60 Process hl7.fhir.core#4.0.0 CatalogEntry/example\n15:23:52 50: CatalogEntry/example\n##&gt; 60 Process hl7.fhir.core#4.0.0 Claim/100150\n15:23:52 51: Claim/100150\n##&gt; 60 Process hl7.fhir.core#4.0.0 Claim/100152\n15:23:52 52: Claim/100152\n</pre></div>",
        "id": 175217101,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568009141
    },
    {
        "content": "<p>well, update and try again and see if you get any further</p>",
        "id": 175217166,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568009205
    },
    {
        "content": "<p>nope, still the same. <br>\nI guess you don't have the issue on your side, right?</p>",
        "id": 175217592,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568009954
    },
    {
        "content": "<p>I tried it out and fixed a couple of problems</p>",
        "id": 175217602,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568009989
    },
    {
        "content": "<p>what happens if you walk it from the point of that log message?</p>",
        "id": 175217604,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568010002
    },
    {
        "content": "<blockquote>\n<p>what happens if you walk it from the point of that log message?</p>\n</blockquote>\n<p>? you mean if i step through the code after it hangs?</p>",
        "id": 175217863,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568010367
    },
    {
        "content": "<p>that message is that last one before it hangs - so put an additional write for that particular message and break on it, and then step until you see go bang.</p>",
        "id": 175217945,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568010533
    },
    {
        "content": "<p>but i know the exact line where it hangs</p>",
        "id": 175218210,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568010907
    },
    {
        "content": "<p>oh? where?</p>",
        "id": 175218226,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568010940
    },
    {
        "content": "<p>(one sec, reassigning breaking points)</p>",
        "id": 175218300,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011058
    },
    {
        "content": "<p>but it was the \"update types\" query</p>",
        "id": 175218308,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011078
    },
    {
        "content": "<p>that doesn't give you a stack, right? you got that from the sql server tools</p>",
        "id": 175218364,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568011140
    },
    {
        "content": "<p>the stack is here</p>",
        "id": 175218374,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011157
    },
    {
        "content": "<p>server.database, line 6949 - is the offending line</p>",
        "id": 175218438,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011241
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>FHIR.Server.Database.TFHIRNativeStorageService.NextResourceKeyGetId(&#39;Practitioner&#39;,&#39;1&#39;)\nFHIR.Server.Database.TFHIRNativeStorageService.GetNextKey(ktResource,&#39;Practitioner&#39;,&#39;1&#39;)\nFHIR.Server.IndexingR4.TFhirIndexManager4.index($39047E20,$1BF392C0,&#39;Claim&#39;,66,0,$244035B0,&#39;care-team&#39;,&#39;&#39;)\nFHIR.Server.IndexingR4.TFhirIndexManager4.evaluateByFHIRPath(66,$1BF392C0,$1BF392C0,$39047E20)\nFHIR.Server.IndexingR4.TFhirIndexManager4.execute(66,&#39;100152&#39;,$1BF392C0,$3CC0C290,$39047E20)\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteCreate($2411AC00,$39047E20,$19B32B40,idMaybeNew,0)\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteUpdate($2411AC00,$39047E20,$19B32B40)\nFHIR.Server.Database.TFHIRNativeOperationEngine.commitResource($39047E20,$19B32B40,True,$394A49F0,52,$375FC450,$CD4E720,$398C63F0)\nFHIR.Server.Database.TFHIRNativeOperationEngine.ExecuteTransaction($1F4B8480,$39047E20,$19B32B40)\nFHIR.Server.Storage.TFHIROperationEngine.Execute($1F4B8480,$39047E20,$19B32B40)\nFHIR.Server.Web.TFhirWebServerEndpoint.ProcessRequest($1F4B8480,$39047E20,$19B32B40)\nFHIR.Server.Web.TFhirWebServerEndpoint.Transaction($CD5CE60,True,&#39;hl7.fhir.core#4.0.0&#39;,&#39;&#39;,(nil,nil))\n</pre></div>",
        "id": 175218453,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011266
    },
    {
        "content": "<p>i can send over a zipped version of my db if you want to see the fireworks and if you really want to help with this</p>",
        "id": 175218517,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011382
    },
    {
        "content": "<p>i have it running portable (and before you ask, i had mysql installed, also crashed)</p>",
        "id": 175218528,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568011412
    },
    {
        "content": "<p>ok update and try again and see if it's different</p>",
        "id": 175218643,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568011565
    },
    {
        "content": "<p>still same</p>",
        "id": 175219222,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568012426
    },
    {
        "content": "<p>really? weird</p>",
        "id": 175219333,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568012618
    },
    {
        "content": "<p>in the same place?</p>",
        "id": 175219337,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568012625
    },
    {
        "content": "<p>oh yes, it will be.</p>",
        "id": 175219562,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568012899
    },
    {
        "content": "<p>well, then, try again</p>",
        "id": 175220207,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1568013948
    },
    {
        "content": "<p>k, package does not get installed automatically when I do -cmd remount -packages hl7.fhir.core#4.0.0</p>",
        "id": 175725497,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568508590
    },
    {
        "content": "<p>is there a special command to get the package?</p>",
        "id": 175725540,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568508608
    },
    {
        "content": "<p>i.e. a command line option for the server or something else like a curl..?</p>",
        "id": 175726517,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568510501
    }
]