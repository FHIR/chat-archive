[
    {
        "content": "<p>I'm copying this to continue the thread from pm discussions on July 23-26:<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> <span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> </p>\n<blockquote>\n<p>Rob Hausam: I think it’s pretty close on FPC, though, as I can compile and run the console there. Will need to get that working. Or use a Windows machine for the moment.</p>\n<p>Grahame Grieve: It compiles on fpc for me but you must have the trunk version</p>\n<p>Jose Costa Teixeira: Trunk of FPC, of Lazarus, or trunk of the server code?</p>\n<p>Rob Hausam: We've been installing FPC and Lazarus via fpcupdeluxe, installing from trunk but also the specific revisions 47781 for FPC and 64209 for Lazarus. That was what worked previously, but maybe it's moved on since - maybe it's best now to update to the latest trunk revisions of both. I may try doing that, and see how it goes.</p>\n<p>Grahame Grieve: Perhaps you should give me details of what the compile problems are</p>\n<p>Rob Hausam: @Grahame Grieve I don't have any compile problems with it now. I'm able to compile fhirserver on Win 64 with the latest trunk versions of FPC/Lazarus. I just had to explicitly add the paths for the units for a number of the tests to get that working. And I've copied the same cfg and other files for the db, etc., including 'tzdata.tar.gz', but when I try to launch the server I'm getting: <code>TTZException: Zone not found []</code> then it immediately dies.</p>\n<p>Grahame Grieve: Have to debug that one - I’ve never seen it</p>\n<p>Rob Hausam: @Grahame Grieve I've been able to partly work around that, but there seems to be some issues with fsl_utilities and/or PascalTZ on FPC. To get part the initial timezone issue I commented out the lines for 'initializeTZData' and setting 'tz := TimeZoneBias;' and hardcoded it to UTC with 'tz := 0;', which worked for that part:<br>\n<a href=\"/user_uploads/10155/A-kfSd3Rn3CGXcDbsNqD6SQp/Screen-Shot-2021-07-26-at-09.52.41.png\">Screen-Shot-2021-07-26-at-09.52.41.png</a><br>\nBut when it's loading the r4 endpoint it runs into timezone issues again.  When I step into line 147 I get this exception in upascaltz.pas:<br>\n<a href=\"/user_uploads/10155/B77nVT1PFwrdcN1tb79rdNe-/Screen-Shot-2021-07-26-at-09.46.54.png\">Screen-Shot-2021-07-26-at-09.46.54.png</a></p>\n<p>There are also some weird issues with ODBC, which mainly seem to be about FPC not being able for some reason to correctly parse the 'db-type' from fhirserver.cfg.  It claims <code>Terminology Server using Unknown database type mysql</code>, even though it's set to <code>mysql</code> in the cfg file (and that works in Delphi).<br>\n<a href=\"/user_uploads/10155/2D9M4D8U8yN6ee1tS5DRCLEe/Screen-Shot-2021-07-26-at-10.10.13.png\">Screen-Shot-2021-07-26-at-10.10.13.png</a><br>\nThe current cfg file is: <a href=\"/user_uploads/10155/8yYBAq4FC1Kx8hzDi2apcO97/fhirserver.cfg\">fhirserver.cfg</a></p>\n</blockquote>\n<p>It would be good if we can get this fully working on FPC/Lazaurus (or inform us if you already have).</p>",
        "id": 247967319,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627936165
    },
    {
        "content": "<p>I think the unknown type mysql is due to a typo</p>",
        "id": 247968996,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1627937025
    },
    {
        "content": "<p>I don't think so - but I'm double checking now, as I had an incorrect copy of the file shown before (that's why I removed it for the moment).</p>",
        "id": 247969108,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627937082
    },
    {
        "content": "<p>utilities.pas, lines 332 and 350,<br>\nthere's a part that reads <br>\n<code>sameText(details['type'].value, 'mysql')</code> - that should be <br>\n<code>sameText(details['db-type'].value, 'mysql')</code></p>",
        "id": 247969229,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1627937160
    },
    {
        "content": "<p>without that, this works for mssql (a few lines above you can see that for msswl the typo is not there</p>",
        "id": 247969335,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1627937204
    },
    {
        "content": "<p>I fixed that in my instance first, though - and I'll double check, too, that I actually did make that fix</p>",
        "id": 247969377,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627937235
    },
    {
        "content": "<p>the same cfg file and code worked for 'mysql' in Delphi, but not in FPC/Lazarus</p>",
        "id": 247969513,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627937298
    },
    {
        "content": "<p>I added the link to the cfg file in the post above.  I had fixed the syntax errors that you mentioned (should be 'db-type') in my copy that I was building.  That's also where I had to do an additional work-around to get as far with it as I did.</p>",
        "id": 247971363,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627938245
    },
    {
        "content": "<p>the cfg file seems fine</p>",
        "id": 247979525,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1627943626
    },
    {
        "content": "<p>yes</p>",
        "id": 248172718,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1627953262
    }
]