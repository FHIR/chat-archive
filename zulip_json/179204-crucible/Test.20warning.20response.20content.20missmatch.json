[
    {
        "content": "<p>I am getting a warning in the format tests: \"requested XML response does not match created resource\"</p>\n<p>Which is probably true, but I cannot figure out what misses. Crucible creates the patient as:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n      &lt;Patient\n          xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n          &lt;meta&gt;\n              &lt;tag&gt;\n                  &lt;system value=&quot;http://projectcrucible.org&quot;/&gt;\n                  &lt;code value=&quot;testdata&quot;/&gt;\n              &lt;/tag&gt;\n          &lt;/meta&gt;\n          &lt;name&gt;\n              &lt;family value=&quot;Emerald&quot;/&gt;\n              &lt;given value=&quot;Caro&quot;/&gt;\n          &lt;/name&gt;\n      &lt;/Patient&gt;\n</pre></div>\n\n\n<p>and I return:</p>\n<div class=\"codehilite\"><pre><span></span>      &lt;Patient\n          xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n          &lt;id value=&quot;ad27ea04-124f-424a-9ea7-a2c0f3717672&quot;&gt;&lt;/id&gt;\n          &lt;meta&gt;\n              &lt;versionId value=&quot;1&quot;&gt;&lt;/versionId&gt;\n              &lt;lastUpdated value=&quot;2019-03-25T12:59:28.489250+00:00&quot;&gt;&lt;/lastUpdated&gt;\n              &lt;tag&gt;\n                  &lt;system value=&quot;http://projectcrucible.org&quot;&gt;&lt;/system&gt;\n                  &lt;code value=&quot;testdata&quot;&gt;&lt;/code&gt;\n              &lt;/tag&gt;\n          &lt;/meta&gt;\n          &lt;name&gt;\n              &lt;family value=&quot;Emerald&quot;&gt;&lt;/family&gt;\n              &lt;given value=&quot;Caro&quot;&gt;&lt;/given&gt;\n          &lt;/name&gt;\n      &lt;/Patient&gt;\n</pre></div>\n\n\n<p>which is the same as far as I can tell /o\\ It all boils down to <a href=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83\" target=\"_blank\" title=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83\">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L83</a> but I do not know enough ruby to follow that. The permalink to the test is <a href=\"https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01\" target=\"_blank\" title=\"https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01\">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c98d0ac04ebd03124000013/format001/CT01</a></p>\n<p>Thank you!</p>",
        "id": 161641832,
        "sender_full_name": "Florian Apolloner",
        "timestamp": 1553519964
    },
    {
        "content": "<p>Thanks, this needs to be fixed.  That line calls this method: <a href=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309\" target=\"_blank\" title=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309\">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/format_test.rb#L309</a> , which then tells the underlying FHIR model library to compare the two resources, excluding any 'id' elements.  But it is valid to add other things in the meta element as well.  So either we should change that to exclude ['id', 'versionId', 'lastUpdated'] (and check to see if there is anything else that can change), or just do ['id','meta']</p>",
        "id": 161645620,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1553522464
    },
    {
        "content": "<p>Will update here when we resolve this.</p>",
        "id": 161645845,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1553522611
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 161645851,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1553522614
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"213323\">@Florian Apolloner</span> -- fixed this issue and things look good now.  Thanks for the report!  <a href=\"https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01\" target=\"_blank\" title=\"https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01\">https://projectcrucible.org/servers/5c89107d04ebd024be000000#5c9b8a4104ebd07a52000000/format001/CT01</a></p>",
        "id": 161865124,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1553697446
    },
    {
        "content": "<p>This also addresses 406 issue.  I agree that the test using hte ?_format param would make more sense if we also removed the Accept header, but what we are doing is technically valid still (_format should just override the header), and removing the Accept header would be complicated given the way our client is designed.</p>",
        "id": 161865418,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1553697629
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192576\">@Robert Scanlon</span> Thank you so far, it works as expected. Ah yes I understand that your client might make it hard. If it is easier would it be possible that you make your client send a proper Accept header and then just override _format to an invalid value? This way you should still be able to check the correctness (if the library allows for it)</p>",
        "id": 162024785,
        "sender_full_name": "Florian Apolloner",
        "timestamp": 1553845191
    }
]