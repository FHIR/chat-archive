[
    {
        "content": "<p>Hello guys! I'm running Crucible against Aidbox FHIR server and all of  'Base Resources' tests are failing on vread interaction, and I can't understand why. The permalink to one of failed tests is: <a href=\"https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device\" target=\"_blank\" title=\"https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device\">https://projectcrucible.org/servers/5c3c642504ebd041c500001a#5c51eb7a04ebd028cd000006/resourcetest_device/X040_Device</a></p>\n<p>UI says that failure reason is: \"Service did not respond with bundle\", but I'm pretty sure that response contains a valid history Bundle (you can see it in request inspector). Thanks in advance for any suggestions.</p>",
        "id": 157278207,
        "sender_full_name": "Mikhail Lapshin",
        "timestamp": 1548947370
    },
    {
        "content": "<p>The weird thing is that the history request is made using XML, but all the other requests are JSON. Attention <span class=\"user-mention\" data-user-id=\"192576\">@Robert Scanlon</span></p>",
        "id": 157286228,
        "sender_full_name": "Jason Walonoski",
        "timestamp": 1548953642
    },
    {
        "content": "<p>Hmmm, this error is generically \"for some reason I can't parse the response as a Bundle\".  It could be a structural issue with the XML, or it is missing required bundle fields.  The error message isn't very helpful</p>",
        "id": 157292383,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1548958539
    },
    {
        "content": "<p><a href=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406\" target=\"_blank\" title=\"https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406\">https://github.com/fhir-crucible/plan_executor/blob/master/lib/tests/suites/resource_test.rb#L406</a></p>",
        "id": 157292390,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1548958546
    },
    {
        "content": "<p>As soon as I have a chance I'll try loading it up directly through the fhir models to see if I can get more specifics: <a href=\"https://github.com/fhir-crucible/fhir_models#resource-basics\" target=\"_blank\" title=\"https://github.com/fhir-crucible/fhir_models#resource-basics\">https://github.com/fhir-crucible/fhir_models#resource-basics</a></p>",
        "id": 157292669,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1548958768
    },
    {
        "content": "<p>And we'll have to investigate why the client is doing xml in that case as well.  That is strange.</p>",
        "id": 157292688,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1548958791
    },
    {
        "content": "<blockquote>\n<p>As soon as I have a chance I'll try loading it up directly through the fhir models to see if I can get more specifics: <a href=\"https://github.com/fhir-crucible/fhir_models#resource-basics\" target=\"_blank\" title=\"https://github.com/fhir-crucible/fhir_models#resource-basics\">https://github.com/fhir-crucible/fhir_models#resource-basics</a></p>\n</blockquote>\n<p>Just tried to do this and looks like XML file is parsed correctly into the FHIR::Bundfle instance. Here is the source XML document generated by Aidbox and the output of FHIR.from_contents() call:<br>\n<a href=\"https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04\" target=\"_blank\" title=\"https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04\">https://gist.github.com/mlapshin/e2a4c6b8d394c0701d4ca52a2763ca04</a> </p>\n<p>There are couple of strange log lines complaining about errors, but no exceptions at all.</p>",
        "id": 157356201,
        "sender_full_name": "Mikhail Lapshin",
        "timestamp": 1549031443
    },
    {
        "content": "<p>This is definitely a problem with Crucible.  We have actually fixed this in one of the underlying libraries already, but those changes haven't been deployed yet to <a href=\"http://projectcrucible.org\" target=\"_blank\" title=\"http://projectcrucible.org\">projectcrucible.org</a>.  I'll update this thread when we deploy the new version.  Thanks for your patience!</p>",
        "id": 157364936,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1549038398
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"192576\">@Robert Scanlon</span></p>",
        "id": 157365091,
        "sender_full_name": "Mikhail Lapshin",
        "timestamp": 1549038532
    },
    {
        "content": "<p>(if you would like to see it working right now, you can clone <a href=\"https://github.com/fhir-crucible/plan_executor\" target=\"_blank\" title=\"https://github.com/fhir-crucible/plan_executor\">plan_executor</a>, do <code>bundle install</code>, and then run <code>bundle exec rake crucible:execute[https://openedbox.aidbox.app/fhir/,:stu3,ResourceTest,Device]</code>)</p>",
        "id": 157365242,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1549038669
    },
    {
        "content": "<p>Looks like it's fixed in master:</p>\n<div class=\"codehilite\"><pre><span></span>ResourceTest_Device\n      PASS x000_read_type_test:\n      PASS x010_create_new_test: New Device was created.\n      PASS x012_conditional_create_(no_matches)_test: New Device was created.\n      PASS x013_conditional_create_(one_match)_test: Request was correctly ignored.\n      PASS x014_conditional_create_(multiple_matches)_test: Request correctly failed.\n      PASS x020_read_existing_test: Successfully read preexisting Device.\n      PASS x030_update_existing_test: Updated existing Device.\n      PASS x032_conditional_update_(no_matches)_test: New Device was created.\n      PASS x033_conditional_update_(one_match)_test: Updated existing Device.\n      PASS x034_conditional_update_(multiple_matches)_test: Request correctly failed.\n      PASS x040_read_history_of_existing_test: Service responded with bundle.\n      PASS x050_version_read_existing_test: Read current version of preexisting Device.\n      PASS x055_previous_version_read_existing_test: Read previous version of preexisting Device.\n      PASS x060_validate_test: Device was validated.\n      PASS x065_validate_existing_test: Existing Device was validated.\n      PASS x067_validate_against_a_profile_test: Device was validated.\n      PASS x070_delete_existing_test: Existing Device was deleted.\n      PASS x075_get_deleted_resource_test: Deleted Device was correctly reported as gone.\nExecute ResourceTest completed in 21.671793000015896 seconds.\n</pre></div>\n\n\n<p>Looking forward to see it deployed on <a href=\"http://projectcrucible.org\" target=\"_blank\" title=\"http://projectcrucible.org\">projectcrucible.org</a>.  Thanks for your cooperation, Robert!</p>",
        "id": 157528652,
        "sender_full_name": "Mikhail Lapshin",
        "timestamp": 1549292526
    }
]