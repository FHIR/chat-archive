[
    {
        "content": "<p>Hi,</p>\n<p>Im running the official HAPI JPA server v5.0.0 from docker hub. <br>\nWhile validating a Patient resource against a profile I get the following error:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;generated&quot;,\n    &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Failed to call access method: java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n  },\n  &quot;issue&quot;: [ {\n    &quot;severity&quot;: &quot;error&quot;,\n    &quot;code&quot;: &quot;processing&quot;,\n    &quot;diagnostics&quot;: &quot;Failed to call access method: java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0&quot;\n  } ]\n}\n</code></pre></div>\n\n\n<p>The logs show the following stack trace:</p>\n<div class=\"codehilite\"><pre><span></span><code>2020-09-15 09:48:40.979 [http-nio-8080-exec-4] ERROR c.u.f.r.s.i.ExceptionHandlingInterceptor [ExceptionHandlingInterceptor.java:140] Failure during REST processing\nca.uhn.fhir.rest.server.exceptions.InternalErrorException: Failed to call access method: java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\n    at ca.uhn.fhir.rest.server.method.BaseMethodBinding.invokeServerMethod(BaseMethodBinding.java:250)\n    at ca.uhn.fhir.rest.server.method.OperationMethodBinding.invokeServer(OperationMethodBinding.java:329)\n    at ca.uhn.fhir.rest.server.method.BaseResourceReturningMethodBinding.doInvokeServer(BaseResourceReturningMethodBinding.java:247)\n    at ca.uhn.fhir.rest.server.method.BaseResourceReturningMethodBinding.invokeServer(BaseResourceReturningMethodBinding.java:384)\n    at ca.uhn.fhir.rest.server.method.OperationMethodBinding.invokeServer(OperationMethodBinding.java:304)\n    at ca.uhn.fhir.rest.server.RestfulServer.handleRequest(RestfulServer.java:1029)\n    at ca.uhn.fhir.rest.server.RestfulServer.doGet(RestfulServer.java:363)\n    at ca.uhn.fhir.rest.server.RestfulServer.service(RestfulServer.java:1722)\n    at javax.servlet.http.HttpServlet.service(HttpServlet.java:741)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:231)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.tomcat.websocket.server.WsFilter.doFilter(WsFilter.java:53)\n    at org.apache.catalina.core.ApplicationFilterChain.internalDoFilter(ApplicationFilterChain.java:193)\n    at org.apache.catalina.core.ApplicationFilterChain.doFilter(ApplicationFilterChain.java:166)\n    at org.apache.catalina.core.StandardWrapperValve.invoke(StandardWrapperValve.java:200)\n    at org.apache.catalina.core.StandardContextValve.invoke(StandardContextValve.java:96)\n    at org.apache.catalina.authenticator.AuthenticatorBase.invoke(AuthenticatorBase.java:490)\n    at org.apache.catalina.core.StandardHostValve.invoke(StandardHostValve.java:139)\n    at org.apache.catalina.valves.ErrorReportValve.invoke(ErrorReportValve.java:92)\n    at org.apache.catalina.valves.AbstractAccessLogValve.invoke(AbstractAccessLogValve.java:678)\n    at org.apache.catalina.core.StandardEngineValve.invoke(StandardEngineValve.java:74)\n    at org.apache.catalina.connector.CoyoteAdapter.service(CoyoteAdapter.java:343)\n    at org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:408)\n    at org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:66)\n    at org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:836)\n    at org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1839)\n    at org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n    at java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n    at java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n    at org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n    at java.base/java.lang.Thread.run(Thread.java:834)\nCaused by: java.lang.reflect.InvocationTargetException: null\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\n    at ca.uhn.fhir.rest.server.method.BaseMethodBinding.invokeServerMethod(BaseMethodBinding.java:245)\n    ... 30 common frames omitted\nCaused by: java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\n    at java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)\n    at java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)\n    at java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:248)\n    at java.base/java.util.Objects.checkIndex(Objects.java:372)\n    at java.base/java.util.ArrayList.get(ArrayList.java:458)\n    at org.hl7.fhir.dstu3.conformance.ProfileUtilities.updateFromDefinition(ProfileUtilities.java:1186)\n    at org.hl7.fhir.dstu3.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:760)\n    at org.hl7.fhir.dstu3.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:389)\n    at org.hl7.fhir.dstu3.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:518)\n    at org.hl7.fhir.dstu3.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:389)\n    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:54)\n    at org.hl7.fhir.common.hapi.validation.support.ValidationSupportChain.generateSnapshot(ValidationSupportChain.java:65)\n    at org.hl7.fhir.common.hapi.validation.support.BaseValidationSupportWrapper.generateSnapshot(BaseValidationSupportWrapper.java:93)\n    at org.hl7.fhir.common.hapi.validation.validator.VersionSpecificWorkerContextWrapper.lambda$new$0(VersionSpecificWorkerContextWrapper.java:91)\n    at com.github.benmanes.caffeine.cache.BoundedLocalCache$BoundedLocalLoadingCache.lambda$new$0(BoundedLocalCache.java:3670)\n    at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$doComputeIfAbsent$14(BoundedLocalCache.java:2337)\n    at java.base/java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1908)\n    at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2335)\n    at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2318)\n    at com.github.benmanes.caffeine.cache.LocalCache.computeIfAbsent(LocalCache.java:111)\n    at com.github.benmanes.caffeine.cache.LocalLoadingCache.get(LocalLoadingCache.java:66)\n    at org.hl7.fhir.common.hapi.validation.validator.VersionSpecificWorkerContextWrapper.fetchResource(VersionSpecificWorkerContextWrapper.java:290)\n    at org.hl7.fhir.common.hapi.validation.validator.VersionSpecificWorkerContextWrapper.fetchRawProfile(VersionSpecificWorkerContextWrapper.java:371)\n    at org.hl7.fhir.common.hapi.validation.validator.ValidatorWrapper.fetchAndAddProfile(ValidatorWrapper.java:195)\n    at org.hl7.fhir.common.hapi.validation.validator.ValidatorWrapper.validate(ValidatorWrapper.java:135)\n    at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validate(FhirInstanceValidator.java:301)\n    at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.doValidate(BaseValidatorBridge.java:22)\n    at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.validateResource(BaseValidatorBridge.java:45)\n    at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validateResource(FhirInstanceValidator.java:30)\n    at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:221)\n    at ca.uhn.fhir.jpa.dao.BaseHapiFhirResourceDao.validate(BaseHapiFhirResourceDao.java:1429)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n    at java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n    at java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n    at java.base/java.lang.reflect.Method.invoke(Method.java:566)\n    at org.springframework.aop.support.AopUtils.invokeJoinpointUsingReflection(AopUtils.java:344)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.invokeJoinpoint(ReflectiveMethodInvocation.java:198)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:163)\n    at org.springframework.dao.support.PersistenceExceptionTranslationInterceptor.invoke(PersistenceExceptionTranslationInterceptor.java:139)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.transaction.interceptor.TransactionAspectSupport.invokeWithinTransaction(TransactionAspectSupport.java:366)\n    at org.springframework.transaction.interceptor.TransactionInterceptor.invoke(TransactionInterceptor.java:99)\n    at org.springframework.aop.framework.ReflectiveMethodInvocation.proceed(ReflectiveMethodInvocation.java:186)\n    at org.springframework.aop.framework.JdkDynamicAopProxy.invoke(JdkDynamicAopProxy.java:212)\n    at com.sun.proxy.$Proxy202.validate(Unknown Source)\n    at ca.uhn.fhir.jpa.provider.dstu3.JpaResourceProviderDstu3.validate(JpaResourceProviderDstu3.java:196)\n    ... 35 common frames omitted\n</code></pre></div>\n\n\n<p>It could be that this has something to do with the profile i'm validating against, however, I can't tell from the error if this is the case, and if so, what the actual problem is. Any idea?</p>\n<p>Thanks!</p>",
        "id": 210110649,
        "sender_full_name": "Job Schipper",
        "timestamp": 1600164285
    },
    {
        "content": "<p>I created a github issue with reproduction steps: <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/2095\">https://github.com/jamesagnew/hapi-fhir/issues/2095</a></p>",
        "id": 210726834,
        "sender_full_name": "Job Schipper",
        "timestamp": 1600686412
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  It looks like the error is caused within the org.hl7.fhir.dstu3.conformance.ProfileUtilities dependency. I want to see if i can debug this, but im using docker to run hapi. Can you show me how i can load a modified version of that dependency into the docker build process from <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter</a> ? I don't have much experience with java and the mvn package manager</p>",
        "id": 211464124,
        "sender_full_name": "Job Schipper",
        "timestamp": 1601281599
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  i just tried this with the :latest new tag from <a href=\"https://hub.docker.com/r/hapiproject/hapi\">https://hub.docker.com/r/hapiproject/hapi</a> and it looks like this issue has been fixed. (however, tag v5.1.0 is still broken as reported in <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/issues/129\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/issues/129</a>)</p>\n<p>any way that  current :latest be tagged with v5.1.1? would be great!</p>",
        "id": 211506925,
        "sender_full_name": "Job Schipper",
        "timestamp": 1601306412
    }
]