[
    {
        "content": "<p>Hi James,<br>\nAs observed from the devdays, I tried to customize the patient resource type for Oman needs. Further, I was able to upload the definition to HAPI server, but data upload fails. How can I specify OmanPatient instead of Patient in the resource type? Is it required to make OmanPatient as an inherited class in HAPI server ?</p>",
        "id": 153858566,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480221908
    },
    {
        "content": "<p>I have noticed MyOrganization under restful-server-example which is inherited from Organization. Further  OrganizationResourceProvider class is available to read data corresponding to MyOrganization. Is it part of the custom profiles? Do we need to implement the similar to manage custom profiles like OmanPatient? </p>",
        "id": 153858572,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480234935
    },
    {
        "content": "<p>Following documentation is found out in HAPI .. Please confirm the way I can define the custom profiles.. <br>\nSometimes you may not know in advance exactly which type you will be receiving. For example, there are Patient resources which conform to several different profiles on a server and you aren't sure which profile you will get back for a specific read, you can declare the \"primary\" type for a given profile.</p>\n<p>This is declared at the FhirContext level, and will apply to any clients created from this context (including clients created before the default was set).<br>\nFhirContext ctx = FhirContext.forDstu3();</p>\n<p>// Instruct the context that if it receives a resource which<br>\n// claims to conform to the given profile (by URL), it should<br>\n// use the MyPatient type to parse this resource<br>\nctx.setDefaultTypeForProfile(\"<a href=\"http://example.com/StructureDefinition/mypatient\" target=\"_blank\" title=\"http://example.com/StructureDefinition/mypatient\">http://example.com/StructureDefinition/mypatient</a>\", MyPatient.class);</p>\n<p>// You can declare as many default types as you like<br>\nctx.setDefaultTypeForProfile(\"<a href=\"http://foo.com/anotherProfile\" target=\"_blank\" title=\"http://foo.com/anotherProfile\">http://foo.com/anotherProfile</a>\", CustomObservation.class);</p>\n<p>// Create a client<br>\nIGenericClient client = ctx.newRestfulGenericClient(\"<a href=\"http://fhirtest.uhn.ca/baseDstu3\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu3\">http://fhirtest.uhn.ca/baseDstu3</a>\");</p>\n<p>// You can also read the resource back like normal<br>\nPatient patient = client.read().resource(Patient.class).withId(\"123\").execute();<br>\nif (patient instanceof MyPatient) {<br>\n   // If the server supplied a resource which declared to conform<br>\n   // to the given profile, MyPatient will have been returned so<br>\n   // process it differently..<br>\n}</p>",
        "id": 153858573,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480235717
    },
    {
        "content": "<p>I am continuing my effort to upload the DutchPatient profile to HAPI server.. the following error occured..<br>\nResource ValueSet/identifier-use not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[X].<br>\n<span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> , Can you please advise..</p>",
        "id": 153858664,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480325530
    },
    {
        "content": "<p>I was not able to publish the structure definition of the profile from the Forge tool, instead I tried using HAPI interface itself .. using the CRUD operations. </p>",
        "id": 153858665,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480325686
    },
    {
        "content": "<p>Hi Binu,</p>\n<p>Just to confirm, you have created a DSTU2 profile in Forge and you are seeing this issue when uploading the profile to your JPA server instance, or when validating a resource against it?</p>\n<p>FYI,  you don't need to generate any HAPI classes in order to do the type of validation you're looking to do. It should be possible to upload the profile definition to HAPI's server and then validate based on that. I will caution you that the validator in DSTU2 is not as powerful as the validator in DSTU3. If you have advanced validation requirements it is sometimes easier to simply code them in Java code and enforce them via an interceptor instead of relying on the native validator.</p>\n<p>This situation is a great deal better in STU3 though, the validator works very well on that version.</p>",
        "id": 153859092,
        "sender_full_name": "James Agnew",
        "timestamp": 1480474755
    },
    {
        "content": "<p>Thank you James for the detailed reply..<br>\nWhat you said is true.. I am trying to upload the profile to JPA server instance and basically trying to apply some constraints ..<br>\nI was able to upload the same into public HAPI server with out any issue, please note the following link. <br>\n<a href=\"http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient\">http://fhirtest.uhn.ca/baseDstu2/StructureDefinition/DutchPatient</a><br>\nIs it the right way to upload the profile? If so, issue is in my HAPI server configuration which I have to trace..</p>\n<p>But corresponding to the last element, placeOfBirth is an extension corresponding to which I could not send a value using FHIR message.<br>\nIs that means the profile is not verified as expected?</p>",
        "id": 153859136,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480492546
    },
    {
        "content": "<p>I have tried the following FHIR message against the DutchPatient profile..<br>\n{<br>\n  \"resourceType\": \"Patient\",<br>\n  \"id\": \"67.20068.14731\",<br>\n  \"meta\": {<br>\n    \"versionId\": \"1\",<br>\n    \"lastUpdated\": \"2016-11-30T02:18:24.929-05:00\",<br>\n    \"profile\": [<br>\n      \"<a href=\"http://example.org/fhir/StructureDefinition/DutchPatient\" target=\"_blank\" title=\"http://example.org/fhir/StructureDefinition/DutchPatient\">http://example.org/fhir/StructureDefinition/DutchPatient</a>\"<br>\n    ]<br>\n  },<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;div class=\\\"hapiHeaderText\\\"&gt; GHASIYA &lt;b&gt;AL WAHEIBI &lt;/b&gt;&lt;/div&gt;&lt;table class=\\\"hapiPropertyTable\\\"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;14731&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Date of birth&lt;/td&gt;&lt;td&gt;&lt;span&gt;01 January 1981&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;\"<br>\n  },<br>\n  \"identifier\": [<br>\n    {<br>\n      \"value\": \"14731\",<br>\n      \"period\": {<br>\n        \"start\": \"2005-03-15\"<br>\n      }<br>\n    }<br>\n  ],<br>\n  \"active\": false,<br>\n  \"name\": [<br>\n    {<br>\n      \"family\": [<br>\n        \"AL WAHEIBI\"<br>\n      ],<br>\n      \"given\": [<br>\n        \"GHASIYA\"<br>\n      ]<br>\n    }<br>\n  ],<br>\n  \"gender\": \"female\",<br>\n  \"birthDate\": \"1981-01-01\",<br>\n  \"deceasedBoolean\": true,<br>\n  \"address\": [<br>\n    {<br>\n      \"use\": \"home\"<br>\n    }<br>\n  ],<br>\n  \"placeOfBirth\" : { <br>\n    \"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/birthPlace\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/birthPlace\">http://hl7.org/fhir/StructureDefinition/birthPlace</a>\",<br>\n    \"valueString\": \"Narakal\"<br>\n  }</p>\n<p>}</p>",
        "id": 153859137,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480492795
    },
    {
        "content": "<p>In the above message, following element is not accepted<br>\n\"placeOfBirth\" : { <br>\n\"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/birthPlace\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/birthPlace\">http://hl7.org/fhir/StructureDefinition/birthPlace</a>\",<br>\n\"valueString\": \"Narakal\"<br>\n}</p>",
        "id": 153859141,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480493541
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <br>\nI am able to upload a test patient profile which is attached here by into the public test HAPI server and able to validate against even the extension added. But when I upload into my local HAPI server, I am getting the following error..<br>\nError: HTTP 400 Bad Request: Resource ValueSet/administrative-gender not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[x]</p>\n<p>I do understand that, it is the verification on the valuset uri, but I would like to know how it is bypassed in the public test server?</p>\n<p><a href=\"/user_uploads/10155/Wd8pWT8dsYhoTV-sZ7f1XG5N/TestPatient.structuredefinition.xml\" target=\"_blank\" title=\"TestPatient.structuredefinition.xml\">TestPatient.structuredefinition.xml</a> </p>",
        "id": 153859579,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480579892
    },
    {
        "content": "<p>Hi Binu,</p>\n<p>Let me have a look if I can replicate your issue with uploading the testpatient profile here locally.</p>\n<p>One thing to note, your syntax isn't quite right on that placeofbirth extension. FHIR's extension syntax in JSON should look more like this:</p>\n<div class=\"codehilite\"><pre>&quot;extension&quot; : [\n{ \n&quot;url&quot; : &quot;http://hl7.org/fhir/StructureDefinition/birthPlace&quot;,\n&quot;valueString&quot;: &quot;Narakal&quot;\n}\n]\n</pre></div>",
        "id": 153859625,
        "sender_full_name": "James Agnew",
        "timestamp": 1480611067
    },
    {
        "content": "<p>..which could go in the exact same place in the resource where you have</p>\n<div class=\"codehilite\"><pre>&quot;placeOfBirth&quot; : { \n&quot;url&quot; : &quot;http://hl7.org/fhir/StructureDefinition/birthPlace&quot;,\n&quot;valueString&quot;: &quot;Narakal&quot;\n}\n</pre></div>",
        "id": 153859626,
        "sender_full_name": "James Agnew",
        "timestamp": 1480611097
    },
    {
        "content": "<p>Ok, I'm a bit confused now. I am not able to replicate your issue... I did the following:</p>\n<p>1. Create a local server based on the jpaserver-example project<br>\n2. Upload your <code>TestPatient.structuredefinition.xml</code> to this server<br>\n3. Validate the example Patient with id <code>67.20068.14731</code> that you posted above by POSTing it to <code>http://localhost:8080/hapi-fhir-jpaserver-example/baseDstu2/Patient/$validate</code></p>\n<p>The test patient had a couple of JSON syntax error I had to fix, and the profile URL doesn't actually match (TestPatient vs. DutchPatient) but once I fixed those things it validated correctly. There were some validation issues, but nothing about missing valuesets, just normal problems with the patient resource's conformance to that profile</p>\n<p>How does this compare to what you're trying to do?</p>",
        "id": 153859629,
        "sender_full_name": "James Agnew",
        "timestamp": 1480613442
    },
    {
        "content": "<p>Sorry for belated response.. I was bit away.. syntax of the extension is corrected and I could upload the same into the public HAPI.<br>\nRight now my issue is only on the first part, getting valueset error while uploading the Structure definition TestPatient.Structuredefinition.xml.</p>\n<p>Exactly I am getting 400 Bad Request after the value set warning.. please note the following message</p>\n<p>Warning!<br>\nError: HTTP 400 Bad Request: Resource ValueSet/administrative-gender not found, specified in path: StructureDefinition.snapshot.element.binding.valueSet[x]</p>",
        "id": 153860133,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480824851
    },
    {
        "content": "<p>Please note the following in my new local server..<br>\nWarning!<br>\nError: HTTP 400 Bad Request: Resource contains external reference to URL \"<a href=\"http://hl7.org/fhir/ValueSet/administrative-gender\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/administrative-gender\">http://hl7.org/fhir/ValueSet/administrative-gender</a>\" but this server is not configured to allow external references</p>",
        "id": 153860159,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480832552
    },
    {
        "content": "<p>Please not the following statements about DaoConfig<br>\n@Bean()<br>\npublic DaoConfig daoConfig() {<br>\n    DaoConfig retVal = new DaoConfig();<br>\n    retVal.setAllowMultipleDelete(true);<br>\n<strong>retVal.setAllowInlineMatchUrlReferences(true);</strong> <br>\n    return retVal;<br>\n}</p>\n<p>What is the purpose of \"setAllowInlineMatchUrlReferences(true)\"?</p>",
        "id": 153860180,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480840027
    },
    {
        "content": "<p>That setting allows you to include search strings in references within a resource within a transaction, it's probably not the one you want.</p>\n<p>You're looking for </p>\n<div class=\"codehilite\"><pre>retVal.setAllowExternalReferences(true);\n</pre></div>",
        "id": 153860607,
        "sender_full_name": "James Agnew",
        "timestamp": 1480938057
    },
    {
        "content": "<p>That is very much true.. I have fixed the issue .. Thanks</p>",
        "id": 153860652,
        "sender_full_name": "Binu DGIT",
        "timestamp": 1480943971
    }
]