[
    {
        "content": "<p>I have a bundle resource structured like:  bundle/entry/resourece/DiagnosticReport/contained/List/contained/Observation, using Java FHIR HAPI, somehow,  the contained portions were not convered to XML using FHIR context parser. Cannot figure out what I did wrong.  Thanks in advance.</p>\n<p>Below is my testing  code (in Java)<br>\n===========================================================<br>\npublic class FHIRContaintedTest {<br>\n    private Logger logger;<br>\n    public FHIRContaintedTest(){<br>\n        System.setProperty(\"log4j.configurationFile\",    FHIRContaintedTest.class.getClassLoader().getResource(\"log4j2.xml\").toString());<br>\n        logger = LogManager.getLogger(FHIRContaintedTest.class.getName());<br>\n    }<br>\npublic static void main(String[] args) {<br>\n        FhirContext ctx = FhirContext.forDstu2();<br>\n        IParser parser = ctx.newXmlParser().setPrettyPrint(true);<br>\n        FHIRMaker fm = new FHIRMaker();<br>\n        FHIRContaintedTest fc = new FHIRContaintedTest();<br>\n        Bundle bundle = fm.makeBundle(\"JD-Bundle\");<br>\n        bundle.setType(BundleTypeEnum.COLLECTION);<br>\n        Entry rootEntry = fm.makeBundleEntry(\"JD-Entry\");<br>\n        DiagnosticReport dxReport = fm.makeDiagnosticReport(\"JD-Drpt\");<br>\n        ListResource lstRsc = fm.makeListRsc(\"JD-ListRsc\");<br>\n        Observation obs = fm.makeObservation(\"JD-Obs\");<br>\n        //add Observation to ListResource.contained<br>\n        fc.addToContained(obs, lstRsc);<br>\n        //add ListResource to DiagnosticReport.contained<br>\n        fc.addToContained(lstRsc, dxReport);<br>\n        rootEntry.setResource(dxReport);<br>\n        bundle.addEntry(rootEntry);<br>\n        String encodeStr = parser.encodeResourceToString(bundle);<br>\n        fc.logger.trace(encodeStr);<br>\n    }</p>\n<p>public void addToContained(BaseResource sml, BaseResource large){<br>\n        ContainedDt contained = new ContainedDt();<br>\n        ArrayList arrLst = new ArrayList&lt;&gt;();<br>\n        arrLst.add(sml);<br>\n        contained.setContainedResources(arrLst);<br>\n               large.getContained().setContainedResources(arrLst);<br>\n    }<br>\n}<br>\n=======================================================================<br>\npublic class FHIRMaker {<br>\n    public FHIRMaker() {<br>\n        // TODO Auto-generated constructor stub<br>\n    }<br>\n    // Make FHIR Observation<br>\n    public Observation makeObservation(String obsName) {<br>\n        Observation theObs = new Observation(); //<br>\n        theObs.setId(\"1\");<br>\n        theObs.setStatus(ObservationStatusEnum.FINAL);<br>\n        theObs.getCode().setText(obsName);<br>\n        StringDt val = new StringDt();<br>\n        val.setValue(obsName + \"-value\");<br>\n        theObs.setValue(val);<br>\n        return theObs;<br>\n    }<br>\n    // Make DiagnosticReport<br>\n    public DiagnosticReport makeDiagnosticReport(String drptName) {<br>\n        DiagnosticReport drpt = new DiagnosticReport(); <br>\n        drpt.setId(\"1\");<br>\n        drpt.getCode().setText(\"test report\");<br>\n        ResourceReferenceDt pfm = new ResourceReferenceDt();<br>\n        pfm.getReference().setValue(\"Lab Center\");<br>\n        drpt.setPerformer(pfm);<br>\n        return drpt;<br>\n    }<br>\n    // Make Bundle<br>\n    public Bundle makeBundle(String bdlName) {<br>\n        Bundle bdl = new Bundle();<br>\n        bdl.setType(BundleTypeEnum.DOCUMENT);<br>\n        return bdl;<br>\n    }<br>\n    // Make ListResoruces<br>\n    public ListResource makeListRsc(String lstName) {<br>\n        ListResource lstRsc = new ListResource();<br>\n        lstRsc.setId(\"1\");<br>\n        return lstRsc;<br>\n    }   <br>\n    // Make Bundle-Entry<br>\n    public Entry makeBundleEntry(String entName) {<br>\n        Entry ent = new Entry();<br>\n        return ent;<br>\n    }<br>\n}<br>\n======Below is the XML output, all contained XML elements are missing======================<br>\n&lt;Bundle xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n   &lt;type value=\"collection\"&gt;&lt;/type&gt;<br>\n   &lt;entry&gt;<br>\n      &lt;resource&gt;<br>\n         &lt;DiagnosticReport xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n            &lt;id value=\"1\"&gt;&lt;/id&gt;<br>\n            &lt;code&gt;<br>\n               &lt;text value=\"test report\"&gt;&lt;/text&gt;<br>\n            &lt;/code&gt;<br>\n            &lt;performer&gt;<br>\n               &lt;reference value=\"Lab center\"&gt;&lt;/reference&gt;<br>\n            &lt;/performer&gt;<br>\n         &lt;/DiagnosticReport&gt;<br>\n      &lt;/resource&gt;<br>\n   &lt;/entry&gt;<br>\n&lt;/Bundle&gt;</p>",
        "id": 153847554,
        "sender_full_name": "Jingdong(JD) Li",
        "timestamp": 1474113585
    },
    {
        "content": "<p>ok,have the problem solved. It looks like for any reason, if you defined an internal observation or other reousrce, the resource contained the internal resource has to particularly reference it, otherwise, FHIR parser will ignore the contained resource during xml generation. </p>",
        "id": 153847651,
        "sender_full_name": "Jingdong(JD) Li",
        "timestamp": 1474121276
    }
]