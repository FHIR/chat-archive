[
    {
        "content": "<p>I tried this on Logica, locally running, and on the R4 test server with the same results. I can't seem to get code:in to work when using snomed (for some reason ICD-10 examples I tried did work)? Any ideas?</p>\n<p>Here is the ValueSet: <br>\n<a href=\"http://hapi.fhir.org/baseR4/ValueSet?url=http://foo.com/ValueSet/conditions-T2DM-sct-small\">http://hapi.fhir.org/baseR4/ValueSet?url=http://foo.com/ValueSet/conditions-T2DM-sct-small</a></p>\n<p>Here is Condition that should be found:<br>\n<a href=\"http://hapi.fhir.org/baseR4/Condition/1461176\">http://hapi.fhir.org/baseR4/Condition/1461176</a></p>\n<p>But this shows empty set:<br>\n<a href=\"http://hapi.fhir.org/baseR4/Condition?code:in=http://foo.com/ValueSet/conditions-T2DM-sct-small\">http://hapi.fhir.org/baseR4/Condition?code:in=http://foo.com/ValueSet/conditions-T2DM-sct-small</a></p>",
        "id": 209570180,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1599686361
    },
    {
        "content": "<p>Also asked this in implementors channel. </p>\n<p>Today I discovered something interesting about this problem:<br>\n     If I used an ICD10 ValueSet, i.e.  \"system\": \"<a href=\"http://hl7.org/fhir/sid/icd-10\">http://hl7.org/fhir/sid/icd-10</a>\"<br>\n     the code:in search worked.  </p>\n<p>However, if I used a SNOMED or a LOINC coding system in the ValueSet it did NOT work.   That seems very strange?</p>",
        "id": 209834996,
        "sender_full_name": "John Silva",
        "timestamp": 1599858236
    },
    {
        "content": "<p>I was wondering if the CapabilityStatement should explicitly indicate if  'code:in' is supported.  See <a href=\"https://jira.hl7.org/browse/FHIR-30631\">https://jira.hl7.org/browse/FHIR-30631</a></p>",
        "id": 224057013,
        "sender_full_name": "Paul Denning",
        "timestamp": 1611675719
    },
    {
        "content": "<p>Bumping this topic. <br>\nI would like to search for Observations with a code found in a ValueSet. Can someone show me an example of a successful search with <code>code:in</code> with HAPI? I'd like to create a valueset with a set of LOINC codes and search for all Observations that are found in that set. I first tried with it with an already existing ValueSet (observation-vitalsignresult), but it didn't return anything, even though I know the fhir server has Observations with codes found in this set.</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Observation?code:in=http://hl7.org/fhir/ValueSet/observation-vitalsignresult\n</code></pre></div>",
        "id": 226890448,
        "sender_full_name": " Bob Milius",
        "timestamp": 1613686186
    },
    {
        "content": "<p>Some further exploration ...</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>ValueSet</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href=\"http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult\">http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>'<br>\n{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"id\": \"16ab9c70-4d25-4cfb-ab32-b2f5aecdc0ac\",<br>\n  \"meta\": {<br>\n    \"lastUpdated\": \"2021-02-19T16:20:18.248+00:00\"<br>\n  },<br>\n  \"type\": \"searchset\",<br>\n  \"total\": 1,<br>\n  \"link\": [ {<br>\n    \"relation\": \"self\",<br>\n    \"url\": \"<a href=\"http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult\">http://hapi.fhir.org/baseR4/ValueSet?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>\"<br>\n  } ],<br>\n  \"entry\": [ {<br>\n    \"fullUrl\": \"<a href=\"http://hapi.fhir.org/baseR4/ValueSet/observation-vitalsignresult\">http://hapi.fhir.org/baseR4/ValueSet/observation-vitalsignresult</a>\",<br>\n    \"resource\": {<br>\n      \"resourceType\": \"ValueSet\",<br>\n      \"id\": \"observation-vitalsignresult\",<br>\n      \"meta\": {<br>\n        \"versionId\": \"1\",<br>\n        \"lastUpdated\": \"2020-01-13T23:45:14.328+00:00\",<br>\n        \"source\": \"#txfUBM5pOtfNZNy3\",<br>\n        \"profile\": [ \"<a href=\"http://hl7.org/fhir/StructureDefinition/shareablevalueset\">http://hl7.org/fhir/StructureDefinition/shareablevalueset</a>\" ]<br>\n      },<br>\n      \"extension\": [ {<br>\n        \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-wg\">http://hl7.org/fhir/StructureDefinition/structuredefinition-wg</a>\",<br>\n        \"valueCode\": \"oo\"<br>\n      } ],<br>\n      \"url\": \"<a href=\"http://hl7.org/fhir/ValueSet/observation-vitalsignresult\">http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>\",<br>\n      \"identifier\": [ {<br>\n        \"system\": \"urn:ietf:rfc:3986\",<br>\n        \"value\": \"urn:oid:2.16.840.1.113883.3.88.12.80.62\"<br>\n      } ],<br>\n      \"version\": \"4.0.1\",<br>\n      \"name\": \"VitalSigns\",<br>\n      \"title\": \"Vital Signs\",<br>\n      \"status\": \"active\",<br>\n      \"experimental\": false,<br>\n      \"date\": \"2019-11-01T09:29:23+11:00\",<br>\n      \"publisher\": \"FHIR project team\",<br>\n      \"contact\": [ {<br>\n        \"telecom\": [ {<br>\n          \"system\": \"url\",<br>\n          \"value\": \"<a href=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"<br>\n        } ]<br>\n      } ],<br>\n      \"description\": \"This value set indicates the allowed vital sign result types.   The LOINC code for Vitals Signs panel (85353-1) is a grouping structure for a set of vital signs and includes related links (with type=has-member) to the Observations in this set (e.g. respiratory rate, heart rate, BP).  The Blood pressure panel (85354-9) is used to group the component observations Systolic blood pressure (8480-6) and Diastolic blood pressure (8462-4).\",<br>\n      \"copyright\": \"This content from LOINC® is copyright © 1995 Regenstrief Institute, Inc. and the LOINC Committee, and available at no cost under the license at <a href=\"http://loinc.org/terms-of-use\">http://loinc.org/terms-of-use</a>\",<br>\n      \"compose\": {<br>\n        \"include\": [ {<br>\n          \"system\": \"<a href=\"http://loinc.org\">http://loinc.org</a>\",<br>\n          \"concept\": [ {<br>\n            \"code\": \"85353-1\"<br>\n          }, {<br>\n            \"code\": \"9279-1\"<br>\n          }, {<br>\n            \"code\": \"8867-4\"<br>\n          }, {<br>\n            \"code\": \"2708-6\"<br>\n          }, {<br>\n            \"code\": \"8310-5\"<br>\n          }, {<br>\n            \"code\": \"8302-2\"<br>\n          }, {<br>\n            \"code\": \"9843-4\"<br>\n          }, {<br>\n            \"code\": \"29463-7\"<br>\n          }, {<br>\n            \"code\": \"39156-5\"<br>\n          }, {<br>\n            \"code\": \"85354-9\"<br>\n          }, {<br>\n            \"code\": \"8480-6\"<br>\n          }, {<br>\n            \"code\": \"8462-4\"<br>\n          }, {<br>\n            \"code\": \"8478-0\"<br>\n          } ]<br>\n        } ]<br>\n      }<br>\n    },<br>\n    \"search\": {<br>\n      \"mode\": \"match\"<br>\n    }<br>\n  } ]<br>\n}</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>code:in search</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href=\"http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult\">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>'<br>\n{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"id\": \"a5617f64-3b5e-4cda-b1ec-35c4d6e46f10\",<br>\n  \"meta\": {<br>\n    \"lastUpdated\": \"2021-02-19T16:17:08.069+00:00\"<br>\n  },<br>\n  \"type\": \"searchset\",<br>\n  \"total\": 0,<br>\n  \"link\": [ {<br>\n    \"relation\": \"self\",<br>\n    \"url\": \"<a href=\"http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult\">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult</a>\"<br>\n  } ]<br>\n}</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>code:in search with misspelled ValueSet url</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href=\"http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul\">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code%3Ain=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul</a>'<br>\n{<br>\n  \"resourceType\": \"OperationOutcome\",<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\\"0\\\"&gt;&lt;tr&gt;&lt;td style=\\\"font-weight: bold;\\\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Unknown ValueSet: http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;\"<br>\n  },<br>\n  \"issue\": [ {<br>\n    \"severity\": \"error\",<br>\n    \"code\": \"processing\",<br>\n    \"diagnostics\": \"Unknown ValueSet: http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresul\"<br>\n  } ]<br>\n}</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>search for specific code</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href=\"http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1\">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1</a>'<br>\n{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"id\": \"3dfb67ff-8092-4691-b2d4-3dd503d81b34\",<br>\n  \"meta\": {<br>\n    \"lastUpdated\": \"2021-02-19T16:27:53.920+00:00\"<br>\n  },<br>\n  \"type\": \"searchset\",<br>\n  \"link\": [ {<br>\n    \"relation\": \"self\",<br>\n    \"url\": \"<a href=\"http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1\">http://hapi.fhir.org/baseR4/Observation?_count=1&amp;code=http%3A%2F%2Floinc.org%7C9279-1</a>\"<br>\n  }, {<br>\n    \"relation\": \"next\",<br>\n    \"url\": \"<a href=\"http://hapi.fhir.org/baseR4?_getpages=3dfb67ff-8092-4691-b2d4-3dd503d81b34&amp;_getpagesoffset=1&amp;_count=1&amp;_pretty=true&amp;_bundletype=searchset\">http://hapi.fhir.org/baseR4?_getpages=3dfb67ff-8092-4691-b2d4-3dd503d81b34&amp;_getpagesoffset=1&amp;_count=1&amp;_pretty=true&amp;_bundletype=searchset</a>\"<br>\n  } ],<br>\n  \"entry\": [ {<br>\n    \"fullUrl\": \"<a href=\"http://hapi.fhir.org/baseR4/Observation/1574883\">http://hapi.fhir.org/baseR4/Observation/1574883</a>\",<br>\n    \"resource\": {<br>\n      \"resourceType\": \"Observation\",<br>\n      \"id\": \"1574883\",<br>\n      \"meta\": {<br>\n        \"versionId\": \"1\",<br>\n        \"lastUpdated\": \"2020-10-13T10:44:16.476+00:00\",<br>\n        \"source\": \"#JGEeCwyhkF4uPqEz\",<br>\n        \"profile\": [ \"<a href=\"http://hl7.org/fhir/StructureDefinition/vitalsigns\">http://hl7.org/fhir/StructureDefinition/vitalsigns</a>\", \"<a href=\"http://hl7.org/fhir/StructureDefinition/resprate\">http://hl7.org/fhir/StructureDefinition/resprate</a>\" ]<br>\n      },<br>\n      \"status\": \"final\",<br>\n      \"category\": [ {<br>\n        \"coding\": [ {<br>\n          \"system\": \"<a href=\"http://terminology.hl7.org/CodeSystem/observation-category\">http://terminology.hl7.org/CodeSystem/observation-category</a>\",<br>\n          \"code\": \"vital-signs\",<br>\n          \"display\": \"vital-signs\"<br>\n        } ]<br>\n      } ],<br>\n      \"code\": {<br>\n        \"coding\": [ {<br>\n          \"system\": \"<a href=\"http://loinc.org\">http://loinc.org</a>\",<br>\n          \"code\": \"9279-1\",<br>\n          \"display\": \"Respiratory rate\"<br>\n        } ],<br>\n        \"text\": \"Respiratory rate\"<br>\n      },<br>\n      \"subject\": {<br>\n        \"reference\": \"Patient/1574669\"<br>\n      },<br>\n      \"encounter\": {<br>\n        \"reference\": \"Encounter/1574875\"<br>\n      },<br>\n      \"effectiveDateTime\": \"2014-04-30T23:39:11+05:30\",<br>\n      \"issued\": \"2014-04-30T23:39:11.202+05:30\",<br>\n      \"valueQuantity\": {<br>\n        \"value\": 16,<br>\n        \"unit\": \"/min\",<br>\n        \"system\": \"<a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>\",<br>\n        \"code\": \"/min\"<br>\n      }<br>\n    },<br>\n    \"search\": {<br>\n      \"mode\": \"match\"<br>\n    }<br>\n  } ]<br>\n}</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>ValueSet/$validate-code \"Unable to expand ValueSet\"</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>$ curl --silent --header 'Accept: application/fhir+json' --request GET --url '<a href=\"http://hapi.fhir.org/baseR4/ValueSet/$validate-code?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult&amp;system=http%3A%2F%2Floinc.org&amp;code=9279-1\">http://hapi.fhir.org/baseR4/ValueSet/$validate-code?url=http%3A%2F%2Fhl7.org%2Ffhir%2FValueSet%2Fobservation-vitalsignresult&amp;system=http%3A%2F%2Floinc.org&amp;code=9279-1</a>'<br>\n{<br>\n  \"resourceType\": \"Parameters\",<br>\n  \"parameter\": [ {<br>\n    \"name\": \"result\",<br>\n    \"valueBoolean\": false<br>\n  }, {<br>\n    \"name\": \"message\",<br>\n    \"valueString\": \"Unknown code {http://loinc.org}9279-1 - Unable to expand ValueSet[http://hl7.org/fhir/ValueSet/observation-vitalsignresult]\"<br>\n  } ]<br>\n}</p>\n</div></div>",
        "id": 226990638,
        "sender_full_name": "Joel Schneider",
        "timestamp": 1613752693
    },
    {
        "content": "<p>Are there any news? I face the same problem, I'm unable to run a code:in query. Either the result is empty, unfiltered or I get an error message.</p>",
        "id": 234295884,
        "sender_full_name": "Moritz Kähler",
        "timestamp": 1618306797
    },
    {
        "content": "<p>I've had problems with code:in on HAPI before as well.   <br>\nTry a few things related to your code:in search:</p>\n<ul>\n<li><a href=\"http://hapi.fhir.org/baseR4/ValueSet?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult\">http://hapi.fhir.org/baseR4/ValueSet?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>    this ValueSet is definitely there</li>\n<li><a href=\"http://hapi.fhir.org/baseR4/Observation?code=8302-2\">http://hapi.fhir.org/baseR4/Observation?code=8302-2</a>  -- and there are Observations that have codes in this ValueSet (Body Height in this example)</li>\n<li><a href=\"http://hapi.fhir.org/baseR4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult\">http://hapi.fhir.org/baseR4/ValueSet/$expand?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a> . $expand works (shows as 'pre-calculated')</li>\n<li><a href=\"http://hapi.fhir.org/baseR4/CodeSystem?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult\">http://hapi.fhir.org/baseR4/CodeSystem?url=http://hl7.org/fhir/ValueSet/observation-vitalsignresult</a>  -  but no associated CodeSystem (I think)</li>\n</ul>\n<p>Does the code:in operation depend on CodeSystem?</p>",
        "id": 234310789,
        "sender_full_name": "John Silva",
        "timestamp": 1618314783
    },
    {
        "content": "<p>bumping this... We would love to be able to search on <code>code:in</code>a valueset</p>",
        "id": 265204991,
        "sender_full_name": " Bob Milius",
        "timestamp": 1639682118
    },
    {
        "content": "<p>In Hapi 5.6 this issue is solved.<br>\nTo use :in operator you need to</p>\n<ul>\n<li>hibernate.search.enabled: true in yaml file</li>\n<li>upload the valueSet</li>\n<li>restart hapi server or wait for 10 minutes until the expansion of the valueSet is completed. (Running $expand operation does not help here)</li>\n</ul>\n<p>Here is an example query that worked for me<br>\n<a href=\"http://localhost:8086/fhir/Observation?code:in=/myValueSetId\">http://localhost:8086/fhir/Observation?code:in=/myValueSetId</a></p>\n<div class=\"codehilite\" data-code-language=\"valueset\"><pre><span></span><code>{\n  \"resourceType\": \"ValueSet\",\n  \"id\": \"myValueSetId\",\n  \"meta\": {\n    \"versionId\": \"1\",\n    \"lastUpdated\": \"2022-01-25T08:46:11.675+00:00\",\n    \"source\": \"#xa4kq6mWK4hapvjA\"\n  },\n  \"url\": \"/ValueSet/myValueSetId\",\n  \"version\": \"1.0.0\",\n  \"name\": \"MyValueSet\",\n  \"status\": \"active\",\n  \"date\": \"2018-04-07T06:53:01+10:00\",\n  \"description\": \"tbd\",\n  \"compose\": {\n    \"include\": [ {\n      \"system\": \"http://snomed.info/sct\",\n      \"concept\": [ {\n        \"code\": \"10268700 \",\n        \"display\": \"Prostate specific antigen (substance)\"\n      } ]\n    }, {\n      \"system\": \"http://loinc.org\",\n      \"concept\": [ {\n        \"code\": \"2857-1\",\n        \"display\": \"Prostate specific Ag [Mass/volume] in Serum or Plasma\"\n      } ]\n    } ]\n  }\n}\n</code></pre></div>\n<p>(Please note that I used local references)</p>",
        "id": 269401348,
        "sender_full_name": "Moritz Kähler",
        "timestamp": 1643199419
    },
    {
        "content": "<p>Thank you Moritz for this detailed example and explanation of how to get this search to work. I was able to get this to work using these tips.</p>\n<p>Thank you very much! <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> <span aria-label=\"smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"smile\">:smile:</span></p>",
        "id": 269604943,
        "sender_full_name": "jayesh iyer",
        "timestamp": 1643303600
    }
]