[
    {
        "content": "<p>Two part question:</p>\n<ul>\n<li>Is it possible to load multiple versions of an IG into the validator?</li>\n<li>Then is it possible to ensure that particular resources are validated against a particular IG version?</li>\n</ul>\n<p>I've been looking through the validation code and I don't see an obvious way to do this. My impression is that IGs are tied to the context, so I would need to create a separate context for each IG version, and then select the appropriate context to use in validation. My understanding is that contexts are pretty heavy, so I'm hoping there's a better way.</p>",
        "id": 255206572,
        "sender_full_name": "Stephen MacVicar",
        "timestamp": 1632831593
    },
    {
        "content": "<p>you should be able to load multiple versions of an IG into the same context</p>",
        "id": 255210258,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632833367
    },
    {
        "content": "<p>then nominate the profile version you wish to validate against</p>",
        "id": 255210285,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632833383
    },
    {
        "content": "<p>but I don't think we have test cases that exercise this scenario, so no guarantee it will work</p>",
        "id": 255210362,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632833410
    },
    {
        "content": "<p>I'm concerned that specifying a profile version may not be sufficient because profiles and resource instances don't generally use versioned extension and value set urls.</p>",
        "id": 255216259,
        "sender_full_name": "Stephen MacVicar",
        "timestamp": 1632835831
    },
    {
        "content": "<p>the context should track the versioning from the packages implicitly. It would be great if you made up a test case to check</p>",
        "id": 255287926,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632858976
    },
    {
        "content": "<p>I'll work on making one.</p>",
        "id": 255391944,
        "sender_full_name": "Stephen MacVicar",
        "timestamp": 1632919598
    },
    {
        "content": "<p>OK, I've created a minimal test case, with two IG versions (<code>0.1.0</code> and <code>0.2.0</code>), but I haven't figured out how to make the validator validate against a specific profile version. I've loaded both IG versions, but this validates against <code>0.2.0</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>List&lt;String&gt; profiles = new ArrayList&lt;&gt;();\nprofiles.add(&quot;http://example.org/validator-versions-test/StructureDefinition/multi-version-test-patient|0.1.0&quot;);\nOperationOutcome op = ve.validate(FhirFormat.JSON, resource, profiles);\n</code></pre></div>",
        "id": 255737486,
        "sender_full_name": "Stephen MacVicar",
        "timestamp": 1633092396
    },
    {
        "content": "<p>then that's a bug outright. and the test case is a success at least</p>",
        "id": 255796139,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1633116762
    },
    {
        "content": "<p>It looks like they were validating against the correct profile version, but not the correct extension version. I opened a PR with unit tests and more details: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/pull/614\">https://github.com/hapifhir/org.hl7.fhir.core/pull/614</a></p>",
        "id": 256073479,
        "sender_full_name": "Stephen MacVicar",
        "timestamp": 1633359768
    }
]