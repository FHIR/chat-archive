[
    {
        "content": "<p>Hello,</p>\n<p>I am trying to implement my own operation on the Bundle type, to retrieve document bundles for a given Patient.<br>\nTo do this I need to figure out how I can search on Bundles using the attributes of the composition, specifically the subject.<br>\nAccording to what I understood reading the FHIR API it should be possible to search for this using chained parameters like so: &lt;url&gt;/Bundle?composition.subject=&lt;id&gt;.</p>\n<p>This does however not work. I tried it on <a href=\"http://hapi.fhir.org/baseDstu3\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3\">http://hapi.fhir.org/baseDstu3</a> using this example Bundle <a href=\"http://hapi.fhir.org/baseDstu3/Bundle/1230334\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Bundle/1230334\">http://hapi.fhir.org/baseDstu3/Bundle/1230334</a>.<br>\n(I also tried it using other bundles with the same result, in case this one didn't work.)</p>\n<p>Some of the requests I tried:<br>\n<a href=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=941852\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=941852\">http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=941852</a> -&gt; 0 results<br>\n<a href=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.patient=941852\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.patient=941852\">http://hapi.fhir.org/baseDstu3/Bundle?composition.patient=941852</a> -&gt; 0 results<br>\n<a href=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852\">http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852</a> -&gt; Error: \"theResourceName must not be blank\"<br>\nI also tried variations with more type specifications or using the ID of the composition instead of the subject, but nothing worked.</p>\n<p>However, using the example from the search reference of the STU3 search reference works:<br>\n<a href=\"http://hapi.fhir.org/baseDstu3/DiagnosticReport?subject.name=peter\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/DiagnosticReport?subject.name=peter\">http://hapi.fhir.org/baseDstu3/DiagnosticReport?subject.name=peter</a> does yield results.</p>\n<p>I would really appreciate some pointers on how I can get this search on the composition attributes to work, or if it is even possible.<br>\nAs I am implementing an Operation in the server, therefore I also have access to the BundleResourceProvider and the Dao.</p>\n<p>Thanks</p>",
        "id": 156684079,
        "sender_full_name": "Lars R端ckert",
        "timestamp": 1548245921
    },
    {
        "content": "<p>Hi Lars,</p>\n<p>$document is already implemented in hapi, so you don't have to implement it yourself</p>",
        "id": 156686512,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548248418
    },
    {
        "content": "<p>the query you are looking for is: <a href=\"http://hapi.fhir.org/baseDstu3/Composition?subject=Patient/941852\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Composition?subject=Patient/941852\">http://hapi.fhir.org/baseDstu3/Composition?subject=Patient/941852</a></p>",
        "id": 156686654,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548248559
    },
    {
        "content": "<p>Then you parse the Composition resource and invoke $document like this:<br>\n<a href=\"http://hapi.fhir.org/baseDstu3/Composition/1230333/$document\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Composition/1230333/$document\">http://hapi.fhir.org/baseDstu3/Composition/1230333/$document</a></p>",
        "id": 156686769,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548248656
    },
    {
        "content": "<p>We had a productive bof session at the dev days Amsterdam to create a custom operation which would allow to execute the search and the document creation in one call.</p>",
        "id": 156686821,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548248729
    },
    {
        "content": "<p>Hi Patrick,</p>\n<p>thank you for the answer, I think this will help.<br>\nUnfortunately I currently have the bundle only as the self contained bundle, so there is no composition in my fhir server.<br>\nIs there also the reverse operation of $document, which takes an incoming bundle and splits it up to store all the components of the document where they belong?</p>",
        "id": 156691963,
        "sender_full_name": "Lars R端ckert",
        "timestamp": 1548253155
    },
    {
        "content": "<p>Ahh, now i understand the problem. You are right <a href=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852\">http://hapi.fhir.org/baseDstu3/Bundle?composition.subject=Patient/941852</a> should work, but doesn't.<br>\nI'll have a look at this issue.</p>",
        "id": 156758952,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548321371
    },
    {
        "content": "<p>Thank you very much!</p>",
        "id": 156759086,
        "sender_full_name": "Lars R端ckert",
        "timestamp": 1548321548
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> Any news on this issue?</p>",
        "id": 157171455,
        "sender_full_name": "Lars R端ckert",
        "timestamp": 1548838282
    },
    {
        "content": "<p>didn't had time to look into it yet :-/ I hope i'll  have some time this weekend.</p>",
        "id": 157197892,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1548864146
    }
]