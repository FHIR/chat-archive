[
    {
        "content": "<p>I'm trying to send this transaction. Crate a Patient, and then, assign a device to that patient. </p>\n<p>So, as a part of a transaction, I have this entry. But this doesn't work, says <code>Invalid match URL[21] - URL has no search parameters</code></p>\n<p>So, <strong>Question 1</strong>, what's wrong here?</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Bundle&quot;,\n    &quot;type&quot;: &quot;transaction&quot;,\n    &quot;entry&quot;: [\n        // other entries\n        {\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Parameters&quot;,\n                &quot;parameter&quot;: [\n                    {\n                        &quot;name&quot;: &quot;operation&quot;,\n                        &quot;part&quot;: [\n                            {\n                                &quot;name&quot;: &quot;type&quot;,\n                                &quot;valueString&quot;: &quot;add&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;path&quot;,\n                                &quot;valueString&quot;: &quot;Device&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;name&quot;,\n                                &quot;valueString&quot;: &quot;patient&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;value&quot;,\n                                &quot;valueReference&quot;: {\n                                    &quot;reference&quot;: &quot;Patient/id&quot;,\n                                    &quot;type&quot;: &quot;Patient&quot;\n                                }\n                            }\n                        ]\n                    }\n                ]\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;PATCH&quot;,\n                &quot;url&quot;: &quot;Device/1835297&quot;,\n                &quot;ifMatch&quot;: &quot;id&quot;\n            }\n        }\n    ]\n}\n</code></pre></div>",
        "id": 224694590,
        "sender_full_name": "Dexter",
        "timestamp": 1612166358
    },
    {
        "content": "<p>So as an alternative, I'm doing this, first check version with a JSON PATCH <code>test</code> like so</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Binary&quot;,\n                &quot;contentType&quot;: &quot;application/json-patch+json&quot;,\n                &quot;data&quot;: &quot;WwogICAgewogICAgICAgICJvcCI6ICJ0ZXN0IiwKICAgICAgICAicGF0aCI6ICIvbWV0YS92ZXJzaW9uSWQiLAogICAgICAgICJ2YWx1ZSI6ICIyMiIKICAgIH0KXQ==&quot;\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;PATCH&quot;,\n                &quot;url&quot;: &quot;Device/1835297&quot;\n            }\n        }\n// rest of the entries above\n</code></pre></div>\n<p>This works, since the transaction can either work or fail as a whole. Great! </p>\n<p>Now, the main part</p>",
        "id": 224694867,
        "sender_full_name": "Dexter",
        "timestamp": 1612166504
    },
    {
        "content": "<p>I'm trying to create a patient, and assign a device. I was told by kind volunteers that <code>Binary</code> resource doesn't resolve references to items that are a part of a transaction, and I should use FHIRPatch, but that didn't seem to work either. </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Bundle&quot;,\n    &quot;type&quot;: &quot;transaction&quot;,\n    &quot;entry&quot;: [\n        {\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Binary&quot;,\n                &quot;contentType&quot;: &quot;application/json-patch+json&quot;,\n                &quot;data&quot;:  &quot;base64( [{ &quot;op&quot;: &quot;test&quot;, &quot;path&quot;: &quot;/meta/versionId&quot;, &quot;value&quot;: &quot;versionId&quot;}] )&quot;\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;PATCH&quot;,\n                &quot;url&quot;: &quot;Device/1835297&quot;\n            }\n        },\n        {\n            &quot;fullUrl&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Patient&quot;,\n                // some data\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;POST&quot;\n            }\n        },\n        {\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Parameters&quot;,\n                &quot;parameter&quot;: [\n                    {\n                        &quot;name&quot;: &quot;operation&quot;,\n                        &quot;part&quot;: [\n                            {\n                                &quot;name&quot;: &quot;type&quot;,\n                                &quot;valueString&quot;: &quot;add&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;path&quot;,\n                                &quot;valueString&quot;: &quot;Device&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;name&quot;,\n                                &quot;valueString&quot;: &quot;patient&quot;\n                            },\n                            {\n                                &quot;name&quot;: &quot;value&quot;,\n                                &quot;valueReference&quot;: {\n                                    // This must resolve to &quot;Patient/someid&quot;\n                                    &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,\n                                    &quot;type&quot;: &quot;Patient&quot;\n                                }\n                            }\n                        ]\n                    }\n                ]\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;PATCH&quot;,\n                &quot;url&quot;: &quot;Device/1835297&quot;\n            }\n        }\n    ]\n}\n\n{\n    &quot;resourceType&quot;: &quot;Device&quot;,\n    &quot;id&quot;: &quot;1835297&quot;,\n    // ... other data\n    &quot;patient&quot;: {\n        &quot;reference&quot;: &quot;urn:uuid:abe0b81e-2aca-44c7-8469-1dc1f7301fe9&quot;,\n        &quot;type&quot;: &quot;Patient&quot;\n    }\n}\n</code></pre></div>\n<p>What am I doing wrong?</p>",
        "id": 224696391,
        "sender_full_name": "Dexter",
        "timestamp": 1612167729
    },
    {
        "content": "<p>Just put your patient and the device entries in the same bundle of type transaction.  Give the patient a uuid fullurl, then refer to the patient uuid in the device resource entry.</p>",
        "id": 224816269,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1612227376
    },
    {
        "content": "<p>Yeah I did that <a href=\"#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224696391\">here</a>, if I'm not mistaken</p>\n<p>Also, queries with <code>_offset</code> and <code>_count</code> don't seem to return the <code>total</code> field</p>\n<p><a href=\"user_uploads/10155/xxSZ_6Bk22iyYdXN4l0ppRc1/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/10155/xxSZ_6Bk22iyYdXN4l0ppRc1/image.png\" title=\"image.png\"><img src=\"user_uploads/10155/xxSZ_6Bk22iyYdXN4l0ppRc1/image.png\"></a></div><p>I assume this means that all searches are supposed to return the <code>total</code> parameter in response bundles</p>\n<p><a href=\"user_uploads/10155/UujelyNQsHgmrrceV5Ba2p6M/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/10155/UujelyNQsHgmrrceV5Ba2p6M/image.png\" title=\"image.png\"><img src=\"user_uploads/10155/UujelyNQsHgmrrceV5Ba2p6M/image.png\"></a></div>",
        "id": 224830432,
        "sender_full_name": "Dexter",
        "timestamp": 1612243435
    },
    {
        "content": "<p>How do I check for support for <code>FHIRPatch</code>. I\"m trying this on the public server at <code>hapi.fhir.org</code>. How do I get <a href=\"#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224696391\">this transaction</a> to work?</p>",
        "id": 224984866,
        "sender_full_name": "Dexter",
        "timestamp": 1612339807
    },
    {
        "content": "<p>Have you tried using FHIRPatch as a 'standalone' REST interaction (outside of a bundle) ? Does that work?</p>",
        "id": 224988686,
        "sender_full_name": "René Spronk",
        "timestamp": 1612342719
    },
    {
        "content": "<p>Yep! That's the first thing I checked to make sure I could use <code>parameters</code>, and know for-sure that I had the syntax right</p>",
        "id": 224988710,
        "sender_full_name": "Dexter",
        "timestamp": 1612342740
    },
    {
        "content": "<p>Have you tried using FHIRPatch in a transaction (with only the PATCH in it) ? Does that work as expected ?</p>",
        "id": 224989462,
        "sender_full_name": "René Spronk",
        "timestamp": 1612343208
    },
    {
        "content": "<p>Yes! The above JSON request I sent works, just that the <code>urn:uuid:xx...</code> doesn't resolve to the <code>fullUrl</code> of the <code>Patient</code></p>",
        "id": 224989589,
        "sender_full_name": "Dexter",
        "timestamp": 1612343285
    },
    {
        "content": "<p>You'd better contact the authors of HAPI -looks like a bug to me. Although I'm not sure if this would work on one of the other public test servers either.</p>",
        "id": 224990339,
        "sender_full_name": "René Spronk",
        "timestamp": 1612343758
    },
    {
        "content": "<p>Yikes, really? I'll try with another public server, a few mins</p>",
        "id": 224991418,
        "sender_full_name": "Dexter",
        "timestamp": 1612344405
    },
    {
        "content": "<p>I just tried with <code>server.fire.ly/R4</code>, and I get this error</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;text&quot;: &quot;Interaction POST  in entry with fullUrl urn:uuid:7a712ad0-c34f-4faa-930c-ab3edaf85652 is\nnot supported: A transaction Bundle cannot contain a nested Batch or Transaction interaction&quot;\n</code></pre></div>\n<p>I don't see what's nested?</p>\n<p>Nevermind, just noticed this on the public servers list</p>\n<p><code>This test instance runs on MongoDB and therefore can do batch but not transaction.</code>, so I guess vonk public server wasn't the right one to try against. Trying with something else</p>",
        "id": 224992371,
        "sender_full_name": "Dexter",
        "timestamp": 1612345040
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191372\">René Spronk</span> <a href=\"#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224990339\">said</a>:</p>\n<blockquote>\n<p>Although I'm not sure if this would work on one of the other public test servers either.</p>\n</blockquote>\n<p>I see, so it's an uncommon feature implementation?</p>",
        "id": 224992721,
        "sender_full_name": "Dexter",
        "timestamp": 1612345237
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191372\">René Spronk</span> <a href=\"#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224990339\">said</a>:</p>\n<blockquote>\n<p>You'd better contact the authors of HAPI -looks like a bug to me. Although I'm not sure if this would work on one of the other public test servers either.</p>\n</blockquote>\n<p>Where do I file this bug report? Also, I tried on <code>https://r4.test.pyrohealth.net/fhir</code>, and doesn't seem to follow transaction rules itself, as <code>test</code> PATCH OP works, even though it should be failing</p>",
        "id": 224994729,
        "sender_full_name": "Dexter",
        "timestamp": 1612346565
    },
    {
        "content": "<p>According to the <a href=\"http://hapifhir.io\">hapifhir.io</a> site ...</p>\n<p>GitHub issue tracker is here:<br>\n<a href=\"https://github.com/hapifhir/hapi-fhir/issues\">https://github.com/hapifhir/hapi-fhir/issues</a></p>\n<p>Google Group for discussion is here:<br>\n<a href=\"https://groups.google.com/g/hapi-fhir\">https://groups.google.com/g/hapi-fhir</a></p>",
        "id": 225030208,
        "sender_full_name": "Joel Schneider",
        "timestamp": 1612365687
    },
    {
        "content": "<p>Thank you, I posted the issue on <a href=\"https://github.com/hapifhir/hapi-fhir/issues/2353#issue-800934635\">GitHub</a></p>",
        "id": 225119562,
        "sender_full_name": "Dexter",
        "timestamp": 1612415052
    },
    {
        "content": "<p>On <a href=\"http://server.fire.ly\">server.fire.ly</a> we simulate transactions for testing purposes.<br>\nI don't see the mentioned fullUrl <code>urn:uuid:7a712ad0-c34f-4faa-930c-ab3edaf85652</code> in the transaction mentioned by you <a href=\"#narrow/stream/179167-hapi/topic/Transactions.20and.20Conditional.20PATCH/near/224696391\">here</a>. Could you post the exact transaction you were sending to <a href=\"http://server.fire.ly/R4\">server.fire.ly/R4</a> so I can reproduce the issue?</p>",
        "id": 225144072,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1612435966
    },
    {
        "content": "<p>I sent a new one, <code>server.fire.ly/R4/Operation-Outcome/0a1159de-67c1-4fae-922f-76eb10b0068d</code>. Please do let me know if I need to share the request payload</p>",
        "id": 225144893,
        "sender_full_name": "Dexter",
        "timestamp": 1612436526
    },
    {
        "content": "<p>That doesn't seem to have the full response, here it is </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;id&quot;: &quot;0a1159de-67c1-4fae-922f-76eb10b0068d&quot;,\n    &quot;meta&quot;: {\n        &quot;versionId&quot;: &quot;e36072c6-71d0-40f6-85d2-401d625e4e83&quot;,\n        &quot;lastUpdated&quot;: &quot;2021-02-04T11:00:27.944+00:00&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;warning&quot;,\n            &quot;code&quot;: &quot;not-supported&quot;,\n            &quot;details&quot;: {\n                &quot;coding&quot;: [\n                    {\n                        &quot;system&quot;: &quot;http://hl7.org/fhir/dotnet-api-operation-outcome&quot;,\n                        &quot;code&quot;: &quot;5003&quot;\n                    }\n                ],\n                &quot;text&quot;: &quot;Argument is not supported&quot;\n            },\n            &quot;diagnostics&quot;: &quot;/Device&quot;\n        },\n        {\n            &quot;severity&quot;: &quot;warning&quot;,\n            &quot;code&quot;: &quot;not-supported&quot;,\n            &quot;details&quot;: {\n                &quot;coding&quot;: [\n                    {\n                        &quot;system&quot;: &quot;http://hl7.org/fhir/dotnet-api-operation-outcome&quot;,\n                        &quot;code&quot;: &quot;5003&quot;\n                    }\n                ],\n                &quot;text&quot;: &quot;Argument is not supported&quot;\n            },\n            &quot;diagnostics&quot;: &quot;/48d8b843-7e9f-4cfe-99ef-da0688725aba&quot;\n        },\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;not-supported&quot;,\n            &quot;details&quot;: {\n                &quot;coding&quot;: [\n                    {\n                        &quot;system&quot;: &quot;http://hl7.org/fhir/dotnet-api-operation-outcome&quot;,\n                        &quot;code&quot;: &quot;5005&quot;\n                    }\n                ],\n                &quot;text&quot;: &quot;Interaction PATCH Device/48d8b843-7e9f-4cfe-99ef-da0688725aba in entry  is not implemented.&quot;\n            }\n        }\n    ]\n}\n</code></pre></div>",
        "id": 225144934,
        "sender_full_name": "Dexter",
        "timestamp": 1612436557
    },
    {
        "content": "<p>Do I have any alternatives? I could go with making 2 separate requests (which is what I'm doing right now), but  would be great to have just one do it</p>",
        "id": 225509391,
        "sender_full_name": "Dexter",
        "timestamp": 1612768346
    },
    {
        "content": "<p>How do I query <code>Practitioner</code>, <code>PractitionerRole</code>, <code>CareTeam</code> for a given patient? I have a patient with a careteam. I can get the <code>Practitioner</code>, <code>CareTeam</code>, but getting the <code>PractitionerRole</code> eludes me. This is what I have</p>\n<div class=\"codehilite\"><pre><span></span><code>https://hapi.fhir.org/baseR4/CareTeam?subject=id&amp;_include=CareTeam:participant\n</code></pre></div>",
        "id": 225808335,
        "sender_full_name": "Dexter",
        "timestamp": 1612947317
    },
    {
        "content": "<p>Got it! I jut had to look at it from a different perspective!</p>\n<div class=\"codehilite\"><pre><span></span><code>https://hapi.fhir.org/baseR4/Practitioner\n?_has:CareTeam:participant:subject=1852143\n&amp;_revinclude=PractitionerRole:practitioner\n&amp;_revinclude=CareTeam:participant\n</code></pre></div>",
        "id": 225808954,
        "sender_full_name": "Dexter",
        "timestamp": 1612947685
    }
]