[
    {
        "content": "<p>Hi, all, I am using HAPI 5.3 to convert a QuestionnaireResponse which has contained a Questionnaire. In QuestionnaireResponse, I have the QuestionnaireResponse.questionnaire with canonical ID referred to the contained Questionnaire. I can see the contained list is set from debugger, however, when I used ctx.newJsonParser().encodeResourceToString(), the contained element disappeared. Noticed that encodeResourceToString() takes IBaseResource as the parameter; \"contained\" is defined in IDomainResource. I am wondering if other people have seen this issue and if there is any solution to resolve it. Thanks for any help in advance.</p>",
        "id": 256741123,
        "sender_full_name": "Yolanda",
        "timestamp": 1633700513
    },
    {
        "content": "<p>add an extension to the QuestionnaireResponse which references the contained resource via the contained id</p>",
        "id": 256742150,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1633700976
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> for your reply. Can you elaborate more details? Is there an existing extension I can use or do I need define my own extension, then the IParser would acknowledge it?</p>",
        "id": 256793197,
        "sender_full_name": "Yolanda",
        "timestamp": 1633721417
    },
    {
        "content": "<p>Contained resources need to be referenced, the canonical is for hapi not sufficient, just use your own extension.</p>",
        "id": 256794601,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1633722078
    },
    {
        "content": "<p>Does this look right? Thanks</p>\n<p>{<br>\n    \"resourceType\": \"QuestionnaireResponse\",<br>\n    \"meta\": {<br>\n        \"profile\": [<br>\n            \"<a href=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt\">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaireresponse-adapt</a>\"<br>\n        ]<br>\n    },<br>\n    \"extension\": [<br>\n        {<br>\n            \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/contained-id\">http://hl7.org/fhir/StructureDefinition/contained-id</a>\",<br>\n            \"valueCanonical\": \"#q\"<br>\n        }<br>\n    ],<br>\n    \"contained\": [<br>\n        {<br>\n            \"resourceType\": \"Questionnaire\",<br>\n            \"id\": \"q\",<br>\n            \"meta\": {<br>\n                \"profile\": [<br>\n                    \"<a href=\"http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt\">http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-adapt</a>\"<br>\n                ]<br>\n            }<br>\n        }<br>\n    ],<br>\n    \"questionnaire\": \"#q\",<br>\n    \"status\": \"in-progress\"<br>\n}</p>",
        "id": 256798477,
        "sender_full_name": "Yolanda",
        "timestamp": 1633723779
    },
    {
        "content": "<ol>\n<li>Use valueReference in extension insteaf of valueCanonical, </li>\n<li>Use for the extension an url /domain which is under your control</li>\n</ol>",
        "id": 256845275,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1633760804
    },
    {
        "content": "<p>See example <a href=\"https://github.com/hl7ch/covid-19-prom/blob/master/input/resources/questionnaire/coronascience-question-of-the-day-QD1.xml#L174\">L174</a></p>",
        "id": 256845556,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1633761090
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> Your example really helped me!  Really appreciate it.</p>",
        "id": 257065784,
        "sender_full_name": "Yolanda",
        "timestamp": 1633959658
    },
    {
        "content": "<p>I am still wondering how HAPI works with respect to those customer defined extensions. Is there any documentation mentions this behavior?</p>",
        "id": 257065965,
        "sender_full_name": "Yolanda",
        "timestamp": 1633959753
    },
    {
        "content": "<p>No not that i am aware of.<br>\nIt doesn't matter what extension you are using, what matters to hapi: is there an actual reference to or from the contained resource to the surrounding resource.</p>",
        "id": 257066528,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633960047
    },
    {
        "content": "<p>If there is none -&gt; drop contained resource.</p>",
        "id": 257066549,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633960057
    },
    {
        "content": "<p>So any extension containing the neede reference will stop dropping the contained resource</p>",
        "id": 257066619,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633960082
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> what do you think of (re)moving this check from the parser?</p>",
        "id": 257066704,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633960122
    },
    {
        "content": "<p>I think this is some kind of business/FHIR logic which shouldn't be applied while parsing</p>",
        "id": 257066774,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633960149
    },
    {
        "content": "<p>This check was removed in HAPI FHIR 5.4.0 - As of that release HAPI FHIR will not string contained resources that are manually added to the list for any reason.</p>",
        "id": 257091456,
        "sender_full_name": "James Agnew",
        "timestamp": 1633971746
    },
    {
        "content": "<p>i totally missed that, sorry. Thanks for the heads-up</p>",
        "id": 257094292,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1633973211
    },
    {
        "content": "<p>Ah, I see. Thanks for the information.</p>",
        "id": 257094841,
        "sender_full_name": "Yolanda",
        "timestamp": 1633973503
    },
    {
        "content": "<p>No worries!</p>",
        "id": 257119409,
        "sender_full_name": "James Agnew",
        "timestamp": 1633988081
    }
]