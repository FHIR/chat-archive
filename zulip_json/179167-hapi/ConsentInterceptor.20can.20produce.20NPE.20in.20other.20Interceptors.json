[
    {
        "content": "<p>Hello all,<br>\nI have found a bug in HAPIs Interceptor logic, that produces NullPointerExceptions for other Interceptors when they don't check for null values or missing NULL checks in BinaryStorageInterceptor, ConsentInterceptor and AuthorizationInterceptor</p>\n<p>Which one to file?</p>\n<p>When Consertservice.willSeeResource(...) for a resource returns a ConsentOutcome.REJECT, ConsentInterceptor.interceptPreShow will null the resource in IPreResourceShowDetails <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/ceeff0ccf067f65ee9b59c492e1d96b4ac8499a5/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/server/interceptor/consent/ConsentInterceptor.java#L181\">https://github.com/jamesagnew/hapi-fhir/blob/ceeff0ccf067f65ee9b59c492e1d96b4ac8499a5/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/server/interceptor/consent/ConsentInterceptor.java#L181</a> <br>\nNow IPreResourceShowDetails contains nulls which may cause NPEs on any consecutive Pointcut.STORAGE_PRESHOW_RESOURCES hook, like <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/binstore/BinaryStorageInterceptor.java#L252\">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/binstore/BinaryStorageInterceptor.java#L252</a> or ConsentInterceptor itself, when an other hook nulled a resource earlier.</p>\n<p>In the past (up to 4.2.0) I just had my interceptor hook remove any null resources from IPreResourceShowDetails. But now that SimplePreResourceShowDetails changed it's internal myResources from a List <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/v4.2.0/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/api/server/SimplePreResourceShowDetails.java#L32\">https://github.com/jamesagnew/hapi-fhir/blob/v4.2.0/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/api/server/SimplePreResourceShowDetails.java#L32</a> to an array <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/v5.0.0/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/api/server/SimplePreResourceShowDetails.java#L37\">https://github.com/jamesagnew/hapi-fhir/blob/v5.0.0/hapi-fhir-server/src/main/java/ca/uhn/fhir/rest/api/server/SimplePreResourceShowDetails.java#L37</a><br>\nthats isn't possible any more.</p>\n<p>Any suggestions?</p>",
        "id": 202071229,
        "sender_full_name": "André-Sebastian Liebe",
        "timestamp": 1593165345
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ?</p>",
        "id": 202274311,
        "sender_full_name": "André-Sebastian Liebe",
        "timestamp": 1593409995
    }
]