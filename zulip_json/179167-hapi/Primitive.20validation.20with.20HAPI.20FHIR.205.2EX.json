[
    {
        "content": "<p>Hi,</p>\n<p>I am using snapshot version of hapi-fhir library and trying to validate observation with body height profile (<a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a>)<br>\nAlso i use <a href=\"https://r4.ontoserver.csiro.au/fhir\" title=\"https://r4.ontoserver.csiro.au/fhir\">https://r4.ontoserver.csiro.au/fhir</a> terminology service with RemoteTerminologyServiceValidationSupport<br>\nWhen the library tries to validate valueQuantity of observation, it fails with 400 http status code and message: <em>If the code parameter is provided, the system parameter must also be provided.</em></p>\n<p>Could you please check this issue, thx</p>",
        "id": 193210581,
        "sender_full_name": "Roman Rodnin",
        "timestamp": 1586275486
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"253983\">@Roman Rodnin</span> can you post an example resource you're trying to validate?</p>",
        "id": 193255821,
        "sender_full_name": "Dion McMurtrie",
        "timestamp": 1586298305
    },
    {
        "content": "<p>Note, the error mentioned means <code>$validate-code</code> is being called with a <code>code</code> parameter but no <code>system</code> parameter.<br>\nThis is kinda strange given that the bodyheight profile has a mandatory fixed value for <code>system</code></p>",
        "id": 193264181,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1586305090
    },
    {
        "content": "<p>I'm going to assume <span class=\"user-mention\" data-user-id=\"253983\">@Roman Rodnin</span> that you're using the new RemoteTerminologyServiceValidationSupport in 5.0.0-SNAPSHOT?</p>\n<p>I have the same questions as the others, but I'm also just intertested to see this used in the wild already. :)</p>",
        "id": 193323466,
        "sender_full_name": "James Agnew",
        "timestamp": 1586354292
    },
    {
        "content": "<p>yes, you are right.<br>\nresource that i am trying to validate:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Observation&quot;,\n  &quot;id&quot;: &quot;body-height&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://hl7.org/fhir/StructureDefinition/vitalsigns&quot;\n    ]\n  },\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;generated&quot;,\n    &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;p&gt;&lt;b&gt;Generated Narrative with Details&lt;/b&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;id&lt;/b&gt;: body-height&lt;/p&gt;&lt;p&gt;&lt;b&gt;meta&lt;/b&gt;: &lt;/p&gt;&lt;p&gt;&lt;b&gt;status&lt;/b&gt;: final&lt;/p&gt;&lt;p&gt;&lt;b&gt;category&lt;/b&gt;: Vital Signs &lt;span&gt;(Details : {http://terminology.hl7.org/CodeSystem/observation-category code &#39;vital-signs&#39; = &#39;Vital Signs&#39;, given as &#39;Vital Signs&#39;})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;code&lt;/b&gt;: Body height &lt;span&gt;(Details : {LOINC code &#39;8302-2&#39; = &#39;Body height&#39;, given as &#39;Body height&#39;})&lt;/span&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;subject&lt;/b&gt;: &lt;a&gt;Patient/example&lt;/a&gt;&lt;/p&gt;&lt;p&gt;&lt;b&gt;effective&lt;/b&gt;: 02/07/1999&lt;/p&gt;&lt;p&gt;&lt;b&gt;value&lt;/b&gt;: 66.899999999999991 in&lt;span&gt; (Details: UCUM code [in_i] = &#39;in_i&#39;)&lt;/span&gt;&lt;/p&gt;&lt;/div&gt;&quot;\n  },\n  &quot;status&quot;: &quot;final&quot;,\n  &quot;category&quot;: [\n    {\n      &quot;coding&quot;: [\n        {\n          &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/observation-category&quot;,\n          &quot;code&quot;: &quot;vital-signs&quot;,\n          &quot;display&quot;: &quot;Vital Signs&quot;\n        }\n      ],\n      &quot;text&quot;: &quot;Vital Signs&quot;\n    }\n  ],\n  &quot;code&quot;: {\n    &quot;coding&quot;: [\n      {\n        &quot;system&quot;: &quot;http://loinc.org&quot;,\n        &quot;code&quot;: &quot;8302-2&quot;,\n        &quot;display&quot;: &quot;Body height&quot;\n      }\n    ],\n    &quot;text&quot;: &quot;Body height&quot;\n  },\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/example&quot;\n  },\n  &quot;effectiveDateTime&quot;: &quot;1999-07-02&quot;,\n  &quot;valueQuantity&quot;: {\n    &quot;value&quot;: 66.899999999999991,\n    &quot;unit&quot;: &quot;in&quot;,\n    &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n    &quot;code&quot;: &quot;[in_i]&quot;\n  }\n}\n</pre></div>\n\n\n<p>I spent some time debugging this problem, but it's really hard to understand what's going on in InstanceValidator<br>\nI just found that in VersionSpecificWorkerContextWrapper line 450 there's codeSystem parameter is set to null</p>",
        "id": 193345951,
        "sender_full_name": "Roman Rodnin",
        "timestamp": 1586363872
    }
]