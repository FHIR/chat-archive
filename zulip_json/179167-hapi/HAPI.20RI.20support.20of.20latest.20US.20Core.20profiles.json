[
    {
        "content": "<p>US Core IG 4.1.0 STU4 Ballot version and several new profiles and profile updates.  Who do I ask to see if the HAPI RI can support them for the Jan connectathon?  <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ?</p>",
        "id": 265620949,
        "sender_full_name": "Eric Haas",
        "timestamp": 1640037901
    },
    {
        "content": "<p>You can spin up the jpa starter project and declare the IGs in the config</p>",
        "id": 265621406,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640038184
    },
    {
        "content": "<p>OK,,,I assume that works for the custom search parameters as well? and just to confirm this is for the RI  at <a href=\"http://hapi.fhir.org/baseR4\">http://hapi.fhir.org/baseR4</a>  ?</p>",
        "id": 265930902,
        "sender_full_name": "Eric Haas",
        "timestamp": 1640276531
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191427\">Jens Villadsen</span> <a href=\"#narrow/stream/179167-hapi/topic/HAPI.20RI.20support.20of.20latest.20US.20Core.20profiles/near/265621406\">said</a>:</p>\n<blockquote>\n<p>You can spin up the jpa starter project and declare the IGs in the config</p>\n</blockquote>\n<p>Let me correct myself - <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> I suggest that you give it a shot by spinning up the jpa starter project with the IG as part of the configuration</p>",
        "id": 265932053,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640277360
    },
    {
        "content": "<p>This one, right? <a href=\"http://hl7.org/fhir/us/core/2022Jan/\">http://hl7.org/fhir/us/core/2022Jan/</a></p>",
        "id": 265932145,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640277408
    },
    {
        "content": "<p>I just tried loading the US Core IG into a vanilla HAPI FHIR jpa starter instance and the loading worked flawlessly. I then posted the patient example from <a href=\"http://hl7.org/fhir/us/core/2022Jan/Patient-example.json.html\">http://hl7.org/fhir/us/core/2022Jan/Patient-example.json.html</a> and tried the search parameter race (<a href=\"http://hl7.org/fhir/us/core/2022Jan/SearchParameter-us-core-race.html\">http://hl7.org/fhir/us/core/2022Jan/SearchParameter-us-core-race.html</a>) which worked as intended. <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> from those sparse efforts I would say that it works as intended.</p>",
        "id": 265948936,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1640289772
    },
    {
        "content": "<p>OK I am just getting starting on this and confused about how this all works since first time using docker.  I have gotten the server running locally with a few tweaks using this CLI command:</p>\n<div class=\"codehilite\"><pre><span></span><code>docker run -p 8080:8080 -e hapi.fhir.allow_external_references=true -e hapi.fhir.narrative_enabled=false  hapiproject/hapi:latest\n</code></pre></div>\n<p>now I want add US Core profiles using the CLI and tried this variable which did not work:</p>\n<div class=\"codehilite\"><pre><span></span><code>-e implementationguides=hl7.fhir.us.core#4.1.0\n</code></pre></div>\n<ol>\n<li>What is the syntax to add an IG via command line?</li>\n<li>does the container use my local copy of the forked repro by default or do I have to tell where to look for it? ( where does it look by default?)</li>\n<li>After adding the IG, will it validate them as well?</li>\n</ol>",
        "id": 266878879,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641339051
    },
    {
        "content": "<p>tried updating a local config file copying from documentation but keep getting :</p>\n<div class=\"codehilite\"><pre><span></span><code>Config data resource &#39;file [[path]/application.yml]&#39; via location &#39;file:{path]application.yml&#39; does not exist\n</code></pre></div>\n<p>for example:</p>\n<div class=\"codehilite\"><pre><span></span><code>docker run -p 8080:8080 -v &quot;$(pwd)/yourLocalFolder:/configs&quot;  -e &quot;--spring.config.location=file:///Users/ehaas/Documents/HAPI/hapi-fhir-jpaserver-starter/src/main/resources/application.yaml&quot; hapiproject/hapi:latest\n</code></pre></div>\n<p>Don't know what I am missing</p>",
        "id": 266886119,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641345039
    },
    {
        "content": "<p>OK fixed that but now getting java memory error....</p>",
        "id": 266888752,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641347853
    },
    {
        "content": "<p>..due to the VSAC package caching.  Tried different -Xmx and -Xms flags. but when try 2 or 4M the process just exits.</p>",
        "id": 266893103,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641352380
    },
    {
        "content": "<p>You need 4Gigs</p>",
        "id": 266902494,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641364315
    },
    {
        "content": "<p>not 4 megs</p>",
        "id": 266912570,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641374137
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> if you can supply me with your application.yaml file I'll have a look</p>",
        "id": 266912595,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641374158
    },
    {
        "content": "<p>ok  thanks !!!  I fixed the config file issue, will try with gigs</p>",
        "id": 266970125,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641406472
    },
    {
        "content": "<p>See eg. <a href=\"https://stackoverflow.com/questions/5374455/what-does-java-option-xmx-stand-for/5374501\">https://stackoverflow.com/questions/5374455/what-does-java-option-xmx-stand-for/5374501</a></p>",
        "id": 266970469,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641406660
    },
    {
        "content": "<p>4 gigs, still a memory error:</p>\n<div class=\"codehilite\"><pre><span></span><code>docker run -p 8080:8080 -v &quot;$(pwd)/yourLocalFolder:/configs&quot;  -e &quot;--spring.config.location=file:///configs/application.yaml&quot; -e JAVA_OPTS=&quot;-Xmx4G -Xms4G&quot; hapiproject/hapi:latest\n</code></pre></div>\n<p>leads to this  <span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span> </p>\n<p><a href=\"/user_uploads/10155/6l5pFUPnGRGEfQGeIkJiesrA/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/6l5pFUPnGRGEfQGeIkJiesrA/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/6l5pFUPnGRGEfQGeIkJiesrA/image.png\"></a></div><p>(docker just kicks out to command prompt)</p>\n<p>this is local on MacBookAir, <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span>   what did you do when you got it to run? It seems to me the vsac package seems to be causing memory issue</p>",
        "id": 266990964,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641416726
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> the JVM inside docker cannot expand beyond what your docker supplies. If you attach your config.yaml I'll give it a try</p>",
        "id": 266997242,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641419972
    },
    {
        "content": "<p>docker = docker engine</p>",
        "id": 266997387,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641420016
    },
    {
        "content": "<p>if you have throttled it down to eg. 0.5 gigs of mem, your JVM cannot expand beyond that</p>",
        "id": 266997490,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641420062
    },
    {
        "content": "<p>do you mean my \"application.yaml\" file or a another file called \"confing.yaml\"?</p>",
        "id": 267007992,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641426176
    },
    {
        "content": "<p>here is the application.yaml file:</p>\n<p><a href=\"/user_uploads/10155/J2qq14BAmGXuOk2_ZXRx4pof/application.yaml\">application.yaml</a></p>",
        "id": 267008042,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641426215
    },
    {
        "content": "<p>your docker engine definetly needs more than 4 gigs of mem - and you probably as well would like to throw the resources in a database and not in a file-based database which your current conf does</p>",
        "id": 267009315,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427084
    },
    {
        "content": "<p>I allocated 7 gigs and then I started seeing other errors probably related to the amount of data in the IG's in combination with the file-based db</p>",
        "id": 267009372,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427146
    },
    {
        "content": "<p>I dont think you even need the <code>-e JAVA_OPTS=\"-Xmx4G -Xms4G\"</code></p>",
        "id": 267009462,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427209
    },
    {
        "content": "<p>If you do, it should be even greater than 4G</p>",
        "id": 267009610,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427279
    },
    {
        "content": "<p>OK so if I set up a db then it should work?</p>",
        "id": 267010456,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641427778
    },
    {
        "content": "<p>... and add more to the docker engine</p>",
        "id": 267010564,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641427845
    },
    {
        "content": "<p>The odds are better I would say</p>",
        "id": 267010672,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427913
    },
    {
        "content": "<p>you could also do it step wise and use the <code>install_transitive_ig_dependencies </code> flipped to false and take on IG at a time</p>",
        "id": 267010737,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641427943
    },
    {
        "content": "<p>so something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>    install_transitive_ig_dependencies: false\n    implementationguides:\n      ##    example from registry (packages.fhir.org)\n      uscore:\n        name: hl7.fhir.us.core\n        version: 4.1.0\n      bulkdata:\n        name: hl7.fhir.uv.bulkdata\n        version: 1.0.1\n      vsac:\n        name: us.nlm.vsac\n        version: 0.3.0\n</code></pre></div>",
        "id": 267010978,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428096
    },
    {
        "content": "<p>you actually do not need the <code>install_transitive_ig_dependencies</code> then</p>",
        "id": 267011028,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428129
    },
    {
        "content": "<p>and then install them one at a time and comment out the rest</p>",
        "id": 267011056,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428143
    },
    {
        "content": "<p>stop the server and then rerun the server with the next IG</p>",
        "id": 267011138,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428178
    },
    {
        "content": "<p>starting from vsac</p>",
        "id": 267011149,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428185
    },
    {
        "content": "<p>and your mem consumption probably wont explode then</p>",
        "id": 267011213,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428219
    },
    {
        "content": "<p>but GLHF - I'm off to bed</p>",
        "id": 267011251,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428241
    },
    {
        "content": "<p>thanks</p>",
        "id": 267011275,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641428250
    },
    {
        "content": "<p>keep me posted if it works out for you</p>",
        "id": 267011434,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641428371
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> did you succeed?</p>",
        "id": 267084690,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641488122
    },
    {
        "content": "<p>I am struggling with getting to connect with mySQL,  I am missing some steps,  I started a mySql in docker and updated the yaml as documented but not connecting.</p>",
        "id": 267113412,
        "sender_full_name": "Eric Haas",
        "timestamp": 1641502754
    },
    {
        "content": "<p>You need to do it as a docker Compose setup</p>",
        "id": 267115139,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1641503628
    }
]