[
    {
        "content": "<p>So starting from hapi-fhir-jpaserver-starter-5.2.0 I've added my custom operations.  Everything starts fine and I'm able to execute this for example </p>\n<p>curl--location --request GET '<a href=\"http://localhost:9027/fhir/Person?identifier=http://intellicentrics.com/alternateIdentifier/wso2Username%7CPatientqa22,http://intellicentrics.com/alternateIdentifier/wso2Username%7CPatientqa24\">http://localhost:9027/fhir/Person?identifier=http://intellicentrics.com/alternateIdentifier/wso2Username%7CPatientqa22,http://intellicentrics.com/alternateIdentifier/wso2Username%7CPatientqa24</a>'</p>\n<p>However if I execute a curl with my custom operation </p>\n<p>curl '<a href=\"http://localhost:9027/fhir/Observation/$lastn\">http://localhost:9027/fhir/Observation/$lastn</a>'</p>\n<p>I get this error</p>\n<p>}~ $ curl '<a href=\"http://localhost:9027/fhir/Observation/$lastn\">http://localhost:9027/fhir/Observation/$lastn</a>'<br>\n{<br>\n  \"resourceType\": \"OperationOutcome\",<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\\"0\\\"&gt;&lt;tr&gt;&lt;td style=\\\"font-weight: bold;\\\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;LastN operation is not enabled on this service, can not process this request&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;\"<br>\n  },<br>\n  \"issue\": [ {<br>\n    \"severity\": \"error\",<br>\n    \"code\": \"processing\",<br>\n    \"diagnostics\": \"LastN operation is not enabled on this service, can not process this request\"<br>\n  } ]<br>\n}</p>\n<p>And on another custom operation I get this error</p>\n<p>curl '<a href=\"http://localhost:9027/fhir/Observation/$quickStats?careteam-member-identifier=http://intellicentrics.com/alternateIdentifier/wso2Username%7Chcp.camelia.coleman%40yopmail.com&amp;careteam-member-type=Practitioner&amp;statistic=average&amp;date=gt2020-12-02T06:00:00\">http://localhost:9027/fhir/Observation/$quickStats?careteam-member-identifier=http://intellicentrics.com/alternateIdentifier/wso2Username%7Chcp.camelia.coleman%40yopmail.com&amp;careteam-member-type=Practitioner&amp;statistic=average&amp;date=gt2020-12-02T06:00:00</a>.</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Invalid request: The FHIR endpoint on this server does not know how to handle GET operation[Observation/$quickStats] with parameters [[date, careteam-member-identifier, statistic, _count, code, filterExpired, careteam-member-type]]&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n</code></pre></div>\n\n<p>},<br>\n  \"issue\": [ {<br>\n    \"severity\": \"error\",<br>\n    \"code\": \"processing\",<br>\n    \"diagnostics\": \"Invalid request: The FHIR endpoint on this server does not know how to handle GET operation[Observation/$quickStats] with parameters [[date, careteam-member-identifier, statistic, _count, code, filterExpired, careteam-member-type]]\"<br>\n  } ]<br>\n}</p>\n<p>What do I need to do to register these custom operations?</p>\n<p>Here's a code sample of the first one \"lastN\" that's failing</p>\n<p>@Service<br>\npublic class ObservationResourceLatestObsProvider implements IResourceProvider {</p>\n<div class=\"codehilite\"><pre><span></span><code>@Autowired\nprivate ResourceLinkResolverService linkResolverService;\n\n@Autowired\nprivate ResourceDao resourceDao;\n\n@Autowired\nprivate ResourceParameterSearchService resourceParameterSearchService;\n\n@Autowired\nprivate PartitionSettings partitionSettings;\n\nprotected static final Logger LOGGER = LoggerFactory.getLogger(ObservationResourceLatestObsProvider.class);\n\n@Operation(name = &quot;$lastn&quot;, idempotent = true)\npublic Parameters latestObservationsByPractitioner(\n        javax.servlet.http.HttpServletRequest theServletRequest,\n        javax.servlet.http.HttpServletResponse theServletResponse,\n        ca.uhn.fhir.rest.api.server.RequestDetails theRequestDetails,\n        @Description(shortDefinition = &quot;The code of the observation type&quot;) @OptionalParam(name = &quot;code&quot;) TokenAndListParam code,\n        @Description(shortDefinition = &quot;Patient&#39;s nominated general practitioner, not the organization that manages the record&quot;) @OperationParam(name = &quot;general-practitioner&quot;) TokenParam practitioner,\n        @Description(shortDefinition = &quot;The subject that the observation is about&quot;) @OperationParam(name = &quot;subject-identifier&quot;) TokenParam subjectIdentifier,\n        @Description(shortDefinition = &quot;The maximum number of observations to return&quot;) @OperationParam(name = &quot;max&quot;) NumberParam max) {\n\n    validateParameters(code, practitioner);\n\n    List&lt;TokenParam&gt; codeParams = ParameterUtil.buildObservationCodeParamList(code);\n</code></pre></div>\n\n<p>Thanks,</p>\n<p>Neil</p>",
        "id": 221177982,
        "sender_full_name": "Neil Lott",
        "timestamp": 1609286273
    }
]