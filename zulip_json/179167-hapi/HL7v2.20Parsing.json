[
    {
        "content": "<p>I'm using the HAPI V25structures to parse HL7v2 message &amp; convert that into FHIR resources. I'm facing a strange issue while receiving and parsing the HL7V2 message using HAPI via TCP listener.</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;Determine encoding for message. The following is the first 50 chars of the message for reference, although this may not be where the issue is: MSH|^~\\\\&amp;|OPENEMR|DrJhonDoe|TEST|UNKNOWN|20210216190432||ADT^A01^ADT_A01|60b647d4-b5a5-4fae-a928-d4a3849de3c8|T|2.5&quot;\n</code></pre></div>\n<p>Strange that I'm not getting this error when I'm trying to send this message as a string in main function. I'm getting this error only when I send the data over TCP to my Java function.</p>\n<p>Here is my Java pgm:</p>\n<div class=\"codehilite\"><pre><span></span><code>public static String getPv1SegmentData(String hl7Message) throws HL7Exception {\n        String hl7RoomConfiguration = &quot;&quot;;\n        try {\n// Im just reading the mapping from another config json\n        String getHl7ConfigFromFile     = HL7HelperFunction.readHl7ConfigFromFile(&quot;Config.json&quot;);\n        String getGqlPath               = getHl7ConfigFromFile.split(&quot;,&quot;)[3].toString();\n        HapiContext context             = new DefaultHapiContext();\n        context.getParserConfiguration().setValidating(false);\n        CanonicalModelClassFactory mcf  = new CanonicalModelClassFactory(&quot;2.5&quot;);\n        context.setModelClassFactory(mcf);\n        PipeParser parser               = context.getPipeParser();\n// Till this it works fine\n\n// this is the portion where its causing error\n        ADT_A01 v25Message              = (ADT_A01) parser.parse(hl7Message);\n        Terser t25                      = new Terser(v25Message);\n        String getPid                   = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[0]);\n        String getBed                   = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[1]);\n        String getRoom                  = t25.get(&quot;/.&quot;+getHl7ConfigFromFile.split(&quot;,&quot;)[2]);\n        String getBuilding              = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[1]);\n        String getFloor                 = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[2]);\n        String getFacility              = t25.get(&quot;/.&quot;+getGqlPath.split(&quot;/&quot;)[0]);\n        // Parse HL7 and create String\n        hl7RoomConfiguration = &quot;Bed:&quot;+getBed+&quot;@&quot;+&quot;Room:&quot;+getRoom+&quot;@&quot;+&quot;Building:&quot;+getBuilding+&quot;@&quot;+&quot;Floor:&quot;+getFloor+&quot;@&quot;+&quot;Facility:&quot;+getFacility+&quot;@&quot;+&quot;PID:&quot;+getPid;\n\n        System.out.println(hl7RoomConfiguration);\n\n        }catch(Exception e) {\n            System.out.println(&quot;get Exception --&gt;&quot;+e);\n        }\n        return hl7RoomConfiguration;\n    }\n</code></pre></div>",
        "id": 226555701,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613500345
    },
    {
        "content": "<p>While receiving the message from the tcp source. Im converting it to string using the UTF-8 character</p>",
        "id": 226608435,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613531449
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>InputStream in = connection.getInputStream();\nOutputStream out = connection.getOutputStream();\nreceivedMessageSize = in.read(receivedByeBuffer);\nString incomingHl7Message = new String(receivedByeBuffer, StandardCharsets.UTF_8);\n</code></pre></div>",
        "id": 226608450,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613531488
    },
    {
        "content": "<p>MSH|^~\\\\...</p>\n<p>I'm a totally a newbie for this. Are the duplicate slash right? Ignore my response if yes.</p>",
        "id": 226612944,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613536571
    },
    {
        "content": "<p>yes. java throws  error with single \\</p>",
        "id": 226613029,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613536676
    },
    {
        "content": "<p>OK</p>",
        "id": 226613079,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613536703
    },
    {
        "content": "<p>i ve posted in stackoverflow too. got 4 upvotes seems like many people problem</p>\n<p><a href=\"https://stackoverflow.com/questions/66230745/hl7v2-hapi-parser-exception-while-receiving-data-via-tcp-ip\">https://stackoverflow.com/questions/66230745/hl7v2-hapi-parser-exception-while-receiving-data-via-tcp-ip</a></p>",
        "id": 226613116,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613536780
    },
    {
        "content": "<p>What if you use other people's example message(s), e.g.: <a href=\"http://www.ringholm.com/docs/04300_en.htm\">http://www.ringholm.com/docs/04300_en.htm</a></p>",
        "id": 226615377,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613539329
    },
    {
        "content": "<p>Same error for all messages</p>",
        "id": 226617082,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613541666
    },
    {
        "content": "<p>I identified the issue. it is because of getting &lt;VT&gt; and &lt;FS&gt; only. When receiving data via normal Basic TCP I am not getting this issue. But this issue I am getting only when receiving the data through MLLP &amp; I couldn't find a better way to handle this characters in the incoming Bytes on  JAVA.</p>",
        "id": 226763136,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1613622121
    },
    {
        "content": "<p>A related page:</p>\n<p>These headers and trailers are usually non-printable characters that would not typically be in the content of HL7 messages. The header is a vertical tab character &lt;VT&gt; its hex value is 0x0b. The trailer is a file separator character &lt;FS&gt; (hex 0x1c) immediately followed by a carriage return &lt;CR&gt; (hex 0x0d)...</p>\n<p><a href=\"http://healthstandards.com/blog/2007/05/02/hl7-mlp-minimum-layer-protocol-defined/\">http://healthstandards.com/blog/2007/05/02/hl7-mlp-minimum-layer-protocol-defined/</a></p>",
        "id": 226811402,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613656001
    },
    {
        "content": "<p>Another one:</p>\n<p><a href=\"https://www.c-sharpcorner.com/article/sending-an-hl7-message-receiving-it-using-a-listener-and-sending-an-acknowledge/\">https://www.c-sharpcorner.com/article/sending-an-hl7-message-receiving-it-using-a-listener-and-sending-an-acknowledge/</a></p>",
        "id": 226812016,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613656279
    },
    {
        "content": "<p>A Java based Tutorial:</p>\n<p>Step 4&amp;5&amp;6 of 8 - transmit/parse a dummy MLLP-wrapped HL7 message</p>\n<p><a href=\"https://saravanansubramanian.com/hl72xjavaprogramming/\">https://saravanansubramanian.com/hl72xjavaprogramming/</a></p>",
        "id": 226812706,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613656570
    },
    {
        "content": "<p>This is more complicated than we thought. One can definitely understand that HL7v2 over tcp dont  behave same as MLLP.MLLP is a frame level protocol You can also see in the last link that he is trying to read as input stream. Which is not possible. We need to read MLLP message special way. Wondering if there is a HAPI code of Version 2 that allows to  read input stream</p>",
        "id": 229632070,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1615371006
    },
    {
        "content": "<p>One way of handling this is using the MLLPMinLowLayer() from HAPI</p>",
        "id": 230290085,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1615778440
    },
    {
        "content": "<p>But if the connection is kept open on the sender side you will still face issue</p>",
        "id": 230290123,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1615778477
    }
]