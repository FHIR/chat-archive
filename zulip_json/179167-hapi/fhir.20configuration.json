[
    {
        "content": "<p>Hello, guys!<br>\nI am going to <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter\">contribute</a> a convenience docker-compose file which supports multistage build and contains some initial configuration via environment variables.<br>\nFor example I found this document that describes how to enable <a href=\"https://smilecdr.com/docs/configuration_categories/fhir_bulk_operations.html#property-fhir-bulk-export-enabled\">FHIR Bulk export</a> but I need help on how to use the Example Property <code>module.[MODULE_ID].config.bulk_export.enabled = false</code> via environment variables.<br>\nAlso I don't understand how <code>applocation.yml file</code>'s  <code>hapi.fhir.bulk_export_enabled</code> property is related to the example mentioned above ( I mean <code>module.[MODULE_ID].config.bulk_export.enabled = false</code>)<br>\nThanks!</p>",
        "id": 223752200,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611412099
    },
    {
        "content": "<p>PS: what is <code>[MODULE_ID]</code></p>",
        "id": 223752225,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611412181
    },
    {
        "content": "<p>PS2: What PATH the application.yml file is located by default in the container</p>",
        "id": 223752362,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611412350
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">version</span><span class=\"p\">:</span> <span class=\"s\">'3.7'</span>\n<span class=\"nt\">services</span><span class=\"p\">:</span>\n  <span class=\"nt\">hapi-fhir-jpaserver-startv2</span><span class=\"p\">:</span>\n    <span class=\"nt\">build</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">.</span>\n    <span class=\"nt\">restart</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">on-failure</span>\n    <span class=\"nt\">ports</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"s\">\"8081:8080\"</span>\n    <span class=\"nt\">volumes</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">hapi-data:/data/hapi</span>\n    <span class=\"nt\">environment</span><span class=\"p\">:</span>\n      <span class=\"nt\">hapi.fhir.bulk_export_enabled</span><span class=\"p\">:</span> <span class=\"s\">\"true\"</span>\n<span class=\"c1\">#      SPRING_CONFIG_LOCATION: 'file:///data/hapi/application.yaml'</span>\n<span class=\"nt\">volumes</span><span class=\"p\">:</span>\n  <span class=\"nt\">hapi-data</span><span class=\"p\">:</span>\n</code></pre></div>\n<p><code>hapi.fhir.bulk_export_enabled: \"true\"</code> value successfully applied.</p>",
        "id": 223752850,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611413042
    },
    {
        "content": "<p>So, the main question is how to understand <a href=\"https://smilecdr.com/docs/configuration_categories/fhir_bulk_operations.html#property-fhir-bulk-export-enabled\">documentation</a> and its  example<code>module.[MODULE_ID].config.bulk_export.enabled = false</code></p>",
        "id": 223753045,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611413299
    },
    {
        "content": "<p>In the container I've built, the yml is located at tomcat…webapps…ROOT…WEB-INF…classes</p>",
        "id": 223754949,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611415818
    },
    {
        "content": "<p>Thanks! Found <code>/usr/local/tomcat/webapps/ROOT/WEB-INF/classes/application.yaml</code></p>",
        "id": 223755375,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611416395
    },
    {
        "content": "<p>Do we need to rebuild the image if we decide to use MySQL instead of H2? or just change application.yml ?</p>",
        "id": 223757596,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611419329
    },
    {
        "content": "<p>Need to create the db and its user/owner first?</p>",
        "id": 223790559,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611454584
    },
    {
        "content": "<p>Mysql container is fine. I have checked it with adminer, the db and its user are created. But hapi container responds with 404 as soon as I switch to use mysql in the application.yaml according to the documentation on github</p>",
        "id": 223799573,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611470339
    },
    {
        "content": "<p>I am using master branch, strictly following the README.md</p>",
        "id": 223799643,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611470490
    },
    {
        "content": "<p>Does the db and app reside within the same network?</p>",
        "id": 223800034,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611471263
    },
    {
        "content": "<p>Maybe docker-compose.yml need to be configured accordingly.</p>",
        "id": 223800138,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611471518
    },
    {
        "content": "<p>Yes! They are in the same network. The docker-compose.yml looks correct.</p>",
        "id": 223800467,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611472183
    },
    {
        "content": "<p>jpa:<br>\n    properties:<br>\n    hibernate.dialect: org.hibernate.dialect.MySQLDialect</p>",
        "id": 223800565,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611472379
    },
    {
        "content": "<p>Yeah! Let me try it</p>",
        "id": 223800576,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611472413
    },
    {
        "content": "<p>Did you set the dialect in the app...yml?</p>",
        "id": 223800579,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611472433
    },
    {
        "content": "<p>I tried it yesterday with MySQL8Dialect</p>",
        "id": 223800623,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611472463
    },
    {
        "content": "<p>No more hints here.  I'm not an IT guy, sorry.</p>",
        "id": 223800690,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611472622
    },
    {
        "content": "<p>Is mysql in a container or separate. My gut feeling is the dB connection isn't working, either hapi user doesn't exist, wrong password, wrong/missing database or user has wrong permissions.</p>\n<p>Hapi will normally generate table structures on start up.</p>",
        "id": 223801598,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1611474504
    },
    {
        "content": "<p>It's working now with the following config:</p>\n<ol>\n<li>docker-compose.yml</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">version</span><span class=\"p\">:</span> <span class=\"s\">\"3.7\"</span>\n<span class=\"nt\">services</span><span class=\"p\">:</span>\n  <span class=\"nt\">hapi-fhir-jpaserver-start</span><span class=\"p\">:</span>\n    <span class=\"nt\">build</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">.</span>\n    <span class=\"nt\">restart</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">on-failure</span>\n    <span class=\"nt\">ports</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"s\">\"8080:8080\"</span>\n    <span class=\"nt\">volumes</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">./configs/application.yaml:/data/hapi/application.yaml</span>\n    <span class=\"nt\">environment</span><span class=\"p\">:</span>\n      <span class=\"nt\">SPRING_CONFIG_LOCATION</span><span class=\"p\">:</span> <span class=\"s\">'file:///data/hapi/application.yaml'</span>\n\n  <span class=\"nt\">hapi-fhir-mysql</span><span class=\"p\">:</span>\n    <span class=\"nt\">image</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">mysql:5</span>\n    <span class=\"nt\">container_name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">hapi-fhir-mysql</span>\n    <span class=\"nt\">restart</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">always</span>\n    <span class=\"nt\">environment</span><span class=\"p\">:</span>\n      <span class=\"nt\">MYSQL_DATABASE</span><span class=\"p\">:</span> <span class=\"s\">'hapi'</span>\n      <span class=\"nt\">MYSQL_USER</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n      <span class=\"nt\">MYSQL_PASSWORD</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n      <span class=\"nt\">MYSQL_ROOT_PASSWORD</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>application.yml</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">spring</span><span class=\"p\">:</span>\n  <span class=\"nt\">datasource</span><span class=\"p\">:</span>\n    <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"s\">'jdbc:mysql://hapi-fhir-mysql:3306/hapi'</span>\n    <span class=\"nt\">username</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">admin</span>\n    <span class=\"nt\">password</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">admin</span>\n    <span class=\"nt\">driverClassName</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">com.mysql.jdbc.Driver</span>\n  <span class=\"nt\">jpa</span><span class=\"p\">:</span>\n    <span class=\"nt\">properties</span><span class=\"p\">:</span>\n      <span class=\"nt\">hibernate.dialect</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">org.hibernate.dialect.MySQLDialect</span>\n</code></pre></div>",
        "id": 223802042,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611475225
    },
    {
        "content": "<p>pay attention: <br>\n1.<code>mysql:5</code> not <code>mysql:latest</code> in docker-compose yml</p>\n<ol start=\"2\">\n<li><code>hibernate.dialect</code> needs to be set as <code>org.hibernate.dialect.MySQLDialect</code></li>\n</ol>\n<p>Thanks!</p>",
        "id": 223802139,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611475356
    },
    {
        "content": "<p>I think its caused because the dialect gets never set because of this bug: <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/issues/199\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/issues/199</a></p>",
        "id": 223802223,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1611475503
    },
    {
        "content": "<p>Dirty workaround: change the default dialect in the java class</p>",
        "id": 223802235,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1611475531
    },
    {
        "content": "<p>Dialect is automatically deduced</p>",
        "id": 223802828,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1611476430
    },
    {
        "content": "<p>See <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/java/ca/uhn/fhir/jpa/starter/JpaHibernateDialectProvider.java\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/java/ca/uhn/fhir/jpa/starter/JpaHibernateDialectProvider.java</a></p>",
        "id": 223802851,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1611476489
    },
    {
        "content": "<p>Oh, right. Had a similar issue but the reason wasn‘t the dialect, but the lucene folder.</p>",
        "id": 223802899,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1611476572
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> yeah, you are right!</p>",
        "id": 223802908,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611476589
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"376706\">@Vasyl Herman</span> Congrats!</p>",
        "id": 223804888,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611480157
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192103\">@Lin Zhang</span> Thank you !!!</p>",
        "id": 223804899,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611480179
    },
    {
        "content": "<p>I am not sure why, it's working with <code>mysql:5</code></p>",
        "id": 223804916,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611480228
    },
    {
        "content": "<p>no other options need to be changed</p>",
        "id": 223804957,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611480249
    },
    {
        "content": "<p>The db init was configed/executed when using PostgreSQL.</p>",
        "id": 223805019,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611480363
    },
    {
        "content": "<p>so, you think it's better to use PostgreSQL ?</p>",
        "id": 223805053,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611480440
    },
    {
        "content": "<p>I mean it might also related to the issue.</p>",
        "id": 223805114,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611480549
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192103\">@Lin Zhang</span> <br>\nAlso, do you think it's worth to change <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/docker-compose.yml\">docker-compose.yml</a>? <code>image: mysql:latest</code> --&gt; <code>image: mysql:5</code> ?</p>",
        "id": 223805169,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611480620
    },
    {
        "content": "<p>I haven't tried MySQL, i.e., no experience with MySQL.</p>",
        "id": 223805241,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611480753
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192103\">@Lin Zhang</span> <br>\nAlso, let me ask you another question:<br>\nI have <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/wiki/Let's-Build---DevDays-US-2020#seeding-some-data\">seeded two patients</a> but when I refresh the page it doesn't show summary next to Patient resource as shown here on <a href=\"http://hapi.fhir.org/\">global server</a><br>\n<a href=\"/user_uploads/10155/75xuLidPByBjiKGPnj1Dv1rM/summary.png\">summary.png</a><br>\nCan you please help with that?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/75xuLidPByBjiKGPnj1Dv1rM/summary.png\" title=\"summary.png\"><img src=\"/user_uploads/10155/75xuLidPByBjiKGPnj1Dv1rM/summary.png\"></a></div>",
        "id": 223805828,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611481806
    },
    {
        "content": "<p>It's a time lag I think. But it's also bothering to me.  Maybe it's related to indexing config such as frequency.</p>\n<p>In the meantime, the count would include the (logically) deleted resources.</p>",
        "id": 223806083,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611482299
    },
    {
        "content": "<p>Great, I have elasticsearch enabled, now summary is shown</p>",
        "id": 223806447,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611482904
    },
    {
        "content": "<p>no, I might be wrong. I have disabled it now, summary is shown anyway</p>",
        "id": 223806513,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611483010
    },
    {
        "content": "<p>Only I know it laggs.</p>",
        "id": 223807031,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611483961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"192103\">Lin Zhang</span> <a href=\"#narrow/stream/179167-hapi/topic/fhir.20configuration/near/223806083\">said</a>:</p>\n<blockquote>\n<p>Maybe it's related to indexing config such as frequency.</p>\n</blockquote>\n<p>Can you please tell me where this config located? it's been more then an hour since I put a new Patient but the count hasn't been updated yet.</p>",
        "id": 223809289,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1611487556
    },
    {
        "content": "<p>Sorry, I don't know the config. But the Web UI might be related to:</p>\n<p><a href=\"https://github.com/hapifhir/hapi-fhir/tree/master/hapi-fhir-testpage-overlay\">https://github.com/hapifhir/hapi-fhir/tree/master/hapi-fhir-testpage-overlay</a></p>",
        "id": 223811282,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1611490720
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"376706\">Vasil Herman</span> <a href=\"#narrow/stream/179167-hapi/topic/fhir.20configuration/near/223802042\">said</a>:</p>\n<blockquote>\n<p>It's working now with the following config:</p>\n<ol>\n<li>docker-compose.yml</li>\n</ol>\n<div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">version</span><span class=\"p\">:</span> <span class=\"s\">\"3.7\"</span>\n<span class=\"nt\">services</span><span class=\"p\">:</span>\n  <span class=\"nt\">hapi-fhir-jpaserver-start</span><span class=\"p\">:</span>\n    <span class=\"nt\">build</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">.</span>\n    <span class=\"nt\">restart</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">on-failure</span>\n    <span class=\"nt\">ports</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"s\">\"8080:8080\"</span>\n    <span class=\"nt\">volumes</span><span class=\"p\">:</span>\n      <span class=\"p p-Indicator\">-</span> <span class=\"l l-Scalar l-Scalar-Plain\">./configs/application.yaml:/data/hapi/application.yaml</span>\n    <span class=\"nt\">environment</span><span class=\"p\">:</span>\n      <span class=\"nt\">SPRING_CONFIG_LOCATION</span><span class=\"p\">:</span> <span class=\"s\">'file:///data/hapi/application.yaml'</span>\n\n  <span class=\"nt\">hapi-fhir-mysql</span><span class=\"p\">:</span>\n    <span class=\"nt\">image</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">mysql:5</span>\n    <span class=\"nt\">container_name</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">hapi-fhir-mysql</span>\n    <span class=\"nt\">restart</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">always</span>\n    <span class=\"nt\">environment</span><span class=\"p\">:</span>\n      <span class=\"nt\">MYSQL_DATABASE</span><span class=\"p\">:</span> <span class=\"s\">'hapi'</span>\n      <span class=\"nt\">MYSQL_USER</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n      <span class=\"nt\">MYSQL_PASSWORD</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n      <span class=\"nt\">MYSQL_ROOT_PASSWORD</span><span class=\"p\">:</span> <span class=\"s\">'admin'</span>\n</code></pre></div>\n<ol start=\"2\">\n<li>application.yml</li>\n</ol>\n<p><div class=\"codehilite\" data-code-language=\"YAML\"><pre><span></span><code><span class=\"nt\">spring</span><span class=\"p\">:</span>\n  <span class=\"nt\">datasource</span><span class=\"p\">:</span>\n    <span class=\"nt\">url</span><span class=\"p\">:</span> <span class=\"s\">'jdbc:mysql://hapi-fhir-mysql:3306/hapi'</span>\n    <span class=\"nt\">username</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">admin</span>\n    <span class=\"nt\">password</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">admin</span>\n    <span class=\"nt\">driverClassName</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">com.mysql.jdbc.Driver</span>\n  <span class=\"nt\">jpa</span><span class=\"p\">:</span>\n    <span class=\"nt\">properties</span><span class=\"p\">:</span>\n      <span class=\"nt\">hibernate.dialect</span><span class=\"p\">:</span> <span class=\"l l-Scalar l-Scalar-Plain\">org.hibernate.dialect.MySQLDialect</span>\n</code></pre></div><br>\n</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"376706\">@Vasil Herman</span> <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> I am trying to run HAPI 5.3 in AWS Fargate (its like a Kubernetes blackbox)  is it possible to override <code>application.yml</code> settings using environment variables like MYSQL_PASS etc</p>",
        "id": 234875326,
        "sender_full_name": "dsh",
        "timestamp": 1618587422
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191783\">@dsh</span> !<br>\nI think so, It's possible. I didn't try.</p>",
        "id": 234897841,
        "sender_full_name": "Vasyl Herman",
        "timestamp": 1618596540
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> any idea ?</p>",
        "id": 234913869,
        "sender_full_name": "dsh",
        "timestamp": 1618604034
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191783\">@dsh</span> : I try to config Starter project with mysql but it always use H2. Do you have the same problem ? My config<br>\n  datasource:<br>\n    url: 'jdbc:mysql://localhost:3307/hapi_dstu4'<br>\n    username: root<br>\n    password: xxxxx<br>\n    driverClassName: com.mysql.jdbc.Driver<br>\n    max-active: 15</p>\n<p>I found the problem, thanks</p>",
        "id": 235308632,
        "sender_full_name": "Jame Dang",
        "timestamp": 1618908183
    }
]