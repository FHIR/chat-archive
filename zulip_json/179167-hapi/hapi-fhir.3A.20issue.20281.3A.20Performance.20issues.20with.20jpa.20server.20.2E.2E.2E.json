[
    {
        "content": "<p>ftprod opened <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281\">issue 281</a></p>\n<blockquote>\n<p>I encounter performance issues with the 1.3 version of the jpa server. </p>\n<p>## Use case: <br>\nI create or update Patient (for example). Patients contain only some data (name, birthdate, gender...) and often a link to an existing practitioner. <br>\nI use an \"api transaction\" to insert 50 Patients at a time.</p>\n<p>## Single Patient insert time : <br>\n- <strong>v1.3</strong>: 160ms<br>\n- <strong>v1.2</strong>:   6ms</p>\n<p>## Environment : <br>\nApache Tomcat 8<br>\nMysql server 5.6<br>\nJava jdk oracle 8</p>\n<p>We tested that on 10k entries with the same result. <br>\nSo we have to rollback to v1.2.</p>\n</blockquote>",
        "id": 153812036,
        "sender_full_name": "Zulip HAPI Bot",
        "timestamp": 1452600165
    },
    {
        "content": "<p>jamesagnew <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-170895909\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-170895909\">commented</a> on <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281\">issue 281</a></p>\n<blockquote>\n<p>Hi @ftprod,</p>\n<p>This is interesting, thanks for providing numbers. The main difference between 1.2 and 1.3 is the addition of Hibernate Search (lucene) indexing for fulltext search. I wonder if this is the culprit.</p>\n<p>Can you try re-running your tests with hibernate search disabled? You can accomplish this by setting the property <code>hibernate.search.autoregister_listeners</code> to <code>false</code>. If you're using Spring Java configuration, you can set this in your jpaProperties() method, e.g.</p>\n<div class=\"codehilite\"><pre>    <span class=\"kd\">private</span> <span class=\"n\">Properties</span> <span class=\"nf\">jpaProperties</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n        <span class=\"n\">Properties</span> <span class=\"n\">extraProperties</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">Properties</span><span class=\"o\">();</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.dialect&quot;</span><span class=\"o\">,</span> <span class=\"n\">org</span><span class=\"o\">.</span><span class=\"na\">hibernate</span><span class=\"o\">.</span><span class=\"na\">dialect</span><span class=\"o\">.</span><span class=\"na\">DerbyTenSevenDialect</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.format_sql&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;true&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.show_sql&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.hbm2ddl.auto&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;update&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.jdbc.batch_size&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;20&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.cache.use_query_cache&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.cache.use_second_level_cache&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.cache.use_structured_entries&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.cache.use_minimal_puts&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.search.default.directory_provider&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;filesystem&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.search.default.indexBase&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;target/lucenefiles&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.search.lucene_version&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;LUCENE_CURRENT&quot;</span><span class=\"o\">);</span>\n        <span class=\"n\">extraProperties</span><span class=\"o\">.</span><span class=\"na\">put</span><span class=\"o\">(</span><span class=\"s\">&quot;hibernate.search.autoregister_listeners&quot;</span><span class=\"o\">,</span> <span class=\"s\">&quot;false&quot;</span><span class=\"o\">);</span> <span class=\"c1\">// set to false to disable lucene</span>\n        <span class=\"k\">return</span> <span class=\"n\">extraProperties</span><span class=\"o\">;</span>\n    <span class=\"o\">}</span>\n</pre></div>\n\n\n</blockquote>",
        "id": 153812037,
        "sender_full_name": "Zulip HAPI Bot",
        "timestamp": 1452601570
    },
    {
        "content": "<p>ftprod <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-170973441\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-170973441\">commented</a> on <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281\">issue 281</a></p>\n<blockquote>\n<p>It is difficult to test in my context because the application makes a search before an insertion (and the search doesn’t work with autoregister_listeners=false).</p>\n<p>But, my first impression is that didn’t change the insertion time (more than 100ms).</p>\n<p>I can make other test / investigation if you want. </p>\n</blockquote>",
        "id": 153812099,
        "sender_full_name": "Zulip HAPI Bot",
        "timestamp": 1452617722
    },
    {
        "content": "<p>jamesagnew <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-171033752\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-171033752\">commented</a> on <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281\">issue 281</a></p>\n<blockquote>\n<p>Hmm, maybe that's not the bext way to disable lucene then..<br>\nCan you try it with:<br>\n<code>extraProperties.put(\"hibernate.search.indexing_strategy\", \"manual\");</code></p>\n</blockquote>",
        "id": 153812114,
        "sender_full_name": "Zulip HAPI Bot",
        "timestamp": 1452628387
    },
    {
        "content": "<p>ftprod <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-176867319\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281#issuecomment-176867319\">commented</a> on <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/281\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/281\">issue 281</a></p>\n<blockquote>\n<p>Sorry for my late reply. <br>\nI tried this setting , but the result is similar.</p>\n</blockquote>",
        "id": 153812481,
        "sender_full_name": "Zulip HAPI Bot",
        "timestamp": 1454087507
    }
]