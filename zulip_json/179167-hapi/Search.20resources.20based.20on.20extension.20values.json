[
    {
        "content": "<p>Hello,</p>\n<p>I have some extensions in Encounter FHIR object. How do I implement \"query matcher\" against extension? Any reference implementation available?</p>\n<p>Br,<br>\nMarkku</p>",
        "id": 203930090,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1594803123
    },
    {
        "content": "<p>what's a 'query matcher'?</p>",
        "id": 203936400,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1594807884
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179167-hapi/topic/Search.20resources.20based.20on.20extension.20values/near/203936400\">said</a>:</p>\n<blockquote>\n<p>what's a 'query matcher'?</p>\n</blockquote>\n<p>By \"query matcher\" I mean a way of doing queries against attributes in an extension. As an example, how to query Encounters having valueString \"checkin\"?</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Encounter&quot;,\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://something.com/fhir/#currentQueueStatus&quot;,\n      &quot;valueString&quot;: &quot;checkin&quot;\n    }\n  ],\n...\n}\n</code></pre></div>",
        "id": 204046913,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1594877604
    },
    {
        "content": "<p>You need to create a custom search parameter. This blog goes over the process: <a href=\"https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/\">https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/</a></p>",
        "id": 204062989,
        "sender_full_name": "James Agnew",
        "timestamp": 1594892212
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191319\">James Agnew</span> Thank you for this information. I got it working in Unit Test by creating SearchParam object before adding any test data to h2 database. </p>\n<div class=\"codehilite\"><pre><span></span><code>  private static void initialiseTestDatabase() throws ParseException {\n    client.create().resource(createSearchParam()).execute();\n\n    // Location with room\n    Location l = LocationFactory.create();\n    IIdType locationId = client.create().resource(l).execute().getId();\n...\n</code></pre></div>\n\n\n<p>What would be proper way to create SearchParam object in hapi-fhir-jpaserver-starter fork? I tried create object at the very end of the JpaRestfulServer initialise with no luck:</p>\n<div class=\"codehilite\"><pre><span></span><code>protected void initialize() throws ServletException {\n...\n    IGenericClient client = ctx.newRestfulGenericClient(serverAddress);\n    client.create().resource(createSearchParam()).execute();\n</code></pre></div>\n\n\n<p>It did not work. It seems you cannot call create inside initialise method:</p>\n<div class=\"codehilite\"><pre><span></span><code>ca.uhn.fhir.rest.client.exceptions.FhirClientConnectionException: Failed to retrieve the server metadata statement during client initialization. URL used was http://localhost:8888/fhir/metadata\n    at ca.uhn.fhir.rest.client.impl.RestfulClientFactory.validateServerBase(RestfulClientFactory.java:312)\n</code></pre></div>\n\n\n<p>Should I start listening Spring or Jetty's lifecycle events that are called after initialisation is ready?</p>",
        "id": 204187017,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1594978223
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 204188728,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1594979549
    },
    {
        "content": "<p>I did not get servlet approach operating. I think that the issue is that no one is listening port 8080 when servlets is being initialised.</p>\n<div class=\"codehilite\"><pre><span></span><code>~/repos/my-fhir-service/src/main/webapp/WEB-INF/web.xml\n\n    &lt;servlet&gt;\n        &lt;servlet-name&gt;fhirServlet&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;ca.uhn.fhir.jpa.starter.JpaRestfulServer&lt;/servlet-class&gt;\n        &lt;load-on-startup&gt;2&lt;/load-on-startup&gt;\n    &lt;/servlet&gt;\n    &lt;servlet&gt;\n        &lt;servlet-name&gt;myMigration&lt;/servlet-name&gt;\n        &lt;servlet-class&gt;my.project.MyMigration&lt;/servlet-class&gt;\n        &lt;load-on-startup&gt;3&lt;/load-on-startup&gt;\n    &lt;/servlet&gt;\n\npublic class MyMigration extends RestfulServer {\n  @Override\n  protected void initialize() throws ServletException {\n    String serverAddress = HapiProperties.getServerAddress();\n    IGenericClient client = ctx.newRestfulGenericClient(serverAddress);\n    client.create().resource(createExtensionSearchParam()).execute();\n}\n</code></pre></div>\n\n\n<p>Is there any events (Pointcut?) that are sent when JpaRestfulServer initialisation is ready and servlet is listening in port 8080?</p>\n<p><a href=\"https://smilecdr.com/hapi-fhir/apidocs/hapi-fhir-base/ca/uhn/fhir/interceptor/api/Pointcut.html\">https://smilecdr.com/hapi-fhir/apidocs/hapi-fhir-base/ca/uhn/fhir/interceptor/api/Pointcut.html</a></p>\n<p>Or would it be better to have a separate project that runs all sort of migrations to database like ads the Search Params? Perhaps there is already something ready made frameworks for this e.g.</p>\n<p><a href=\"https://hapifhir.io/hapi-fhir/docs/server_jpa/upgrading.html\">https://hapifhir.io/hapi-fhir/docs/server_jpa/upgrading.html</a></p>",
        "id": 204449034,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1595265137
    },
    {
        "content": "<p>Is this the only Java implementation of the FHIR standard?</p>",
        "id": 204618295,
        "sender_full_name": "Alex Vilensky",
        "timestamp": 1595377181
    },
    {
        "content": "<p>no there are others, but none are complete or open source or tested/reliable anything like HAPI</p>",
        "id": 204618938,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1595377859
    },
    {
        "content": "<p>I do not know any other approaches than implementing a migration application that runs creates. Search Param objects to HAPI FHIR.</p>",
        "id": 204644103,
        "sender_full_name": "Markku Nikkanen",
        "timestamp": 1595408741
    }
]