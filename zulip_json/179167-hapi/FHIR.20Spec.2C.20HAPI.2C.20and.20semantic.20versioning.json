[
    {
        "content": "<p>We have StructuredDefinitions from the IG Publisher that are stamped as FHIR 4.0.1, but are being rejected by HAPI (4.0.3) as \"Unknown FHIRVersion code '4.0.1'\"<br>\nIs it unreasonable to expect (at least) patch versions to be forward compatible?</p>",
        "id": 180388686,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573433428
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> this is about to an acute pressure point on HAPI. I hope that your imminent release supports 4.0.1. I think I've found and fixed all the points where my code needs to.</p>",
        "id": 180388902,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573433861
    },
    {
        "content": "<p>but Michael has a deeper point in mind that I don't know how to solve around the FHIRVersion enumeration</p>",
        "id": 180388948,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573433886
    },
    {
        "content": "<p>At the moment, 4.1.0-SNAPSHOT (from maven) is rejecting 4.0.1</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n    <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;OperationOutcome&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;issue&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;severity&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;error&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;processing&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;diagnostics&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Failed to parse request body as JSON resource. Error was: Invalid attribute value \\&quot;4.0.1\\&quot;: Unknown FHIRVersion code &#39;4.0.1&#39;&quot;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre></div>",
        "id": 180390191,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573436236
    },
    {
        "content": "<p>I note that the current (master) dependency from HAPI is <code>&lt;fhir_core_version&gt;4.0.26-SNAPSHOT&lt;/fhir_core_version&gt;</code> and not the latest: <code>&lt;fhir_core_version&gt;4.0.33-SNAPSHOT&lt;/fhir_core_version&gt;</code></p>",
        "id": 180394968,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573444230
    },
    {
        "content": "<p>Updating to 4.0.33-SNAPSHOT and I now get:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n    <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;OperationOutcome&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;issue&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;severity&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;error&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;processing&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;diagnostics&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;cvc-enumeration-valid: Value &#39;4.0.1&#39; is not facet-valid with respect to enumeration &#39;[0.01, 0.05, 0.06, 0.11, 0.0.80, 0.0.81, 0.0.82, 0.4.0, 0.5.0, 1.0.0, 1.0.1, 1.0.2, 1.1.0, 1.4.0, 1.6.0, 1.8.0, 3.0.0, 3.0.1, 3.3.0, 3.5.0, 4.0.0]&#39;. It must be a value from the enumeration.&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;location&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;Line[1] Col[26685]&quot;</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;Line 1, Col 26685&quot;</span>\n            <span class=\"p\">]</span>\n        <span class=\"p\">},</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;severity&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;error&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;processing&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;diagnostics&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;cvc-attribute.3: The value &#39;4.0.1&#39; of attribute &#39;value&#39; on element &#39;fhirVersion&#39; is not valid with respect to its type, &#39;FHIRVersion-list&#39;.&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;location&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;Line[1] Col[26685]&quot;</span><span class=\"p\">,</span>\n                <span class=\"s2\">&quot;Line 1, Col 26685&quot;</span>\n            <span class=\"p\">]</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre></div>",
        "id": 180395485,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573445114
    },
    {
        "content": "<p>this is a schema error</p>",
        "id": 180396290,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573446112
    },
    {
        "content": "<p>updating <code>hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/schema/fhir-single.xsd</code> in co junction with changing <code>fhir_core_version</code> seems to fix this ; not sure if it creates other problems though</p>",
        "id": 180463808,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573509564
    },
    {
        "content": "<p>The HAPI 4.1.0 release does support FHIR 4.0.1, confirmed this afternoon- The branch that updates to the latest core structures isn't merged yet, it's  likely the last merge before release.</p>\n<p>this is a good point about the XSDs though, I did not update them and I should do that.</p>",
        "id": 180470671,
        "sender_full_name": "James Agnew",
        "timestamp": 1573517217
    },
    {
        "content": "<p>And <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> no, that shouldn't cause any other issues.</p>",
        "id": 180470691,
        "sender_full_name": "James Agnew",
        "timestamp": 1573517243
    },
    {
        "content": "<p>Is there also a change to be made to ensure that any subsequent change to 4.0.2 wouldn't break things?</p>",
        "id": 180470757,
        "sender_full_name": "Jim Steel",
        "timestamp": 1573517293
    },
    {
        "content": "<p>It's arguable that we shouldn't throw an exception when putting an invalid string into an Enumeration since that's a validation error. Currently though, 4.0.2 would be rejected.</p>",
        "id": 180470791,
        "sender_full_name": "James Agnew",
        "timestamp": 1573517355
    },
    {
        "content": "<p>Yeah, that doesn't seem like very semantic versioning</p>",
        "id": 180470802,
        "sender_full_name": "Jim Steel",
        "timestamp": 1573517386
    },
    {
        "content": "<p>(if one could be said to be 'very' or 'somewhat' semantic!)</p>",
        "id": 180470852,
        "sender_full_name": "Jim Steel",
        "timestamp": 1573517413
    },
    {
        "content": "<p>I imagine this might be too late for 4.1.0, should I make a github issue for a later release?</p>",
        "id": 180470945,
        "sender_full_name": "Jim Steel",
        "timestamp": 1573517529
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  Thanks - running the tests throws up a bunch of errors relating to hard-coded expectations of 4.0.0 but also 3.0.1 vs 3.0.2 and the dstu3 XSD</p>",
        "id": 180472443,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1573519705
    },
    {
        "content": "<p>hmm. I think that there's a wider question than for HAPI about accepting these. it's FHIR that says these are not valid, not HAPI</p>",
        "id": 180475487,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573524251
    },
    {
        "content": "<p>Ah, OK</p>",
        "id": 180478143,
        "sender_full_name": "Jim Steel",
        "timestamp": 1573528761
    }
]