[
    {
        "content": "<p>Hi!<br>\nI am new with HAPI FHIR and asking for help with my task.</p>\n<p>I want to pass a list of Observation to the method in my Observation resource provider.<br>\nWhen I try to do</p>\n<p>@Create<br>\npublic MethodOutcome createObservationResult(@ResourceParam List&lt;Observation&gt; results) {<br>\n...<br>\n}</p>\n<p>I face a multiple issues such as incorrect resource type, wrong json.<br>\nCould you advise me a correct approach for that task?</p>",
        "id": 157280670,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1548949340
    },
    {
        "content": "<p>Hi Valeriy.</p>\n<p>I think for the <code>@Create</code> method of the Observation provider he expects the <code>@ResourceParam</code> to be a plain Observation, not a list of observations. Not sure if that can be changed, but what you could do is either use a <code>transaction</code> bundle to post multiple observations at once, or you implement a custom operation on your provider, which can then probably can take a list of observations.</p>\n<p>Hope this helps somewhat.<br>\nBest regards,<br>\nLars</p>",
        "id": 157337766,
        "sender_full_name": "Lars Rückert",
        "timestamp": 1549009832
    },
    {
        "content": "<p>Hi Lars,<br>\nThank you for your answer.</p>\n<p>I have googled for information about HAPI custom operation, but didn't find useful information(only about standard REST operations).<br>\nMay be you can point me on place in HAPI documentation or another place about custom operation in HAPI?<br>\nThanks.</p>",
        "id": 157344734,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549018339
    },
    {
        "content": "<p>I think custom operation is a wrong term. I think you can find the basic information in the RestfulOperation Docu:<br>\n<a href=\"http://hapifhir.io/doc_rest_operations.html#_toc_extended_operations\" target=\"_blank\" title=\"http://hapifhir.io/doc_rest_operations.html#_toc_extended_operations\">http://hapifhir.io/doc_rest_operations.html#_toc_extended_operations</a></p>",
        "id": 157346504,
        "sender_full_name": "Lars Rückert",
        "timestamp": 1549020512
    },
    {
        "content": "<p>the best way to learn how to implement custom operations in hapi is to look at existing operations. I implemented $document recently and had a look on Patient$everything and other implemented operations to get a feeling for it.</p>",
        "id": 157349106,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1549023883
    },
    {
        "content": "<p>Thank you for the link, it helps a lot.</p>\n<p>But as I can see in documentation for extended operations \"FHIR allows operation parameters to be of a Search parameter type (e.g. token) instead of a FHIR datatype (e.g. Coding).\"</p>\n<p>Looks like I am not able to pass List&lt;Observation&gt; to extended operation<br>\n:-(</p>",
        "id": 157350388,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549025271
    },
    {
        "content": "<p>You can give a resource though, so you could just send a Bundle of Observations. Then your  operation can work through the bundle entries, just like it would work through a list.</p>",
        "id": 157350558,
        "sender_full_name": "Lars Rückert",
        "timestamp": 1549025446
    },
    {
        "content": "<p>Is this correct bundle to send?</p>\n<p>{<br>\n    \"resourceType\": \"Bundle\",<br>\n    \"id\": \"cf288d1c-6828-4a63-a3c1-3d503a1e7759\",<br>\n    \"meta\": {<br>\n        \"lastUpdated\": \"2019-01-31T14:53:33.392+02:00\"<br>\n    },<br>\n    \"type\": \"message\",<br>\n    \"total\": 3,<br>\n    \"link\": [<br>\n        {<br>\n            \"relation\": \"self\",<br>\n            \"url\": \"<a href=\"http://localhost:8089/fhir/Observation\" target=\"_blank\" title=\"http://localhost:8089/fhir/Observation\">http://localhost:8089/fhir/Observation</a>\"<br>\n        }<br>\n    ],<br>\n    \"entry\": [<br>\n        {<br>\n            \"fullUrl\": \"<a href=\"http://localhost:8089/fhir/Observation/333\" target=\"_blank\" title=\"http://localhost:8089/fhir/Observation/333\">http://localhost:8089/fhir/Observation/333</a>\",<br>\n            \"resource\": {<br>\n                \"resourceType\": \"Observation\",<br>\n                \"id\": \"333\",<br>\n                \"basedOn\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"performer\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"component\": [<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"name-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"aaa\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"result-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"bbb\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"unit-of-measurement\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ccc\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"reference-interval\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ddd\"<br>\n                    }<br>\n                ]<br>\n            }<br>\n        },<br>\n        {<br>\n            \"fullUrl\": \"<a href=\"http://localhost:8089/fhir/Observation/333\" target=\"_blank\" title=\"http://localhost:8089/fhir/Observation/333\">http://localhost:8089/fhir/Observation/333</a>\",<br>\n            \"resource\": {<br>\n                \"resourceType\": \"Observation\",<br>\n                \"id\": \"333\",<br>\n                \"basedOn\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"performer\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"component\": [<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"name-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"aaa\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"result-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"bbb\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"unit-of-measurement\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ccc\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"reference-interval\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ddd\"<br>\n                    }<br>\n                ]<br>\n            }<br>\n        },<br>\n        {<br>\n            \"fullUrl\": \"<a href=\"http://localhost:8089/fhir/Observation/333\" target=\"_blank\" title=\"http://localhost:8089/fhir/Observation/333\">http://localhost:8089/fhir/Observation/333</a>\",<br>\n            \"resource\": {<br>\n                \"resourceType\": \"Observation\",<br>\n                \"id\": \"333\",<br>\n                \"basedOn\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"performer\": [<br>\n                    {<br>\n                        \"reference\": \"referral-id\"<br>\n                    }<br>\n                ],<br>\n                \"component\": [<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"name-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"aaa\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"result-of-analysis\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"bbb\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"unit-of-measurement\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ccc\"<br>\n                    },<br>\n                    {<br>\n                        \"code\": {<br>\n                            \"coding\": [<br>\n                                {<br>\n                                    \"code\": \"reference-interval\"<br>\n                                }<br>\n                            ]<br>\n                        },<br>\n                        \"valueString\": \"ddd\"<br>\n                    }<br>\n                ]<br>\n            }<br>\n        }<br>\n    ]<br>\n}</p>",
        "id": 157352194,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549027297
    },
    {
        "content": "<p>Your reference to referral-id is not valid, should be Referralrequest/referral-id or an absolute URL. You can validate your Bundle yourself against public FHIR servers using the $validate operation, there are more errors in this bundle.</p>",
        "id": 157352485,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1549027628
    },
    {
        "content": "<p>You also chose Message as Bundle Type, which would need a MessageHeader as the First Resource of the bundle. I would go for batch if you want to send this to your custom Operation</p>",
        "id": 157352604,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1549027763
    },
    {
        "content": "<p>just read your question in the implementers stream, your custom operation has to be on the Bundle Endpoint, not on Observation.</p>",
        "id": 157353750,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1549028899
    },
    {
        "content": "<p>Thank you a lot!!!<br>\nI am fixing my bundle json.</p>\n<p>I implement the follows operation method inside Observation provider (&lt;base&gt;/Observation)</p>\n<div class=\"codehilite\"><pre><span></span>@Operation(name=&quot;$OP_SAVE_OBSERVATION_RESULTS&quot;)\npublic MethodOutcome saveObservationResult(\n        @OperationParam(name=&quot;Observation.class&quot;) List&amp;lt;Observation&amp;gt; theObservation)\n</pre></div>\n\n\n<p>{<br>\n        return new MethodOutcome();<br>\n    }</p>\n<p>When I send my bundle json inside method I have a list with one Observation which has all values null.</p>\n<p>Is it because of incorrect json or I am doing something wrong?</p>",
        "id": 157353752,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549028907
    },
    {
        "content": "<p>Very strange situation.<br>\nI don't understand what happened, but now expected list of observations always comes as null.<br>\n:-(</p>",
        "id": 157366940,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549040204
    },
    {
        "content": "<p>Guys, I am lost. <br>\nIs it possible at all to implement and use the follows method to pass list of Observations into Observation resource provider :</p>\n<div class=\"codehilite\"><pre><span></span>@Operation(name=&quot;$saveObservationResults&quot;)\npublic MethodOutcome saveObservationResults(\n        @OperationParam(name=&quot;Observation.class&quot;) List&amp;lt;Observation&amp;gt; observations) { ... }\n</pre></div>\n\n\n<p>I send to that method bundle of Observations generated by FHIR sample server but whithout success.<br>\nWhatever I send I always get null as input.</p>",
        "id": 157514277,
        "sender_full_name": "Valeriy Shtanko",
        "timestamp": 1549277306
    }
]