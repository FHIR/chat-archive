[
    {
        "content": "<p>I'm trying to run HAPI, it goes well, but I have this error when making this query </p>\n<p>HAPI Version: <code>HAPI FHIR 5.2.0 REST Server (FHIR Server; FHIR 4.0.1/R4)</code></p>\n<p>Sending this request fails <code>localhost:8080/fhir/Patient?identifier=ID_SYSTEM_1|</code>.</p>\n<div class=\"codehilite\"><pre><span></span><code>root@hapifhir:/usr/local/tomcat# curl &#39;localhost:8080/fhir/Patient?identifier=ID_SYSTEM_1|&#39;\n\n&lt;!doctype html&gt;&lt;html lang=&quot;en&quot;&gt;&lt;head&gt;&lt;title&gt;HTTP Status 400 – Bad Request&lt;/title&gt;&lt;style type=&quot;text/css&quot;&gt;body {font-family:Tahoma,Arial,sans-serif;} h1, h2, h3, b {color:white;background-color:#525D76;} h1 {font-size:22px;} h2 {font-size:16px;} h3 {font-size:14px;} p {font-size:12px;} a {color:black;} .line {height:1px;background-color:#525D76;border:none;}&lt;/style&gt;&lt;/head&gt;&lt;body&gt;&lt;h1&gt;HTTP Status 400 – Bad Request&lt;/h1&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;p&gt;&lt;b&gt;Type&lt;/b&gt; Exception Report&lt;/p&gt;&lt;p&gt;&lt;b&gt;Message&lt;/b&gt; Invalid character found in the request target [&amp;#47;fhir&amp;#47;Patient?identifier=ID_SYSTEM_1|]. The valid characters are defined in RFC 7230 and RFC 3986&lt;/p&gt;&lt;p&gt;&lt;b&gt;Description&lt;/b&gt; The server cannot or will not process the request due to something that is perceived to be a client error (e.g., malformed request syntax, invalid request message framing, or deceptive request routing).&lt;/p&gt;&lt;p&gt;&lt;b&gt;Exception&lt;/b&gt;&lt;/p&gt;&lt;pre&gt;java.lang.IllegalArgumentException: Invalid character found in the request target [&amp;#47;fhir&amp;#47;Patient?identifier=ID_SYSTEM_1|]. The valid characters are defined in RFC 7230 and RFC 3986\n        org.apache.coyote.http11.Http11InputBuffer.parseRequestLine(Http11InputBuffer.java:486)\n        org.apache.coyote.http11.Http11Processor.service(Http11Processor.java:261)\n        org.apache.coyote.AbstractProcessorLight.process(AbstractProcessorLight.java:65)\n        org.apache.coyote.AbstractProtocol$ConnectionHandler.process(AbstractProtocol.java:868)\n        org.apache.tomcat.util.net.NioEndpoint$SocketProcessor.doRun(NioEndpoint.java:1590)\n        org.apache.tomcat.util.net.SocketProcessorBase.run(SocketProcessorBase.java:49)\n        java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n        java.base&amp;#47;java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n        org.apache.tomcat.util.threads.TaskThread$WrappingRunnable.run(TaskThread.java:61)\n        java.base&amp;#47;java.lang.Thread.run(Thread.java:834)\n&lt;/pre&gt;&lt;p&gt;&lt;b&gt;Note&lt;/b&gt; The full stack trace of the root cause is available in the server logs.&lt;/p&gt;&lt;hr class=&quot;line&quot; /&gt;&lt;h3&gt;Apache Tomcat/9.0.38&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;\n</code></pre></div>\n<p>This request works on <code>hapi.fhir.org</code>, so not sure what's the fix<br>\nPulled from standard HAPI docker image, with this configuration</p>\n<div class=\"codehilite\"><pre><span></span><code>spring:\n  datasource:\n    url: &#39;jdbc:h2:file:./target/database/h2&#39;\n\n    username: sa\n    password: null\n    driverClassName: org.h2.Driver\n    max-active: 15\n\n  batch:\n    job:\n      enabled: false\n\nhapi:\n  fhir:\n    fhir_version: R4\n    default_encoding: JSON\n    default_pretty_print: false\n    tester:\n\n        home:\n          name: Local Tester\n          server_address: &#39;http://localhost:8080/fhir&#39;\n          refuse_to_fetch_third_party_urls: false\n          fhir_version: R4\n</code></pre></div>",
        "id": 224696698,
        "sender_full_name": "Dexter",
        "timestamp": 1612167950
    },
    {
        "content": "<p><strong>Solved</strong></p>\n<p>I managed to fix it, I changed <code>server.xml</code> and used docker <code>configs</code> section to override the server.xml. </p>\n<p>In particular, I made this change, added <code>relaxedQueryChars='|'</code>. </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;Connector port=&quot;8080&quot; protocol=&quot;HTTP/1.1&quot;\n               connectionTimeout=&quot;20000&quot;\n               redirectPort=&quot;8443&quot; relaxedQueryChars=&#39;|&#39;/&gt;\n</code></pre></div>",
        "id": 224853111,
        "sender_full_name": "Dexter",
        "timestamp": 1612261959
    }
]