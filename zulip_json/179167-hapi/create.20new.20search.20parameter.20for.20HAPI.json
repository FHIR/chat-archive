[
    {
        "content": "<p>Hi All,</p>\n<p>This might sound as a dumb question. <br>\nI need to add a incoming message's date as a Extension to all of my resources. If i've added the extension with the date value coming  in the incoming message, then How can I make this date as a new \"date\" search parameter?</p>",
        "id": 197057149,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589119496
    },
    {
        "content": "<p>The ultimate aim of this question is, currently we are quering the HAPI repository using \"_lastUpdatedDate\" we want to get rid of querying the last updated date generated by the HAPI. And use the date of incoming message. But this date should be searchable in all the resources like _lastUpdatedDate</p>",
        "id": 197057237,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589119635
    },
    {
        "content": "<p>Im asking this question based on the Stackoverflow  comment i saw</p>",
        "id": 197057553,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589120139
    },
    {
        "content": "<p><a href=\"https://stackoverflow.com/questions/40679422/how-for-i-search-fhir-resources-based-on-extension-values/40679772#40679772\" title=\"https://stackoverflow.com/questions/40679422/how-for-i-search-fhir-resources-based-on-extension-values/40679772#40679772\">https://stackoverflow.com/questions/40679422/how-for-i-search-fhir-resources-based-on-extension-values/40679772#40679772</a></p>",
        "id": 197057554,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589120141
    },
    {
        "content": "<p>An alternative may be to create Provenance resources, the 'date' thereof can be searched by default. Assuming that each message causes the creation of multiple FHIR resources, one could create one single Provenance resource and associate it with all of the newly created resources. When extracting data from messages the use of Provenance will be useful anyway for the tracking of when which things were imported/extracted. yes, a bit of overhead when compared to an extension on each and every resource, but flexibility has its price.</p>",
        "id": 197060865,
        "sender_full_name": "René Spronk",
        "timestamp": 1589123967
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"202825\">@Vibin_chander</span> If you do need this new extension and an ability to search by it, create and post a new SearchParameter (after posting this to your server, HAPI will take a few minutes to index the data before you can use this new search parameter). Have a look at the following example: <a href=\"https://www.hl7.org/fhir/searchparameter-example-extension.json.html\" title=\"https://www.hl7.org/fhir/searchparameter-example-extension.json.html\">https://www.hl7.org/fhir/searchparameter-example-extension.json.html</a></p>",
        "id": 197062359,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589125362
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191372\">@René Spronk</span>  and <span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span>  Thanks for you inputs. Let me try the Search Parameter once</p>",
        "id": 197095786,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589167626
    },
    {
        "content": "<p>Im trying the Search Parameter but not sure how it  works.</p>\n<p>I'm trying like this , in the search parameter resource I've made like this</p>\n<p><code>\"name\": \"newurl\",\n\"type\": \"reference\",\n\"expression\": \"Coverage.extension('http://myUrlName\"),\n  \"xpath\": \"f:Coverage/f:extension[@url='http://myUrlName']\",\n\"target\": [\n    \"Coverage\"\n  ]</code></p>\n<p>In the Coverage Resource Im defining my extension like this</p>\n<div class=\"codehilite\"><pre><span></span><code> &quot;extension&quot; : [\n          {\n            &quot;url&quot; : &quot;http://myUrlName&quot;,\n            &quot;valueCodeableConcept&quot; : {\n              &quot;coding&quot; : [\n                {\n                  &quot;system&quot; : &quot;http://myUrlName&quot;,\n                  &quot;code&quot; : &quot;HL7V2-SOURCE-DATE&quot;,\n                  &quot;display&quot; : &quot;2020-04-30T15:19:11&quot;\n                }\n              ]\n            }\n          }\n        ]\n</code></pre></div>\n\n\n<p>Which means I can search the Coverage Resource by using \"newurl\" as search parameter right?<br>\nBut searching Coverage?newurl=http://myUrlName does not return anything. Let me know if y understanding  is wrong here</p>",
        "id": 197101266,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589174761
    },
    {
        "content": "<p>Try adding \"code\": \"myextension\" in the SearchParameter and replacing \"target\" with \"base\". In the Coverage extension, \"system\" should point to the CodeSystem URL, e.g. \"system\": \"<a href=\"http://www.test.com/MyCodeSystem\" title=\"http://www.test.com/MyCodeSystem\">http://www.test.com/MyCodeSystem</a>\". Then you should be able to search Coverage?myextension=http://www.test.com/MyCodeSystem|HL7V2-SOURCE-DATE. Of course you can use your own values instead of \"myextension\" and \"<a href=\"http://www.test.com/MyCodeSystem\" title=\"http://www.test.com/MyCodeSystem\">http://www.test.com/MyCodeSystem</a>\".</p>",
        "id": 197102754,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589176245
    },
    {
        "content": "<p>Also replace \"type\": \"reference\" with \"type\": \"token\" since your extension is of CodeableConcept type</p>",
        "id": 197102907,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589176426
    },
    {
        "content": "<p>replacing \"target\" with \"base\" meaning both should be of same resource name? or only either of the one should exist?</p>",
        "id": 197103146,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589176625
    },
    {
        "content": "<p>Im getting an error saying this <code>Unknown search parameter \\\"myextension\\\"</code></p>",
        "id": 197103470,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589177071
    },
    {
        "content": "<p>Here is the whole JSON im using for search parameter</p>\n<div class=\"codehilite\"><pre><span></span><code>  &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n  &quot;id&quot;: &quot;example-extension&quot;,\n  &quot;url&quot;: &quot;http://hl7.org/fhir/SearchParameter/example-extension&quot;,\n  &quot;name&quot;: &quot;newurl&quot;,\n  &quot;status&quot;: &quot;draft&quot;,\n  &quot;experimental&quot;: true,\n  &quot;publisher&quot;: &quot;Health Level Seven International (FHIR Infrastructure)&quot;,\n  &quot;contact&quot;: [\n    {\n      &quot;telecom&quot;: [\n        {\n          &quot;system&quot;: &quot;url&quot;,\n          &quot;value&quot;: &quot;http://hl7.org/fhir&quot;\n        }\n      ]\n    }\n  ],\n  &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n  &quot;code&quot;: &quot;myextension&quot;,\n  &quot;base&quot;: [\n    &quot;Coverage&quot;\n  ],\n  &quot;type&quot;: &quot;token&quot;,\n  &quot;expression&quot;: &quot;Coverage.extension(&#39;http://www.caringly.net/incoming-message-date&#39;)&quot;,\n  &quot;xpath&quot;: &quot;f:Coverage/f:extension[@url=&#39;http://www.caringly.net/incoming-message-date&#39;]&quot;,\n  &quot;xpathUsage&quot;: &quot;normal&quot;,\n  &quot;target&quot;: [\n    &quot;Coverage&quot;\n  ]\n}```\n</code></pre></div>",
        "id": 197103755,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589177503
    },
    {
        "content": "<p>I was searching by <em>Coverage?myextension=http://www.caringly.net/incoming-message-date</em></p>",
        "id": 197103891,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589177655
    },
    {
        "content": "<p>You don't need target (it's only needed for a SeacrhParameter of a reference type. Is <a href=\"http://www.caringly.net/incoming-message-date\" title=\"http://www.caringly.net/incoming-message-date\">http://www.caringly.net/incoming-message-date</a> the URL of your extension? Is this extension defined as a StructureDefinition on your HAPI server? What's the CodeSystem URL you use in the actual Coverage instance extension? In the search you need to us a token of CodeSystem and code separated by \"|\", e.g. Coverage?myextension=http://www.test.com/MyCodeSystem|HL7V2-SOURCE-DATE</p>",
        "id": 197104141,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589177992
    },
    {
        "content": "<p>Im using that URL in the extension of the coverage resource</p>\n<p><code> \"extension\" : [\n          {\n            \"url\" : \"http://www.caringly.net/incoming-message-date\",\n            \"valueCodeableConcept\" : {\n              \"coding\" : [\n                {\n                  \"system\" : \"http://www.caringly.net/incoming-message-date\",\n                  \"code\" : \"HL7V2-SOURCE-DATE\",\n                  \"display\" : \"2020-04-30T15:19:11\"\n                }\n              ]\n            }\n          }\n        ]</code></p>\n<p>I will remove the target and try once</p>",
        "id": 197104283,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589178153
    },
    {
        "content": "<p>Is it Must to define the Extension in structure definition resource ?</p>",
        "id": 197104321,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589178233
    },
    {
        "content": "<p>URL of the extension should be different from the CodeSystem URL. I would recommend to play with the public HAPI server: <a href=\"http://hapi.fhir.org\" title=\"http://hapi.fhir.org\">hapi.fhir.org</a>. Try to  create the SearchParameter resource, StructureDefinition resource for the extension and an instance of a Coverage resource using this extension. Then try searching for this Coverage resource using the new SearchParameter.</p>",
        "id": 197104407,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589178321
    },
    {
        "content": "<p>ok sure</p>",
        "id": 197104469,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589178414
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> could you please share an example of creating StructureDefinition resource for Extension ?</p>",
        "id": 197121190,
        "sender_full_name": "dsh",
        "timestamp": 1589190026
    },
    {
        "content": "<p>Have a look at <a href=\"https://www.hl7.org/fhir/extensibility-registry.html\">https://www.hl7.org/fhir/extensibility-registry.html</a>. There are tons of extensions of various types.</p>",
        "id": 197153459,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589207471
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> thanks. That helped a lot. I do have a working SD, SP and search.</p>\n<p>Now I am trying to create <code>SearchParameter</code> with <code>base</code> = <code>Resource</code> so that it is available on all resources. But when I do that <code>Patient</code> resource is no longer searchable by <code>SearchParameter</code></p>\n<div class=\"codehilite\"><pre><span></span><code>{\n        &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n        &quot;id&quot;: &quot;10025450&quot;,\n        &quot;meta&quot;: {\n          &quot;versionId&quot;: &quot;1&quot;,\n          &quot;lastUpdated&quot;: &quot;2020-05-11T16:48:00.413+00:00&quot;,\n          &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n        },\n        &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n        &quot;version&quot;: &quot;1.0&quot;,\n        &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n        &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n        &quot;base&quot;: [\n          &quot;Resource&quot;\n        ],\n        &quot;type&quot;: &quot;date&quot;,\n        &quot;expression&quot;: &quot;*.extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpathUsage&quot;: &quot;normal&quot;\n      }\n</code></pre></div>",
        "id": 197180539,
        "sender_full_name": "dsh",
        "timestamp": 1589219133
    },
    {
        "content": "<p>any ideas ?</p>",
        "id": 197180589,
        "sender_full_name": "dsh",
        "timestamp": 1589219157
    },
    {
        "content": "<p>I have even tried the following </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n        &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n        &quot;id&quot;: &quot;10025450&quot;,\n        &quot;meta&quot;: {\n          &quot;versionId&quot;: &quot;1&quot;,\n          &quot;lastUpdated&quot;: &quot;2020-05-11T16:48:00.413+00:00&quot;,\n          &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n        },\n        &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n        &quot;version&quot;: &quot;1.0&quot;,\n        &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n        &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n        &quot;base&quot;: [\n          &quot;Resource&quot;\n        ],\n        &quot;type&quot;: &quot;date&quot;,\n        &quot;expression&quot;: &quot;extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpath&quot;: &quot;f:*/f:extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpathUsage&quot;: &quot;normal&quot;\n      }\n</code></pre></div>\n\n\n<p>to no avail. What am I missing ?</p>",
        "id": 197186855,
        "sender_full_name": "dsh",
        "timestamp": 1589222401
    },
    {
        "content": "<p>Did you create a StructureDefinition for the extension. Can you show this StructureDefinition?</p>",
        "id": 197198860,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589228141
    },
    {
        "content": "<p>yes, just a sec</p>",
        "id": 197198898,
        "sender_full_name": "dsh",
        "timestamp": 1589228161
    },
    {
        "content": "<p>here it is <a href=\"https://gist.github.com/a9e98fc8b64e0fff3c1a93d46b342345\">https://gist.github.com/a9e98fc8b64e0fff3c1a93d46b342345</a> <span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span></p>",
        "id": 197199127,
        "sender_full_name": "dsh",
        "timestamp": 1589228264
    },
    {
        "content": "<p>I have tried this SearchParameter def</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n        &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n        &quot;id&quot;: &quot;10025450&quot;,\n        &quot;meta&quot;: {\n          &quot;versionId&quot;: &quot;1&quot;,\n          &quot;lastUpdated&quot;: &quot;2020-05-11T16:48:00.413+00:00&quot;,\n          &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n        },\n        &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n        &quot;version&quot;: &quot;1.0&quot;,\n        &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n        &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n        &quot;base&quot;: [\n          &quot;Resource&quot;\n        ],\n        &quot;type&quot;: &quot;date&quot;,\n        &quot;expression&quot;: &quot;extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpath&quot;: &quot;f:*/f:extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpathUsage&quot;: &quot;normal&quot;,\n        &quot;comparator&quot;: [&quot;eq&quot;, &quot;ge&quot;, &quot;le&quot;, &quot;gt&quot;, &quot;lt&quot;, &quot;ne&quot;]\n      }\n</code></pre></div>\n\n\n<p>but when I query Patient I get </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;generated&quot;,\n    &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Unknown search parameter &amp;quot;SearchByMsgDate&amp;quot;. Value search parameters for this search are: [_id, _language, active, address, address-city, address-country, address-postalcode, address-state, address-use, birthdate, death-date, deceased, email, family, gender, general-practitioner, given, identifier, language, link, name, organization, phone, phonetic, telecom]&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n  },\n  &quot;issue&quot;: [\n    {\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;processing&quot;,\n      &quot;diagnostics&quot;: &quot;Unknown search parameter \\&quot;SearchByMsgDate\\&quot;. Value search parameters for this search are: [_id, _language, active, address, address-city, address-country, address-postalcode, address-state, address-use, birthdate, death-date, deceased, email, family, gender, general-practitioner, given, identifier, language, link, name, organization, phone, phonetic, telecom]&quot;\n    }\n  ]\n}\n</code></pre></div>",
        "id": 197199638,
        "sender_full_name": "dsh",
        "timestamp": 1589228493
    },
    {
        "content": "<p>Maybe we need to start over. What is the purpose of your extension and search by this extension? Do you want to store a message date/time from MSH.7 in each resource that was in the message and then search for resources of a specified type by this message date/time?</p>",
        "id": 197200177,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589228755
    },
    {
        "content": "<p>yes that is the purpose</p>",
        "id": 197200258,
        "sender_full_name": "dsh",
        "timestamp": 1589228786
    },
    {
        "content": "<p>so that if hl7 message needs to be reprocessed then I am not relying on <code>_lastUpdated</code> which will change on each update</p>",
        "id": 197200288,
        "sender_full_name": "dsh",
        "timestamp": 1589228816
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> <br>\nas I said if I declare <code>base</code> as <code>[ \"Patient\" ]</code>and  <code>expression</code> as <code>Patient.extension('http://www.caringly.tech/SearchByMsgDate')</code> i.e.</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n        &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n        &quot;id&quot;: &quot;10025450&quot;,\n        &quot;meta&quot;: {\n          &quot;versionId&quot;: &quot;1&quot;,\n          &quot;lastUpdated&quot;: &quot;2020-05-11T16:48:00.413+00:00&quot;,\n          &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n        },\n        &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n        &quot;version&quot;: &quot;1.0&quot;,\n        &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n        &quot;status&quot;: &quot;active&quot;,\n        &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n        &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n        &quot;base&quot;: [\n          &quot;Patient&quot;,\n          &quot;Coverage&quot;\n        ],\n        &quot;type&quot;: &quot;date&quot;,\n        &quot;expression&quot;: &quot;Patient.extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n        &quot;xpathUsage&quot;: &quot;normal&quot;\n      }\n</code></pre></div>\n\n\n<p>then <code>SearchByMsgDate</code> on <code>Patient</code> resource only works fine but does not work on <code>Coverage</code>, so I need something universal like on <code>Resource</code></p>",
        "id": 197200322,
        "sender_full_name": "dsh",
        "timestamp": 1589228842
    },
    {
        "content": "<p>Did you consider using Provenance (<a href=\"https://www.hl7.org/fhir/provenance.html\">https://www.hl7.org/fhir/provenance.html</a>) instead?</p>",
        "id": 197200338,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589228849
    },
    {
        "content": "<p>So your expression only looks at a Patient resource: \"Patient.extension('<a href=\"http://www.caringly.tech/SearchByMsgDate\">http://www.caringly.tech/SearchByMsgDate</a>')\"</p>",
        "id": 197200493,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589228914
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> to be fair <code>Provenance</code> seemed like an overkill .... when only one cross cutting attribute needs to be added to get the work done. But to be honest I don't know much about Provenance so I may be wrong in my analysis.</p>",
        "id": 197200574,
        "sender_full_name": "dsh",
        "timestamp": 1589228961
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191393\">Igor Sirkovich</span> <a href=\"#narrow/stream/179167-hapi/topic/create.20new.20search.20parameter.20for.20HAPI/near/197200338\">said</a>:</p>\n<blockquote>\n<p>So your expression only looks at a Patient resource: \"Patient.extension('<a href=\"http://www.caringly.tech/SearchByMsgDate\">http://www.caringly.tech/SearchByMsgDate</a>')\"</p>\n</blockquote>\n<p>Yes it does so I changed it to <code>*.extension('http://www.caringly.tech/SearchByMsgDate')</code> or <code>extension('http://www.caringly.tech/SearchByMsgDate')</code> and <code>base</code> to <code>Resource</code> but it does not help</p>",
        "id": 197200725,
        "sender_full_name": "dsh",
        "timestamp": 1589229016
    },
    {
        "content": "<p>I believe that \"base\": [ \"Resource\" ] and \"expression\": \"extension('<a href=\"http://www.caringly.tech/SearchByMsgDate\">http://www.caringly.tech/SearchByMsgDate</a>')\" is supposed to work</p>",
        "id": 197200970,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589229153
    },
    {
        "content": "<p>that's what I thought too but not, let me try and remove <code>xpath</code> just in case :(</p>",
        "id": 197201175,
        "sender_full_name": "dsh",
        "timestamp": 1589229262
    },
    {
        "content": "<p>no luck <span aria-label=\"unamused\" class=\"emoji emoji-1f612\" role=\"img\" title=\"unamused\">:unamused:</span></p>",
        "id": 197201282,
        "sender_full_name": "dsh",
        "timestamp": 1589229327
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191393\">Igor Sirkovich</span> <a href=\"#narrow/stream/179167-hapi/topic/create.20new.20search.20parameter.20for.20HAPI/near/197200970\">said</a>:</p>\n<blockquote>\n<p>I believe that \"base\": [ \"Resource\" ] and \"expression\": \"extension('<a href=\"http://www.caringly.tech/SearchByMsgDate\">http://www.caringly.tech/SearchByMsgDate</a>')\" is supposed to work</p>\n</blockquote>\n<p>that's what I thought</p>",
        "id": 197201396,
        "sender_full_name": "dsh",
        "timestamp": 1589229374
    },
    {
        "content": "<p>Also ensure you don't have 2 SearchParameter resources with the same \"code\".</p>",
        "id": 197201473,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589229417
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span>  there is only one <a href=\"https://gist.github.com/651444647118b68cb9768acc0d335cd4\">https://gist.github.com/651444647118b68cb9768acc0d335cd4</a></p>",
        "id": 197201641,
        "sender_full_name": "dsh",
        "timestamp": 1589229507
    },
    {
        "content": "<p>I wonder looking at this <a href=\"http://hapi.fhir.org/baseR4/SearchParameter?code=_id\">http://hapi.fhir.org/baseR4/SearchParameter?code=_id</a> if SP on Resource is supposed to work only on simple dataTypes</p>",
        "id": 197201950,
        "sender_full_name": "dsh",
        "timestamp": 1589229660
    },
    {
        "content": "<p>Try to add \"xpath\": \"f:*/f:extension[@url='<a href=\"http://www.caringly.tech/SearchByMsgDate'']\">http://www.caringly.tech/SearchByMsgDate'']</a>\",</p>",
        "id": 197201985,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589229679
    },
    {
        "content": "<p>ok</p>",
        "id": 197201997,
        "sender_full_name": "dsh",
        "timestamp": 1589229685
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191783\">Daya Sharma</span> <a href=\"#narrow/stream/179167-hapi/topic/create.20new.20search.20parameter.20for.20HAPI/near/197201950\">said</a>:</p>\n<blockquote>\n<p>I wonder looking at this <a href=\"http://hapi.fhir.org/baseR4/SearchParameter?code=_id\">http://hapi.fhir.org/baseR4/SearchParameter?code=_id</a> if SP on Resource is supposed to work only on simple dataTypes</p>\n</blockquote>\n<p>No, it's supposed to work on all data types</p>",
        "id": 197202153,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589229760
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191393\">Igor Sirkovich</span> <a href=\"#narrow/stream/179167-hapi/topic/create.20new.20search.20parameter.20for.20HAPI/near/197201985\">said</a>:</p>\n<blockquote>\n<p>Try to add \"xpath\": \"f:*/f:extension[@url='<a href=\"http://www.caringly.tech/SearchByMsgDate'']\">http://www.caringly.tech/SearchByMsgDate'']</a>\",</p>\n</blockquote>\n<p>nope that did not help</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n  &quot;id&quot;: &quot;10025450&quot;,\n  &quot;meta&quot;: {\n    &quot;versionId&quot;: &quot;16&quot;,\n    &quot;lastUpdated&quot;: &quot;2020-05-11T20:42:37.444+00:00&quot;,\n    &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n  },\n  &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n  &quot;version&quot;: &quot;1.0&quot;,\n  &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n  &quot;status&quot;: &quot;active&quot;,\n  &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n  &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n  &quot;base&quot;: [\n    &quot;Resource&quot;\n  ],\n  &quot;type&quot;: &quot;date&quot;,\n  &quot;expression&quot;: &quot;extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n  &quot;xpath&quot;: &quot;f:*/f:extension[@url=&#39;http://www.caringly.tech/SearchByMsgDate&#39;]&quot;,\n  &quot;xpathUsage&quot;: &quot;normal&quot;,\n  &quot;comparator&quot;: [\n    &quot;eq&quot;,\n    &quot;ge&quot;,\n    &quot;le&quot;,\n    &quot;gt&quot;,\n    &quot;lt&quot;,\n    &quot;ne&quot;\n  ]\n}\n</code></pre></div>",
        "id": 197202212,
        "sender_full_name": "dsh",
        "timestamp": 1589229804
    },
    {
        "content": "<p>I can only suggest to try this on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a> to see this might be related to your local HAPI setup.</p>",
        "id": 197202467,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589229959
    },
    {
        "content": "<p>great suggestion <span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span>  will try and keep you posted</p>",
        "id": 197202664,
        "sender_full_name": "dsh",
        "timestamp": 1589230060
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>, I just wanted to confirm with you whether HAPI supports searching by an Extension using a custom SearchParameter that is defined on a Resource, i.e. is supposed to work on all resources.</p>",
        "id": 197202915,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589230200
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191783\">@Daya Sharma</span>, you can also try \"base\": [ \"Patient\", \"Coverage\" ], while keeping the current expression and xpath. If this works, then probably the issue is with HAPI support for \"base\": [ \"Resource\" ], which would require indexing all FHIR resources on the server as opposed to indexing specific resources.</p>",
        "id": 197203273,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589230388
    },
    {
        "content": "<p>ah that makes sense</p>",
        "id": 197203325,
        "sender_full_name": "dsh",
        "timestamp": 1589230413
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> it only works on Patient but not on Coverage , the resource that should be fetched is <a href=\"https://gist.github.com/5ca45a8f2b366cbb012559e08d0ac9c8\">https://gist.github.com/5ca45a8f2b366cbb012559e08d0ac9c8</a> and the query is <code>Coverage?SearchByMsgDate=&gt;=2020-04-03</code>and SP is </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n  &quot;id&quot;: &quot;10025450&quot;,\n  &quot;meta&quot;: {\n    &quot;versionId&quot;: &quot;17&quot;,\n    &quot;lastUpdated&quot;: &quot;2020-05-11T20:54:06.085+00:00&quot;,\n    &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n  },\n  &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n  &quot;version&quot;: &quot;1.0&quot;,\n  &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n  &quot;status&quot;: &quot;active&quot;,\n  &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n  &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n  &quot;base&quot;: [\n    &quot;Patient&quot;,\n    &quot;Coverage&quot;\n  ],\n  &quot;type&quot;: &quot;date&quot;,\n  &quot;expression&quot;: &quot;extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n  &quot;xpath&quot;: &quot;f:*/f:extension[@url=&#39;http://www.caringly.tech/SearchByMsgDate&#39;]&quot;,\n  &quot;xpathUsage&quot;: &quot;normal&quot;,\n  &quot;comparator&quot;: [\n    &quot;eq&quot;,\n    &quot;ge&quot;,\n    &quot;le&quot;,\n    &quot;gt&quot;,\n    &quot;lt&quot;,\n    &quot;ne&quot;\n  ]\n}\n</code></pre></div>",
        "id": 197203903,
        "sender_full_name": "dsh",
        "timestamp": 1589230705
    },
    {
        "content": "<p>It's funny. Maybe try searching again in a few minutes to see if HAPI is still indexing the resources. Otherwise, can you try adding another resource type, e.g. Organization with this extension, add \"Organization\" to the \"base\" of the SearchParameter and see if this would work? This would help understand if this issue is specific  to Coverage. Also, you might try to change the order of the resources in \"base\" to see if only the first one gets indexed.</p>",
        "id": 197204830,
        "sender_full_name": "Igor Sirkovich",
        "timestamp": 1589231202
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> I had the same thought, so I added SP extension to <code>Consent</code> and it does not fetch the result so possible an indexing problem, but the good thing is both Coverage and Consent now do not complain about unknown parameter <code>SearchByMsgDate</code></p>",
        "id": 197205070,
        "sender_full_name": "dsh",
        "timestamp": 1589231357
    },
    {
        "content": "<p>this begs the question, how do I know if the indexing has finished .... obviously doing this on scale in production requires insight</p>",
        "id": 197205284,
        "sender_full_name": "dsh",
        "timestamp": 1589231415
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> does HAPI support searching by an Extension using a custom <code>SearchParameter</code> that is defined on a <code>Resource</code> as opposed to individually listed resources. And is there a way to know if indexing is of those resources with that <code>SearchParameter</code> is finished or pending ?</p>",
        "id": 197206858,
        "sender_full_name": "dsh",
        "timestamp": 1589232426
    },
    {
        "content": "<p>that's not my area of code - I don't know</p>",
        "id": 197222945,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589243617
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> any insight into SearchParameter with <code>base</code> set to <code>Resource</code> why does it not work in above ^ case ?</p>",
        "id": 197232454,
        "sender_full_name": "dsh",
        "timestamp": 1589256817
    },
    {
        "content": "<p>In this example it is mentioned  \"Resource\" as Base. Is it because _id is a common search parameter for all resources? <a href=\"https://www.hl7.org/fhir/searchparameter-example.json.html\">https://www.hl7.org/fhir/searchparameter-example.json.html</a></p>",
        "id": 197245385,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589271594
    },
    {
        "content": "<p>I'm  trying to make base[\"Resource\"] in HAPI and my search is not getting recognized</p>",
        "id": 197245452,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589271624
    },
    {
        "content": "<p>My parameter here is SearchByMsgDate</p>",
        "id": 197245487,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589271665
    },
    {
        "content": "<p>I tried making the search parameter resource as bundle for each resource. Still only one resource Patient works and the search parameters for the other resources does not work</p>",
        "id": 197251963,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589276061
    },
    {
        "content": "<p>Patient?SearchByMsgDate=&gt;=2020-04-22 This returns value and Coverage?SearchByMsgDate=&gt;=2020-04-22 does not. Which means even if the search parameter resource is sent as bundle with <code>expression:Patient.extension('http://www.caringly.tech/SearchByMsgDate')</code> in the base as \"Patient\" &amp; <code>expression:Coverage.extension('http://www.caringly.tech/SearchByMsgDate')</code> in the base as \"Coverage\" it takes only the Patient and not for the coverage resource</p>",
        "id": 197252194,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589276190
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  I have same question as <span class=\"user-mention\" data-user-id=\"191783\">@Daya Sharma</span>  has. Is it possible to create search parameter for base [\"Resource\"] meaning that parameter will be applied for all the resources?. on HAPI</p>",
        "id": 197252826,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589276600
    },
    {
        "content": "<p>Ok I can make it work with bundles</p>",
        "id": 197261971,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589283075
    },
    {
        "content": "<p>it takes sometime and new message flow for the process to set in</p>",
        "id": 197261989,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589283089
    },
    {
        "content": "<p>No, that is not possible currently. You need to explicitly specify the base resource(s) you want the SearchParameter to apply to.</p>",
        "id": 197263106,
        "sender_full_name": "James Agnew",
        "timestamp": 1589283927
    },
    {
        "content": "<p>ok</p>",
        "id": 197263275,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589284039
    },
    {
        "content": "<p>Im doing like that only</p>",
        "id": 197263283,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589284046
    },
    {
        "content": "<p>Which means for each resource  i need to create a search parameter right?</p>",
        "id": 197263300,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589284060
    },
    {
        "content": "<p>yup</p>\n<p>hopefully will adress this in a future release</p>",
        "id": 197263362,
        "sender_full_name": "James Agnew",
        "timestamp": 1589284083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> Thanks for chiming in. FYI this</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;SearchParameter&quot;,\n  &quot;id&quot;: &quot;10025450&quot;,\n  &quot;meta&quot;: {\n    &quot;versionId&quot;: &quot;17&quot;,\n    &quot;lastUpdated&quot;: &quot;2020-05-11T20:54:06.085+00:00&quot;,\n    &quot;source&quot;: &quot;#wWpWb92nquQITjqi&quot;\n  },\n  &quot;url&quot;: &quot;http://www.caringly.tech/fhir/SearchParameter/SearchByMsgDateParameter&quot;,\n  &quot;version&quot;: &quot;1.0&quot;,\n  &quot;name&quot;: &quot;SearchByMsgDateParameter&quot;,\n  &quot;status&quot;: &quot;active&quot;,\n  &quot;description&quot;: &quot;Search by patient for a MSH.7 agreement, which is stored in a any resource&quot;,\n  &quot;code&quot;: &quot;SearchByMsgDate&quot;,\n  &quot;base&quot;: [\n    &quot;Patient&quot;,\n    &quot;Coverage&quot;\n  ],\n  &quot;type&quot;: &quot;date&quot;,\n  &quot;expression&quot;: &quot;extension(&#39;http://www.caringly.tech/SearchByMsgDate&#39;)&quot;,\n  &quot;xpath&quot;: &quot;f:*/f:extension[@url=&#39;http://www.caringly.tech/SearchByMsgDate&#39;]&quot;,\n  &quot;xpathUsage&quot;: &quot;normal&quot;,\n  &quot;comparator&quot;: [\n    &quot;eq&quot;,\n    &quot;ge&quot;,\n    &quot;le&quot;,\n    &quot;gt&quot;,\n    &quot;lt&quot;,\n    &quot;ne&quot;\n  ]\n}\n</code></pre></div>\n\n\n<p>works for Patient not Coverage even though both are explicitly declared.</p>",
        "id": 197283575,
        "sender_full_name": "dsh",
        "timestamp": 1589293560
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> FYI, we ended up creating Bundle of SearchParameter <a href=\"https://gist.github.com/daya/80f7d8fbc516f2e6225a0aca82d2a831\">https://gist.github.com/daya/80f7d8fbc516f2e6225a0aca82d2a831</a> where each SP is for one resource. This seems like a brute force but actually works while declaring multiple resources explicitly </p>\n<div class=\"codehilite\"><pre><span></span><code> &quot;base&quot;: [\n    &quot;Patient&quot;,\n    &quot;Coverage&quot;\n  ],\n</code></pre></div>\n\n\n<p>does not work. To me that seems like a bug.</p>",
        "id": 197284375,
        "sender_full_name": "dsh",
        "timestamp": 1589293915
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> could you please confirm if ^ seems like a bug to you?</p>",
        "id": 197287162,
        "sender_full_name": "dsh",
        "timestamp": 1589295036
    },
    {
        "content": "<p>Yup, I'd call that a bug. Can you replicate the issue on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>?</p>",
        "id": 197289785,
        "sender_full_name": "James Agnew",
        "timestamp": 1589296053
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> further it seems that <code>_id</code> works on <code>Resource</code> but not a custom SearchParamater that also seems like a bug. What do you think ?</p>",
        "id": 197289995,
        "sender_full_name": "dsh",
        "timestamp": 1589296117
    },
    {
        "content": "<p>I will try and replicate it there</p>",
        "id": 197290032,
        "sender_full_name": "dsh",
        "timestamp": 1589296131
    },
    {
        "content": "<p><code>_id</code> is a built-in search parameter (as are all the SPs that start with <code>_</code>), it doesn't rely on the definition at all</p>",
        "id": 197290170,
        "sender_full_name": "James Agnew",
        "timestamp": 1589296185
    },
    {
        "content": "<p>ok than one cannot declare SP on <code>Resource</code> is that a short coming or part of the spec ?</p>",
        "id": 197290353,
        "sender_full_name": "dsh",
        "timestamp": 1589296240
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ^</p>",
        "id": 197290869,
        "sender_full_name": "dsh",
        "timestamp": 1589296377
    },
    {
        "content": "<p>i know for sure that hapi doesn't support it, but i don't know if the spec allows it</p>",
        "id": 197290969,
        "sender_full_name": "James Agnew",
        "timestamp": 1589296403
    },
    {
        "content": "<p>i guess one way of looking at it is that if someone subimtted a pull request that made base=Resource work, it would likely be accepted</p>",
        "id": 197291156,
        "sender_full_name": "James Agnew",
        "timestamp": 1589296466
    },
    {
        "content": "<p>ok thanks for confirming. I will let you know what <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a> replication of this bug reveals</p>",
        "id": 197291266,
        "sender_full_name": "dsh",
        "timestamp": 1589296511
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191319\">James Agnew</span> <a href=\"#narrow/stream/179167-hapi/topic/create.20new.20search.20parameter.20for.20HAPI/near/197289785\">said</a>:</p>\n<blockquote>\n<p>Yup, I'd call that a bug. Can you replicate the issue on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>?</p>\n</blockquote>\n<p>We are using 4.1 and <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a> is on 5.0 snapshot, and I don't see this bug in 5.0 snapshot. But <code>Resource</code> still cannot be used as <code>base</code> I will see about submitting a PR</p>",
        "id": 197327196,
        "sender_full_name": "dsh",
        "timestamp": 1589312122
    },
    {
        "content": "<p>Im trying to understand the duplicate error we are getting in few resources<br>\n\"diagnostics\": \"Failed to UPDATE resource with match URL \\\"RelatedPerson?identifier=ouridentifier\" because this search matched 2 resources\"</p>",
        "id": 197599977,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589481777
    },
    {
        "content": "<p>Any idea why this would happen. Our understanding is that, we are using the conditional PUT, meaning if the same data with the same identifier exist already it should simply update.If not it has to create one new</p>",
        "id": 197600057,
        "sender_full_name": "Vibin_chander",
        "timestamp": 1589481818
    },
    {
        "content": "<p>Hey FYI: We are facing the same issue with hapi 5.5 and a postgresql database. Theres a high likelihood that this is the result of multithreading importing. <br>\nUpdate: Same issue with mysql db</p>",
        "id": 268282993,
        "sender_full_name": "David Meyers",
        "timestamp": 1642432432
    }
]