[
    {
        "content": "<p>Can't seem to become friends with CapabilityStatement in our HAPI fhir-server/facade. Even though our Providers and Models have custom profile-urls and look like this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nd\">@RegisterProfileClass</span><span class=\"o\">(</span><span class=\"n\">profile</span> <span class=\"o\">=</span> <span class=\"n\">CUSTOM_PROFILE_URL</span><span class=\"o\">,</span> <span class=\"n\">model</span> <span class=\"o\">=</span> <span class=\"n\">EHMMedicationRequest</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">)</span>\n<span class=\"nd\">@ResourceProviderQualifier</span><span class=\"o\">(</span><span class=\"n\">MedicationRequestResourceProvider</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">)</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">MedicationRequestResourceProvider</span> <span class=\"kd\">extends</span> <span class=\"n\">AbstractValidatingProvider</span><span class=\"o\">&lt;</span><span class=\"n\">EHMMedicationRequest</span><span class=\"o\">&gt;</span> <span class=\"kd\">implements</span> <span class=\"n\">IFhirResourceProvider</span><span class=\"o\">&lt;</span><span class=\"n\">MedicationRequest</span><span class=\"o\">&gt;</span> <span class=\"o\">{</span> <span class=\"o\">...</span> <span class=\"o\">}</span>\n\n<span class=\"nd\">@ResourceDef</span><span class=\"o\">(</span><span class=\"n\">name</span><span class=\"o\">=</span><span class=\"s\">&quot;MedicationRequest&quot;</span><span class=\"o\">,</span> <span class=\"n\">profile</span><span class=\"o\">=</span><span class=\"n\">CUSTOM_PROFILE_URL</span><span class=\"o\">)</span>\n<span class=\"kd\">public</span> <span class=\"kd\">class</span> <span class=\"nc\">EHMMedicationRequest</span> <span class=\"kd\">extends</span> <span class=\"n\">MedicationRequest</span> <span class=\"o\">{</span> <span class=\"o\">...</span> <span class=\"o\">}</span>\n</pre></div>\n\n\n<p>The \"GET [base]/metadata?mode=full\" returns:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n          <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;MedicationRequest&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;profile&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/MedicationRequest&quot;</span><span class=\"p\">,</span>\n          <span class=\"err\">...</span>\n<span class=\"p\">}</span>\n</pre></div>\n\n\n<p>I have tried debugging at the start of the application and found that RuntimeSourceDefinition has the correct custom myResourceProfile. Anyone else wrestled with this?</p>",
        "id": 181994668,
        "sender_full_name": "Tobias Cervin",
        "timestamp": 1574837651
    },
    {
        "content": "<p>This was part of <a href=\"https://github.com/jamesagnew/hapi-fhir/pull/1088\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/pull/1088\">https://github.com/jamesagnew/hapi-fhir/pull/1088</a> . If you run on 4.1.0, it should work for you (as it works for me ;) )</p>",
        "id": 182058513,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574888713
    },
    {
        "content": "<blockquote>\n<p>This was part of <a href=\"https://github.com/jamesagnew/hapi-fhir/pull/1088\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/pull/1088\">https://github.com/jamesagnew/hapi-fhir/pull/1088</a> . If you run on 4.1.0, it should work for you (as it works for me ;) )</p>\n</blockquote>\n<p>Thanks for reply!</p>\n<p>We have bumped up to 4.1.0 but the same issue remains.</p>\n<p>Debuging through:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">nextEntry</span><span class=\"o\">.</span><span class=\"na\">getKey</span><span class=\"o\">().</span><span class=\"na\">isEmpty</span><span class=\"o\">()</span> <span class=\"o\">==</span> <span class=\"kc\">false</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">Set</span><span class=\"o\">&lt;</span><span class=\"n\">TypeRestfulInteraction</span><span class=\"o\">&gt;</span> <span class=\"n\">resourceOps</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">HashSet</span><span class=\"o\">&lt;&gt;();</span>\n        <span class=\"n\">CapabilityStatementRestResourceComponent</span> <span class=\"n\">resource</span> <span class=\"o\">=</span> <span class=\"n\">rest</span><span class=\"o\">.</span><span class=\"na\">addResource</span><span class=\"o\">();</span>\n        <span class=\"n\">String</span> <span class=\"n\">resourceName</span> <span class=\"o\">=</span> <span class=\"n\">nextEntry</span><span class=\"o\">.</span><span class=\"na\">getKey</span><span class=\"o\">();</span>\n\n        <span class=\"n\">RuntimeResourceDefinition</span> <span class=\"n\">def</span><span class=\"o\">;</span>\n        <span class=\"n\">FhirContext</span> <span class=\"n\">context</span> <span class=\"o\">=</span> <span class=\"n\">configuration</span><span class=\"o\">.</span><span class=\"na\">getFhirContext</span><span class=\"o\">();</span>\n        <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">resourceNameToSharedSupertype</span><span class=\"o\">.</span><span class=\"na\">containsKey</span><span class=\"o\">(</span><span class=\"n\">resourceName</span><span class=\"o\">))</span> <span class=\"o\">{</span>\n          <span class=\"n\">def</span> <span class=\"o\">=</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"na\">getResourceDefinition</span><span class=\"o\">(</span><span class=\"n\">resourceNameToSharedSupertype</span><span class=\"o\">.</span><span class=\"na\">get</span><span class=\"o\">(</span><span class=\"n\">resourceName</span><span class=\"o\">));</span>\n        <span class=\"o\">}</span> <span class=\"k\">else</span> <span class=\"o\">{</span>\n          <span class=\"n\">def</span> <span class=\"o\">=</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"na\">getResourceDefinition</span><span class=\"o\">(</span><span class=\"n\">resourceName</span><span class=\"o\">);</span>\n        <span class=\"o\">}</span>\n        <span class=\"n\">resource</span><span class=\"o\">.</span><span class=\"na\">getTypeElement</span><span class=\"o\">().</span><span class=\"na\">setValue</span><span class=\"o\">(</span><span class=\"n\">def</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>\n        <span class=\"n\">resource</span><span class=\"o\">.</span><span class=\"na\">getProfileElement</span><span class=\"o\">().</span><span class=\"na\">setValue</span><span class=\"o\">((</span><span class=\"n\">def</span><span class=\"o\">.</span><span class=\"na\">getResourceProfile</span><span class=\"o\">(</span><span class=\"n\">serverBase</span><span class=\"o\">)));</span>\n</pre></div>\n\n\n<p>And the custom profiles are nowhere to be found...</p>",
        "id": 182111101,
        "sender_full_name": "Tobias Cervin",
        "timestamp": 1574949880
    },
    {
        "content": "<p>- just to be sure - we are talking about the need for a server to generate a capabilitystatement where it states that eg. the MedicationRequest is profiled according to what is stated in the @ResourceDef.profile annotation ?</p>",
        "id": 182133913,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1574972424
    },
    {
        "content": "<blockquote>\n<p>- just to be sure - we are talking about the need for a server to generate a capabilitystatement where it states that eg. the MedicationRequest is profiled according to what is stated in the @ResourceDef.profile annotation ?</p>\n</blockquote>\n<p>Just so! <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 182153381,
        "sender_full_name": "Tobias Cervin",
        "timestamp": 1575007589
    },
    {
        "content": "<p>its hard to say then. It works for us</p>\n<div class=\"codehilite\"><pre><span></span>{\n          &quot;type&quot;: &quot;Appointment&quot;,\n          &quot;profile&quot;: {\n            &quot;reference&quot;: &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment&quot;\n          }, ...\n}\n</pre></div>",
        "id": 182344815,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575293511
    },
    {
        "content": "<blockquote>\n<p>its hard to say then. It works for us</p>\n</blockquote>\n<p>{<br>\n          \"type\": \"Appointment\",<br>\n          \"profile\": {<br>\n            \"reference\": \"<a href=\"http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment\" target=\"_blank\" title=\"http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment\">http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-appointment</a>\"<br>\n          }, ...<br>\n}</p>\n<div class=\"codehilite\"><pre><span></span>\n</pre></div>\n\n\n<p>Hmm, but that looks different still? Your profile is not a string but an object with a reference (and other members as well?)?</p>",
        "id": 182421324,
        "sender_full_name": "Tobias Cervin",
        "timestamp": 1575356216
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/u0wfrQFtXHbBATfgKt4__hDl/pasted_image.png\"></a></div>",
        "id": 182422038,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575357156
    },
    {
        "content": "<p>My profile is a reference - as required by the documentation (STU3)</p>",
        "id": 182422057,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575357186
    },
    {
        "content": "<p>Ah I see, yeah ours is R4 so it's a canonical url only. Still really weird that it doesn't work...</p>",
        "id": 182422224,
        "sender_full_name": "Tobias Cervin",
        "timestamp": 1575357410
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> should using R4 be a problem?</p>",
        "id": 182423091,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1575358722
    }
]