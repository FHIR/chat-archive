[
    {
        "content": "<p>Hey guys,<br>\nI got the following error executing a unit test that uses hapi library for validation. With version 5.5.3 of R4 lib everything worked fine but now with the patch to 5.5.7, the following exception occurs:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code><span class=\"m\">13</span> <span class=\"m\">106</span>.5 ValidationTests &gt; mapProzedur<span class=\"o\">()</span> FAILED\n<span class=\"m\">619</span><span class=\"c1\">#13 106.5     java.lang.NoSuchMethodError: 'void org.hl7.fhir.utilities.validation.ValidationMessage.setSliceHtml(java.lang.String, java.lang.String[])'</span>\n<span class=\"m\">620</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.BaseValidator.slicingHint(BaseValidator.java:267)</span>\n<span class=\"m\">621</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.sliceMatches(InstanceValidator.java:3645)</span>\n<span class=\"m\">622</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.matchSlice(InstanceValidator.java:4933)</span>\n<span class=\"m\">623</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.assignChildren(InstanceValidator.java:4852)</span>\n<span class=\"m\">624</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4377)</span>\n<span class=\"m\">625</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:4686)</span>\n<span class=\"m\">626</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4432)</span>\n<span class=\"m\">627</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4384)</span>\n<span class=\"m\">628</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.startInner(InstanceValidator.java:4100)</span>\n<span class=\"m\">629</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.start(InstanceValidator.java:4008)</span>\n<span class=\"m\">630</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateResource(InstanceValidator.java:5172)</span>\n<span class=\"m\">631</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateContains(InstanceValidator.java:4277)</span>\n<span class=\"m\">632</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:4588)</span>\n<span class=\"m\">633</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4432)</span>\n<span class=\"m\">634</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4384)</span>\n<span class=\"m\">635</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:4605)</span>\n<span class=\"m\">636</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4432)</span>\n<span class=\"m\">637</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4384)</span>\n<span class=\"m\">638</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.startInner(InstanceValidator.java:4100)</span>\n<span class=\"m\">639</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.start(InstanceValidator.java:3964)</span>\n<span class=\"m\">640</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validateResource(InstanceValidator.java:5172)</span>\n<span class=\"m\">641</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:721)</span>\n<span class=\"m\">642</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:571)</span>\n<span class=\"m\">643</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.common.hapi.validation.validator.ValidatorWrapper.validate(ValidatorWrapper.java:158)</span>\n<span class=\"m\">644</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validate(FhirInstanceValidator.java:235)</span>\n<span class=\"m\">645</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.doValidate(BaseValidatorBridge.java:22)</span>\n<span class=\"m\">646</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.common.hapi.validation.validator.BaseValidatorBridge.validateResource(BaseValidatorBridge.java:45)</span>\n<span class=\"m\">647</span><span class=\"c1\">#13 106.5         at org.hl7.fhir.common.hapi.validation.validator.FhirInstanceValidator.validateResource(FhirInstanceValidator.java:25)</span>\n<span class=\"m\">648</span><span class=\"c1\">#13 106.5         at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:221)</span>\n<span class=\"m\">649</span><span class=\"c1\">#13 106.5         at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:191)</span>\n<span class=\"m\">650</span><span class=\"c1\">#13 106.5         at org.miracum.streams.ume.kdbptofhir.ValidationTests.isValid(ValidationTests.java:97)</span>\n<span class=\"m\">651</span><span class=\"c1\">#13 106.5         at org.miracum.streams.ume.kdbptofhir.ValidationTests.mapProzedur(ValidationTests.java:243)</span>\n</code></pre></div>\n<p>The code that triggers the exception is the following simple line:</p>\n<div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code><span class=\"kd\">var</span> <span class=\"n\">result</span> <span class=\"o\">=</span> <span class=\"n\">validator</span><span class=\"p\">.</span><span class=\"na\">validateWithResult</span><span class=\"p\">(</span><span class=\"n\">fhirBundle</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>with <code>validator</code> being initialized like:</p>\n<div class=\"codehilite\" data-code-language=\"Java\"><pre><span></span><code><span class=\"kd\">var</span> <span class=\"n\">ctx</span> <span class=\"o\">=</span> <span class=\"n\">FhirContext</span><span class=\"p\">.</span><span class=\"na\">forR4</span><span class=\"p\">();</span>\n<span class=\"n\">validator</span> <span class=\"o\">=</span> <span class=\"n\">ctx</span><span class=\"p\">.</span><span class=\"na\">newValidator</span><span class=\"p\">();</span>\n\n<span class=\"kd\">var</span> <span class=\"n\">validationSupportChain</span> <span class=\"o\">=</span>\n        <span class=\"k\">new</span> <span class=\"n\">ValidationSupportChain</span><span class=\"p\">(</span>\n            <span class=\"k\">new</span> <span class=\"n\">DefaultProfileValidationSupport</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">),</span>\n            <span class=\"n\">getProfiles</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">),</span>\n            <span class=\"k\">new</span> <span class=\"n\">SnapshotGeneratingValidationSupport</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">),</span>\n            <span class=\"k\">new</span> <span class=\"n\">InMemoryTerminologyServerValidationSupport</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">),</span>\n            <span class=\"k\">new</span> <span class=\"n\">CommonCodeSystemsTerminologyService</span><span class=\"p\">(</span><span class=\"n\">ctx</span><span class=\"p\">));</span>\n\n<span class=\"kd\">var</span> <span class=\"n\">instanceValidator</span> <span class=\"o\">=</span> <span class=\"k\">new</span> <span class=\"n\">FhirInstanceValidator</span><span class=\"p\">(</span><span class=\"n\">validationSupportChain</span><span class=\"p\">);</span>\n<span class=\"n\">validator</span><span class=\"p\">.</span><span class=\"na\">registerValidatorModule</span><span class=\"p\">(</span><span class=\"n\">instanceValidator</span><span class=\"p\">);</span>\n</code></pre></div>\n<p>Thanks in advance for any help</p>",
        "id": 258013736,
        "sender_full_name": "Marvin Kampf",
        "timestamp": 1634556640
    },
    {
        "content": "<p>I just realised, that I already had the same problem with a different version once: <a href=\"#narrow/stream/179167-hapi/topic/NoSuchMethodError.20setSliceHtml/near/245185167\">https://chat.fhir.org/#narrow/stream/179167-hapi/topic/NoSuchMethodError.20setSliceHtml/near/245185167</a></p>",
        "id": 258013986,
        "sender_full_name": "Marvin Kampf",
        "timestamp": 1634556772
    },
    {
        "content": "<p>Is this a bug? Should I raise an issue for hapi?</p>",
        "id": 258187437,
        "sender_full_name": "Marvin Kampf",
        "timestamp": 1634647436
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 258188563,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634647947
    },
    {
        "content": "<p>Its likely not a bug in HAPI</p>",
        "id": 258188608,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634647970
    },
    {
        "content": "<p>don't look at me. setSliceHtml is a very old method. But whatever issue it is, the problem is somewhere in the package dependencies</p>",
        "id": 258347036,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634727043
    },
    {
        "content": "<p>Same issue with 5.5.8...</p>",
        "id": 258957372,
        "sender_full_name": "Marvin Kampf",
        "timestamp": 1635167935
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> ?</p>",
        "id": 259001710,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1635187010
    },
    {
        "content": "<p>Please tag me and send me the exact steps to reproduce this.</p>",
        "id": 259017064,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1635194175
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196715\">@Marvin Kampf</span></p>",
        "id": 259017072,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1635194182
    },
    {
        "content": "<p>What are you validating?</p>",
        "id": 259017097,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1635194196
    }
]