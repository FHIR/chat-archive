[
    {
        "content": "<p>Hi folks. On HAPI JPA Server I'm trying to set environment variables for docker-compose files. I can confirm that this works with db configs, e.g. <code>spring.datasource.url: 'jdbc:postgresql://db:5432/hapi'</code> in docker-compose.yml files. But, what does not appear to work are configs in application.yml that are commented out, so <code>hapi.fhir.cql_enabled: \"true\"</code> does not work. Thoughts? (For the close observer, bools are enclosed in quotes in yml.)</p>\n<p>Update: Doh, single quotes for the bool value worked. :)<br>\nUpdate: How does one enable partitioning, e.g. <code>hapi.fhir.partitioning</code> because <code>multitenancy_enabled</code> has been removed from application.yaml?</p>",
        "id": 234954830,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1618629148
    },
    {
        "content": "<p>After some attempts, I'm not sure how multitenancy is enabled. Neither <code>hapi.fhir.partitioning.multitenancy_enabled</code> or <code>hapi.fhir.partitioning_multitenancy_enabled</code> are in 5.3 and master application.yaml</p>",
        "id": 235021569,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1618696230
    },
    {
        "content": "<p>Hi all,<br>\nI try to run the starter project with SpringBoot and the Rest Server is OK but for the Web Testpage UI (cannot run the hapi-fhir-testpage-overlay with SpringBoot).  I don't know how to config the path then it throws exception : Could not open ServletContext resource [/WEB-INF/templates/home.html (when I run with Jetty it is OK). Could you help me ?</p>",
        "id": 235142600,
        "sender_full_name": "Jame Dang",
        "timestamp": 1618819628
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191505\">@Sean McIlvenna</span> I'm going through PRs and it seems you may be the expert on application.yaml. Can I ask for your help on starting HAPI JPA in multitenancy mode?</p>",
        "id": 235188038,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1618841973
    },
    {
        "content": "<p>Heh... Well, that's something I haven't done, yet. It's something that I would <em>also</em> like to know how to do, though.</p>",
        "id": 235200212,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846018
    },
    {
        "content": "<p>Let me take a look at and see if I can figure out a general direction to point you in...</p>",
        "id": 235200255,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846035
    },
    {
        "content": "<p>At first glance, it looks like partitioning is enabled by default</p>",
        "id": 235200579,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846194
    },
    {
        "content": "<p>(which is the same as multi-tenancy)</p>",
        "id": 235200670,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846217
    },
    {
        "content": "<p>And there are two <em>configurable</em> properties for partitioning:</p>\n<ul>\n<li>allow_references_across_partitions</li>\n<li>partitioning_include_in_search_hashes</li>\n</ul>",
        "id": 235200737,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846237
    },
    {
        "content": "<p>HAPI can be configured to have a pre-defined set of tenants... but, in the case of <code>hapi-fhir-jpaserver-starter</code>, it looks like it allows <em>any</em> tenant ID</p>",
        "id": 235201104,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846364
    },
    {
        "content": "<p>so, theoretically, you should just be able to GET/POST/PUT/DELETE with <code>/fhir/&lt;tenantID&gt;/&lt;resourceType&gt;/&lt;resourceId&gt;</code></p>",
        "id": 235201214,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846403
    },
    {
        "content": "<p>I'm going to test this out, now</p>",
        "id": 235201239,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846416
    },
    {
        "content": "<p>oh... partitioning is not on <em>by  default</em></p>",
        "id": 235202216,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846804
    },
    {
        "content": "<p>it is activated when the <code>partitioning:</code> property is present in the <code>application.yml</code> property</p>",
        "id": 235202280,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846819
    },
    {
        "content": "<p>i.e.</p>\n<div class=\"codehilite\"><pre><span></span><code>    partitioning:\n      allow_references_across_partitions: false\n      partitioning_include_in_search_hashes: false\n</code></pre></div>",
        "id": 235202331,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846837
    },
    {
        "content": "<p>if that block is commented out, then partitioning is disabled</p>",
        "id": 235202357,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618846850
    },
    {
        "content": "<p>Once partitioning is enabled, you can create partitions with the custom operation <code>$partition-management-create-partition</code>, as documented here:<br>\n<a href=\"https://hapifhir.io/hapi-fhir/docs/server_jpa_partitioning/partitioning_management_operations.html\">https://hapifhir.io/hapi-fhir/docs/server_jpa_partitioning/partitioning_management_operations.html</a></p>",
        "id": 235203348,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847264
    },
    {
        "content": "<p>This should be done against the DEFAULT partition</p>",
        "id": 235203376,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847278
    },
    {
        "content": "<p>i.e.: POST <a href=\"http://localhost:8080/fhir/DEFAULT/$partition-management-create-partition\">http://localhost:8080/fhir/DEFAULT/$partition-management-create-partition</a></p>",
        "id": 235203442,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847291
    },
    {
        "content": "<p>After the partition is created, you can do whatever you want with it, like a normal FHIR server</p>",
        "id": 235203480,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847309
    },
    {
        "content": "<p>under a partition/tenant in the path of the url</p>",
        "id": 235203520,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847326
    },
    {
        "content": "<p>Hope that helps!</p>",
        "id": 235203535,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1618847332
    },
    {
        "content": "<p>Ok, interesting. I tried it with env vars and there's no way to toggle just partitioning on/off. This seems to be an anti-pattern for automated E2E/QA because the only solution is to hand edit the file and it is not explicit (See <a href=\"https://12factor.net/config\">https://12factor.net/config</a>).</p>",
        "id": 235205640,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1618848115
    }
]