[
    {
        "content": "<p>I am implementing a FHIR server where I need to delegate a patient search query to another server backend. The server function that implements this search is called with three parameters <em>family</em>, <em>given</em> (both StringParam) and a <em>birthday</em> (DateParam)</p>\n<p>My delegation code I have envisioned looks something like this ...</p>\n<div class=\"codehilite\"><pre><span></span><code>return fhirContext.newRestfulGenericClient(backendInstance)\n    .search()\n    .forResource(Patient.class)\n    .where(criteria)   // ??? can&#39;t use .where(Patient.FAMILY.matches().value(family.getValue()))\n    .execute();\n</code></pre></div>\n\n\n<p>However, I am not sure about how to fill the <em>criteria</em> parameter. Depending on whether family, given and birthday are present, criteria should be set accordingly. (That's why I can't use Patient.FAMILY.matches() ... or other similar functions here)</p>\n<p>I did not get very far with the implementation of <em>where()</em> that accepts an <em>ICriterion&lt;...&gt;</em> object and was considering the alternative <em>where()</em> that takes a <em>Map&lt;String, List&lt;IQueryParameterType&gt;&gt;</em></p>\n<p>Here is the code that sets up the criteria HashMap as I would guess how it might work. Unfortunately I am probably missing something as my code  does not yield any results (unless my search criteria are all empty):</p>\n<div class=\"codehilite\"><pre><span></span><code>    // family is a StringParam\n    Map&lt;String, List&lt;IQueryParameterType&gt;&gt; criteria = new HashMap&lt;&gt;();\n    if (family != null &amp;&amp; !family.isEmpty()) {\n        criteria.put(&quot;family&quot;,  Arrays.asList(family));\n    }\n</code></pre></div>\n\n\n<p>Can somebody point me in the right direction or post a documentation link that clears this up?</p>",
        "id": 207600800,
        "sender_full_name": "Volker Wick",
        "timestamp": 1597986107
    },
    {
        "content": "<p>Ok, so it turns out it works pretty much as I had outlined it in my question. A bug in my test backend had sent me on a wild goose chase and the approach was ok all along.</p>\n<p>One additional point to note is that the string keys in the <em>criteria</em> map must match the corresponding search parameters, i.e. \"family\", \"given\" and \"birthdate\".</p>",
        "id": 207626008,
        "sender_full_name": "Volker Wick",
        "timestamp": 1598011369
    }
]