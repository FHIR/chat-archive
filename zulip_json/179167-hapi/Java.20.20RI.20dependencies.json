[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> I have a question for you </p>",
        "id": 153862545,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240435
    },
    {
        "content": "<p>I need to upgrade the standard validator so it can handle STU2 and STU3 inputs </p>",
        "id": 153862546,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240476
    },
    {
        "content": "<p>I have the code to do it, but I have a package dependency issue. </p>",
        "id": 153862547,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240504
    },
    {
        "content": "<p>org.hl7.fhir.convertors depends on org.hl7.fhir.dstu3, org.hl7.fhir.dstu2, and org.hl7.fhir.dstu2016may</p>",
        "id": 153862548,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240541
    },
    {
        "content": "<p>each of those doesn't depend on any of the others. </p>",
        "id": 153862549,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240557
    },
    {
        "content": "<p>the conversion code is in org.hl7.fhir.convertors</p>",
        "id": 153862550,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240569
    },
    {
        "content": "<p>making dstu3 depend on convertors seems like a bad idea to me </p>",
        "id": 153862551,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240589
    },
    {
        "content": "<p>moving the validator to a new package or to convertors is hard for me</p>",
        "id": 153862552,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240615
    },
    {
        "content": "<p>HAPI is probably the main impact. Any opinions?</p>",
        "id": 153862553,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481240628
    },
    {
        "content": "<p>How are you going to change the validator to handle both kinds of inputs? Does converter convert the structuredefinition from 2 to 3 or something? (headed to bed now, won't see your response until morning :) )</p>",
        "id": 153862624,
        "sender_full_name": "James Agnew",
        "timestamp": 1481255242
    },
    {
        "content": "<p>a -version parameter - if you specify -version 1.0.2, then it will convert everything on the fly</p>",
        "id": 153862625,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481255361
    },
    {
        "content": "<p>InstanceValidator.java won't change - the conversion will have to be done in the wrapper (e.g. ValidationEngine)</p>",
        "id": 153862626,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481255424
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ping on this subject please</p>",
        "id": 153862815,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481317902
    },
    {
        "content": "<p>Oops sorry.. So the idea here is that we have:<br>\n<code>A</code> - DSTU2 model<br>\n<code>B</code> - DSTU2.1 model<br>\n<code>C</code> - STU3 model and validator<br>\n<code>D</code> - Converter code for DSTU2 &gt; STU3 model</p>\n<p><code>C</code> depends on <code>A B C</code></p>\n<p>You want to have the validator be able to validate DSTU2/2.1 data, but that means <code>D</code> needs to depend on <code>A B C</code></p>",
        "id": 153862822,
        "sender_full_name": "James Agnew",
        "timestamp": 1481319133
    },
    {
        "content": "<p>That means you have a circular dependency though.. I don't actually get how that even compiles.</p>\n<p>Should the validator be moved out into its own JAR maybe that depends on A B C D?</p>",
        "id": 153862823,
        "sender_full_name": "James Agnew",
        "timestamp": 1481319174
    },
    {
        "content": "<p>yes, that's an option.</p>",
        "id": 153862828,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319450
    },
    {
        "content": "<p>I hadn't found out whether I could resolve the circular dependency. </p>",
        "id": 153862829,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319471
    },
    {
        "content": "<p>it's ok for HAPI for me to move the validator to E that depends on ABCD?</p>",
        "id": 153862830,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319495
    },
    {
        "content": "<p>that would be better actually... that way android users don't need to include the validator. They'll thank you.</p>",
        "id": 153862831,
        "sender_full_name": "James Agnew",
        "timestamp": 1481319517
    },
    {
        "content": "<p>hmmm. I wasn't going to go that far. I was just going to clone ValidationEngine and Validationout of dstu3 package. and leave InstanceValidator in there</p>",
        "id": 153862832,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319603
    },
    {
        "content": "<p>why would android users be happy? </p>",
        "id": 153862833,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319614
    },
    {
        "content": "<p>and wouldn't other users be unhappy because now they could only have the validator if they had ABC not just C?</p>",
        "id": 153862834,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319649
    },
    {
        "content": "<p>Android: With Android every class and method in your dependency count contributes to an overall count of methods, and if you have more than some number of them (I forget the threshold) you need to jump through a bunch of hoops. So every class you don't need that can be avoided is a good thing.</p>\n<p>Other users: I figured I'd set this up in a way that it detected which dependencies were on the classpath and acted accordingly. It does this already in a few spots..</p>\n<p>What do you mean \"clone out\"? Like you'll have the same validator code in <code>C</code> and this newly created <code>E</code>?</p>",
        "id": 153862835,
        "sender_full_name": "James Agnew",
        "timestamp": 1481319801
    },
    {
        "content": "<p>well, I was just going to move the wrapper that invokes it, not the whole thing. But I can move all the validator code from abc to e. that just means that anyone using the validator has to have abc not just the particular version. I don't know how that works with HAPI now...?</p>",
        "id": 153862836,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481319883
    },
    {
        "content": "<p>Currently the validators are bundled with their respective versions. So the STU3 model JAR has the stu3 validator, and the DSTU2 JAR has the stu2 validator. (i guess that part is obvious)</p>\n<p>In order to validate though, you already need to bring in a second dependency since the validation resources (profiles.xml, valuesets.xml, etc.) are in a separate JAR. I'm not fretting about that.. it's a bit of a pain maybe, but the benefit of having 1 validator across both versions of FHIR would far outweigh that.</p>",
        "id": 153862840,
        "sender_full_name": "James Agnew",
        "timestamp": 1481320056
    },
    {
        "content": "<p>ok, well, I'll do that </p>",
        "id": 153862842,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481320104
    },
    {
        "content": "<p>it has a long tail, though. So I don't know how long it'll take</p>",
        "id": 153862843,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481320118
    },
    {
        "content": "<p>hmm. I don't know what to do with IResourceValidator</p>",
        "id": 153862847,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481320682
    },
    {
        "content": "<p>Well, for the DSTU3 one i'd say just move it to <code>D</code></p>\n<p>Do the DSTU2/2.1 ones even have a place under your new scheme? I'm assuming you have some kind of wrapper code that takes in a DSTU2 resource, calls the converter, calls the STU3 validator, then converts the response back? If s, does that code implement the DSTU2 IResourceValidator method? If so, that interface goes in D too I guess?</p>",
        "id": 153862852,
        "sender_full_name": "James Agnew",
        "timestamp": 1481320904
    },
    {
        "content": "<p>nah, figured that. ValidationMessage might be a big harder</p>",
        "id": 153862853,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481320924
    },
    {
        "content": "<p>I'm not sure what to do with the validator for DSTU2. I'm not maintaining it, but it's still there for people to run, and me to think about. Actually removing it is a big step</p>",
        "id": 153862854,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481320963
    },
    {
        "content": "<p>anyway, the back yard calls...</p>",
        "id": 153862855,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481321001
    },
    {
        "content": "<p>ah right, and if you're leaving it in the DSTU2 JAR you need the interface I guess is the issue?</p>",
        "id": 153862856,
        "sender_full_name": "James Agnew",
        "timestamp": 1481321009
    },
    {
        "content": "<p>I need the interface i I'm pulling it out still</p>",
        "id": 153862857,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481321038
    },
    {
        "content": "<p>but i can leave the interface, and just have the actual validator implement all the version interfaces. if I decide to do it that way</p>",
        "id": 153862858,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481321070
    },
    {
        "content": "<p>Yeah that makes sense</p>",
        "id": 153862859,
        "sender_full_name": "James Agnew",
        "timestamp": 1481321084
    },
    {
        "content": "<p>Have fun in the back yard :)</p>",
        "id": 153862860,
        "sender_full_name": "James Agnew",
        "timestamp": 1481321096
    },
    {
        "content": "<p>ok done</p>",
        "id": 153862904,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481408977
    }
]