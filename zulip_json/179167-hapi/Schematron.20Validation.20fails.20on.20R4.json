[
    {
        "content": "<p>Hi,</p>\n<p>I am using HAPI 3.7.0 implementation for FHIR. When I apply schematron validation on a R4 Patient resource, I get the following failure:<br>\nFailed to apply Schematron bundleresource://367.fwk360062456:7/org/hl7/fhir/r4/model/schema/patient.sch onto XML source</p>\n<p>Resource input that I provide:<br>\n&lt;Patient xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n&lt;identifier&gt;<br>\n&lt;period&gt;<br>\n&lt;start value=\"2003-05-06\"/&gt;<br>\n&lt;end value=\"2000-05-07\"/&gt;<br>\n&lt;/period&gt;<br>\n&lt;/identifier&gt;<br>\n&lt;/Patient&gt;</p>\n<p>I have validated that a schematron is present in the validation resources jar and has a rule :<br>\n&lt;sch:rule context=“f:Patient/f:identifier/f:period”&gt;<br>\n&lt;sch:assert test=“not(exists(f:start/@value)) or not(exists(f:end/@value)) or (xs:dateTime(f:start/@value) &lt;= xs:dateTime(f:end/@value))”&gt;per-1: If present, start SHALL have a lower value than end&lt;/sch:assert&gt;<br>\n&lt;/sch:rule&gt;</p>\n<p><strong>This issue is faced only on R4</strong>. For STU3 and DSTU2, this scenario passes with below outcome :</p>\n<p>&lt;OperationOutcome&gt;<br>\n&lt;issue&gt;<br>\n&lt;severity value=\"error\"/&gt;<br>\n&lt;code value=\"processing\"/&gt;<br>\n&lt;diagnostics value=\"[error] in /*:Patient[namespace-uri()='<a href=\"http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]\" target=\"_blank\" title=\"http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]\">http://hl7.org/fhir'][1]/*:identifier[namespace-uri()='http://hl7.org/fhir'][1]/*:period[namespace-uri()='http://hl7.org/fhir'][1]</a> @ Patient per-1: If present, start SHALL have a lower value than end Test=not(exists(f:start)) or not(exists(f:end)) or (f:start/@value &lt;= f:end/@value)\"/&gt;<br>\n&lt;location value=\"Patient\"/&gt;<br>\n&lt;/issue&gt;<br>\n&lt;/OperationOutcome&gt;</p>\n<p>I suspect there is a bug with the SchematronValidator for R4.</p>\n<p>Please check.</p>\n<p>Regards,<br>\nMukesh</p>",
        "id": 173669880,
        "sender_full_name": "Mukesh Sharma",
        "timestamp": 1566316239
    },
    {
        "content": "<p>That looks like a valid error to me- your start date comes after your end date, so that's not a valid period.</p>",
        "id": 173687369,
        "sender_full_name": "James Agnew",
        "timestamp": 1566328771
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> I think the point is that the Schematron rule validly fires in DSTU2 and STU3 but not in R4.</p>",
        "id": 173694130,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1566333605
    }
]