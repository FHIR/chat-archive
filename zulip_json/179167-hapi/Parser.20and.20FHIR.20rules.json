[
    {
        "content": "<p>I just serialized a resource having a contained resource having the narrative (.text) populated. This is not allowed by the FHIR standard, and hapi strips it.</p>\n<p>I totally understand, that hapi tries to prevent miss-use of FHIR, but i think a parser/encoder shouldn't enforce \"business logic\", or at least has a parameter/config to disable this guidance.</p>",
        "id": 272114168,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645017657
    },
    {
        "content": "<p>I actually didn't realize is was not allowed to prescribe the narrative.. I assume this is only if the status is <code>generated</code>?</p>",
        "id": 272117344,
        "sender_full_name": "Brian Kaney",
        "timestamp": 1645019290
    },
    {
        "content": "<p>you are right. It is only relevant during narrative rendering/generation. It was a rule back in STU1/2</p>",
        "id": 272138374,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645028412
    },
    {
        "content": "<p>This was already reported to hapi: <a href=\"https://github.com/hapifhir/hapi-fhir/issues/1466\">https://github.com/hapifhir/hapi-fhir/issues/1466</a></p>",
        "id": 272138411,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645028434
    },
    {
        "content": "<p>I think we need to revert the changes made here: <a href=\"https://github.com/hapifhir/hapi-fhir/commit/287162af914231aa5d994813de9a4d1ea64f0196\">https://github.com/hapifhir/hapi-fhir/commit/287162af914231aa5d994813de9a4d1ea64f0196</a></p>",
        "id": 272147597,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645032117
    },
    {
        "content": "<p>Will create a PR (probably tomorrow)</p>",
        "id": 272148048,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645032277
    },
    {
        "content": "<p>fix is ready, will fix the broken tests tomorrow</p>",
        "id": 272193562,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645053562
    },
    {
        "content": "<p><a href=\"https://github.com/hapifhir/hapi-fhir/pull/3402\">https://github.com/hapifhir/hapi-fhir/pull/3402</a></p>",
        "id": 272235047,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645090964
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> who should i mark for a review on the PR?</p>",
        "id": 272235083,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645090988
    },
    {
        "content": "<p>I just did a quick scan, and I can't even find the rule forbidding narratives in contained resources in R4... Does it still exist?</p>",
        "id": 272281907,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114088
    },
    {
        "content": "<p>Yes, the parsers are skipping encoding narratives. My PR removes the code and also changes the unit tests affected by the change.</p>",
        "id": 272282149,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645114201
    },
    {
        "content": "<p>Ah, you meant the spec <span aria-label=\"smiley\" class=\"emoji emoji-1f603\" role=\"img\" title=\"smiley\">:smiley:</span></p>",
        "id": 272282264,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645114238
    },
    {
        "content": "<p>heh yeah</p>\n<p>If it's still a rule, I will say this kind of change makes me at least a bit nervous. I get your point about a parser shouldn't be enforcing business rules, but the counter argument is that if the library lets you do it people will assume it's ok and use it.. and then there may be safety issues since the consumers could miss the existence of that data.</p>",
        "id": 272282281,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114247
    },
    {
        "content": "<p>We could make that configurable though in the ParserOptions</p>",
        "id": 272282303,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114261
    },
    {
        "content": "<p>Or if it's not even a rule anymore we should definitely not enforce it</p>",
        "id": 272282335,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114278
    },
    {
        "content": "<p>this was only a rule in STU1 iirc.. will double check on this</p>",
        "id": 272282433,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645114321
    },
    {
        "content": "<p>Looks like it's gone. I found it in DSTU1: <a href=\"https://www.hl7.org/fhir/DSTU1/narrative.html\">https://www.hl7.org/fhir/DSTU1/narrative.html</a></p>\n<blockquote>\n<p>Note that contained Resources SHALL NOT have a narrative of their own.</p>\n</blockquote>",
        "id": 272282682,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114422
    },
    {
        "content": "<p>But it's not in R4 on that page</p>",
        "id": 272282697,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114429
    },
    {
        "content": "<p>I've approved the PR - Please add a changelog though before you merge :)</p>",
        "id": 272282865,
        "sender_full_name": "James Agnew",
        "timestamp": 1645114494
    },
    {
        "content": "<p>thanks. I added a change yml file, do i have to provide the change at another location as well?</p>",
        "id": 272283057,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645114570
    },
    {
        "content": "<p>checked other PRs. I think i'm good: <a href=\"https://github.com/hapifhir/hapi-fhir/blob/9f2af9747fbd600c78acd0955554515cdf0394b9/hapi-fhir-docs/src/main/resources/ca/uhn/hapi/fhir/changelog/6_0_0/1466-encode-narratives-of-encoded-resources.yaml\">https://github.com/hapifhir/hapi-fhir/blob/9f2af9747fbd600c78acd0955554515cdf0394b9/hapi-fhir-docs/src/main/resources/ca/uhn/hapi/fhir/changelog/6_0_0/1466-encode-narratives-of-encoded-resources.yaml</a></p>",
        "id": 272292670,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645118527
    },
    {
        "content": "<p>that's awesome, thanks!</p>",
        "id": 272301794,
        "sender_full_name": "James Agnew",
        "timestamp": 1645122146
    },
    {
        "content": "<p>Thanks for the quick review. <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>",
        "id": 272310671,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1645126191
    }
]