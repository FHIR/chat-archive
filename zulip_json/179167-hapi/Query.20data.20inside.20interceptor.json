[
    {
        "content": "<p>I'd like to create a custom interceptor that check permissions based on  data query result. Does hapi support \"server side fluet query\" -  so I'd like to query data directly from within my jpa server, and not using rest api</p>",
        "id": 244615160,
        "sender_full_name": "Marek Gocał",
        "timestamp": 1625167680
    },
    {
        "content": "<p>To be more precise what my interceptor does:</p>\n<ol>\n<li>Receive external (outh provider) token</li>\n<li>Call outh service to verify if token is valid</li>\n<li>\n<p>Get user details for the outh service<br>\n<strong>4. Find user that matches user details email (e.g. via system/identifier keys)</strong></p>\n</li>\n<li>\n<p>Filter results based on the user id</p>\n</li>\n</ol>\n<p>So my question is how can you query hapi (from my interceptor) to retrieve user based on system/identifier</p>",
        "id": 244615608,
        "sender_full_name": "Marek Gocał",
        "timestamp": 1625167921
    },
    {
        "content": "<p>I'm wondering the same, in my case I want to lookup a <code>Device</code> based on the OAuth <code>azp</code> field to determine if a party is authorized for a request. Did you manage to  find out yet <span class=\"user-mention\" data-user-id=\"424158\">@Marek Gocał</span> ? Or perhaps someone else can help?</p>",
        "id": 248837951,
        "sender_full_name": "Joris Scharp",
        "timestamp": 1628512140
    },
    {
        "content": "<p>For now I just inject the Dao from the <code>BaseJpaRestfulServer</code>; not sure if this is best practice though..</p>\n<p><code>daoRegistry.getResourceDao(ResourceTypeEnum.DEVICE.getCode())</code></p>",
        "id": 248839372,
        "sender_full_name": "Joris Scharp",
        "timestamp": 1628512929
    },
    {
        "content": "<p>Didn't manage to solve my problem yet, but I will try with your solution!</p>",
        "id": 249022740,
        "sender_full_name": "Marek Gocał",
        "timestamp": 1628622794
    },
    {
        "content": "<p>Yeah works fine for me <span class=\"user-mention\" data-user-id=\"424158\">@Marek Gocał</span> , there's  a slight better way to extract the  DAO (with generics) though. So inside <code>ca.uhn.fhir.jpa.starter.JpaRestfulServer#initialize</code>:</p>\n<div class=\"codehilite\"><pre><span></span><code>...\nfinal IFhirResourceDao&lt;Device&gt; deviceDao = daoRegistry.getResourceDao(Device.class);\nregisterInterceptor(new InjectResourceOriginInterceptor(deviceDao));\n...\n</code></pre></div>",
        "id": 249023679,
        "sender_full_name": "Joris Scharp",
        "timestamp": 1628623249
    }
]