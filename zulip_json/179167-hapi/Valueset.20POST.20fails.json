[
    {
        "content": "<p>Hello Implementers, <br>\n   I have been desperately create a valueset in JPA hapi server. I tried this and its erroring out with the following error mgs<br>\nI tried this sample valueset from here <a href=\"http://hl7.org/fhir/R4/valueset-relatedperson-relationshiptype.json\">http://hl7.org/fhir/R4/valueset-relatedperson-relationshiptype.json</a>. I tried to post to my hapi jpa server.<br>\ncurl --location --request POST '<a href=\"http://localhost:8080/fhir/ValueSet\">http://localhost:8080/fhir/ValueSet</a>' \\<br>\n--header 'Content-Type: application/fhir+json' \\<br>\n--header 'Cookie: JSESSIONID=45A8B8827CD707FD9A0CF7D25B5D0B41' \\<br>\n--data-raw '{<br>\n\"resourceType\" : \"ValueSet\",<br>\n\"id\" : \"relatedperson-relationshiptype\",<br>\n\"meta\" : {<br>\n\"lastUpdated\" : \"2019-11-01T09:29:23.356+11:00\",<br>\n\"profile\" : [\"http://hl7.org/fhir/StructureDefinition/shareablevalueset\"]<br>\n},<br>\n\"text\" : {<br>\n\"status\" : \"generated\",<br>\n\"div\" : \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h2&gt;Patient relationship type&lt;/h2&gt;&lt;div&gt;&lt;p&gt;A set of codes that can be used to indicate the relationship between a Patient and a Related Person.&lt;/p&gt;\\n&lt;/div&gt;&lt;p&gt;This value set includes codes from the following code systems:&lt;/p&gt;&lt;ul&gt;&lt;li&gt;Include all codes defined in &lt;a href=\\\"v2/0131/index.html\\\"&gt;&lt;code&gt;http://terminology.hl7.org/CodeSystem/v2-0131&lt;/code&gt;&lt;/a&gt;&lt;/li&gt;&lt;li&gt;Include codes from &lt;a href=\\\"v3/RoleCode/cs.html\\\"&gt;&lt;code&gt;http://terminology.hl7.org/CodeSystem/v3-RoleCode&lt;/code&gt;&lt;/a&gt; where concept is-a &lt;a href=\\\"v3/RoleCode/cs.html#v3-RoleCode-_PersonalRelationshipRoleType\\\"&gt;_PersonalRelationshipRoleType&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/div&gt;\"<br>\n},<br>\n\"extension\" : [{<br>\n\"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-wg\">http://hl7.org/fhir/StructureDefinition/structuredefinition-wg</a>\",<br>\n\"valueCode\" : \"pa\"<br>\n}],<br>\n\"url\" : \"<a href=\"http://hl7.org/fhir/ValueSet/relatedperson-relationshiptype\">http://hl7.org/fhir/ValueSet/relatedperson-relationshiptype</a>\",<br>\n\"identifier\" : [{<br>\n\"system\" : \"urn:ietf:rfc:3986\",<br>\n\"value\" : \"urn:oid:2.16.840.1.113883.4.642.3.449\"<br>\n}],<br>\n\"version\" : \"4.0.1\",<br>\n\"name\" : \"PatientRelationshipType\",<br>\n\"title\" : \"Patient relationship type\",<br>\n\"status\" : \"draft\",<br>\n\"experimental\" : false,<br>\n\"date\" : \"2019-11-01T09:29:23+11:00\",<br>\n\"publisher\" : \"FHIR Project team\",<br>\n\"contact\" : [{<br>\n\"telecom\" : [{<br>\n\"system\" : \"url\",<br>\n\"value\" : \"<a href=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"<br>\n}]<br>\n}],<br>\n\"description\" : \"A set of codes that can be used to indicate the relationship between a Patient and a Related Person.\",<br>\n\"compose\" : {<br>\n\"include\" : [{<br>\n\"system\" : \"<a href=\"http://terminology.hl7.org/CodeSystem/v2-0131\">http://terminology.hl7.org/CodeSystem/v2-0131</a>\"<br>\n},<br>\n{<br>\n\"system\" : \"<a href=\"http://terminology.hl7.org/CodeSystem/v3-RoleCode\">http://terminology.hl7.org/CodeSystem/v3-RoleCode</a>\",<br>\n\"filter\" : [{<br>\n\"property\" : \"concept\",<br>\n\"op\" : \"is-a\",<br>\n\"value\" : \"_PersonalRelationshipRoleType\"<br>\n}]<br>\n}]<br>\n}<br>\n}'</p>\n<p>but I got back this error<br>\n{<br>\n\"resourceType\": \"OperationOutcome\",<br>\n\"issue\": [<br>\n{<br>\n\"severity\": \"error\",<br>\n\"code\": \"processing\",<br>\n\"diagnostics\": \"Failed to call access method: org.springframework.dao.InvalidDataAccessApiUsageException: No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call; nested exception is javax.persistence.TransactionRequiredException: No EntityManager with actual transaction available for current thread - cannot reliably process 'persist' call\"<br>\n}<br>\n]<br>\n}</p>\n<p>Can you please kindly help me ?. thanks for your help.<br>\nFYI, I also removed id (as suggested in Implementers forum) and tried still the same error. Can you please help?. </p>\n<p>thanks</p>",
        "id": 200319412,
        "sender_full_name": "Nath",
        "timestamp": 1591764891
    },
    {
        "content": "<p>Hello Implementers, is there a workaround or a different way to load the valueset ?. This is most common usecase, I am sure many people might be using it. May be I don't know how to load this. Could you please kindly give some pointers on how others are loading in Hapi?. thanks for your help.</p>",
        "id": 200461974,
        "sender_full_name": "Nath",
        "timestamp": 1591816004
    },
    {
        "content": "<p>Is this with the Spring Boot HAPI server? If so I think that's a known bug (<a href=\"https://github.com/jamesagnew/hapi-fhir/issues/1594\">https://github.com/jamesagnew/hapi-fhir/issues/1594</a>), I've had success POSTing the resource(s) within a transaction bundle instead.</p>",
        "id": 200507788,
        "sender_full_name": "Frederik Leonhardt",
        "timestamp": 1591854686
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"310179\">@Frederik Leonhardt</span> . yea, the same error as in this issue just that it says for PUT but I was trying POST. So, its basically an issue for both Post and Put. I will try to wrap in a txn bundle and try it. thanks for your help. appreciate it.</p>",
        "id": 200557553,
        "sender_full_name": "Nath",
        "timestamp": 1591888246
    },
    {
        "content": "<p>I tried with wrapping in a bundle but I get this error <br>\ncurl --location --request POST '<a href=\"http://localhost:8090/fhir\">http://localhost:8090/fhir</a>' \\<br>\n--header 'Content-Type: application/fhir+json' \\<br>\n--header 'X-Platform-Key: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJSUzUxMiJ9.eyJpYXQiOjE1OTE4Mjc3MDAsImV4cCI6MTU5Mjc1NjUwMCwiaXNzIjoiaHR0cHM6Ly9wbGF0Zm9ybS5uYXZpZnkuY29tIiwic3ViIjoiZTVlMzg0ZmYtMTc0MC00ZWQ0LWFkYmItZTUxOGRiMjRjYmMwIiwidGVuYW50X2lkIjoiMGYwNWEyNDAtZjI5YS0xMWU4LWE4ZDEtYWZkZGM2OWM0ZGI5Iiwicm9sZXMiOlsicGxhdGZvcm1BZG1pbiJdLCJjbGFpbXMiOlsicmVhZEFwcHMiLCJyZWFkQXBwIiwidXBkYXRlQXBwcyIsImRlbGV0ZUFwcHMiLCJkZXBsb3lBcHBzIl19.wjqxx6-Ypn-zEeqQLFCxBdGxUKIsmOh1t8O9pAiJRCp3lVQYSmNBLxvX23NNtjZBj_OvxvTIg62WKiWhiA_Rym2yA24od99TnFb0PnNrQHZjZ-PnjymqQWsk8fDRbFY3bGgL1J-hZhchjO55AjYzIYd-c-s2EWGI9jR5XE98EIsSULZMlpXnp91Bvs7Xz__bKCWP63MmoNBmZNfe_R9r0bFLLBuR9oKicZcNB6eo8FkRn8qGIFKEkNwG8TnIpq9bWTgBkZoVRsIcm3G_S8EQZbne28tXlD3cMKJdXDYr_n5zIR0K8lOXKSlCGCX7jZ2swhTYVewqfqhBeiRpEPMhaQ' \\<br>\n--header 'Cookie: JSESSIONID=BBAF1280718966F3969D5CDE6AF046FD' \\<br>\n--data-raw '{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"type\": \"transaction\",<br>\n  \"entry\": [<br>\n{<br>\n  \"resource\" : \"ValueSet\",<br>\n  \"id\" : \"action-type\",<br>\n  \"meta\" : {<br>\n    \"lastUpdated\" : \"2019-11-01T09:29:23.356+11:00\",<br>\n    \"profile\" : [\"http://hl7.org/fhir/StructureDefinition/shareablevalueset\"]<br>\n  },<br>\n  \"text\" : {<br>\n    \"status\" : \"generated\",<br>\n    \"div\" : \"&lt;div&gt;!-- Snipped for Brevity --&gt;&lt;/div&gt;\"<br>\n  },<br>\n  \"extension\" : [{<br>\n    \"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-wg\">http://hl7.org/fhir/StructureDefinition/structuredefinition-wg</a>\",<br>\n    \"valueCode\" : \"cds\"<br>\n  },<br>\n  {<br>\n    \"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status\">http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status</a>\",<br>\n    \"valueCode\" : \"trial-use\"<br>\n  },<br>\n  {<br>\n    \"url\" : \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm\">http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm</a>\",<br>\n    \"valueInteger\" : 2<br>\n  }],<br>\n  \"url\" : \"<a href=\"http://hl7.org/fhir/ValueSet/action-type\">http://hl7.org/fhir/ValueSet/action-type</a>\",<br>\n  \"identifier\" : [{<br>\n    \"system\" : \"urn:ietf:rfc:3986\",<br>\n    \"value\" : \"urn:oid:2.16.840.1.113883.4.642.3.809\"<br>\n  }],<br>\n  \"version\" : \"4.0.1\",<br>\n  \"name\" : \"ActionType\",<br>\n  \"title\" : \"ActionType\",<br>\n  \"status\" : \"draft\",<br>\n  \"experimental\" : false,<br>\n  \"date\" : \"2019-11-01T09:29:23+11:00\",<br>\n  \"publisher\" : \"HL7 (FHIR Project)\",<br>\n  \"contact\" : [{<br>\n    \"telecom\" : [{<br>\n      \"system\" : \"url\",<br>\n      \"value\" : \"<a href=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"<br>\n    },<br>\n    {<br>\n      \"system\" : \"email\",<br>\n      \"value\" : \"<a href=\"mailto:fhir@lists.hl7.org\">fhir@lists.hl7.org</a>\"<br>\n    }]<br>\n  }],<br>\n  \"description\" : \"The type of action to be performed.\",<br>\n  \"immutable\" : true,<br>\n  \"compose\" : {<br>\n    \"include\" : [{<br>\n      \"system\" : \"<a href=\"http://terminology.hl7.org/CodeSystem/action-type\">http://terminology.hl7.org/CodeSystem/action-type</a>\"<br>\n    }]<br>\n  },<br>\n      \"request\": {<br>\n        \"method\": \"POST\",<br>\n        \"url\": \"/ValueSet\"<br>\n      }<br>\n    }<br>\n  ]<br>\n}'</p>\n<p>Error <br>\n{<br>\n  \"resourceType\": \"OperationOutcome\",<br>\n  \"issue\": [<br>\n    {<br>\n      \"severity\": \"error\",<br>\n      \"code\": \"processing\",<br>\n      \"diagnostics\": \"theResource must not be null\"<br>\n    }<br>\n  ]<br>\n}</p>\n<p>stacktrace<br>\n020-06-11 19:49:24.652  WARN 20217 --- [nio-8090-exec-2] ca.uhn.fhir.parser.LenientErrorHandler   : Unknown attribute 'value' found while parsing<br>\n2020-06-11 19:49:24.660 ERROR 20217 --- [nio-8090-exec-2] c.u.f.r.s.i.ExceptionHandlingInterceptor : Failure during REST processing: java.lang.NullPointerException: theResource must not be null</p>\n<p>java.lang.NullPointerException: theResource must not be null<br>\n    at org.apache.commons.lang3.Validate.notNull(Validate.java:225) ~[commons-lang3-3.9.jar!/:3.9]<br>\n    at ca.uhn.fhir.context.FhirContext.getResourceDefinition(FhirContext.java:428) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.ParserState$PreResourceState.stitchBundleCrossReferences(ParserState.java:1055) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.ParserState$PreResourceState.endingElement(ParserState.java:950) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.ParserState.endingElement(ParserState.java:106) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1112) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1015) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1098) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1079) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.parseChildren(JsonParser.java:1015) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.doParseResource(JsonParser.java:196) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.JsonParser.doParseResource(JsonParser.java:178) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.parser.BaseParser.parseResource(BaseParser.java:710) ~[hapi-fhir-base-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.ResourceParameter.loadResourceFromRequest(ResourceParameter.java:184) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.ResourceParameter.parseResourceFromRequest(ResourceParameter.java:227) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.TransactionParameter.translateQueryParametersIntoServerArgument(TransactionParameter.java:85) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.BaseMethodBinding.createMethodParams(BaseMethodBinding.java:98) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.BaseResourceReturningMethodBinding.doInvokeServer(BaseResourceReturningMethodBinding.java:245) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.method.BaseResourceReturningMethodBinding.invokeServer(BaseResourceReturningMethodBinding.java:384) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.RestfulServer.handleRequest(RestfulServer.java:1002) ~[hapi-fhir-server-4.2.0.jar!/:na]<br>\n    at ca.uhn.fhir.rest.server.RestfulServer.doPost(RestfulServer.java:346) ~[hapi-fhir-server-4.2.0.jar!/:na]</p>",
        "id": 200630311,
        "sender_full_name": "Nath",
        "timestamp": 1591930249
    }
]