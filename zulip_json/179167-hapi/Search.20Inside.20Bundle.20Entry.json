[
    {
        "content": "<p>We have bundles stored in fhir server as 'document'. These bundles have resources of resourceType 'composition'. We want to search with identifier in these composite resources inside the bundle. Is it possible with hapi fhir?<br>\nExample bundle: <a href=\"http://hapi.fhir.org/baseR4/Bundle/1680668\">http://hapi.fhir.org/baseR4/Bundle/1680668</a><br>\nWe want to search resources inside this bundle that match this zdnumber:<br>\n\"identifier\": {<br>\n\"system\": \"<a href=\"http://zorgdomein.nl/zdnumber/\">http://zorgdomein.nl/zdnumber/</a>\",<br>\n\"value\": \"ZP10006208\"<br>\n},</p>",
        "id": 217326566,
        "sender_full_name": "Chiranjiv Roy",
        "timestamp": 1605817978
    },
    {
        "content": "<p>Interesting. Can somebody suggest something?</p>",
        "id": 217369580,
        "sender_full_name": "Bishakh Ghosh",
        "timestamp": 1605857621
    },
    {
        "content": "<p>I would suggest to not persist the whole bundle, but the individual resources. If you need the document, generate it with $document operation.</p>",
        "id": 217387712,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1605870554
    },
    {
        "content": "<p>Bundle has the searchParameter <code>composition</code>, this would work if hapi would support identifier references: <code>http://hapi.fhir.org/baseR4/Bundle?composition:identifier=ZP10006208</code></p>",
        "id": 217387845,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1605870641
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> doesn't that only apply for the identifier of the document itself? It sounds like the need here is to search for references inside the document</p>",
        "id": 217391917,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605873586
    },
    {
        "content": "<p>Ah, you are right. I thought the question was only about the composition identifier.</p>",
        "id": 217392159,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1605873743
    },
    {
        "content": "<p>Then i would go with individual resources</p>",
        "id": 217392190,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1605873769
    },
    {
        "content": "<p>Followed<span aria-label=\"fire\" class=\"emoji emoji-1f525\" role=\"img\" title=\"fire\">:fire:</span></p>",
        "id": 217399242,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1605878328
    },
    {
        "content": "<p>or ... add custom search indexes into the bundle according to your needs. We actually did that in an installation as the storing of the document was way faster compared to splitting it up and store the entries individually (there where roughly 200 entries in the document if I remember correctly).</p>",
        "id": 217442074,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605897757
    },
    {
        "content": "<p>storing the document was a matter of millis - whereas storing 200 entries took around 2-3 secs</p>",
        "id": 217442131,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605897801
    },
    {
        "content": "<p>and ofc. one could then create an async job to do the splitting afterwards ... but then we are talking a bit more complexity</p>",
        "id": 217442262,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605897863
    },
    {
        "content": "<p>How about both storing the document (including the individual resource entries) and storing the entries?</p>",
        "id": 217487152,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1605938443
    },
    {
        "content": "<p>Is it allowable/permitted according to the FHIR spec?</p>",
        "id": 217487166,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1605938504
    },
    {
        "content": "<p>We add a facade in front of the hapi server which converts the message or document into a transaction bundle. <br>\nThis stored a lot faster in hapi</p>",
        "id": 217488140,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1605940417
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191687\">@Kevin Mayfield</span> you did that synchronously without a performance penalty?</p>",
        "id": 217498820,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605959998
    },
    {
        "content": "<p>Sync, individually it was taking around 2-3 mins, afterwards less than  a minute</p>",
        "id": 217501014,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1605963741
    },
    {
        "content": "<p>Well ... I have 400 ms - but good to know others also have had a look at this</p>",
        "id": 217501106,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1605963912
    },
    {
        "content": "<p>Please can I confirm what I think I'm understanding, here... If a <strong>document</strong> is persisted to the FHIR server (that includes a composition... such as an International Patient Summary, for example) -- then the resources <em>inside</em> the document, such as medication statement etc.,  are <strong>not</strong> individually searchable. Do I understand that correctly?</p>",
        "id": 217510175,
        "sender_full_name": "Derek Ritz",
        "timestamp": 1605979113
    },
    {
        "content": "<p>Yes</p>",
        "id": 217568302,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1606076882
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191687\">@Kevin Mayfield</span> . Is it true that they are not searchable only within the document itself... or is it also true that they are not discoverable when looking for (for example) medication orders related to the patient?</p>",
        "id": 217773222,
        "sender_full_name": "Derek Ritz",
        "timestamp": 1606233524
    },
    {
        "content": "<p>I understand it is stored in HAPI as a Bundle, so only the Bundle is searchable. Not it's contents, so I don't believe either would work. <br>\nIf you break up the bundle into it's component parts and store those in HAPI separately it would be searchable.</p>",
        "id": 217782074,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1606236936
    },
    {
        "content": "<p>yep - or add custom search parameters (as described pr. <a href=\"https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/\">https://blog.smilecdr.com/2017/02/08/custom-search-parameters-in-hapi-fhir/</a>)</p>",
        "id": 217782818,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1606237244
    },
    {
        "content": "<p>that points inside the bundle that is - but that shouldn't be your first resort</p>",
        "id": 217782892,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1606237275
    },
    {
        "content": "<p>Thanks, guys... this is helpful. <span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 217949602,
        "sender_full_name": "Derek Ritz",
        "timestamp": 1606345700
    }
]