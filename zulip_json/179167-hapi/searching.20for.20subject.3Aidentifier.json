[
    {
        "content": "<p>I posted this to <a href=\"#narrow/stream/179166-implementers/topic/How.20search.20on.20Reference.2Eidentifier.20in.20STU3/near/207663134\">Implementers thread</a>, and it was suggested that I post it here.</p>\n<p>I can successfully create this resource on <a href=\"http://hapi.fhir.org/baseR4/\">http://hapi.fhir.org/baseR4/</a></p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;Observation&gt;\n    &lt;subject&gt;\n        &lt;identifier&gt;\n            &lt;system value=&quot;http://acme.org/identifier/mrn&quot; /&gt;\n            &lt;value value=&quot;123&quot; /&gt;\n        &lt;/identifier&gt;\n    &lt;/subject&gt;\n&lt;/Observation&gt;\n</code></pre></div>\n\n\n<p>(a Patient resource does not exist)<br>\nand then I attempt to search for it using<br>\n<code>GET http://hapi.fhir.org/baseR4/Observation?subject:identifier=http://acme.org/identifier/mrn|123</code><br>\nbut it doesn't find anything. Is this expected behavior?<br>\nHow would I search for Observation.subject.identifier?</p>",
        "id": 207846974,
        "sender_full_name": " Bob Milius",
        "timestamp": 1598277963
    },
    {
        "content": "<p>In case you are still looking for an answer:</p>\n<p>First, the identifier does not belong into subject. Subject is a reference parameter to \"Who and/or what the observation is about\"<br>\n<a href=\"https://www.hl7.org/fhir/observation.html\">https://www.hl7.org/fhir/observation.html</a></p>\n<p>I created your Observation and found it with<br>\n./Observation?identifier=123</p>\n<p>But i guess there are better ways.</p>",
        "id": 210831340,
        "sender_full_name": "Marian Hummel",
        "timestamp": 1600755370
    },
    {
        "content": "<p>Actually, it should be <a href=\"http://hapi.fhir.org/baseR4/Observation?patient.identifier=http://acme.org/identifier/mrn|123\">http://hapi.fhir.org/baseR4/Observation?patient.identifier=http://acme.org/identifier/mrn|123</a> (. instead of : - parameter chaining is based on the . separator, and use the <em>patient</em> parameter (a Patient type resource) rather than the <em>subject</em> parameter (subject is mostly a Patient, but could be another resource type))</p>",
        "id": 210834189,
        "sender_full_name": "René Spronk",
        "timestamp": 1600758374
    },
    {
        "content": "<p>Sorry, I just noticed there were replies to this.</p>\n<p><span class=\"user-mention silent\" data-user-id=\"326329\">Marian Hummel</span> <a href=\"#narrow/stream/179167-hapi/topic/searching.20for.20subject.3Aidentifier/near/210831340\">said</a>:</p>\n<blockquote>\n<p>In case you are still looking for an answer:</p>\n<p>First, the identifier does not belong into subject. Subject is a reference parameter to \"Who and/or what the observation is about\"<br>\n<a href=\"https://www.hl7.org/fhir/observation.html\">https://www.hl7.org/fhir/observation.html</a></p>\n<p>I created your Observation and found it with<br>\n./Observation?identifier=123</p>\n<p>But i guess there are better ways.</p>\n</blockquote>\n<p>Yes, we are getting observations reported to us with a given subject identifier from external organizations. It is an observation about a patient using a research identifier (de-identified).  So there may be multiple observations about the same patient identifier. But they wouldn't know if a Patient resource has already been created or its id, so we are asking them to use observation.subject.identifier instead of observation.subject.reference. It seems like we should be able to search for Observations with a subject identifier. Since subject is a reference data type, seems like observation.subject should be able to be an identifier and I should be able to search for it.<br>\n<a href=\"/user_uploads/10155/-sfGqFbXLDhYQNjXW6pJ1Zsu/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/-sfGqFbXLDhYQNjXW6pJ1Zsu/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/-sfGqFbXLDhYQNjXW6pJ1Zsu/image.png\"></a></div>",
        "id": 227809322,
        "sender_full_name": " Bob Milius",
        "timestamp": 1614275878
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191372\">René Spronk</span> <a href=\"#narrow/stream/179167-hapi/topic/searching.20for.20subject.3Aidentifier/near/210834189\">said</a>:</p>\n<blockquote>\n<p>Actually, it should be <a href=\"http://hapi.fhir.org/baseR4/Observation?patient.identifier=http://acme.org/identifier/mrn|123\">http://hapi.fhir.org/baseR4/Observation?patient.identifier=http://acme.org/identifier/mrn|123</a> (. instead of : - parameter chaining is based on the . separator, and use the <em>patient</em> parameter (a Patient type resource) rather than the <em>subject</em> parameter (subject is mostly a Patient, but could be another resource type))</p>\n</blockquote>\n<p>Sorry, but this isn't working for me either. I don't necessarily have a Patient resource. Here's a more complete example:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Observation&quot;,\n    &quot;status&quot;: &quot;final&quot;,\n    &quot;category&quot;: [\n        {\n            &quot;coding&quot;: [\n                {\n                    &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/observation-category&quot;,\n                    &quot;code&quot;: &quot;vital-signs&quot;,\n                    &quot;display&quot;: &quot;Vital Signs&quot;\n                }\n            ],\n            &quot;text&quot;: &quot;Vital Signs&quot;\n        }\n    ],\n    &quot;code&quot;: {\n        &quot;coding&quot;: [\n            {\n                &quot;system&quot;: &quot;http://loinc.org&quot;,\n                &quot;code&quot;: &quot;9279-1&quot;,\n                &quot;display&quot;: &quot;Respiratory rate&quot;\n            }\n        ],\n        &quot;text&quot;: &quot;Respiratory rate&quot;\n    },\n    &quot;subject&quot;: {\n        &quot;identifier&quot;: {\n            &quot;system&quot;: &quot;http://example.org/identifier&quot;,\n            &quot;value&quot;: &quot;1234567&quot;\n        }\n    },\n    &quot;effectiveDateTime&quot;: &quot;1999-07-02&quot;,\n    &quot;valueQuantity&quot;: {\n        &quot;value&quot;: 26,\n        &quot;unit&quot;: &quot;breaths/minute&quot;,\n        &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n        &quot;code&quot;: &quot;/min&quot;\n    }\n}\n</code></pre></div>\n<p>I can upload this to <a href=\"http://hapi.fhir.org/baseR4\">hapi.fhir.org/baseR4</a> (see <a href=\"http://hapi.fhir.org/baseR4/Observation/1865320\">http://hapi.fhir.org/baseR4/Observation/1865320</a>)<br>\nbut I can't seem search for it based on the <code>subject.identifier</code> or <code>subject:identifer</code> or <code>patient.identifer</code>, or at least I don't know how. It seems I should be able to search for Observations based on subject identifier even if the Patient resource doesn't yet exist.</p>",
        "id": 227812883,
        "sender_full_name": " Bob Milius",
        "timestamp": 1614277365
    },
    {
        "content": "<p>I tried all these combinations</p>\n<div class=\"codehilite\"><pre><span></span><code>http://hapi.fhir.org/baseR4/Observation?subject:identifier=http://example.org/identifier|1234567\nhttp://hapi.fhir.org/baseR4/Observation?subject:identifier=http://example.org/identifier|\nhttp://hapi.fhir.org/baseR4/Observation?subject.identifier=http://example.org/identifier|123456\nhttp://hapi.fhir.org/baseR4/Observation?subject.identifier=http://example.org/identifier|\nhttp://hapi.fhir.org/baseR4/Observation?_filter=subject.identifier eq http://example.org/identifier|123456\nhttp://hapi.fhir.org/baseR4/Observation?_filter=subject.identifier eq http://example.org/identifier|\n</code></pre></div>\n<p>From my understanding, chaining (<code>subject.identifier</code>) will try to resolve the reference, so <code>subject:identifier</code> (I think these are called <a href=\"https://www.hl7.org/fhir/references.html#logical\">Logical references</a>?) seems the way to go. But doesn't work unfortunately.</p>",
        "id": 227908929,
        "sender_full_name": "Dexter",
        "timestamp": 1614335565
    },
    {
        "content": "<p>If you use a reference from e.g. an Observation to a Patient using reference.identifier (instead of reference.reference), there's not an expectation that the server will support parameter chaining. So that's probably the issue that you're running into.</p>",
        "id": 227915313,
        "sender_full_name": "René Spronk",
        "timestamp": 1614339484
    },
    {
        "content": "<p>My understanding is that if a patient resource exists and is known, then <code>observation.subject</code> should be a reference, e.g.,</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/123&quot;\n}\n</code></pre></div>\n<p>and then to find Observations of that subject, use </p>\n<div class=\"codehilite\"><pre><span></span><code>Observation?subject.identifier=http://example.org/identifier|1234567\n</code></pre></div>\n<p>But if you don't have a Patient resource, then <code>observation.subject</code> could be an identifier, e.g.,</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;subject&quot;: {\n    &quot;identifer&quot;: {\n        &quot;system&quot;: &quot;http://example.org/identifier&quot;,\n        &quot;value&quot;: &quot;1234567&quot;\n    }\n}\n</code></pre></div>\n<p>and then to find Observations of that subject, use </p>\n<div class=\"codehilite\"><pre><span></span><code>Observation?subject:identifier=http://example.org/identifier|1234567\n</code></pre></div>\n<p>This second method (using <code>subject:identifier</code> instead of <code>subject.identifier</code>) doesn't seem to work.</p>",
        "id": 227963141,
        "sender_full_name": " Bob Milius",
        "timestamp": 1614361298
    },
    {
        "content": "<p>I've been wondering if we need more guidance on the use of reference identifiers. I am in favour of using them between systems/providers (interop) but maybe not for client server interactions.</p>",
        "id": 228084710,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1614461916
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>            &quot;resourceType&quot;: &quot;RiskAssessment&quot;,\n            &quot;id&quot;: &quot;1&quot;,\n            &quot;meta&quot;: {\n                ...\n            },\n            &quot;identifier&quot;: [\n                {\n                    &quot;system&quot;: &quot;...&quot;,\n                    &quot;value&quot;: &quot;...&quot;\n                }\n            ],\n            &quot;status&quot;: &quot;final&quot;,\n            &quot;subject&quot;: {\n                &quot;identifier&quot;: {\n                    &quot;system&quot;: &quot;http://myapp.com/patient-mrn&quot;,\n                    &quot;value&quot;: &quot;99&quot;\n                }\n            },\n            &quot;prediction&quot;: [{...}]\n</code></pre></div>\n\n<p>Trying to query for RiskAssessment  GET /RiskAssessment?subject:identifier=http://myapp.com/patient-mrn%7C99<br>\nbut getting an empty bundle back. Any ideas what's wrong here?</p>",
        "id": 250433510,
        "sender_full_name": "DT",
        "timestamp": 1629768952
    },
    {
        "content": "<p>A couple of things,  first for any FHIR search you'll want to consult the FHIR spec page (near the bottom) for the specifics about which search parameters a particular resource supports:  <a href=\"https://www.hl7.org/fhir/riskassessment.html#search\">https://www.hl7.org/fhir/riskassessment.html#search</a></p>\n<p>In your case the subject is the \"field name\" within the resource but the search parameter is 'patient'.  (An FYI, most all search parameters are all lowercase and not the same as the name of the field in the resource).</p>\n<p>So, I believe your search should look like this:  /RiskAssessment?patient=identifier=http://myapp.com/patient-mrn%7C99</p>\n<p>[Also, you are using the urlencoded version of vertical bar \"|\", normally a FHIR server would expect the vertical bar not the urlencoded version so it probably should be: /RiskAssessment?patient=identifier=http://myapp.com/patient-mrn|99 ]</p>",
        "id": 250492010,
        "sender_full_name": "John Silva",
        "timestamp": 1629814961
    },
    {
        "content": "<p>Hello all!<br>\n<span class=\"user-mention\" data-user-id=\"191372\">@René Spronk</span> and <span class=\"user-mention\" data-user-id=\"298707\">@John Silva</span>  could someone post here working example with using modifier :identifier for reference type element?</p>\n<p>I'm trying to search Patient (<a href=\"http://hapi.fhir.org/baseR4/Patient/2639722\">http://hapi.fhir.org/baseR4/Patient/2639722</a>) resource with next body:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n      &quot;resourceType&quot;: &quot;Patient&quot;,\n      &quot;id&quot;: &quot;2639722&quot;,\n      &quot;meta&quot;: {\n        &quot;versionId&quot;: &quot;1&quot;,\n        &quot;lastUpdated&quot;: &quot;2021-10-12T10:49:47.309+00:00&quot;,\n        &quot;source&quot;: &quot;#bkRo4gg3Ap4kaCgo&quot;\n      },\n      &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;div class=\\&quot;hapiHeaderText\\&quot;&gt;Ms Charlene MN123 &lt;b&gt;THERON &lt;/b&gt; Sr &lt;/div&gt;&lt;table class=\\&quot;hapiPropertyTable\\&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;MR1039&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Date of birth&lt;/td&gt;&lt;td&gt;&lt;span&gt;06 October 2001&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;\n      },\n      &quot;identifier&quot;: [ {\n        &quot;type&quot;: {\n          &quot;coding&quot;: [ {\n            &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0203&quot;,\n            &quot;code&quot;: &quot;MR&quot;,\n            &quot;display&quot;: &quot;Medical record number&quot;\n          } ]\n        },\n        &quot;system&quot;: &quot;https://radboud.nl/identifiers/PatientIdentifier&quot;,\n        &quot;value&quot;: &quot;MR1039&quot;\n      } ],\n      &quot;name&quot;: [ {\n        &quot;use&quot;: &quot;usual&quot;,\n        &quot;family&quot;: &quot;Theron&quot;,\n        &quot;given&quot;: [ &quot;Charlene&quot;, &quot;MN123&quot; ],\n        &quot;prefix&quot;: [ &quot;Ms&quot; ],\n        &quot;suffix&quot;: [ &quot;Sr&quot; ]\n      }, {\n        &quot;use&quot;: &quot;usual&quot;,\n        &quot;family&quot;: &quot;ALLN1&quot;,\n        &quot;given&quot;: [ &quot;ALFN1&quot; ]\n      } ],\n      &quot;gender&quot;: &quot;male&quot;,\n      &quot;birthDate&quot;: &quot;2001-10-06&quot;,\n      &quot;contact&quot;: [ {\n        &quot;relationship&quot;: [ {\n          &quot;coding&quot;: [ {\n            &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v2-0131&quot;,\n            &quot;code&quot;: &quot;N&quot;,\n            &quot;display&quot;: &quot;Next-of-Kin&quot;\n          } ]\n        } ],\n        &quot;name&quot;: {\n          &quot;family&quot;: &quot;Monkey-Magic R&quot;,\n          &quot;given&quot;: [ &quot;Ruchir&quot;, &quot;M&quot; ]\n        }\n      } ],\n      &quot;managingOrganization&quot;: {\n        &quot;identifier&quot;: {\n          &quot;system&quot;: &quot;http://systemIdentifier.org&quot;,\n          &quot;value&quot;: &quot;sp13&quot;\n        }\n      }\n    }\n</code></pre></div>\n<p>using request<br>\nGET <a href=\"http://hapi.fhir.org/baseR4/Patient?organization:identifier=http://systemIdentifier.org|sp13\">http://hapi.fhir.org/baseR4/Patient?organization:identifier=http://systemIdentifier.org|sp13</a></p>\n<p>and i'm getting next</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre/&gt;&lt;/td&gt;\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;\n        }\n    ]\n}\n</code></pre></div>\n<p>then i'm trying using . intead of :<br>\nGET <a href=\"http://hapi.fhir.org/baseR4/Patient?organization.identifier=http://systemIdentifier.org|sp13\">http://hapi.fhir.org/baseR4/Patient?organization.identifier=http://systemIdentifier.org|sp13</a></p>\n<p>and i'm getting next</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;ERROR: canceling statement due to user request&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;ERROR: canceling statement due to user request&quot;\n        }\n    ]\n}\n</code></pre></div>\n<p>What should i do to get response?</p>",
        "id": 257183509,
        "sender_full_name": "Pavel Khromov",
        "timestamp": 1634036224
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"347882\">@Kevin Dougan</span> it looks like a bug on the test site</p>",
        "id": 257184631,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1634036855
    },
    {
        "content": "<p>Yes I'm seeing the same fault on most of the chained parameters I've tried</p>",
        "id": 257212734,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1634049186
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"364805\">@Pavel Khromov</span>  - looking at the data the managingOrgamization is NOT a proper reference (I believe); it should be something like:</p>\n<p><code>        \"managingOrganization\": {\n          \"reference\": \"https://server.fire.ly/r4/Organization/1ee3cbd8-c0fd-442e-bffa-83e213e7d734\"\n        },\n </code></p>\n<p>If I perform this search on the Firely public R4 server it works as expected:</p>\n<p><a href=\"https://server.fire.ly/r4/Patient?_format=json&amp;organization=1ee3cbd8-c0fd-442e-bffa-83e213e7d734\">https://server.fire.ly/r4/Patient?_format=json&amp;organization=1ee3cbd8-c0fd-442e-bffa-83e213e7d734</a></p>\n<p>I did find this Patient on the HAPI public server that does have a 'proper' managingOrganization reference:</p>\n<p><a href=\"https://hapi.fhir.org/baseR4/Patient?_count=100&amp;_id=1612407\">https://hapi.fhir.org/baseR4/Patient?_count=100&amp;_id=1612407</a></p>\n<p>However, searching for it with the organization search parameter still didn't work.   I suggest asking <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> , the author of HAPI for some advice.</p>",
        "id": 257261408,
        "sender_full_name": "John Silva",
        "timestamp": 1634068150
    },
    {
        "content": "<p>The data type for Patient.managingOrganization is Reference. And Reference doesn't have to have an literal reference, but can contain a logical <code>identifier</code> when the literal reference is not known.<br>\n<a href=\"/user_uploads/10155/MVBXRKGowC2JZcmzTsZb6kPR/image.png\">image.png</a> <br>\n<a href=\"https://www.hl7.org/fhir/references.html#Reference\">https://www.hl7.org/fhir/references.html#Reference</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/MVBXRKGowC2JZcmzTsZb6kPR/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/MVBXRKGowC2JZcmzTsZb6kPR/image.png\"></a></div><p>Given this, having <code>managingOrganization</code> be represented as simply with an <code>Identifier</code> should be acceptable. I think the <code>:identifier </code>modifer is supposed to be allow a search based on that. The problem is that HAPI doesn't support that search.</p>",
        "id": 257414731,
        "sender_full_name": " Bob Milius",
        "timestamp": 1634149872
    },
    {
        "content": "<p>Did HAPI stop supporting the search by identifier recently?</p>",
        "id": 260729337,
        "sender_full_name": "Swetha Kumar",
        "timestamp": 1636411172
    }
]