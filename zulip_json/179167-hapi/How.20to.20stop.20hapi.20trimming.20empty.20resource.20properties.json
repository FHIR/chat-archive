[
    {
        "content": "<p>Hi all,  </p>\n<p>I'm trying to create resources which have missing information, but have codings to represent why data is missing.  E.g. A patients birth weight is missing because they were under or over the scale limit.  <span class=\"user-mention\" data-user-id=\"191393\">@Igor Sirkovich</span> gave me advice in the implementer stream for how I should structure this, and it looks like this:</p>\n<p>&lt;Patient xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n    &lt;meta&gt;<br>\n       &lt;lastUpdated value=\"2017-11-21T17:01:46.879+00:00\"/&gt;<br>\n    &lt;/meta&gt;<br>\n    &lt;extension url=\"<a href=\"https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight\" target=\"_blank\" title=\"https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight\">https://purl.org/elab/fhir/network/StructureDefinition/1/BirthWeight</a>\"&gt;<br>\n       &lt;valueDecimal&gt;<br>\n          &lt;extension url=\"<a href=\"http://www.hl7.org/fhir/extension-data-absent-reason.html\" target=\"_blank\" title=\"http://www.hl7.org/fhir/extension-data-absent-reason.html\">http://www.hl7.org/fhir/extension-data-absent-reason.html</a>\"&gt;<br>\n             &lt;valueCoding&gt;<br>\n                &lt;system value=\"http://hl7.org/fhir/ValueSet/birthweight\"/&gt;<br>\n                &lt;code value=\"Underweight\"/&gt;<br>\n                &lt;userSelected value=\"false\"/&gt;<br>\n             &lt;/valueCoding&gt;<br>\n          &lt;/extension&gt;<br>\n       &lt;/valueDecimal&gt;<br>\n    &lt;/extension&gt;<br>\n    &lt;extension url=\"<a href=\"https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef\" target=\"_blank\" title=\"https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef\">https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef</a>\"&gt;<br>\n       &lt;valueReference&gt;<br>\n          &lt;reference value=\"Basic/198\"/&gt;<br>\n       &lt;/valueReference&gt;<br>\n    &lt;/extension&gt;<br>\n    &lt;identifier&gt;<br>\n       &lt;system value=\"https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects\"/&gt;<br>\n       &lt;value value=\"1\"/&gt;<br>\n    &lt;/identifier&gt;<br>\n    &lt;gender value=\"female\"/&gt;<br>\n &lt;/Patient&gt;</p>\n<p>When I request the patient back from the server however, I get the following back:</p>\n<p>&lt;Patient xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n    &lt;meta&gt;<br>\n       &lt;lastUpdated value=\"2017-11-21T17:01:46.879+00:00\"/&gt;<br>\n    &lt;/meta&gt;<br>\n    &lt;extension url=\"<a href=\"https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef\" target=\"_blank\" title=\"https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef\">https://purl.org/elab/fhir/StructureDefinition/1/ResourceGeneratorRef</a>\"&gt;<br>\n       &lt;valueReference&gt;<br>\n          &lt;reference value=\"Basic/198\"/&gt;<br>\n       &lt;/valueReference&gt;<br>\n    &lt;/extension&gt;<br>\n    &lt;identifier&gt;<br>\n       &lt;system value=\"https://purl.org/elab/fhir/network/StructureDefinition/1/EuroPrevallStudySubjects\"/&gt;<br>\n       &lt;value value=\"1\"/&gt;<br>\n    &lt;/identifier&gt;<br>\n    &lt;gender value=\"female\"/&gt;<br>\n &lt;/Patient&gt;</p>\n<p>I assume that hapi is trimming extensions which contain no value, and that the test for no value is 'has valueDecimal'.  Is there a way to fix this issue?  I'm guessing I could put a dummy decimal in place, however this feels like the wrong approach.</p>",
        "id": 153920984,
        "sender_full_name": "Andrew Broadbent",
        "timestamp": 1511345240
    },
    {
        "content": "<p>That does look like a bug to me too.</p>",
        "id": 153921119,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1511386160
    },
    {
        "content": "<p>I can sort of see why it would be absent, you don't have a value, so why would it have an code. Can you alter the extension so the absent code is at the same level - i.e. not an extension to the valueDecimal?</p>",
        "id": 153921237,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1511424774
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194909\">@Kevin Mayfield</span>  I can do in the case, but I'm trying to find a generic solution.  So for example if it was the gender that was missing, then the missing code would just appear in place where the value was.</p>",
        "id": 153921307,
        "sender_full_name": "Andrew Broadbent",
        "timestamp": 1511451732
    },
    {
        "content": "<p>But doesn't unknown gender mean something different to not asked - in which case it would be empty?</p>",
        "id": 153921311,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1511453323
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194909\">@Kevin Mayfield</span> Yes, sorry I'm struggling for a good example.  I make a tool which reads a csv and a (proprietary) annotation file, it then turns rows of the csv file into fhir resources based on the contents of the annotation file (this is why I need a generic way to do this).  Often in the data I'm seeing, users have coded values like 1 and 2 to represent things like male and female.  They also have codes like 99, 98, 97, which they consider to be exceptions to the normal data.  I'm trying to find a way to capture that exception data, and doing it in the same part of the xml as where the value is stored is computationally better for the tools which have to process the fhir resources further down the line.</p>",
        "id": 153921313,
        "sender_full_name": "Andrew Broadbent",
        "timestamp": 1511453741
    },
    {
        "content": "<p>report the issue on the hapi mailing list. It is a bug in HAPI</p>",
        "id": 153921330,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1511469834
    }
]