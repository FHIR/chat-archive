[
    {
        "content": "<p>Hi, I'm using the validator to validate my resource instance (<a href=\"https://simplifier.net/provincialclientregistry-ontario-stu3/patient-example\" target=\"_blank\" title=\"https://simplifier.net/provincialclientregistry-ontario-stu3/patient-example\">https://simplifier.net/provincialclientregistry-ontario-stu3/patient-example</a>) against the STU3 patient profile at <a href=\"https://simplifier.net/ProvincialClientRegistry-Ontario-STU3/pcr-patient-response\" target=\"_blank\" title=\"https://simplifier.net/ProvincialClientRegistry-Ontario-STU3/pcr-patient-response\">https://simplifier.net/ProvincialClientRegistry-Ontario-STU3/pcr-patient-response</a>. I'm getting some warnings and error regarding some of the fields, I wonder if someone can help me troubleshoot.</p>\n<p>1. In my example, I have meta.profile that points to the canonical URL of the profile. The URI is not resolvable at this point and validator throws a warning \"StructureDefinition reference could not be resolved\". <strong>Can we safely ignore this warning?</strong><br>\n &lt;meta&gt;<br>\n&lt;profile value=\"<a href=\"http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response|2.0.0\" target=\"_blank\" title=\"http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response|2.0.0\">http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response|2.0.0</a>\" /&gt;<br>\n2. In Patient.identifier, we use a customized valueset for identier.type.code which includes codes from such as \"JHN\" for Ontario health card number. Validator throws a warning as follows. I'm not sure if this is a bug as it's permissable to use other codes since the binding is extensible. <strong>Can we ignore this warning or is this a bug?</strong><br>\nNone of the codes provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/identifier-type\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a> (<a href=\"http://hl7.org/fhir/ValueSet/identifier-type\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/identifier-type\">http://hl7.org/fhir/ValueSet/identifier-type</a>, and a code should come from this value set unless it has no suitable code) (codes = <a href=\"http://hl7.org/fhir/v2/0203#JHN\" target=\"_blank\" title=\"http://hl7.org/fhir/v2/0203#JHN\">http://hl7.org/fhir/v2/0203#JHN</a></p>\n<p>3. For patient.language, validator throws an error if we use three letter code from ISO639-3 as opposed to two letter codes. My understanding is that BCP47 allows both code systems and three letter codes should be allowed. <strong>What should we do in this case?</strong><br>\nThank you!!</p>\n<p>Fang Cao</p>",
        "id": 173124095,
        "sender_full_name": "frank cao",
        "timestamp": 1565710417
    },
    {
        "content": "<p>#1 - if the validator can't find the profile, then the instance won't be validated - sure you can ignore it, provided you accept that. I've been using the hapi server to validate (using $validate) , and making sure the profile SD is on the server, which seems to work for me...<br>\n#2 - that does sound like an informational message - what's the severity?<br>\n#3 - not sure of this one...</p>",
        "id": 173135606,
        "sender_full_name": "David Hay",
        "timestamp": 1565718921
    },
    {
        "content": "<p>#1 - given that <a href=\"http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response\" target=\"_blank\" title=\"http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response\">http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response</a> is not resolvable, it's not a surprise that the validator can't resolve it. You have to download it yourself however that should be done, and include it in the parameters using an -ig parameter</p>\n<p>#2 - the validator can't determine whether your custom codes are valid or not. So it notes that fact for human review - but it's not an error</p>\n<p>#3 - The validator should be accepting 3 letter language codes registered with IANA. What is the code that you are using?</p>",
        "id": 173154040,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565732330
    },
    {
        "content": "<p>To clarify, I'm not using the $validate operation, instead we use the HAPI validator jar file to provide structure defintions locally. We run the command \"java -jar fhirvalidator.jar &lt;fhir-structure-defintion-package.zip&gt; &lt;resource-example.json&gt;\" and we get message like this:</p>\n<div class=\"codehilite\"><pre><span></span>Location = Patient.meta.profile[0], Message = StructureDefinition reference &quot;http://ehealthontario.ca/fhir/StructureDefinition/pcr-patient-response|2.0.0&quot; could not be resolved, Severity = WARNING\n</pre></div>\n\n\n<p><strong>Question: Is this an acceptable approach to validate locally, or will HAPI validator always try to resolve the profile URI?</strong></p>\n<p>Regarding the language code error, HAPI fails if we use \"fra\" for French, but it will accept \"fr\". In our profile, we constrained it to only use three letter codes. If bcp47 requires two letters only for the applicable languages, do we have to manually fix those languages? The challenge is that we have over 8000 codes in our language valueset, and would be difficult to fix manually.</p>",
        "id": 173216912,
        "sender_full_name": "frank cao",
        "timestamp": 1565798730
    },
    {
        "content": "<p>looks like you're missing a -ig: </p>\n<p><code>java -jar fhirvalidator.jar -ig &lt;fhir-structure-defintion-package.zip&gt; &lt;resource-example.json&gt;</code></p>",
        "id": 173239510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565814812
    },
    {
        "content": "<p>I do not see <code>fra</code> listed in the IANA language registry</p>",
        "id": 173239532,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565814836
    },
    {
        "content": "<blockquote>\n<p>I do not see <code>fra</code> listed in the IANA language registry</p>\n</blockquote>\n<p>isn't IANA two letter only?</p>",
        "id": 173282101,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1565867992
    },
    {
        "content": "<p>no it has 3 letter codes too. But not <code>fra</code></p>",
        "id": 173282157,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565868011
    },
    {
        "content": "<blockquote>\n<p>looks like you're missing a -ig: </p>\n<p><code>java -jar fhirvalidator.jar -ig &lt;fhir-structure-defintion-package.zip&gt; &lt;resource-example.json&gt;</code></p>\n</blockquote>\n<p>I'm using the HAPI validator, and it doesn't seem to accept the -ig flag. Are you referring to the native FHIR validator?</p>",
        "id": 173294196,
        "sender_full_name": "frank cao",
        "timestamp": 1565878805
    },
    {
        "content": "<blockquote>\n<p>no it has 3 letter codes too. But not <code>fra</code></p>\n</blockquote>\n<p>Interesting, so does that mean FHIR requires the use of these values only? If so, is there a FHIR valueset of this somewhere? We would like to provide the valueset on Simplifier.</p>",
        "id": 173294511,
        "sender_full_name": "frank cao",
        "timestamp": 1565879081
    },
    {
        "content": "<p>Sorry- what are you doing exactly? If you're using HAPI's FhirInstanceValidator module I'm surprised it is accepting any BCP47 codes at all- we haven't implemented BCP47 yet in HAPI's term svcs.</p>",
        "id": 173294908,
        "sender_full_name": "James Agnew",
        "timestamp": 1565879393
    },
    {
        "content": "<p>I'm actually helping a developer to resolve FHIR errors so I may not have the proper info. The developer wrote a wrapper that can validate a resource example against custom profiles. It has a lib folder that i have provided the screenshots below. I assume the HAPI validator jar file is being used for the validation.</p>\n<p><a href=\"/user_uploads/10155/2leSquFlD7WcHtaSImwxVMqc/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/2leSquFlD7WcHtaSImwxVMqc/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/2leSquFlD7WcHtaSImwxVMqc/pasted_image.png\"></a></div>",
        "id": 173295882,
        "sender_full_name": "frank cao",
        "timestamp": 1565880195
    },
    {
        "content": "<p>James, we are using the FhirInstanceValidator class. Below is the code that creates the class according to the developer:</p>\n<div class=\"codehilite\"><pre><span></span>private static FhirInstanceValidator createFhirInstanceValidator(String fileName) throws ResourceException {\n        RegistryValidationSupport registryValidationSupport = RegistryValidationSupport.fromFile(fileName);\n        ValidationSupportChain validationSupportChain = new ValidationSupportChain(new DefaultProfileValidationSupport(), registryValidationSupport);\n\n        FhirInstanceValidator fhirInstanceValidator = new FhirInstanceValidator();\n        fhirInstanceValidator.setValidationSupport(validationSupportChain);\n\n        return fhirInstanceValidator;\n    }\n</pre></div>\n\n\n<p>This is the validator error message for patient language</p>\n<div class=\"codehilite\"><pre><span></span>Location = Patient.communication.language, Message = None of the codes provided are in the maximum value set http://hl7.org/fhir/ValueSet/all-languages (http://hl7.org/fhir/ValueSet/all-languages, and a code from this value set is required) (codes = urn:ietf:bcp:47#aaa), Severity = ERROR\n</pre></div>",
        "id": 173305179,
        "sender_full_name": "frank cao",
        "timestamp": 1565887756
    },
    {
        "content": "<p>I assumed <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> was being used for the language validation, but apparently not.... it's very hard for for me to help when people use the validator through HAPI because I don't know how it's configured</p>",
        "id": 173314370,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565895173
    },
    {
        "content": "<blockquote>\n<p>I assumed <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> was being used for the language validation, but apparently not.... it's very hard for for me to help when people use the validator through HAPI because I don't know how it's configured</p>\n</blockquote>\n<p>Thanks for the help Grahame. Regarding the patient communication language valueset, is FHIR required to follow the \"must use 2 letter code when you can, only use 3 letter code when two letter does not exist\" rule? I think the lack of explanation of that rule may be confusing for implementers if they have to read the bcp47 documentation.</p>",
        "id": 173318043,
        "sender_full_name": "frank cao",
        "timestamp": 1565897839
    },
    {
        "content": "<p>RegistryValidatorSupport isn't a HAPI FHIR class either- is that something you guys wrote? </p>\n<p>I would kind of echo Grahame's point here. It's hard to troubleshoot problems without any knowledge of what you're actually using. My recommendation would be to switch to the validator CLI tool and see if you can replicate this with that. If you have the same issues with that tool, the troubleshooting steps would be very different from if you only see this through HAPI's infrastructure.</p>",
        "id": 173318182,
        "sender_full_name": "James Agnew",
        "timestamp": 1565897940
    },
    {
        "content": "<blockquote>\n<p>is FHIR required to follow the \"must use 2 letter code when you can, only use 3 letter code when two letter does not exist\"</p>\n</blockquote>\n<p>The FHIR binding for Maximum Value set - the absolute limit on allowable codes is toBCP-47. My read of BCP-47 is that it is clear: you SHALL only use language codes found in the IANA registry. Accordingly, the validator is validating on the IANA registry.</p>",
        "id": 173318343,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565898081
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>is FHIR required to follow the \"must use 2 letter code when you can, only use 3 letter code when two letter does not exist\"</p>\n</blockquote>\n<p>The FHIR binding for Maximum Value set - the absolute limit on allowable codes is toBCP-47. My read of BCP-47 is that it is clear: you SHALL only use language codes found in the IANA registry. Accordingly, the validator is validating on the IANA registry.</p>\n</blockquote>\n<p>Thank you.</p>",
        "id": 173320839,
        "sender_full_name": "frank cao",
        "timestamp": 1565900156
    },
    {
        "content": "<blockquote>\n<p>RegistryValidatorSupport isn't a HAPI FHIR class either- is that something you guys wrote? </p>\n<p>I would kind of echo Grahame's point here. It's hard to troubleshoot problems without any knowledge of what you're actually using. My recommendation would be to switch to the validator CLI tool and see if you can replicate this with that. If you have the same issues with that tool, the troubleshooting steps would be very different from if you only see this through HAPI's infrastructure.</p>\n</blockquote>\n<p>Hi James, I followed your recommendation and the CLI reports the error in the profile regarding SliceName. Not sure why as we have proper strings with dash. Any ideas?</p>\n<div class=\"codehilite\"><pre><span></span>Issue 1: ERROR - StructureDefinition\n         [error] in\n         /*:StructureDefinition[namespace-uri()=&#39;http://hl7.org/fhir&#39;][1]/*:snap\n         shot[namespace-uri()=&#39;http://hl7.org/fhir&#39;][1]/*:element[namespace-uri(\n         )=&#39;http://hl7.org/fhir&#39;][34] @ StructureDefinition eld-16: sliceName\n         must be a proper token Test=not(exists(f:sliceName/@value)) or\n         matches(f:sliceName/@value, &#39;^[a-zA-Z0-9\\\\-\\\\_]+$&#39;)\n</pre></div>",
        "id": 173394281,
        "sender_full_name": "frank cao",
        "timestamp": 1565978703
    },
    {
        "content": "<p>That's a weird error message. I maintain the vlaidator, but I don't see where this bit comes from: <code>[namespace-uri()='http://hl7.org/fhir']</code></p>",
        "id": 173403917,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565986245
    },
    {
        "content": "<p>what does the slicename it indicates hold?</p>",
        "id": 173403937,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565986257
    },
    {
        "content": "<p>Sorry for the late reply. It turns out the error is actually \"unable to resolve discriminator\" on patient.name.given where we used ISO21090 extension for middle name. Below is our slicing definition, could you point me where it's wrong?</p>\n<div class=\"codehilite\"><pre><span></span>&quot;id&quot;: &quot;Patient.name.given&quot;,\n        &quot;path&quot;: &quot;Patient.name.given&quot;,\n        &quot;slicing&quot;: {\n          &quot;discriminator&quot;: [\n            {\n              &quot;type&quot;: &quot;exists&quot;,\n              &quot;path&quot;: &quot;extension(&#39;http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier&#39;)&quot;\n            }\n          ],\n          &quot;description&quot;: &quot;by extension(&#39;http://hl7.org/fhir/StructureDefinition/iso21090-EN-qualifier&#39;)&quot;,\n          &quot;rules&quot;: &quot;open&quot;\n        },\n</pre></div>",
        "id": 174168092,
        "sender_full_name": "frank cao",
        "timestamp": 1566846481
    },
    {
        "content": "<p>I figured out the cause of \"unable to resolve discriminator\" error. Because the discriminator is exists(extension), I need to specify the extension on the slice that doesn't use the extension (i.e. making it 0..0).</p>",
        "id": 174987888,
        "sender_full_name": "frank cao",
        "timestamp": 1567699063
    }
]