[
    {
        "content": "<p>Hello Implementers,<br>\nHapi jpa R4 release inside a bundle txn, conditional patch is not working. Can you please kindly suggest a workaround ?. One possible solution I am thinking is that instead of patch, read the resource again, apply the changed fields on the read resource, apply bundle PUT with setIfMatch (conditional version). Is this ok ofcourse this has a penalty of reading the resource. Are there any other alternatives ?. Can you please kindly suggest. <br>\nthanks for your kind help.<br>\n(apologies raised this in #implementers forum earlier and got redirected here).</p>",
        "id": 204698693,
        "sender_full_name": "Nath",
        "timestamp": 1595439899
    },
    {
        "content": "<p>Can you provide a small test that prooves it?</p>",
        "id": 204709414,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1595444931
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> . I have created a simple testcase here. I created in R5 but the issue is in R4 also.<br>\ngo to this link <a href=\"http://hapi.fhir.org/transaction\">http://hapi.fhir.org/transaction</a> and choose R5 server, </p>\n<p>{<br>\n  \"resourceType\": \"Bundle\",<br>\n  \"type\": \"transaction\",<br>\n  \"total\": 1,<br>\n  \"entry\": [<br>\n    {<br>\n      \"fullUrl\": \"Patient/107\",<br>\n      \"resource\": {<br>\n        \"resourceType\": \"Binary\",<br>\n        \"contentType\": \"application/json-patch+json\",<br>\n        \"data\": \"WyB7ICJvcCI6InJlcGxhY2UiLCAicGF0aCI6Ii9iaXJ0aERhdGUiLCAidmFsdWUiOiIxOTMzLTAxLTAxIiB9IF0=\"<br>\n      },<br>\n      \"request\": {<br>\n        \"method\": \"PATCH\",<br>\n        \"url\": \"Patient/107\",<br>\n        \"ifMatch\": \"4\"<br>\n      }<br>\n    }<br>\n  ]<br>\n}</p>\n<p>Note: data field is basically in base64 form of this <br>\n[ { \"op\":\"replace\", \"path\":\"/birthDate\", \"value\":\"1933-01-01\" } ]</p>\n<p>you get an error message like this<br>\nWarning!<br>\nError: HTTP 400 Bad Request: Invalid match URL[4] - URL has no search parameters<br>\nHTTP 400 Bad Request<br>\nResponse Headers    <br>\nx-request-id: DQKWFTclsCMJoOH5<br>\ndate: Wed, 22 Jul 2020 23:22:32 GMT<br>\nserver: nginx/1.14.0 (Ubuntu)<br>\ntransfer-encoding: chunked<br>\nx-powered-by: HAPI FHIR 5.1.0-SNAPSHOT REST Server (FHIR Server; FHIR 4.4.0/R5)<br>\nconnection: keep-alive<br>\ncontent-type: application/fhir+json;charset=utf-8<br>\n{<br>\n  \"resourceType\": \"OperationOutcome\",<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\\"0\\\"&gt;&lt;tr&gt;&lt;td style=\\\"font-weight: bold;\\\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Invalid match URL[4] - URL has no search parameters&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;\"<br>\n  },<br>\n  \"issue\": [ {<br>\n    \"severity\": \"error\",<br>\n    \"code\": \"processing\",<br>\n    \"diagnostics\": \"Invalid match URL[4] - URL has no search parameters\"<br>\n  } ]<br>\n}</p>\n<p>Remove \"ifMatch\" : \"4\" and run it , it will update correctly.</p>",
        "id": 204734642,
        "sender_full_name": "Nath",
        "timestamp": 1595460325
    }
]