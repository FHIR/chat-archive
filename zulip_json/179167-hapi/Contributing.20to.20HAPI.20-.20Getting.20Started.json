[
    {
        "content": "<p>Is their a guide?</p>\n<p>I've done the basic's at the moment. Downloaded source from git, mvn clean and in the process of mvn install.<br>\n(It's the <em>HAPI FHIR Validation</em> I'm looking at working on - for UK+stu3)</p>\n<p>Is their any special config?</p>",
        "id": 161735157,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553581188
    },
    {
        "content": "<p>Java version (8?) maven (3.5?)</p>",
        "id": 161736669,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553583468
    },
    {
        "content": "<p>you're better off to use the java code directly without HAPI</p>",
        "id": 161737697,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553584914
    },
    {
        "content": "<p>We do that at present but their are a number of bugs we want to fix</p>",
        "id": 161737779,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585006
    },
    {
        "content": "<p>(and also diagnose operationOutcome error messages)</p>",
        "id": 161737785,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585029
    },
    {
        "content": "<p>are you running the R5 validator?</p>",
        "id": 161737837,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585063
    },
    {
        "content": "<p>if you mean, you're running the validator jar, and you want to fix bugs in it. then you want the hapi core code, and the fhir github code, and not the rest of FHIR</p>",
        "id": 161737865,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585106
    },
    {
        "content": "<p>or HAPI</p>",
        "id": 161737866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585110
    },
    {
        "content": "<p>Yep that's what I've looking at. At the moment we have a couple of classes to add in UK support in our 'argonaut' demonstrator' [https://data.developer.nhs.uk/ccri]</p>",
        "id": 161738127,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585515
    },
    {
        "content": "<p>hmm what do they do?</p>",
        "id": 161738172,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585533
    },
    {
        "content": "<p>First bit we add UK profiles to the DefaultProfileValidationSupport</p>\n<div class=\"codehilite\"><pre><span></span>    ValidationSupportChain validationSupportChain = new ValidationSupportChain();\n\n    validationSupportChain.addValidationSupport(new DefaultProfileValidationSupport());\n    validationSupportChain.addValidationSupport(new CareConnectProfileValidationSupport\n</pre></div>",
        "id": 161738261,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585663
    },
    {
        "content": "<p>so that bit has nothing to do with the validation.jar</p>",
        "id": 161738271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585686
    },
    {
        "content": "<p>Next issue: <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/1235\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/1235\">https://github.com/jamesagnew/hapi-fhir/issues/1235</a></p>",
        "id": 161738289,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585736
    },
    {
        "content": "<p>so the next thing: the only supported version of the validator is the latest copy - that is now R5. I don't take bug fixes for the older versions of the validator</p>",
        "id": 161738340,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585782
    },
    {
        "content": "<p>Understand that and that won't validate stu3 so we should look at moving fixes to stu3.... or is their another way?</p>",
        "id": 161738450,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553585949
    },
    {
        "content": "<p>it will validate stu3</p>",
        "id": 161738451,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585957
    },
    {
        "content": "<p>you just load all the R3 structure definitions into it, and tell it to validate your R3 content.</p>",
        "id": 161738458,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553585996
    },
    {
        "content": "<p>(you do need to convert the R3 structure definitions and value sets etc to R5 using the R3/R5 converter as you load them)</p>",
        "id": 161738521,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553586044
    },
    {
        "content": "<p>but you don't need to convert the resource you are validating - just validate the bytes directly</p>",
        "id": 161738534,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553586070
    },
    {
        "content": "<p>That's very welcome news</p>",
        "id": 161738536,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553586074
    },
    {
        "content": "<p>going flying. back later</p>",
        "id": 161738541,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553586109
    },
    {
        "content": "<p>Just to clarify, does one also need to explicitly transform STU3 structure defs/valsets/etc. before loading them when using the JAR validator from the command line? The <a href=\"http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\">current documentation</a> says (when discussing loading IGs/profiles):</p>\n<blockquote>\n<p>Packages must have the same underlying fhir version as that specified in the -version parameter </p>\n</blockquote>\n<p>which sounds like one should use STU3 profiles when validating for STU3...?</p>",
        "id": 161740902,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1553588883
    },
    {
        "content": "<p>if you use the command line validator, then it does the conversion internally - if you say <code>-version 3.0</code> then any resources loaded from the various packages (core + IGs) will be converted from R3 to R5</p>",
        "id": 161803207,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553634636
    },
    {
        "content": "<p>what I said above about doing the conversion only applies if you are loading the validator java classes directly (or to be precise, if you are using org.hl7.fhir.r5.validation.InstanceValidator, not using org.hl7.fhir.r5.validation.ValidationEngine)</p>",
        "id": 161803421,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553634766
    },
    {
        "content": "<p>OK, thanks for the clarification <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> !</p>",
        "id": 161835285,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1553671656
    },
    {
        "content": "<p>Testing at the moment. I'm (temp) using r4 validator in HAPI but it seems to be working. <br>\nNeed to see how it handles backport extensions - do they get converted?</p>",
        "id": 161847207,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553683399
    },
    {
        "content": "<p>backport extensions?</p>",
        "id": 161851237,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553687298
    },
    {
        "content": "<p>backported</p>",
        "id": 161852045,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553688029
    },
    {
        "content": "<p>no you have to define them</p>",
        "id": 161852237,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553688218
    },
    {
        "content": "<p>not the standard ones?</p>",
        "id": 161852246,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553688236
    },
    {
        "content": "<p>if they're defined for STU3 then they'll be valid</p>",
        "id": 161854374,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553690115
    },
    {
        "content": "<p>I think this is an issue in HAPI 3.8.0-SNAPSHOT (their are others).<br>\nThe Bundle CodeSystems appear to have the wrong url in <br>\n<a href=\"https://raw.githubusercontent.com/jamesagnew/hapi-fhir/master/hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/valueset/valuesets.xml\" target=\"_blank\" title=\"https://raw.githubusercontent.com/jamesagnew/hapi-fhir/master/hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/valueset/valuesets.xml\">https://raw.githubusercontent.com/jamesagnew/hapi-fhir/master/hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/valueset/valuesets.xml</a></p>",
        "id": 161861893,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553695469
    },
    {
        "content": "<p>observation-category has url of  &lt;url value=\"http://terminology.hl7.org/CodeSystem/observation-category\"&gt;&lt;/url&gt;</p>",
        "id": 161861916,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553695488
    },
    {
        "content": "<p>and that matches the spec.</p>",
        "id": 161862032,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553695562
    },
    {
        "content": "<p>Ignore above.... I'll research a bit more. Appears to be a stu3 to r4 change</p>",
        "id": 161862081,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553695579
    },
    {
        "content": "<p>Should the converter also handle extensions that have changed e.g.</p>\n<p><a href=\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/patient-birthPlace\">http://hl7.org/fhir/StructureDefinition/patient-birthPlace</a> was in stu3 <a href=\"http://hl7.org/fhir/StructureDefinition/birthPlace\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/birthPlace\">http://hl7.org/fhir/StructureDefinition/birthPlace</a></p>\n<p>also</p>\n<p><a href=\"http://terminology.hl7.org/CodeSystem/v3-MaritalStatus\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/v3-MaritalStatus\">http://terminology.hl7.org/CodeSystem/v3-MaritalStatus</a> was in stu3 <a href=\"http://hl7.org/fhir/v3/MaritalStatus\" target=\"_blank\" title=\"http://hl7.org/fhir/v3/MaritalStatus\">http://hl7.org/fhir/v3/MaritalStatus</a> </p>\n<p>I may have missed off a conversion step.</p>",
        "id": 162058778,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553875388
    },
    {
        "content": "<p>I'm not sure what you mean by changed - if you load the R3 definitions, then it should be looking for the R3 extension</p>",
        "id": 162075699,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553886658
    },
    {
        "content": "<p>That makes sense, will try that next.</p>\n<p>This is the correct location for the converters <a href=\"https://github.com/jamesagnew/hapi-fhir/tree/master/hapi-fhir-converter\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/tree/master/hapi-fhir-converter\">https://github.com/jamesagnew/hapi-fhir/tree/master/hapi-fhir-converter</a><br>\nI'm using the stu3-&gt;r4 convertor at present , I've not seen support for r5 (and assumed that's a work in progress)</p>",
        "id": 162109910,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553931693
    },
    {
        "content": "<p>Using the stu3-&gt;r4 convertor returns <br>\nCaused by: org.hl7.fhir.exceptions.FHIRException: Unknown resource Procedure<br>\nWhen converting a Bundle with a Procedure.</p>",
        "id": 162113210,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553937837
    },
    {
        "content": "<p>at org.hl7.fhir.convertors.VersionConvertor_30_40.convertResource(VersionConvertor_30_40.java:21342) ~[hapi-fhir-converter-3.8.0-SNAPSHOT.jar:?]</p>",
        "id": 162113256,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553937875
    },
    {
        "content": "<p>Other than that, it's working. Just need to tweak the r4 DefaultProfileValidationSupport.class to load stu3 resources. <br>\n<a href=\"https://github.com/nhsconnect/careconnect-reference-implementation/blob/3.8/cc-core/src/main/java/uk/org/hl7/fhir/validation/r4/DefaultProfileValidationSupportStu3AsR4.java\" target=\"_blank\" title=\"https://github.com/nhsconnect/careconnect-reference-implementation/blob/3.8/cc-core/src/main/java/uk/org/hl7/fhir/validation/r4/DefaultProfileValidationSupportStu3AsR4.java\">https://github.com/nhsconnect/careconnect-reference-implementation/blob/3.8/cc-core/src/main/java/uk/org/hl7/fhir/validation/r4/DefaultProfileValidationSupportStu3AsR4.java</a></p>",
        "id": 162114037,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1553939187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191687\">@Kevin Mayfield</span> <br>\nhere is the current source of the validator and other FHIR core parts of hapi: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core\">https://github.com/hapifhir/org.hl7.fhir.core</a></p>",
        "id": 162122812,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1553955191
    },
    {
        "content": "<p>Cheers. Are these outputting maven resources?</p>",
        "id": 162162546,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1554018584
    },
    {
        "content": "<p>the core code is all maven yes</p>",
        "id": 162167866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1554027980
    },
    {
        "content": "<p>Hi folks, we have a DSTU2 Immunization that we would like to convert to R4.  We are getting this error: <br>\n“org.hl7.fhir.exceptions.FHIRException: Unknown resource Immunization<br>\nat org.hl7.fhir.convertors.VersionConvertor_10_40.convertResource(VersionConvertor_10_40.java:12147)”<br>\nLooking at the HAPI converter code <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-converter/src/main/java/org/hl7/fhir/convertors/VersionConvertor_10_40.java#L11978\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-converter/src/main/java/org/hl7/fhir/convertors/VersionConvertor_10_40.java#L11978\">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-converter/src/main/java/org/hl7/fhir/convertors/VersionConvertor_10_40.java#L11978</a>, the code does not support Immunizations.  </p>\n<p>Is there another FHIR Mapping Language Java implementation that does support Immunizations and the complete set of mappings?  If not, should I write the code and create a pull request?</p>",
        "id": 163922265,
        "sender_full_name": "Wan Chen",
        "timestamp": 1555955388
    },
    {
        "content": "<p>there is nothing else. A pull request would be very welcome</p>",
        "id": 163941206,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1555969330
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>!</p>",
        "id": 163994762,
        "sender_full_name": "Wan Chen",
        "timestamp": 1556029802
    }
]