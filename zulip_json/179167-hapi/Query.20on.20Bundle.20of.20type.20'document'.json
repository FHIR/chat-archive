[
    {
        "content": "<p>Hi all,<br>\nI'm querying the Bundle resource, to retrieve a Bundle of type \"document\" that contains a specific instance of Composition (as the first entry). The problem is that I don't get any results back, it seems like the \"composition\" search parameter is not taken into account. Am I doing something wrong or the search parameter is not supported?</p>\n<p>1) These are examples of query I'd like to submit:</p>\n<p><a href=\"http://localhost:8080/NCP/fhir/Bundle?composition=Composition/53\" title=\"http://localhost:8080/NCP/fhir/Bundle?composition=Composition/53\">http://localhost:8080/NCP/fhir/Bundle?composition=Composition/53</a></p>\n<p><a href=\"http://localhost:8080/NCP/fhir/Bundle?type=document&amp;composition.type=http://loinc.org|60591-5\" title=\"http://localhost:8080/NCP/fhir/Bundle?type=document&amp;composition.type=http://loinc.org|60591-5\">http://localhost:8080/NCP/fhir/Bundle?type=document&amp;composition.type=http://loinc.org|60591-5</a></p>\n<p>2) this is the created Bundle: </p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Bundle&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;52&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;meta&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">&quot;versionId&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;lastUpdated&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;2020-04-24T16:32:43.170+02:00&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;source&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;#eDCJBwn2rScDUh79&quot;</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;document&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;entry&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;fullUrl&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Composition/53&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;resource&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Composition&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;53&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;final&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;coding&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n              <span class=\"nt\">&quot;system&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://loinc.org&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;60591-5&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;display&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Profilo sanitario sintetico&quot;</span>\n            <span class=\"p\">}</span>\n          <span class=\"p\">]</span>\n        <span class=\"p\">},</span>\n        <span class=\"nt\">&quot;subject&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;urn:uuid:561bbebe-4679-49e4-a572-eb2f39353524&quot;</span>\n        <span class=\"p\">},</span>\n        <span class=\"nt\">&quot;title&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient Summary di: Duck [Donald]&quot;</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;fullUrl&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient/54&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;resource&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Patient&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;54&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;generated&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;div&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;div class=\\&quot;hapiHeaderText\\&quot;&gt;Donald &lt;b&gt;DUCK &lt;/b&gt;&lt;/div&gt;&lt;table class=\\&quot;hapiPropertyTable\\&quot;&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;DNDDCKABCDEFG&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;&quot;</span>\n        <span class=\"p\">},</span>\n        <span class=\"nt\">&quot;identifier&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n              <span class=\"nt\">&quot;coding&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                  <span class=\"nt\">&quot;system&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://terminology.hl7.org/CodeSystem/v2-0203&quot;</span><span class=\"p\">,</span>\n                  <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;TAX&quot;</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">]</span>\n            <span class=\"p\">},</span>\n            <span class=\"nt\">&quot;value&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;DNDDCKABCDEFG&quot;</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;family&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Duck&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;given&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n              <span class=\"s2\">&quot;Donald&quot;</span>\n            <span class=\"p\">]</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">&quot;gender&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;male&quot;</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>3) I'm running on hapi fhir server: version 4.1.0 - Rev 03163c2cf5, with embedded DB<br>\nThanks<br>\nAlessio</p>",
        "id": 196049831,
        "sender_full_name": "Alessio Graziani",
        "timestamp": 1588423042
    },
    {
        "content": "<p>The Bundle:composition search parameter does not currently work unfortunately. It is very different from all other SearchParams and needs its own indexing strategy</p>",
        "id": 196243736,
        "sender_full_name": "James Agnew",
        "timestamp": 1588628635
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <br>\nWe're using FHIR in an EU research project (InteropEHRate) and we stored a patient summary instance (compliant to IPS) into our customized HAPI FHIR server. Now we're trying to retrieve it, for us, the best way to do it is to query for Bundle using \"composition\" search parameter. Unfortunately, it does not work. We're able to contribute to developing this functionality, but we need a little bit of initial help. Another doubt regarding this approach is related to potential security issues: how can a security interceptor assure that the retrieved bundle contains only data in the compartment of the Patient (or, how can the interceptor assure that the instance of Bundle refers to the requesting patient)?</p>\n<p>As an alternative, we're currently using the $document operation on the Composition instance (don't know why it does not create \"fullUrl\", but only partial, so we added an interceptor to modify this Bundle).</p>\n<p>Cheers and thanks<br>\nAlessio</p>",
        "id": 196323455,
        "sender_full_name": "Alessio Graziani",
        "timestamp": 1588692276
    }
]