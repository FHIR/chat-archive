[
    {
        "content": "<p>When validating against an IG with profiles where derivation isn't set the validator throws some null pointers here:<br>\n<a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489\">https://github.com/hapifhir/org.hl7.fhir.core/blob/630ab0afcba49043ff2b145217e6735baddfaba2/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/conformance/ProfileUtilities.java#L489</a></p>\n<p>As derived.getDerivation() returns null.</p>",
        "id": 184546725,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577802736
    },
    {
        "content": "<p>I think if it getDerivation() returns null just skip the following block?</p>",
        "id": 184546989,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577803167
    },
    {
        "content": "<p>why is derivation null?</p>",
        "id": 184560593,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1577819345
    },
    {
        "content": "<p>I guess because it wasnâ€˜t populated in the StrucDef</p>",
        "id": 184560663,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577819430
    },
    {
        "content": "<p>The StructureDefinition itself, which i parsed, does not have have it</p>",
        "id": 184560697,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577819506
    },
    {
        "content": "<p>So it ends up as Null in the Instance</p>",
        "id": 184560703,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577819522
    },
    {
        "content": "<p>Added a PR to fix it</p>",
        "id": 184560742,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1577819529
    },
    {
        "content": "<p>fix it how? how can you generate a snapshot if there's no derivation?</p>",
        "id": 184561023,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1577819876
    },
    {
        "content": "<p>Sorry for the insufficient explanation last time, was on the mobile phone.<br>\nThis is used in the Validator at several places: <code>(derived.getDerivation().equals(TypeDerivationRule.SPECIALIZATION))</code>  <br>\nWhen you are validating against a profile which StrucDef doesn't has derivation populated a NullPointer is thrown as there is no null check and the variable derived stays null after parsing the profile.</p>",
        "id": 185201922,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578568026
    },
    {
        "content": "<p>but why is there no derivation, and how can the SD make sense?</p>",
        "id": 185258802,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578605834
    },
    {
        "content": "<p>because derivation is 0..1 and not enforced. The parser sets derivation to null if not populated and then later throws a null pointer.</p>",
        "id": 185295222,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578649764
    },
    {
        "content": "<p>So this PR is about making these methods null-safe.</p>",
        "id": 185295245,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578649799
    },
    {
        "content": "<p>Why are you expecting StructureDefinition.derivation to be populated when it is 0..1 ?</p>",
        "id": 185295318,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578649848
    },
    {
        "content": "<p>the only case when it shouldn't have a value is when there's no base definition. If there's a base definition, how can it be meaningful if there derivation is unknown?</p>",
        "id": 185295740,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578650194
    },
    {
        "content": "<p>i agree on a logic level, but as far as i can see a StructureDefinition with no derivation is a valid on a technical level as i can't see anything enforcing the population of the derivation. e.g.: <a href=\"https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml\" target=\"_blank\" title=\"https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml\">https://simplifier.net/BasisprofilDE/organization-de-basis-0.2/~xml</a> doesn't have it populated.</p>",
        "id": 185298273,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578652281
    },
    {
        "content": "<p>it's valid on a technical level, but not meaningful for generating a snapshot</p>",
        "id": 185298580,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578652549
    },
    {
        "content": "<p>agree. So i'll update my PR to not default to derivation=constrain - but to catch the NullPointer and Log a meaningful error?</p>",
        "id": 185302952,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578656886
    },
    {
        "content": "<p>I just made the change here after our discussion.</p>",
        "id": 185303311,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578657247
    },
    {
        "content": "<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span></p>",
        "id": 185303512,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578657463
    },
    {
        "content": "<p>can you push the change?</p>",
        "id": 185310353,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1578663716
    }
]