[
    {
        "content": "<p>I'm getting a strange result when validating a Patient resource against a profile on HAPI 5.0.0 (public test server):</p>\n<div class=\"codehilite\"><pre><span></span><code>curl -X POST \\\n  &#39;http://hapi.fhir.org/baseDstu3/Patient/$validate&#39; \\\n  -H &#39;Cache-Control: no-cache&#39; \\\n  -H &#39;Content-Type: application/json&#39; \\\n  -d &#39;{\n    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;\n        ]\n    },\n    &quot;birthDate&quot;: &quot;1996-11-23&quot;\n}&#39;\n</code></pre></div>\n\n\n<p>gives response:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[Patient.birthDate, Line 9, Col 2]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;This element is not allowed by the profile http://fhir.nl/fhir/StructureDefinition/nl-core-patient&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;This element is not allowed by the profile http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;,\n            &quot;location&quot;: [\n                &quot;Patient.birthDate&quot;,\n                &quot;Line 9, Col 2&quot;\n            ]\n        }\n    ]\n}\n</code></pre></div>\n\n\n<p>As far as I can tell, patient.birthDate should be allowed in the profile, <code>Patient.birthDate</code> is available in the <code>differential.element[]</code> </p>\n<div class=\"codehilite\"><pre><span></span><code>curl -X GET \\\n  http://hapi.fhir.org/baseDstu3/StructureDefinition/nl-core-patient \\\n  -H &#39;Cache-Control: no-cache&#39; \\\n  -H &#39;Content-Type: application/json&#39; \\\n</code></pre></div>\n\n\n<p>Any idea what's going on here?</p>",
        "id": 197690434,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589549531
    },
    {
        "content": "<p>you'll have to post the particular version of that profile that the server has so I can look at it</p>",
        "id": 197726575,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589564433
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> </p>\n<div class=\"codehilite\"><pre><span></span><code>curl -X GET \\\n  http://hapi.fhir.org/baseDstu3/StructureDefinition/nl-core-patient \\\n  -H &#39;Cache-Control: no-cache&#39; \\\n  -H &#39;Postman-Token: 3095eead-ce35-845e-8805-97ec445d3364&#39;\n</code></pre></div>\n\n\n<p>response: (too big to paste fully, but you can try the above curl request as it is a public server)</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n&quot;resourceType&quot;: &quot;StructureDefinition&quot;,\n    &quot;id&quot;: &quot;nl-core-patient&quot;,\n    &quot;meta&quot;: {\n        &quot;extension&quot;: [\n            {\n                &quot;url&quot;: &quot;http://hapifhir.io/fhir/StructureDefinition/resource-meta-source&quot;,\n                &quot;valueUri&quot;: &quot;#wffxp4ixe6AQSRW6&quot;\n            }\n        ],\n        &quot;versionId&quot;: &quot;4&quot;,\n        &quot;lastUpdated&quot;: &quot;2020-05-15T10:58:55.491+00:00&quot;\n    },\n    &quot;url&quot;: &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;,\n\n ...\n\n  &quot;differential&quot;: {\n        &quot;element&quot;: [\n        ...\n            {\n                &quot;id&quot;: &quot;Patient.birthDate&quot;,\n                &quot;path&quot;: &quot;Patient.birthDate&quot;,\n                &quot;short&quot;: &quot;Patients date of birth. The date of birth is mandatory for a patient. An incomplete date, e.g. only year or only year + month, is permitted.&quot;,\n                &quot;alias&quot;: [\n                    &quot;Geboortedatum&quot;\n                ],\n                &quot;mapping&quot;: [\n                    {\n                        &quot;identity&quot;: &quot;hcim-patient-v2.0.1-2015EN&quot;,\n                        &quot;map&quot;: &quot;NL-CM:0.1.10&quot;,\n                        &quot;comment&quot;: &quot;DateOfBirth&quot;\n                    },\n                    {\n                        &quot;identity&quot;: &quot;hcim-patient-v3.0-2016EN&quot;,\n                        &quot;map&quot;: &quot;NL-CM:0.1.10&quot;,\n                        &quot;comment&quot;: &quot;DateOfBirth&quot;\n                    },\n                    {\n                        &quot;identity&quot;: &quot;hcim-patient-v3.1-2017EN&quot;,\n                        &quot;map&quot;: &quot;NL-CM:0.1.10&quot;,\n                        &quot;comment&quot;: &quot;DateOfBirth&quot;\n                    }\n                ]\n            },\n\n        ...\n        ]\n</code></pre></div>",
        "id": 197794562,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589633804
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> this works for me fine when I extract out these resources and run them in the validator directly. So I'm mystified as to why this error would arise here. Is it possible that HAPI is serving up the wrong version of the profile internally?</p>",
        "id": 197813743,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589661151
    },
    {
        "content": "<p>I can look into it for sure. The wrapper in HAPI doesn't include all the fields that the wrapper in the core validator does. I noticed this when I was doing my first attempt at test migration. It <em>may</em> be related to that. But I would have to look as there is a lot going on under the hood.</p>",
        "id": 197813832,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1589661279
    },
    {
        "content": "<p>I'm stepping away for today, but I can look into it on Monday if that's okay?</p>",
        "id": 197813869,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1589661337
    },
    {
        "content": "<p>there is indeed a lot. We might have to debug it together; the cause of the problem is that there's no match for dateOfBirth in InstanceValidator.assignChildren, but it clearly exists in the profile in question; so I assume it's not getting served up the profile in question correctly</p>",
        "id": 197813934,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589661392
    },
    {
        "content": "<p>thanks for looking into this!</p>",
        "id": 197840706,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589709239
    },
    {
        "content": "<p>any new findings?</p>",
        "id": 198039878,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589879611
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"294094\">@Job Schipper</span> are you able to replicate this on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>? That might be helpful to help us create a test case</p>",
        "id": 198115444,
        "sender_full_name": "James Agnew",
        "timestamp": 1589916745
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> I was, the example i posted was using that server. However, I just re-ran it and now the validation passes. Has there been a release in the meantime?</p>",
        "id": 198670106,
        "sender_full_name": "Job Schipper",
        "timestamp": 1590414143
    },
    {
        "content": "<p>Quite possibly- We redeploy fairly frequently and it's entirely possible that this has been fixed.</p>",
        "id": 198700283,
        "sender_full_name": "James Agnew",
        "timestamp": 1590438597
    }
]