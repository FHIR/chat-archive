[
    {
        "content": "<p>How is an id + extension, commonly seen in CDA documents, handled in FHIR Identifier?</p>",
        "id": 153832999,
        "sender_full_name": "John Moehrke",
        "timestamp": 1465994792
    },
    {
        "content": "<p>Do you mean root + extension?</p>",
        "id": 153833007,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1465999010
    },
    {
        "content": "<p>yes</p>",
        "id": 153833017,
        "sender_full_name": "John Moehrke",
        "timestamp": 1466001387
    },
    {
        "content": "<p>root goes into system, extension goes into value.  Root must be transformed into a uri.  This can be done using \"urn:oid:[old root]\", though we encourage implementers to consider mapping from OIDs to human-readable URIs for the benefit of long-term maintainability/ease of use</p>",
        "id": 153833019,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1466001537
    },
    {
        "content": "<p>sounds reasonable. Did I miss this explanation in the spec?</p>",
        "id": 153833021,
        "sender_full_name": "John Moehrke",
        "timestamp": 1466001650
    },
    {
        "content": "<p>It's in the RIM mappings for the data type.  As a rule, we don't talk about v2 or v3 mapping too much in the text of the spec because they're no more relevant/important than mapping X12 or ebXML or any of the other numerous data exchange standards out there.</p>",
        "id": 153833033,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1466010237
    },
    {
        "content": "<p>okay. I will add it to the IHE profiles.</p>",
        "id": 153833036,
        "sender_full_name": "John Moehrke",
        "timestamp": 1466011140
    },
    {
        "content": "<p>So the question we have is related to how does a reader of an Identifier know that one is using this RIM mapping rule, vs a normal use of Identifier? The only way one can determine this is to know by context where the Identifier sits within that it is likely to be a RIM mapping and not a normal Identifier?</p>",
        "id": 153839807,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468961521
    },
    {
        "content": "<p>which conflicts with the recommendation found in the Identifier section that says if the identifier value is globally unique that it should be put into the value with the system defined as the RFC3986</p>",
        "id": 153839809,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468961607
    },
    {
        "content": "<p>that's a really confusing question for me.</p>",
        "id": 153839811,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468962016
    },
    {
        "content": "<p>you don't 'use the mapping rule' - it just exists</p>",
        "id": 153839812,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468962057
    },
    {
        "content": "<p>The problem is that the FHIR spec has two conflicting instructions for how to handle globally unique identifiers. One says to use rfc3986, one for RIM identifiers. This might be clear for how to take a value and put it into FHIR Identifier. My question is if I am looking at a FHIR Identifier, how to I know that the Identifier I am looking at is one that was put in there using the RIM mapping, or is really an assigning authority assigned value.</p>",
        "id": 153839826,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468965853
    },
    {
        "content": "<p>mostly because as a receiver of this information I need to know so that I can query my possible non-FHIR information sources.</p>",
        "id": 153839828,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468965889
    },
    {
        "content": "<p>I don't understand what the conflicting instructions are </p>",
        "id": 153839829,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468965938
    },
    {
        "content": "<p>In the datatypes page for Identifier is this sentence \"If the identifier itself is naturally globally unique (e.g. an OID, a UUID, or a URI with no trailing local part), then the system SHALL be \"urn:ietf:rfc:3986\", and the URI is in the value.\"</p>",
        "id": 153839830,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966029
    },
    {
        "content": "<p>yes</p>",
        "id": 153839831,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468966051
    },
    {
        "content": "<p>YET, in the same page, the 'mapping' for Identifier <a href=\"https://www.hl7.org/fhir/datatypes-mappings.html#Identifier\" target=\"_blank\" title=\"https://www.hl7.org/fhir/datatypes-mappings.html#Identifier\">https://www.hl7.org/fhir/datatypes-mappings.html#Identifier</a></p>",
        "id": 153839832,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966058
    },
    {
        "content": "<p>says that with RIM mapping</p>",
        "id": 153839833,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966066
    },
    {
        "content": "<p>it is different</p>",
        "id": 153839834,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966070
    },
    {
        "content": "<p>system   II.root or Role.id.root<br>\n    value   II.extension or II.root if system indicates OID or GUID (Or Role.id.extension or root)</p>",
        "id": 153839835,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966093
    },
    {
        "content": "<p>that is not in conflict, but it is worded badly now. 'indicates OID or GUID actually means, urn:ietf:rfc:3986\"</p>",
        "id": 153839836,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468966194
    },
    {
        "content": "<p>but that clause is useless... as the problem is that I can't tell the meaning of system is... is it a RIM like system, or is it a real identifier assiging authority</p>",
        "id": 153839840,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468966689
    },
    {
        "content": "<p>that difference I don't understand either</p>",
        "id": 153839841,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468966965
    },
    {
        "content": "<p>Consider if i have a CDA document id which is 1.2.3.4.5. I code it as system=rfc3986, code=1.2.3.4.5. But if I have a CDA document id which is 1.2.3.4.5^678, I have to code it as system=1.2.3.4.5, code=678. That seems weird, in one case 1.2.3.4.5 is the system, but in another place it is the value?</p>",
        "id": 153839847,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1468967991
    },
    {
        "content": "<p>My understanding, and it is not fully clear in FHIR, is that the result is that when I take a CDA document ID, I first check for extension.  If no extension, I use system = \"rfc3986\".  But if there is an extension I use system=\"OID-root-of-CDA-DocumentID\".   This means when I receive an ID, I have to make a context based decision.  If system is an OID, I need to guess based on context whether that OID is the OID for some coding system that I don't know or it's the OID from a CDA Document ID.  I think I can guess based on larger context, but if the ID ever gets separated from context I won't know what to do.</p>",
        "id": 153839849,
        "sender_full_name": "Robert Horn",
        "timestamp": 1468968035
    },
    {
        "content": "<p>This makes the parsing and matching logic very complex.</p>",
        "id": 153839850,
        "sender_full_name": "Robert Horn",
        "timestamp": 1468968100
    },
    {
        "content": "<p>well, yes, the mapping is complex. I think we got it wrong in v3 - everyone gets root/extension wrong, and we just don't have that problem in FHIR - except when we talk about II....</p>",
        "id": 153839851,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968174
    },
    {
        "content": "<p>I don't understand the context bit though - the decisions are solely made on the II itself. </p>",
        "id": 153839852,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968216
    },
    {
        "content": "<p>the formal mapping I did migth clarify:</p>",
        "id": 153839853,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968225
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153839854,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968311
    },
    {
        "content": "<div class=\"codehilite\"><pre>group II2Identifier extends ANY2Element\n  input src : II as source;\n  input tgt : Identifier as target;\n\n  root1: for src.root as r where extension.exists() make tgt.system = translate(r, &quot;http://hl7.org/fhir/ConceptMap/special-oid2uri&quot;, &quot;uri&quot;)  \n  ext1: for src.extension as e make tgt.value = e\n\n  root2: for src.root as r where extension.empty() make tgt.system = &quot;urn:ietf:rfc:3986&quot;, tgt.value = translate(r, &quot;http://hl7.org/fhir/ConceptMap/special-oid2uri&quot;, &quot;uri&quot;)\n\nendgroup\n</pre></div>",
        "id": 153839856,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968329
    },
    {
        "content": "<p>I was kind of hoping we could phase out the extension.  FHIR isn't the only place affected.</p>\n<p>The context issue is that II is that the data structure for coded terms and II are very similar.  If the context saying whether it's an II or coded term gets lost, you are in trouble.  There are lots of applications that like to strip out identifiers.</p>",
        "id": 153839857,
        "sender_full_name": "Robert Horn",
        "timestamp": 1468968335
    },
    {
        "content": "<p>if there's an extension, then treat the root as the system (but translate it to a URI), and map the extension to the value</p>\n<p>if there's no extension, then make the system = urn:ietf:rfc:3986, and make the value the root converted to a URI</p>",
        "id": 153839859,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968339
    },
    {
        "content": "<p>The problem is in the other direction</p>",
        "id": 153839860,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468968446
    },
    {
        "content": "<p>if you lose the difference between code and identifier, then you're screwed. yes. But fior us, that's type not context</p>",
        "id": 153839861,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968461
    },
    {
        "content": "<p>if I have a FHIR Identifier, how do I know how to read it</p>",
        "id": 153839862,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468968465
    },
    {
        "content": "<p>why is it a problem? </p>",
        "id": 153839863,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968475
    },
    {
        "content": "<p>because FHIR is not a bitbucket</p>",
        "id": 153839864,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468968492
    },
    {
        "content": "<p>I may need to take that identifier out of a closed FHIR system.</p>",
        "id": 153839865,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1468968503
    },
    {
        "content": "<p>or is it?</p>",
        "id": 153839866,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468968504
    },
    {
        "content": "<p>if the root is urn:ietf:rfc:3986, then if you can translate the value to an OID or UUID, put it in the root. else error</p>\n<p>if the root is not urn:ietf:rfc:3986, then see if you can translate the system to an OID or UUID, else error, then put the value in extension</p>",
        "id": 153839867,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968533
    },
    {
        "content": "<p>the princple problem is that the FHIR identiifer can represent things that the II can't</p>",
        "id": 153839868,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968547
    },
    {
        "content": "<p>right... so the problem comes in when the root is NOT rfc3986</p>",
        "id": 153839869,
        "sender_full_name": "John Moehrke",
        "timestamp": 1468968585
    },
    {
        "content": "<p>I don't think it's a problem, it just might fail. It's not unclear, anyway</p>",
        "id": 153839870,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968609
    },
    {
        "content": "<p>For example, how would I create a CDA from a FHIR resource, when that FHIR resource was created from a CDA with an extension.  I want to be sure I get the same result.</p>",
        "id": 153839871,
        "sender_full_name": "Robert Horn",
        "timestamp": 1468968615
    },
    {
        "content": "<p>following the method above, you will. It might fail if the source was outside CDA in the first place, but it round trips for II</p>",
        "id": 153839873,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968643
    },
    {
        "content": "<p>Or, how would I know that it is a OID+extension identifier and not some other identifier with an OID identifying the system?</p>",
        "id": 153839874,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1468968690
    },
    {
        "content": "<p>what's the difference?</p>",
        "id": 153839875,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968793
    },
    {
        "content": "<p>if you can convert the source system to an OID, then you represent it as a root+extension, otherwise it's an error</p>",
        "id": 153839877,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968963
    },
    {
        "content": "<p>I don't understand the problem you're seeing there</p>",
        "id": 153839878,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468968970
    },
    {
        "content": "<p>the key is that you need to be able to convert from URI to OID Or UUID. I believe there's 3 states for that:<br>\n- the URI starts with urn:oid: or urn:uuid:<br>\n- I can look up the URI in some table of URIs, and find the associated OID or UUID (might be a naming system table)<br>\n- I don't know an equivalent OID</p>",
        "id": 153839879,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468969077
    },
    {
        "content": "<p>so, yes, you probably need a look up table. But other than that. there's no issue here I can see</p>",
        "id": 153839880,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468969092
    },
    {
        "content": "<p>See <a href=\"http://motorcycleguy.blogspot.com/2016/07/round-tripping-identifiers-from-cda-to.html\" target=\"_blank\" title=\"http://motorcycleguy.blogspot.com/2016/07/round-tripping-identifiers-from-cda-to.html\">http://motorcycleguy.blogspot.com/2016/07/round-tripping-identifiers-from-cda-to.html</a> for what I figured out on this a while back</p>",
        "id": 153841635,
        "sender_full_name": "Keith Boone",
        "timestamp": 1469785025
    },
    {
        "content": "<p>There must be a better way. This is an hl7 created problem.  How real are the problem cases?</p>",
        "id": 153841647,
        "sender_full_name": "John Moehrke",
        "timestamp": 1469799924
    },
    {
        "content": "<p>I don't know what problem you still see here?</p>",
        "id": 153841653,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1469802439
    },
    {
        "content": "<p>There are cases where I have a FHIR Identifier, properly filled out; but I can't tell how to put that into a CDA or HL7 v2 or HL7 v3 form deterministically. The proposal that I have a registry of roots is not scaleable. -- I am not saying that all cases are problematic; but there are some that are.</p>",
        "id": 153842062,
        "sender_full_name": "John Moehrke",
        "timestamp": 1470141787
    },
    {
        "content": "<p>so my view is that an identifier oriinally populated from an II can be determistically converted back to an II. One that is outside the space of II, not so easily. That fact was written into the Identifier data type when we changed the semantic scope of it on day 1</p>",
        "id": 153842080,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470171796
    }
]