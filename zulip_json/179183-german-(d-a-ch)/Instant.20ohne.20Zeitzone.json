[
    {
        "content": "<p>Laut STU3 datatypes ist ein <code>Instant</code> eine vollständige Datumsangabe inklusive Zeit und Zeitzone.</p>\n<div class=\"codehilite\"><pre><span></span>An instant in time - known at least to the second and always includes a time zone. Note: This is intended for precisely observed times (typically system logs etc.), and not human-reported times - for them, use date and dateTime. instant is a more constrained dateTime\n</pre></div>\n\n\n<p>Wenn ich jetzt z.B. eine DocumentReference, wo das Element \"indexed\" vom Typ \"Instant\" ist, gegen das HL7 Basisprofil \"DocumentReference\" mit Hilfe von FHIR.NET einlese und validiere, dann werden fehlende Zeitzonen durch die local timezone ersetzt, z.B. \"+01:00\". Dadurch ist es unmöglich, eine fehlende Zeitzone zu erkennen und entsprechend zu reagieren.</p>\n<p>Im sorce code sieht man, dass FHIR.NET in der Datei \".Hl7.Fhir.Core\\Model\\Instant.cs\" die .NET Methoden <code>DateTimeOffset.TryParse()</code> und <code>DateTimeOffset.Now</code>verwendet. Das ist nicht restriktiv genug, um der FHIR Spezifikation zu genügen.</p>\n<p>Lustigerweise macht simplifier etwas ähnliches. Wenn die Zeitzone fehlt, dann wird einfach +00:00 als Zeitzone angenommen und der String verändert. Hier ein Beispiel: <a href=\"https://simplifier.net/justforfun/documentreference-example\" target=\"_blank\" title=\"https://simplifier.net/justforfun/documentreference-example\">https://simplifier.net/justforfun/documentreference-example</a><br>\nHochgeladen wurde der String \"2005-12-24T09:43:41\" und nach dem hochladen steht \"2005-12-24T09:43:41+00:00\" drin.</p>\n<p>Frage: Darf für invalide Zeit-Strings für den Typ Instant die Zeitzone einfach generiert werden? Das erscheint uns falsch.</p>",
        "id": 158116110,
        "sender_full_name": "Markus Danz",
        "timestamp": 1549977249
    },
    {
        "content": "<p>Es ist zumindest ein pragmatischer Ansatz, aber meines Wissens so nicht in der FHIR-Spec. zu finden und sicher diskussionswürdig.<br>\nDass Simplifier sich ähnlich verhält, ist klar - Simplifier benutzt die Dotnet-Library.</p>\n<p>Wäre sicher ein Thema für den implementers-Stream.<br>\nEvtl. weiß auch <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> mehr?</p>",
        "id": 158374730,
        "sender_full_name": "Stefan Lang",
        "timestamp": 1549995809
    },
    {
        "content": "<p>Das “gewünschte” Result wäre dann, dass die Resource nicht akzeptiert wird und der Parser einen Fehler schmeißt, verstehe ich das so richtig?</p>",
        "id": 158375742,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1549996546
    },
    {
        "content": "<p>Nicht der Parser - der validator. Oder? Keine Ahnung, wie das die angesprochene Library hält, aber im allgemeinen gibt es validierende und nicht-validierende Parser (option \"strict\", oder sowas ähnliches meistens).</p>",
        "id": 158379562,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1549999384
    },
    {
        "content": "<p>Netter topic zu ähnlichen Fragen: <a href=\"#narrow/stream/179166-implementers/topic/Client.20Timezone\" title=\"#narrow/stream/179166-implementers/topic/Client.20Timezone\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Client.20Timezone</a></p>\n<ul>\n<li>mit der interessanten Idee, dass der Client dem Server seinen Zeit-Offset im HTTP header mitteilt. Der \"nicht-validierende\" Parser dürfte das u.U. verwenden - der \"validierende\" jedoch nicht, IMHO. Siehe hier: <a href=\"https://tools.ietf.org/html/draft-sharhalakis-httptz-05\" target=\"_blank\" title=\"https://tools.ietf.org/html/draft-sharhalakis-httptz-05\">https://tools.ietf.org/html/draft-sharhalakis-httptz-05</a></li>\n</ul>",
        "id": 158379948,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1549999686
    },
    {
        "content": "<p>Habe das Thema intern an das API Team weitergegeben, wir schauen uns den Fall an. Sobald ich eine Ticket Nummer dazu hab, reiche ich diese nach. Ich denke der Validator sollte es klar zurückweisen. Unschlüssig bin ich beim Parser. Ich stimme Christof zu, dass sein Setting in diesem Fall hilfreich wäre.</p>",
        "id": 158425040,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550049891
    },
    {
        "content": "<p>Danke fürs Melden :)</p>",
        "id": 158425050,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550049906
    },
    {
        "content": "<p>Ich denke, per Default sollte der Parser sich standardkonform verhalten. Dass es dann einen \"lazy\"- oder \"non-strict\"-Parameter gibt, mit dem man solche Heuristiken einschalten kann, mag wie gesagt sicher in bestimmten Use Cases pragmatisch sein.</p>",
        "id": 158430526,
        "sender_full_name": "Stefan Lang",
        "timestamp": 1550055015
    },
    {
        "content": "<p>Validation Bug: <a href=\"https://github.com/ewoutkramer/fhir-net-api/issues/865\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/issues/865\">https://github.com/ewoutkramer/fhir-net-api/issues/865</a></p>",
        "id": 158433158,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550058000
    },
    {
        "content": "<p>Für den Parser wird es kein Setting geben, da wir auf dieser Ebene keine genaueren Typinformationen haben (instance vs. dateTime vs. date). Per default wird der String zu einem DateTimeOffset umgewandelt und UTC wird angenommen.</p>",
        "id": 158433462,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550058257
    },
    {
        "content": "<p>Diese Regel gilt für alle DateTimeOffset Datentypen.</p>",
        "id": 158433493,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550058303
    },
    {
        "content": "<p>Uns als Konsument der FHIR.NET Library ist es egal, ob der Parser oder der Validator den Fehler ekennt. Wichtig ist, dass wir irgendeine Möglichkeit haben, eine fehlende Zeitzone beim Datentyp Instant zu erkennen, wenn die FHIR.NET zum Einlesen einer Resource verwendet wird.</p>",
        "id": 158460979,
        "sender_full_name": "Markus Danz",
        "timestamp": 1550079926
    },
    {
        "content": "<p>schematron validation filter?</p>",
        "id": 158463224,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1550081626
    },
    {
        "content": "<p>Das könnte Zusammenhängen mit einem Fehler im RegEx Pattern für dateTime in STU3. In R4 wurde das korrigiert. In STU3 wird die Korrektur mit den Technical Corrections publiziert.</p>",
        "id": 158736568,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1550396630
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> Meinst du damit, dass in STU3 instant überhaupt keinen Regex zum Validieren besitzt? Hat jemand das schon vorgeschlagen für ein Backport?</p>",
        "id": 158743463,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550409680
    },
    {
        "content": "<p>Schau mal im implementers Stream, da gibt aktuell eine Diskussion zum dateTime pattern. Ich kann’s leider nicht verlinken, da ich die mobile App benutze...</p>",
        "id": 158743516,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1550409780
    },
    {
        "content": "<p>Ah, ok. Vielen Dank. Das löst aber nicht das Problem hier. Weiß jemand gegen was HAPI in diesem Fall bei einem Instant Type validiert? <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span></p>",
        "id": 158744298,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1550411286
    },
    {
        "content": "<p>Hapi hat im Dstu3 Instant Validator die Regex von R4 verwendet, wurde hier also anscheinend schon gebackportet</p>",
        "id": 158748571,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1550419435
    },
    {
        "content": "<p>was mich irritiert: hapi beginnt die Regex mit \"-?\" ansonsten alles gleich. Wie sollte eine Instant mit \"-\" beginnen? Übersehe ich da nun was?<br>\n(edit:) nein, ist wohl falsch und kommt aus den Referenz Klassen.</p>",
        "id": 158748630,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1550419532
    },
    {
        "content": "<p>Es ist zwar schon eine kleine Weile her, aber die C# API hat nun auch den R4 Regex implementiert. Gforge Ticket für den Backport in STU3 inklusive.<br>\nSiehe <a href=\"https://github.com/FirelyTeam/fhir-net-api/pull/1028\" target=\"_blank\" title=\"https://github.com/FirelyTeam/fhir-net-api/pull/1028\">https://github.com/FirelyTeam/fhir-net-api/pull/1028</a></p>",
        "id": 169896083,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1562612986
    }
]