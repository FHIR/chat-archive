[
    {
        "content": "<p>Hi everyone,</p>\n<p>I'm currently dipping my feet into Smart on FHIR, trying to secure a FHIR server and having an application write resources to it. My goal is the following: Open the application, authorize with the identity server and transmit Observations. </p>\n<p>For this, I'm using the <a href=\"https://github.com/Alvearie/keycloak-extensions-for-fhir\">Keycloak extensions for FHIR</a> and a <a href=\"https://fire.ly/products/firely-server/\">Firely Server</a>. This is what I have done so far: </p>\n<ol>\n<li>iOS App is developed</li>\n<li>Setup Firely Server </li>\n<li>Setup KeyCloak</li>\n<li>Add KeyCloak Smart on FHIR extension to Keycloak instance</li>\n<li>Connect Firely Server and KeyCloak</li>\n<li>The login window (Keycloak) and callback to the iOS application works! (yay)</li>\n</ol>\n<p>At this point however, the patient context picker as seen <a href=\"https://github.com/Alvearie/keycloak-extensions-for-fhir#the-patient-context-picker\">here</a> is not visible to me. I suspect that I am doing/understanding something wrong with regards to configuration. In general, this is a standalone launch sequence, my current scope is <code>openid</code>(Is this correct?). The resulting question:</p>\n<p><strong>How do I configure the SMART on FHIR extension for keycloak in order to achieve the workflow as outlined above?</strong></p>\n<p>Big thanks to <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> at this point for his work on the extension!</p>",
        "id": 245854163,
        "sender_full_name": "Yannick Börner",
        "timestamp": 1626195339
    },
    {
        "content": "<blockquote>\n<p>How do I configure the SMART on FHIR extension for keycloak in order to achieve the workflow as outlined above?</p>\n</blockquote>\n<p>A few options:</p>\n<ol>\n<li>manually configure a keycloak realm</li>\n<li>use the keycloak-config project (in the same repo)</li>\n<li>automate the config some other way (e.g. via standard realm import)</li>\n</ol>",
        "id": 245860448,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1626198019
    },
    {
        "content": "<p>I initially tried number 3, but it never worked well for me and so I helped build 2 (with a couple colleagues)</p>",
        "id": 245860586,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1626198089
    },
    {
        "content": "<p>did you try one of these 3 yet?</p>",
        "id": 245860756,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1626198176
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191676\">Lee Surprenant</span> <a href=\"#narrow/stream/179170-smart/topic/Configuring.20the.20Smart.20on.20FHIR.20extension.20for.20Keycloak/near/245860756\">said</a>:</p>\n<blockquote>\n<p>did you try one of these 3 yet?</p>\n</blockquote>\n<p>Hi Lee, yes, I tried number 2 which populates the keycloak instance with scopes and one realm I believe. Where I am struggling a bit is the next step. Do I need a patient resource per patient on the server <strong>and</strong> a user in Keycloak or is the patient sufficient?</p>",
        "id": 246060673,
        "sender_full_name": "Yannick Börner",
        "timestamp": 1626334378
    },
    {
        "content": "<p>It turns out that my assumption that the patient context picker will show up in any case is wrong. It will only show up when there are multiple resourceIds supplied, right?</p>",
        "id": 246061570,
        "sender_full_name": "Yannick Börner",
        "timestamp": 1626335108
    },
    {
        "content": "<p>And the final question: I tried to get an 'admin' user working that is capable of reading and writing to all resources on the server. I created the scope <code>user/*.*</code> for that purpose. Simply requesting a token with this scope did not bear any fruits however. Have you done this before?</p>",
        "id": 246061879,
        "sender_full_name": "Yannick Börner",
        "timestamp": 1626335372
    },
    {
        "content": "<p>Sorry for all of the questions!</p>",
        "id": 246061895,
        "sender_full_name": "Yannick Börner",
        "timestamp": 1626335390
    },
    {
        "content": "<blockquote>\n<p>It will only show up when there are multiple resourceIds supplied, right?</p>\n</blockquote>\n<p>Correct.  No need to select \"which patient\" if there's only one the user has access to.</p>\n<blockquote>\n<p>I created the scope user/<em>.</em> for that purpose. Simply requesting a token with this scope did not bear any fruits however. Have you done this before?</p>\n</blockquote>\n<p>Did you get this working yet?  I was more focused on the <code>patient/</code> scopes and launch context for this project, so hadn't gotten around to the <code>user/</code> ones yet.  That said, I think its just a matter of associating the scopes with the client app.  If using keycloak-config, you could add them to the following list so that they will be associated with <em>each</em> client when it gets registered:  <a href=\"https://github.com/Alvearie/keycloak-extensions-for-fhir/blob/main/keycloak-config/src/test/resources/keycloak-config.json#L464-L491\">https://github.com/Alvearie/keycloak-extensions-for-fhir/blob/main/keycloak-config/src/test/resources/keycloak-config.json#L464-L491</a></p>\n<p>note:  for clients that already exist, you might need to manually add the new scopes since the defaults only apply when its first created.</p>",
        "id": 246619021,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1626800252
    }
]