[
    {
        "content": "<p>If I understand well the \"core\" concepts for SMART on FHIR, the data model is based on us-core profiles.<br>\nNevertheless, when I try to use <code>https://r3.smarthealthit.org/Patient/$validate</code> (or r4) with</p>\n<div class=\"codehilite\"><pre><span></span>    &quot;meta&quot;: {\n        &quot;profile&quot;: [&quot;http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient&quot;]\n    },\n</pre></div>\n\n\n<p>I receive <code>\"StructureDefinition reference \\\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient\\\" could not be resolved\"</code>.<br>\nAnd indeed, searching in <code>/StructureDefinition</code> resources, I was not able to find any us-core StructureDefinition</p>\n<p>Is it normal ? Is there something I don't understand ?</p>",
        "id": 188023070,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581523102
    },
    {
        "content": "<p>What server were you searching on?  You can't necessarily expect most servers to have awareness of the US Core profiles - even if they support SMART on FHIR</p>",
        "id": 188026011,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581524532
    },
    {
        "content": "<p>It's <code>https://r3.smarthealthit.org</code>, the \"SMART on FHIR\" official test server, so ... I was expecting them to be aware of the us-core profiles ;)</p>",
        "id": 188026397,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581524797
    },
    {
        "content": "<p>Not necessarily something you can expect.  The data might be expected to comply with the profiles - that doesn't mean the servers will have awareness of the profiles for validation purposes.  It may be they're not hosted for exactly that reason.  <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span>, thoughts?</p>",
        "id": 188026739,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581525014
    },
    {
        "content": "<p>The server as such is a generic FHIR server -- it can be used to store data that meet (or don't meet!) US Core profiles. When it comes to sample data, we try to generally align with these profiles (and most of the pre-loaded sample data just comes from Synthea at this stage).</p>",
        "id": 188035586,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581530125
    },
    {
        "content": "<p>Do you think I should make a PR on the Github repository, to add us-core profiles to pre-loaded sample data ?<br>\nNot to make them mandatory, as I understand this is not the goal, but just to \"have them available\" :)</p>",
        "id": 188084193,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581579174
    },
    {
        "content": "<p>BTW, Synthea can generate US Core data (with the profiles declared in meta), using the <code>--exporter.fhir.use_us_core_ig=true</code> command line switch.</p>",
        "id": 188133809,
        "sender_full_name": "Jason Walonoski",
        "timestamp": 1581617739
    },
    {
        "content": "<p>Wait, are you talking about adding profile tags <span class=\"user-mention\" data-user-id=\"250480\">@Florian Briand</span> , or about actually providing different data?</p>",
        "id": 188138479,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581620491
    },
    {
        "content": "<p>I don't know exactly what he is talking about, but to be clear, when using that US Core switch synthea generates additional us core data (with some extra fields filled out and with some additional resources), in addition to declaring profile conformance in meta.</p>",
        "id": 188139397,
        "sender_full_name": "Jason Walonoski",
        "timestamp": 1581621006
    },
    {
        "content": "<p>The idea is to be able to use <code>$validate?profile=...us-core-...</code> operation to check a resource against the us-core profiles.<br>\nIt's not to \"always\" do this validation, but allow people to do it.<br>\nTo do so, we have to add the appropriates StructureDefinition on the server, the ones registering the us-core profiles, to made them available with the $validate operation.</p>\n<p>But in practice, maybe the synthea's param add automatically the profiles also, so thank you for the tip :)</p>",
        "id": 188141395,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581622241
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"250480\">@Florian Briand</span> I'm unclear on this point: if you're passing in <code>profile=</code> as an argument to the <code>$validate</code> operation, then it shouldn't be necessary for the data themselves to be tagged with anything specific in <code>meta.profile</code>. In other words, the validator shouldn't care about those tags; it's focused on content.</p>",
        "id": 188142582,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581622893
    },
    {
        "content": "<p>Yes, there is no need to tag the data</p>",
        "id": 188143659,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581623620
    },
    {
        "content": "<p>But to use validate, the profile have to exists, as a StructureDef on the server. The server seems not able to \"fetch\" the Profile using the provided URL</p>",
        "id": 188143926,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581623709
    },
    {
        "content": "<p>Wait, you're saying that <em>every</em> data server would need to store definnitional artifacts in order for a 3rd party server to validate? That doesn't sound right (or realistic).</p>",
        "id": 188254910,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581720679
    },
    {
        "content": "<p>The more likely scenario is: EHR server hosts data from its own internal database, using profiled FHIR. If a client wants to validate those data, the client is responsible for gathering up all the definitional artifacts required to perform validation (e.g., the client would obtain a validator and the US Core structure definitions).</p>",
        "id": 188254995,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581720741
    },
    {
        "content": "<p>In this context, the SMART reference stack is playing the role of an EHR (and nothing extra).</p>",
        "id": 188255027,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1581720774
    },
    {
        "content": "<p>the way we've defined it, a server that hosts the $validate operation has to host / locate the profiles value sets etc. And if the server wants to validate anyway (which it can ... and sometimes should), and it wants to validate against the profiles, then it also needs to locate them for itself</p>",
        "id": 188318873,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581843971
    },
    {
        "content": "<p>a typical data server doesn't do that - it doesn't provide a $validate operation, and it validates based on it's internal logic, which mostly wouldn't depend on profiles (though it could)</p>",
        "id": 188318880,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581844017
    },
    {
        "content": "<p>To finalize this point then: hosting the <code>$validate</code> operation is not something that a SMART on FHIR server is expected to do.</p>",
        "id": 188598290,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582156391
    },
    {
        "content": "<p>A classic \"SMART on FHIR\" server, yes ; but the ones used for demo/testing/... like <a href=\"https://r4.smarthealthit.org/metadata\" target=\"_blank\" title=\"https://r4.smarthealthit.org/metadata\">https://r4.smarthealthit.org/metadata</a> ? It could be a good idea, no ? ;)</p>\n<p>Because everybody don't have a custom server in local, and it's quite painful to only have Grahame's ones to develop ;)</p>",
        "id": 189042583,
        "sender_full_name": "Florian Briand",
        "timestamp": 1582652901
    },
    {
        "content": "<p>I think sometimes it does a disservice to developers if the \"reference\" implementation is way out ahead of what real-world servers can do. It's a careful balance. On this specific issue, I'd say that data validation (as a service, on specific inputs) is not a SMART server concern, so clients that care about validation should be provisioning their own resources.</p>",
        "id": 189056467,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1582661639
    }
]