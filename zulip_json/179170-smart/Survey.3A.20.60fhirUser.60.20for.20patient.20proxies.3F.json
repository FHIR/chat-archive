[
    {
        "content": "<p>How does your SMART server represent a parent granting an app access to their child's data in the SMART/OIDC <code>fhirUser</code> claim? <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> your chosen method. cc/ <span class=\"user-mention\" data-user-id=\"193887\">@Weiyu Zhang</span></p>",
        "id": 168134247,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518521
    },
    {
        "content": "<p>Choices:</p>",
        "id": 168134298,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518534
    },
    {
        "content": "<ul>\n<li>(A) Consumer SMART authentication always contains a <code>Person</code> resource in <code>fhirUser</code>.</li>\n</ul>",
        "id": 168134306,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518541
    },
    {
        "content": "<ul>\n<li>(B) Consumer SMART authentication always contains a <code>Patient</code> resource in <code>fhirUser</code>.</li>\n</ul>",
        "id": 168134313,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518547
    },
    {
        "content": "<ul>\n<li>(C) For proxy access, Mom's <code>fhirUser</code> claim is a link to a <code>Person</code>resource. (For self access, Mom is a <code>Patient</code>).</li>\n</ul>",
        "id": 168134317,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518552
    },
    {
        "content": "<ul>\n<li>(D) For proxy access, Mom's <code>fhirUser</code> claim is a link to a <code>RelatedPerson</code>resource. (For self access, Mom is a <code>Patient</code>).</li>\n</ul>",
        "id": 168134332,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518562
    },
    {
        "content": "<ul>\n<li>(E) Something more complicated that I would recommend! (And explain in thread).</li>\n</ul>",
        "id": 168134342,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518568
    },
    {
        "content": "<ul>\n<li>(F) Something more complicated that I would <em>not</em> recommend ... :(</li>\n</ul>",
        "id": 168134346,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518573
    },
    {
        "content": "<blockquote>\n<p>To learn more about the user, the app should treat the fhirUser claim as the URL of a FHIR resource representing the current user. This will be a resource of type Patient, Practitioner, RelatedPerson, or Person. Note that Person is only used if the other resource type do not apply to the current user, for example, the “authorized representative” for &gt;1 patients.</p>\n</blockquote>\n<p><a href=\"http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#scopes-for-requesting-identity-data\" target=\"_blank\" title=\"http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#scopes-for-requesting-identity-data\">http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#scopes-for-requesting-identity-data</a></p>",
        "id": 168134351,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518578
    },
    {
        "content": "<p>References: </p>\n<ul>\n<li>SMART ballot issue: <a href=\"https://github.com/HL7/smart-app-launch/issues/192\" target=\"_blank\" title=\"https://github.com/HL7/smart-app-launch/issues/192\">https://github.com/HL7/smart-app-launch/issues/192</a></li>\n<li>GH, pre-ballot discussion: <a href=\"https://github.com/smart-on-fhir/smart-on-fhir.github.io/issues/148\" target=\"_blank\" title=\"https://github.com/smart-on-fhir/smart-on-fhir.github.io/issues/148\">https://github.com/smart-on-fhir/smart-on-fhir.github.io/issues/148</a></li>\n<li><span class=\"user-mention\" data-user-id=\"191609\">@Matt Randall</span> 's proposed rules: <a href=\"https://groups.google.com/forum/#!msg/smart-on-fhir/1F0jcaKxGsg/3Ua3bRgqDAAJ\" target=\"_blank\" title=\"https://groups.google.com/forum/#!msg/smart-on-fhir/1F0jcaKxGsg/3Ua3bRgqDAAJ\">https://groups.google.com/forum/#!msg/smart-on-fhir/1F0jcaKxGsg/3Ua3bRgqDAAJ</a></li>\n</ul>",
        "id": 168134358,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191356\">@Jenni Syed</span> , <span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> - mind weighing in on this? (since you commented on <a href=\"https://github.com/smart-on-fhir/smart-on-fhir.github.io/issues/148\" target=\"_blank\" title=\"https://github.com/smart-on-fhir/smart-on-fhir.github.io/issues/148\">#148</a>)</p>",
        "id": 168134544,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560518751
    },
    {
        "content": "<p>SMART should certainly enable real-time accesses by a guardian, by the patient as authorized by a guardian, etc... but the actual legal authorization statement is outside the scope of SMART, meaning SMART is only representing the real-time facts of some contract/consent that is held elsewhere. As with other Privacy Consent vectors (sensitive data, restricted/authorized users, etc) these are recorded as a Consent. A Consent resource is used to record the facts of the ceremony of getting the Consent and its rules. But a Consent resource is not an active authorization decision engine. The AuthZ is one opportunity to have an authorization decision made that is informed by Consent, a server resident $consent operation is another.</p>",
        "id": 168135031,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560519152
    },
    {
        "content": "<p>of course HEART is the opposite role, in that HEART does manage the consents and only exposes in UMA/OAuth tokens the decision of a specific run-time request for authorization. Thus HEART is complementary but explicitly covering this space....</p>",
        "id": 168135178,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560519269
    },
    {
        "content": "<p>Therefore using cascading OAuth one could use HEART for consent based authZ decisions, and SMART for RBAC (organization business rules); and in theory get both.</p>",
        "id": 168135237,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560519326
    },
    {
        "content": "<p>We always use Person - that corresponds to our own internal users - and that link as needed to Patient or Practitioner</p>",
        "id": 168135259,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560519355
    },
    {
        "content": "<p>We use Person, more because we also allow \"user\" scope accesses (eg: I get access to all my family records) and then RelatedPerson won't work. This way, at least it's consistent. If a patient is accessing on their own behalf (only their records/self), then we use Patient.</p>",
        "id": 168139825,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560522721
    },
    {
        "content": "<p>I'm nervous about this use of Person.  Person is intended to be a linking resource - it's not permitted to be an actor in FHIR references, so to see it being referenced as an actor in SMART is concerning...</p>",
        "id": 168139967,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1560522802
    },
    {
        "content": "<p>Person also has no role... where RelatedPerson, Practitioner, and Patient all have clear role... If all you have is Person, you don't know what role the user is playing, they might be a Practitioner and RelatedPerson as well as a Patient... I am not surprised that Person is used this way, as it fits close with 'User'. but note that 'User' would always have a role when acting.</p>",
        "id": 168140715,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560523305
    },
    {
        "content": "<p>For SMART, it is only intended to get the \"open id profile\" for the signed in person</p>",
        "id": 168140896,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560523418
    },
    {
        "content": "<p>which has things like email</p>",
        "id": 168140918,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560523431
    },
    {
        "content": "<p>It isn't intended to be used on a resource directly or be expected to be returned outside of that</p>",
        "id": 168141053,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560523497
    },
    {
        "content": "<p>There's expected to be only one Person record for the human-being across all their Practitioner, Patient and RelatedPerson roles - would they similarly have only one open id profile for all of those?</p>",
        "id": 168141600,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1560523832
    },
    {
        "content": "<p>open id profiles are usually tied to the way you log in</p>",
        "id": 168141841,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524028
    },
    {
        "content": "<p>In our system, your practitioner profile and your patient profile are different identity systems</p>",
        "id": 168141894,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524045
    },
    {
        "content": "<p>or consumer profile...</p>",
        "id": 168141906,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524056
    },
    {
        "content": "<p>This does bear the question on why use patient instead of person  sometimes on the consumer side :)</p>",
        "id": 168141928,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524076
    },
    {
        "content": "<p>(we did it because when we first started, Person wasn't part of the SMART spec, even though there was no other option when accessing with \"user\" scopes for a consumer)</p>",
        "id": 168141969,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524108
    },
    {
        "content": "<p>I think confusing profile and role is a dangerous thing to do. There isn't really an intent to communicate the role you are playing for the entire authorization session</p>",
        "id": 168142123,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524231
    },
    {
        "content": "<p>EG: you may act as a mom, spouse, and patient all  with one sign in for SMART</p>",
        "id": 168142149,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524255
    },
    {
        "content": "<p>Similarly, a practitioner's role isn't communicated (are you being a gp, specialist, etc)</p>",
        "id": 168142239,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560524300
    },
    {
        "content": "<p>I would agree that OpenID identifiers are just identifiers of an entity;  Those entity can act in many roles as Jenni explains. However OpenId does not try to force only one OpenID identifier per human. I personally have many, and even many at one identity provider (google).</p>",
        "id": 168142666,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560524609
    },
    {
        "content": "<blockquote>\n<p>This does bear the question on why use patient instead of person  sometimes on the consumer side :)</p>\n</blockquote>\n<p>Jenni, it sounds like if you were starting over, you might choose to implement Michele's approach of always using Person in fhirUser (for consumer scenarios). Would you agree?</p>",
        "id": 168144044,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560525602
    },
    {
        "content": "<blockquote>\n<p>OpenId does not try to force only one OpenID identifier per human. I personally have many, </p>\n</blockquote>\n<p>Hey John, do note that this is specifically about the <code>fhirUser</code> OIDC claim, which is really just a FHIR-specific version of the standard OIDC <code>profile</code> claim which is  just the url of the user's \"profile page\". I think that your point is exactly why <code>Person</code> makes sense - the <code>Person</code> resource is essentially just all the linkages for a user.</p>",
        "id": 168144368,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560525800
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191864\">@Isaac Vetter</span>  probably - I haven't heard that SMART was intending that to be anything other than just details of the person signed in</p>",
        "id": 168144664,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1560525975
    },
    {
        "content": "<p>I am not against using Person in this way. Just poiting out that this is short of statements of context based role/agent... As Jenni points out, the Person resource is sufficiently abstract and contains the right elements... sorry, not strongly up or down from me.</p>",
        "id": 168145687,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560526565
    },
    {
        "content": "<p>Agreed that the goal of the OIDC profile claim here is authentication -- plus an entry point to discovering FHIR specific details about the person (like being able to traverse the links from a Person to a Practitioner, with assurance).</p>",
        "id": 168155410,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1560533653
    },
    {
        "content": "<p>Perspective using person across the board would be a totally reasonable way to do it, as long as Person.link correctly populated in the case of a patient and/or a practitioner.</p>",
        "id": 168155471,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1560533705
    },
    {
        "content": "<p>We evolved to using person slowly as more use cases became known, and I think the current specification reflects that evolution.</p>",
        "id": 168155498,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1560533742
    },
    {
        "content": "<p>How should an authorization server determine when to reference other resources from <code>Person</code>?</p>",
        "id": 168420820,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560877502
    },
    {
        "content": "<p>For a patient app, where the user is the authorized patient A: <br>\n- Person.link -&gt; Patient A</p>",
        "id": 168420827,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560877505
    },
    {
        "content": "<p>For a patient app, where the user is a proxy for the authorized patient B, should the Person resource still reference the proxy's patient resource? Should the Patient resource identify other potential proxy relationships?<br>\n- Person.link -&gt; RelatedPerson.patient -&gt; Patient B<br>\n- Person.link -&gt; Patient A ?<br>\n- Person.link -&gt; RelatedPerson.patient -&gt; Patient C ?</p>",
        "id": 168420830,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560877507
    },
    {
        "content": "<p>Also, <code>Person</code> <a href=\"https://www.hl7.org/fhir/person.html#8.18.2\" target=\"_blank\" title=\"https://www.hl7.org/fhir/person.html#8.18.2\">says</a>:</p>\n<blockquote>\n<p>Person instances are never directly referenced as actors (authors, subjects, performers, etc.)</p>\n</blockquote>\n<p>Doesn't this substantially invalidate the use of the Person resource as  a user?</p>",
        "id": 168423662,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560878227
    },
    {
        "content": "<p>pretty much. If you want to use Person as a user, you'd need to follow the reference to Patient or Practitioner, and ask the user which mode they were wanting to be (given the Argonaut makes that distinction a binary and that it's driven by regulation/business practices)</p>",
        "id": 168437789,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560879966
    },
    {
        "content": "<p>On our server the Person link only to the 'self' Patient - not to other relationships like family members etc (because the spec say 'The resource to which this actual person is associated')</p>",
        "id": 168439670,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560881075
    },
    {
        "content": "<p>(In general trying to model users and related audit log entries does not work very well for us with the current FHIR resources)</p>",
        "id": 168439781,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560881153
    },
    {
        "content": "<p>thanks, guys</p>",
        "id": 168440148,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560881388
    },
    {
        "content": "<p>So yes, would have to link through the RelatedPerson for proxy usage.<br>\nAll this does reflect that the user is separate to FHIR, and permissions are also outside, but informed by some FHIR content.</p>",
        "id": 168468176,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1560904647
    },
    {
        "content": "<p>I'd think the Person resource wouldn't change based on context of use, though access to the relevant details of the linked Patient/RelatedPerson/Practitioner resources might be gated by user authorization.</p>",
        "id": 168475333,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1560916664
    },
    {
        "content": "<blockquote>\n<p>would have to link through the RelatedPerson for proxy usage.</p>\n</blockquote>\n<p>Sorry, don't understand how you would do that?</p>",
        "id": 168503649,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560949148
    },
    {
        "content": "<p>The linkages between user as a proxy to a Patient would be found in the Consent. This is what Consent.provision.actor is used for. To authorize specific identities (possibly just business identity (aka userID)) as an authorized AGNT.</p>",
        "id": 168518760,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560959292
    },
    {
        "content": "<p>The consent example is not very clean... but here is the Grantor example. I would rather see the actor identified a AGNT with a clear PERMIT privilege. <a href=\"http://build.fhir.org/consent-example-grantor.html\" target=\"_blank\" title=\"http://build.fhir.org/consent-example-grantor.html\">http://build.fhir.org/consent-example-grantor.html</a></p>",
        "id": 168518974,
        "sender_full_name": "John Moehrke",
        "timestamp": 1560959442
    },
    {
        "content": "<p>We do not have the Consent resource</p>",
        "id": 168521501,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560961411
    },
    {
        "content": "<blockquote>\n<p>would have to link through the RelatedPerson for proxy usage.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> , I'm not suggesting this is a good idea and clearly, to John's point, authorization ought to be acquired before sharing relationships. I'd think that a proxy relationship could be represented as either:</p>\n<p>1. Person.link -&gt; RelatedPerson.patient -&gt; Patient B<br>\n2. RelatedPerson.patient -&gt; Patient B<br>\nWhat am I missing?</p>",
        "id": 168523346,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1560962853
    },
    {
        "content": "<p>Ah yes, I see now: Person can link a Patent (him/herself) and then one RelatedPerson for each relationship ('son', 'mother' etc) - with each of those referencing the corresponding Patient. Thanks Isaac</p>",
        "id": 168530364,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1560967276
    }
]