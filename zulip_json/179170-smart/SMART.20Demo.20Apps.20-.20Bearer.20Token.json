[
    {
        "content": "<p>So I've been monkeying around getting the SMART demo apps (Growth chart and BP Centiles) working against an OIC server and a FHIR server. </p>\n<p>I've got the whole thing working well, with one exception: The apps do not send any <code>Authorization</code> header to the FHIR server when they make a request. They complete the OAuth2 code flow successfully and definitely receive a token, and they are definitely making approrpiate FHIR data requests, but with no auth header in them.</p>\n<p>Are they able to send this header? Is there any config required to get them to do so?</p>",
        "id": 153862019,
        "sender_full_name": "James Agnew",
        "timestamp": 1481149083
    },
    {
        "content": "<p>The expectation is certainly that I can and should send  and authorization header containing a  OAuth Bearer token:-)</p>",
        "id": 153862024,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481149354
    },
    {
        "content": "<p>Does your fhir server have CORS  set to allow an authorization header?</p>",
        "id": 153862025,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481149391
    },
    {
        "content": "<p>It does.. But as far as I can see the app isn't actually requesting it in it's <code>Access-Control-Request-Headers</code> header.</p>\n<p>Request</p>\n<div class=\"codehilite\"><pre>Accept:*/*\nAccess-Control-Request-Headers:content-type\nAccess-Control-Request-Method:GET\nConnection:keep-alive\nHost:cdr.simpatico.ai:8000\nOrigin:https://fhir-dstu2.smarthealthit.org\nReferer:https://fhir-dstu2.smarthealthit.org/apps/growth-chart/\nUser-Agent:Mozilla/5.0 (X11; Linux x86_64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/54.0.2840.59 Safari/537.36\n</pre></div>\n\n\n<p>Response</p>\n<div class=\"codehilite\"><pre>Access-Control-Allow-Credentials:true\nAccess-Control-Allow-Headers:content-type\nAccess-Control-Allow-Methods:GET,POST,PUT,DELETE,HEAD,OPTIONS\nAccess-Control-Allow-Origin:https://fhir-dstu2.smarthealthit.org\nCache-Control:no-cache, no-store, max-age=0, must-revalidate\nContent-Length:0\nDate:Thu, 08 Dec 2016 03:10:20 GMT\nExpires:0\nVary:Origin\n</pre></div>",
        "id": 153862135,
        "sender_full_name": "James Agnew",
        "timestamp": 1481166839
    },
    {
        "content": "<p>Oh how strange. And it's successfully completing the OAuth process without any errors in the console? </p>",
        "id": 153862136,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481166990
    },
    {
        "content": "<p>I wonder whether <span class=\"user-mention\" data-user-id=\"191496\">@Nikolai Schwertner</span> has seen this behavior before (I can't say that I have). </p>",
        "id": 153862137,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481167022
    },
    {
        "content": "<p>Is it issuing an OPTIONS request first? </p>",
        "id": 153862138,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481167095
    },
    {
        "content": "<p>It is, yeah. Basically the same headers there too..</p>",
        "id": 153862142,
        "sender_full_name": "James Agnew",
        "timestamp": 1481168686
    },
    {
        "content": "<p>What exact headers does the OPTIONS request contain? </p>",
        "id": 153862145,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481170323
    },
    {
        "content": "<p><code>OPTIONS https://cdr.simpatico.ai:8000/Patient/118</code></p>\n<p>Request headers:</p>\n<div class=\"codehilite\"><pre>Host: cdr.simpatico.ai:8000\nUser-Agent: Mozilla/5.0 (X11; Ubuntu; Linux x86_64; rv:50.0) Gecko/20100101 Firefox/50.0\nAccept: text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8\nAccept-Language: en-US,en;q=0.5\nAccept-Encoding: gzip, deflate, br\nAccess-Control-Request-Method: GET\nAccess-Control-Request-Headers: content-type\norigin: https://fhir-dstu2.smarthealthit.org\nConnection: keep-alive\n</pre></div>\n\n\n<p>Response headers:</p>\n<div class=\"codehilite\"><pre>Access-Control-Allow-Credentials: true\nAccess-Control-Allow-Headers: content-type\nAccess-Control-Allow-Methods: GET,POST,PUT,DELETE,HEAD,OPTIONS\nAccess-Control-Allow-Origin: https://fhir-dstu2.smarthealthit.org\nCache-Control: no-cache, no-store, max-age=0, must-revalidate\nContent-Length: 0\nDate: Thu, 08 Dec 2016 03:40:03 GMT\nExpires: 0\nPragma: no-cache\nServer: Jetty(9.3.10.v20160621)\nVary: Origin\nX-Content-Type-Options: nosniff\nX-Frame-Options: DENY\nstrict-transport-security: max-age=31536000 ; includeSubDomains\nx-xss-protection: 1; mode=block\n</pre></div>",
        "id": 153862258,
        "sender_full_name": "James Agnew",
        "timestamp": 1481197003
    },
    {
        "content": "<p>Fascinating. You should see:</p>\n<p><strong>request</strong></p>\n<div class=\"codehilite\"><pre>Access-Control-Request-Headers: authorization, content-type\n</pre></div>\n\n\n<p><strong>response</strong></p>\n<div class=\"codehilite\"><pre>Access-Control-Allow-Headers: authorization, content-type\n</pre></div>",
        "id": 153862279,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481199103
    },
    {
        "content": "<p>I'm wondering if you could share more details about how you're launching the app, and which params you're passing?</p>\n<p>Following that, it might help to see the whole transcript (e.g. in Chrome Dev tools, via \"Save HAR with Content\")</p>",
        "id": 153862286,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1481199719
    },
    {
        "content": "<p>The Launch URL I've been using for testing is:<br>\n<a href=\"https://fhir-dstu2.smarthealthit.org/apps/growth-chart/launch.html?iss=https://cdr.simpatico.ai:8000&amp;launch=wd9833&amp;patientId=118\" target=\"_blank\" title=\"https://fhir-dstu2.smarthealthit.org/apps/growth-chart/launch.html?iss=https://cdr.simpatico.ai:8000&amp;launch=wd9833&amp;patientId=118\">https://fhir-dstu2.smarthealthit.org/apps/growth-chart/launch.html?iss=https://cdr.simpatico.ai:8000&amp;launch=wd9833&amp;patientId=118</a></p>\n<p>Username/password \"zulip\" if you happen to want to try it. I'll grab a capture though.</p>",
        "id": 153862377,
        "sender_full_name": "James Agnew",
        "timestamp": 1481222482
    }
]