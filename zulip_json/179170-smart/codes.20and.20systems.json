[
    {
        "content": "<p>Yesterday we talked a bit about what it means to have a scope like <code>patient/Observation.s?category=vital-signs</code> -- does this mean a client can query for category codings with <em>any</em> system and a code of <code>vital-signs</code>, or can servers interpret that scope as, effectively, meaning <code>patient/Observation.rs?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code>? In other words, can a server \"interpret a default\", and if so, should this be communicated back to the client? Here are my thoughts...</p>",
        "id": 209804478,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842263
    },
    {
        "content": "<ol>\n<li>US Core specifically <a href=\"https://www.hl7.org/fhir/us/core/vitals-search.html#mandatory-search-parameters\">documents queries</a> like <blockquote>\n<p>GET [base]/Observation?patient=[reference]&amp;category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</p>\n</blockquote>\n</li>\n</ol>\n<p>... which to me suggests we should be equally precise in most of our documentation. We shouldn't write <code>vital-signs</code> without a system as a shorthand to make things \"look pretty\".</p>",
        "id": 209804624,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842334
    },
    {
        "content": "<ol start=\"2\">\n<li>Since FHIR search supports queries like \"get me all Observations where the category code is <code>vital-signs</code>, regardless of system,\" our scope language should too -- but that doesn't mean we should encourage it.</li>\n</ol>",
        "id": 209804702,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842375
    },
    {
        "content": "<ol start=\"3\">\n<li>It's reasonable for a server to assume a default code, but this must be reflected back to to the client so the client can adjust its queries accordingly. In other words, the granted scopes should signal to a client \"here are things I'll allow you to query for\". So it'd be a mistake to tell the client that the scope <code>patient/Observation.s?category=vital-signs</code> was granted, if in fact only the narrower  <code>patient/Observation.s?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code> was granted. Why? It's a mistake to tell the client the \"shorter\" scope because the server could <em>reject</em> a query for <code>GET Observation?patient=[]&amp;category=vital-signs</code> as too broad, and the client would have no way to tell why.</li>\n</ol>",
        "id": 209804858,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842458
    },
    {
        "content": "<ol start=\"4\">\n<li>If a server does, in fact grant a fully-specified scope like <code>patient/Observation.s?category=http://terminology.hl7.org/CodeSystem/observation-category|vital-signs</code>, then it should <em>not</em> allow a query like \"GET Observation?patient=[]&amp;category=http://some-other-system|vital-signs`. </li>\n</ol>\n<p><code>*</code> currently <a href=\"https://smart.argo.run\">https://smart.argo.run</a> violates this expectation :-)</p>",
        "id": 209805166,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842610
    },
    {
        "content": "<p>I'd love to hear feedback from others on these points, either through thumbs up/down on the individual posts, or in discussion below :)</p>",
        "id": 209805208,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599842641
    },
    {
        "content": "<p>For 1., I'm less concerned about \"pretty\" than I am about scope size limits.  Especially if including multiple codes from a system, this will get quite large quite fast.</p>",
        "id": 209806299,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599843232
    },
    {
        "content": "<p>I think I agree with requiring system, but I also worry about size explosion.</p>",
        "id": 209806728,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599843459
    },
    {
        "content": "<p>Since category/type based queries are mostly gonna be scoped to the preferred or required coding system, could we invent a shorthand for it?</p>",
        "id": 209806854,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599843516
    },
    {
        "content": "<p>e.g. <code>patient/Observation.s?category=__preferred|vital-signs</code></p>",
        "id": 209807076,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599843610
    },
    {
        "content": "<p>I'm all for suggestions about how to \"have our cake and eat it too,\" but they get complex. In xml and the semantic web, the concept of a \"<a href=\"https://www.w3.org/TR/2010/NOTE-curie-20101216/\">curie</a>\" (compact URI) comes into play -- like, you can define prefixes. So we could say that <code>oc:</code> means <code>http://terminology.hl7.org/CodeSystem/observation-category</code> or whatever. This is different from assuming a default system, because it still allows the system to be blank.</p>",
        "id": 209807117,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599843631
    },
    {
        "content": "<p>Ooh, that's a neat trick Pascal.</p>",
        "id": 209807142,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599843642
    },
    {
        "content": "<p>Could maybe even be shorter, like <code>p</code>, because <code>p</code> is clearly not a URL <span aria-label=\"yum\" class=\"emoji emoji-1f60b\" role=\"img\" title=\"yum\">:yum:</span></p>",
        "id": 209807193,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599843675
    },
    {
        "content": "<p>Yup. Though <code>__</code> and <code>p</code> are both apparently FHIR uris in the limited sense that <a href=\"http://build.fhir.org/datatypes.html#uri\">they pass <code>Regex: \\S*</code></a> :p</p>",
        "id": 209807333,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599843733
    },
    {
        "content": "<p>Ah darn I never actually looked at that. But wow <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 209807449,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599843794
    },
    {
        "content": "<p>So assuming we have a \"ccurie\" (to coin a term: contextual compact URI) like <code>_</code> or whatever, we trade off a bit of processing complexity for some bytes in our scope expressions.</p>\n<p><strong>Do we agree that none of this comes into play at <em>query</em> time, like I can't ask for \"GET Observation?category=_|vital-signs\" ?</strong></p>",
        "id": 209807585,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599843857
    },
    {
        "content": "<p>(I kinda like <code>_</code> here, as the \"throwaway variable\" used in programming languages like swift, rust, etc. And you can't get shorter while still being explicit.)</p>",
        "id": 209807696,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599843928
    },
    {
        "content": "<p>ccurie â„¢ it is!<br>\nSo would it be <code>_:vital_signs</code> to align with curie or <code>_|vital_signs</code> for underscore to just mean the preferred or required system?<br>\nI think I'd like to also be able to query this way, but that would be a separate balloting question, I don't think we _have_ to be able to.</p>",
        "id": 209809157,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599844638
    },
    {
        "content": "<p>I was thinking just <code>_|vital-signs</code> in the scopes to align with FHIR query conventions</p>",
        "id": 209809231,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599844679
    },
    {
        "content": "<p>Yeah I like that too, but your query example above uses <code>_:</code></p>",
        "id": 209809308,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599844698
    },
    {
        "content": "<p>Fixed now! Thanks.</p>",
        "id": 209809337,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599844714
    },
    {
        "content": "<p>Ha, great, works for me!</p>",
        "id": 209809360,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599844728
    },
    {
        "content": "<p>(Now that takes us to the discussion about.... how do you know what's preferred? How does a server publish its contextual bindings? Does this mechanism only apply for value set bindings in the FHIR core spec, or can it be used in IG-specific ways? etc.)</p>",
        "id": 209809474,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599844787
    },
    {
        "content": "<p>Yeah good point. Obviously the easiest would be to just have it apply to preferred/required bindings in the core spec and disallow it for others, but this warrants discussion.</p>",
        "id": 209809704,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599844876
    }
]