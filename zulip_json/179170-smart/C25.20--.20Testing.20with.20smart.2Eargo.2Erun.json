[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191339\">@Pascal Pfiffner</span>  Can you share the authz request you're making that's resulting in a missing patient?</p>",
        "id": 209702504,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599768490
    },
    {
        "content": "<p>Also, the room is open right now if you want to debug in real-time.  Whova (and/or zoom) will let you screen share</p>",
        "id": 209702553,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599768527
    },
    {
        "content": "<p>\"the room\"? I'm a Whova noob.</p>",
        "id": 209702594,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599768554
    },
    {
        "content": "<p>Happy to do it real-time</p>",
        "id": 209702648,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599768584
    },
    {
        "content": "<p>In Whova: Agenda -&gt; Connectathon Tracks -&gt; View Session -&gt; Argonaut Granular Controls -&gt; View Details.  Will open the meeting</p>",
        "id": 209702735,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599768621
    },
    {
        "content": "<p>URL: <a href=\"https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir\">https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir</a></p>",
        "id": 209703439,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599769012
    },
    {
        "content": "<p><a href=\"https://smart.argo.run/v/r4/auth/authorize?client_id=client_id&amp;scope=launch/patient+patient/Immunization.r&amp;response_type=code&amp;redirect_uri=fhirtester://auth/callback&amp;aud=https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir&amp;state=AEEDB7A9431C\">https://smart.argo.run/v/r4/auth/authorize?client_id=client_id&amp;scope=launch/patient+patient/Immunization.r&amp;response_type=code&amp;redirect_uri=fhirtester://auth/callback&amp;aud=https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir&amp;state=AEEDB7A9431C</a></p>",
        "id": 209703620,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599769125
    },
    {
        "content": "<p>access token for <code>launch/patient</code> and <code>patient/Observation.r</code>:</p>\n<p>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuZWVkX3BhdGllbnRfYmFubmVyIjp0cnVlLCJzbWFydF9zdHlsZV91cmwiOiJodHRwczovL3NtYXJ0LmFyZ28ucnVuLy9zbWFydC1zdHlsZS5qc29uIiwicGF0aWVudCI6IjM3ZTk3ZWE1LWUyZGMtNDc3MC1iYjdkLTkzZDAyY2ZlYmIwYyIsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJzY29wZSI6ImxhdW5jaC9wYXRpZW50IHBhdGllbnQvT2JzZXJ2YXRpb24uciIsImNsaWVudF9pZCI6ImNsaWVudF9pZCIsImV4cGlyZXNfaW4iOjM2MDAsImlhdCI6MTU5OTc2OTU0NSwiZXhwIjoxNTk5NzczMTQ1fQ.-bLL73b7oZNcJaRJ4lywzzy1shrpLKMyGB12flzm0z0</p>",
        "id": 209704635,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599769630
    },
    {
        "content": "<p><a href=\"https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir/Observation\">https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir/Observation</a></p>",
        "id": 209704746,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599769686
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>curl -H &#39;Authorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuZWVkX3BhdGllbnRfYmFubmVyIjp0cnVlLCJzbWFydF9zdHlsZV91cmwiOiJodHRwczovL3NtYXJ0LmFyZ28ucnVuLy9zbWFydC1zdHlsZS5qc29uIiwicGF0aWVudCI6IjM3ZTk3ZWE1LWUyZGMtNDc3MC1iYjdkLTkzZDAyY2ZlYmIwYyIsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJzY29wZSI6ImxhdW5jaC9wYXRpZW50IHBhdGllbnQvT2JzZXJ2YXRpb24uciIsImNsaWVudF9pZCI6ImNsaWVudF9pZCIsImV4cGlyZXNfaW4iOjM2MDAsImlhdCI6MTU5OTc2OTU0NSwiZXhwIjoxNTk5NzczMTQ1fQ.-bLL73b7oZNcJaRJ4lywzzy1shrpLKMyGB12flzm0z0&#39;  \\\n&#39;https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/fhir/Observation&#39;\n</code></pre></div>\n\n\n<p>This gives me the expected error:</p>\n<blockquote>\n<p>{\"Error\": \"Request too wide for granted scopes\"}</p>\n</blockquote>",
        "id": 209704863,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599769761
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>GET https://smart.argo.run/v/r4/sim/eyJrIjoiMSIsImkiOiIxIiwiaiI6IjEiLCJiIjoiMzdlOTdlYTUtZTJkYy00NzcwLWJiN2QtOTNkMDJjZmViYjBjIn0/\nfhir/Observation?patient=37e97ea5-e2dc-4770-bb7d-93d02cfebb0c&amp;category=vital-signs\nAuthorization: Bearer eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuZWVkX3BhdGllbnRfYmFubmVyIjp0cnVlLCJzbWFydF9zdHlsZV91cmwiOiJodHRwczovL3NtYXJ0LmFyZ28ucnVuLy9zbWFydC1zdHlsZS5qc29uIiwicGF0aWVudCI6IjM3ZTk3ZWE1LWUyZGMtNDc3MC1iYjdkLTkzZDAyY2ZlYmIwYyIsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJzY29wZSI6ImxhdW5jaC9wYXRpZW50IHBhdGllbnQvT2JzZXJ2YXRpb24ucnM_Y2F0ZWdvcnk9dml0YWwtc2lnbnMiLCJjbGllbnRfaWQiOiJjbGllbnRfaWQiLCJleHBpcmVzX2luIjozNjAwLCJpYXQiOjE1OTk3NzE0NjEsImV4cCI6MTU5OTc3NTA2MX0.EvEEoB2GC-R_E86WNgHYIOANMrLOZt7S72SpWrQDxcA\nAccept: application/fhir+json\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code>{&quot;Error&quot;: &quot;Request too wide for granted scopes&quot;}\n</code></pre></div>\n\n\n<p><span aria-label=\"sad\" class=\"emoji emoji-2639\" role=\"img\" title=\"sad\">:sad:</span></p>",
        "id": 209708688,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599771731
    },
    {
        "content": "<p>I do have the <code>patient/Observation.rs?category=vital-signs</code> in that token, so this request should succeed I assume?</p>",
        "id": 209708729,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599771753
    },
    {
        "content": "<p>At a glance I agree <span class=\"user-mention\" data-user-id=\"191339\">@Pascal Pfiffner</span>, this looks wrong.</p>",
        "id": 209710148,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599772447
    },
    {
        "content": "<p>I'll also note <span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> with the testing app at <a href=\"https://smart.argo.run/granular/index.html?aud=https%3A%2F%2Fsmart.argo.run%2Fv%2Fr4%2Fsim%2FeyJrIjoiMSIsImoiOiIxIiwiYiI6IjE1NWQzZDgwLWYzZjAtNGIzOS05MjA3LTBkMTIyY2Y5NGExMSJ9%2Ffhir\">https://smart.argo.run/granular/index.html?aud=https%3A%2F%2Fsmart.argo.run%2Fv%2Fr4%2Fsim%2FeyJrIjoiMSIsImoiOiIxIiwiYiI6IjE1NWQzZDgwLWYzZjAtNGIzOS05MjA3LTBkMTIyY2Y5NGExMSJ9%2Ffhir</a> when I ask only for vital signs, it works... but I <em>can't</em> get it to even issue a query for \"all observation\" (in order to demonstrate a 403). Unchecking all the boxes is still creating a query with <code>?category=vital-signs</code>.</p>\n<p><a href=\"/user_uploads/10155/HlE6AtMmx7M7pm1ZuNmdDqnq/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/HlE6AtMmx7M7pm1ZuNmdDqnq/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/HlE6AtMmx7M7pm1ZuNmdDqnq/image.png\"></a></div>",
        "id": 209710281,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599772538
    },
    {
        "content": "<p>(Ah, this is specifically an issue if I ask for <code>Observation.crs?category=vital-signs</code>; if I drop the <code>c</code> and request a scope of  <code>Observation.rs?category=vital-signs</code>, the behavior is fine.)</p>",
        "id": 209710410,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599772602
    },
    {
        "content": "<p>re: Josh:  Ahh, filter duplication checking was leaving a non-element checked.  Fixed shortly.<br>\nre: Pascal: looking at that next</p>",
        "id": 209713765,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599774411
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191339\">@Pascal Pfiffner</span> , found the issue - you have just the id for the patient instead of <code>Patient/{id}</code> that I was using in testing.  I'll have a new version up shortly that handles both.</p>",
        "id": 209714942,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599775132
    },
    {
        "content": "<p>Oh as search param? Got it.</p>",
        "id": 209715201,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1599775269
    },
    {
        "content": "<p>Pushed - should be up in ~5 minutes</p>",
        "id": 209715415,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599775408
    },
    {
        "content": "<p>As a note - I removed the check forcing the auth header that we turned on earlier.. it ended up disabling the patient selector, etc.</p>",
        "id": 209715838,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599775682
    },
    {
        "content": "<p>I'm doing an update to the <span class=\"user-mention\" data-user-id=\"192710\">@Kenneth Myhra</span> starter EMR simulator (for windows based apps)<br>\n<a href=\"https://github.com/brianpos/smart-on-fhir\">https://github.com/brianpos/smart-on-fhir</a></p>",
        "id": 209808983,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1599844537
    },
    {
        "content": "<p>Cool!</p>",
        "id": 209809002,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599844553
    },
    {
        "content": "<p>The <code>access_token.payload</code> includes context <strong>inside</strong> the token.</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;need_patient_banner&quot;: true,\n  &quot;smart_style_url&quot;: &quot;https://smart.argo.run//smart-style.json&quot;,\n  &quot;patient&quot;: &quot;37e97ea5-e2dc-4770-bb7d-93d02cfebb0c&quot;,\n  &quot;token_type&quot;: &quot;bearer&quot;,\n  &quot;scope&quot;: &quot;launch/patient patient/Observation.r&quot;,\n  &quot;client_id&quot;: &quot;client_id&quot;,\n  &quot;expires_in&quot;: 3600,\n  &quot;iat&quot;: 1599769545,\n  &quot;exp&quot;: 1599773145\n}\n</code></pre></div>\n\n\n<p>I thought the launch context was supposed to be included in the <code>/token</code> response body, not in the <code>access_token</code> proper.</p>\n<p>Thread: <a href=\"#narrow/stream/179170-smart/topic/Smart.20Framework.20Supported.20by.20Patient.20Apps/near/207424774\">https://chat.fhir.org/#narrow/stream/179170-smart/topic/Smart.20Framework.20Supported.20by.20Patient.20Apps/near/207424774</a><br>\nDocs: <a href=\"http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#launch-context-arrives-with-your-access_token\">http://hl7.org/fhir/smart-app-launch/scopes-and-launch-context/index.html#launch-context-arrives-with-your-access_token</a></p>\n<div class=\"codehilite\"><pre><span></span><code>Launch context parameters come **alongside** the access token. They will appear as JSON parameters:\n{\n  access_token: &quot;secret-xyz&quot;,\n  patient: &quot;123&quot;,\n  ...\n}\n</code></pre></div>\n\n\n<p><span class=\"user-mention silent\" data-user-id=\"191339\">Pascal Pfiffner</span> <a href=\"#narrow/stream/179170-smart/topic/C25.20--.20Testing.20with.20smart.2Eargo.2Erun/near/209704635\">said</a>:</p>\n<blockquote>\n<p>access token for <code>launch/patient</code> and <code>patient/Observation.r</code>:</p>\n<p>eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJuZWVkX3BhdGllbnRfYmFubmVyIjp0cnVlLCJzbWFydF9zdHlsZV91cmwiOiJodHRwczovL3NtYXJ0LmFyZ28ucnVuLy9zbWFydC1zdHlsZS5qc29uIiwicGF0aWVudCI6IjM3ZTk3ZWE1LWUyZGMtNDc3MC1iYjdkLTkzZDAyY2ZlYmIwYyIsInRva2VuX3R5cGUiOiJiZWFyZXIiLCJzY29wZSI6ImxhdW5jaC9wYXRpZW50IHBhdGllbnQvT2JzZXJ2YXRpb24uciIsImNsaWVudF9pZCI6ImNsaWVudF9pZCIsImV4cGlyZXNfaW4iOjM2MDAsImlhdCI6MTU5OTc2OTU0NSwiZXhwIjoxNTk5NzczMTQ1fQ.-bLL73b7oZNcJaRJ4lywzzy1shrpLKMyGB12flzm0z0</p>\n</blockquote>",
        "id": 210161400,
        "sender_full_name": "Ryan Harrison",
        "timestamp": 1600191008
    }
]