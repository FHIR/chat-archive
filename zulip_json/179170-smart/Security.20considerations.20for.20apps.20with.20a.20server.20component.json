[
    {
        "content": "<p>I'm wondering if we should add more guidance to this <a href=\"http://www.hl7.org/fhir/smart-app-launch/best-practices.html#app-and-server-developers-should-consider-trade-offs-associated-with-confidential-vs-public-app-architectures\">best practices</a> section on choosing an app architecture (public vs confidential).</p>\n<p>My main concern is when an app that has both server and client components uses the public app profile, and specifically when they make their token endpoint request from their client-side.</p>\n<p>For this discussion, I'm assuming the app has a server-component for a reason, and is looking to secure access to it through a SMART app launch.</p>",
        "id": 276681129,
        "sender_full_name": "adam strickland",
        "timestamp": 1648243907
    },
    {
        "content": "<p>Broadly, I think there are 2 ways a server-based app COULD use the SMART spec.</p>",
        "id": 276681139,
        "sender_full_name": "adam strickland",
        "timestamp": 1648243914
    },
    {
        "content": "<p>A. Server-Side Token Request:</p>\n<ol>\n<li>The client-side component sends the authorization code to it's server-side</li>\n<li>The server-side component redeems the authorization code from the authz server</li>\n<li>The authz server grants access (or not) to the server-side</li>\n<li>The server-side component completes the initial request, granting a session token to the client-side<br>\n<a href=\"/user_uploads/10155/q13Ade2nIJS5WWYfJnk2f-bd/oauth-session-Server-Good.drawio.png\">oauth-session-Server-Good.drawio.png</a><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/q13Ade2nIJS5WWYfJnk2f-bd/oauth-session-Server-Good.drawio.png\" title=\"oauth-session-Server-Good.drawio.png\"><img src=\"/user_uploads/10155/q13Ade2nIJS5WWYfJnk2f-bd/oauth-session-Server-Good.drawio.png\"></a></div></li>\n</ol>",
        "id": 276681252,
        "sender_full_name": "adam strickland",
        "timestamp": 1648243994
    },
    {
        "content": "<p>B. Client-Side Token Request:</p>\n<ol>\n<li>The client side redeems the authorization code from the authz server</li>\n<li>The authz server grants access (or not) to the client-side</li>\n<li>The client-side uses the output of the grant in some request to the server-side</li>\n<li>The server-side grants a session token to the client-side based on that request<br>\n<a href=\"/user_uploads/10155/Eo1eUwQduyfPnC0xiRXq62Fr/oauth-session-Server-Bad.drawio.png\">oauth-session-Server-Bad.drawio.png</a><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Eo1eUwQduyfPnC0xiRXq62Fr/oauth-session-Server-Bad.drawio.png\" title=\"oauth-session-Server-Bad.drawio.png\"><img src=\"/user_uploads/10155/Eo1eUwQduyfPnC0xiRXq62Fr/oauth-session-Server-Bad.drawio.png\"></a></div></li>\n</ol>",
        "id": 276681272,
        "sender_full_name": "adam strickland",
        "timestamp": 1648244011
    },
    {
        "content": "<p>Is the second method fundamentally insecure? Are there any RFCs/OWASP best practices we could link out to? At the very least I think we should link out to the OWASP <a href=\"https://cheatsheetseries.owasp.org/cheatsheets/Session_Management_Cheat_Sheet.html\">session management cheat sheet</a>, since at some point a server-side app will need to secure it's client-side.</p>",
        "id": 276681282,
        "sender_full_name": "adam strickland",
        "timestamp": 1648244022
    },
    {
        "content": "<p>Wanted to note that I still think it's OK to send access tokens up to your client-side from the server, but that should be secured by having a session token in the first place.</p>",
        "id": 276681289,
        "sender_full_name": "adam strickland",
        "timestamp": 1648244027
    },
    {
        "content": "<p>It would help to lay out some of the specific threats you are concerned about. Certainly in some situations it is fine to have an access token present in your client. The circumstances you're talking about in terms of session management in your second scenario seem very specific; I'm not sure we would have useful things to say but pointing to OWASP best practices sounds fine.</p>",
        "id": 276690748,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1648250108
    }
]