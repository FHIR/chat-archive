[
    {
        "content": "<p>Configuring my client at <a href=\"http://fhir.epic.com\">fhir.epic.com</a>:</p>\n<p><a href=\"/user_uploads/10155/-bXySurklSgVCw_fFc_BIxO_/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/-bXySurklSgVCw_fFc_BIxO_/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/-bXySurklSgVCw_fFc_BIxO_/image.png\"></a></div><p>Do I need to provide a JWK if I'm also providing a JWKS URI, or is just <em>one</em> of these sufficient <span class=\"user-mention\" data-user-id=\"372206\">@adam strickland</span> ?</p>",
        "id": 267635149,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1641930500
    },
    {
        "content": "<p>Just one is sufficient</p>",
        "id": 267635184,
        "sender_full_name": "adam strickland",
        "timestamp": 1641930525
    },
    {
        "content": "<p>OK, I've successfully introspected a token!</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"err\">ac</span><span class=\"kc\">t</span><span class=\"err\">ive</span><span class=\"p\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"err\">scope</span><span class=\"p\">:</span> <span class=\"err\">'pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/AllergyI</span><span class=\"kc\">nt</span><span class=\"err\">olera</span><span class=\"kc\">n</span><span class=\"err\">ce.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/AllergyI</span><span class=\"kc\">nt</span><span class=\"err\">olera</span><span class=\"kc\">n</span><span class=\"err\">ce.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Bi</span><span class=\"kc\">nar</span><span class=\"err\">y.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Bi</span><span class=\"kc\">nar</span><span class=\"err\">y.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/CarePla</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/CarePla</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/CareTeam.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Co</span><span class=\"kc\">n</span><span class=\"err\">di</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Co</span><span class=\"kc\">n</span><span class=\"err\">di</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Device.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Device.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Diag</span><span class=\"kc\">n</span><span class=\"err\">os</span><span class=\"kc\">t</span><span class=\"err\">icRepor</span><span class=\"kc\">t</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Diag</span><span class=\"kc\">n</span><span class=\"err\">os</span><span class=\"kc\">t</span><span class=\"err\">icRepor</span><span class=\"kc\">t</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Docume</span><span class=\"kc\">nt</span><span class=\"err\">Re</span><span class=\"kc\">feren</span><span class=\"err\">ce.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Docume</span><span class=\"kc\">nt</span><span class=\"err\">Re</span><span class=\"kc\">feren</span><span class=\"err\">ce.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/E</span><span class=\"kc\">n</span><span class=\"err\">cou</span><span class=\"kc\">nter</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/E</span><span class=\"kc\">n</span><span class=\"err\">cou</span><span class=\"kc\">nter</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Goal.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Goal.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Immu</span><span class=\"kc\">n</span><span class=\"err\">iza</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Immu</span><span class=\"kc\">n</span><span class=\"err\">iza</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Loca</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Loca</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">Order.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">Reques</span><span class=\"kc\">t</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">Reques</span><span class=\"kc\">t</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Medica</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">S</span><span class=\"kc\">tate</span><span class=\"err\">me</span><span class=\"kc\">nt</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Observa</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Observa</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Orga</span><span class=\"kc\">n</span><span class=\"err\">iza</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Orga</span><span class=\"kc\">n</span><span class=\"err\">iza</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">n</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Prac</span><span class=\"kc\">t</span><span class=\"err\">i</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">ner</span><span class=\"err\">.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Prac</span><span class=\"kc\">t</span><span class=\"err\">i</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">ner</span><span class=\"err\">.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Prac</span><span class=\"kc\">t</span><span class=\"err\">i</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">ner</span><span class=\"err\">Role.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Prac</span><span class=\"kc\">t</span><span class=\"err\">i</span><span class=\"kc\">t</span><span class=\"err\">io</span><span class=\"kc\">ner</span><span class=\"err\">Role.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Procedure.Read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Procedure.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Prove</span><span class=\"kc\">nan</span><span class=\"err\">ce.read</span> <span class=\"err\">pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/Rela</span><span class=\"kc\">te</span><span class=\"err\">dPerso</span><span class=\"kc\">n</span><span class=\"err\">.Read</span> <span class=\"err\">lau</span><span class=\"kc\">n</span><span class=\"err\">ch/pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">'</span><span class=\"p\">,</span>\n  <span class=\"err\">clie</span><span class=\"kc\">nt</span><span class=\"err\">_id</span><span class=\"p\">:</span> <span class=\"err\">'</span><span class=\"mi\">077799</span><span class=\"err\">c</span><span class=\"mi\">7-667</span><span class=\"err\">d</span><span class=\"mi\">-47</span><span class=\"kc\">fe</span><span class=\"mi\">-</span><span class=\"err\">acec</span><span class=\"mi\">-</span><span class=\"err\">b</span><span class=\"mi\">0</span><span class=\"err\">ca</span><span class=\"mf\">0ee</span><span class=\"err\">d</span><span class=\"mi\">5</span><span class=\"err\">ad</span><span class=\"mi\">8</span><span class=\"err\">'</span><span class=\"p\">,</span>\n  <span class=\"err\">user</span><span class=\"kc\">na</span><span class=\"err\">me</span><span class=\"p\">:</span> <span class=\"err\">'FHIRJASON'</span><span class=\"p\">,</span>\n  <span class=\"err\">exp</span><span class=\"p\">:</span> <span class=\"mi\">1641935957</span><span class=\"p\">,</span>\n  <span class=\"err\">sub</span><span class=\"p\">:</span> <span class=\"err\">'h</span><span class=\"kc\">tt</span><span class=\"err\">ps</span><span class=\"p\">:</span><span class=\"err\">//</span><span class=\"kc\">f</span><span class=\"err\">hir.epic.com/i</span><span class=\"kc\">nter</span><span class=\"err\">co</span><span class=\"kc\">nne</span><span class=\"err\">c</span><span class=\"kc\">t</span><span class=\"mi\">-</span><span class=\"kc\">f</span><span class=\"err\">hir</span><span class=\"mi\">-</span><span class=\"err\">oau</span><span class=\"kc\">t</span><span class=\"err\">h/api/FHIR/R</span><span class=\"mi\">4</span><span class=\"err\">/Pa</span><span class=\"kc\">t</span><span class=\"err\">ie</span><span class=\"kc\">nt</span><span class=\"err\">/eD.LxhDyX</span><span class=\"mi\">35</span><span class=\"err\">T</span><span class=\"kc\">nt</span><span class=\"err\">F</span><span class=\"mi\">77</span><span class=\"err\">l</span><span class=\"mf\">7e</span><span class=\"kc\">t</span><span class=\"err\">UA</span><span class=\"mi\">3</span><span class=\"err\">'</span><span class=\"p\">,</span>\n  <span class=\"err\">iss</span><span class=\"p\">:</span> <span class=\"err\">'h</span><span class=\"kc\">tt</span><span class=\"err\">ps</span><span class=\"p\">:</span><span class=\"err\">//</span><span class=\"kc\">f</span><span class=\"err\">hir.epic.com/i</span><span class=\"kc\">nter</span><span class=\"err\">co</span><span class=\"kc\">nne</span><span class=\"err\">c</span><span class=\"kc\">t</span><span class=\"mi\">-</span><span class=\"kc\">f</span><span class=\"err\">hir</span><span class=\"mi\">-</span><span class=\"err\">oau</span><span class=\"kc\">t</span><span class=\"err\">h/oau</span><span class=\"kc\">t</span><span class=\"err\">h</span><span class=\"mi\">2</span><span class=\"err\">/</span><span class=\"kc\">t</span><span class=\"err\">oke</span><span class=\"kc\">n</span><span class=\"err\">'</span><span class=\"p\">,</span>\n  <span class=\"err\">j</span><span class=\"kc\">t</span><span class=\"err\">i</span><span class=\"p\">:</span> <span class=\"err\">'AD</span><span class=\"mi\">7</span><span class=\"err\">C</span><span class=\"mi\">197</span><span class=\"err\">B</span><span class=\"mi\">6</span><span class=\"err\">FA</span><span class=\"mi\">14</span><span class=\"err\">D</span><span class=\"mi\">4</span><span class=\"err\">F</span><span class=\"mf\">945E4</span><span class=\"err\">F</span><span class=\"mi\">233</span><span class=\"err\">BFAFA</span><span class=\"mi\">8</span><span class=\"err\">A'</span><span class=\"p\">,</span>\n  <span class=\"err\">epic_user_</span><span class=\"kc\">t</span><span class=\"err\">ype</span><span class=\"p\">:</span> <span class=\"err\">'WPR'</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n</div></div>\n<p>QQ <span class=\"user-mention\" data-user-id=\"372206\">@adam strickland</span>:  Scope suffixes for SMARTv1 should be lowercase, but I see a mixture of <code>Read</code> and <code>read</code> in this response -- is this a known issue?</p>",
        "id": 267639741,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1641932577
    },
    {
        "content": "<p>(Also we discussed offline: the response doesn't yet include the standardized <code>patient</code> property t, but I'm working around this with <code>sub</code> for now.)</p>",
        "id": 267639853,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1641932629
    },
    {
        "content": "<p>Hey Josh, yeah you'll see the mix of scope syntaxes if you have APIs of mixed FHIR versions chosen. We standardized the syntax for R4 (and maybe STU3?) but not DSTU2.</p>",
        "id": 267640128,
        "sender_full_name": "adam strickland",
        "timestamp": 1641932754
    },
    {
        "content": "<p>Here's the demo I've put together -- quick and dirty, but I had a chance to clean up the authz logic a bit: <a href=\"https://github.com/jmandel/smart-imaging-c10n-2022-01/tree/main/src\">https://github.com/jmandel/smart-imaging-c10n-2022-01/tree/main/src</a></p>\n<p>Main <em>showstopping</em> issue at this point is that the Epic MyChart approval screen has no way to prompt a user about whether they want to share imaging data. It'd be good to build out this support or some flexibility for Epic sites to add it as an extension within their own deployments.</p>",
        "id": 267767501,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1642012690
    },
    {
        "content": "<p>Hmm, one strange behavior I'm seeing when I try to use a Backend Services token to resolve information about the Patient and user (RelatedPerson) associated with a launch:</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Fetching \"RelatedPerson\" fails</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>curl https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/RelatedPerson/e7HX4h-dgVCK1nrPaxurPiNMmumY.H07djk.qfouVJKE3 <span class=\"se\">\\</span>\n -H <span class=\"s2\">\"Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOmZoaXIiLCJjbGllbnRfaWQiOiJlMjc0ODQ0NS03MmUzLTQxNjAtODAxMS0wZmE1MjZjNjE2YTUiLCJlcGljLmVjaSI6InVybjplcGljOk9wZW4uRXBpYy1jdXJyZW50IiwiZXBpYy5tZXRhZGF0YSI6IjhKR25rcDdxT3NyNkpZcWRiV004UExlSFg3Z2VJa3NWR25mM3RRaWo5bnF4ZXhXNjhfbFU4cGNnUGtFS0ZNbmtmVHZoc3ozNnUwWmdDWG5HUGY3bHdLVy1oZEx5c2ctbXh5YUlBeEhJVGxTaUk5TUpMZEw0TkRENDRPdnlvSW5aIiwiZXBpYy50b2tlbnR5cGUiOiJhY2Nlc3MiLCJleHAiOjE2NDIwMjMwMjIsImlhdCI6MTY0MjAxOTQyMiwiaXNzIjoidXJuOm9pZDpmaGlyIiwianRpIjoiMzVhZThlMjctYzc3Yi00MTNkLThjYTEtZGU1MWRlZWY5YjYxIiwibmJmIjoxNjQyMDE5NDIyLCJzdWIiOiJleGZvNkU0RVhqV3NuaEExT0dWRWxndzMifQ.fb8br2lWU8b2O8-EXAWzPEYHyjLgYqy9gNl8ooQ4D5h0SDG8v2n0skihNm7RbrZmN96dQ6ll0Aaj4W4wyH3eQpFj5UzIxkcboVJYHouBDY7FzTPukd3GMbHnyBqq9-moA4YRDsxnOssUNoMFBh8APzpf3Xf43eGYYiueyAnas7QMGMrjeWAzLMjkj6k7S1-ZfqTK2Y_qrJLbO0u6Uw7DRlEK784ORPH4dl4AqxlGVPgAjIm2m9hk0HDP9nRcUDFmvtzprNWVm6eYEhpgwpn0dKpxFeZlPxCNWH5NdbTZyfWPESVYJvn9x7QQlBa6pF9d5dx2gYErDOeTrnI95FmU3w\"</span>\n\n&lt;OperationOutcome <span class=\"nv\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">\"http://hl7.org/fhir\"</span>&gt;&lt;issue&gt;&lt;severity <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"fatal\"</span> /&gt;&lt;code <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"processing\"</span> /&gt;&lt;details&gt;&lt;coding&gt;&lt;system <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"urn:oid:1.2.840.114350.1.13.0.1.7.2.657369\"</span> /&gt;&lt;code <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"4118\"</span> /&gt;&lt;display <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"The authenticated user is not authorized to view the requested data.\"</span> /&gt;&lt;/coding&gt;&lt;text <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"The authenticated user is not authorized to view the requested data.\"</span> /&gt;&lt;/details&gt;&lt;/issue&gt;&lt;/OperationOutcome&gt;\n</code></pre></div>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Fetching \"Patient\" works</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>$ curl  https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Patient/evYS76EX6LLeCX2PlRLhvwg3 <span class=\"se\">\\</span>\n-H <span class=\"s2\">\"Authorization: Bearer eyJhbGciOiJSUzI1NiIsInR5cCI6IkpXVCJ9.eyJhdWQiOiJ1cm46b2lkOmZoaXIiLCJjbGllbnRfaWQiOiJlMjc0ODQ0NS03MmUzLTQxNjAtODAxMS0wZmE1MjZjNjE2YTUiLCJlcGljLmVjaSI6InVybjplcGljOk9wZW4uRXBpYy1jdXJyZW50IiwiZXBpYy5tZXRhZGF0YSI6IjhKR25rcDdxT3NyNkpZcWRiV004UExlSFg3Z2VJa3NWR25mM3RRaWo5bnF4ZXhXNjhfbFU4cGNnUGtFS0ZNbmtmVHZoc3ozNnUwWmdDWG5HUGY3bHdLVy1oZEx5c2ctbXh5YUlBeEhJVGxTaUk5TUpMZEw0TkRENDRPdnlvSW5aIiwiZXBpYy50b2tlbnR5cGUiOiJhY2Nlc3MiLCJleHAiOjE2NDIwMjMwMjIsImlhdCI6MTY0MjAxOTQyMiwiaXNzIjoidXJuOm9pZDpmaGlyIiwianRpIjoiMzVhZThlMjctYzc3Yi00MTNkLThjYTEtZGU1MWRlZWY5YjYxIiwibmJmIjoxNjQyMDE5NDIyLCJzdWIiOiJleGZvNkU0RVhqV3NuaEExT0dWRWxndzMifQ.fb8br2lWU8b2O8-EXAWzPEYHyjLgYqy9gNl8ooQ4D5h0SDG8v2n0skihNm7RbrZmN96dQ6ll0Aaj4W4wyH3eQpFj5UzIxkcboVJYHouBDY7FzTPukd3GMbHnyBqq9-moA4YRDsxnOssUNoMFBh8APzpf3Xf43eGYYiueyAnas7QMGMrjeWAzLMjkj6k7S1-ZfqTK2Y_qrJLbO0u6Uw7DRlEK784ORPH4dl4AqxlGVPgAjIm2m9hk0HDP9nRcUDFmvtzprNWVm6eYEhpgwpn0dKpxFeZlPxCNWH5NdbTZyfWPESVYJvn9x7QQlBa6pF9d5dx2gYErDOeTrnI95FmU3w\"</span>\n\n&lt;Patient <span class=\"nv\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">\"http://hl7.org/fhir\"</span>&gt;&lt;id <span class=\"nv\">value</span><span class=\"o\">=</span><span class=\"s2\">\"evYS76EX6LLeCX2PlRLhvwg3\"</span> /&gt; ...\n</code></pre></div>\n</div></div>\n<p><span class=\"user-mention\" data-user-id=\"372206\">@adam strickland</span>  my <a href=\"https://fhir.epic.com/Developer/Edit?appId=14972\">client scopes</a> include \"RelatedPerson.Read\" in the Epic client config</p>\n<p><a href=\"/user_uploads/10155/DqVPfl0l6vzsCDavIatAa-1F/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/DqVPfl0l6vzsCDavIatAa-1F/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/DqVPfl0l6vzsCDavIatAa-1F/image.png\"></a></div><p>Any idea about why I might be unauthoirzed?</p>",
        "id": 267782270,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1642019702
    },
    {
        "content": "<p>Hey Josh, I think this is a bug. I'll look into this now!</p>",
        "id": 267782369,
        "sender_full_name": "adam strickland",
        "timestamp": 1642019756
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191764\">@Cooper Thompson</span></p>",
        "id": 267782421,
        "sender_full_name": "adam strickland",
        "timestamp": 1642019768
    },
    {
        "content": "<p>Related context: if I get a backend services token and introspect <em>that</em></p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Introspecting my own backend services token</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<div class=\"codehilite\" data-code-language=\"JavaScript\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nx\">active</span><span class=\"o\">:</span> <span class=\"kc\">true</span><span class=\"p\">,</span>\n  <span class=\"nx\">scope</span><span class=\"o\">:</span> <span class=\"s1\">'system/AllergyIntolerance.Read system/AllergyIntolerance.read system/Binary.Read system/Binary.read system/CarePlan.Read system/CarePlan.read system/CareTeam.read system/Condition.Read system/Condition.read system/Device.Read system/Device.read system/DiagnosticReport.Read system/DiagnosticReport.read system/DocumentReference.Read system/DocumentReference.read system/Encounter.Read system/Encounter.read system/Goal.Read system/Goal.read system/Immunization.Read system/Immunization.read system/Location.Read system/Location.read system/Medication.Read system/Medication.read system/MedicationOrder.Read system/MedicationRequest.Read system/MedicationRequest.read system/MedicationStatement.Read system/Observation.Read system/Observation.read system/Organization.Read system/Organization.read system/Patient.Read system/Patient.read system/Practitioner.Read system/Practitioner.read system/PractitionerRole.Read system/PractitionerRole.read system/Procedure.Read system/Procedure.read system/Provenance.read system/RelatedPerson.Read'</span><span class=\"p\">,</span>\n  <span class=\"nx\">client_id</span><span class=\"o\">:</span> <span class=\"s1\">'e2748445-72e3-4160-8011-0fa526c616a5'</span><span class=\"p\">,</span>\n  <span class=\"nx\">username</span><span class=\"o\">:</span> <span class=\"s1\">'USCDIFHIR'</span><span class=\"p\">,</span>\n  <span class=\"nx\">exp</span><span class=\"o\">:</span> <span class=\"mf\">1642023435</span><span class=\"p\">,</span>\n  <span class=\"nx\">sub</span><span class=\"o\">:</span> <span class=\"s1\">'https://fhir.epic.com/interconnect-fhir-oauth/api/FHIR/R4/Practitioner/exfo6E4EXjWsnhA1OGVElgw3'</span><span class=\"p\">,</span>\n  <span class=\"nx\">iss</span><span class=\"o\">:</span> <span class=\"s1\">'https://fhir.epic.com/interconnect-fhir-oauth/oauth2/token'</span><span class=\"p\">,</span>\n  <span class=\"nx\">jti</span><span class=\"o\">:</span> <span class=\"s1\">'4AE6167F0BD443B8B691739F260AAEAE'</span><span class=\"p\">,</span>\n  <span class=\"nx\">epic_user_type</span><span class=\"o\">:</span> <span class=\"s1\">'EMP'</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n</div></div>\n<p>... is it expected that the <code>sub</code> for this token is a <em>Practitioner</em> with \"username\" of \"USCDIFHIR\"?</p>",
        "id": 267782809,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1642019942
    },
    {
        "content": "<p>Yep that’s expected. There is a background user associated with your client, and that’s the owner of your tokens</p>",
        "id": 267797730,
        "sender_full_name": "adam strickland",
        "timestamp": 1642027448
    }
]