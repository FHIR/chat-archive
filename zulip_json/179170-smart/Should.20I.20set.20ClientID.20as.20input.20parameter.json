[
    {
        "content": "<p>I am trying to setup one client to serve two Smart server. Because two servers provide two different clientIDs, my client need to pickup the correct clientID during the lanch process. I am thinking to add clientID into registered launch url. For example, the registered launch url looks like:</p>\n<div class=\"codehilite\"><pre><span></span>http://myserver.com/launch?clientID=1234\n</pre></div>\n\n\n<p>The actual launch request sent from SMART server would be:</p>\n<div class=\"codehilite\"><pre><span></span>http://myserver.com/launch?clientID=1234&amp;iss=smartserver.com\n</pre></div>\n\n\n<p>Technically, this should work. <br>\nIs there any problem from SMART spec?</p>",
        "id": 157536413,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549298626
    },
    {
        "content": "<p>The SMART EHR Launch specification provides an <code>iss</code> parameter that your app can you use to know which server is launching your app. The details of the client ID should be stored in your app itself, with the issuer parameter used by your app to perform a lookup.</p>",
        "id": 157536940,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549299024
    },
    {
        "content": "<p>you should avoid adding a new URL parameter because if your app depends this new parameter it will be incompatible with existing servers</p>",
        "id": 157536992,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549299084
    },
    {
        "content": "<blockquote>\n<p>you should avoid adding a new URL parameter because if your app depends this new parameter it will be incompatible with existing servers</p>\n</blockquote>\n<p>This can be resolved by using value from clientID parameter if exists  otherwise use value from server config.</p>\n<p>My most concern is  about this:</p>\n<blockquote>\n<p>The details of the client ID should be stored in your app itself, with the issuer parameter used by your app to perform a lookup</p>\n</blockquote>\n<p>What is the problem/drawback for exposing clientID? I first thought there were some security risks but anyone can get clientID by looking at the authorization request from launch page.<br>\nI just don't know if I missed anything during my analysis.</p>",
        "id": 157539961,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549301561
    },
    {
        "content": "<p>I don't see a security risk, but I don't understand what your goal would be in adding a new parameter like this. It will lead to poor compatibility of your app with the ecosystem, and on my assessment, it does not open up any new use cases beyond what you can accomplish simply by maintaining a map between issuer values and client ID values within your application.</p>",
        "id": 157541898,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549303246
    },
    {
        "content": "<p>It's possible I have missed something about what you are trying to accomplish or the constraints that you are working with.</p>",
        "id": 157541940,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549303285
    },
    {
        "content": "<p>And some servers may want you to have a secret with that client id?</p>",
        "id": 157590950,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1549355569
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> My client is a Angular client and it does not use client secret.<br>\n<span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> Here is my situation. I have an Angular app developed for one EHR and now I need to tune this app for second EHR. I have three options:<br>\n1) Use separate servers. Each server has its own environment configuration.<br>\n2) Use iss parameter to decide which server sends the request<br>\n3) Add client ID to server registration.</p>",
        "id": 157612682,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549379155
    },
    {
        "content": "<p>I'm not sure what you mean by (3).</p>",
        "id": 157612768,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549379215
    },
    {
        "content": "<p>That is what I mentioned in my first post. For example, my client registered launch URL is <a href=\"http://myserver.com/launch\" target=\"_blank\" title=\"http://myserver.com/launch\">http://myserver.com/launch</a>. I can add clientID as a url parameter to it and change the registered launch URL to <a href=\"http://myserver.com/launch?clientID=my-client-id\" target=\"_blank\" title=\"http://myserver.com/launch?clientID=my-client-id\">http://myserver.com/launch?clientID=my-client-id</a>. When launched from SMARTserver, the request sending to <a href=\"http://myserver.com\" target=\"_blank\" title=\"http://myserver.com\">myserver.com</a> would be <a href=\"http://myserver.com/launch?clientID=my-client-id&amp;iss=fhirserver.com\" target=\"_blank\" title=\"http://myserver.com/launch?clientID=my-client-id&amp;iss=fhirserver.com\">http://myserver.com/launch?clientID=my-client-id&amp;iss=fhirserver.com</a></p>",
        "id": 157613187,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549379586
    },
    {
        "content": "<p>What I'm confused about is that the client ID can be fully inferred (by the client), given the issuer value.</p>",
        "id": 157615423,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549381299
    },
    {
        "content": "<p>Is there some reason this isn't true in your case?</p>",
        "id": 157615436,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549381314
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 157621256,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549386191
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> When I check all my app registrations, I found that Cerner allows ONLY one pair of launch/redirect URLs per client registration. Since I have dev, qa, staging and prod servers, I have 4 client registrations on Cerner. So yes, one issuer could map to multiple client ids.</p>",
        "id": 157623454,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1549388002
    },
    {
        "content": "<p>Sure, but I think you're saying that your different environments have different redirect urls, which implies they are hosted at different locations. In this case, doesn't your production instance know that it is a production instance, and your development instance knows that it is a development since?</p>",
        "id": 157623751,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1549388215
    },
    {
        "content": "<p>Reading back through this again, and rechecking my understanding, is it the Auth server that allocates the Client ID, or does that \"depend\".<br>\nThe use case I'm struggling with is that will have thousands of on-prem PMS systems (primary care) that will be calling the smart app, (even if they are all the one vendor) and each one has their own issuer (the on prem server)...</p>",
        "id": 246548093,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1626761035
    },
    {
        "content": "<p>Servers assign client_ids. Of course, a server could have a strategy that reflects the job back onto the client (e.g., using a client domain name or client signed JWT as a client_id)-- but 1) that's pretty unusual, and 2) the server still is in charge, and needs to enforce whatever rules it sets</p>",
        "id": 246583516,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626787638
    },
    {
        "content": "<p>You can make registration work at scale using a convention for client IDs (as long as clients use asymmetric auth), or using dynamic registration (if clients need a symmetric secret).</p>",
        "id": 246583968,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1626787878
    }
]