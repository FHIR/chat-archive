[
    {
        "content": "<h1>The Issue</h1>\n<p>I have noticed that with a recent update of the FHIR Validator CapabilityStatements which list a <code>revoke</code> endpoint are now failing with the error:</p>\n<div class=\"codehilite\"><pre><span></span><code>FHIR Validation tool Version <span class=\"m\">5</span>.0.12 <span class=\"o\">(</span>Git# b770fb8a2c35<span class=\"o\">)</span>. Built <span class=\"m\">2020</span>-07-07T02:30:50.915Z <span class=\"o\">(</span><span class=\"m\">8</span> days old<span class=\"o\">)</span>\n...\n\nError @ CapabilityStatement.rest<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span>.security.extension<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span>.extension<span class=\"o\">[</span><span class=\"m\">2</span><span class=\"o\">][</span><span class=\"nv\">url</span><span class=\"o\">=</span><span class=\"s1\">&#39;revoke&#39;</span><span class=\"o\">]</span> <span class=\"o\">(</span>line <span class=\"m\">36</span>, col16<span class=\"o\">)</span> : Sub-extension url <span class=\"s2\">&quot;revoke&quot;</span> is not defined by the Extension http://fhir-registry.smarthealthit.org/StructureDefinition/oauthshell\n</code></pre></div>\n\n\n<p>When I rolled back and tried with the <code>5.0.8</code> version I don't see this error or any other errors on <code>CapabilityStatement.rest[0].security.extension[0]</code>!  I deleted my local <code>~/.fhir</code> cache before each run to get a fresh slate.</p>\n<hr>\n<h1>Background</h1>\n<p>The SMART Application Launch Framework Implementation Guide 1.0.0 shows <a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example\">this example</a> which includes <code>revoke</code> URLs:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;CapabilityStatement&quot;</span><span class=\"p\">,</span>\n<span class=\"err\">...</span>\n  <span class=\"nt\">&quot;rest&quot;</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n   <span class=\"err\">...</span>\n      <span class=\"nt\">&quot;security&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;service&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;coding&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;system&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/restful-security-service&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;SMART-on-FHIR&quot;</span>\n              <span class=\"p\">}</span>\n            <span class=\"p\">],</span>\n            <span class=\"nt\">&quot;text&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;OAuth2 using SMART-on-FHIR profile (see http://docs.smarthealthit.org)&quot;</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">],</span>\n        <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;token&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://my-server.org/token&quot;</span>\n              <span class=\"p\">},</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;authorize&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://my-server.org/authorize&quot;</span>\n              <span class=\"p\">},</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;manage&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://my-server.org/authorizations/manage&quot;</span>\n              <span class=\"p\">}</span>\n              <span class=\"p\">,</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;introspect&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://my-server.org/authorizations/introspect&quot;</span>\n              <span class=\"p\">},</span>\n              <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;revoke&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;valueUri&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://my-server.org/authorizations/revoke&quot;</span>\n              <span class=\"p\">}</span>\n            <span class=\"p\">]</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n</code></pre></div>\n\n\n<p><a href=\"http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html\">And the relevant extension that defines it (oauth-uris</a>.</p>\n<p>After doing some poking around I noticed that the <a href=\"https://www.hl7.org/fhir/extension-oauth-uris.html\">base FHIR Spec also has an extension with the same URL</a> (<a href=\"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\">http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris</a>), but is missing the revoke and introspect subextensions.  I do realize the SMART spec indicates the extension is for STU3, but its a little confusing as to which one is correct seeing that they both share the same extension URL and folks are still using the IG for R4.</p>\n<p>My guess is that the updated validator is using the base FHIR definition of the extension instead of the SMART version, but its still complete conjecture at this point.</p>\n<hr>\n<h1>Question</h1>\n<ul>\n<li>What is the right extension definition for: <a href=\"http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris\">http://fhir-registry.smarthealthit.org/StructureDefinition/oauth-uris</a><ul>\n<li>is it <a href=\"https://www.hl7.org/fhir/extension-oauth-uris.html\">https://www.hl7.org/fhir/extension-oauth-uris.html</a> or <a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example\">http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example</a></li>\n</ul>\n</li>\n</ul>\n<p>I'm not sure if there is an issue with the validator here, part of the spec, or I'm just overlooking something (which happens a lot!).  It seems like something is amiss here though...</p>\n<p><em>Relevant Artifacts:</em></p>\n<ul>\n<li><a href=\"/user_uploads/10155/libIqXJ3EJUlauH-DNHHoYOl/CapabilityStatement-with-revoke.json\"> Example CapabilityStatement-with-revoke.json for reproducing</a> </li>\n<li><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/releases/download/5.0.12/validator_cli.jar\">5.0.12 Validator Jar</a></li>\n<li><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/releases/download/5.0.7/validator_cli.jar\">5.0.8 Validator Jar</a></li>\n</ul>\n<p><em>References and Links:</em></p>\n<ul>\n<li><a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example\">SMART Extension Example</a></li>\n<li><a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#example\">SMART Extension Definition of OAuth URIs</a></li>\n<li><a href=\"https://www.hl7.org/fhir/extension-oauth-uris.html\">Base FHIR Extension Definition of OAuth URIs</a></li>\n</ul>",
        "id": 204019323,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1594851012
    },
    {
        "content": "<p>Testing again this morning the issue <em>seems</em> to be no longer occurring.  Not sure if this related to some other issues recently reported (<a href=\"#narrow/stream/179166-implementers/topic/Cardinalities.20differ.20between.20Simplifier.20and.20IG.20Publisher\">here</a> and <a href=\"#narrow/stream/179252-IG-creation/topic/hl7.2Efhir.2Epubpack.20error\">here</a>).</p>\n<p>Still interested in clarification between the two extension definitions though if anyone has any insight.</p>",
        "id": 204070884,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1594898502
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 204210580,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1594995245
    },
    {
        "content": "<p>I had an incorrect link in my original post.  To clarify:</p>\n<p>The two (different) extension definitions with the same URL are:</p>\n<ul>\n<li><a href=\"https://www.hl7.org/fhir/extension-oauth-uris.html\">https://www.hl7.org/fhir/extension-oauth-uris.html</a></li>\n<li><a href=\"http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html\">http://www.hl7.org/fhir/smart-app-launch/StructureDefinition-oauth-uris.html</a></li>\n</ul>\n<p>The base FHIR version does not define the <code>revoke</code> or <code>introspect</code> subextensions.</p>",
        "id": 204210756,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1594995349
    },
    {
        "content": "<p>The extension definition <em>should</em> provide a way to convey <code>revoke</code> and <code>introspect</code>. So from this perspective, the SMART IG is correct. I'm not sure why these extensions are repeated in the core FHIR release (it's... obviously an opportunity for things to get out of sync. <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> do you know how this linkage is established?)</p>",
        "id": 204236569,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1595008014
    },
    {
        "content": "<p>(Also as a quick reminder, we're moving toward <a href=\"http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#metadata\">http://www.hl7.org/fhir/smart-app-launch/conformance/index.html#metadata</a> in general;  over time the plan is to deprecate the CapabilityStatement-based discovery of these endpoints.)</p>",
        "id": 204236652,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1595008071
    },
    {
        "content": "<p>not sure</p>",
        "id": 204411760,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1595245083
    },
    {
        "content": "<p>OK -- for now we should be using the version from the SMART IT. (I submitted <a href=\"http://jira.hl7.org/browse/FHIR-28099\">FHIR#28099</a> to address the out-of-sync content in the core spec.)</p>",
        "id": 204434871,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1595257984
    }
]