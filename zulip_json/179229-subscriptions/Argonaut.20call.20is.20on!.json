[
    {
        "content": "<p>Argonaut subscriptions call is on!  (<a href=\"http://bit.ly/argo19-subscriptions\" target=\"_blank\" title=\"http://bit.ly/argo19-subscriptions\">http://bit.ly/argo19-subscriptions</a> has links/notes)</p>",
        "id": 183183579,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1576087569
    },
    {
        "content": "<p>For those on the call (or otherwise interested), the branch build finished.  Here are the links to the current <a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\" target=\"_blank\" title=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\">Subscription</a> and <a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptiontopic.html\" target=\"_blank\" title=\"http://build.fhir.org/branches/argonaut-subscription/subscriptiontopic.html\">SubscriptionTopic</a>.</p>\n<p>Please keep in mind they are WIP (pushed at time to attempt to have them for the call), but any and all feedback is greatly appreciated.</p>",
        "id": 183199326,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576096725
    },
    {
        "content": "<p>Hey Gino, I really like your WIP! I'm closely reading through it. Let me know if you'd prefer these comments as jira issues.</p>",
        "id": 183700785,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576623348
    },
    {
        "content": "<p>Do these two sentences contradict one another?<br>\n<code>Subscription resources are not intended to be secure storage for secrets (e.g., OAuth Client ID or Tokens, etc.). Implementers MAY use their judgement on including limited-use secrets (e.g., a token supplied in Subscription.channel.header to verify that a message is from the desired source).</code></p>\n<p>Further, you're effectively mandating that FHIR servers aren't able to decide if this is a feature they want to support, through this statement. FHIR Servers should be empowered to not support storing credentials in a Subscription resource (because it's poor practice and probably shouldn't be done at all). <br>\n<code>Each channel.header value SHALL be conveyed as an HTTP request header.</code></p>",
        "id": 183700862,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576623378
    },
    {
        "content": "<p><code>The subscriber then initiates a Web Socket connection to the server, at a URL advertised in the FHIR server's Capability statement (subscriptions/webSocketUrl (todo)). A simple protocol is used to listen for notifications:</code></p>\n<p>FHIRcast followed DICOMWeb here by returning the wss url in the Content-Location HTTP header of the response to a subscription request. (See <a href=\"https://github.com/HL7/fhircast-docs/pull/303\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/pull/303\">PR</a>). Note that this also enables the \"ticketing\" security approach, which also provides a mechanism for addressing the limited number of connection per wss url.</p>",
        "id": 183701377,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576623775
    },
    {
        "content": "<p>Thanks Isaac - that's exactly why I post them!<br>\nThat wasn't the intention, so I need to rework it.<br>\nThe language was supposed to call out that the Subscription resource (by default) is just like any other resource, so we don't want people assuming secrets are fine there (e.g., everyone who has access to the subscription resources can then impersonate the server to various third parties).  If servers DO want to implement secure storage, allow for limited-use secrets, or even just assume/pretend it's fine, that is up to them.</p>",
        "id": 183701580,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576623884
    },
    {
        "content": "<p>Is Handshake required to be supported by servers? </p>\n<p>There's no SHALL at <a href=\"https://build.fhir.org/subscription.html#handshake-notification\" target=\"_blank\" title=\"https://build.fhir.org/subscription.html#handshake-notification\">https://build.fhir.org/subscription.html#handshake-notification</a>, bu reading <a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html#errors\" target=\"_blank\" title=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html#errors\">http://build.fhir.org/branches/argonaut-subscription/subscription.html#errors</a>, it seems like a server is required to go through the requested -&gt; active status change.</p>",
        "id": 183701750,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624008
    },
    {
        "content": "<p>Is this:<br>\n<code>Servers implementing Subscriptions are responsible for complying with their policies on information logging. </code><br>\na sentence useful to implementers?</p>",
        "id": 183701800,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624055
    },
    {
        "content": "<p>For websockets, we're playing with that and some variations.  I haven't fleshed out the docs more on it yet, but there are some modifications being considered as well (e.g., can a single wss connection register multiple subscriptions).<br>\nOne thought is a generic endpoint, and using client messages to auth each subscription.  This gives the benefit that auth can be renewed/expired in the same session.</p>",
        "id": 183701891,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576624116
    },
    {
        "content": "<p>Re: <code>content-location</code> response headers, this is nice if the request is a websub request... but for a <code>POST Subscription</code> or <code>PUT Subscription/:id</code> request, does:</p>\n<blockquote>\n<p>\"Content-Location indicates the direct URL to use to access the resource, without further content negotiation in the future\"</p>\n</blockquote>\n<p>(from <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location#Examples\" target=\"_blank\" title=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Content-Location#Examples\">MDN docs</a>) fit the bill?</p>",
        "id": 183701905,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1576624128
    },
    {
        "content": "<p>Message Types.</p>\n<p>You've defined 5 different message types (Empty Notification, id-only Notification, full Notification, Heartbeat, Handshake) with distinct meanings and purposes; yet a subscriber is required to decipher the contents of the notification's <code>subscription-event-count</code> in order to determine what type they're receiving. It would be a lot cleaner to simply have another extension of notificationType, with the following values: Notification, Handshake, heartbeat</p>\n<p>Note that in your well-written examples, you've used the <a href=\"http://Bundle.id\" target=\"_blank\" title=\"http://Bundle.id\">Bundle.id</a> as a shorthand for your own convenience, to do exactly this.</p>",
        "id": 183701996,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624197
    },
    {
        "content": "<p>I feel like it's a little bit off; might think about modeling a web socket URL as a property of <code>SubscriptionStatus</code>, or a bunch of other options Gino's looking intto.</p>",
        "id": 183702051,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1576624212
    },
    {
        "content": "<p>I believe the Handshake was left as optional for servers, but clients need to support/ignore it (same with Heartbeat messages).  I'll go through my notes to check and make sure it's clearer in the docs.</p>",
        "id": 183702060,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576624225
    },
    {
        "content": "<blockquote>\n<p>Message Types.</p>\n<p>You've defined 5 different message types (Empty Notification, id-only Notification, full Notification, Heartbeat, Handshake) with distinct meanings and purposes; yet a subscriber is required to decipher the contents of the notification's <code>subscription-event-count</code> in order to determine what type they're receiving. It would be a lot cleaner to simply have another extension of notificationType, with the following values: Notification, Handshake, heartbeat</p>\n<p>Note that in your well-written examples, you've used the <a href=\"http://Bundle.id\" target=\"_blank\" title=\"http://Bundle.id\">Bundle.id</a> as a shorthand for your own convenience, to do exactly this.</p>\n</blockquote>\n<p>I like this.  Part of the issue was the number of extensions we were creating, but since we're breaking all those fields out into a new resource (I believe <code>SubscriptionStatus</code> is winning), it isn't so bad.</p>",
        "id": 183702235,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576624382
    },
    {
        "content": "<p>&lt;retracted&gt; Gino'd already fixed this! My oversight.</p>",
        "id": 183702249,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624395
    },
    {
        "content": "<p>In particular, by setting the type to <code>heartbeat</code> or <code>handshake</code>, various fields can be left out entirely without worry.</p>",
        "id": 183702273,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576624421
    },
    {
        "content": "<p><code>email: Notifications are sent via SMTP/S, S/MIME, or Direct to the Subscription.channel.endpoint email URI (e.g., mailto:...)</code></p>\n<p>Note that Direct supports two comm protocols: SMTP and IHE XDR (which is SOAP+ebXML+IHE). Do you intend for XDR to be a supported messaging <br>\n channel within <code>email</code>? I don't think that you do. You should clarify for Direct over SMTP to be supported and not Direct over  IHE XDR/XDM.</p>",
        "id": 183702384,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624548
    },
    {
        "content": "<blockquote>\n<ol>\n<li>You should clarify for handshake (just as you do for heartbeat) that handshake doesn't \"incrementing the subscription event count.\"</li>\n</ol>\n</blockquote>\n<p>Hmm.. I thought it did, but it looks like it got missed.  Good catch!</p>\n<blockquote>\n<ol start=\"2\">\n<li>I'm still not 100% certain if a notification's <code>subscription-event-count</code> should be incremented to account for entries included in that notification.</li>\n</ol>\n</blockquote>\n<p>OK, needs more clarification.  The relevant part there is in 2.46.6.4:</p>\n<blockquote>\n<p>The subscription-event-count extension indicates the number of unique events that have triggered notification attempts on this Subscription PRIOR to the current notification being sent.</p>\n</blockquote>",
        "id": 183702501,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576624670
    },
    {
        "content": "<p>Gino - my bad, you're right! I'd written that feedback against the <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> version and missed that you'd already updated it. Great work!</p>",
        "id": 183702667,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624801
    },
    {
        "content": "<p>I'd encourage you to explain the rationale for including <code>eventCount</code> in the Subscription resource, as well as the notification, in the new \"Managing Subscriptions and Error\" section. (e.g. a client may query the subscription resource to validate that it has/has not missed a notification ... ).</p>",
        "id": 183702745,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624847
    },
    {
        "content": "<p>Relation to FHIRcast</p>\n<p>Would you consider adding an additional bullet like this:</p>\n<ul>\n<li>FHIRcast synchronizes a user's session by communicating that a UI event occurred, such as a patient chart being opened or closed. Subscriptions communicates clinical or business events or changes in data, such as a patient admit. </li>\n</ul>\n<p><code>FHIRcast is a HTTP-based framework</code><br>\nWe're adding websocket support in February, so HTTP isn't entirely accurate. </p>\n<p><code>FHIRcast is designed to be used by multiple applications on the same device. Subscriptions are designed to be used by multiple distinct systems</code><br>\nWhat about something like this: <br>\n<code>FHIRcast is designed to be used by multiple applications perhaps with the same user and typically on the same device. Subscriptions are designed to be used by multiple distinct systems, often outside of a workflow.</code></p>",
        "id": 183702899,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576624958
    },
    {
        "content": "<p>Typos</p>\n<p><code>will result in higher computational costs on the server (e.g., processing queries when there are no state changes).</code><br>\nI don't think you should say \"will result in\", I think that  \"may result in\" would be correct.</p>\n<p>Three misspellings:</p>\n<ul>\n<li>Sercurity</li>\n<li>notificaiton </li>\n<li>alwayhs</li>\n</ul>",
        "id": 183703071,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576625067
    },
    {
        "content": "<p>re: FHIRCast, sounds good to me.  My goal is to clearly convey what's the same and what's different so that people know which tool is better for their use.  If there's anything additional that could be useful to include there, please let me know - my understanding of FHIRCast is based on reading the specs as I worked on various presentations  =)</p>",
        "id": 183703494,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576625348
    },
    {
        "content": "<p>blah, why doesn't VS code spell check my random text in XML docs?</p>",
        "id": 183704032,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576625760
    },
    {
        "content": "<p>Gino, the example for SubscriptionTopic describes using Group as a filter in the documentation element, but there isn't actually a corresponding canFilterBy: </p>\n<blockquote>\n<div class=\"codehilite\"><pre><span></span> &quot;documentation&quot;: &quot;Matching based on the Patient (subject) of an Encounter .&quot;\n</pre></div>\n\n\n</blockquote>\n<p>Is something like this correct?</p>\n<div class=\"codehilite\"><pre><span></span>  &quot;canFilterBy&quot;: [\n    {\n      &quot;searchParamName&quot;: &quot;patient&quot;,\n      &quot;matchType&quot;: [\n        &quot;=&quot;,\n        &quot;in&quot;,\n        &quot;not-in&quot;\n      ],\n      &quot;documentation&quot;: &quot;Matching based on the Patient&#39;s group membership (in/not-in).&quot;\n    },\n    {\n      &quot;searchParamName&quot;: &quot;group&quot;,\n      &quot;matchType&quot;: [\n        &quot;in&quot;,\n        &quot;not-in&quot;\n      ],\n      &quot;documentation&quot;: &quot;Matching based on the Patient (subject) of an Encounter or based on the Patient&#39;s group membership (in/not-in).&quot;\n    }\n  ]\n</pre></div>",
        "id": 183772897,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576691394
    },
    {
        "content": "<p>The version on the site works because of R5 changes to the <code>:in</code> modifier per <a href=\"http://jira.hl7.org/browse/FHIR-22690\" target=\"_blank\" title=\"http://jira.hl7.org/browse/FHIR-22690\">J#22690</a> .  I don't think it's been completed, but it was approved and we built up the examples and reference implementation assuming it.</p>\n<p>The issue with what you propose is that it requires implicit knowledge on mapping Encounter.subject (when Patient) as the member of a Group.  One of the goals was to make these work generically (e.g., computably defined SubscriptionTopics can be added to a server which supports them).</p>\n<p>On the flip side, discussions around this were wary of allowing too much in the filters, since they should be lightweight (more complex interactions can be covered in SubscriptionTopics).</p>\n<p>Thoughts?</p>",
        "id": 183774836,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576692603
    },
    {
        "content": "<blockquote>\n<p>discussions around this were wary of allowing too much in the filters, since they should be lightweight (more complex interactions can be covered in SubscriptionTopics).</p>\n</blockquote>\n<p>Makes sense, Gino. What would a SubscriptionTopic for an admission on a patient who belonged to a group look like?</p>",
        "id": 183776838,
        "sender_full_name": "Isaac Vetter",
        "timestamp": 1576693818
    },
    {
        "content": "<p>Hmm.. good point.  I'll have to think on this a bit.</p>",
        "id": 183786097,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576699970
    },
    {
        "content": "<p>Ok, got my head straight now.  First, definitely need better documentation around this  <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span> </p>\n<p>Moving on, the field <code>searchParamName</code> was renamed from <code>name</code>, but after discussions here I'm thinking about changing it again (sigh) to <code>searchParameter</code> since that is much clearer about what it is.</p>\n<p>To use your example of searching for group membership before/without <code>:in</code>:</p>\n<div class=\"codehilite\"><pre><span></span>  &quot;canFilterBy&quot;: [\n    {\n      &quot;searchParamName&quot;: &quot;patient&quot;,\n      &quot;matchType&quot;: [\n        &quot;=&quot;,\n      ],\n      &quot;documentation&quot;: &quot;Matching based on &#39;patient&#39; reference (Encounter.subject, where subject is of type Patient).&quot;\n    },\n    {\n      &quot;searchParamName&quot;: &quot;patient._has:Group:member:_id&quot;,\n      &quot;matchType&quot;: [\n        &quot;=&quot;,\n      ],\n      &quot;documentation&quot;: &quot;Matching based on the &#39;patient&#39; reference existing in a group by unique id.&quot;\n    }\n  ]\n</pre></div>\n\n\n<p>Essentially, <code>searchParamName</code> is the left-hand-side of a search KVP.  So, you could also have values like <code>patient.birthdate</code>, <code>patient.name</code>, etc.  The Group membership query looked particularly ugly, which is why we asked for the <code>:in</code> modifier changes in <a href=\"http://jira.hl7.org/browse/FHIR-22690\" target=\"_blank\" title=\"http://jira.hl7.org/browse/FHIR-22690\">J#22690</a> (and people wanted to support it without worrying about generic<code>_has</code> support).</p>\n<p>To clean up from what I was commenting on earlier - implementers wanted to reuse search tooling, but not be committed to things like <code>_include</code> or complicated and/or queries.</p>\n<p>Does that make sense?</p>",
        "id": 183789991,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576702983
    },
    {
        "content": "<p>an aside: <a href=\"https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering\" target=\"_blank\" title=\"https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering\">https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering</a> - Don't know if there are any lessons for us there</p>",
        "id": 183885482,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1576789748
    },
    {
        "content": "<blockquote>\n<p>an aside: <a href=\"https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering\" target=\"_blank\" title=\"https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering\">https://www.tbray.org/ongoing/When/201x/2019/12/18/Content-based-filtering</a> - Don't know if there are any lessons for us there</p>\n</blockquote>\n<p>That's interesting.   If I'm reading correctly, the argument is that basing the filtering off the output format decouples it from the source events.  Makes the filtering more generic, but requires servers to change where they do it (e.g., generate the output for the event, then filter).  Novel.</p>\n<p>In general, we have tried to avoid adding another type of search/filter language into FHIR though.</p>",
        "id": 183889084,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576792529
    },
    {
        "content": "<p>out is related to source events of course. And there's benefit in filtering based on things you don't see.</p>",
        "id": 183889583,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1576792872
    },
    {
        "content": "<p>Yep.  I do like how it changes the conversation into events in isolation and what can be done in that context.<br>\nNobody would suggest searching a data store based on evaluated JSON object comparisons, but if you are only looking at one event it's possible.</p>",
        "id": 183889845,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1576793002
    }
]