[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span> What's the base address for this server?</p>",
        "id": 209653565,
        "sender_full_name": "David deRoode",
        "timestamp": 1599748338
    },
    {
        "content": "<p>For R4: <a href=\"https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/\">https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/</a></p>\n<p>For R5: <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/</a></p>",
        "id": 209655855,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599748951
    },
    {
        "content": "<p>Thanks</p>",
        "id": 209655901,
        "sender_full_name": "David deRoode",
        "timestamp": 1599748980
    },
    {
        "content": "<p>You can see the supported topics by making a GET to</p>\n<p>(R5) <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic</a><br>\n(R4) <a href=\"https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/$topic-list\">https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/$topic-list</a></p>",
        "id": 209656587,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599749205
    },
    {
        "content": "<p>Getting a 403 Forbidden when GETting both from r4 and r5. Anything beyond Accept application/fhir+json?</p>",
        "id": 209662130,
        "sender_full_name": "David deRoode",
        "timestamp": 1599751099
    },
    {
        "content": "<p>I don't think there should be.  Can you provide the X-Request-Id from the response headers?  I can take a look in the logs to see what's going on.</p>",
        "id": 209663212,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599751494
    },
    {
        "content": "<p>CovbadAFkf41B_0jNYpnKDpnLwQYByRmZ0TMy9zUhGrrrttcQoYEPQ==</p>",
        "id": 209663310,
        "sender_full_name": "David deRoode",
        "timestamp": 1599751547
    },
    {
        "content": "<p>If you've got it handy, can you post the request URL?</p>",
        "id": 209664919,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599752155
    },
    {
        "content": "<p>I think it was this one: <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/d6340e59-1ec9-4b12-8979-eaba2def73da\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/d6340e59-1ec9-4b12-8979-eaba2def73da</a></p>",
        "id": 209665082,
        "sender_full_name": "David deRoode",
        "timestamp": 1599752209
    },
    {
        "content": "<p>I've tried quite a few GETs and POSTs (using Postman) over the hour, following what I thought was exemplified in Git, but no luck...always this error</p>",
        "id": 209665651,
        "sender_full_name": "David deRoode",
        "timestamp": 1599752436
    },
    {
        "content": "<p>So the subscription id above points to an R4 subscription.  I'm able to get back a subscription with:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request GET &#39;https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/d6340e59-1ec9-4b12-8979-eaba2def73da&#39; \\\n--header &#39;Accept: application/json&#39;\n</code></pre></div>",
        "id": 209666233,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599752658
    },
    {
        "content": "<p>Right now the R4/R5 Subscriptions are separated so if you create a subscription via R4 then it must be retrieved through R4.</p>",
        "id": 209666321,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599752701
    },
    {
        "content": "<p>Looks like there have been a couple of R5 Subscriptions created.  You can see all the R5 Subscriptions via search:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request GET &#39;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription&#39; \\\n--header &#39;Accept: application/json&#39;\n</code></pre></div>\n\n\n<p>Search support is currently R5 only.</p>",
        "id": 209666805,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599752897
    },
    {
        "content": "<p>Ahh ok, that clarifies it. Thanks. For R5 though, should't GET from \"<a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic</a>\" return a list of all SubscriptionTopics that I am allowed to subscribe to?</p>",
        "id": 209667380,
        "sender_full_name": "David deRoode",
        "timestamp": 1599753135
    },
    {
        "content": "<p>Request ID: W9bvC8SoBjQeRPihA_wTbEIpwuqik2jWTNGK0kLbXpZ7ct2Nr-b25Q==</p>",
        "id": 209667415,
        "sender_full_name": "David deRoode",
        "timestamp": 1599753147
    },
    {
        "content": "<p>Yeah, it should.  Is that where you're seeing the 403?  For me,</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request GET &#39;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic&#39; \\\n--header &#39;Accept: application/json&#39;\n</code></pre></div>\n\n\n<p>Returns the response:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Bundle&quot;,\n    &quot;id&quot;: &quot;d4ba92f4-f736-4e76-8374-9b6a36af7346&quot;,\n    &quot;type&quot;: &quot;searchset&quot;,\n    &quot;total&quot;: 2,\n    &quot;link&quot;: [\n        {\n            &quot;relation&quot;: &quot;self&quot;,\n            &quot;url&quot;: &quot;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic?&quot;\n        }\n    ],\n    &quot;entry&quot;: [\n        {\n            &quot;fullUrl&quot;: &quot;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic/admission&quot;,\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;SubscriptionTopic&quot;,\n                &quot;id&quot;: &quot;admission&quot;,\n                &quot;meta&quot;: {\n                    &quot;versionId&quot;: &quot;1&quot;,\n                    &quot;lastUpdated&quot;: &quot;2020-02-02T00:00:00.000Z&quot;\n                },\n                &quot;url&quot;: &quot;http://argonautproject.org/subscription-ig/SubscriptionTopic/admission&quot;,\n                &quot;version&quot;: &quot;0.4&quot;,\n                &quot;title&quot;: &quot;admission&quot;,\n                &quot;status&quot;: &quot;draft&quot;,\n                &quot;experimental&quot;: true,\n                &quot;date&quot;: &quot;2019-09-05&quot;,\n                &quot;description&quot;: &quot;Admission Topic for testing framework and behavior&quot;,\n                &quot;resourceTrigger&quot;: {\n                    &quot;description&quot;: &quot;Beginning of a clinical encounter&quot;,\n                    &quot;resourceType&quot;: [\n                        &quot;Encounter&quot;\n                    ],\n                    &quot;queryCriteria&quot;: {\n                        &quot;previous&quot;: &quot;status:not=in-progress&quot;,\n                        &quot;current&quot;: &quot;status:in-progress&quot;,\n                        &quot;requireBoth&quot;: true\n                    }\n                },\n                &quot;canFilterBy&quot;: [\n                    {\n                        &quot;searchParamName&quot;: &quot;patient&quot;,\n                        &quot;searchModifier&quot;: [\n                            &quot;=&quot;,\n                            &quot;in&quot;\n                        ],\n                        &quot;documentation&quot;: &quot;Exact match to a patient resource (reference)&quot;\n                    }\n                ]\n            }\n        },\n        {\n            &quot;fullUrl&quot;: &quot;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/SubscriptionTopic/labs&quot;,\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;SubscriptionTopic&quot;,\n                &quot;id&quot;: &quot;labs&quot;,\n                &quot;meta&quot;: {\n                    &quot;versionId&quot;: &quot;1&quot;,\n                    &quot;lastUpdated&quot;: &quot;2020-02-02T00:00:00.000Z&quot;\n                },\n                &quot;url&quot;: &quot;http://fhir.cerner.com/SubscriptionTopic/labs&quot;,\n                &quot;version&quot;: &quot;0.4&quot;,\n                &quot;title&quot;: &quot;admission&quot;,\n                &quot;status&quot;: &quot;draft&quot;,\n                &quot;experimental&quot;: true,\n                &quot;date&quot;: &quot;2019-09-05&quot;,\n                &quot;description&quot;: &quot;Laboratory Observations topic for testing&quot;,\n                &quot;resourceTrigger&quot;: {\n                    &quot;description&quot;: &quot;New and updated patient laboratory observations&quot;,\n                    &quot;resourceType&quot;: [\n                        &quot;Observation&quot;\n                    ],\n                    &quot;methodCriteria&quot;: [\n                        &quot;create&quot;,\n                        &quot;update&quot;\n                    ],\n                    &quot;queryCriteria&quot;: {\n                        &quot;previous&quot;: &quot;category:laboratory&quot;,\n                        &quot;current&quot;: &quot;category:laboratory&quot;,\n                        &quot;requireBoth&quot;: false\n                    }\n                },\n                &quot;canFilterBy&quot;: [\n                    {\n                        &quot;searchParamName&quot;: &quot;patient&quot;,\n                        &quot;searchModifier&quot;: [\n                            &quot;=&quot;,\n                            &quot;in&quot;\n                        ],\n                        &quot;documentation&quot;: &quot;Exact match to a patient resource (reference)&quot;\n                    }\n                ]\n            }\n        }\n    ]\n}\n</code></pre></div>",
        "id": 209668075,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599753384
    },
    {
        "content": "<p>Yes (this feels like a permissions thing); for me, <a href=\"/user_uploads/10155/nJf3N528htuOVToLRH559ivc/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/nJf3N528htuOVToLRH559ivc/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/nJf3N528htuOVToLRH559ivc/image.png\"></a></div>",
        "id": 209668488,
        "sender_full_name": "David deRoode",
        "timestamp": 1599753545
    },
    {
        "content": "<p>Yeah, agreed.  Looking into this.  Is the issue specific to SubscriptionTopic or are you seeing the same thing for Subscription as well?</p>",
        "id": 209668879,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599753694
    },
    {
        "content": "<p>Same for Subscription as well</p>",
        "id": 209669102,
        "sender_full_name": "David deRoode",
        "timestamp": 1599753772
    },
    {
        "content": "<p>Are you sending a body with the GET request?  I think that may be the issue. I'm able to recreate something similar to your postman screenshot if I provide a body.</p>",
        "id": 209669591,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599753980
    },
    {
        "content": "<p>Bingo. I assumed GET bodies were ignored, but returning a bundle now. Thanks for your help</p>",
        "id": 209670184,
        "sender_full_name": "David deRoode",
        "timestamp": 1599754255
    },
    {
        "content": "<p>No prob.  Sorry for the extremely unhelpful error page <span aria-label=\"grinning face with smiling eyes\" class=\"emoji emoji-1f601\" role=\"img\" title=\"grinning face with smiling eyes\">:grinning_face_with_smiling_eyes:</span></p>",
        "id": 209670414,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599754353
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span>  Trying to post a subscription to <a href=\"https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription\">https://fhir-open.stagingcerner.com/beta/r4/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription</a> and getting the following error back:  \"Expected to include: <a href=\"http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-topic-canonical\">http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-topic-canonical</a>\"</p>\n<p>I think it should be looking for \"<a href=\"http://hl7.org/fhir/**uv**/subscriptions-backport/StructureDefinition/backport-topic-canonical\">http://hl7.org/fhir/**uv**/subscriptions-backport/StructureDefinition/backport-topic-canonical</a>\"</p>",
        "id": 209681466,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599759236
    },
    {
        "content": "<p>Yep, I believe you're correct:</p>\n<p><a href=\"http://build.fhir.org/ig/HL7/fhir-subscription-backport-ig/StructureDefinition-backport-topic-canonical.html\">http://build.fhir.org/ig/HL7/fhir-subscription-backport-ig/StructureDefinition-backport-topic-canonical.html</a></p>\n<p>I'll get together a fix and push it out.</p>",
        "id": 209682184,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599759568
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> , I think the argo test client needs an update too.  It's sending the extension in the POST body as:</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-topic-canonical&quot;,\n      &quot;valueCanonical&quot;: &quot;http://argonautproject.org/subscription-ig/SubscriptionTopic/admission&quot;\n    }\n  ]\n</code></pre></div>",
        "id": 209682485,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599759694
    },
    {
        "content": "<p>Actually, I see /us/ being used throughout the POST body:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Subscription&quot;,\n  &quot;end&quot;: &quot;2020-09-10T18:36:23.391Z&quot;,\n  &quot;reason&quot;: &quot;Client Testing&quot;,\n  &quot;channel&quot;: {\n    &quot;endpoint&quot;: &quot;https://client.subscriptions.argo.run/Endpoints/0860ace4-a750-45d5-a615-91f37c9f94f9&quot;,\n    &quot;payload&quot;: &quot;application/fhir+json&quot;,\n    &quot;_payload&quot;: {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-payload-content&quot;,\n          &quot;valueCode&quot;: &quot;id-only&quot;\n        }\n      ]\n    },\n    &quot;type&quot;: &quot;rest-hook&quot;,\n    &quot;extension&quot;: [\n      {\n        &quot;url&quot;: &quot;http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-heartbeat-period&quot;,\n        &quot;valueUnsignedInt&quot;: 60\n      }\n    ]\n  },\n  &quot;status&quot;: &quot;requested&quot;,\n  &quot;criteria&quot;: &quot;Encounter?patient=1316024&quot;,\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/us/subscriptions-backport/StructureDefinition/backport-topic-canonical&quot;,\n      &quot;valueCanonical&quot;: &quot;http://argonautproject.org/subscription-ig/SubscriptionTopic/admission&quot;\n    }\n  ]\n}\n</code></pre></div>\n\n\n<p>Based on the IG I think these all need to be updated</p>",
        "id": 209683136,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599759972
    },
    {
        "content": "<p>The canonicals don't have to resolve, and I think this was a publishing error</p>",
        "id": 209683491,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760175
    },
    {
        "content": "<p>the \"source of truth\" for what they are should be in the IG</p>",
        "id": 209683522,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760188
    },
    {
        "content": "<p>Yep, thanks for the catch - forgot to update the implementation when it changed.  I've pushed the client and realized I need to update the server too, so it make act funny until that gets updated too.</p>",
        "id": 209683604,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599760209
    },
    {
        "content": "<p>So, what is UV?</p>",
        "id": 209683626,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760223
    },
    {
        "content": "<p>(b/c Jira also hates this)</p>",
        "id": 209683643,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760233
    },
    {
        "content": "<p>Universal realm?</p>",
        "id": 209683870,
        "sender_full_name": "David deRoode",
        "timestamp": 1599760332
    },
    {
        "content": "<p>UV <em>is</em> universal realm.  Originally had US (argonaut habit) but realized this isn't US-limited.</p>",
        "id": 209684172,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599760486
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span> The backport-payload-content profile should support all three payload content types,  but I'm getting an error from the r4 cerner server when trying to create a new subscription with a valueCode=full-resource on this extension: \"\"Expected value to be one of: empty, id-only\"\"</p>",
        "id": 209684180,
        "sender_full_name": "David deRoode",
        "timestamp": 1599760490
    },
    {
        "content": "<p>The backport defines all the content types, it does not mandate that they are all supported.</p>",
        "id": 209684247,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599760524
    },
    {
        "content": "<p>Yeah, our test implementation only supports empty and id-only</p>",
        "id": 209684258,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599760529
    },
    {
        "content": "<p>Got it- I'm guessing a similar rationale for the error on criteria (ie Cerner test implmentation only supports criteria within a patient-specific Encounter context)?</p>",
        "id": 209684636,
        "sender_full_name": "David deRoode",
        "timestamp": 1599760679
    },
    {
        "content": "<p>sending full alerts actually has some security considerations</p>",
        "id": 209684810,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760737
    },
    {
        "content": "<p>(in a real world server)</p>",
        "id": 209684846,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599760756
    },
    {
        "content": "<p>Yeah, there's a pretty limited subset of the overall functionality we have working.  </p>\n<p>Also as an aside, the error response you're getting back is probably a 400.  If we had true support for Subscription, these would likely be 422s instead since what you're asking the server to do is supported by the spec, just not by us.</p>",
        "id": 209685246,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599760896
    },
    {
        "content": "<p>The patient specific Encounter context limitation ties in with the messages used to trigger notifications.</p>",
        "id": 209685432,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599760962
    },
    {
        "content": "<p>Read my mind. Thanks for confirming</p>",
        "id": 209685541,
        "sender_full_name": "David deRoode",
        "timestamp": 1599761021
    },
    {
        "content": "<p>Alright, client and server should both be updated to use UV realm now - please let me know if you run into anything else!</p>",
        "id": 209686530,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599761453
    },
    {
        "content": "<p>I'll be trying to submit an R5 subscription in a little while, I assume these <em>uv</em> updates apply for the R5 server also?</p>",
        "id": 209687214,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599761712
    },
    {
        "content": "<p>The extensions are just used as part of the R4 Backport, so you shouldn't need to worry about them with R5</p>",
        "id": 209687647,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599761906
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  I'm getting \"Invalid subscription\" when trying to post an R4 backport subscription to <a href=\"https://server.subscriptions.argo.run/Subscription\">https://server.subscriptions.argo.run/Subscription</a>. Can you help identify what is wrong there?</p>",
        "id": 209687918,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599762030
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span> , someone pointed out the server had been using the old 'us' realm instead of the current 'uv' realm.  The server right now is showing <code>R4 Subscription requires Extension: http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-topic-canonical</code>, so I'm guessing that the client is posting with US realm.<br>\nIf you are using the reference client, it was updated a little while ago so probably needs a refresh (control-refresh is advised to make sure it doesn't reload from cache).</p>",
        "id": 209688295,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599762199
    },
    {
        "content": "<p>OK now I see that since the R5 server doesn't need an extension, probably uv does not apply. I don't find any /us/ in the sample payload.</p>",
        "id": 209688772,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599762402
    },
    {
        "content": "<p>I'm using my own client, which is posting to the 'uv' realm.</p>",
        "id": 209688893,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599762453
    },
    {
        "content": "<p>Is there a way I can insert Basic Auth credentials in the Authorization field of my Subscription request?</p>",
        "id": 209689319,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599762654
    },
    {
        "content": "<p>You should be able to use the \"header\" field</p>",
        "id": 209689694,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599762824
    },
    {
        "content": "<p><a href=\"https://build.fhir.org/subscription-definitions.html#Subscription.header\">https://build.fhir.org/subscription-definitions.html#Subscription.header</a></p>",
        "id": 209689776,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599762851
    },
    {
        "content": "<p>Spencer: the R4 subscription requires several extensions.  The test client shows all of them in-context:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Subscription&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;end&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;2020-09-10T19:33:31.651Z&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;reason&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Client Testing&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;channel&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">&quot;endpoint&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;https://client.subscriptions.argo.run/Endpoints/5f849307-5fd9-4e3e-a8fa-ebbc859e78a5&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;payload&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;application/fhir+json&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;_payload&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-payload-content&quot;</span><span class=\"p\">,</span>\n          <span class=\"nt\">&quot;valueCode&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;id-only&quot;</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">},</span>\n    <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;rest-hook&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-heartbeat-period&quot;</span><span class=\"p\">,</span>\n        <span class=\"nt\">&quot;valueUnsignedInt&quot;</span><span class=\"p\">:</span> <span class=\"mi\">60</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">&quot;status&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;requested&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;criteria&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Encounter?patient=Patient/39917&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-topic-canonical&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;valueCanonical&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://argonautproject.org/encounters-ig/SubscriptionTopic/encounter-start&quot;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n\n\n<p>Do you have an example that is being rejected?</p>",
        "id": 209689957,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599762943
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> </p>\n<p>The expected syntax for headers w/ the Cerner test server is \"\"&lt;header-name&gt;: &lt;header-value&gt;\"</p>\n<p>You can check out this section for an example: <a href=\"https://github.com/averyallen/wgm_notes/blob/sept_2020/subscriptions/r5.md#create\">https://github.com/averyallen/wgm_notes/blob/sept_2020/subscriptions/r5.md#create</a></p>",
        "id": 209690195,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599763054
    },
    {
        "content": "<p>Is <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription</a> up? I'm getting a 504 TimeOut</p>",
        "id": 209690766,
        "sender_full_name": "David deRoode",
        "timestamp": 1599763308
    },
    {
        "content": "<p>Still having issues <span class=\"user-mention\" data-user-id=\"197608\">@David deRoode</span> ?  I think that was temporary downtime while a new build was being deployed</p>",
        "id": 209691281,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599763530
    },
    {
        "content": "<p>Now getting a 502 Bad Gateway</p>",
        "id": 209691371,
        "sender_full_name": "David deRoode",
        "timestamp": 1599763568
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Subscription&quot;,\n    &quot;extension&quot;: [\n        {\n            &quot;url&quot;: &quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-topic-canonical&quot;,\n            &quot;valueUri&quot;: &quot;http://argonautproject.org/subscription-ig/SubscriptionTopic/admission&quot;\n        }\n    ],\n    &quot;status&quot;: &quot;requested&quot;,\n    &quot;reason&quot;: &quot;Test subscription&quot;,\n    &quot;criteria&quot;: &quot;Encounter?patient=Patient/1316024&quot;,\n    &quot;channel&quot;: {\n        &quot;type&quot;: &quot;rest-hook&quot;,\n        &quot;endpoint&quot;: &quot;https://connectathon.epic.com/Interconnect-Fhir-Unsecure/api/FHIR/R4/NotificationReceiver&quot;,\n        &quot;payload&quot;: &quot;application/fhir+json&quot;,\n        &quot;_payload&quot;: {\n            &quot;extension&quot;: [\n                {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-payload-content&quot;,\n                    &quot;valueCode&quot;: &quot;id-only&quot;\n                }\n            ]\n        },\n        &quot;header&quot;: [\n            &quot;Epic-Client-ID:  151ba7cb-ad9e-4361-92a0-21669aee0c65&quot;\n        ]\n    }\n}\n</code></pre></div>\n\n\n<p>I think all of the parts in yours but not mine are optional?</p>",
        "id": 209691667,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599763702
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197608\">David deRoode</span> <a href=\"#narrow/stream/179229-subscriptions/topic/Cerner.20test.20server/near/209691371\">said</a>:</p>\n<blockquote>\n<p>Now getting a 502 Bad Gateway</p>\n</blockquote>\n<p>Looking into this now.  Looks like some deployment pipeline changes were pulled in with the latest build that's causing issues for other tracks as well.</p>",
        "id": 209692121,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599763925
    },
    {
        "content": "<p>I see the issue - you have <code>valueUri</code> instead of <code>valueCanonical</code> that the server is expecting - the IG currently lists <code>valueUri</code> (so you are correct), but I believe (from earlier discussions) that it should be canonical now..  I'll need to change the server or the spec: <span class=\"user-mention\" data-user-id=\"191356\">@Jenni Syed</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  - thoughts?</p>",
        "id": 209692398,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599764050
    },
    {
        "content": "<p>Ah, okay. I was about to ask about that because Cerner's server is also giving me an error for that.</p>",
        "id": 209693097,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599764338
    },
    {
        "content": "<p>Trying to  POST an R5 subscription I got a 504:<br>\n<em>CloudFront attempted to establish a connection with the origin, but either the attempt failed or the origin closed the connection.</em><br>\n<a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription</a></p>\n<p>Also got 504 from GET at the same address which worked for me earlier, so I guess the server is down now somehow?</p>",
        "id": 209697401,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599766223
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> </p>\n<p>Yeah, there were changes pushed out that aren't related to subscription, but are causing the downtime.  I'll update when the fix is pushed out; we are getting pretty close.</p>",
        "id": 209697955,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599766470
    },
    {
        "content": "<blockquote>\n<p>but I believe (from earlier discussions) that it should be canonical now</p>\n</blockquote>\n<p>well, the IG says uri so I was going to stick to uri for the duration of the connecatathon</p>",
        "id": 209698372,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1599766655
    },
    {
        "content": "<p>Yeah - I'll update the reference implementation (sorry in advance to everyone for the breaking change)</p>",
        "id": 209698479,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599766690
    },
    {
        "content": "<p>I'll also update what the our server expects as well.</p>",
        "id": 209698590,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599766742
    },
    {
        "content": "<p>As a note, the backport $topic-list operation uses canonical - so it's most likely that I simply missed the one extension and updated everything else (so make sure to leave the old code there too =).</p>",
        "id": 209699792,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599767258
    },
    {
        "content": "<p>Sorry, so is it canonical or is it uri?</p>",
        "id": 209699954,
        "sender_full_name": "Cary",
        "timestamp": 1599767334
    },
    {
        "content": "<p>like if I make a request right now</p>",
        "id": 209699977,
        "sender_full_name": "Cary",
        "timestamp": 1599767343
    },
    {
        "content": "<p>to the R4 backport endpoint</p>",
        "id": 209700052,
        "sender_full_name": "Cary",
        "timestamp": 1599767383
    },
    {
        "content": "<p>It's pushing the change to URI right now.  It will take a couple of minutes to build and deploy.</p>",
        "id": 209700576,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599767614
    },
    {
        "content": "<p>OK so I was wrong, GET is working but POST is getting a 504.  I'm not sure if GET was also getting 504 before because I didn't actually do it even though I thought I did.</p>",
        "id": 209701285,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599767908
    },
    {
        "content": "<p>Based on the GET results, it appears my three subscription POSTs were recorded even though I got 504 responses. But they all still have status \"requested\" not \"active\" and they are otherwise identical except for the IDs and timestamps.</p>",
        "id": 209704100,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599769355
    },
    {
        "content": "<p>I believe it's still the same issue that was mentioned above.  There's a fix that's in the process of being deployed.</p>",
        "id": 209704419,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599769505
    },
    {
        "content": "<p>OK but also I think I put in \"end\" timestamps that have already passed</p>",
        "id": 209704680,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599769661
    },
    {
        "content": "<p>I'll wait until I hear that the deployment is done and then I'll try deleting two and updating one.</p>",
        "id": 209704791,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599769716
    },
    {
        "content": "<p>Okay, changes are live.  Things that were added:</p>\n<ul>\n<li>504s should hopefully be fixed</li>\n<li>Updated all extensions urls to \"uv\" instead of \"us\"</li>\n<li>Updated backport-topic-canonical extension to use valueUri instead of valueCanonical</li>\n</ul>",
        "id": 209705634,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599770187
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> ,  I don't think that we are currently honoring the end timestamps.  That's something I could look into getting added if it's a workflow that you'd like to test out.</p>",
        "id": 209705744,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599770262
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> , Did you also update the topic-list operation to valueUri?  I left that as valueCanonical since that's how it was defined in the IG.</p>",
        "id": 209705850,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599770312
    },
    {
        "content": "<p>I left it as valueCanonical as well - that's how I realized that I just missed the one field during updating.</p>",
        "id": 209706282,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599770541
    },
    {
        "content": "<p>I figured it out.  I accidentally specified the server url with http instead of https which was causing the issue.</p>",
        "id": 209706503,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599770651
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  So, I'm still getting \"Invalid subscription\" for the above request. Any idea why?</p>",
        "id": 209708959,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599771860
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span>  Posting subscriptions is now working for me. I'm trying to trigger a notification, but I'm finding that I get a 404 when posting to <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify</a>. Is that still the right endpoint to trigger notifications?</p>",
        "id": 209713775,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599774419
    },
    {
        "content": "<p>I got a subscription POSTed and \"active\".  Now I'm trying to trigger a notification, but I get a 400 Bad Request when I POST the raw V2<br>\nEVN|A04|1<br>\nPID|123|1316024|1221233<br>\nto the endpoint <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify</a></p>",
        "id": 209713813,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599774438
    },
    {
        "content": "<p>Hmm,  I was able to get a request through with that body.  Is there any error message that comes back with the 400?</p>",
        "id": 209714376,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599774800
    },
    {
        "content": "<p>Maybe it's because of the content-type? When I changed it from \"application/json\" to \"text/plain\" I then get a 404 Not Found.</p>",
        "id": 209714612,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599774951
    },
    {
        "content": "<p>With the 400 I got a JSON body showing the error code and text, but with the 404 I get no body</p>",
        "id": 209714731,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599774999
    },
    {
        "content": "<p>But based on your successful submit I have not seen a call to my endpoint yet. Maybe that's a different problem.</p>",
        "id": 209714809,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599775058
    },
    {
        "content": "<p>I take that back, I got 3 of them! They just didn't get far on my end.</p>",
        "id": 209714956,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599775139
    },
    {
        "content": "<p>Okay, yeah.  I can recreate the 400 by setting the Content-Type to application/json.</p>\n<p>text/plain is working for me, though</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request POST &#39;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify&#39; \\\n--header &#39;Content-Type: text/plain&#39; \\\n--data-raw &#39;EVN|A04|1\nPID|123|1316024|1111&#39;\n</code></pre></div>",
        "id": 209715029,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599775182
    },
    {
        "content": "<p>Oh, cool!  Glad to hear they are showing up</p>",
        "id": 209715052,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599775195
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span>  you have the wrong url for the topic, it should be: <code>http://argonautproject.org/encounters-ig/SubscriptionTopic/encounter-start</code></p>",
        "id": 209716334,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599776003
    },
    {
        "content": "<p>In the context of the backport, you can run <a href=\"https://server.subscriptions.argo.run/Subscription/$topic-list\">https://server.subscriptions.argo.run/Subscription/$topic-list</a> to see the list of topics:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Parameters&quot;</span><span class=\"p\">,</span>\n  <span class=\"nt\">&quot;parameter&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">&quot;name&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;subscription-topic-canonical&quot;</span><span class=\"p\">,</span>\n      <span class=\"nt\">&quot;valueCanonical&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://argonautproject.org/encounters-ig/SubscriptionTopic/encounter-start&quot;</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 209716465,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599776081
    },
    {
        "content": "<p>Hm, I'm getting a 501 at that endpoint.</p>",
        "id": 209716687,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599776241
    },
    {
        "content": "<p>Is there a list of the topic igs?  I'm pretty sure the link that <span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span>  is providing is from the Cerner server.  It's what we've been using for the last few connectathons.  Maybe that used to be url and it changed?</p>",
        "id": 209717426,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599776794
    },
    {
        "content": "<p>I got the link originally from the R4 Backport examples, but I do see that <a href=\"https://microsoft-healthcare-madison.github.io/argonaut-subscription-info/\">https://microsoft-healthcare-madison.github.io/argonaut-subscription-info/</a> calls out that the one Gino mentioned is supported by that server. I guess I just assumed everyone was supporting \"<a href=\"http://argonautproject.org/subscription-ig/SubscriptionTopic/admission\">http://argonautproject.org/subscription-ig/SubscriptionTopic/admission</a>\" for testing.</p>",
        "id": 209717636,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599776967
    },
    {
        "content": "<p>The name for the Argonaut one changed a while back (can go through git) - but that was the old name.  As long as the server is reporting its OWN list properly, it shouldn't matter.</p>\n<p>In this case, the argo.run use 'encounter-start', so trying to create a subscription with the 'admission' topic fails.</p>",
        "id": 209717782,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599777063
    },
    {
        "content": "<p>Also <span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span>  I am still seeing 404 at <a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription/notify</a> even if I set the Content-type to text/plain. The response has an \"X-Cache\" header that says \"Error from cloudfront\", so I'm not sure if that is relevant.</p>",
        "id": 209717796,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599777073
    },
    {
        "content": "<p>For reference, the current (final save for updates based on changes to R5) Argonaut encounter IG is living on <a href=\"https://github.com/argonautproject/subscriptions/blob/master/encounters-ig.md\">GitHub, here</a></p>",
        "id": 209717966,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1599777193
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span> , I'm going to have to dig into this one a bit more.  I'm not able to recreate it on my end.  If you get a chance can you provide the X-Request-Id response header?</p>\n<p>Also the request body would be helpful</p>",
        "id": 209718805,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599777853
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>EVN|A04|1\nPID|123|1316024|1221233\n</code></pre></div>\n\n\n<p>X-Request-Id:  2d0d1efe-70df-4310-ab4d-ca2b43d50db6</p>",
        "id": 209718879,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599777955
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span> that curl is working for me, although on RedHat I had to change --data-raw to --data-ascii. I don't know why I'm getting 404 from Postman but I'll just go with curl for now.</p>",
        "id": 209737254,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599794076
    },
    {
        "content": "<p>When you get a chance can you clean out all the subscriptions I POSTed?  They all have endpoint <a href=\"http://edsconnect25.intersystems.com\">edsconnect25.intersystems.com</a> and heartbeatPeriod 600.</p>",
        "id": 209737280,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599794150
    },
    {
        "content": "<p>Also I requested a second header, like  below, but I don't think it's coming through:<br>\n\"header\": [<br>\n                    \"Authorization: Basic X3N5c3RlbTpTWVM=\",<br>\n                    \"x-ISC-EDSName: Avery\"<br>\n                ]<br>\nIs that plausible?</p>",
        "id": 209737349,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599794243
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span> , I tracked down the logs for the request above. </p>\n<div class=\"codehilite\"><pre><span></span><code> No trigger filter found for: &#39;EVN|A04|1\nPID|123|1316024|1221233&#39;\n</code></pre></div>\n\n\n<p>My suspicion is that there is either missing or extra whitespace somewhere.  Here's how I have my postman request set up:</p>\n<p><a href=\"/user_uploads/10155/lkNXnbgJcjotZe5RS_0Jlcjl/Screen-Shot-2020-09-11-at-7.45.48-AM.png\">Screen-Shot-2020-09-11-at-7.45.48-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/lkNXnbgJcjotZe5RS_0Jlcjl/Screen-Shot-2020-09-11-at-7.45.48-AM.png\" title=\"Screen-Shot-2020-09-11-at-7.45.48-AM.png\"><img src=\"/user_uploads/10155/lkNXnbgJcjotZe5RS_0Jlcjl/Screen-Shot-2020-09-11-at-7.45.48-AM.png\"></a></div>",
        "id": 209775557,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599828386
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> ,</p>\n<p>You should be able to update the status of your existing Subscriptions to \"off\" to prevent them from triggering notifications.  You can easily see all the Subscriptions you've created so far with:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request GET &#39;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Subscription?endpoint=edsconnect25.intersystems.com&#39; \\\n--header &#39;Accept: application/fhir+json&#39;\n</code></pre></div>",
        "id": 209776544,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599828933
    },
    {
        "content": "<p>The server should sending multiple headers.  Looking into that now.</p>",
        "id": 209776633,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599828974
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span>  Okay, I think I might have it figured out. I'm on Windows, and if I send a request from Postman that looks exactly like yours, I get a 404. However, if I paste the body in Notepad++, convert the line endings to Unix (so LF instead of CRLF) and send that as a binary payload from Postman, I get 200. So I suspect this is a Windows vs Unix line endings issue.</p>",
        "id": 209779310,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599830366
    },
    {
        "content": "<p>I'll look into stripping the line endings to hopefully prevent that</p>",
        "id": 209780474,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599830971
    },
    {
        "content": "<p>Thanks. It is easy to work around once the issue is understood, so don't worry about it too much for my benefit.</p>",
        "id": 209780756,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599831084
    },
    {
        "content": "<p>Since these are HL7 V2 segments, shouldn't they simply have a CR at the end (and no other line breaks)? At least that is what HL7 over HTTP expects...</p>",
        "id": 209783529,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1599832533
    },
    {
        "content": "<p>This is \"hacked HL7 over HTTP\" not so much the real deal :D</p>",
        "id": 209783719,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1599832620
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span> I have increased my confidence that my x-EDS header is not coming through. I succeeded in updating my extra subscriptions to \"off\", so the only active one now is e09c0d84-692f-4149-8899-30b6c01150f2 and it has<br>\n\"header\": [<br>\n                    \"Authorization: Basic X3N5c3RlbTpTWVM=\",<br>\n                    \"x-ISC-EDSName: Avery\"<br>\n                ]<br>\nDo I have the syntax right on that second one? I do see the \"authorization\" header coming through.</p>",
        "id": 209788878,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599835153
    },
    {
        "content": "<p>The syntax looks correct.  We are currently looking into the issue.  Hope to have a fix for you soon.</p>",
        "id": 209789081,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599835244
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> , can you give it another go?  Just pushed out a change.</p>",
        "id": 209791576,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599836433
    },
    {
        "content": "<p>Thanks! I seem to have gotten a bunch of new x- headers but not the one I requested.</p>",
        "id": 209792188,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599836708
    },
    {
        "content": "<p>Sorry, it seems I did get it - let me check more throughly</p>",
        "id": 209792417,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599836818
    },
    {
        "content": "<p>Yes, I missed it the first try because I searched case-sensitive.<br>\nSo, thanks!</p>",
        "id": 209792640,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599836925
    },
    {
        "content": "<p>FYI these are all the new headers I got:</p>\n<p>\"x-isc-edsname\")=\"Avery\"<br>\n\"accept-encoding\")=\"gzip;q=1.0, deflate;q=0.6, identity;q=0.3\"<br>\n\"newrelic\")=\"eyJ2IjpbMCwxXSwiZCI6eyJ0eSI6IkFwcCIsImFjIjoiMTc5NTE0MSIsImFwIjoiMjEyMjkxODAzIiwidHgiOiIzMWFhMWU2NjZkNDZlNzhhIiwidHIiOiIzMWFhMWU2NjZkNDZlNzhhIiwic2EiOnRydWUsInByIjoxLjExMDI3NSwidGkiOjE1OTk4MzY1NDU3NzgsImlkIjoiNjUyNWZmOWRmZTdkY2RjNiIsInRrIjoiMTczMDc1OSJ9fQ==\"<br>\n\"user-agent\")=\"Ruby\"<br>\n\"x-forwarded-for\")=\"159.140.6.33\"<br>\n\"x-forwarded-port\")=80<br>\n\"x-forwarded-proto\")=\"http\"<br>\n\"x-relay-domain\")=\"<a href=\"http://edsconnect25.intersystems.com\">edsconnect25.intersystems.com</a>\"<br>\n\"x-relay-path\")=\"csp/healthshare/edsdemo/hseds/api/trigger/fhirsub/admit-IMP\"<br>\n\"x-relay-proto\")=\"https\"</p>",
        "id": 209793237,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599837219
    },
    {
        "content": "<p>Next question...</p>\n<p>I tried updating to content: \"full-resource\" and got back an error: <em>\"text\": \"Expected value to be one of: id-only, empty\"</em>.</p>\n<p>I assume that's not supported for now. However the notification bundle I'm getting with \"id-only\" contains an entry after the SubscriptionStatus resource that is not any kind of FHIR Resource:<br>\n{<br>\n            \"request\": {<br>\n                \"method\": \"PUT\",<br>\n                \"url\": \"<a href=\"https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Encounter/1111\">https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Encounter/1111</a>\"<br>\n            },<br>\n            \"response\": {<br>\n                \"status\": \"200\"<br>\n            }<br>\n}</p>\n<p>Is this the expected content? I see it contains the expected id but I'm not sure what to make of the rest of it. I couldn't find any documentation specifying what to expect but based on my R4 experience I was expecting the full Encounter resource.</p>",
        "id": 209794069,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599837510
    },
    {
        "content": "<p>The R5 doc does give me the impression that I should expect any number of resources that match the Topic, am I right about that?</p>",
        "id": 209794095,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599837525
    },
    {
        "content": "<p>I just tried a GET on the returned URL for Encounter/1111 but got a 404.  Is that expected?</p>",
        "id": 209794603,
        "sender_full_name": "Ted Peck",
        "timestamp": 1599837757
    },
    {
        "content": "<p>It seems the Cerner test server is not returning a fullUrl for each Bundle entry. Is that expected?</p>",
        "id": 209795311,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599838071
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"340905\">@Ted Peck</span> </p>\n<p>Yeah, full resource isn't supported.</p>\n<p>For the response, the first bundle entry contains the subscription status resource.  The second entry only contains a request and response field that relay information about the request that triggered the subscription notification.  Note that since the notification triggers are the hacked together hl7 v2 messages, that there wasn't really a post/put request like the bundle suggests, but that's how the response would be if the workflow were fully supported.</p>\n<p>Here's an example from the spec: <a href=\"https://build.fhir.org/notification-id-only.json.html\">https://build.fhir.org/notification-id-only.json.html</a></p>\n<p>Also, as for the Encounter not resolving, that's expected.  In the notification body</p>\n<div class=\"codehilite\"><pre><span></span><code>EVN|A04|1\nPID|123|1316024|1111\n</code></pre></div>\n\n\n<p>The last integer is used as the Encounter id.  Encounter read/search is supported by the server so if you wanted a real encounter, you could look one up and use that as part of the notification.  An example can be found here:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl --location --request GET &#39;https://fhir-open.stagingcerner.com/beta/dacc6494-e336-45ad-8729-b789ff8663c6/Encounter/97733541&#39; \\\n--header &#39;Accept: application/fhir+json&#39;\n</code></pre></div>",
        "id": 209796769,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599838666
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span> ,  We don't support reading the subscription status outside the context of a notification bundle, so I don't think it makes sense to add a full url there (I also don't think it's required by the spec).</p>\n<p>I do see where it could be helpful for the second bundle entry.  I'll update the server to populate the entry the same was as the example in the spec</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n      &quot;fullUrl&quot;: &quot;https://example.org/FHIR/R5/Encounter/2&quot;,\n      &quot;request&quot;: {\n        &quot;method&quot;: &quot;PUT&quot;,\n        &quot;url&quot;: &quot;Encounter/2&quot;\n      },\n      &quot;response&quot;: {\n        &quot;status&quot;: &quot;201&quot;\n      }\n    }\n</code></pre></div>",
        "id": 209797217,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599838883
    },
    {
        "content": "<p>I think it is required based on:  <a href=\"http://hl7.org/fhir/R4/bundle.html#bundle-unique\">http://hl7.org/fhir/R4/bundle.html#bundle-unique</a></p>\n<blockquote>\n<p>Except for transactions and batches, each entry in a Bundle must have a fullUrl which is the identity of the resource in the entry. Note that this is not a versioned reference to the resource, but its identity. Where a resource is not assigned a persistent identity that can be used in the Bundle, a UUID should be used (urn:uuid:...).</p>\n</blockquote>\n<p>Or am I misinterpreting something?</p>",
        "id": 209797425,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599838980
    },
    {
        "content": "<p>Yeah, you're right.  I can get that added.  Also, I believe we are returning absolute urls in the request.url field, but based on the spec it should be relative:</p>\n<div class=\"codehilite\"><pre><span></span><code>Definition\n\nThe URL for this entry, relative to the root (the address to which the request is posted).\n</code></pre></div>",
        "id": 209798139,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599839307
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span> </p>\n<p>Alright! I've got a new commit building that updates the request notifications to always include Bundle.entry.fullUrl and that updates Bundle.entry.request.url to be relative as the spec requires.  Example:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Bundle&quot;,\n  &quot;id&quot;: &quot;notification-id-only&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: [\n      &quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-subscription-notification&quot;\n    ]\n  },\n  &quot;type&quot;: &quot;history&quot;,\n  &quot;timestamp&quot;: &quot;2020-09-11T11:25:20-05:00&quot;,\n  &quot;entry&quot;: [\n    {\n      &quot;fullUrl&quot;: &quot;urn:uuid:aca62ce2-7bff-496e-b4d1-ec0591dd5152&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;Parameters&quot;,\n        &quot;meta&quot;: {\n          &quot;profile&quot;: [\n            &quot;http://hl7.org/fhir/uv/subscriptions-backport/StructureDefinition/backport-subscription-status&quot;\n          ]\n        },\n        &quot;parameter&quot;: [\n          {\n            &quot;name&quot;: &quot;subscription-url&quot;,\n            &quot;valueUri&quot;: &quot;http://localhost:3000/beta/r4/2c400054-42d8-4e74-87b7-80b5bd5fde9f/Subscription/2ac4db66-4790-4cc7-b38d-d18f16fbef26&quot;\n          },\n          {\n            &quot;name&quot;: &quot;status&quot;,\n            &quot;valueCode&quot;: &quot;active&quot;\n          },\n          {\n            &quot;name&quot;: &quot;type&quot;,\n            &quot;valueCode&quot;: &quot;event-notification&quot;\n          },\n          {\n            &quot;name&quot;: &quot;subscription-event-count&quot;,\n            &quot;valueUnsignedInt&quot;: 2\n          },\n          {\n            &quot;name&quot;: &quot;bundle-event-count&quot;,\n            &quot;valueUnsignedInt&quot;: 1\n          },\n          {\n            &quot;name&quot;: &quot;subscription-topic-url&quot;,\n            &quot;valueUri&quot;: &quot;http://argonautproject.org/subscription-ig/SubscriptionTopic/admission&quot;\n          }\n        ]\n      },\n      &quot;request&quot;: {\n        &quot;method&quot;: &quot;GET&quot;,\n        &quot;url&quot;: &quot;Subscription/2ac4db66-4790-4cc7-b38d-d18f16fbef26/$status&quot;\n      },\n      &quot;response&quot;: {\n        &quot;status&quot;: &quot;200&quot;\n      }\n    },\n    {\n      &quot;fullUrl&quot;: &quot;http://localhost:3000/beta/r4/2c400054-42d8-4e74-87b7-80b5bd5fde9f/Encounter/1111&quot;,\n      &quot;request&quot;: {\n        &quot;method&quot;: &quot;PUT&quot;,\n        &quot;url&quot;: &quot;Encounter/1111&quot;\n      },\n      &quot;response&quot;: {\n        &quot;status&quot;: &quot;200&quot;\n      }\n    }\n  ]\n}\n</code></pre></div>",
        "id": 209803665,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599841811
    },
    {
        "content": "<p>It should be available in about ~30 minutes or so.</p>",
        "id": 209803745,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599841853
    },
    {
        "content": "<p>I'm going to step away for a bit to eat, but afterwards I'll be around to tweak anything else that needs updates.</p>",
        "id": 209803843,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599841903
    },
    {
        "content": "<p>If I try to post a subscription with criteria like <code>Encounter?patient=Patient/1316024</code>, I get back the following response:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;invalid&quot;,\n            &quot;details&quot;: {\n                &quot;text&quot;: &quot;Expected to match pattern: Encounter\\\\?patient=\\\\d+&quot;\n            },\n            &quot;expression&quot;: [\n                &quot;Subscription.criteria&quot;\n            ]\n        }\n    ]\n}\n</code></pre></div>\n\n\n<p>But if I submit it like <code>Encounter?patient=1316024</code> it works.</p>\n<p>Shouldn't the criteria be <code>Encounter?patient=Patient.1316024</code> since the value is a reference type?</p>",
        "id": 209806516,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599843356
    },
    {
        "content": "<p>Both are allowed by the spec for reference searches:</p>\n<p><a href=\"https://www.hl7.org/fhir/search.html#reference\">https://www.hl7.org/fhir/search.html#reference</a></p>\n<p>We limit to patient=&lt;id&gt; for simplicity in the server implementation.</p>",
        "id": 209808904,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599844484
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"301310\">@Avery Allen</span>  Has the fullUrl update finished deploying yet? I am still not seeing the fullUrl in the notification bundles.</p>",
        "id": 209811616,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599845829
    },
    {
        "content": "<p>Let me check real quick</p>",
        "id": 209811813,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599845925
    },
    {
        "content": "<p>Gah, networking issue failed the build. Lemme rerun it.</p>",
        "id": 209811901,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599845975
    },
    {
        "content": "<p>Sorry about that.</p>",
        "id": 209811914,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599845983
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"224405\">@Spencer LaGesse</span>, the changes should be deployed now</p>",
        "id": 209820212,
        "sender_full_name": "Avery Allen",
        "timestamp": 1599850209
    },
    {
        "content": "<p>Thanks! It seems to be working now.</p>",
        "id": 209820676,
        "sender_full_name": "Spencer LaGesse",
        "timestamp": 1599850471
    }
]