[
    {
        "content": "<p>In the r4b subscriptions spec, how would a subscriber perform data lineage on each resource when using the id only option? For example, I have an analytics subscriber and I need to be able to store all versions of a record accurately so reporting and modeling can accurately do longitudal analysis.</p>\n<p>Is the id only example's eventNumber the meta.versionId for a resource?<br>\n<a href=\"https://github.com/HL7/fhir-subscription-backport-ig/blob/master/input/fsh/BackportNotification.fsh#L204\">https://github.com/HL7/fhir-subscription-backport-ig/blob/master/input/fsh/BackportNotification.fsh#L204</a></p>\n<p>Otherwise, would a subscriber need to line up the subscription timestamps and version independently from the FHIR version?</p>",
        "id": 263316362,
        "sender_full_name": "Mike Lohmeier",
        "timestamp": 1638375918
    },
    {
        "content": "<p>This topic was moved here from <a class=\"stream-topic\" data-stream-id=\"179166\" href=\"/#narrow/stream/179166-implementers/topic/r4b.20subscription.20data.20lineage\">#implementers &gt; r4b subscription data lineage</a> by <span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span></p>",
        "id": 263324196,
        "sender_full_name": "Notification Bot",
        "timestamp": 1638378917
    },
    {
        "content": "<p>With id-only, I don't think there's currently a way to know the <em>version</em> of the resource that triggered a notification -- just the version-independent URL (in Bundle.entry.fullUrl, <a href=\"https://argonautproject.github.io/subscription-backport-ig/Bundle-notification-id-only.json.html\">example here</a>). If you have an id-only notification and you need a history of versions, you should be able to start from the <code>fullUrl</code> and do  <code>GET $fullUrl/_history</code></p>",
        "id": 263325248,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638379360
    },
    {
        "content": "<p>cool, thanks. Yeah, that makes sense since most subscribers will just want the latest version anyway and push the logic for needing a specific version to clients that actually need it like a data analytics subscriber.</p>",
        "id": 263329958,
        "sender_full_name": "Mike Lohmeier",
        "timestamp": 1638381198
    },
    {
        "content": "<p>Is SSE being considered as a FHIRCAST transport. I prefer SSE over websockets because its much lighter and is better for battery on mobiles, etc</p>\n<p><a href=\"https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events\">https://developer.mozilla.org/en-US/docs/Web/API/Server-sent_events/Using_server-sent_events</a></p>",
        "id": 264689365,
        "sender_full_name": "Ged Webb",
        "timestamp": 1639392836
    },
    {
        "content": "<p>Do you mean this for <a class=\"stream\" data-stream-id=\"179271\" href=\"/#narrow/stream/179271-FHIRcast\">#FHIRcast</a> ?</p>",
        "id": 264713684,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1639405908
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"196630\">@Ged Webb</span> , I have had it on my list to test SSE with FHIR Subscriptions for quite a while, but there hasn't been any  interest so I haven't pushed on it.</p>\n<p>If you are asking about FHIRcast, I think it's a little harder as the participants/events are often bi-directional (e.g., most apps want to be able to update the user's context).  That said (and as Josh mentioned), the <a class=\"stream\" data-stream-id=\"179271\" href=\"/#narrow/stream/179271-FHIRcast\">#FHIRcast</a> people can give a more authoritative answer.</p>\n<p>If you are looking at Subscriptions though, there's no reason it can't be designed as a custom channel today.  If there's interest/support, the channel could be considered 'standard' in R5 or later.</p>",
        "id": 264742057,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1639417092
    },
    {
        "content": "<p>Hey <span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  </p>\n<p>I know. I just wanted to get feedback here and FHIRCAST as the architecture overlaps  both areas.</p>\n<p>Heres what i am doing currently:</p>\n<p>Clients pull over HTTP.<br>\nSevers push over SSE. </p>\n<p>My setup is  basically a GraphQL Architecture:</p>\n<p>On the Client they make a HTTP request ( REST or Grpahql). When they make the request they indicate if they want a real time view ( aka subscription).<br>\nOn the Server, the request is served and response sent, and the FHIR Models are watched via nosql Materialised Views and the changefeed goes to whomever has already make a previous HTTP Query . I just keep a virtual router list of who subscribed to what.  <br>\nUnder the hood is a Message broker that runs to make it scale out and allow failures and upgrades of the Servers without any clients having any downtime. Hence why its highly async, and hence why pure unidirectional async network transport for Subscriptions allows things to be decoupled. Makes geo physical load balancing much easier too.</p>\n<p>In terms of UX,  the GUI / CLI clients get a real time feed, and so we can do real time collaboration and never have old data on clients. </p>\n<p>For Other FHIR Servers how do they want to be told ?  Webhooks  maybe .</p>\n<hr>\n<p>Also what about  Compliance  ? how do i check that our system works with other FHIR systems ?</p>\n<p>I am using feature flags quite a bit so that we can innovate but also be compliant. <br>\nPresume the headers tell me the things talking to me also ? </p>\n<p>Sorry about the avalanche of questions. Its my first post on this forum, and so have a few things that i know i dont know.</p>",
        "id": 264781717,
        "sender_full_name": "Ged Webb",
        "timestamp": 1639435481
    },
    {
        "content": "<p>No worries <span class=\"user-mention\" data-user-id=\"196630\">@Ged Webb</span> , this is a great place to ask questions.</p>\n<p>I'll start with saying that's an interesting architecture.  I think it can be built in such a way that it is compliant with 'standard' clients and still provide all the functionality you describe.</p>\n<p>For compliance, I'll start by noting I'm no authority on the topic  =).  I believe the main testing tool of interest for REST testing is <a href=\"https://inferno.healthit.gov/\">Inferno</a>.  As long as you are following guidance on the <a href=\"https://www.hl7.org/fhir/http.html\">RESTful API</a> page, it should be straightforward.</p>\n<p>Moving into GraphQL quickly moves out of my experience.  There is the relevant <a href=\"https://www.hl7.org/fhir/graphql.html\">GraphQL</a> page, but I do not know if there are any testing tools available.  I would suggest the <a class=\"stream\" data-stream-id=\"192326\" href=\"/#narrow/stream/192326-graphql\">#graphql</a> stream for information there.</p>\n<p>On the subscription side, I have more thoughts.  Obviously, these are from looking at your description for a few minutes so I'd advise taking it with a grain of salt.</p>\n<p>With disclaimers out of the way, I'll start with a little history - the initial versions of FHIR Subscriptions were closer to what you are describing.  There was no topic resource, clients simply registered for subscriptions based on queries and the server notified on changes to result sets.  Overall, there ended up being enough issues with that design that a major overhaul was necessary (it worked <em>great</em> for some use cases, but did not work <em>at all</em> for others - there's a lot of content about all of that history available, so I won't rehash it here).</p>\n<p>With the changes in R5 (and the Backport IG to support R4B), FHIR Subscriptions became topic-based.  With that in mind, there's a bit of a tree in deciding how you want to go about it, e.g.:</p>\n<ul>\n<li>topic rooting<ul>\n<li>topics are content-based (e.g., 'Observations for this patient', etc.).</li>\n<li>topics are meta-based (e.g., 'Queries for this client', etc.).</li>\n</ul>\n</li>\n<li>number of topics<ul>\n<li>single topic (e.g., all queries for this client)</li>\n<li>multiple topics (e.g., each query for a client)</li>\n</ul>\n</li>\n<li>who creates topics<ul>\n<li>client</li>\n<li>server</li>\n</ul>\n</li>\n</ul>\n<p>And so on..</p>\n<p>You should hopefully be able to follow any of the paths and arrive at a working system (that's been a goal we've all worked hard on at least, I cannot guarantee we haven't missed anything).</p>\n<p>In terms of UX, so far the push has been Websockets, with the idea that an active client is subscribed to whatever array of topics the client is interested in (e.g., medication dispenses, patient discharges, etc.) with filters established on the subscriptions (e.g., 'medication dispenses' in this ward, 'patient discharges' from this location, etc.).  I'll also note that servers can send 'recent' events after a subscription is started in case overlap is desired and that if a server supports the <code>$events</code> operation, a client can also ask for recent events without running a new query.  I actually think SSE would be great here, but it hasn't seen the level of adoption that websockets has overall.  Defining a custom channel is pretty straightforward, so this is an easy addition.</p>\n<p>For other servers, so far the concept has been rest-hook into that server.  We have a proposal for a <code>$publish</code> event to help make that consistent as well, but it is a relatively new proposal.</p>",
        "id": 264893854,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1639502841
    },
    {
        "content": "<p>Thanks <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span> </p>\n<p>That all makes perfect sense .</p>\n<p>So then it terms of interoperability who decides the topics names and subjects within them ? I canâ€™t get my head around this because this. Itâ€™s not like REST where that API is the API.</p>\n<p>I can support web sockets,  SSE and HTTP/3 Web Transfer and have all 3 working. Itâ€™s just a transport proxy on top of the message bus and so easy stuff.</p>\n<p>So in terms of another server or client knowing thev topics and subjects, normally there is a Registry to allow Late Binding / IOC ( inversion of control ) style decoupling with discovery. <br>\nMaybe thatâ€™s the bit I am missing ?</p>",
        "id": 264980466,
        "sender_full_name": "Ged Webb",
        "timestamp": 1639558690
    },
    {
        "content": "<p>There's a built-in API for discovering topics (e.g., <code>GET /SubscriptionTopic?...</code>) and even (potentially, if a server is flexible enough) allowing for clients to define their own (e.g., <code>POST /SubscriptionTopic</code>). Each topic defines trigger events,  etc (<a href=\"http://build.fhir.org/branches/R4B/subscriptiontopic\">http://build.fhir.org/branches/R4B/subscriptiontopic</a>). </p>\n<p>(The channel types supported by a server aren't currently disoverable through metadata, to my knowledge.)</p>",
        "id": 265030803,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1639583905
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> Ok so its changed with R4B. Anyone got a link to the R5 Subscriptions Spec ?</p>",
        "id": 266669220,
        "sender_full_name": "Ged Webb",
        "timestamp": 1641204218
    },
    {
        "content": "<p>Does Zulip allow you to reply to a thread like you can in Slack ?. I cant seem to find that in zulip.</p>",
        "id": 266669323,
        "sender_full_name": "Ged Webb",
        "timestamp": 1641204290
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> for the Link ! You read my mind</p>",
        "id": 266669375,
        "sender_full_name": "Ged Webb",
        "timestamp": 1641204335
    },
    {
        "content": "<p>Just quickly read the <a href=\"http://build.fhir.org/branches/R4B/subscriptiontopic\">http://build.fhir.org/branches/R4B/subscriptiontopic</a> spec.  SO the subscriptions can be saved.  My initial thoughts are that its  like a stored procedure in a DB with a Materialized View  and a change feed off the Materialised view. The reason i use the analogy of a DB is because the way the spec if written is such that the subscriptions are stateful in that they can be saved in the System.</p>",
        "id": 266669976,
        "sender_full_name": "Ged Webb",
        "timestamp": 1641204771
    },
    {
        "content": "<p>Is there a github repo for the Subscriptions Spec ?  Looking for deeper info on this. <a href=\"https://github.com/microsoft-healthcare-madison/team\">https://github.com/microsoft-healthcare-madison/team</a> seems to be a decent repo that then links to the other repos in this space ?</p>",
        "id": 266671205,
        "sender_full_name": "Ged Webb",
        "timestamp": 1641205681
    },
    {
        "content": "<p>Happy new year <span class=\"user-mention\" data-user-id=\"196630\">@Ged Webb</span> !  I'll try and get to each of your questions below.</p>\n<ul>\n<li>The CI build of R5 is at: <a href=\"http://build.fhir.org/\">http://build.fhir.org/</a><ul>\n<li><a href=\"http://build.fhir.org/subscriptions.html\">Subscriptions Overview</a></li>\n<li>Resources: <a href=\"http://build.fhir.org/subscription\">Subscription</a>, <a href=\"http://build.fhir.org/subscriptiontopic\">SubscriptionTopic</a>, <a href=\"http://build.fhir.org/subscriptionstatus\">SubscriptionStatus</a>, and TU <a href=\"http://build.fhir.org/bundle.html#subscription-notification\">Subscription Notification Bundle</a>.</li>\n</ul>\n</li>\n<li>\n<p>The CI build of R4B is at: <a href=\"http://build.fhir.org/branches/R4B/\">http://build.fhir.org/branches/R4B/</a></p>\n<ul>\n<li>This needs to be paired with the Backport IG, to allow for things that did not exist in R4.  Right now, the CI build is at: <a href=\"https://argonautproject.github.io/subscription-backport-ig/\">https://argonautproject.github.io/subscription-backport-ig/</a> , but this should move back to the normal build server shortly (tooling issue around R4B).  Note that the IG has most of the overview/explanatory content.</li>\n<li>R4B uses the same <a href=\"http://build.fhir.org/branches/R4B/subscription\">Subscription</a> resource as R4 (no changes in minor versions), but does add the <a href=\"http://build.fhir.org/branches/R4B/subscriptiontopic\">SubscriptionTopic</a> and <a href=\"http://build.fhir.org/branches/R4B/subscription\">SubscriptionStatus</a> resources.</li>\n</ul>\n</li>\n<li>\n<p>The source repo for the Backport IG is: <a href=\"https://github.com/HL7/fhir-subscription-backport-ig\">https://github.com/HL7/fhir-subscription-backport-ig</a> , but that is literally just the source content to build the IG.</p>\n</li>\n<li>The most recent 'big push' project notes are on Confluence under the Argonaut Project <a href=\"https://confluence.hl7.org/display/AP/Subscriptions+Home\">2021 Subscriptions Project</a>.  This has all the notes from the past year's discussions about changes, etc.</li>\n<li>The Reference Implementation is at <a href=\"https://subscriptions.argo.run/\">https://subscriptions.argo.run/</a> , which as links to all the source code and additional documentation.</li>\n<li>I haven't updated the videos for the January connectathon yet, but I have a lot of content on <a href=\"https://www.youtube.com/playlist?list=PLsR-zcO--dyqViyu-cb70JExLw7HJJf06\">YouTube</a> from connectathon 28 (September 2021), so it is pretty current as well.</li>\n</ul>\n<p>Hopefully I didn't miss anything, cheers!</p>",
        "id": 266706193,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1641227691
    }
]