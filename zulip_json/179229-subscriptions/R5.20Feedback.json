[
    {
        "content": "<p>Hey all, I just finished a pass of updates on the R5 spec and was hoping to get some feedback.  This pass was going through all the open Jira issues.  Right now, the changes are all on <a href=\"http://build.fhir.org/branches/argonaut-subscription/\">http://build.fhir.org/branches/argonaut-subscription/</a> , with links below relevant to each issue.  I did just notice that I missed one issue (<a href=\"http://jira.hl7.org/browse/FHIR-28490\">FHIR#28490</a>) so will add a pass of that when I have some feedback.</p>\n<p>Specifically, I would like feedback on the field changes (e.g., Subscription.notificationUrlLocation, Subscription.maxCount, and changes to SubscriptionTopic.resourceTrigger &amp; resourceType), the documentation on the channel types, and the two new operations (Subscription/$status and Subscription/$get-ws-binding-token).</p>\n<p>Thanks in advance!</p>\n<table>\n<thead>\n<tr>\n<th>Issue</th>\n<th>Description</th>\n<th>Resolution Link</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-29315\">FHIR#29315</a></td>\n<td>Define max entries to be sent in a subscription</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.maxCount\">http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.maxCount</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28594\">FHIR#28594</a></td>\n<td>Change the way resourceTypes are referenced</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptiontopic-definitions.html\\#SubscriptionTopic.resourceTrigger.resourceType\">http://build.fhir.org/branches/argonaut-subscription/subscriptiontopic-definitions.html\\#SubscriptionTopic.resourceTrigger.resourceType</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28498\">FHIR#28498</a></td>\n<td>Explicitly call out that duplication notifications are possible for Subscriptions</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#overview-notificationNote\">http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#overview-notificationNote</a>: missed listing this in current commit messages</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28491\">FHIR#28491</a></td>\n<td>Reference from Subscription to SubscriptionTopic should be canonical</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.topic\">http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.topic</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27149\">FHIR#27149</a></td>\n<td>We need a way to register know SubscriptionTopics</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#finding-topics\">http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#finding-topics</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27148\">FHIR#27148</a></td>\n<td>Add prefer option for notification containing just url or request/response</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.notificationUrlLocationNote\">http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html\\#Subscription.notificationUrlLocationNote</a>: not sure if listed in current commit messages</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27131\">FHIR#27131</a></td>\n<td>Subscription should state that eventsSinceSubscriptionStart is inclusive of current notification</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptionstatus.html\\#subscription-status\">http://build.fhir.org/branches/argonaut-subscription/subscriptionstatus.html\\#subscription-status</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27130\">FHIR#27130</a></td>\n<td>Add operation on Subscription to get current status</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription-operation-status.html\">http://build.fhir.org/branches/argonaut-subscription/subscription-operation-status.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27129\">FHIR#27129</a></td>\n<td>Update Subscription and SubscriptionStatus harmonize client status checks</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\">http://build.fhir.org/branches/argonaut-subscription/subscription.html</a> <a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptionstatus.html\">http://build.fhir.org/branches/argonaut-subscription/subscriptionstatus.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-26958\">FHIR#26958</a></td>\n<td>Add a note to Bundle indicating that Subscription Notification bundles are non-normative</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/bundle.html\\#subscription-notification\">http://build.fhir.org/branches/argonaut-subscription/bundle.html\\#subscription-notification</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-25928\">FHIR#25928</a></td>\n<td>Adding Subscription to \"Exchanging Resources\" section</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\">http://build.fhir.org/branches/argonaut-subscription/subscriptions.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-24448\">FHIR#24448</a></td>\n<td>Update documentation to document what fields a client can and cannot update</td>\n<td>Believe all the relevant fields have been removed from Subscription \\(e.g., everything left has implementation-specific rules\\). Need to check with Jenni if this feels correct to her.</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-24350\">FHIR#24350</a></td>\n<td>Topic.canFilterBy.matchType needs to be explicit what default behavior is</td>\n<td><a href=\"http://build.fhir.org/subscriptiontopic.html\">http://build.fhir.org/subscriptiontopic.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-23859\">FHIR#23859</a></td>\n<td>Create a new Bundle type for \"subscription notification\"</td>\n<td><a href=\"http://build.fhir.org/codesystem-bundle-type.html\">http://build.fhir.org/codesystem-bundle-type.html</a> <a href=\"http://build.fhir.org/bundle.html\\#subscription-notification\">http://build.fhir.org/bundle.html\\#subscription-notification</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-23738\">FHIR#23738</a></td>\n<td>Changes to Subscription to align with publish subscribe pattern using topic and filters</td>\n<td>Question: not sure when this should be moved to next state</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-22628\">FHIR#22628</a></td>\n<td>websocket subscriptions should also support payload</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#websockets\">http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#websockets</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-21286\">FHIR#21286</a></td>\n<td>Email delivery options should be more specific</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#email\">http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#email</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-21285\">FHIR#21285</a></td>\n<td>Make lack of payload and re-query behavior ore visible</td>\n<td>Covered by R5 redesign \\(empty payloads\\)</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-20476\">FHIR#20476</a></td>\n<td>Make Subscription.channel.type extensible</td>\n<td><a href=\"http://build.fhir.org/subscription-definitions.html\\#Subscription.channelType\">http://build.fhir.org/subscription-definitions.html\\#Subscription.channelType</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-19976\">FHIR#19976</a></td>\n<td>Clarify Subscription notification limitations</td>\n<td>Covered by R5 redesign \\(servers advertise supported SubscriptionTopics\\)</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-19957\">FHIR#19957</a></td>\n<td>POST vs Update operation texts</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#rest-hook\">http://build.fhir.org/branches/argonaut-subscription/subscription.html\\#rest-hook</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-18994\">FHIR#18994</a></td>\n<td>Subscription: section on security considerations</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#safety\">http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#safety</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-18993\">FHIR#18993</a></td>\n<td>Subscription and Subscriber-side security</td>\n<td><a href=\"http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#safety\">http://build.fhir.org/branches/argonaut-subscription/subscriptions.html\\#safety</a></td>\n</tr>\n</tbody>\n</table>",
        "id": 216271966,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1605041226
    },
    {
        "content": "<p>Just posting an updated table since this has been merged.</p>\n<table>\n<thead>\n<tr>\n<th>Issue</th>\n<th>Description</th>\n<th>Resolution Link</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-29315\">FHIR#29315</a></td>\n<td>Define max entries to be sent in a subscription</td>\n<td><a href=\"http://build.fhir.org/subscription-definitions.html\\#Subscription.maxCount\">http://build.fhir.org/subscription-definitions.html\\#Subscription.maxCount</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28594\">FHIR#28594</a></td>\n<td>Change the way resourceTypes are referenced</td>\n<td><a href=\"http://build.fhir.org/subscriptiontopic-definitions.html\\#SubscriptionTopic.resourceTrigger.resourceType\">http://build.fhir.org/subscriptiontopic-definitions.html\\#SubscriptionTopic.resourceTrigger.resourceType</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28498\">FHIR#28498</a></td>\n<td>Explicitly call out that duplication notifications are possible for Subscriptions</td>\n<td><a href=\"http://build.fhir.org/subscriptions.html\\#overview-notificationNote\">http://build.fhir.org/subscriptions.html\\#overview-notificationNote</a>: missed listing this in current commit messages</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-28491\">FHIR#28491</a></td>\n<td>Reference from Subscription to SubscriptionTopic should be canonical</td>\n<td><a href=\"http://build.fhir.org/subscription-definitions.html\\#Subscription.topic\">http://build.fhir.org/subscription-definitions.html\\#Subscription.topic</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27149\">FHIR#27149</a></td>\n<td>We need a way to register know SubscriptionTopics</td>\n<td><a href=\"http://build.fhir.org/subscriptions.html\\#finding-topics\">http://build.fhir.org/subscriptions.html\\#finding-topics</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27148\">FHIR#27148</a></td>\n<td>Add prefer option for notification containing just url or request/response</td>\n<td><a href=\"http://build.fhir.org/subscription-definitions.html\\#Subscription.notificationUrlLocationNote\">http://build.fhir.org/subscription-definitions.html\\#Subscription.notificationUrlLocationNote</a>: not sure if listed in current commit messages</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27131\">FHIR#27131</a></td>\n<td>Subscription should state that eventsSinceSubscriptionStart is inclusive of current notification</td>\n<td><a href=\"http://build.fhir.org/subscriptionstatus.html\\#subscription-status\">http://build.fhir.org/subscriptionstatus.html\\#subscription-status</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27130\">FHIR#27130</a></td>\n<td>Add operation on Subscription to get current status</td>\n<td><a href=\"http://build.fhir.org/subscription-operation-status.html\">http://build.fhir.org/subscription-operation-status.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-27129\">FHIR#27129</a></td>\n<td>Update Subscription and SubscriptionStatus harmonize client status checks</td>\n<td><a href=\"http://build.fhir.org/subscription.html\">http://build.fhir.org/subscription.html</a> <a href=\"http://build.fhir.org/subscriptionstatus.html\">http://build.fhir.org/subscriptionstatus.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-26958\">FHIR#26958</a></td>\n<td>Add a note to Bundle indicating that Subscription Notification bundles are non-normative</td>\n<td><a href=\"http://build.fhir.org/bundle.html\\#subscription-notification\">http://build.fhir.org/bundle.html\\#subscription-notification</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-25928\">FHIR#25928</a></td>\n<td>Adding Subscription to \"Exchanging Resources\" section</td>\n<td><a href=\"http://build.fhir.org/subscriptions.html\">http://build.fhir.org/subscriptions.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-24448\">FHIR#24448</a></td>\n<td>Update documentation to document what fields a client can and cannot update</td>\n<td>Believe all the relevant fields have been removed from Subscription \\(e.g., everything left has implementation-specific rules\\). Need to check with Jenni if this feels correct to her.</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-24350\">FHIR#24350</a></td>\n<td>Topic.canFilterBy.matchType needs to be explicit what default behavior is</td>\n<td><a href=\"http://build.fhir.org/subscriptiontopic.html\">http://build.fhir.org/subscriptiontopic.html</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-23859\">FHIR#23859</a></td>\n<td>Create a new Bundle type for \"subscription notification\"</td>\n<td><a href=\"http://build.fhir.org/codesystem-bundle-type.html\">http://build.fhir.org/codesystem-bundle-type.html</a> <a href=\"http://build.fhir.org/bundle.html\\#subscription-notification\">http://build.fhir.org/bundle.html\\#subscription-notification</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-23738\">FHIR#23738</a></td>\n<td>Changes to Subscription to align with publish subscribe pattern using topic and filters</td>\n<td>Question: not sure when this should be moved to next state</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-22628\">FHIR#22628</a></td>\n<td>websocket subscriptions should also support payload</td>\n<td><a href=\"http://build.fhir.org/subscription.html\\#websockets\">http://build.fhir.org/subscription.html\\#websockets</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-21286\">FHIR#21286</a></td>\n<td>Email delivery options should be more specific</td>\n<td><a href=\"http://build.fhir.org/subscription.html\\#email\">http://build.fhir.org/subscription.html\\#email</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-21285\">FHIR#21285</a></td>\n<td>Make lack of payload and re-query behavior ore visible</td>\n<td>Covered by R5 redesign \\(empty payloads\\)</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-20476\">FHIR#20476</a></td>\n<td>Make Subscription.channel.type extensible</td>\n<td><a href=\"http://build.fhir.org/subscription-definitions.html\\#Subscription.channelType\">http://build.fhir.org/subscription-definitions.html\\#Subscription.channelType</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-19976\">FHIR#19976</a></td>\n<td>Clarify Subscription notification limitations</td>\n<td>Covered by R5 redesign \\(servers advertise supported SubscriptionTopics\\)</td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-19957\">FHIR#19957</a></td>\n<td>POST vs Update operation texts</td>\n<td><a href=\"http://build.fhir.org/subscription.html\\#rest-hook\">http://build.fhir.org/subscription.html\\#rest-hook</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-18994\">FHIR#18994</a></td>\n<td>Subscription: section on security considerations</td>\n<td><a href=\"http://build.fhir.org/subscriptions.html\\#safety\">http://build.fhir.org/subscriptions.html\\#safety</a></td>\n</tr>\n<tr>\n<td><a href=\"http://jira.hl7.org/browse/FHIR-18993\">FHIR#18993</a></td>\n<td>Subscription and Subscriber-side security</td>\n<td><a href=\"http://build.fhir.org/subscriptions.html\\#safety\">http://build.fhir.org/subscriptions.html\\#safety</a></td>\n</tr>\n</tbody>\n</table>",
        "id": 217135609,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1605707130
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  I would just like to understand this new Subscription/$get-ws-binding-token. Is this something required to do a web sockets subscription? Is it mentioned in the capability statement? I could not follow the documentation on how to use it. A little explanation may get my thick head on the right track - thanks</p>",
        "id": 235584083,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1619039903
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"192228\">@Brian Reinhold</span> , no worries.  Since you are on an R5 thread, I will <em>assume</em> you are asking about that operation in R5.  It is the same concept for the R4 backport, but some of the links are different.</p>\n<p>For a general overview of using Websockets, there is a section on the <a href=\"http://build.fhir.org/subscription.html#websockets\">subscription</a> page.  It has a flow-chart diagram that shows the whole workflow and a brief description of each step.  It should provide some context for all of this.</p>\n<p>That said, the <code>$get-ws-binding-token</code> operation is used to link together:</p>\n<ul>\n<li>An authenticated user session</li>\n<li>One or more subscriptions</li>\n<li>A websocket connection</li>\n</ul>\n<p>The reason why these extra steps exist is due to the first item in the list - websockets do not work with 'standard' REST security flows, and we still needed some way to validate a user connected via websockets.  Additionally, there are times that a single connection should be used for more than one subscription, and times that it's necessary to renew the token without recreating the websocket connection.</p>\n<p>But, we also can't do security design for implementations, so this was the mechanism we came up with.</p>\n<p>Since the operation is 'standard REST', the server gets to apply all of its normal security procedures before that call is executed.  The client system then uses that token over the websocket connection (via the <code>bind-with-token:</code> message) to let the websocket server know the same.</p>\n<p>Does that help clarify?</p>",
        "id": 235590285,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1619042962
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  Actually I am trying to get an two-year old subscriptions program working again (R4) and I am using the publicly available HAPI FHIR R4 server. What did not exist at the time I wrote my code was the returning of the logical id instead of just a 'ping' (which I had begged to get because it would greatly simply my existing code) and another bonus - a Capability Statement with an extension for the websocket address.<br>\nHowever, when I got the websocket address in the extension, appended it to the base URL replacing the http with ws, it failed with a 404 error. So I went back to the subscription and saw this $get-ws-binding-token operation which I had never heard of before. Maybe it's the websocket equivalent of an oAuth token? <strong>In any case I did a search on this site and this thread was the only hit I got.</strong> What I was really wondering is if this operation is required, how to find out if it is required, and how to use it if it is required, and if that was the cause of the 404 error.</p>",
        "id": 235639044,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1619080161
    },
    {
        "content": "<p>Ah, the R4 IG for this was just balloted, so I doubt support is there for it in HAPI yet.</p>",
        "id": 235668996,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1619095110
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span>  Well that's actually good for me - it means that this web socket token is not my problem!</p>",
        "id": 235735743,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1619120220
    }
]