[
    {
        "content": "<p>Is there a basic set of FHIR resources and operations that need to be supported by a FHIR server for it to work with ClinFHIR? Once I select a patient from our server (<a href=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/\" target=\"_blank\" title=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/\">https://fhirsandbox1.tsysinteropsvcs.net/sites/123/</a>), the icon in the top right keeps spinning like it is in the process of loading something but I don't see any outstanding requests. Is it requiring $everything, Basic, or List to load the associated resources for the patient? Thanks.</p>",
        "id": 153853806,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477149604
    },
    {
        "content": "<p>Hi Chuck - yes, it does use the $everything operation to retrieve all the data for that patient - will that be difficult to add? (I need to at least give a better error message) rather than just hanging - if you check the browser console you'll see the errors that occurred...</p>\n<p>btw - you'll also need to enable CORS if you want to be able to write data...</p>",
        "id": 153853807,
        "sender_full_name": "David Hay",
        "timestamp": 1477160234
    },
    {
        "content": "<p>OK - have pushed a fix that means it will load specific resources - currently these are: Observation, Encounter ,Appointment, Condition, List, Basic (I can add others, but needs a code update to do so). It does assume that the server supports a query on patient/subject - eg Encounter?patient={id}...</p>",
        "id": 153853809,
        "sender_full_name": "David Hay",
        "timestamp": 1477161976
    },
    {
        "content": "<p>You'll still need CORS to write though...</p>",
        "id": 153853810,
        "sender_full_name": "David Hay",
        "timestamp": 1477161994
    },
    {
        "content": "<p>Thanks David! I will look into adding $everything. So far we just have support for calling each one of the resources. What are you expecting returned for List and Basic? The spec seems to suggest several different uses for them. Here again we were expecting the data to be retrieved from the individual resource routes. Will check the console and make some more updates to improve the interaction. Thanks for the help.</p>",
        "id": 153853814,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477178726
    },
    {
        "content": "<p>Well, they can both be used for all sorts of useful things! clinFHIR just retrieves them for display..<br>\nIf you want me to add other resources in the mean time just ask - it's only a single line to add for each resource type to retrieve!</p>",
        "id": 153853819,
        "sender_full_name": "David Hay",
        "timestamp": 1477208104
    },
    {
        "content": "<p>Hi David. Thanks for the info. How about adding AllergyIntolerance and MedicationStatement?</p>",
        "id": 153853912,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477324850
    },
    {
        "content": "<p>done...</p>",
        "id": 153853926,
        "sender_full_name": "David Hay",
        "timestamp": 1477331912
    },
    {
        "content": "<p>Great. Thanks David.</p>",
        "id": 153854021,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477343712
    },
    {
        "content": "<p>David. I enabled the CORS support on the server. When adding a patient it is getting added fine to the server but it appears that ClinFHIR is having trouble extracting the id from the returned resource; \"err\":\"The server did not return a valid id\".</p>",
        "id": 153854145,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477400226
    },
    {
        "content": "<p>Hey Chuck, you might want to consider running some of the online test tools like <a href=\"http://ProjectCrucible.org\" target=\"_blank\" title=\"http://ProjectCrucible.org\">ProjectCrucible.org</a>, or the Aegis touchstone test tools.<br>\nThey should be able to assist with testing server creates of resources really well.</p>",
        "id": 153854206,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1477420980
    },
    {
        "content": "<p>Hi Chuck - which patient? (But Brians suggestion is an excellent one)...</p>",
        "id": 153854309,
        "sender_full_name": "David Hay",
        "timestamp": 1477436236
    },
    {
        "content": "<p>Yes, I have run the Aegis Touchstone Add Patient test and that works. When I use ClinFHIR to create a patient, I can see in the Chrome developer tools that a Patient resource with an id is getting returned from the FHIR server (<a href=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/\" target=\"_blank\" title=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/\">https://fhirsandbox1.tsysinteropsvcs.net/sites/123/</a>) but ClinFHIR is throwing an error that it can not find a valid id. Here is the returned json: {\"resourceType\":\"Patient\",\"id\":\"56\",\"text\":{\"status\":\"generated\",\"div\":\"&lt;div xmlns='<a href=\"http://www.w3.org\" target=\"_blank\" title=\"http://www.w3.org\">http://www.w3.org</a><br>\n/1999/xhtml'&gt;Ivy Wright&lt;/div&gt;\"},\"name\":[{\"use\":\"official\",\"text\":\"Ivy Wright\",\"family\":[\"Wright\"],\"given\"<br>\n:[\"Ivy\"]}],\"gender\":\"female\",\"birthDate\":\"1951-08-27\"}</p>",
        "id": 153854363,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477503119
    },
    {
        "content": "<p>id=56? lemme go look...</p>",
        "id": 153854384,
        "sender_full_name": "David Hay",
        "timestamp": 1477513256
    },
    {
        "content": "<p>So I get some resources back when I select that patient directly (Condition &amp; Encounter) but a 404 (with an html response) for th others - try <a href=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=56&amp;_count=100\" target=\"_blank\" title=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=56&amp;_count=100\">https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=56&amp;_count=100</a></p>\n<p>should return an OperationOutcome (ideally) - but not html...</p>",
        "id": 153854393,
        "sender_full_name": "David Hay",
        "timestamp": 1477513760
    },
    {
        "content": "<p>I also get a CORS error on some of the others as well.<br>\nBut I don't get any error being thrown by CF - can you list the sequence of events that results in the error?</p>",
        "id": 153854394,
        "sender_full_name": "David Hay",
        "timestamp": 1477513925
    },
    {
        "content": "<p>Does the clinFHIR read the id from the resource, or check the location header value?<br>\n(as not all servers return the complete resource, but all should return the location header)<br>\n<a href=\"http://hl7.org/fhir/http.html#create\" target=\"_blank\" title=\"http://hl7.org/fhir/http.html#create\">http://hl7.org/fhir/http.html#create</a> (covers the location header)<br>\n<a href=\"http://hl7.org/fhir/http.html#2.1.0.5.2\" target=\"_blank\" title=\"http://hl7.org/fhir/http.html#2.1.0.5.2\">http://hl7.org/fhir/http.html#2.1.0.5.2</a> (the prefer header in the request)</p>",
        "id": 153854411,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1477515469
    },
    {
        "content": "<p>Here is the sequence of events: <br>\n1. On the main ClinFHIR page, click on \"Select Patient\"<br>\n2. On \"Search for Patient\" popup, click on \"Add new patient\"<br>\n3. Values for new patient get auto-populated. Click on \"Add patient\" button.<br>\n4. ClinFHIR sends POST to FHIR server to create patient.<br>\n5. FHIR server creates patient and returns patient resource with ID now populated.<br>\n6. ClinFHIR issues error message that it can not extract the ID.</p>",
        "id": 153854435,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477516177
    },
    {
        "content": "<p>I think brian has it - here's the code:</p>\n<p>var serverId;<br>\n        serverId = headers('Content-Location');<br>\n        if (! serverId) {<br>\n            serverId = headers('Location');<br>\n        }<br>\n(serverId is the id the server allocates...)</p>",
        "id": 153854453,
        "sender_full_name": "David Hay",
        "timestamp": 1477516738
    },
    {
        "content": "<p>The server is returning the following Location header in the response.<br>\nLocation: <a href=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Patient/56\" target=\"_blank\" title=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Patient/56\">https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Patient/56</a><br>\nIs it perhaps expecting the version id as well? We do not support history so that is why it is not included.<br>\n  Location: [base]/[type]/[id]/_history/[vid]</p>",
        "id": 153854463,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477518011
    },
    {
        "content": "<p>Yeah - that's the issue, it expects a version specific id. I'll make the parsing more robust and let you know when that's been done... </p>",
        "id": 153854475,
        "sender_full_name": "David Hay",
        "timestamp": 1477522239
    },
    {
        "content": "<p>Great. Thanks David and Brian.</p>",
        "id": 153854478,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477524187
    },
    {
        "content": "<p>So I'm getting a weird error where the save works, but I can't read your headers from within the app (angular based). I note that in your cors response you return \"Access-Control-Allow-Origin:<a href=\"http://clinfhir.com\" target=\"_blank\" title=\"http://clinfhir.com\">http://clinfhir.com</a> \" but this is https - Could that be the issue? Can you change it to Access-Control-Allow-Origin:*  and see if that helps...</p>",
        "id": 153854479,
        "sender_full_name": "David Hay",
        "timestamp": 1477524302
    },
    {
        "content": "<p>David, changed it to Access-Control-Allow-Origin:*. Still seeing the issue.</p>",
        "id": 153854531,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1477574168
    },
    {
        "content": "<p>I may have it. According to this post (<a href=\"http://stackoverflow.com/questions/32404092/response-header-is-present-in-browser-but-not-parsed-by-angular-http-response-h\" target=\"_blank\" title=\"http://stackoverflow.com/questions/32404092/response-header-is-present-in-browser-but-not-parsed-by-angular-http-response-h\">http://stackoverflow.com/questions/32404092/response-header-is-present-in-browser-but-not-parsed-by-angular-http-response-h</a> ) you also need to include the \"Access-Control-Expose-Headers\" response header to something like Content-Location,Location.</p>\n<p>Can you try that?</p>",
        "id": 153854776,
        "sender_full_name": "David Hay",
        "timestamp": 1477764636
    },
    {
        "content": "<p>That rings a bell here for something I had to do on my server too. Will check</p>",
        "id": 153855068,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1478051959
    },
    {
        "content": "<p>Thanks David. Looks like that did it. I included the \"Access-Control-Expose-Headers\" response header and am now able to add patient without generating the samples. Looks like that requires some dependent resources we do not currently support. Thanks for the help.</p>",
        "id": 153855094,
        "sender_full_name": "Chuck Feltner",
        "timestamp": 1478104687
    },
    {
        "content": "<p>Glad to hear it! Hopefully will help out the next person :)</p>\n<p>Looking through the responses, a query like: <a href=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=71&amp;_count=100\" target=\"_blank\" title=\"https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=71&amp;_count=100\">https://fhirsandbox1.tsysinteropsvcs.net/sites/123/Appointment?patient=71&amp;_count=100</a>  returns a 404, but also an html page with no cors data - hence the message. You might want to consider returning an OperationOutcome resource rather than html (and I should read your conformance - soon to be CapabilityStatement and adjust accordingly....)</p>\n<p>You might also want to consider the $everything operation...</p>",
        "id": 153855097,
        "sender_full_name": "David Hay",
        "timestamp": 1478107076
    }
]