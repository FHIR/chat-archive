[
    {
        "content": "<p>Hello,</p>\n<p>On the FHIR site for the $process-message operation (<a href=\"https://www.hl7.org/fhir/messageheader-operation-process-message.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/messageheader-operation-process-message.html\">https://www.hl7.org/fhir/messageheader-operation-process-message.html</a>), it says:<br>\n<em>The response content type returned is always Bundle with type “message” containing a MessageHeader resource as the first resource, or an HTTP error</em></p>\n<p>But then on the page, it later says:<br>\n<em>The server acknowledges the message with a 200 OK <strong>with no body</strong></em></p>\n<p>The example on the page aligns with the latter.</p>\n<p>Can anyone advise on the standard format for the response? Should it really always be a Bundle with a MessageHeader resource? Also Bundle type “transaction-response” seems more appropriate than “message”.</p>\n<p>Thanks</p>",
        "id": 181661059,
        "sender_full_name": "Alison Lo",
        "timestamp": 1574444853
    },
    {
        "content": "<p>It also says...</p>",
        "id": 181666878,
        "sender_full_name": "Eric Haas",
        "timestamp": 1574448916
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222261\">@Alison Lo</span> You are correct that the existing wording is a bit misleading.  The actual options are: 200 with no body <em>or</em> a message Bundle or an HTTP error code and an OperationOutcome.  In theory I guess you could also have a 200 with an OperationOutcome containing only warnings, but so far no one's had a use-case for that.</p>",
        "id": 181671153,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574452231
    },
    {
        "content": "<p>transaction-response is only allowed as a response to a REST transaction.  The only allowed response to a successful message (if a response is given) is another message.</p>",
        "id": 181671202,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574452262
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 181671626,
        "sender_full_name": "Alison Lo",
        "timestamp": 1574452539
    },
    {
        "content": "<p>After reading the do I again it does say fir sync messaging a message bundle is required.   (In the out parameter conments). But the formal def is 0..1.  I think that it should be ok to have no response message but is that sync or a sync?</p>",
        "id": 181674898,
        "sender_full_name": "Eric Haas",
        "timestamp": 1574455139
    },
    {
        "content": "<p>That is a bit confusing to me</p>",
        "id": 181674919,
        "sender_full_name": "Eric Haas",
        "timestamp": 1574455162
    },
    {
        "content": "<p>Even for sync, no response is a possibility.  If I send you an ADT notification, you might respond with a bare 200 - the equivalent of an accept ack in v2.</p>",
        "id": 181676774,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574456599
    },
    {
        "content": "<p>but then this  comment is then misleading. (highlights from me)</p>\n<blockquote>\n<p>A response message, if synchronous messaging is being used <strong>(mandatory in this case)</strong>. For asynchronous messaging, there is no return value<br>\nNote: as this is the only out parameter, it is a resource, and it has the name 'return', the result of this operation is returned directly as a resource</p>\n</blockquote>\n<p>I think it should say:</p>\n<blockquote>\n<p>A response message used for synchronous messaging unless no response is expected.  For asynchronous messaging, there is no return value<br>\nNote: as this is the only out parameter, it is a resource, and it has the name 'return', the result of this operation is returned directly as a resource</p>\n</blockquote>\n<p>Does that sound like a change request?</p>",
        "id": 181848533,
        "sender_full_name": "Eric Haas",
        "timestamp": 1574706052
    },
    {
        "content": "<p>It does indeed.</p>",
        "id": 181857743,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574712322
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"222261\">@Alison Lo</span> would you be willing to submit one?</p>",
        "id": 181857765,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574712344
    },
    {
        "content": "<p>CR created: <a href=\"https://jira.hl7.org/browse/FHIR-25252\" target=\"_blank\" title=\"https://jira.hl7.org/browse/FHIR-25252\">https://jira.hl7.org/browse/FHIR-25252</a><br>\nThanks</p>",
        "id": 181862134,
        "sender_full_name": "Alison Lo",
        "timestamp": 1574715549
    },
    {
        "content": "<p>The quoted blurb \"The server acknowledges the message with a 200 OK with no body\" appears under the heading \"The following rules apply when using the $process-message operation asynchronously\", on both <a href=\"https://www.hl7.org/fhir/messageheader-operation-process-message.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/messageheader-operation-process-message.html\">https://www.hl7.org/fhir/messageheader-operation-process-message.html</a> and <a href=\"https://www.hl7.org/fhir/operation-messageheader-process-message.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/operation-messageheader-process-message.html\">https://www.hl7.org/fhir/operation-messageheader-process-message.html</a></p>\n<p>The formal definition of Out 0..1 is accounting for the async response -- you can't asynchronously respond with a response body -- that would make it synchronous. The documentation states that this is mandatory for synchronous -- is there a way to define invariants or conditionals in an OperationOutcome?</p>\n<p>I wonder about the initial decision for stating that synchronous messages must always respond with a Message Bundle, and if we're missing some previous business case for the mandatory response.</p>",
        "id": 183336987,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1576224772
    },
    {
        "content": "<p>Why can't you asynchronously respond with a message body?  That would just mean posting a message to the other system's endpoint (or an intermediary endpoint intended to eventually get to the other system)</p>",
        "id": 183354089,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1576240102
    },
    {
        "content": "<p>I am logging a tracker to. Propose loosening up the guidance surrounding  synchronous messaging.  For Notifications no response is required besides an http response. Or possibly an operation outcome</p>",
        "id": 183367279,
        "sender_full_name": "Eric Haas",
        "timestamp": 1576249731
    },
    {
        "content": "<p>Is there even a distinction between sync and async $process-message then?</p>",
        "id": 183369146,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1576250868
    },
    {
        "content": "<p>I think the statement is that you cannot include a message body as the synchronous response for the process message operation.</p>\n<p>To expand:</p>\n<ul>\n<li>synchronous $process-message immediate response - can be just HTTP 200, or may contain a message bundle (or is it that it always has to have a message bundle with an ACK?)</li>\n<li>asynchronous $process-message immediate response - can only be HTTP 200. A message bundle may be \"pushed\" separately to a different end point - the asynchronous response.</li>\n</ul>",
        "id": 183369706,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1576251148
    },
    {
        "content": "<p>Yes It is confusing to talk about  sync or  a async for the notifications use case where all you expect is a http response ( no ack in V2 speak). The assumption here is the 200 replaces the Ack response.  Application acknowledgement is a separate issue btw.</p>",
        "id": 183390722,
        "sender_full_name": "Eric Haas",
        "timestamp": 1576264777
    },
    {
        "content": "<p>I consider that a sync with no response message.</p>",
        "id": 183390841,
        "sender_full_name": "Eric Haas",
        "timestamp": 1576264822
    },
    {
        "content": "<p>It doesn't make sense to me that a system couldn't submit a message expecting an async response and get an immediate response.  Why would we want to prohibit that?</p>",
        "id": 183392600,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1576265892
    },
    {
        "content": "<p>Because the system submitting the message and expecting an async response, may not be able to process an immediate response. How can you assume that it will be able to process it? If it were able to, it won't be requesting an async response, would it?</p>",
        "id": 183393504,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1576266411
    },
    {
        "content": "<p>For the purposes of conformance with R4 (against both the documentation as written i.e. \"mandatory in this case\", as well as the operation's CapabilityStatement), is a synchronous $process-message returning an HTTP 200 with no payload conformant, for the current release of FHIR?</p>",
        "id": 184309890,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1577437873
    },
    {
        "content": "<p>Yes</p>",
        "id": 184323252,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1577456145
    },
    {
        "content": "<p>On my endpoint I'm validating (hl7v2 converted to fhir and fhir messages) and converting them to transactions before accepting them. So its desirable to get transaction bundles for accepted messages or operation outcomes for rejected.</p>\n<p>If I went synchronous a transaction response would also be desirable, for debug purposes in all cases.</p>\n<p>200 response works for me but no payload doesn't seem practical. I know this is a hack at present but getting a bundle for p+h hl7v2 messages when media is set to fhir is very useful.</p>",
        "id": 184455539,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1577689524
    },
    {
        "content": "<p>I amn confused by ...</p>\n<blockquote>\n<p>So its desirable to get transaction bundles for accepted messages or operation outcomes for rejected.</p>\n</blockquote>\n<p>do you mean a transaction <em>response</em> bundle or a <em>message response</em> bundle ?</p>",
        "id": 184492087,
        "sender_full_name": "Eric Haas",
        "timestamp": 1577731847
    },
    {
        "content": "<p>Message response bundle. I've not got that far yet and currently return the response from HAPI - I'm finding that useful and so good enough for now.</p>",
        "id": 184551686,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1577809176
    }
]