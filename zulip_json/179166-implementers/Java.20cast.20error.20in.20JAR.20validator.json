[
    {
        "content": "<p>End of last week, I started seeing the following Java error being thrown by the latest version of the standard JAR validator (<a href=\"https://build.fhir.org/validator.zip\" target=\"_blank\" title=\"https://build.fhir.org/validator.zip\">https://build.fhir.org/validator.zip</a>) when validating STU3 resources:</p>\n<div class=\"codehilite\"><pre><span></span>Error java.lang.ClassCastException: org.hl7.fhir.r4.model.Parameters cannot be cast to org.hl7.fhir.r4.model.TerminologyCapabilities validating Coding`\n</pre></div>\n\n\n<p>For instance, here is the output when running against one of the standard STU3 examples (<a href=\"https://www.hl7.org/fhir/observation-example.xml\" target=\"_blank\" title=\"https://www.hl7.org/fhir/observation-example.xml\">https://www.hl7.org/fhir/observation-example.xml</a>):</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar -version 3.0.1 observation-example.xml\nFHIR Validator Build ??\nArguments: -version 3.0.1 observation-example.xml\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1-null)\n  .. validate [observation-example.xml]\nTerminology server: Check for supported code systems for http://loinc.org\nTerminology server: Check for supported code systems for http://loinc.org\nTerminology server: Check for supported code systems for http://acme.org/devices/clinical-codes\n*FAILURE* validating observation-example.xml:  error:4 warn:0 info:0\n  Error @ Observation.code.coding[1] (line 21, col11) : Error java.lang.ClassCastException: org.hl7.fhir.r4.model.Parameters cannot be cast to org.hl7.fhir.r4.model.TerminologyCapabilities validating Coding\n  Error @ Observation.code.coding[2] (line 26, col11) : Error java.lang.ClassCastException: org.hl7.fhir.r4.model.Parameters cannot be cast to org.hl7.fhir.r4.model.TerminologyCapabilities validating Coding\n  Error @ Observation.code.coding[3] (line 32, col11) : Code system validation not supported in R2\n  Error @ Observation.code.coding[4] (line 38, col11) : Error java.lang.ClassCastException: org.hl7.fhir.r4.model.Parameters cannot be cast to org.hl7.fhir.r4.model.TerminologyCapabilities validating Coding\n</pre></div>\n\n\n<p>Has anyone seen this or, even better, know a way around it?</p>\n<p>Running without a terminology server (<code>-tx n/a</code>) does not lead to the above error. However, I see that using this option now itself causes the validation to fail (<code>Error validating code: running without terminology services</code>), which I do not quite understand. After all, I explicitly switched it off and the validator outputs a large warning about this at the top, so why is this also a <em>validation</em> error for the resource? Is there now some other way to switch of terminology checks without causing an error (e.g. to avoid a CI pipeline with automatic validation breaking if no terminology server is available)?</p>",
        "id": 154009077,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1539607276
    },
    {
        "content": "<p>do you get a stack dump?</p>",
        "id": 154009083,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1539608491
    },
    {
        "content": "<p>I only get the output I pasted in above (not sure how I can convince the JVM to say more...)</p>",
        "id": 154009093,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1539612244
    },
    {
        "content": "<p>Without knowing how you ran the validator, this looks like a FHIR version issue. That's an R4 (release candidate 4/STU4) class, so it shouldn't be used to validate STU3 resources. The right class would be org.hl7.fhir.dstu3.model.Parameters.</p>\n<p>Unless I'm misunderstanding and you intended to validate R4 resources?</p>",
        "id": 154009104,
        "sender_full_name": "Michael Riley",
        "timestamp": 1539615127
    },
    {
        "content": "<p>this is a bug in the validator. I'm mystified how this passes the JUnit tests that are part of the build that run exactly this test. because due to a bug in my code this will fail.</p>",
        "id": 154009184,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1539626060
    },
    {
        "content": "<p>found and fixed the problems, and added a few more tests. Will let you know when it is released</p>",
        "id": 154009190,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1539628945
    },
    {
        "content": "<p>released</p>",
        "id": 154009224,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1539634507
    },
    {
        "content": "<p>Awesome, thank you <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>!</p>",
        "id": 154009374,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1539672817
    }
]