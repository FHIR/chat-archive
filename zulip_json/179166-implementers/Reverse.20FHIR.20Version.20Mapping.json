[
    {
        "content": "<p>Howdy <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> . I've tested using org.hl7.fhir.convertors.VersionConvertor_30_40 (<a href=\"https://github.com/hapifhir/org.hl7.fhir.core\" title=\"https://github.com/hapifhir/org.hl7.fhir.core\">https://github.com/hapifhir/org.hl7.fhir.core</a>) to convert some STU3 resources to R4 and from what I've seen so far this seems to match my own original implementation. However, we also have the need to convert back from R4 to STU3 for a number of resources. I can't find anything in the org.hl7.fhir.convertors project that does that. I've also noticed that there are StructureMaps on the HL7 site for this purpose so I'm hoping there may already be an implementation. Is there any intention to incorporate the back conversion into the convertors project? I <em>think</em> I've got something that covers our discrete requirements but would prefer to use an existing library if there's something available.</p>",
        "id": 192480220,
        "sender_full_name": "Luke Swindale",
        "timestamp": 1585712226
    },
    {
        "content": "<p>VersionConvertor_30_40 mostly has bidirectional converters. what resource types are you interested in?</p>",
        "id": 192480444,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585712588
    },
    {
        "content": "<p>oh right. I <del>mustn't</del> didn't have had a good enough look. At the moment, just CodeSystem, ValueSet and ConceptMap. At the moment I've got the following. Obviously, VersionConverter_40_30 doesn't exist, so that'll be the bit I need to work out. Cheers. </p>\n<div class=\"codehilite\"><pre><span></span>           <span class=\"n\">IBaseResource</span> <span class=\"n\">sourceResource</span> <span class=\"o\">=</span> <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"na\">sourceJsonParser</span><span class=\"p\">.</span><span class=\"na\">parseResource</span><span class=\"p\">(</span><span class=\"n\">reader</span><span class=\"p\">);</span>\n            <span class=\"n\">IBaseResource</span> <span class=\"n\">targetResource</span> <span class=\"o\">=</span> <span class=\"kc\">null</span><span class=\"p\">;</span>\n\n            <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">sourceResource</span><span class=\"p\">.</span><span class=\"na\">getStructureFhirVersionEnum</span><span class=\"p\">().</span><span class=\"na\">isEquivalentTo</span><span class=\"p\">(</span><span class=\"n\">FhirVersionEnum</span><span class=\"p\">.</span><span class=\"na\">DSTU3</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span>\n                    <span class=\"n\">targetResource</span><span class=\"p\">.</span><span class=\"na\">getStructureFhirVersionEnum</span><span class=\"p\">().</span><span class=\"na\">isEquivalentTo</span><span class=\"p\">(</span><span class=\"n\">FhirVersionEnum</span><span class=\"p\">.</span><span class=\"na\">R4</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n                <span class=\"n\">targetResource</span> <span class=\"o\">=</span> <span class=\"n\">VersionConvertor_30_40</span><span class=\"p\">.</span><span class=\"na\">convertResource</span><span class=\"p\">((</span><span class=\"n\">Resource</span><span class=\"p\">)</span> <span class=\"n\">sourceResource</span><span class=\"p\">,</span> <span class=\"kc\">true</span><span class=\"p\">);</span>\n            <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"k\">if</span> <span class=\"p\">(</span><span class=\"n\">sourceResource</span><span class=\"p\">.</span><span class=\"na\">getStructureFhirVersionEnum</span><span class=\"p\">().</span><span class=\"na\">isEquivalentTo</span><span class=\"p\">(</span><span class=\"n\">FhirVersionEnum</span><span class=\"p\">.</span><span class=\"na\">R4</span><span class=\"p\">)</span> <span class=\"o\">&amp;&amp;</span>\n                    <span class=\"n\">targetResource</span><span class=\"p\">.</span><span class=\"na\">getStructureFhirVersionEnum</span><span class=\"p\">().</span><span class=\"na\">isEquivalentTo</span><span class=\"p\">(</span><span class=\"n\">FhirVersionEnum</span><span class=\"p\">.</span><span class=\"na\">DSTU3</span><span class=\"p\">))</span> <span class=\"p\">{</span>\n                <span class=\"n\">targetResource</span> <span class=\"o\">=</span> <span class=\"n\">VersionConvertor_40_30</span><span class=\"p\">.</span><span class=\"na\">convertResource</span><span class=\"p\">((</span><span class=\"n\">Resource</span><span class=\"p\">)</span> <span class=\"n\">sourceResource</span><span class=\"p\">,</span> <span class=\"kc\">true</span><span class=\"p\">);</span>\n            <span class=\"p\">}</span> <span class=\"k\">else</span> <span class=\"p\">{</span>\n                <span class=\"n\">targetResource</span> <span class=\"o\">=</span> <span class=\"n\">VersionConvertor_30_40</span><span class=\"p\">.</span><span class=\"na\">convertResource</span><span class=\"p\">((</span><span class=\"n\">Resource</span><span class=\"p\">)</span> <span class=\"n\">sourceResource</span><span class=\"p\">,</span> <span class=\"kc\">true</span><span class=\"p\">);</span>\n            <span class=\"p\">}</span>\n\n            <span class=\"k\">this</span><span class=\"p\">.</span><span class=\"na\">targetJsonParser</span><span class=\"p\">.</span><span class=\"na\">encodeResourceToWriter</span><span class=\"p\">(</span><span class=\"n\">targetResource</span><span class=\"p\">,</span> <span class=\"n\">writer</span><span class=\"p\">);</span>\n</pre></div>",
        "id": 192482735,
        "sender_full_name": "Luke Swindale",
        "timestamp": 1585715855
    },
    {
        "content": "<p>no the 30_40 has methods for both ways for those classes.</p>",
        "id": 192482921,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585716120
    },
    {
        "content": "<p>e.g. org.hl7.fhir.convertors.conv30_40.CodeSystem30_40 has both</p>\n<div class=\"codehilite\"><pre><span></span>  <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">r4</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">CodeSystem</span> <span class=\"nf\">convertCodeSystem</span><span class=\"p\">(</span><span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">dstu3</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">CodeSystem</span> <span class=\"n\">src</span><span class=\"p\">);</span>\n</pre></div>\n\n\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span>  <span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">dstu3</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">CodeSystem</span> <span class=\"nf\">convertCodeSystem</span><span class=\"p\">(</span><span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">r4</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">CodeSystem</span> <span class=\"n\">src</span><span class=\"p\">)</span> <span class=\"p\">{</span>\n</pre></div>",
        "id": 192482993,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585716185
    },
    {
        "content": "<p>wow.... I really should have looked harder. Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ! Thats a big help</p>",
        "id": 192483062,
        "sender_full_name": "Luke Swindale",
        "timestamp": 1585716263
    },
    {
        "content": "<p>and VersionConvertor_30_40 has</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">r4</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">Resource</span> <span class=\"nf\">convertResource</span><span class=\"p\">(</span><span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">dstu3</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">Resource</span> <span class=\"n\">src</span><span class=\"p\">,</span> <span class=\"kt\">boolean</span> <span class=\"n\">nullOk</span><span class=\"p\">);</span>\n</pre></div>\n\n\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"kd\">public</span> <span class=\"kd\">static</span> <span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">r4</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">Resource</span> <span class=\"nf\">convertResource</span><span class=\"p\">(</span><span class=\"n\">org</span><span class=\"p\">.</span><span class=\"na\">hl7</span><span class=\"p\">.</span><span class=\"na\">fhir</span><span class=\"p\">.</span><span class=\"na\">dstu3</span><span class=\"p\">.</span><span class=\"na\">model</span><span class=\"p\">.</span><span class=\"na\">Resource</span> <span class=\"n\">src</span><span class=\"p\">,</span> <span class=\"kt\">boolean</span> <span class=\"n\">nullOk</span><span class=\"p\">);</span>\n</pre></div>",
        "id": 192483070,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585716291
    }
]