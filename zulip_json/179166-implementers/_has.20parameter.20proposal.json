[
    {
        "content": "<p>Hi All,</p>\n<p>Today in the FHIR-I meeting in Montreal, we discussed a proposal to allow a new search parameter <code>_has</code> which could be used to fulfill searches for resources that are linked to by other resources, without returning the resources that link to them. This could be used, for example:</p>\n<ul>\n<li>Return a bundle of patients that have a given condition</li>\n<li>Return a bundle of observations with a given provenance</li>\n<li>etc..</li>\n</ul>\n<p>The proposal is <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9864\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9864\">here</a>. We have deciced to hold a virtual mini-connectathon, where I will be implementing this on the HAPI public server. We are now soliciting potential testing partners (or even descriptions of scenarios where this would be useful) in order to gauge whether this is worth pursuing or not.</p>",
        "id": 153826141,
        "sender_full_name": "James Agnew",
        "timestamp": 1462825398
    },
    {
        "content": "<p>I'm going to implement as well</p>",
        "id": 153826142,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462825567
    },
    {
        "content": "<p>As mentioned, I think this is very helpful in making the Provenance resource usable in the context of mapping V2 snapshot style messages to  FHIR. I will give it a try to reimplement the Atlanta V2 Mapping scenario leveraging Provenance &amp; _has and see how that works out. (Specifically: Delete all AllergyIntolerance resources of a Patient submitted by a specific Agent before adding new AllergyIntolerances). So the DELETE Condition will have a _has criteria to fetch all AllergyIntolerances that have a Provenance with Agent X. Does that make sense?</p>",
        "id": 153826146,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462825878
    },
    {
        "content": "<p>This syntax is peculiar. _has isn't a query parameter in the gForge examples.</p>",
        "id": 153826159,
        "sender_full_name": "Peter Bernhardt",
        "timestamp": 1462827515
    },
    {
        "content": "<p>got any better suggestions?</p>",
        "id": 153826160,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462827580
    },
    {
        "content": "<p>I suppose it could work if you had _has=&lt;url encode rest of it&gt;</p>",
        "id": 153826161,
        "sender_full_name": "Peter Bernhardt",
        "timestamp": 1462827595
    },
    {
        "content": "<p>So like the following? <code>Patient?_has=Observation:subject:status:final</code></p>",
        "id": 153826162,
        "sender_full_name": "James Agnew",
        "timestamp": 1462827717
    },
    {
        "content": "<p>that's better, James</p>",
        "id": 153826165,
        "sender_full_name": "Peter Bernhardt",
        "timestamp": 1462827742
    },
    {
        "content": "<p>or :final could be encoded as =final</p>",
        "id": 153826167,
        "sender_full_name": "Peter Bernhardt",
        "timestamp": 1462827771
    },
    {
        "content": "<p>It's less consistent with other things in FHIR, though. We use the pattern of <code>parameter:modifier=value</code> quite a bit in the REST interface.</p>",
        "id": 153826168,
        "sender_full_name": "James Agnew",
        "timestamp": 1462827805
    },
    {
        "content": "<p>ur right about that, James. But those modifiers are strictly defined. I guess my initial reaction was that this type of pattern is unbounded in terms of how _has could be modified. Maybe your mini-connectathon will uncover whether or not this is a valid concern.</p>",
        "id": 153826173,
        "sender_full_name": "Peter Bernhardt",
        "timestamp": 1462829604
    },
    {
        "content": "<p>well, we use . too</p>",
        "id": 153826181,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462831746
    },
    {
        "content": "<p>for chaining</p>",
        "id": 153826182,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462831758
    },
    {
        "content": "<p>Yes, yes and yes. :)</p>",
        "id": 153826230,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462834872
    },
    {
        "content": "<p>The HAPI Server fully supports this. Grahame's currently doesn't replace the UUID in the Encounter for the actual reference to the matched patient. Neither does Spark.</p>",
        "id": 153826231,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462834991
    },
    {
        "content": "<p>FYI I have started a tracking page here: <a href=\"http://wiki.hl7.org/index.php?title=FHIR_Has_Parameter_Issue_Page\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=FHIR_Has_Parameter_Issue_Page\">http://wiki.hl7.org/index.php?title=FHIR_Has_Parameter_Issue_Page</a></p>",
        "id": 153826283,
        "sender_full_name": "James Agnew",
        "timestamp": 1462883426
    },
    {
        "content": "<p>I found the discussion difficult to contribute to mostly because the proposal is in terms of examples rather than a grammar modification, so it's not clear what is intended regarding multiple _has (if any) and the meaning of nested _has sub clauses</p>",
        "id": 153826285,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1462884028
    },
    {
        "content": "<p>I'm not saying this is some silver bullet approach ... I'm just listing how eg. Google does it: <a href=\"https://developers.google.com/ad-exchange/seller-rest/filters#combiningFilters\" target=\"_blank\" title=\"https://developers.google.com/ad-exchange/seller-rest/filters#combiningFilters\">https://developers.google.com/ad-exchange/seller-rest/filters#combiningFilters</a></p>",
        "id": 153826288,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1462884345
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> I don't know that we've heard any use cases for either of those scenarios yet that might dictate the right behaviour. I have opinions on what would be most intuitive, but hopefully we'll come up with some real use cases to guide us there.</p>\n<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> Yeah, that is basically how the FHIR API does AND/OR relations too, which is nice. I'd addume we want to be consistent, but it's not 100% clear what would be most consistent for <code>_has</code></p>",
        "id": 153826321,
        "sender_full_name": "James Agnew",
        "timestamp": 1462892935
    },
    {
        "content": "<p>And to all- I've deployed an update to HAPI's server that implements has. Example: <a href=\"http://fhirtest.uhn.ca/baseDstu3/Patient?_has:Observation:subject:status=final\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu3/Patient?_has:Observation:subject:status=final\">http://fhirtest.uhn.ca/baseDstu3/Patient?_has:Observation:subject:status=final</a></p>",
        "id": 153826323,
        "sender_full_name": "James Agnew",
        "timestamp": 1462893035
    },
    {
        "content": "<p>awesome. can you chain _has?</p>",
        "id": 153826382,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462897359
    },
    {
        "content": "<p>Yup, that should work</p>",
        "id": 153826383,
        "sender_full_name": "James Agnew",
        "timestamp": 1462897393
    },
    {
        "content": "<p>Added my 2 cents to the discussion page....not sure what the etiquette is? I just appended my thoughts.</p>",
        "id": 153826447,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1462907160
    },
    {
        "content": "<p>Ok, so I created this:</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Provenance</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;68538&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;meta&gt;</span>\n        <span class=\"nt\">&lt;versionId</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;lastUpdated</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-10T20:06:47.402-04:00&quot;</span><span class=\"nt\">/&gt;</span> \n    <span class=\"nt\">&lt;/meta&gt;</span>\n    <span class=\"nt\">&lt;target&gt;</span>\n        <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;AllergyIntolerance/68539&quot;</span><span class=\"nt\">/&gt;</span>  \n    <span class=\"nt\">&lt;/target&gt;</span>\n    <span class=\"nt\">&lt;target&gt;</span>\n        <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;AllergyIntolerance/68540&quot;</span><span class=\"nt\">/&gt;</span> \n    <span class=\"nt\">&lt;/target&gt;</span>\n    <span class=\"nt\">&lt;recorded</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-10T20:07:27+01:00&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;agent&gt;</span>\n        <span class=\"nt\">&lt;role&gt;</span>\n            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/provenance-participant-role&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;assembler&quot;</span><span class=\"nt\">/&gt;</span>     \n        <span class=\"nt\">&lt;/role&gt;</span>\n        <span class=\"nt\">&lt;userId&gt;</span>\n            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://health-comm.de/Cloverleaf&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;12345&quot;</span><span class=\"nt\">/&gt;</span>    \n        <span class=\"nt\">&lt;/userId&gt;</span>  \n    <span class=\"nt\">&lt;/agent&gt;</span>\n<span class=\"nt\">&lt;/Provenance&gt;</span>\n</pre></div>\n\n\n<p>Now I want a list of all AllergyIntolerances with a Provenance.userID=12345<br>\nThat would be .../AllergyIntolerance?_has=Provenance:userID=12345 ???</p>",
        "id": 153826642,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462925959
    },
    {
        "content": "<p>I posted both Provenance and the AllergyIntolerances on HAPI, so we can test right away. The query abve returns an error...</p>",
        "id": 153826643,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462926071
    },
    {
        "content": "<p>I believe it should be <a href=\"http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has=Provenance:target:userID=12345\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has=Provenance:target:userID=12345\">http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has=Provenance:target:userID=12345</a></p>\n<p>But that is crashing for me... Let me check why.</p>",
        "id": 153826644,
        "sender_full_name": "James Agnew",
        "timestamp": 1462926156
    },
    {
        "content": "<p>oh wait..</p>",
        "id": 153826645,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462926188
    },
    {
        "content": "<p>it's Provenance.agent.userId I guess...</p>",
        "id": 153826646,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462926201
    },
    {
        "content": "<p>nope, neither...</p>",
        "id": 153826647,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462926273
    },
    {
        "content": "<p>Thinking purely about syntax/naming here, what do people think of something like:</p>\n<div class=\"codehilite\"><pre> /AllergyIntolerance?_referencedFrom=Provenance:target where agent.userId=123\n</pre></div>\n\n\n<p>instead of</p>\n<div class=\"codehilite\"><pre> /AllergyIntolerance?_has=Provenance:target:agent.userId=123\n</pre></div>\n\n\n<p>I'm trying (maybe still failing) to drive at something more... readable as a sentence.</p>",
        "id": 153826648,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1462926392
    },
    {
        "content": "<p>Ah <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> , you had a <code>=</code> where a <code>:</code> should be</p>\n<p>Try: <a href=\"http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has:Provenance:target:userid=12345\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has:Provenance:target:userid=12345\">http://fhirtest.uhn.ca/baseDstu2/AllergyIntolerance?_has:Provenance:target:userid=12345</a></p>",
        "id": 153826659,
        "sender_full_name": "James Agnew",
        "timestamp": 1462927457
    },
    {
        "content": "<p>oh! yes, sorry, I was looking at the wrong exmple above...</p>",
        "id": 153826660,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462927579
    },
    {
        "content": "<p>ok, this is working as a plain GET but not as a conditional DELETE.<br>\nFor the DELETE I get</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;OperationOutcome</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n   <span class=\"nt\">&lt;text&gt;</span>\n      <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;generated&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;div</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://www.w3.org/1999/xhtml&quot;</span><span class=\"nt\">&gt;</span>\n         <span class=\"nt\">&lt;h1&gt;</span>Operation Outcome<span class=\"nt\">&lt;/h1&gt;</span>\n         <span class=\"nt\">&lt;table</span> <span class=\"na\">border=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;tr&gt;</span>\n               <span class=\"nt\">&lt;td</span> <span class=\"na\">style=</span><span class=\"s\">&quot;font-weight: bold;&quot;</span><span class=\"nt\">&gt;</span>error<span class=\"nt\">&lt;/td&gt;</span>\n               <span class=\"nt\">&lt;td&gt;</span>[]<span class=\"nt\">&lt;/td&gt;</span>\n               <span class=\"nt\">&lt;td&gt;</span>\n                  <span class=\"nt\">&lt;pre&gt;</span>Invalid match URL[AllergyIntolerance?_has:Provenance:target:userid=http://health-comm.de/Cloverleaf|12345] - URL has no search parameters<span class=\"nt\">&lt;/pre&gt;</span>\n               <span class=\"nt\">&lt;/td&gt;</span> \n            <span class=\"nt\">&lt;/tr&gt;</span> \n         <span class=\"nt\">&lt;/table&gt;</span> \n      <span class=\"nt\">&lt;/div&gt;</span>\n   <span class=\"nt\">&lt;/text&gt;</span>\n   <span class=\"nt\">&lt;issue&gt;</span>\n      <span class=\"nt\">&lt;severity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;error&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;processing&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;diagnostics</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Invalid match URL[AllergyIntolerance?_has:Provenance:target:userid=http://health-comm.de/Cloverleaf|12345] - URL has no search parameters&quot;</span><span class=\"nt\">/&gt;</span>\n   <span class=\"nt\">&lt;/issue&gt;</span>\n<span class=\"nt\">&lt;/OperationOutcome&gt;</span>\n</pre></div>",
        "id": 153826661,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462928204
    },
    {
        "content": "<p>What <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> suggests more resembles SQL/HQL-ish syntax</p>",
        "id": 153826718,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1462953624
    },
    {
        "content": "<p>Its just an observation</p>",
        "id": 153826719,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1462953791
    },
    {
        "content": "<p>what Josh suggests belongs on the _filter syntax. I was intending to look at how to do this in _filter once we converged on a syntax for the parameter, but don't mind if we do them in parallel. </p>",
        "id": 153826742,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462962901
    },
    {
        "content": "<p>my 2 cents on this is that we should retain a syntax very like the chaining syntax we have, and that the problem with Chris's syntax is that the logical sequence of joins isn't what it says - at least for me </p>",
        "id": 153826743,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462962963
    },
    {
        "content": "<p>I agree with your point <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  that the current syntax seems...  hard to fellow in a logical way (though it is well defined). I tried addressing this problem in my suggestion; do you have something concrete to propose? </p>",
        "id": 153826759,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1462964220
    },
    {
        "content": "<p>How about:</p>\n<div class=\"codehilite\"><pre>/AllergyIntolerance?~target.Provenance.userId=123\n</pre></div>",
        "id": 153826760,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462964550
    },
    {
        "content": "<p>it removes the double = , and assembles the things in a logical order. ~ stands for reverse change and . stands for forwards chain</p>",
        "id": 153826761,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462964556
    },
    {
        "content": "<p>Purely as a syntax I think this improves on the <code>_has</code>, but I don't like the fact that it removes all semblance of knowing a well-defined set of valid query parameter names for FHIR search requests. </p>",
        "id": 153826771,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1462966178
    },
    {
        "content": "<p>It just seems like no matter how we mash them around, forward and reverse chaining together are begging for some more grammar support (as in <code>_filter</code>).</p>",
        "id": 153826773,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1462966428
    },
    {
        "content": "<p>I was thinking about extending _include with a means to not include the original endpoint type. For example by a modifier like <code>:strict</code>(meaning: include exactly this in the response, and nothing else). So something like</p>\n<div class=\"codehilite\"><pre>/Provenance?userId=123&amp;_include:strict=Provenance:target:Patient\n</pre></div>\n\n\n<p>It would eliminate the need for a new parameter and syntax altogether. <br>\nDownsides are that it feels a bit inconsistent to query a /Provenance endpoint and get back (only) Patient resources, and you cannot have the equivalent of multiple _has clauses.</p>",
        "id": 153826776,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1462968333
    },
    {
        "content": "<p>reverse chaining itself removes all semblance of knowing a set of valid search options. I prefer _filter, actually, but the fact remains: no other server maintainers have implemented it. :-(</p>",
        "id": 153826778,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462968542
    },
    {
        "content": "<p>I chose the current syntax because it reads how you'd speak - Patient?_has:Encounter:patient:type=SURG reads \"a Patient that has Encounters with type SURG\" (the reverse reference thrown in I guess).  </p>\n<p>When we discussed this in-house, my devs thought it important that the resource name being sub-queried be prominent.</p>",
        "id": 153826805,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1462971849
    },
    {
        "content": "<p>I have to admit- the proposed syntax is difficult and kind of hard to look at, but I would say I like it more than anything else that's been proposed so far. At least it's relatively consistent with the rest of the API.</p>\n<p>I do wonder about <code>_has</code> itself though. It makes sense in the context of answering the question <code>find patients who have a condition</code> but it doesn't really describe the actual operation. Josh's proposal to call it <code>_referencedFrom</code> might be an improvement from that perspective. I.e. <code>_referenedFrom:Observation:target:code=123</code></p>",
        "id": 153826861,
        "sender_full_name": "James Agnew",
        "timestamp": 1462976243
    },
    {
        "content": "<p>+1 for <code>_referencedFrom</code></p>",
        "id": 153826865,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1462976442
    },
    {
        "content": "<p>Encounter:patient - it's the :patient that appears out of sequence</p>",
        "id": 153826918,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462982582
    },
    {
        "content": "<p>see this: _referenedFrom:Observation:target:code=123</p>",
        "id": 153826923,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462982759
    },
    {
        "content": "<p>why not Observation.code - like it usually would be?</p>",
        "id": 153826924,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462982771
    },
    {
        "content": "<p>Well, you know why not <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  — because you need to specify <code>target</code> somewhere :p My verbose take was the only way I could find around this.</p>",
        "id": 153826931,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1462983204
    },
    {
        "content": "<p>I'm not in love with any format I've seen yet. I'll think about what I think would be best for use in _filter</p>",
        "id": 153826935,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462983375
    },
    {
        "content": "<p>+1 on having this functionality somehow.  They'd be immensely helpful in population health applications.</p>\n<p>Here's another potential syntax to throw in the ring -- just to keep our minds thinking:</p>\n<div class=\"codehilite\"><pre>/Patient?_referencedBy=Observation:subject:O&amp;O.status=final&amp;O.code=http://foo.org/sys|123\n</pre></div>\n\n\n<p>In this case, the <code>_referencedBy</code> establishes an alias that is used in subsequent parameters.  It has a few advantages:</p>\n<ul>\n<li>It's less verbose when you're using multiple parameters</li>\n<li>IMO, it makes it more clear that multiple parameters are intended to be ANDed on the target (e.g., in the example above, both status and code params must match on the _same_ observation)</li>\n<li>Indicating the patient must have _any_ matching observation is simple: <code>/Patient?_referencedBy=Observation:subject</code></li>\n<li>It allows for some more complex scenarios if we wished to specify them (see below)</li>\n</ul>\n<p>Regarding that last bullet, I'm not sure if we'd want to specify something like this, but the door is open:</p>\n<div class=\"codehilite\"><pre>/Patient?_referencedBy=Observation:subject:O1,Observation:subject:O2&amp;O1.status=final&amp;O1.code=http://foo.org/sys|123&amp;O2.status=final&amp;O2.category=http://hl7.org/fhir/observation-category|therapy\n</pre></div>\n\n\n<p>This reads as \"patients referenced by an observation (O1) that is final and has code '123' _or_ referenced by an observation (O2) that is final and has category 'therapy'.  That may be more complex than we want to support, but the syntax allows it and it is consistent with existing syntax.</p>\n<p>Anyway... again... just throwing out something to keep us thinking outside the box.</p>",
        "id": 153827000,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462993276
    },
    {
        "content": "<p>BTW-- in the above examples, the alias is a letter 'O' (for Observation), not the numeral 0.  The alias doesn't have to be 'O' -- it can be anything the user chooses.  And in the last (complex) example, if you wanted to say that the Patient must have _both_ Observations, you would just have two <code>_referencedBy</code> params instead of the one with the commas (indicating 'or').</p>",
        "id": 153827004,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462993484
    },
    {
        "content": "<p>I firmly do not like a single parameter with mutiple =. which one gets escaped?</p>",
        "id": 153827035,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462995865
    },
    {
        "content": "<p>+1 to that</p>",
        "id": 153827038,
        "sender_full_name": "James Agnew",
        "timestamp": 1462995934
    },
    {
        "content": "<p>I agree that a single param with multiple = is a bad idea.  My example above doesn't have that -- does it?  In my first example, there are three params (_referencedBy, O.status, and O.code).</p>",
        "id": 153827044,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462996595
    },
    {
        "content": "<p>If you don't like it, that's fine -- but I just wanted to point out that there aren't extra <code>=</code> and there is no extra encoding burden.</p>",
        "id": 153827045,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462996706
    },
    {
        "content": "<p>carumba I read it more carefully. variables in the URL parameters? order dependent processing? Oh no please. Much better to just use _filter</p>",
        "id": 153827046,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462996771
    },
    {
        "content": "<p>so, ironically, i liked it less...</p>",
        "id": 153827047,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462996791
    },
    {
        "content": "<p>Ha.  OK.  Parameters don't have to be listed in order -- but the implementation would have to look at all _referencedBy params first to pick up the aliases in play.  As I said, just trying to think outside of the box, hoping one of us will stumble onto something good.</p>",
        "id": 153827050,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462997245
    },
    {
        "content": "<p>get base/Patient?_filter=Observation[patient ref $].status = final<br>\nget base/Patient?_filter=Observation[subject ref $ and code = <a href=\"http://foo.org/sys|123\" target=\"_blank\" title=\"http://foo.org/sys|123\">http://foo.org/sys|123</a> and status = final]</p>",
        "id": 153827051,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462997252
    },
    {
        "content": "<p>it really looks much nicer in _filter</p>",
        "id": 153827052,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462997279
    },
    {
        "content": "<p>we should say it's only available in the _filter as encouragement to get people to implement it </p>",
        "id": 153827053,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462997299
    },
    {
        "content": "<p>one of these days i'm going to have a go at filter... i'm curious how hard it will actually be</p>",
        "id": 153827054,
        "sender_full_name": "James Agnew",
        "timestamp": 1462997349
    },
    {
        "content": "<p>Perhaps I will try filter as well.  As I mentioned, it would be extremely helpful in population health applications -- and in particular, an application I'm involved with.</p>",
        "id": 153827080,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1462998786
    },
    {
        "content": "<p>My company is interested in doing _filter queries, but we are having a challenge understanding how sub-queries are run across resource types. <br>\ne.g. give me patients who have had no encounters between date X and date Y with the diagnosis.code of A or diagnosis.code of B.<br>\nHow can something like this be done?</p>",
        "id": 153827081,
        "sender_full_name": "Corey Spears",
        "timestamp": 1462998835
    },
    {
        "content": "<p>you were going to set up a data case for that? </p>",
        "id": 153827082,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462998856
    },
    {
        "content": "<p>so lets write this forwards:</p>",
        "id": 153827083,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462998897
    },
    {
        "content": "<p>What that question directed at me <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ? If so, I can do it. I tried a few example but was only getting errors. I assume my search string is way off.</p>",
        "id": 153827084,
        "sender_full_name": "Corey Spears",
        "timestamp": 1462999080
    },
    {
        "content": "<p>get Encounter?patient=234 and not (period sa 2014-09-05 and period eb 2014-09-15) and hospitalization.admittingDiagnosis[code = A or code = B] pr true</p>",
        "id": 153827085,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462999147
    },
    {
        "content": "<p>I think that's it </p>",
        "id": 153827086,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462999155
    },
    {
        "content": "<p>OK, Thanks.  I will set it up and give it a try on your server (It will take a little time since I do not have an app to easily set up the resource instances).  But is there a _filter way to do that same thing? While I understand you are saying it can be done with a regular search, seeing it as an _filter would help us understand how we can frame more complex results using _filter.</p>",
        "id": 153827092,
        "sender_full_name": "Corey Spears",
        "timestamp": 1462999343
    },
    {
        "content": "<p>sorry that was a typo. I meant to write:</p>",
        "id": 153827093,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462999418
    },
    {
        "content": "<div class=\"codehilite\"><pre>get Encounter?_filter=patient eq 234 and not (period sa 2014-09-05 and period eb 2014-09-15) and hospitalization.admittingDiagnosis[code = A or code = B] pr true\n</pre></div>",
        "id": 153827095,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462999437
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , I will give it a try.<br>\nAfter looking at this closer, this query returns encounters. I am looking for a set of patients. Is there a way to do that in one _filter query?</p>",
        "id": 153827096,
        "sender_full_name": "Corey Spears",
        "timestamp": 1462999570
    },
    {
        "content": "<p>After looking at this closer  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , this query returns encounters. I am looking for a set of patients. Is there a way to do that in one _filter query?</p>",
        "id": 153827401,
        "sender_full_name": "Corey Spears",
        "timestamp": 1463072910
    },
    {
        "content": "<p>right yes, in order for that, we have to resolve - and I have to implement - the parameter which is the core issue for this topic</p>",
        "id": 153827439,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463077152
    },
    {
        "content": "<p>If we would not have _has (because we think _filter is the right place to dit it), it means we are missing out on support of some really common queries, unless servers commpnly implement _filter. And I still believe this is not going to be the case....  Implementing this on top of your existing (non FHIR) database, keeping it performant, maybe even allowing the client too much querying capabilities.... these are the reasons I can imagine many will not implement it.</p>",
        "id": 153828580,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1463652853
    },
    {
        "content": "<p>so to be clear about this: _filter only adds the capability to have a more capable grammar around grouping queries and relating conditionality. It doesn't add additional querying capabilities beyond that. </p>",
        "id": 153828793,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463694763
    },
    {
        "content": "<p>pushing back against supporting it means that we keep adding ever more tricky stuff into the existing search. That's worse</p>",
        "id": 153828794,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463694804
    },
    {
        "content": "<p>Agree - the question isn't _filter or not.  The question is whether this, as with all features, meets the 80% rule.  Do the majority of users need this capability when using the resources that would require it?  I would find it hard to use Provenance in any real sense without this...  Or AuditEvent</p>",
        "id": 153828861,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1463750884
    },
    {
        "content": "<p>Or anything else where the reference is inbound (EpisodeOfCare as it stands today)</p>",
        "id": 153828862,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1463750921
    },
    {
        "content": "<p>so where are we with this? Here's my summary<br>\n- no one thinks that this functionality shouldn't be added<br>\n- none of us really like the syntax proposed, but no one's proposed something obviously better<br>\n- in _filter, it looks nicer, but since hardly any servers implement _filter, that doesn't help much </p>",
        "id": 153829004,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463883612
    },
    {
        "content": "<p><a href=\"https://motorcycleguy.blogspot.com.au/2016/06/selecting-population-cohorts-in-fhir.html\" target=\"_blank\" title=\"https://motorcycleguy.blogspot.com.au/2016/06/selecting-population-cohorts-in-fhir.html\">https://motorcycleguy.blogspot.com.au/2016/06/selecting-population-cohorts-in-fhir.html</a></p>",
        "id": 153831942,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465344914
    },
    {
        "content": "<p>perhaps this will help give us impetus to close this out</p>",
        "id": 153831943,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465344920
    },
    {
        "content": "<p>wouldn't chained search parameters have been able to resolve this?<br>\n(for this example case that was shown)<br>\n(Which I now see Grahame already noted in the comments at the bottom... read to the end next time Brian)</p>",
        "id": 153831945,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1465346188
    },
    {
        "content": "<p>The way I read chaining, its from the referenced item to  its search parameters.  GET Observation?patient.name=Keith would get me an observation for Keith.  But what I want is GET Patient?observation.code=foo where the tie from observation to patient is through Observation,patient = <a href=\"http://Patient.id\" target=\"_blank\" title=\"http://Patient.id\">Patient.id</a>. It's become clear to me that the chaining syntax would note do what I want.  Chain goes from Reference search parameter to the referenced Resource's search parameters.</p>",
        "id": 153831947,
        "sender_full_name": "Keith Boone",
        "timestamp": 1465348406
    },
    {
        "content": "<p>Another challenge to address is Observation A=B OR Observation C=D, where I want all patients who have an observation A of B, or an Observation C of D.  I can punt with extension parameter for now, but I think _join might need to also allow aliases to be provided.  There's more to play with using AND, OR and NOT that I want to look at.</p>",
        "id": 153831948,
        "sender_full_name": "Keith Boone",
        "timestamp": 1465348708
    },
    {
        "content": "<p>Yes sorry, I thought you were after observations, not patients. So yes, not currently possible, and what the _has is hoping to assist resolve.</p>",
        "id": 153831953,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1465349444
    },
    {
        "content": "<p>Also, @Keith, you should look at _filter as well: <a href=\"http://hl7.org/fhir/search.html#filter\" target=\"_blank\" title=\"http://hl7.org/fhir/search.html#filter\">http://hl7.org/fhir/search.html#filter</a>. The combination of _filter and reverse chaining would meet your requirements</p>",
        "id": 153831955,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465349551
    },
    {
        "content": "<p>Yeah, I looked at Filter.  I really don't care for it, for one reason because I don't see any built in support for it in HAPI, for another, because for my use cases, I can probably optimize the queries a little better myself if I work at it a bit.</p>",
        "id": 153831956,
        "sender_full_name": "Keith Boone",
        "timestamp": 1465352709
    },
    {
        "content": "<p>And finally, I just don't like the syntax ;-)</p>",
        "id": 153831957,
        "sender_full_name": "Keith Boone",
        "timestamp": 1465352729
    },
    {
        "content": "<p>My proposal for _has syntax is: _has=Resource:search:criteria<br>\nResource is the name of the resource which you are joining with.<br>\nSearch is the search path on the resource to complete the join<br>\ncriteria is the search criteria (everything after the ?) on the joined resource.<br>\nSo,<br>\nPatient?_has=Observation:subject:code=HBA1C <br>\nmeans patients for whom there is an HBAC1 observation.<br>\nPatient?_has=Observation:subject:code=HBA1C%26value=gt6<br>\nmeans patients for whom there is an observation where code=HBA1C&amp;value=gt6<br>\nNote the use of %26 to encode &amp; above in criteria for the joined query.<br>\nAnd <br>\nPatient?age=gt50&amp;gender=female&amp;_has:not=Procedure:subject:code:in=mammogram%26date=gt2015-02-22 <br>\nmeans females over 50 where there does not exist a procedure resource where the subject is the patient, and the procedure code is for a mammogram and the date of the procedure is less than two years ago (as of the date of this post).</p>\n<p>Does that address syntax concerns?</p>",
        "id": 153873017,
        "sender_full_name": "Keith Boone",
        "timestamp": 1487750255
    },
    {
        "content": "<p>this seems late... we've already written it up and provided examples (and balloted it)</p>",
        "id": 153873272,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1487962840
    }
]