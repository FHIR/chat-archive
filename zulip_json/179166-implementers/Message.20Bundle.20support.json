[
    {
        "content": "<p>Hi, we're struggling with our FHIR Bundle type Message <a href=\"/user_uploads/10155/xIkk2SFaYxYJf8d6sCv6ayxK/BundleAdrenalEx.xml\">BundleAdrenalEx.xml</a> We were able to test successfully against <a href=\"http://test.fhir.org/r4\">test.fhir.org/r4</a> but not against HAPI, Vonk, Spark, Aegis. Is Bundle.type Message not widely supported at this time? <span class=\"user-mention\" data-user-id=\"193795\">@Joel Francis</span></p>",
        "id": 226975694,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613747287
    },
    {
        "content": "<p>Are you just trying to store it (posting it to the Bundle endpoint) or are you trying to have it processed?  None of the reference implementations can process messages because processing requires specific coding for each message definition.</p>",
        "id": 226976883,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1613747745
    },
    {
        "content": "<p>We have some custom code which validates using a MessageDefinition  resource. <br>\nThe eventCoding in a MessageDefinition must match in the FHIR Message Bundle.MessageHeader.eventCoding.</p>\n<p>MessageDefinition states the profile to be used for the focus resource. <br>\nE.g.<br>\n<a href=\"https://simplifier.net/guide/DigitalMedicines/dispense-notification\">https://simplifier.net/guide/DigitalMedicines/dispense-notification</a></p>\n<p>These resources (MedicationDispense) are validated using that profile.</p>",
        "id": 226982415,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1613749877
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/Message.20Bundle.20support/near/226976883\">said</a>:</p>\n<blockquote>\n<p>Are you just trying to store it (posting it to the Bundle endpoint) or are you trying to have it processed?  None of the reference implementations can process messages because processing requires specific coding for each message definition.</p>\n</blockquote>\n<p>Just a post, we typically get a 400 or 501 bad request, but it works on <a href=\"http://test.fhir.org/r4\">test.fhir.org/r4</a></p>",
        "id": 226982783,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613750028
    },
    {
        "content": "<p>A post to what endpoint?  Bundle or $process-message?</p>",
        "id": 226983470,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1613750283
    },
    {
        "content": "<p>Bundle</p>",
        "id": 226985784,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613750899
    },
    {
        "content": "<p>ca.uhn.fhir.rest.server.exceptions.InvalidRequestException: HTTP 400 Bad Request: Unable to process transaction where incoming Bundle.type = message</p>",
        "id": 226986797,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613751327
    },
    {
        "content": "<p>We found out our text element was failing on multiple servers, but working fine on <a href=\"http://test.fhir.org\">test.fhir.org</a></p>",
        "id": 226989798,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613752387
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> we had issues with our text element with the Bundle Message attached above. Here's the  OperationOutcome we got from HAPI</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\&quot;0\\&quot;&gt;&lt;tr&gt;&lt;td style=\\&quot;font-weight: bold;\\&quot;&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;Failed to parse request body as JSON resource. Error was: Failed to parse JSON encoded FHIR content: Illegal unquoted character ((CTRL-CHAR, code 10)): has to be escaped using backslash to be included in string value\\n at [Source: UNKNOWN; line: 11, column: 20]&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t\\t\\t\\n\\t\\t\\t\\t\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;Failed to parse request body as JSON resource. Error was: Failed to parse JSON encoded FHIR content: Illegal unquoted character ((CTRL-CHAR, code 10)): has to be escaped using backslash to be included in string value\\n at [Source: UNKNOWN; line: 11, column: 20]&quot;\n        }\n    ]\n}\n</code></pre></div>",
        "id": 226990250,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613752558
    },
    {
        "content": "<p>Systems <em>should</em> allow storing Bundles of whatever type at the Bundle endpoint.  But they're not required to.</p>",
        "id": 226994630,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1613754274
    },
    {
        "content": "<p>Do you have a copy of the JSON version?  The example you posted is an XML and the error from HAPI is about parsing JSON.  I'm wondering if there's an error in the conversion.  (also, just to be sure; are you setting the content type on the request?)</p>",
        "id": 226995261,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1613754495
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/8LGO3wVa-O649G5ECBBDv2ts/BundleAdrenal.json\">BundleAdrenal.json</a></p>",
        "id": 227006628,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613759404
    },
    {
        "content": "<p>Whoops! Yes we do. Here it is <span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span></p>",
        "id": 227006675,
        "sender_full_name": "Alex Goel",
        "timestamp": 1613759414
    },
    {
        "content": "<p>The JSON is malformed; you cannot have actual newlines in the text (need to replace with <code>\\n</code>).  <del>As a note, those characters shouldn't be there anyway, since you should not have anything between the delimiter and literal (e.g., should be <code>&lt;div</code>).</del> (edit: doing too many things at once =)</p>\n<p>Fixing the two instances of that (can test in <a href=\"https://jsonlint.com\">https://jsonlint.com</a>) lets it pass validation, I think it will work after that.</p>",
        "id": 227007582,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1613759798
    },
    {
        "content": "<p>If you don't want use the individual resources and not just store it, I would consider having some sort of processor to convert the message into a transaction bundle. </p>\n<p>Message bundle is not a format I would expect epr or fhir servers to directly support without some form of processing. They would use a message handling component to handle the interaction.</p>",
        "id": 227148788,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1613891338
    }
]