[
    {
        "content": "<p>Good morning everybody. I've been doing some validation against the HAPI server, and I keep getting multiple instances of this exception: </p>\n<p>\"Error org.hibernate.HibernateException: Unable to access lob stream; nested exception is javax.persistence.PersistenceException: org.hibernate.HibernateException: Unable to access lob stream validating {someElement}\"</p>\n<p>The strange thing is that sometimes it comes back as a warning, while other times coming back as an error. Does anybody know what this error means, or have any insight on how to fix it?</p>",
        "id": 153903744,
        "sender_full_name": "Jake Hardy",
        "timestamp": 1503674891
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ?</p>",
        "id": 153903747,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1503676775
    },
    {
        "content": "<p>I am experiencing the same problem running 5.3 in docker, <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  any nudges to help proceed forward ?</p>",
        "id": 234372705,
        "sender_full_name": "dsh",
        "timestamp": 1618336666
    },
    {
        "content": "<p>are you able to reproduce this on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>?</p>",
        "id": 234373244,
        "sender_full_name": "James Agnew",
        "timestamp": 1618336844
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191319\">James Agnew</span> <a href=\"#narrow/stream/179166-implementers/topic/HibernateException/near/234373244\">said</a>:</p>\n<blockquote>\n<p>are you able to reproduce this on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>?</p>\n</blockquote>\n<p>How would I do that? I am running 5.3.0 in Docker and I see this in my logs</p>\n<div class=\"codehilite\"><pre><span></span><code>Hibernate:\n    select\n        resourcehi0_.pid as pid1_12_0_,\n        resourcehi1_.res_ver_pid as res_ver_1_13_1_,\n        resourcehi0_.partition_date as partitio2_12_0_,\n        resourcehi0_.partition_id as partitio3_12_0_,\n        resourcehi0_.res_deleted_at as res_dele4_12_0_,\n        resourcehi0_.res_version as res_vers5_12_0_,\n        resourcehi0_.has_tags as has_tags6_12_0_,\n        resourcehi0_.res_published as res_publ7_12_0_,\n        resourcehi0_.res_updated as res_upda8_12_0_,\n        resourcehi0_.res_encoding as res_enco9_12_0_,\n        resourcehi0_.res_text as res_tex10_12_0_,\n        resourcehi0_.res_id as res_id11_12_0_,\n        resourcehi0_.res_type as res_typ12_12_0_,\n        resourcehi0_.res_ver as res_ver13_12_0_,\n        resourcehi1_.partition_date as partitio2_13_1_,\n        resourcehi1_.partition_id as partitio3_13_1_,\n        resourcehi1_.request_id as request_4_13_1_,\n        resourcehi1_.res_pid as res_pid6_13_1_,\n        resourcehi1_.source_uri as source_u5_13_1_\n    from\n        hfj_res_ver resourcehi0_\n    left outer join\n        hfj_res_ver_prov resourcehi1_\n            on resourcehi0_.pid=resourcehi1_.res_ver_pid\n    where\n        resourcehi0_.res_id=?\n        and resourcehi0_.res_ver=?\n2021-04-13 18:01:14.822 [main] ERROR c.u.f.jpa.searchparam.retry.Retrier [Retrier.java:79] Retry failure 31/60: org.springframework.orm.jpa.JpaSystemException: Unable to access lob stream; nested exception is org.hibernate.HibernateException: Unable to access lob stream\n</code></pre></div>",
        "id": 234373419,
        "sender_full_name": "dsh",
        "timestamp": 1618336919
    },
    {
        "content": "<p>like, can you upload any data you'd need in order to simulate the same scenario on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>, and share a link that shows it?</p>",
        "id": 234373570,
        "sender_full_name": "James Agnew",
        "timestamp": 1618336978
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191319\">James Agnew</span> <a href=\"#narrow/stream/179166-implementers/topic/HibernateException/near/234373570\">said</a>:</p>\n<blockquote>\n<p>like, can you upload any data you'd need in order to simulate the same scenario on <a href=\"http://hapi.fhir.org\">hapi.fhir.org</a>, and share a link that shows it?</p>\n</blockquote>\n<p>no this is happening on Server start it self .... I haven't even accessed the UI yet</p>",
        "id": 234373688,
        "sender_full_name": "dsh",
        "timestamp": 1618337026
    },
    {
        "content": "<p>again this may be bcoz of <code>hapiproject/hapi:latest</code> which was built off of master branch, running on DB schema migrated by 5.3.0 CLI</p>",
        "id": 234373788,
        "sender_full_name": "dsh",
        "timestamp": 1618337055
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  ^</p>",
        "id": 234373823,
        "sender_full_name": "dsh",
        "timestamp": 1618337077
    },
    {
        "content": "<p>hmm, not sure unfortunately. i don't know a lot about the docker build</p>",
        "id": 234373887,
        "sender_full_name": "James Agnew",
        "timestamp": 1618337106
    },
    {
        "content": "<p>does this happen if you don't use the docker build?</p>",
        "id": 234373947,
        "sender_full_name": "James Agnew",
        "timestamp": 1618337131
    },
    {
        "content": "<p>do I need to enable the logger in <code>application.yml</code> for this error to go away ? currently its commented out</p>",
        "id": 234373987,
        "sender_full_name": "dsh",
        "timestamp": 1618337154
    },
    {
        "content": "<p>not sure, does that solve the issue?</p>",
        "id": 234374348,
        "sender_full_name": "James Agnew",
        "timestamp": 1618337296
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  no it does not</p>",
        "id": 234375081,
        "sender_full_name": "dsh",
        "timestamp": 1618337632
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> some more insights here. This issue was reported here <a href=\"https://github.com/hapifhir/hapi-fhir/issues/2034\">https://github.com/hapifhir/hapi-fhir/issues/2034</a> <br>\nI am  trying to run JPA  5.3.0 from dockerhub <code>hapiproject/hapi</code> the server won't start unless I can get past that exception</p>",
        "id": 234379541,
        "sender_full_name": "dsh",
        "timestamp": 1618339403
    },
    {
        "content": "<p>Well, FWIW that issue was fixed so I assume it's not exactly that (or it's the same thing happening elsewhere). If you are able to reproduce it outside of docker, please feel free to file a bug with the steps to reproduce, any stack trace, etc</p>",
        "id": 234380252,
        "sender_full_name": "James Agnew",
        "timestamp": 1618339699
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> on 5.3.0 on Debian (buster) with Java 11.0.8, I still get the same error regardless if the WAR is run outside or inside docker</p>\n<p><strong>The JPA Server does not start</strong></p>\n<p>I am using PostGresql 12.5</p>",
        "id": 234416327,
        "sender_full_name": "dsh",
        "timestamp": 1618355703
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> seems like this may be a problem emanating from the DB schema migration by <code>hapi-fhir-cli</code> <a href=\"https://stackoverflow.com/questions/38511205/org-hibernate-hibernateexception-org-postgresql-util-psqlexception-large-objec\">https://stackoverflow.com/questions/38511205/org-hibernate-hibernateexception-org-postgresql-util-psqlexception-large-objec</a></p>",
        "id": 234417268,
        "sender_full_name": "dsh",
        "timestamp": 1618356300
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> I even tried to change the Hibernate DDL properties <code>hibernate.hbm2ddl.auto: create-drop</code> and I still get the same error</p>\n<div class=\"codehilite\"><pre><span></span><code>2021-04-13 23:40:57.842 [main] ERROR c.u.f.jpa.searchparam.retry.Retrier [Retrier.java:79] Retry failure 4/60: org.springframework.orm.jpa.JpaSystemException: Unable to access lob stream; nested exception is org.hibernate.HibernateException: Unable to access lob stream\n````\n</code></pre></div>",
        "id": 234419227,
        "sender_full_name": "dsh",
        "timestamp": 1618357463
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"379920\">@Ken Stevens</span> any idea ?</p>",
        "id": 234419240,
        "sender_full_name": "dsh",
        "timestamp": 1618357477
    },
    {
        "content": "<p>Finally I got past that error by running this PLSQL function on Large Objects in my Postgres 12.6 on AWS RDS</p>\n<div class=\"codehilite\"><pre><span></span><code>CREATE OR REPLACE FUNCTION public.grant_select_on_large_objects()\n RETURNS text\n LANGUAGE plpgsql\nAS $function$\n\n    DECLARE\n        REC BIGINT;\n\n    begin\n\n        FOR REC in   SELECT OID FROM pg_catalog.pg_largeobject_metadata\n        loop\n\n            execute &#39;grant select on LARGE OBJECT &#39; || REC || &#39; to caringly_db_master&#39;;\n\n--          select &#39;LOBID is &#39; || REC.oid;\n\n        END LOOP;\n\n        return &#39;DONE&#39;;\n    END;\n$function$\n;\n</code></pre></div>",
        "id": 234454941,
        "sender_full_name": "dsh",
        "timestamp": 1618386064
    }
]