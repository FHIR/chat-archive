[
    {
        "content": "<p>I created two snapshots for a STU3 profile that we use one snapshot with the validator 5.0.7 and one with forge 24.2.0.0.<br>\nThere were quite some differences, see below.</p>\n<p>Could someone please help us in understanding this. Are these differences  both correct from a FHIR perspective? </p>\n<p><strong>Defining the base resource. The actual HL7 base resource is Observation</strong><br>\nForge:<br>\n<code>     &lt;base&gt;\n        &lt;path value=\"Resource\" /&gt;\n        &lt;min value=\"0\" /&gt;\n        &lt;max value=\"*\" /&gt;\n      &lt;/base&gt;</code><br>\nValidator:<br>\n<code>     &lt;base&gt;\n        &lt;path value=\"Observation\"/&gt;\n        &lt;min value=\"0\"/&gt;\n        &lt;max value=\"*\"/&gt;\n      &lt;/base&gt;</code></p>\n<p><strong>In the snapshot for almost anything related to extension, a slicing element in the forge generated snapshot</strong><br>\nForge:<br>\n<code>     &lt;element id=\"Observation.modifierExtension\"&gt;\n      &lt;path value=\"Observation.modifierExtension\" /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=\"value\" /&gt;\n          &lt;path value=\"url\" /&gt;\n        &lt;/discriminator&gt;\n        &lt;description value=\"Extensions are always sliced by (at least) url\" /&gt;\n        &lt;rules value=\"open\" /&gt;\n      &lt;/slicing&gt;\n      &lt;short value=\"Extensions that cannot be ignored\" /&gt;</code><br>\nValidator:<br>\n<code>    &lt;element id=\"Observation.modifierExtension\"&gt;\n      &lt;path value=\"Observation.modifierExtension\"/&gt;\n      &lt;short value=\"Extensions that cannot be ignored\"/&gt;</code></p>\n<p><strong>Difference in referencing a valueset, valueSetUri vs valueSetReference</strong><br>\nForge:<br>\n<code>      &lt;binding&gt;\n        &lt;strength value=\"required\" /&gt;\n        &lt;valueSetUri value=\"http://hl7.org/fhir/ValueSet/ucum-vitals-common\" /&gt;\n      &lt;/binding&gt;</code><br>\nValidator:<br>\n<code>       &lt;binding&gt;\n        &lt;strength value=\"required\"/&gt;\n        &lt;valueSetReference&gt;\n          &lt;reference value=\"http://hl7.org/fhir/ValueSet/ucum-vitals-common\"/&gt;\n        &lt;/valueSetReference&gt;\n      &lt;/binding&gt;</code></p>\n<p><strong>valueQuantity vs value[x] in the path</strong><br>\nForge:<br>\n<code>    &lt;element id=\"Observation.value[x]:valueQuantity\"&gt;\n      &lt;path value=\"Observation.valueQuantity\" /&gt; </code></p>\n<p>Validator:<br>\n<code>     &lt;element id=\"Observation.value[x]:valueQuantity\"&gt;\n      &lt;path value=\"Observation.value[x]\"/&gt; </code></p>\n<p><strong> Difference with the differential of the original profile. value[x] rewritten to valueQuantity in the validator generated snapshot in the element id</strong><br>\nOriginal profile differential:<br>\n<code>    &lt;element id=\"Observation.value[x]:valueQuantity.system\"&gt;\n      &lt;path value=\"Observation.valueQuantity.system\" /&gt;\n      &lt;min value=\"1\" /&gt;\n      &lt;fixedUri value=\"http://unitsofmeasure.org\" /&gt;\n    &lt;/element&gt;</code></p>\n<p>Forge:<br>\n<code>     &lt;element id=\"Observation.value[x]:valueQuantity.system\"&gt;\n      &lt;path value=\"Observation.valueQuantity.system\" /&gt;\n      &lt;min value=\"1\" /&gt;\n      &lt;fixedUri value=\"http://unitsofmeasure.org\" /&gt;\n    &lt;/element&gt; </code></p>\n<p>Validator:<br>\n<code>     &lt;element id=\"Observation.valueQuantity:valueQuantity.system\"&gt;\n      &lt;path value=\"Observation.valueQuantity.system\"/&gt;\n      &lt;min value=\"1\"/&gt;\n      &lt;fixedUri value=\"http://unitsofmeasure.org\"/&gt;\n    &lt;/element&gt; </code></p>",
        "id": 201380947,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1592568493
    },
    {
        "content": "<p>Ward's already looking.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 201404206,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592579990
    },
    {
        "content": "<ol>\n<li>I don't think that the extensions thing matters? I'm not sure which is more correct either </li>\n<li>in this particular case, the URL is also the canonical URL, so they both say the same thing though I think the validator is more correct.  Where it would matter would be if the reference was not be a canonical URL </li>\n<li>I think the validator is correct</li>\n<li>I think the validator is wrong, and it's also surprising. I'll investigate sometime next week</li>\n</ol>",
        "id": 201433813,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592596621
    },
    {
        "content": "<p>Any update? Thanks for the clarification Grahame. On the first issue about defining the base resource I guess the validator is correct?</p>",
        "id": 202057673,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1593154384
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"218569\">@Hans van Amstel</span> ,<br>\nI've looked into point \"2\" about the valueset referencing, and when I test this Forge is doing this correctly. <br>\nIn forge there is this option: <a href=\"/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png\">image.png</a> <br>\nIf this box is unchecked you say that the value set is a reference and it's rendered as in  your provided example. If the box is checked it is rendered the same as the java validator does. This is correct behavior in our opinion.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/9NsiJ_EMnXrmXOjZgC9Isvgd/image.png\"></a></div>",
        "id": 202283755,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1593419531
    },
    {
        "content": "<p>hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> on point 3 (path Observation.value[x]): I see why the path would be 'Observation.value[x]'. The upside is that 'Observation.value[x]' is also the path of the slice header, which makes identifying the slices easy. <br>\nBut it also means that the path 'Observation.valueQuantity.system' is then not visually a sub-path of its parent-path 'Observation.value[x]', which is quite confusing to both tools and users. So I see a downside to either of the solutions from a technical point of view.<br>\nI have to say I find the 'Observation.valueQuantity'-solution more attractive since the path-tree is more readable and the x-to-type-replacement happens where it is introduced (slice-header =&gt; slice). No need to read the contents of the slice to determine the root of the child path.<br>\nThe documentation about id (<a href=\"https://www.hl7.org/fhir/elementdefinition.html#id\">https://www.hl7.org/fhir/elementdefinition.html#id</a>, third bullet) seems to hint at this form of type-sliced paths too.</p>",
        "id": 202284723,
        "sender_full_name": "Abel Enthoven",
        "timestamp": 1593420249
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span>  Thanks for the reply. for me it's hard to judge what is correct and what not as I can not find definitive spec. The difference between the outputs of the HL7 validator and Forge puzzles me the most as the input is the same.</p>",
        "id": 202312360,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1593439131
    },
    {
        "content": "<p>Besides this I also did an experiment with the vitalsigns profile of the hl7 website (<a href=\"http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html\">http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html</a>)  and manually removed the snapshot part. Then I used the Forge(24.2.0.0) and HL7 validator(5.0.7) to recreate this snapshot. I was not able to do so and the difference was quite large.</p>\n<p>If someone could help me understand why this differences and where I can find to help me understand what is correct that would really help us.</p>\n<p>--- Snapshot difference 1 ---</p>\n<p><strong>Profile as is on the hL7 FHIR site:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.valueQuantity&quot;&gt;\n  &lt;path value=&quot;Observation.valueQuantity&quot;/&gt;\n</code></pre></div>\n\n\n<p><strong>Forge</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity&quot;&gt;\n  &lt;path value=&quot;Observation.valueQuantity&quot; /&gt;\n</code></pre></div>\n\n\n<p><strong>Hl7 Validator:</strong></p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]&quot;&gt;\n  &lt;path value=&quot;Observation.value[x]&quot;/&gt;\n</code></pre></div>\n\n\n<p>--- Snapshot difference 2 ---</p>\n<p>7x a difference similar to this one<br>\n<strong>Profile as is on the hL7 FHIR site: </strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.valueQuantity.id&quot;&gt;\n  &lt;path value=&quot;Observation.valueQuantity.id&quot;/&gt;\n</code></pre></div>\n\n\n<p><strong>Forge:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity.id&quot;&gt;\n  &lt;path value=&quot;Observation.valueQuantity.id&quot; /&gt;\n</code></pre></div>\n\n\n<p><strong>HL7 Validator:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.value[x]:valueQuantity.id&quot;&gt;\n  &lt;path value=&quot;Observation.value[x].id&quot;/&gt;\n</code></pre></div>\n\n\n<p>--- Snapshot difference 3 ---</p>\n<p><strong>Profile as is on the hL7 FHIR site </strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.valueQuantity&quot;&gt;\n  &lt;path value=&quot;Observation.component.valueQuantity&quot;/&gt;\n</code></pre></div>\n\n\n<p><strong>Forge:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity&quot;&gt;\n  &lt;path value=&quot;Observation.component.valueQuantity&quot; /&gt;\n</code></pre></div>\n\n\n<p><strong>Hl7 Validator:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]&quot;&gt;\n  &lt;path value=&quot;Observation.component.value[x]&quot;/&gt;\n  &lt;slicing&gt;\n    &lt;discriminator&gt;\n      &lt;type value=&quot;type&quot;/&gt;\n      &lt;path value=&quot;$this&quot;/&gt;\n    &lt;/discriminator&gt;\n    &lt;ordered value=&quot;false&quot;/&gt;\n    &lt;rules value=&quot;closed&quot;/&gt;\n  &lt;/slicing&gt;\n</code></pre></div>\n\n\n<p>--- Snapshot difference 4 ---</p>\n<p>7x a difference similar to this one<br>\n<strong>Profile as is on the hL7 FHIR site </strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.valueQuantity.id&quot;&gt;\n  &lt;path value=&quot;Observation.component.valueQuantity.id&quot;/&gt;\n</code></pre></div>\n\n\n<p><strong>Forge:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity.id&quot;&gt;\n  &lt;path value=&quot;Observation.component.valueQuantity.id&quot; /&gt;\n</code></pre></div>\n\n\n<p><strong>Hl7 Validator:</strong> </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;element id=&quot;Observation.component.value[x]:valueQuantity.id&quot;&gt;\n &lt;path value=&quot;Observation.component.value[x].id&quot;/&gt;\n</code></pre></div>\n\n\n<p>Sorry for again posting a long post <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 202314123,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1593439887
    },
    {
        "content": "<p>STU3 is a long way behind</p>",
        "id": 202365473,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593463401
    },
    {
        "content": "<p>so differences would be expected.</p>",
        "id": 202365480,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593463408
    },
    {
        "content": "<p>R4 should be up to date</p>",
        "id": 202365496,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593463413
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  Ok I can understand that STU3 is a long way behind. </p>\n<p>The problem we face is that we have a FHIR STU3 server that implements what is called the FHIR 3 way on how to define slicing. This is suppose to be: \"Observation.component.valueQuantity\". The R4 way of slicing is supposed to be \"Observation.component.value[x]\".  Is this correct?</p>\n<p>This is the same with how it is described on the HL7 FHIR STU3 sites (eg:<a href=\"http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html\">http://hl7.org/fhir/STU3/vitalsigns.profile.xml.html</a>) in the snapshot and also on the HL7 FHIR R4 sites( eghttps://www.hl7.org/fhir/vitalsigns.profile.xml.html).</p>\n<p>With the validator we are trying to create snapshots for our FHIR STU3 server but because of this difference we are not able to do so.</p>\n<p>If this is a correct interpretation (STU3 slicing and the R4 slicing) I would expect when using the the tooling and specifying --version 3 the output to be in accordance to \"Observation.component.valueQuantity\" .</p>\n<p>Or am I missing something?</p>",
        "id": 202378652,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1593472199
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"218569\">@Hans van Amstel</span>  The difference between Forge and the java validator is not something I can tell you anything useful about. In STU3 the definition of Binding looks like this: <a href=\"/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png\">image.png</a> <br>\nThis tells me that the Forge snaphot is correct on the point of the valueset (in STU3). </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/QKTBVpjBmmauMkU5il6QvAWH/image.png\"></a></div><p>For R4 this looks different: <a href=\"/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/O8CSxDmgirISiKcD0gBC642X/image.png\"></a></div>",
        "id": 202403346,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1593502484
    }
]