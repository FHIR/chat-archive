[
    {
        "content": "<p>Hey folks,</p>\n<p>I'm using Google FHIR and following these two sources of information to go about uploading implementation guides in order to enable validation on creation of FHIR resources:</p>\n<ul>\n<li><a href=\"https://www.youtube.com/watch?v=Q7WcYSyZ77o\">Overview video</a><div class=\"youtube-video message_inline_image\"><a data-id=\"Q7WcYSyZ77o\" href=\"https://www.youtube.com/watch?v=Q7WcYSyZ77o\"><img src=\"https://uploads.zulipusercontent.net/b70e7bd7f12ee14ccf1fe518a46ed40e856dec6c/68747470733a2f2f692e7974696d672e636f6d2f76692f513757635953795a37376f2f64656661756c742e6a7067\"></a></div></li>\n<li><a href=\"https://kellrott.medium.com/using-google-fhir-to-support-research-8f726834d77\">Practical guide</a></li>\n<li><a href=\"https://cloud.google.com/healthcare/docs/how-tos/fhir-profiles#configure_your_implementation_guide\">Official documentation</a></li>\n</ul>\n<p>My question is: does anyone have examples as to what to add in the \"global\" field? E.g. which resources are listed for us-core for example.</p>\n<p>Thanks!</p>",
        "id": 244315689,
        "sender_full_name": "Merlyn Albery-Speyer",
        "timestamp": 1624986964
    },
    {
        "content": "<p>Global says \"if you see a reference to this resource or data type with no declared profile, then behave as though the reference specified this global profile\".</p>",
        "id": 244316274,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624987212
    },
    {
        "content": "<p>It's not something that's widely used.</p>",
        "id": 244316297,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624987223
    },
    {
        "content": "<p>We use global because the store configuration defines a set of profiles such that no resource of the specified types will be accepted unless it conforms to at least one of them.</p>\n<p>Generally you would look at the profiles in the IG and list the resource types that they depend on (StructureDefinition.type). For US Core there are quite a few.</p>",
        "id": 244319193,
        "sender_full_name": "Paul Church",
        "timestamp": 1624988477
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> ,</p>\n<p>That matches my assumptions. For the us drug formulary IG, I added these lines:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;ImplementationGuide&quot;,\n  &quot;id&quot;: &quot;hl7.fhir.us.davinci-drug-formulary&quot;,\n\n  &quot;global&quot;: [\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-DrugAlternatives-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-DrugTierDefinition-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-DrugTierID-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-EmailPlanContact-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyURL-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-MarketingURL-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-Network-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-PlanID-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-PlanIDType-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-PriorAuthorization-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-QuantityLimit-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-StepTherapyLimit-extension&quot; },\n    { &quot;type&quot;: &quot;Extension&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-SummaryURL-extension&quot; },\n    { &quot;type&quot;: &quot;List&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-CoveragePlan&quot; },\n    { &quot;type&quot;: &quot;MedicationKnowledge&quot;, &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyDrug&quot; }\n  ],\n</code></pre></div>\n<p>and I've enabled my FHIR store to use the IG successfully as far as I can tell:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;name&quot;: &quot;projects/REDACTED/locations/REDACTED/datasets/REDACTED/fhirStores/REDACTED&quot;,\n  &quot;enableUpdateCreate&quot;: true,\n  &quot;version&quot;: &quot;R4&quot;,\n  &quot;validationConfig&quot;: {\n    &quot;enabledImplementationGuides&quot;: [\n      &quot;http://hl7.org/fhir/us/davinci-drug-formulary/ImplementationGuide/hl7.fhir.us.davinci-drug-formulary&quot;\n    ]\n  }\n}\n</code></pre></div>\n<p>however I can still successfully insert invalid data, e.g;</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;code&quot;: {\n    &quot;coding&quot;: [\n      {\n        &quot;code&quot;: &quot;1000091&quot;,\n        &quot;display&quot;: &quot;doxepin hydrochloride 5 % Topical Cream&quot;,\n        &quot;system&quot;: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;\n      }\n    ]\n  },\n  &quot;id&quot;: &quot;28b95b55-b9c5-4b4d-9b98-a67f5b611902&quot;,\n  &quot;meta&quot;: {\n    &quot;lastUpdated&quot;: &quot;2021-06-29T18:13:03.294000+00:00&quot;,\n    &quot;profile&quot;: [\n      &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyDrug&quot;\n    ],\n    &quot;versionId&quot;: &quot;MTYyNDk5MDM4MzI5NDAwMDAwMA&quot;\n  },\n  &quot;resourceType&quot;: &quot;MedicationKnowledge&quot;\n}\n</code></pre></div>\n<p>^^ note that the required drug tier or plan id extensions are absent.</p>\n<p>Any suggestions for how to go about debugging this?</p>\n<p>Thanks!</p>",
        "id": 244324076,
        "sender_full_name": "Merlyn Albery-Speyer",
        "timestamp": 1624990467
    },
    {
        "content": "<p>I'll take a look - you shouldn't need to put the extensions in that list, only the two profiles for formulary.</p>",
        "id": 244324217,
        "sender_full_name": "Paul Church",
        "timestamp": 1624990545
    },
    {
        "content": "<p>I have an example from one of our solutions people who set up the formulary IG, his IG looks like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>    &quot;global&quot;: [\n        {\n            &quot;type&quot;: &quot;List&quot;,\n            &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-CoveragePlan&quot;\n        },\n        {\n            &quot;type&quot;: &quot;MedicationKnowledge&quot;,\n            &quot;profile&quot;: &quot;http://hl7.org/fhir/us/davinci-drug-formulary/StructureDefinition/usdf-FormularyDrug&quot;\n        }\n    ],\n</code></pre></div>",
        "id": 244324476,
        "sender_full_name": "Paul Church",
        "timestamp": 1624990668
    },
    {
        "content": "<p>Check the Cloud Logging for your project, if there were configuration errors that got in the way of validation they may show up there.</p>",
        "id": 244324589,
        "sender_full_name": "Paul Church",
        "timestamp": 1624990710
    },
    {
        "content": "<p>Feel free to PM me to debug in more detail.</p>",
        "id": 244325530,
        "sender_full_name": "Paul Church",
        "timestamp": 1624991070
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span>, it looks like my mistake was not using the \"v1beta1\" API endpoints when updating the FHIR resources. (the \"v1\" endpoints do not perform profile validation)</p>",
        "id": 244348637,
        "sender_full_name": "Merlyn Albery-Speyer",
        "timestamp": 1625001230
    }
]