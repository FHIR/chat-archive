[
    {
        "content": "<p>Given an extension E that is incorporated into a profile P.<br>\nAssume E has a field F that has:<br>\n  cardinality <br>\n  flags (e.g., no Must support)<br>\nCan the profile P constrain a published extension with a different (compatible) cardinality and a MS?</p>\n<p>Or, is an extension, an extension, and is incorporated as-is.</p>\n<p>For a concrete example, imagine an IG that is supposed to incorporate this extension:  <a href=\"http://hl7.org/fhir/uv/vhdir/2018Sep/StructureDefinition-contactpoint-availabletime.html\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/vhdir/2018Sep/StructureDefinition-contactpoint-availabletime.html\">http://hl7.org/fhir/uv/vhdir/2018Sep/StructureDefinition-contactpoint-availabletime.html</a></p>\n<p>Here is the extension:<br>\n<a href=\"/user_uploads/10155/6PRYWFYNAlY9pPBCDEN3cL4o/image-2.png\" target=\"_blank\" title=\"image-2.png\">image-2.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/6PRYWFYNAlY9pPBCDEN3cL4o/image-2.png\" target=\"_blank\" title=\"image-2.png\"><img src=\"/user_uploads/10155/6PRYWFYNAlY9pPBCDEN3cL4o/image-2.png\"></a></div><p>Is it compatible with this specification when embedded in a profile (this is for davinci-plan-net):<br>\n<a href=\"/user_uploads/10155/hxml1HoBzSXmVRqDrscCQAlX/image-3.png\" target=\"_blank\" title=\"image-3.png\">image-3.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/hxml1HoBzSXmVRqDrscCQAlX/image-3.png\" target=\"_blank\" title=\"image-3.png\"><img src=\"/user_uploads/10155/hxml1HoBzSXmVRqDrscCQAlX/image-3.png\"></a></div><p>Thanks,<br>\nSaul</p>",
        "id": 173136017,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1565719160
    },
    {
        "content": "<p>you have two choices:</p>\n<p>1. constrain a defined extension  by profiling it.<br>\n2. Make your own custom extension<br>\nI never done the first and don't know if the tooling supports this</p>",
        "id": 173138026,
        "sender_full_name": "Eric Haas",
        "timestamp": 1565720701
    },
    {
        "content": "<p>It's definitely possible to profile an existing extension defining additional constraints (including mustSupport).  The fixed URL for the extension remains the same (because the semantics are the same), but you'd reference the canonical URL of the \"profiled\" extension in your profile to ensure that your constraints/expectations are enforced.  This works in the Java validator for sure (because I helped make the fixes when it initially didn't :&gt;)</p>",
        "id": 173674905,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1566320106
    },
    {
        "content": "<p>Hi <strong>Lloyd McKenzie</strong>  -- since the extensions are incorporated by reference, I'm not sure what this would look like.     Can you point me to an example where somebody has done this?    The current use cases (from Plan-Net) include:<br>\n    - taking an extension with a reference to a VhDir type <a href=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-location-reference.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-location-reference.html\">https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-location-reference.html</a>, and making it refer to a Plan-Net type  <a href=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-Location-reference-extension.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-Location-reference-extension.html\">https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-Location-reference-extension.html</a> (Plan-Net is a first cousin to VhDir, not a descendant)<br>\n    - taking an extension with an 'example' binding to a VS and making the binding 'extensible' <a href=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-endpoint-usecase.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-endpoint-usecase.html\">https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-endpoint-usecase.html</a></p>",
        "id": 184286416,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1577399465
    },
    {
        "content": "<p>I don't know off the top of my head where this has been done that I can point you too.  You can profile an extension definition in the same way as you can profile a resource.  The derived profile won't changed the fixed URL declared in the original extension definition, but can tighten up whatever else you need to.  You point to the derived extension profile rather than the original.</p>",
        "id": 184286804,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1577400096
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span>  - have you solved this since then? I'm dealing with a similar issue - I need to create a derived profile, where the valueSet used by its standard extension is constrained to a subset. A resource conforming to this derived profile needs to also conform to the parent profile. Since, as you said, the extension is incorporated by reference, deriving the extension itself won't work in this case. How have you approached this at the end?</p>",
        "id": 186904832,
        "sender_full_name": "Halina Labikova",
        "timestamp": 1580316710
    },
    {
        "content": "<p>In theory, you could profile the extension.  The structure definition used for extensions and profiles is basically the same.<br>\nWith the tooling I used for my IG (CIMPL), this wasn't supported.   With FSH/Sushi it is easily done, but there is currently no direct path to a publishable IG.</p>\n<p>What I did was just \"clone\" the extension within the IG I was developing, and impose constraints there.  IN my case, I needed to change a reference type.   YOu can see the original here:   <a href=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-newpatients.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-newpatients.html\">https://build.fhir.org/ig/HL7/VhDir//StructureDefinition-newpatients.html</a> and the 'clone' here <a href=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-NewPatients-extension.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-NewPatients-extension.html\">https://build.fhir.org/ig/HL7/davinci-pdex-plan-net/StructureDefinition-plannet-NewPatients-extension.html</a> </p>\n<p>From the perspective of the consumer of the data, they will have to deal with a different  extension (uri is different) either way, so I don't think my solution is that bad.</p>",
        "id": 186906270,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1580317530
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"215604\">@Saul Kravitz</span> </p>\n<blockquote>\n<p>With FSH/Sushi it is easily done, but there is currently no direct path to a publishable IG.</p>\n</blockquote>\n<p>From my understanding, fsh output is missing only the build file and the ig file for it to be ready to be consumed by the publisher scripts - both are easily generated manually, so tooling is not really an issue. </p>\n<blockquote>\n<p>From the perspective of the consumer of the data, they will have to deal with a different extension (uri is different) either way, so I don't think my solution is that bad.</p>\n</blockquote>\n<p>I guess this is my issue - I was hoping to find a way to impose constraints on an extension when used in a context of a specific profile, but without changing the referenced url (for conformance purposes). <br>\nTo give a specific example: I'm currently investigating whether using mCODE's PrimaryCancerCondition would cover all of our usecases. Let's say I need a derived profile to capture Mucosal Melanoma: I need to restrict the acceptable values in the onco-core-HistologyMorphologyBehavior-extension. If I do that by profiling the extension itself, the resource instance that will be conformant to my MM profile will no longer be conformant to the PrimaryCancerCondition profile.</p>",
        "id": 186911112,
        "sender_full_name": "Halina Labikova",
        "timestamp": 1580320658
    },
    {
        "content": "<blockquote>\n<p>From my understanding, fsh output is missing only the build file and the ig file for it to be ready to be consumed by the publisher scripts - both are easily generated manually, so tooling is not really an issue. </p>\n</blockquote>\n<p>for very simple and orthodox IGs, without pages, perhaps. but we're not there yet</p>",
        "id": 186916955,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1580324437
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194075\">@Halina Labikova</span>   I think your conformance concern is accurate.  I did not face that since my IG (Plan-Net) is not derived from the IG I was borrowing extensions from (VhDir).      I might try to generate a profile of the mCode extension using Sushi, and then figure out how to slip it into your IG.</p>",
        "id": 186917330,
        "sender_full_name": "Saul Kravitz",
        "timestamp": 1580324682
    }
]