[
    {
        "content": "<p>On a call today question was asked how to search for last n results or most recent results?  </p>",
        "id": 153820337,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460058235
    },
    {
        "content": "<p>query for the latest updated/inserted 30 observation resources:<br>\n<a href=\"http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=date&amp;_count=30\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=date&amp;_count=30\">http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=date&amp;_count=30</a></p>",
        "id": 153820339,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1460058589
    },
    {
        "content": "<p>thanks!</p>",
        "id": 153820340,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460058621
    },
    {
        "content": "<p>this one are the latest 30 observations by valueDateTime<br>\n<a href=\"http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=value-date&amp;_count=30\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=value-date&amp;_count=30\">http://fhirtest.uhn.ca/baseDstu2/Observation?_sort=value-date&amp;_count=30</a></p>",
        "id": 153820342,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1460058705
    },
    {
        "content": "<p>(or value-period)</p>",
        "id": 153820343,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1460058746
    },
    {
        "content": "<p>*valuePeriod</p>",
        "id": 153820344,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1460058790
    },
    {
        "content": "<p>OK  a little more complicated  how to for the most recent result of each type = code in a category.?  </p>",
        "id": 153820346,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460059176
    },
    {
        "content": "<p>for  example: </p>",
        "id": 153820347,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460059185
    },
    {
        "content": "<p>GET [base]/Observation?patient=[id]&amp;category=vital-signs&amp; {last temp, weight, etc in the category}</p>",
        "id": 153820348,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460059257
    },
    {
        "content": "<p>or</p>",
        "id": 153820350,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460059275
    },
    {
        "content": "<p>GET [base]/Observation?patient=[id]&amp;category=laboratory&amp;{ last glucose, NA, K etc}</p>",
        "id": 153820351,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460059359
    },
    {
        "content": "<p>order by date descending and ask for only 1  (too lazy to look up the actual query!)</p>",
        "id": 153820361,
        "sender_full_name": "David Hay",
        "timestamp": 1460059811
    },
    {
        "content": "<p>There's no \"group by\" in FHIR, so you'd need to do a custom query/operation or some sort of custom search parameter to do that.</p>",
        "id": 153820426,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1460066787
    },
    {
        "content": "<p>As a clinician I can see a lot of practical utility getting only the most recent n result of labs/vitals for a patient.   On paper I  only look back to the most recent visits and labs.   This was brought up twice on a recent Argo call for Labs and Vitals.  So since there doesn't seem to be a way to do this presently,  I'll submit a tracker to create an operation for Observation.   Anybody think this is a bad idea?</p>",
        "id": 153820543,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460188562
    },
    {
        "content": "<p>Trying something is rarely a bad idea :)</p>",
        "id": 153820556,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1460212574
    },
    {
        "content": "<p>perhaps pass in a valueset with the codes that you would like the last value of?</p>",
        "id": 153820564,
        "sender_full_name": "David Hay",
        "timestamp": 1460225723
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> I'm not sure what you can't do - get the last n results for labs and vitals should be straight forward....</p>",
        "id": 153820608,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460349406
    },
    {
        "content": "<p>\"get the last n results for labs and vitals should be straight forward....\" Not for me.  I want the most recent of each of the labs ( whatever they are - I don't know that ahead of time for a patient -   ie a the last cbc, chem, ua , t4 and lipase panel and 16 more. )  So the category is 'laboratory'  I know that, do  I order by date and code?</p>",
        "id": 153820624,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460354203
    },
    {
        "content": "<p>ok. name a panel, and get the last of the panel - you can name the panel by a code, yes? </p>",
        "id": 153820625,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460354485
    },
    {
        "content": "<p>that's ok, so it's just a batch ith 14 requests</p>",
        "id": 153820626,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460354494
    },
    {
        "content": "<p>If I knew what labs the patient had already.  I could search by panel.    Remember I'm doing a search on for never before seen patient and I  want to review all the labs they ever had by starting with the most recent one of each.  So I need to search through the entire master list of lab codes and return the most recent one for each unique lab.  I don' t  see how searching for a single panel solves that?</p>",
        "id": 153820628,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460355598
    },
    {
        "content": "<p>I think this is amost hard thing to do. I want to search for something but I don't know what I'm searching by....</p>",
        "id": 153820632,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460356631
    },
    {
        "content": "<p>You search by Observation.category = vitals or labs and return the latest and greatest of each code that exists. </p>",
        "id": 153820635,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460357081
    },
    {
        "content": "<p>yes, that's a general recipe, but 'latest and greatest' is the loose point</p>",
        "id": 153820638,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460362556
    },
    {
        "content": "<p>Wouldnt you search for the orders? There would be no labs/observations without someone submitting an order.</p>",
        "id": 153820655,
        "sender_full_name": "Mat Coolidge ",
        "timestamp": 1460380810
    },
    {
        "content": "<p>We are modeling the order results, especially lab panels,  as diagnostic reports</p>",
        "id": 153820656,
        "sender_full_name": "Mat Coolidge ",
        "timestamp": 1460380981
    },
    {
        "content": "<p>but in the context of the application it looks first for the orders and lists them (including status)</p>",
        "id": 153820657,
        "sender_full_name": "Mat Coolidge ",
        "timestamp": 1460381019
    },
    {
        "content": "<p>Actually, it's very common to have vital signs observations without orders.  (And it's occasionally possible to have lab tests without orders too.)</p>",
        "id": 153820680,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1460389808
    },
    {
        "content": "<p>Whether search for Observations or DiagnosticReports  same idea.    I want to scan the breadth of whats been done.</p>",
        "id": 153820682,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460390001
    },
    {
        "content": "<p>OK maybe not \"latest and greatest\"  but at least \"latest\"</p>",
        "id": 153820683,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460390051
    },
    {
        "content": "<p>I believe was called  \"lastknown\" by one participant on call</p>",
        "id": 153820684,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460390090
    },
    {
        "content": "<p>We call it \"last N\" internally for Millennium. The _count parameter doesn't work because that's page size. EG: I want to see the last 2 of each vital result for this patient. Or I want the last 10 labs of these types (monitoring disease progression or therapy response). It's actually the most common way internally that we see used to find labs and vitals.</p>",
        "id": 153820809,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460395383
    },
    {
        "content": "<p>if you use count, you may get 100 heights before you even see 1 weight (and cross many pages)</p>",
        "id": 153820810,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460395424
    },
    {
        "content": "<p>I don't think this needs to be an operation - couldn't we just create another parameter? EG: maxPerCode or something? All other query params likely still apply</p>",
        "id": 153820811,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460395512
    },
    {
        "content": "<p>I agree that this is a common (maybe even the most common, as Jenni said) use case for labs and vitals, and it makes sense to support it.  As Eric said, you would want to search by Observation.category (and that may be about the best use for category that I've seen).  A parameter seems reasonable.  The \"PerCode\" part seems a little clunky to me - could that instead be implicit?  I don't think that \"max\" would actually be saying what we need here.  Maybe it could be \"lastN\", or \"lastNPerCode\" (if we do need to include the latter bit)?</p>",
        "id": 153820814,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1460396458
    },
    {
        "content": "<p>Surely this is a proper use for a batch? </p>",
        "id": 153820825,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460398210
    },
    {
        "content": "<p>I hope not, from an API perspective, I would rather be able to get this straight from the \"owning\" resource given how common the use case is</p>",
        "id": 153820836,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460402472
    },
    {
        "content": "<p>I'm not sure how common this is outside of Observation</p>",
        "id": 153820837,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460402493
    },
    {
        "content": "<p>most others are usually all active or date range (at least in CCDS)</p>",
        "id": 153820838,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460402530
    },
    {
        "content": "<p>I could see something similar, i guess, on diagnosticReport given the relationship between them. EG: let me complare the last 2 reports from imaging scans</p>",
        "id": 153820839,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460402632
    },
    {
        "content": "<p>well, if they have the same modality and body site...</p>",
        "id": 153820840,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460402851
    },
    {
        "content": "<p>is this really a common use case though? </p>",
        "id": 153820841,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460402895
    },
    {
        "content": "<p>there's variations on this above - is it latest in category, or latest by panel, or latest by actual observation value?</p>",
        "id": 153820842,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460402931
    },
    {
        "content": "<p>In our case, it's usually latest by code. Even if you queried at a category level, we would return latest by like code</p>",
        "id": 153820848,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460403531
    },
    {
        "content": "<p>eg: give me the last 1 of all vitals would return 1 height, 1 weight, 1 temp...</p>",
        "id": 153820849,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460403569
    },
    {
        "content": "<p>latest in by observation code in Obs where category equal labs or vitals,  and latest by results code in DR.  I see the problem with panel vs atomic test codes in Obs.   decision needed there .. maybe exclude those with no value or DAR    </p>",
        "id": 153820850,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460403669
    },
    {
        "content": "<p>It's a bit heavyweight, but you could definitely accomplish this with a batch request</p>",
        "id": 153820861,
        "sender_full_name": "James Agnew",
        "timestamp": 1460406682
    },
    {
        "content": "<p>well, thsis is one kind of 'please do some analysis for me' </p>",
        "id": 153820866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460407934
    },
    {
        "content": "<p>How would this be done via batch? I think I'm missing some param documentation somewhere</p>",
        "id": 153820867,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460407939
    },
    {
        "content": "<p>It would be a transaction with a bunch of search operations in it. Like, one search operation for \"give me the most recent weight\", one for \"give me the most recent BP\", etc</p>",
        "id": 153820879,
        "sender_full_name": "James Agnew",
        "timestamp": 1460408307
    },
    {
        "content": "<p>great for vitals for which may have a dozen codes. What about labs where you may have 2000+  codes?  What if you are accessing another system and don't know what codes they use?</p>",
        "id": 153820881,
        "sender_full_name": "Eric Haas",
        "timestamp": 1460408478
    },
    {
        "content": "<p>yeah, if you don't know the codes that wouldn't work.... </p>",
        "id": 153820884,
        "sender_full_name": "James Agnew",
        "timestamp": 1460408626
    },
    {
        "content": "<p>how would it work if you don't know the codes anyway?</p>",
        "id": 153820885,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460408675
    },
    {
        "content": "<p>and also, you would have to \"hack\" search by using page size as a max - which is not apparent. Nor is it obvious why you can't do this through Observation itself</p>",
        "id": 153820887,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408684
    },
    {
        "content": "<p>please give me something.... I don't know how to tell you what I want....</p>",
        "id": 153820888,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460408687
    },
    {
        "content": "<p>(for the batch approach)</p>",
        "id": 153820890,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408697
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - /Observation?category=vital-signs&amp;max=5</p>",
        "id": 153820893,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408718
    },
    {
        "content": "<p>well, it's obvious why you can't - we didn't define it. I think you meant, why shouldn't you...</p>",
        "id": 153820894,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460408718
    },
    {
        "content": "<p>(max being whatever param name we decided to call it, lastN, etc)</p>",
        "id": 153820900,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408755
    },
    {
        "content": "<p>/Observation?category=hematology&amp;lastN=5</p>",
        "id": 153820903,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408779
    },
    {
        "content": "<p>why don't just query for the Observation.Category and and define a lab category  to get the 2000 different lab observations and sort by date</p>",
        "id": 153820910,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1460408836
    },
    {
        "content": "<p>or, if you *did* know the code, /Observation?code=http://loinc.org|8867-4&amp;lastN=10</p>",
        "id": 153820913,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408850
    },
    {
        "content": "<p>because if I have a lab that has 1000 results on its own (very recent), and I want 5, I have to page through all of that to get to the next lab?</p>",
        "id": 153820922,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408892
    },
    {
        "content": "<p>more common for vitals or measurements that come in via machines per second</p>",
        "id": 153820923,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408909
    },
    {
        "content": "<p>we are working on defining an operation that allows you to ask for 'current vital signs status' and returns latest values along with stats (min, max, mean, trend) over a period of time</p>",
        "id": 153820925,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460408978
    },
    {
        "content": "<p>also, as the server that's going to impact my EHR and users to expose that massive amount of results when you only want 5 of each... ew :) <br>\nAnd if anyone charged by transaction a la Amazaon... ew...</p>",
        "id": 153820926,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460408986
    },
    {
        "content": "<p>lab seems a slightly different case. It's still not clear to me what is proposed for the client to ask for, and how the server decides what to return</p>",
        "id": 153820927,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1460409050
    },
    {
        "content": "<p>The operation won't help when the app is graphing the actual trend either - common for vitals</p>",
        "id": 153820928,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1460409087
    },
    {
        "content": "<p>An unbounded last change since is definitely a large burden on the server.</p>",
        "id": 153820929,
        "sender_full_name": "Hussain Chinoy",
        "timestamp": 1460409142
    },
    {
        "content": "<p>Retrieving most recent labs when you don't know the codes could still make sense in situations where you're expecting the data to be looked at by a human, not necessarily evaluated by decision support or something.  I tend to agree that using batch where you know the codes is an ugly way to solve the problem and it's unworkable if you don't know all of the codes that could be relevant on the target system.</p>",
        "id": 153820953,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1460430461
    },
    {
        "content": "<p>I can also potentially envision \"most recent by practitioner\" or \"most recent by location\", though those wouldn't be as common.  If we want to allow filtering of which elements can be used, the parameter would need to be a composite combining the name of the search criteria to \"group\" by and the number of records to return.  If we restrict it to code, we'd need a piece of metadata to use to identify what attribute applied.  We could probably leverage the w5 for this, but we'd need a rule that one and only one attribute per resource could have that w5 category.</p>",
        "id": 153820955,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1460430719
    }
]