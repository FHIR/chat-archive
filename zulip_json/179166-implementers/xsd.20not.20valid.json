[
    {
        "content": "<p>Hi,</p>\n<p>I hope you are doing well today.<br>\nI must work in data integration on new project. The goal is the validation of all input flows using the FHIR norme v4.0.1.<br>\nI work with Websphere Transformation extender (IBM technology) and I am not familiar with the normative FHIR.<br>\nI download all xsd (v4.0.1: R4 - Mixed Normative and STU) on the official web page <a href=\"http://hl7.org/fhir/downloads.html\">http://hl7.org/fhir/downloads.html</a>.</p>\n<p>1) I have an error while I try to import these xsd because there are not valid. The problem occurs for example on claim.xsd, fhir-base.xsd but lot of xsd are concerned by this problem. Following the error message, there is a problem with a reference of a type or a missing reference. You can find all errors that I encountered in the attachment report.txt. <a href=\"/user_uploads/10155/7cqub9iLAm9m60fm7ZCpn3Cd/report.txt\">report.txt</a></p>\n<p>2) Despite this problem, I found also this disclaimer in the xsd file :</p>\n<p>Implementers will still need to be familiar with the content of the specification and with any profiles that apply to the resources in order to make a conformant implementation.<br>\nSo, it means that the validation is a partial validation? I see that a validator exist in Java. This module is mandatory for the validation of the data? </p>\n<p>3) I see also in the downloaded zip, some files with extension sch. Do you know what is the usage of these files?</p>\n<p>If you have any advice, I'm more than interested.<br>\nThank you very much in advance</p>\n<p>Valentin Cuvelier</p>",
        "id": 245788267,
        "sender_full_name": "V.Cuvelier",
        "timestamp": 1626161963
    },
    {
        "content": "<p>sch files are schematrons, an xml assertion language. They add some extra checks that xsd cannot do.</p>",
        "id": 245803811,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626171596
    },
    {
        "content": "<p>Re 2, yes, and all validation is partial validation ;-) But xsd is mainly for validating the broad structure, and cannot check all your codes and business rules. But that doesn't mean they are not helpful, especially when working with XML by hand.</p>",
        "id": 245804107,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626171742
    },
    {
        "content": "<p>The java validator is an alternative to the xsds, and is more complete. But may be less convenient - it depends what you are trying to do.</p>",
        "id": 245804413,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626171898
    },
    {
        "content": "<p>Your #1 is different. Let us know what the error is. The schemas should work ok, whether or not they are what you need. Some code complains about circular references, but it is actually legal.</p>",
        "id": 245804672,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626172016
    },
    {
        "content": "<p>Hi Rik,</p>\n<p>Thanks for your answer. It is more clear for me for point 2 and 3.<br>\nFor first point, I try to validate the claim.xsd and it include the xsd fhir-base.xsd and I have the error for fhir-base.xsd.</p>\n<p>You have all details in the report file (report.txt) which I attached in previous message.<br>\nHere, you have the first error that I encountered.</p>\n<p>For fhir-base.xsd<br>\nThis is the first error XML spy is producing.</p>\n<p>The schema doesn't appear to be valid by itself (as a part of another schema, it might still be OK).<br>\n    Value '(\\s<em>([0-9a-zA-Z</em>\\/<em>\\+\\=]){4}\\s</em>)+' is not a valid XML regular expression.<br>\n        Error location: xs:schema / xs:simpleType / xs:restriction / xs:pattern / @value<br>\n        Details</p>\n<div class=\"codehilite\"><pre><span></span><code>        invalid-escape: The given character escape is not recognized.\n        dt-pattern: Value &#39;(\\s*([0-9a-zA-Z*\\/*\\+\\=]){4}\\s*)+&#39; is not a valid XML regular expression.\n</code></pre></div>\n\n<p>When we correct this problem, there are others errors like 'ResourceType' must refer to an existing simple or complex type.</p>\n<p>It is really strange for me that the xsd are not valid. Maybe, there is something missing? The full zip that I downloaded. <a href=\"/user_uploads/10155/IR8kxk6RZVPleonrl289RKNn/fhir-all-xsd.zip\">fhir-all-xsd.zip</a></p>",
        "id": 245805950,
        "sender_full_name": "V.Cuvelier",
        "timestamp": 1626172849
    },
    {
        "content": "<p>There are some know problems with recent versions of the generated schemas, in the current build. But the R4 package is ok as far as I know.  The date on those files of 28th June suggest these are from the build.</p>",
        "id": 245816338,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626179229
    },
    {
        "content": "<p>Ok,<br>\nNobody reproduce my problem?<br>\nI downloaded the official xsd and I cannot do anything with it. I try to search an older version. I find the specification 3.5a.0 and for older version but I cannot downloaded the xsd package. From this webpage <a href=\"http://hl7.org/fhir/2018Dec/downloads.html\">http://hl7.org/fhir/2018Dec/downloads.html</a>, we can downloaded the xsd version  but we have this error message.</p>\n<div class=\"codehilite\"><pre><span></span><code>The file you were looking for was not found. If you arrived at this page from one of your bookmarks, or you believe the location of your file might have changed, you may find it beneficial to try one of the following:\n\nBrowse the HL7 Site Map\nSearch our website for your file.\nVisit the HL7.org homepage.\nSend an e-mail to webmaster@HL7.org.\n</code></pre></div>\n<p>So, it means the resource is not available now.<br>\nMaybe you have a working version? Where can I find it or can you share it?<br>\nThank you in advance.</p>",
        "id": 245941268,
        "sender_full_name": "V.Cuvelier",
        "timestamp": 1626257966
    },
    {
        "content": "<p>This is the direct link for 4.01 <a href=\"http://hl7.org/fhir/fhir-all-xsd.zip\">http://hl7.org/fhir/fhir-all-xsd.zip</a><br>\nI just downloaded this, loaded fhir-all.xsd into Oxygen, and it validated ok.</p>",
        "id": 245951487,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1626265026
    },
    {
        "content": "<p>I came across this issue in version 4.6.0 and latest build. There are many references to the complex type ResourceType that do not resolve. In 4.01 there is only one reference to this type, the reference is from ExampleScenario.Instance.resourceId, and the ResourceType is defined in  examplescenario.xsd and it also shows up in fhir-single.xsd.   In the newer builds there are many more references, 12 I think, to ResourceType but it is no longer defined in any of the XSD files or in fhir-single.xsd.</p>",
        "id": 253216246,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1631608563
    },
    {
        "content": "<p>I also get the following error in 4.6.0 for this XSD:</p>\n<p>&lt;xs:simpleType name=\"base64Binary-primitive\"&gt;<br>\n    &lt;xs:restriction base=\"xs:base64Binary\"&gt;<br>\n      &lt;xs:pattern value=\"(\\s<em>([0-9a-zA-Z</em>\\/<em>\\+\\=]){4}\\s</em>)+\"/&gt;<br>\n    &lt;/xs:restriction&gt;<br>\n  &lt;/xs:simpleType&gt;</p>\n<p>Error (in Visual Studio Code):<br>\nInvalidRegex: Pattern value '(\\s<em>([0-9a-zA-Z</em>\\/<em>\\+\\=]){4}\\s</em>)+' is not a valid regular expression. The reported error was: 'This expression is not supported in the current option setting.'.</p>",
        "id": 253216415,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1631608665
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 253360195,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1631679567
    },
    {
        "content": "<p>A little typo in my earlier post but can't edit to fix. It should be:  ExampleScenario.Instance.resourceType (not .resourceId as I stated above)  that is an example of where there is a reference to ResourceType.</p>\n<p>Out of curiosity, I took a quick look at the JSON Schema for 4.0.1.  The same path, ExampleScenario.Instance.resourceType, is not bound to the same enumeration/valueset as the XSD shows. It only says that ExampleScenario.Instance.resourceType  is a code, not an enumeration of the valueset.</p>",
        "id": 253529247,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1631768381
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"223326\">@Shahim Essaid</span> <span class=\"user-mention\" data-user-id=\"191651\">@Rik Smithies</span> this will be fixed in 4.6.0 in a couple of days (when all my changes make their way into <a href=\"http://build.fhir.org\">build.fhir.org</a>. But: oxygen is complaining about this line:</p>",
        "id": 257308496,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634098591
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"XML\"><pre><span></span><code> <span class=\"nt\">&lt;xs:simpleType</span> <span class=\"na\">name=</span><span class=\"s\">\"base64Binary-primitive\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;xs:restriction</span> <span class=\"na\">base=</span><span class=\"s\">\"xs:base64Binary\"</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;xs:pattern</span> <span class=\"na\">value=</span><span class=\"s\">\"\\s*([0-9a-zA-Z\\+\\=]{4}\\s*)+\"</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/xs:restriction&gt;</span>\n  <span class=\"nt\">&lt;/xs:simpleType&gt;</span>\n</code></pre></div>",
        "id": 257308503,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634098598
    },
    {
        "content": "<p>I can't see why - that's a valid pattern as far as I'm concerned.</p>",
        "id": 257308512,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634098614
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  I don't think the escapes are needed in the character class.</p>",
        "id": 257312457,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1634102377
    },
    {
        "content": "<p>since when was that a problem though?</p>",
        "id": 257314031,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634103748
    },
    {
        "content": "<p>Its the \"\\=\" I think.</p>\n<p>From a recent build I have this:</p>\n<div class=\"codehilite\" data-code-language=\"XML\"><pre><span></span><code>      <span class=\"nt\">&lt;xs:pattern</span> <span class=\"na\">value=</span><span class=\"s\">\"(\\s*([0-9a-zA-Z*\\/*\\+\\=]){4}\\s*)+\"</span><span class=\"nt\">/&gt;</span>\n</code></pre></div>\n<p>Neither Xerces nor Saxon like that.</p>\n<p>But they are ok with this:</p>\n<div class=\"codehilite\" data-code-language=\"XML\"><pre><span></span><code>      <span class=\"nt\">&lt;xs:pattern</span> <span class=\"na\">value=</span><span class=\"s\">\"(\\s*([0-9a-zA-Z*/*\\+=]){4}\\s*)+\"</span><span class=\"nt\">/&gt;</span>\n</code></pre></div>\n<p>Presumably the \"/\" and \"=\" don't need escaping. The forward slash isn't there at all in your new version.</p>\n<p>These are not mentioned here as special characters, <br>\n<a href=\"https://www.w3.org/XML/2008/03/xsdl-regex/re.xml\">https://www.w3.org/XML/2008/03/xsdl-regex/re.xml</a><br>\n\"A metacharacter is either ., \\, ?, *, +, {, } (, ), |, [, or ]. \"</p>\n<p>Maybe some parsers leniently allow the escape character in places where it isn't meant to be.</p>",
        "id": 257351867,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1634126102
    },
    {
        "content": "<p>Inside a character class most meta characters are regular characters according to: <a href=\"https://www.regular-expressions.info/xml.html\">https://www.regular-expressions.info/xml.html</a> and the section about metacharacters here <a href=\"https://www.regular-expressions.info/charclass.html#special\">https://www.regular-expressions.info/charclass.html#special</a></p>\n<p>Looking at the spec here <a href=\"https://www.w3.org/TR/xmlschema-2/#cces\">https://www.w3.org/TR/xmlschema-2/#cces</a>  only the one before the \"=\" seems to be the problem. I confirmed that the error goes away in VSC if I only remove the one before the equals sign.</p>",
        "id": 257369160,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1634133344
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"223326\">@Shahim Essaid</span> Does this page <a href=\"https://www.w3.org/TR/xmlschema-2/#cces\">https://www.w3.org/TR/xmlschema-2/#cces</a> allow \"\\/\"?  In Oxygen it is not enough to just remove the one before equals.</p>",
        "id": 257377142,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1634136072
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191651\">@Rik Smithies</span>  I meant only removing the one before the equals from Grahame's example works. \"\\/\" is not a valid escape sequence according to the XSD regex grammar shown at that link/table.</p>",
        "id": 257380096,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1634137073
    },
    {
        "content": "<p>The way I'm understanding this is that first the escape sequence has to be legal according to that link. But, inside a character class, less escaping is needed but it's still allowed. Removing the \\ from your \\/ and \\= example fixes the error in VSC.</p>",
        "id": 257380438,
        "sender_full_name": "Shahim Essaid",
        "timestamp": 1634137197
    },
    {
        "content": "<p>yes good point - Grahame has already removed \\/ in his new version.</p>",
        "id": 257383442,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1634138225
    },
    {
        "content": "<p><a href=\"https://jira.hl7.org/browse/FHIR-34126\">https://jira.hl7.org/browse/FHIR-34126</a></p>",
        "id": 257426157,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1634154487
    }
]