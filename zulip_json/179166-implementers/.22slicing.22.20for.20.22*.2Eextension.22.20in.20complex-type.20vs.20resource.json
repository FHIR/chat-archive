[
    {
        "content": "<p>While staring at StructureDefinition's I found one detail which I am now curious about.</p>\n<p>All <code>.extension</code> fields on resources do not have \"slicing\" element defined on them, but all similarly defined fields on complex type do have it.</p>\n<p>For example, check these two:<br>\n1. <a href=\"http://hl7.org/fhir/patient.profile.json.html\" target=\"_blank\" title=\"http://hl7.org/fhir/patient.profile.json.html\">http://hl7.org/fhir/patient.profile.json.html</a> <code>Patient.contact.extension</code> element (no <code>slicing</code> field)<br>\n2. <a href=\"http://hl7.org/fhir/timing.profile.json.html\" target=\"_blank\" title=\"http://hl7.org/fhir/timing.profile.json.html\">http://hl7.org/fhir/timing.profile.json.html</a> <code>Timing.repeat.extension</code> element (<code>slicing</code> is defined).<br>\nBoth Patient.contact and Timing.repeat \"inherit\" this field from Element.extension, which has \"slicing\" defined on it.</p>\n<p>Why is that?</p>",
        "id": 169370914,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1561961631
    },
    {
        "content": "<p>Slicing is declared for extension as part of DomainResource and Element and gets inherited by downstream resources and profiles, so it doesn't need to be re-declared.</p>",
        "id": 169399033,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1561990594
    },
    {
        "content": "<p>Right, but isn't the purpose of \"snapshot\" is to define everything that system needs to know in order to interpret StructureDefinition?</p>\n<p>The issue I'm having currently is that:</p>\n<p>1. Composition does not define \"slicing\" on \"Composition.extension\" element (<a href=\"https://www.hl7.org/fhir/composition.profile.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/composition.profile.json.html\">https://www.hl7.org/fhir/composition.profile.json.html</a>).<br>\n2. Some profile on Composition adds a slice to that \"Composition.extension\" element, for example, <a href=\"https://www.hl7.org/fhir/catalog.profile.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/catalog.profile.json.html\">https://www.hl7.org/fhir/catalog.profile.json.html</a> adds \"Composition.extension:ValidityPeriod\" in its \"differential\".<br>\n.</p>\n<p>So, for system to generate \"snapshot\" for this \"catalog\" profile (this is the code I'm currently writing), I would expect it should be enough to have \"snapshot\" for \"Composition\" (base) and \"differential\" for \"catalog\" profile.</p>\n<p>However, this is not the case -- I also need to analyze these \"inherited\" elements, so I effectively need DomainResource \"snapshot\" + Composition \"snapshot\" + catalog \"differential\", which is not ideal (and then again, for some reason datatypes declare that \"slicing\" explicitly).</p>",
        "id": 169457496,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1562050206
    },
    {
        "content": "<p>The snapshot for Composition should include Composition.extension with slicing declared.  So long as you have the snapshot of the parent model, you should have everything you need.</p>",
        "id": 169483986,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562076669
    },
    {
        "content": "<p>Right, but that's not the case: <a href=\"https://www.hl7.org/fhir/composition.profile.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/composition.profile.json.html\">https://www.hl7.org/fhir/composition.profile.json.html</a> (search for \"Composition.extension\").</p>\n<p>Though, I realized I need to pull other definitions anyways since profile can restrict fields of embedded data types (for example, <a href=\"http://hl7.org/fhir/vitalspanel.profile.json.html\" target=\"_blank\" title=\"http://hl7.org/fhir/vitalspanel.profile.json.html\">http://hl7.org/fhir/vitalspanel.profile.json.html</a> places a constraint on Observation.code.coding, which comes from CodeableConcept and is not present in the Observation definition), so this missing \"slicing\" is fine -- I can pull it from the \"base\" element (DomainResource.extension).</p>",
        "id": 169514497,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1562097787
    },
    {
        "content": "<p>Hmm.  That seems like an issue with snapshot generation.  Hopefully <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> can comment when he gets a chance to be online.</p>",
        "id": 169522311,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562104267
    },
    {
        "content": "<p>well, I'm not sure. we do say that there's some magic in the slicing of extensions, but I think that it would be consistent with the decision we made about slicing choices that the snapshot should be specific. No one has commented on my proposed test cases yet...</p>",
        "id": 169609903,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562196749
    },
    {
        "content": "<p>I did...</p>",
        "id": 169611445,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562198860
    },
    {
        "content": "<p>so you did. On my task list for today maybe</p>",
        "id": 169611511,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562198970
    },
    {
        "content": "<p>today? in the outback? with all that glorious scenery around you? (Almost as nice as NZ)...</p>",
        "id": 169622430,
        "sender_full_name": "David Hay",
        "timestamp": 1562218866
    },
    {
        "content": "<p>well, 4wd was in for new windscreen, so tried to get it done while waiting but the build server crashed</p>",
        "id": 169630908,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562230153
    },
    {
        "content": "<p>well, first we need a task for FHIR-I to approve to fix R4 for this when I do the R4 technical corrections in a few weeks time</p>",
        "id": 169678000,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562287837
    },
    {
        "content": "<p>second, do we need to do anything about this in the test cases?</p>",
        "id": 169678009,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562287882
    },
    {
        "content": "<p>would it make sense to have a markdown option for the narrative.  It would mean that markdown FHIR used would have to support the xhtml though which it cuyx</p>",
        "id": 171653713,
        "sender_full_name": "Eric Haas",
        "timestamp": 1564013970
    },
    {
        "content": "<p>I'd consider that a breaking change - which would be problematic given that narrative is normative...</p>",
        "id": 171653926,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1564014257
    },
    {
        "content": "<p>if we had commonmark now, we would not have had xhtml in the resources. Too late now, I think....</p>",
        "id": 171764904,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564138929
    }
]