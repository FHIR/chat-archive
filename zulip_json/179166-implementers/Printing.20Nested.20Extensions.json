[
    {
        "content": "<p>We're trying to implement nested extensions:</p>\n<div class=\"codehilite\"><pre><span></span>   Extension pop = new Extension().setUrl(StringValues.MEMBER_POPULATIONS.getValue()).setValue(new IntegerType(index));\n    if (StringUtils.isNotBlank(memberPopulation.getPopulationId())) {\n        pop.addExtension(StringValues.POPULATION_ID.getValue(), new StringType(memberPopulation.getPopulationId()));\n    }\n    if (StringUtils.isNotBlank(memberPopulation.getPopulationRuleName())) {\n        pop.addExtension(StringValues.POPULATION_RULE_NAME.getValue(), new StringType(memberPopulation.getPopulationRuleName()));\n    }\n\n    if (null != memberPopulation.getStartDate() || null != memberPopulation.getEndDate()) {\n        pop.addExtension(StringValues.DATES.getValue(), new Period().setStart(null != memberPopulation.getStartDate() ? memberPopulation.getStartDate().getTime() : null)\n                .setEnd(null != memberPopulation.getEndDate() ? memberPopulation.getEndDate().getTime() : null));\n    }\n    if (null != memberPopulation.getMemberPopAssociationDateTime()) {\n        pop.addExtension(StringValues.MEMBER_POP_ASSOCIATION_DATE_TIME.getValue(), new DateTimeType(memberPopulation.getMemberPopAssociationDateTime()));\n    }\n    patient.addExtension(pop);\n</pre></div>\n\n\n<p>But our FhirServer and our JsonParser doesn't print out the nested extensions. It only prints out the parent extension.</p>\n<p>Any insights on this? Maybe there is a setting that needs to be turned on.</p>",
        "id": 168530716,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1560967564
    },
    {
        "content": "<p>What library are you using?</p>",
        "id": 168544119,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1560977145
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> we're using hapi fhir dependencies for R4 in java</p>",
        "id": 168590165,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1561033384
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ?</p>",
        "id": 168590590,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1561033802
    },
    {
        "content": "<p>That code looks correct. Are you sure that all of the if statements are actually hitting, and the nested extensions are being correct?</p>\n<p>If so, can you try posting a code snipped using constants (e.g. <code>\"foo\"</code>) instead of externally defined variables that isn't behaving the way you expect?</p>",
        "id": 168600463,
        "sender_full_name": "James Agnew",
        "timestamp": 1561040913
    },
    {
        "content": "<p>Yes, all of those if statements are being hit. When I run the code in debug mode, I can see that the parent extension has 4 extensions</p>",
        "id": 168601434,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1561041567
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ???</p>",
        "id": 168868625,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1561397746
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196682\">@Tia Cummings</span>  OK- Can you try posting a code snippet using constants (e.g. \"foo\") instead of externally defined variables that isn't behaving the way you expect?</p>\n<p>The code snippet you provided isn't something that could be run easily but you because it relies on variables from your application (e.g. \"memberpopulation\"). If you replace all of these with constants (e.g. <code>\"foo\"</code>) I might be able to help.</p>",
        "id": 168882573,
        "sender_full_name": "James Agnew",
        "timestamp": 1561408161
    },
    {
        "content": "<p>Extension pop = new Extension().setUrl(\"memberPopulations\").setValue(new IntegerType(1));<br>\n       if (StringUtils.isNotBlank(\"population id\")) {<br>\n           pop.addExtension(\"populationId\", new StringType(\"population id\"));<br>\n      }<br>\n       if (StringUtils.isNotBlank(\"population rule name)) {<br>\n           pop.addExtension(\"populationRuleName\", new StringType(\"population rule name));<br>\n      }<br>\n       patient.addExtension(pop);</p>",
        "id": 168883348,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1561408813
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196682\">@Tia Cummings</span>  Ahh I see it: The issue is that you're setting both a value and child extensions your your root extension (<code>pop</code>). You can't have both according to FHIR's rules, so the value takes presedence in HAPI's encoding rules. We should probably emit a warning in that case...</p>",
        "id": 168883755,
        "sender_full_name": "James Agnew",
        "timestamp": 1561409163
    },
    {
        "content": "<p>Oooohh. That's actually better. Thanks, I'll try that</p>",
        "id": 168933208,
        "sender_full_name": "Tia Cummings",
        "timestamp": 1561465669
    }
]