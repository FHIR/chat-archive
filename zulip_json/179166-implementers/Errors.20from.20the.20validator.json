[
    {
        "content": "<p>This issue report: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/50\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/50\">https://github.com/hapifhir/org.hl7.fhir.core/issues/50</a> says that the indexes reported by the validator are wrong. </p>\n<p>but XPath indexes are 1 based: <a href=\"https://mukulgandhi.blogspot.com/2008/05/blog-post.html\" target=\"_blank\" title=\"https://mukulgandhi.blogspot.com/2008/05/blog-post.html\">https://mukulgandhi.blogspot.com/2008/05/blog-post.html</a></p>\n<p>JsonPath, of course, they start at 0. FHIRPath makes it 0 except in special cases</p>",
        "id": 169677086,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562286054
    },
    {
        "content": "<p>it's not obvious to me what the right behavior for the validator is here</p>",
        "id": 169677093,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562286069
    },
    {
        "content": "<p>There was a time when the indexes were inconsistent in the validator.  Sometimes 0-based, sometimes 1-based.  Not sure if that's still the case.</p>",
        "id": 169678921,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562289772
    },
    {
        "content": "<p>We're using FHIRPath to report the locations, so we should be using 0-based</p>",
        "id": 169678927,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562289788
    },
    {
        "content": "<p>(though that's certainly going to be confusing to some)</p>",
        "id": 169678928,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562289800
    },
    {
        "content": "<p>well, it's not FHIRPath based. :-(. Guess I'll have to invest in this part of the validator...</p>",
        "id": 169681233,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562294413
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> do you have any memory for what this part of the validator code is about:</p>\n<div class=\"codehilite\"><pre><span></span> <span class=\"kd\">private</span> <span class=\"kt\">boolean</span> <span class=\"nf\">isGrandfathered</span><span class=\"o\">(</span><span class=\"n\">String</span> <span class=\"n\">path</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;xds-documentmanifest.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;observation-device-metric-devicemetricobservation.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;medicationadministration-immunization-vaccine.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;elementdefinition-de-dataelement.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;dataelement-sdc-sdcelement.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;questionnaireresponse-sdc-structureddatacaptureanswers.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;valueset-sdc-structureddatacapturevalueset.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;dataelement-sdc-de-sdcelement.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;do-uslab-uslabdo.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">path</span><span class=\"o\">.</span><span class=\"na\">startsWith</span><span class=\"o\">(</span><span class=\"s\">&quot;.&quot;</span><span class=\"o\">))</span>\n      <span class=\"k\">return</span> <span class=\"kc\">true</span><span class=\"o\">;</span>\n\n    <span class=\"k\">return</span> <span class=\"kc\">false</span><span class=\"o\">;</span>\n  <span class=\"o\">}</span>\n</pre></div>",
        "id": 169681346,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562294702
    },
    {
        "content": "<p>.NET Validator uses 0 based ones for comparison</p>",
        "id": 169690235,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562311563
    },
    {
        "content": "<p>Is it right though?</p>",
        "id": 169694828,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562317446
    },
    {
        "content": "<p>Well - I hope it is - because then I can just treat the location as a valid FHIRpath, give it to the FHIRpath engine and retrieve the element in question that has the error</p>",
        "id": 169695836,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562318722
    },
    {
        "content": "<p>If I had to manually parse the location and +1 all the indexes (and insert them in short.forms) that wouldn't be nice :(</p>",
        "id": 169695855,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562318757
    },
    {
        "content": "<p>well, next release will generate proper FHIRPaths now.</p>",
        "id": 169698883,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562322307
    },
    {
        "content": "<p>Nice, thank you. That'll really help tools that show the raw resource put the error messages right</p>",
        "id": 169699678,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562323379
    },
    {
        "content": "<p>Or my front ends that use that value to select the control.</p>",
        "id": 169707491,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1562332271
    },
    {
        "content": "<p>Nope.  And the last 4 clauses are troubling.  The sdc ones aren't being used anymore.  I expect it was a transition where we didn't want to break things that had previously been valid while enforcing tighter rules on everyone else.  It seems reasonable to be tight on everyone at this point.</p>",
        "id": 169711043,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562335479
    }
]