[
    {
        "content": "<p>1. AllergyIntolerance contains a new required field as of STU3, AllergyIntolerance.verificationStatus. We plan to migrate our service from DSTU2 to STU3, but we don't have any source for this required field. What is best practice if there are required fields that cannot be mapped to an existing source of information ?  <br>\n2. The field verificationStatus has a required binding to a valueset (allergy-verification-status). How do we interpret this ? The binding is required, but not that particular value-set ? Can we substitute the value-set for something else ? The same is relevant for AllergyIntolerance.criticaly with required binding to (allergy-intolerance-criticality). In DSTU2 we solved this using an extension. But is it not possible to rather use the original element and then substitute the referenced valueset ?</p>",
        "id": 153909883,
        "sender_full_name": "Gerhard Andreassen",
        "timestamp": 1506076025
    },
    {
        "content": "<p>1. This is a breaking change. So you have to change business logic based on server's requirement.</p>",
        "id": 153909904,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506086482
    },
    {
        "content": "<p>2. No you cannot substitute a required value set binding. Here is what specified in FHIR spec:</p>",
        "id": 153909905,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506086532
    },
    {
        "content": "<p>The following rules apply when required bindings are used with the code data type:</p>\n<p>Where the value set is defined by FHIR, the list of allowed codes will be fixed in the XML schema<br>\nComparison between codes is always case sensitive unless the codes are selected by reference (e.g. ValueSet.compose), and the referenced specification clearly states otherwise<br>\nThe list of codes that can be used can only be extended in subsequent releases of the FHIR specification</p>",
        "id": 153909906,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1506086534
    },
    {
        "content": "<p>If you had populated the status attribute in STU2, you can move that information to verificationStatus.  If you didn't have a status, then I'd probably go with \"unconfirmed\" as that's the safest</p>",
        "id": 153909954,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1506101545
    },
    {
        "content": "<p>You can extend the element if that helps: <a href=\"https://fhirblog.com/2017/01/10/extending-a-required-valueset-binding/\" target=\"_blank\" title=\"https://fhirblog.com/2017/01/10/extending-a-required-valueset-binding/\">https://fhirblog.com/2017/01/10/extending-a-required-valueset-binding/</a></p>",
        "id": 153910787,
        "sender_full_name": "David Hay",
        "timestamp": 1506455137
    },
    {
        "content": "<p>That works if one of the codes applies and you want to provide more nuance.  It's going to confuse the heck out of other systems if none of the codes applies.</p>",
        "id": 153910798,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1506458054
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191321\">@David Hay</span>  I just looked at this blog post and I'm confused as heck already. Is the example saying you are sending  \"status\"=\"completed\" but what are you \"extending\" with:<br>\n\"_status\": {<br>\n    \"extension\" : [<br>\n       {<br>\n         \"url\": \"<a href=\"http://fhir.hl7.org.nz/dstu2/StructureDefinition/ms-status\" target=\"_blank\" title=\"http://fhir.hl7.org.nz/dstu2/StructureDefinition/ms-status\">http://fhir.hl7.org.nz/dstu2/StructureDefinition/ms-status</a>\",<br>\n         \"valueString\": \"stopped\"<br>\n       }<br>\n    ]<br>\n  }<br>\nIs it the value set? How can you extend a value set resource from within an instance of another resource? You don't even reference the value set you are extending. That seems <strong>very</strong> confusing to a receiver. </p>\n<p>Why not simply do a conceptMap?</p>",
        "id": 153911066,
        "sender_full_name": "Robert McClure",
        "timestamp": 1506544764
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span> You're sending a single code from a fixed value set.  You're also sending an additional data element that conveys a more nuanced code.  Certainly you might have a ConceptMap that tells you what \"official\" code should be sent for a given nuanced code.  But on the wire, you'll need to send the official code and want to send the more nuanced code.</p>",
        "id": 153911079,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1506546674
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I agree with the need, and understand that solving it for a single instance may not benefit from a map, but given this overall situation I'd assume all the various verificationStatus codes in use in NZ are going to be regularly used, so wouldn't a ConceptMap make sense then? </p>\n<p>Also, Am I right that since this is a code, not coding, translations are not allowed?</p>",
        "id": 153911085,
        "sender_full_name": "Robert McClure",
        "timestamp": 1506547376
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191503\">@Robert McClure</span> Yes, since it's a 'code' data type and a required binding, only the codes in the bound value set can be sent and translations are not allowed - unless you use an extension to carry the additional code, as David's post describes (I haven't read all of it yet).</p>",
        "id": 153911108,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1506550545
    },
    {
        "content": "<p>Alway happy to be corrected :) - but my understanding is that whether this particular new value ('stopped') is used elsewhere doesn't change the fact that you have to include the original (as Lloyd &amp; Rob have said). Not sure how the ConceptMap would help here - can you use it to define a specific value of the extension for use by others?</p>\n<p>Also - though I believe it is technically legit that the extension is of type 'string' - 'code' would be more consistent - in fact I suspect that in this scenario the type of the extension <em>should</em> be the same as the type that it is extending...  I'll update the post</p>",
        "id": 153911126,
        "sender_full_name": "David Hay",
        "timestamp": 1506557539
    },
    {
        "content": "<blockquote>\n<p>1. AllergyIntolerance contains a new required field as of STU3, AllergyIntolerance.verificationStatus. We plan to migrate our service from DSTU2 to STU3, but we don't have any source for this required field. What is best practice if there are required fields that cannot be mapped to an existing source of information ?  <br>\n2. The field verificationStatus has a required binding to a valueset (allergy-verification-status). How do we interpret this ? The binding is required, but not that particular value-set ? Can we substitute the value-set for something else ? The same is relevant for AllergyIntolerance.criticaly with required binding to (allergy-intolerance-criticality). In DSTU2 we solved this using an extension. But is it not possible to rather use the original element and then substitute the referenced valueset ?</p>\n</blockquote>\n<p>It might be a bit premature to suggest this as a complete solution, but Symptomatic/Meteor-on-FHIR recently completed most all of the resources for the Argonaut project and CCD on FHIR.  So, we're able to start offering FHIR routing services.  </p>\n<p>Because of the way Meteor on FHIR is built, each FHIR Resource is implemented as a separate simple-schema, with <code>.validate()</code>, <code>.clean()</code>, and other functions.  Long story short... with a little work, it could be set up as a relay or worker bot that validates and cleans up DTSU2 to DTSU3, adding default values and fields, and otherwise performing schema migrations.</p>",
        "id": 153913394,
        "sender_full_name": "Abbie Watson",
        "timestamp": 1507673886
    },
    {
        "content": "<p>what about this: <a href=\"http://hl7.org/fhir/extensibility.html#2.5.0.2.2\" target=\"_blank\" title=\"http://hl7.org/fhir/extensibility.html#2.5.0.2.2\">http://hl7.org/fhir/extensibility.html#2.5.0.2.2</a>  ?</p>",
        "id": 153913400,
        "sender_full_name": "Eric Haas",
        "timestamp": 1507674800
    },
    {
        "content": "<p>FYI - Patient Care just approved <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\">GF#13997</a>, which will relax cardinality of AllergyIntolerance.verificationStatus to be 0..1 in the next release.</p>",
        "id": 153913514,
        "sender_full_name": "Michelle (Moseman) Miller",
        "timestamp": 1507755418
    },
    {
        "content": "<p>VerificationStatus: This issue is begining to bite us in the UK as well. [Some] systems don't categorise allergies in the way VerificationStatus wants them classified, and our clinical leads think that VerificationStatus implies meaning about the allergy statement that is imposiible to ascertain from the source data.<br>\nThere's been a lot of chat on this post about extending the value set to add nuance to the required values. Is this the Internationally recommended way forward? What I'm picking up is where you cannot be sure of a VerificationStatus from the source data, you have a main code of \"unconfirmed\" then use an extension to nuance this with something like \"unable to verify from patient record\" (or something similar).<br>\nIs this a reasonable summary of the discussion? Is this the recommended way forward?</p>",
        "id": 153915603,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1508834615
    },
    {
        "content": "<p>what values do you have?</p>",
        "id": 153915606,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508834823
    },
    {
        "content": "<p>VerificationStatus isn't a concept in the source systems - they just state an allergy, but not whether it's confirmed or not.</p>",
        "id": 153915607,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1508835008
    },
    {
        "content": "<p>so this is unconfirmed then.</p>",
        "id": 153915608,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508835394
    },
    {
        "content": "<p>it's not refuted</p>",
        "id": 153915609,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508835404
    },
    {
        "content": "<p>I suppose the issue is that it might be confirmed or not</p>",
        "id": 153915610,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508835410
    },
    {
        "content": "<p>That is the issue, we don't know whether the allergy is confirmed or unconfirmed. If we had a verificationStatus of \"Unknown\" (like the value list on Condition - which is optional) we would be OK. I would like a suggested way that we can all follow for representing an allergy that is neither confirmed or unconfirmed.</p>",
        "id": 153915613,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1508835901
    },
    {
        "content": "<p>well, I think that's a good task to create - seems like a very common situation. Either verification status should be 0..1 or it should contain unknown</p>",
        "id": 153915615,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508835979
    },
    {
        "content": "<p>As <span class=\"user-mention\" data-user-id=\"191403\">@Michelle (Moseman) Miller</span> points out (earlier in this thread), the problem has been recognised.  <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\">GF#13997</a> will relax the cardinality of verificationStatus to 0..1 in the next FHIR release. I'm after an interim fix for an unknown verificationStatus we can all follow.</p>",
        "id": 153915619,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1508836309
    },
    {
        "content": "<p>Michelle did mention that <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13997\">GF#13997</a> will relax the cardinality of AllergyIntolerance.verificationStatus to 0..1 in R4 (and I hadn’t seen Dave’s last post before I posted mine!).</p>",
        "id": 153915620,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1508836329
    },
    {
        "content": "<p>interim fix:<br>\n  &lt;verificationStatus&gt;<br>\n   &lt;extension url=\"<a href=\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\">http://hl7.org/fhir/StructureDefinition/data-absent-reason</a>\"&gt;<br>\n    &lt;valueCode value=\"unknown\"/&gt;<br>\n   &lt;/extension&gt;<br>\n  &lt;/verificationStatus&gt;</p>",
        "id": 153915621,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1508836507
    },
    {
        "content": "<p>yes</p>",
        "id": 153915622,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1508836538
    },
    {
        "content": "<p>OK, I've just run this as an example against the schema, and it works, so thanks for the XML. Just to confirm that we are OK to take a mandatory element (verificationStatus), with a Required valueSet and end up without putting in a code from the Required valueSet, but a code from the extension. And this is seen as a valid thing to do in terms of FHIR.</p>",
        "id": 153915623,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1508838007
    }
]