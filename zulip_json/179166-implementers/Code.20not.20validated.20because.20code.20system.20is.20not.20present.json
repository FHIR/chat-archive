[
    {
        "content": "<p>Hi, I'm trying to do validation of a Condition-resource. I'm using HAPI 4.0.3 with R4 resources. <br>\nIf I send in the clinicalStatus below as part of a Condition I want the validator to output an error that the code system is not part of the required value set. But instead I get a warning with the following message: \"Code <a href=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong/asd\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong/asd\">http://terminology.hl7.org/CodeSystem/condition-clinical/wrong/asd</a> was not validated because the code system is not present\". Is it possible to get the validator to output an error instead?</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;clinicalStatus&gt;\n        &lt;coding&gt;\n            &lt;system value=&quot;http://terminology.hl7.org/CodeSystem/condition-clinical/wrong&quot;&gt;&lt;/system&gt;\n            &lt;code value=&quot;asd&quot;&gt;&lt;/code&gt;\n            &lt;display value=&quot;Active&quot;&gt;&lt;/display&gt;\n        &lt;/coding&gt;\n    &lt;/clinicalStatus&gt;\n</pre></div>\n\n\n<p>If I send in the correct code system but with an invalid code it works as I would expect by outputting an error with the following message: \"None of the codes provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0\">http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0</a> (<a href=\"http://hl7.org/fhir/ValueSet/condition-clinical\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/condition-clinical\">http://hl7.org/fhir/ValueSet/condition-clinical</a>, and a code from this value set is required) (codes = <a href=\"http://terminology.hl7.org/CodeSystem/condition-clinical#asd\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/condition-clinical#asd\">http://terminology.hl7.org/CodeSystem/condition-clinical#asd</a>)\"</p>",
        "id": 179436163,
        "sender_full_name": "Andreas",
        "timestamp": 1572445105
    },
    {
        "content": "<p>It suggests that your validator isn't connecting to the terminology server for some reason (or that the terminology server it is connecting to doesn't have access to the code system(s) pointed to by the value set).</p>",
        "id": 179448399,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572451656
    },
    {
        "content": "<p>The validator does have access to the coding system referenced in the value set. The problem is that if someone sends in another coding system, the validator does not reject this. Which means that users can send in whatever coding system they want.</p>",
        "id": 179516226,
        "sender_full_name": "Andreas",
        "timestamp": 1572516110
    },
    {
        "content": "<p>can you make it a test case please</p>",
        "id": 179516355,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572516211
    },
    {
        "content": "<p>If I try to validate the following Condition: <a href=\"https://pastebin.com/93GErvcU\" target=\"_blank\" title=\"https://pastebin.com/93GErvcU\">https://pastebin.com/93GErvcU</a> at <a href=\"https://fhirtest.uhn.ca/\" target=\"_blank\" title=\"https://fhirtest.uhn.ca/\">https://fhirtest.uhn.ca/</a>  it returns a warning: \"Code <a href=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system/notrealcode\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system/notrealcode\">http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system/notrealcode</a> was not validated because the code system is not present\".<br>\nBut if I change the system of ClinicalStatus to be \"<a href=\"http://terminology.hl7.org/CodeSystem/condition-clinical\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/condition-clinical\">http://terminology.hl7.org/CodeSystem/condition-clinical</a>\" (the system in the value set) I get an error that the code is not in the value set.</p>",
        "id": 179517658,
        "sender_full_name": "Andreas",
        "timestamp": 1572517192
    },
    {
        "content": "<p>does it behave the same way with the java command line validator? (not that you can test today, it's current broken)</p>",
        "id": 179521398,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572520495
    },
    {
        "content": "<p>This looks like an issue with HAPI's TS as opposed to being a validator issue. That message comes from the TS for sure.</p>\n<p><code>Condition.clinicalStatus</code> has a required binding so a non-validatable code should be an error, not an info. I'll turn this into a test case.</p>",
        "id": 179521858,
        "sender_full_name": "James Agnew",
        "timestamp": 1572520910
    },
    {
        "content": "<p>Using the java command line validator (v 4.0.24-SNAPSHOT), I get an error with the condition in the pastebin: </p>\n<blockquote>\n<p>Error @ Condition.clinicalStatus (line 6, col19) : None of the codes provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0\">http://hl7.org/fhir/ValueSet/condition-clinical|4.0.0</a> (<a href=\"http://hl7.org/fhir/ValueSet/condition-clinical\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/condition-clinical\">http://hl7.org/fhir/ValueSet/condition-clinical</a>, and a code from this value set is required) (codes = <a href=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system#notrealquote\" target=\"_blank\" title=\"http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system#notrealquote\">http://terminology.hl7.org/CodeSystem/condition-clinical/wrong-system#notrealquote</a></p>\n</blockquote>\n<p>So that seems correct.</p>",
        "id": 179527977,
        "sender_full_name": "Andreas",
        "timestamp": 1572526455
    }
]