[
    {
        "content": "<p>Looking at <a href=\"http://hl7.org/fhir/visionprescription.profile.xml.html\" target=\"_blank\" title=\"http://hl7.org/fhir/visionprescription.profile.xml.html\">http://hl7.org/fhir/visionprescription.profile.xml.html</a>:<br>\n.<br>\nToday for DSTU2 it has canonical URL \"<a href=\"http://hl7.org/fhir/StructureDefinition/VisionPrescription\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/VisionPrescription\">http://hl7.org/fhir/StructureDefinition/VisionPrescription</a>\" and base \"<a href=\"http://hl7.org/fhir/StructureDefinition/DomainResource\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/DomainResource\">http://hl7.org/fhir/StructureDefinition/DomainResource</a>\"<br>\n.<br>\nThis doesn't tell me anything about what version of FHIR we are dealing with. I could look at .fhirVersion (\"1.9.0\"), but my resolving is hard that way.<br>\n.<br>\nWould it make sense to assume a strategy where canonicals and baseDefinition include the right permalink? E.g.<br>\n.<br>\n&lt;url value=\"http://hl7.org/fhir/DSTU2/StructureDefinition/VisionPrescription\"/&gt;<br>\n&lt;baseDefinition value=\"http://hl7.org/fhir/DSTU2/StructureDefinition/DomainResource\"/&gt;<br>\n.<br>\nThe same logic would apply to extensions. This way in 2/3 weeks time when STU3 is done I could get a distinct new version of the profile.</p>",
        "id": 153877786,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1489757260
    },
    {
        "content": "<p>STU3 is a few days away</p>",
        "id": 153877796,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489757712
    },
    {
        "content": "<p>not a few weeks</p>",
        "id": 153877797,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489757727
    },
    {
        "content": "<p>Ok. Doesn't change the question though. Even if it's not going to change what comes out of STU3. We could still look into what to do for STU3 Patch 1 or R4. I have a feeling there's something to solve here, but I'm currently just checking if my hunch is right.<br>\n.<br>\nFor reference: this question came from a rather lengthy/ferocious discussion over at the Netherlands stream. We have a 'big' number of DSTU2 profiles that we will need to convert to STU3 and we are wondering what to do with the canonicals and extension URLs in that conversion.<br>\n.<br>\nI cannot leave them as is and publish the new versions on Simplifier. I'm afraid it would be a disaster to distinguish what's what. I'm not sure whether to update them when I see that the FHIR Core materials don't. But I mostly wonder whether it is correct that the FHIR Core doesn't update them and how the resolving of artifacts works then.<br>\n.<br>\nHence the question.</p>",
        "id": 153877817,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1489762352
    },
    {
        "content": "<p>I don't know what the answer is. I agree that there's a problem to think about. If you look at the R2 structure definitions included in R3, they have the urls you are talking about - I made that change. But doing that broken so many things - both practically and conceptually</p>",
        "id": 153877857,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489779259
    },
    {
        "content": "<p>I'm not sure how to spot R2 profiles in between R3, but I'll take your word for it. If there indeed is a problem then I'm sure for example <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  must have run into that when he built the R2 &gt; R3 conversion, or <span class=\"user-mention\" data-user-id=\"191370\">@Richard Ettema</span>  must have seen it when he gathers stuff for validation. That's the practical side. What would you say is a/the conceptual problem?<br>\n.<br>\nI remember a discussion on ValueSet.url for expansions where we landed on the ValueSet.url being a logical identifier rather than an instance type identifier, so that meant that ValueSet.url for intention and expansion can in fact be the same because the logical intention is the same. Supposedly you could look at StructureDefinition.url the same way. <br>\n.<br>\nI'm not sure about <a href=\"http://StructureDefinition.id\" target=\"_blank\" title=\"http://StructureDefinition.id\">StructureDefinition.id</a> and .baseDefinition. If the .id and .baseDefinition point to objects that can change structure overnight (R2 &gt; R3) then I'm not sure what breaks when overnight happens. Same with extension.url. If my instance claims conformance to a profile on R3, I'd expect every extension to be R3 too. But a given extension may not be part of the (open) R3 profile and only exist in R2 space. Can I reject instances based on mixed versions of definitions?<br>\n.<br>\nSeems to me that after R3 is out we will get real world feedback on this. Versioning has been V3s weakest point with every Normative Edition being compatible with itself, so I'd love to help avoiding that in FHIR.</p>",
        "id": 153877956,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1489821884
    },
    {
        "content": "<p>I wrote the R2 &lt;--&gt; R3 conversion, so it's me that had the issue. Somewhere, I hack(ed) the URLs. can't remember whether it's as I load, or manually now</p>",
        "id": 153877980,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489835493
    },
    {
        "content": "<p>what I've learnt about versioning is that choices I make seem real clear to me, but they aren't clear to everyone else. And they won't remain clear to me either. and everyone is the in the same boat.</p>",
        "id": 153877982,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489835650
    },
    {
        "content": "<p>so I think that we should gather feedback and see</p>",
        "id": 153877983,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489835671
    },
    {
        "content": "<p>I do it while loading the R2 definitions into R3: </p>\n<div class=\"codehilite\"><pre>    if (patchUrls) {\n      for (BundleEntryComponent be : b.getEntry()) {\n        if (be.hasResource() &amp;&amp; be.getResource() instanceof StructureDefinition) {\n          StructureDefinition sd = (StructureDefinition) be.getResource();\n          sd.setUrl(sd.getUrl().replace(&quot;http://hl7.org/fhir/&quot;, &quot;http://hl7.org/fhir/DSTU2/&quot;));\n          sd.addExtension().setUrl(&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-namespace&quot;).setValue(new UriType(&quot;http://hl7.org/fhir&quot;));\n        }\n      }\n    }\n</pre></div>",
        "id": 153877984,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489835737
    },
    {
        "content": "<p>Right, so there is some hacking involved for resolving. I'll leave you to finalizing R3 as I'm sure you'll need your time. Let's revisit this with wider implementer input. If that input doesn't come, then it may not be a big enough issue.</p>",
        "id": 153877986,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1489835968
    },
    {
        "content": "<p>For Simplifier we will definetely run into issues here.  Since we currently have uploaded the DSTU2 definitions. When the R3 definitions have the same canonical URL (which they currently have), we will have to do some hacking to make multiversioning happen. It would have our preference that the canonical URL of the resource will change with its FHIR version (since there are a lot of breaking changes).</p>",
        "id": 153878561,
        "sender_full_name": "Marten Smits",
        "timestamp": 1490011943
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  I know this is really late, however would it be an idea to change the base from <code>http://hl7.org/fhir/</code> to   <code>http://hl7.org/fhir/STU3/</code>in the url of the resource definitions, as you did with DSTU2 above?</p>",
        "id": 153878562,
        "sender_full_name": "Marten Smits",
        "timestamp": 1490012374
    },
    {
        "content": "<p>There are several pieces on the internet advocating versioning by media type instead of url. Something like: application/fhir+json.stu3 and application/fhir+json.dstu2 would retrieve the appropriate resources from the canonical url. And application/fhir+json would get either the first or the last. See for instance <a href=\"https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/\" target=\"_blank\" title=\"https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/\">https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/</a> or others. Not sure whether I like this approach, but it is a option to keep url's stable while still having versioning. The main idea is 'the url's identify the resources, not the version of the resources\" - which in itself is a reasonable idea.</p>\n<p>Oops, same link I posted was already in another thread yesterday which I didn't follow well enough, apologies.</p>",
        "id": 153878584,
        "sender_full_name": "Marc de Graauw",
        "timestamp": 1490019118
    },
    {
        "content": "<p>-1 on changing the cannonical URL.   I'm not a huge fan of changing the URL either.  Once we're in normative, neither should matter and it would be good to have implementers get used to that and rely on context (what endpoint is hit, etc.) to differentiate until then.  We should however be changing the business version.  Cannonical URL + business version should get you to an official release.</p>",
        "id": 153878589,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490021227
    }
]