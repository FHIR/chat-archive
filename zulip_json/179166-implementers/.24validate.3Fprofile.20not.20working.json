[
    {
        "content": "<p>Hi, <br>\nthe following documentation says, that I am supposed to be able to validate my resource against a specific profile by using the operation <code>$validate?profile=[profile url]</code>:<br>\n<a href=\"https://www.hl7.org/fhir/validation.html#op\" target=\"_blank\" title=\"https://www.hl7.org/fhir/validation.html#op\">https://www.hl7.org/fhir/validation.html#op</a></p>\n<p>For testing purposes, I posted a custom StructureDefinition (containing a snapshot) to the baseR4 repository at:<br>\n<a href=\"http://hapi.fhir.org/baseR4/StructureDefinition/592726\" target=\"_blank\" title=\"http://hapi.fhir.org/baseR4/StructureDefinition/592726\">http://hapi.fhir.org/baseR4/StructureDefinition/592726</a><br>\nThis StructureDefinition for DocumentReference basically contains a few Extensions and makes attributes like language, identifier and type required.<br>\nTo my surprise the following POST-Request does not yield any errors. </p>\n<div class=\"codehilite\"><pre><span></span>curl --location --request POST &#39;http://hapi.fhir.org/baseR4/StructureDefinition/$validate?profile=http://gev.de/fhir/StructureDefinition/RepoDocumentReference&#39; \\\n--header &#39;Content-Type: application/json&#39; \\\n--data-raw &#39;{\n    &quot;resourceType&quot;: &quot;DocumentReference&quot;,\n    &quot;status&quot;: &quot;current&quot;,\n    &quot;content&quot;: [\n        {\n            &quot;attachment&quot;: {\n                &quot;contentType&quot;: &quot;text/plain&quot;,\n                &quot;data&quot;: &quot;PDQ+&quot;\n            }\n        }\n    ]\n}&#39;\n</pre></div>\n\n\n<p>It seems like the posted resource is being validated against the default profile instead of the desired one.<br>\nOnly by adding the <code>meta.profile</code> attribute to the resource and removing <code>?profile=http://gev.de/fhir/StructureDefinition/RepoDocumentReference</code> from the request, the repository validates against the desired profile.</p>\n<div class=\"codehilite\"><pre><span></span>curl --location --request POST &#39;http://hapi.fhir.org/baseR4/StructureDefinition/$validate&#39; \\\n--header &#39;Content-Type: application/json&#39; \\\n--data-raw &#39;{\n    &quot;resourceType&quot;: &quot;DocumentReference&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: &quot;http://gev.de/fhir/StructureDefinition/RepoDocumentReference&quot;\n    },\n    &quot;status&quot;: &quot;current&quot;,\n    &quot;content&quot;: [\n        {\n            &quot;attachment&quot;: {\n                &quot;contentType&quot;: &quot;text/plain&quot;,\n                &quot;data&quot;: &quot;PDQ+&quot;\n            }\n        }\n    ]\n}&#39;\n</pre></div>\n\n\n<p>Is this a malfunction of the hapi reference implementation, or just bad documentation?</p>",
        "id": 186700716,
        "sender_full_name": "Sergej Reiser",
        "timestamp": 1580143810
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span></p>",
        "id": 186701151,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1580144053
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> this looks like a bug in a core validator that I fixed a few weeks ago</p>",
        "id": 186733112,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580164158
    },
    {
        "content": "<p>Same here !</p>\n<p>I've tried to validate a resource creation with <code>$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core</code> and was totally unable to make a validation working</p>\n<p>On most of the example's servers I've found, I've a \"Ok\" answer ; and on others, I've a \"Unable to resolve reference to profile '<a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core\" target=\"_blank\" title=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core\">http://hl7.org/fhir/us/core/StructureDefinition/us-core</a>'\".</p>\n<p>Is the fix deployed on an example server ? Is there something I don't understand ?</p>",
        "id": 188006194,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581511389
    },
    {
        "content": "<p>StructureDefinition/us-core isn't a valid profile id - you'd need to point to a specific us-core profile id</p>",
        "id": 188018135,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581520182
    },
    {
        "content": "<p>Sorry, bad cc : <code>http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code></p>",
        "id": 188018214,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581520223
    },
    {
        "content": "<p>Are you using a server like <a href=\"http://test.fhir.org\" target=\"_blank\" title=\"http://test.fhir.org\">test.fhir.org</a> that has awareness of the US-core profiles?</p>",
        "id": 188018523,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1581520435
    },
    {
        "content": "<p>I've successfully done a validation on grahame r3 server (the r4 seems buggy) with following request :</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [&quot;http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient&quot;]\n    },\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;Demo patient&lt;/div&gt;&quot;\n    },\n    &quot;name&quot;: [\n        {\n            &quot;family&quot;: &quot;Doe&quot;\n        }\n    ],\n    &quot;gender&quot;: &quot;male&quot;\n}\n</pre></div>\n\n\n<p>But still not working with <code>{{uri}}/Patient/$validate?profile=http://hl7.org/fhir/us/core/StructureDefinition/us-core-patient</code> which give me :</p>\n<div class=\"codehilite\"><pre><span></span>            &quot;details&quot;: {\n                &quot;text&quot;: &quot;ValueSet http://hl7.org/fhir/ValueSet/narrative-status not found&quot;\n            },\n            &quot;expression&quot;: [\n                &quot;Patient.text.status // line 4 col 7)&quot;\n            ]\n</pre></div>",
        "id": 188019340,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581520974
    },
    {
        "content": "<p>For Vonk, you'll have to make the Administration endpoint aware of the profile, see <a href=\"http://docs.simplifier.net/vonk/administration_api.html\" target=\"_blank\" title=\"http://docs.simplifier.net/vonk/administration_api.html\">http://docs.simplifier.net/vonk/administration_api.html</a></p>",
        "id": 188021631,
        "sender_full_name": "Ren√© Spronk",
        "timestamp": 1581522316
    },
    {
        "content": "<p>Ok, so, in the idea, when you validate using the $validate operation against a server, it's only with the profiles \"available\" for this server ?<br>\nI understand better now</p>",
        "id": 188022158,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581522655
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"250480\">@Florian Briand</span>, I created an set of Postman requests to show how this could work, including posting the FHIR Profile to the administration endpoint of the FHIR server (Vonk in this case) and then validating a profile against it in multiple ways: <a href=\"http://community.fhir.org/t/how-to-make-resource-json-with-new-profile/1777/5\" target=\"_blank\" title=\"http://community.fhir.org/t/how-to-make-resource-json-with-new-profile/1777/5\">http://community.fhir.org/t/how-to-make-resource-json-with-new-profile/1777/5</a></p>",
        "id": 188023649,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1581523368
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span>  Hehe, thanks ;) I've builder almost the same collection, doing the same choices as yours, but I didn't thought to add the SD by myself, it's an idea !</p>",
        "id": 188025516,
        "sender_full_name": "Florian Briand",
        "timestamp": 1581524265
    }
]