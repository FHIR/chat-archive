[
    {
        "content": "<p>I am working on a profile and creating example resources along with it. I was hoping to use the current validator JAR to validate those examples against my local <code>StructureDefinition</code> XML file for the profile. However, despite investing a good deal of time, I have not gotten it to work yet - when passing a path to a file to <code>-profile</code>, I  get errors saying either that it did not complete loading the StructureDefinition or that the StructureDefinition reference could not be resolved.</p>\n<p>The documentation I found seems not quite clear on whether validating against a file even possible. In the <em>readme.txt</em> file that comes along with the validator .zip file, the call syntax def seems to leave out the profile parameter</p>\n<blockquote>\n<p>Usage: java -jar org.hl7.fhir.validator.jar [source] (-defn [definitions]) (-output [output]) where: </p>\n</blockquote>\n<p>but a few lines down such a parameter (allowing filenames) is documented: </p>\n<blockquote>\n<ul>\n<li>[profile] is an optional filename or URL for a specific profile to validate a resource<br>\n    against. In the absence of this parameter, the resource will be checked against the <br>\n    base specification using the definitions.</li>\n</ul>\n</blockquote>\n<p>On the other hand, running</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar help\n</pre></div>\n\n\n<p>outputs documentation stating the the profile parameter must be a URL (and so presumably cannot handle a local file?)</p>\n<blockquote>\n<p>-profile [url]: a canonical URL to validate against (same as if it was specified in Resource.meta.profile)</p>\n</blockquote>\n<p>Any input on how one can validate against a local profile file (if possible) would be great.</p>",
        "id": 153929616,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1516370486
    },
    {
        "content": "<p>The validator expects to load any relevant profiles from an IG Pack.  The \"-profile\" parameter allows you to assert that \"the instance I'm about to validate should be validated against profile xyz even if it hasn't declared that profile\".  It's not intended to reference a file that contains the desired profiles.</p>",
        "id": 153929633,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1516377561
    },
    {
        "content": "<p>-profile is the url to validate against. The url must be loaded somehow - the validator will load from the  url directly, but before doing that, it looks through the cache of loaded files. You can specify the structure definition using -ig - you don't have to specify an OG pack</p>",
        "id": 153929764,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1516425776
    },
    {
        "content": "<p>Thanks for the clarification, I'll give -ig a try.</p>",
        "id": 153929916,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1516614015
    },
    {
        "content": "<blockquote>\n<p>Thanks for the clarification, I'll give -ig a try.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span> , did you manage to successfully use the validator to validate against a local profile? Can you share an example?</p>\n<p>Thanks in advance.</p>",
        "id": 153936914,
        "sender_full_name": "Joel Francis",
        "timestamp": 1518447186
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"193795\">@Joel Francis</span> Yes, I did get it to work. Here is what works for me (based on my current understanding &amp; open to corrections):</p>\n<p>Suppose you want to validate a <code>Patient</code> resource in the file <em>examplesdir/patient_xyz.xml</em> . You want to validate it against a profile that is stored in the folder <em>profiles/</em>  and has URL <em>http://hl7.org/fhir/StructureDefinition/xyz_profile</em> (i.e. the corresponding <code>StructureDefinition</code> resource file is in that folder and its<code>url</code> field contains that URL). Then you can run</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar -defn http://hl7.org/fhir -ig profiles/ -profile http://hl7.org/fhir/StructureDefinition/xyz_profile examplesdir/patient_xyz.xml\n</pre></div>\n\n\n<p>The <code>-ig</code> option ensures that the validator preloads the profiles in the <em>profiles/</em> folder so that it recognizes the corresponding URLs. I explicitly used the <code>-defn</code> option to point to the STU3 defs. since the validator otherwise (judging from the output) seems to take the base resource definitions from <em>http://build.fhir.org</em> (current build).</p>\n<p>If the profile to validate against is explicitly declared in the <code>meta.profile</code> field of the resource itself, you can leave out the <code>-profile</code> option. You can also pass a whole folder of examples to validate instead of just a single file (e.g. passing <em>examplesdir/</em>* instead of <em>examplesdir/patient_xyz.xml</em>), though then the profiles of course have to be declared in the <code>meta.profile</code> fields of resources (unless they are all the same).</p>\n<p>Hope that works for you, too!</p>",
        "id": 153936973,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1518469231
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span> , Thank you very much for the clarity in your example. I will try this out.</p>",
        "id": 153937106,
        "sender_full_name": "Joel Francis",
        "timestamp": 1518530223
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span>  following your example and keeping the folder structure you mentioned just to minimize the differences, I get the attached error. Any thoughts?<br>\n<a href=\"/user_uploads/10155/swtrWogqbQAaVI8Kro7VDIVh/validation_error.png\" target=\"_blank\" title=\"validation_error.png\">validation_error.png</a> <a href=\"/user_uploads/10155/sWt-XnHHMp525t7xnkjCz10H/folder.png\" target=\"_blank\" title=\"folder.png\">folder.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/swtrWogqbQAaVI8Kro7VDIVh/validation_error.png\" target=\"_blank\" title=\"validation_error.png\"><img src=\"/user_uploads/10155/swtrWogqbQAaVI8Kro7VDIVh/validation_error.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/sWt-XnHHMp525t7xnkjCz10H/folder.png\" target=\"_blank\" title=\"folder.png\"><img src=\"/user_uploads/10155/sWt-XnHHMp525t7xnkjCz10H/folder.png\"></a></div>",
        "id": 153937471,
        "sender_full_name": "Joel Francis",
        "timestamp": 1518636822
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193795\">@Joel Francis</span> Hm, I never came across an error like that. Based on the <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/b61887e84133524009a3f64bc35a021d8732353e/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1568\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/blob/b61887e84133524009a3f64bc35a021d8732353e/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1568\">source code in the HAPI FHIR GitHub repo that throws it</a> (assuming it is HAPI FHIR), it looks like the validator is missing the component that retrieves referenced entities. I don't know the code well enough to say whether this is an internal issue or if it comes from the example/profile . My only hunch would be checking that the references in the example are valid.  Maybe stripping off the <code>-profile</code> parameter to first validate against the base profile could also help pinpoint the source (profile vs. example)?</p>",
        "id": 153938138,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1518770378
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-id=\"193795\">@Joel Francis</span> Hm, I never came across an error like that. Based on the <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/b61887e84133524009a3f64bc35a021d8732353e/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1568\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/blob/b61887e84133524009a3f64bc35a021d8732353e/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1568\">source code in the HAPI FHIR GitHub repo that throws it</a> (assuming it is HAPI FHIR), it looks like the validator is missing the component that retrieves referenced entities. I don't know the code well enough to say whether this is an internal issue or if it comes from the example/profile . My only hunch would be checking that the references in the example are valid.  Maybe stripping off the <code>-profile</code> parameter to first validate against the base profile could also help pinpoint the source (profile vs. example)?</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span> . I will try your suggestions.</p>",
        "id": 153938962,
        "sender_full_name": "Joel Francis",
        "timestamp": 1519138728
    }
]