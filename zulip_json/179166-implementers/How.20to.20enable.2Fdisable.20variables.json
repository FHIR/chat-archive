[
    {
        "content": "<p>There is a switch to enable or disable certain variables from our study view. For example if there is variables for PEF, FEV1 and FEV6 and user disables PEF it's not calculated and shown on the study view. I would like to store information about this selection somehow. Information is stored but not used in analysis. All the variables gets stored anyway but I would like to effect what is used in analysis and what's not. This is needed when information is imported back to analysis software. All variable values are stored in the different observation resources. Is there some FHIR way to do this?</p>",
        "id": 154409802,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546609604
    },
    {
        "content": "<p>I guess the first question is how you would talk about what variables you're expecting to collect in general (irrespective of whether you'll include them in analysis or for display in a particular view).  Typically we point to PlanDefinition for that - that's the way we define protocols in FHIR.  Expectations around analysis would also be included in the protocol as one of the steps involved.  The notion of what to display/not to display would probably be handled as an extension</p>",
        "id": 154413025,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546613206
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196057\">@Lauri Karppinen</span> what are you actually storing as the analysis? Of course you store all the observations (independently), but in addition I imagine you could store a DiagnosticReport or another type of resource that stores the information (as references) on which observations were used in the analysis, as well as the outcome of that analysis.</p>",
        "id": 154413430,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1546613610
    },
    {
        "content": "<p>Thanks for the answers.</p>\n<p><span class=\"user-mention\" data-user-id=\"192917\">@Mikael Rinnetmäki</span> I don't actually have to save the analysis. They are calculated from the observations when they are read back. Such as average values pre and post etc... I just need to store the information about UI in software (PEF enabled/disabled, FEV1 enabled/disabled etc...). </p>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> extension with valueBoolean could be something what it could be done. Can I put extensions inside component? I need to give information somehow what variable is concealed/hidden from ui and calculations. This is something I came up with:<br>\n<code>\"component\": [\n    {\n        \"code\": {\n            \"coding\": [\n                {\n                    \"code\": \"LP115839-5\",\n                    \"display\": \"Peak expiratory flow\",\n                    \"system\": \"http://loinc.org\"\n                },\n                {\n                    \"code\": \"263721004\",\n                    \"display\": \"Concealed (qualifier value)\",\n                    \"system\": \"http://snomed.info/sct\"\n                }\n            ],\n                \"extension\": [\n                    {\n                        \"url\": \"http://phr.kanta.fi/StructureDefinition/fiphr-boolean\",\n                        \"valueBoolean\": \"true\"\n                    }\n                ]\n        }\n    },\n    {\n        \"code\": {\n            \"coding\": [\n                {\n                    \"code\": \"20150-9\",\n                    \"display\": \"FEV1\",\n                    \"system\": \"http://loinc.org\"\n                },\n                {\n                    \"code\": \"263721004\",\n                    \"display\": \"Concealed (qualifier value)\",\n                    \"system\": \"http://snomed.info/sct\"\n                }\n            ],\n                \"extension\": [\n                    {\n                        \"url\": \"http://phr.kanta.fi/StructureDefinition/fiphr-boolean\",\n                        \"valueBoolean\": \"true\"\n                    }\n                ]\n        }\n    },\n    {\n        \"code\": {\n            \"coding\": [\n                {\n                    \"code\": \"65655-3\",\n                    \"display\": \"FEV6\",\n                    \"system\": \"http://loinc.org\"\n                },\n                {\n                    \"code\": \"263721004\",\n                    \"display\": \"Concealed (qualifier value)\",\n                    \"system\": \"http://snomed.info/sct\"\n                }\n            ],\n                \"extension\": [\n                    {\n                        \"url\": \"http://phr.kanta.fi/StructureDefinition/fiphr-boolean\",\n                        \"valueBoolean\": \"true\"\n                    }\n                ]\n        }\n    },\n    {\n        \"code\": {\n            \"coding\": [\n                {\n                    \"code\": \"702534005\",\n                    \"display\": \"Forced expiratory volume in one second/Forced expiratory volume in six seconds ratio\",\n                    \"system\": \"http://snomed.info/sct\"\n                },\n                {\n                    \"code\": \"263721004\",\n                    \"display\": \"Concealed (qualifier value)\",\n                    \"system\": \"http://snomed.info/sct\"\n                }\n            ],\n                \"extension\": [\n                    {\n                        \"url\": \"http://phr.kanta.fi/StructureDefinition/fiphr-boolean\",\n                        \"valueBoolean\": \"true\"\n                    }\n                ]\n        }\n    }\n]</code></p>\n<p>I noticed that component.valueBoolean was added to v4. I even tested it and it worked great. I still don't want to add it just yet because development has been with v3 so we are going to stick with it and and add support to v4 later...<br>\nEdit: <br>\nThis seems to work in <a href=\"http://hapi.fhir.org/baseDstu3/Observation\" target=\"_blank\" title=\"http://hapi.fhir.org/baseDstu3/Observation\">http://hapi.fhir.org/baseDstu3/Observation</a> where I have been testing my implementations. Can someone confirm or give comment does this seem the right way to do this? Thanks! :)</p>",
        "id": 154551217,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546845364
    },
    {
        "content": "<p>Are you wanting to set the flag in every single Observation?  Would that not typically be done at the protocol level rather than for every single result?</p>",
        "id": 154553147,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546848631
    },
    {
        "content": "<blockquote>\n<p>Are you wanting to set the flag in every single Observation?  Would that not typically be done at the protocol level rather than for every single result?</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\n There are several PEF measurements and several FEV1 measurements and so on. This selection enables/disables each. I'm considering writing my example to spirometry study observation which \"collects\" all of these in one study.</p>",
        "id": 154553286,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546848906
    },
    {
        "content": "<p>So the intention is that for each measurement collected for each patient you'd go in and flag which ones should be considered vs. not?</p>",
        "id": 154553864,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546849990
    },
    {
        "content": "<blockquote>\n<p>So the intention is that for each measurement collected for each patient you'd go in and flag which ones should be considered vs. not?</p>\n</blockquote>\n<p>At the moment our FHIR import/export has this kind of chain of observations: study-&gt;protocol(screening/serial monitoring)-&gt;phase(pre/post)-&gt;measurementMode-&gt;breath/topbreaths-&gt;variable/flow. So where I was planning to write this is on the very top of the \"observation tree\". Does this seem completely wrong way? This must not be the most usual thing to do with FHIR... but I have to figure out some way to do this.</p>",
        "id": 154553920,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546850063
    },
    {
        "content": "<p>When you talk about \"study\" and \"protocol\", are you talking about a \"panel\" Observation instance that's used as a grouper of other observations, or are you talking about the actual study and protocol?  (Because the latter would be represented as ResearchStudy and PlanDefinition.)  Observation represents what was done, never what \"is to be done\".</p>",
        "id": 154554416,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546850919
    },
    {
        "content": "<p>I'm talking about observation that groups other observations together.</p>",
        "id": 154555003,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546851807
    },
    {
        "content": "<p>So the decision on what data to not use is made after the results are captured, not before?</p>",
        "id": 154556037,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546853356
    },
    {
        "content": "<p>Yes after. All the data is captured and stored every time. This is just selection in UI what to show.</p>",
        "id": 154556188,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546853528
    },
    {
        "content": "<p>Ok, then yes, the extension will work - whether at the root Observation or on components, as needed.  (Though I might make the extension id a bit more intuitive :))</p>",
        "id": 154556281,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546853678
    },
    {
        "content": "<p>Thanks a lot for the answers <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> . It's great to have confirmation for plans before implementing :)</p>",
        "id": 154556990,
        "sender_full_name": "Lauri Karppinen",
        "timestamp": 1546854546
    },
    {
        "content": "<p>That's what these forums are for :)</p>",
        "id": 154574544,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1546873292
    }
]