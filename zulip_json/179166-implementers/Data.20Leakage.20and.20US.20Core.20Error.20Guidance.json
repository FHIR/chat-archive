[
    {
        "content": "<p>On our FHIR Server, when an authenticated patient (eg. John Smith) requests a FHIR resource for another patient (eg. Doug Doe), our FHIR Server returns a 404 (Not Found) error. We have been asked to return a 401 (Unauthorized) error in these situations based on language in the US Core Specification here: <a href=\"https://www.hl7.org/fhir/us/core/CapabilityStatement-us-core-server.html#behavior\">https://www.hl7.org/fhir/us/core/CapabilityStatement-us-core-server.html#behavior</a>), which explicitly states:<br>\n    ○ A server SHALL reject any unauthorized requests by returning an HTTP 401 unauthorized response code.</p>\n<p>The US Core IG section that is referenced has three statements about this: </p>\n<p>The first says “The US Core Server SHALL: 5) Return the following response classes … (Status 401/4xx): unauthorized request”. Here it clearly states that for unauthorized requests, you return a class of 401/4xx.</p>\n<p>The second says “See the General Security Considerations ( <a href=\"https://www.hl7.org/fhir/us/core/security.html\">https://www.hl7.org/fhir/us/core/security.html</a>) section for requirements and recommendations”, which references FHIR R4 specification.<br>\n        § The most relevant section that goes into the most detail is  <a href=\"http://hl7.org/fhir/R4/security.html#AccessDenied\">http://hl7.org/fhir/R4/security.html#AccessDenied</a></p>\n<p>The third is the very strange statement that then says that you should reject any unauthorized requests by returning a 401.</p>\n<p>It is the Access Denied Response Handling that we follow, because of concerns around data leakage. When you return a 401, you are telling the requester that the other resource actually exists. You can, for example, use it to discover information about another patient – whether they exist, whether they have other resources (eg. query for a lab result with HIV status). It is NEVER a good idea to let an unauthorized user know about resources. The FHIR R4 guide is explicit and recommends a 404 because it protects from data leakage. It recommends 401 only in the case where authentication failed, not authorization.</p>\n<p>Taken in its entirety, it’s our interpretation that the US Core IG mixes the use of the words “authorization” and “authentication”. When it uses the word “unauthorized”, it means to include both authentication and authorization. That is abundantly clear in the first statement. This interpretation makes sense out of the conflicting statements within the same paragraph. </p>\n<p>It is our position that returning a 401 instead of 404 reduces the security posture of ANY server in this situation (as the FHIR Security Recommendations indicate as well), and we highly discourage the use of 401 in this use case.</p>\n<p>All of that to say, <span class=\"user-mention\" data-user-id=\"191410\">@Brett Marquard</span> , <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <strong>will you be updating the US Core spec to reflect this logic around data leakage or simply point to the base FHIR Spec? </strong></p>",
        "id": 246615902,
        "sender_full_name": "Christopher Marchand",
        "timestamp": 1626798709
    },
    {
        "content": "<p>FYI:  The  primary authors of US Core are <span class=\"user-mention\" data-user-id=\"191410\">@Brett Marquard</span>  <span class=\"user-mention\" data-user-id=\"191991\">@Gay Dolin</span>  and me .   <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  and <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  provide critical support but are not the primary authors.</p>",
        "id": 246616523,
        "sender_full_name": "Eric Haas",
        "timestamp": 1626799015
    },
    {
        "content": "<p>as Security WG co-chair, and author of the section in FHIR core... I support that US-Core should NOT be so restrictive to have demanded a specific access denied policy -- <a href=\"http://hl7.org/fhir/R4/security.html#AccessDenied\">http://hl7.org/fhir/R4/security.html#AccessDenied</a><br>\nThis said... Change Requests, and community agreement, are what defines what gets published in any specific specification (e.g. US-Core IG).</p>",
        "id": 246617061,
        "sender_full_name": "John Moehrke",
        "timestamp": 1626799278
    },
    {
        "content": "<p>I agree with the section in FHIR core as a best practice; 401 unauthorized means the user could not be authenticated at all, regardless of what resource they were trying to access.</p>",
        "id": 246617919,
        "sender_full_name": "Paul Church",
        "timestamp": 1626799684
    },
    {
        "content": "<p>Looking at this, I think this 3rd bullet is covered by the first bullet that references FHIR Core and  is at least redudant and at most overly prescriptive as reflected in your concerns.  Can you log a tracker?</p>\n<p><a href=\"/user_uploads/10155/OcqPr0w_9otJlafuC9Bod8yX/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/OcqPr0w_9otJlafuC9Bod8yX/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/OcqPr0w_9otJlafuC9Bod8yX/image.png\"></a></div>",
        "id": 246618641,
        "sender_full_name": "Eric Haas",
        "timestamp": 1626800060
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-33069\">FHIR-33069</a></p>",
        "id": 246627648,
        "sender_full_name": "Eric Haas",
        "timestamp": 1626804253
    },
    {
        "content": "<p>Thanks to <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>  we were able to open this ticket: <a href=\"https://jira.hl7.org/browse/FHIR-33069\">https://jira.hl7.org/browse/FHIR-33069</a>. Please let me know how I can help further move this through the process. Thanks!</p>",
        "id": 247020062,
        "sender_full_name": "Christopher Marchand",
        "timestamp": 1627067782
    }
]