[
    {
        "content": "<p>Came across the need to describe event counts in subscriptions, and the integer value types only go to 32-bit, which will overflow in production systems.</p>\n<p>As a workaround, we are using the decimal type with guidance that only integer values should be used, but using decimal has performance implications.</p>\n<p>Thought I'd ask here for thoughts/comments/questions (unless there is somewhere more appropriate).  Thanks!</p>",
        "id": 180458162,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1573504922
    },
    {
        "content": "<p>where do we need to describe event counts in subscriptions?</p>",
        "id": 180460274,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573506760
    },
    {
        "content": "<p>There's a sequence number sent to clients so they know if they have missed anything.  Right now it is defined as both a field on <a href=\"http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html#Subscription.eventCount\" target=\"_blank\" title=\"http://build.fhir.org/branches/argonaut-subscription/subscription-definitions.html#Subscription.eventCount\">Subscription</a> (to discover current state) and an <a href=\"http://build.fhir.org/branches/argonaut-subscription/extension-subscription-event-count.html\" target=\"_blank\" title=\"http://build.fhir.org/branches/argonaut-subscription/extension-subscription-event-count.html\">extension on bundle</a> (for inclusion in notifications).</p>",
        "id": 180461191,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1573507428
    },
    {
        "content": "<p>a sequence number for each subscription? and that will roll over past 2^32?</p>",
        "id": 180461423,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573507578
    },
    {
        "content": "<p>That's feedback we've been getting, yes.</p>",
        "id": 180461577,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1573507695
    },
    {
        "content": "<p>hmm</p>",
        "id": 180464263,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573509959
    },
    {
        "content": "<p>It's only 2^31. We have had FHIR stores with more than 2^31 resources in them. If you're doing 1000 operations per second it rolls over in less than a month. It's just not a large enough number.</p>\n<p>If Subscriptions are only used at the patient level then this doesn't become a problem, but there are use cases with much broader criteria.</p>",
        "id": 180465016,
        "sender_full_name": "Paul Church",
        "timestamp": 1573510634
    },
    {
        "content": "<p>Oh I'm sure the stores roll over that fast. And the total subscription count will too. but on a specific subscription.. not so obvious.</p>",
        "id": 180465721,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573511236
    },
    {
        "content": "<p>anyway I'd rather use string than decimal, and either change the range of int of introduce a new type in R5</p>",
        "id": 180465761,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573511267
    },
    {
        "content": "<p>Created <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25208\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25208\">GF#25208</a></p>",
        "id": 180523280,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1573570130
    },
    {
        "content": "<blockquote>\n<p>anyway I'd rather use string than decimal, and either change the range of int of introduce a new type in R5</p>\n</blockquote>\n<p>Can you say more about why string? Are you thinking the new R5 \"int64\" type would also have a string representation in JSON? Because if not, we would be changing the serialization in addition to the models.</p>",
        "id": 180637627,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1573659070
    },
    {
        "content": "<p>if it's an extension you'll be changing the serialisation anyway</p>",
        "id": 180668935,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573677236
    },
    {
        "content": "<p>I figured that going with string would avoid the weirdities of decimals and variable precision, but it looks like we can at least claim that [-(2<strong>53)+1, (2</strong>53)-1] would be expected to be supported</p>",
        "id": 180669310,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573677428
    },
    {
        "content": "<p>Yeah, I wasn't imagining an extension in the interim; was imaginging <code>decimal</code> in the interim.</p>",
        "id": 181049694,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1574106752
    },
    {
        "content": "<p>it's already an extension, no?</p>",
        "id": 181049730,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574106795
    },
    {
        "content": "<p>I mean, <code>Subscription.eventCount</code> in the current build is an unsignedInt (<a href=\"http://build.fhir.org/subscription-definitions.html#Subscription.eventCount\" target=\"_blank\" title=\"http://build.fhir.org/subscription-definitions.html#Subscription.eventCount\">http://build.fhir.org/subscription-definitions.html#Subscription.eventCount</a>), and we've been talking about switching to decimal.</p>",
        "id": 181050021,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1574107015
    },
    {
        "content": "<p>(There's also a way to convey this inline with each notification, as <a href=\"https://build.fhir.org/extension-bundle-event-count-definitions.html#extension.bundle-event-count\" target=\"_blank\" title=\"https://build.fhir.org/extension-bundle-event-count-definitions.html#extension.bundle-event-count\">https://build.fhir.org/extension-bundle-event-count-definitions.html#extension.bundle-event-count</a> -- but this uses the same datatype as Subscription.eventCount.)</p>",
        "id": 181050052,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1574107046
    },
    {
        "content": "<p>ok well, I guess the serialization of the extension in bundle is going to change whatever but the json type doesn't change if you use decimal</p>",
        "id": 181050126,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574107090
    },
    {
        "content": "<p>I don't know if any json implementations have problems with lossy precision for high values of decimals</p>",
        "id": 181050162,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574107121
    },
    {
        "content": "<p>The default NSJSONSerialization library on iOS / macOS has problems with those because it uses doubles internally.</p>",
        "id": 181055874,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1574111189
    },
    {
        "content": "<p>also why no LongType in fhir base types ? Using decimal is a poor workaround</p>",
        "id": 181711964,
        "sender_full_name": "natus",
        "timestamp": 1574508442
    },
    {
        "content": "<p>No one had identified a use case. But here we have one, so we’re talking about it. But JSON doesn’t have it...</p>",
        "id": 181715662,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574515216
    },
    {
        "content": "<p>With JSON, the community used to store \"real life decimals\" as string, because in most of the case, the loss dues to binary numeric precision is not acceptable.</p>\n<p>The problem is well explained on this stackoverflow thread : <a href=\"https://stackoverflow.com/questions/35709595/why-would-you-use-a-string-in-json-to-represent-a-decimal-number\" target=\"_blank\" title=\"https://stackoverflow.com/questions/35709595/why-would-you-use-a-string-in-json-to-represent-a-decimal-number\">https://stackoverflow.com/questions/35709595/why-would-you-use-a-string-in-json-to-represent-a-decimal-number</a></p>",
        "id": 181838290,
        "sender_full_name": "Florian Briand",
        "timestamp": 1574699315
    }
]