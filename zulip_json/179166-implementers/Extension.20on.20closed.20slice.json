[
    {
        "content": "<p>Hey,<br>\na beginner question:<br>\nI have a profile which is derived from a profile in which the identifer is sliced an closed:<br>\nbaseprofile:<br>\n        &lt;element id=\"Patient.identifier\"&gt;<br>\n            &lt;path value=\"Patient.identifier\" /&gt;<br>\n            &lt;slicing&gt;<br>\n                &lt;discriminator&gt;<br>\n                    &lt;type value=\"value\" /&gt;<br>\n                    &lt;path value=\"type.coding.code\" /&gt;<br>\n                &lt;/discriminator&gt;<br>\n                &lt;rules value=\"closed\" /&gt;<br>\n            &lt;/slicing&gt;<br>\n        &lt;/element&gt;</p>\n<p>I would like to add an extension to the identifier in the derived profile:</p>\n<p>&lt;element id=\"Patient.identifier\"&gt;<br>\n  &lt;path value=\"Patient.identifier\" /&gt; <br>\n  &lt;min value=\"1\" /&gt; <br>\n  &lt;max value=\"1\" /&gt; <br>\n  &lt;mustSupport value=\"true\" /&gt; <br>\n  &lt;/element&gt;</p>\n<ul>\n<li>\n<p>&lt;element id=\"Patient.identifier.extension\"&gt;<br>\n  &lt;path value=\"Patient.identifier.extension\" /&gt; </p>\n</li>\n<li>\n<p>&lt;slicing&gt;</p>\n</li>\n<li>\n<p>&lt;discriminator&gt;<br>\n  &lt;type value=\"value\" /&gt; <br>\n  &lt;path value=\"url\" /&gt; <br>\n  &lt;/discriminator&gt;<br>\n  &lt;rules value=\"closed\" /&gt; <br>\n  &lt;/slicing&gt;<br>\n  &lt;/element&gt;</p>\n</li>\n<li>\n<p>&lt;element id=\"Patient.identifier.extension:test\"&gt;<br>\n  &lt;path value=\"Patient.identifier.extension\" /&gt; <br>\n  &lt;sliceName value=\"test\" /&gt; <br>\n  &lt;max value=\"1\" /&gt; </p>\n</li>\n<li>\n<p>&lt;type&gt;<br>\n  &lt;code value=\"Extension\" /&gt; <br>\n  &lt;profile value=\"<a href=\"https://test/StructureDefinition/test\">https://test/StructureDefinition/test</a>\" /&gt; <br>\n  &lt;/type&gt;<br>\n  &lt;mustSupport value=\"true\" /&gt; <br>\n  &lt;/element&gt;</p>\n</li>\n<li>\n<p>&lt;element id=\"Patient.identifier.extension:test.value[x]\"&gt;<br>\n  &lt;path value=\"Patient.identifier.extension.value[x]\" /&gt; <br>\n  &lt;mustSupport value=\"true\" /&gt; <br>\n  &lt;/element&gt;</p>\n</li>\n<li>\n<p>&lt;element id=\"Patient.identifier.extension:test.value[x]:valueInteger\"&gt;<br>\n  &lt;path value=\"Patient.identifier.extension.value[x]\" /&gt; <br>\n  &lt;sliceName value=\"valueInteger\" /&gt; <br>\n  &lt;mustSupport value=\"true\" /&gt; <br>\n  &lt;/element&gt;</p>\n</li>\n</ul>\n<p>Is this valid? And why not? <strong>since the validator returned an error</strong></p>\n<p>thanks Mark</p>",
        "id": 231755110,
        "sender_full_name": "Mark Kleop",
        "timestamp": 1616655377
    },
    {
        "content": "<p>What error are you getting?</p>\n<p>Also, both constraining cardinality on identifier as well as closed slicing are things to be very cautious about as they tend to inhibit interoperability.  It's rare there's a good reason to stop a system from exposing whatever identifiers it has - you can always ignore the ones you don't care about.</p>",
        "id": 231797895,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616678146
    },
    {
        "content": "<p>I know this could be tricky, but this is a special use-case in which only a few identifiers are allowed. </p>\n<p>But why is it forbidden to add an extension to an closed slice? the slices are independent from the usage of extensions, in my opinion. Or not?</p>\n<p>The HL7 Validator returned (Translation from german):<br>\n This element does not fit to a known slice in profile XXX and the slicing is closed</p>",
        "id": 231840095,
        "sender_full_name": "Mark Kleop",
        "timestamp": 1616692267
    },
    {
        "content": "<p>That sounds like a validation issue with the instance, not the profile?</p>",
        "id": 231840909,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616692556
    },
    {
        "content": "<p>You may need to share the full profile and the full instance</p>",
        "id": 231840997,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616692583
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/zn55z-4ioU9dsootak9G_1QR/test.zip\">test.zip</a> <br>\nhere is a test zip:<br>\nexample is the example<br>\nfolder -ig inherits the necessary profiles<br>\nfolder basis 09.13 is necessary also</p>\n<p>Thanks</p>",
        "id": 231920115,
        "sender_full_name": "Mark Kleop",
        "timestamp": 1616739532
    },
    {
        "content": "<p>Your base profile says you're discriminating by type.coding.code and slicing is closed - but your instance doesn't declare type.coding.code.  Having an extension doesn't waive the constraints of the base profile - you still have to have a value that's valid against the base - which means declaring one of the specified type.coding.code values.</p>\n<p>As an aside, you should <em>never</em> slice only by coding.code.  Code and system go together and looking at only the code and not the system isn't safe.  (Best practice is to actually slice by 'pattern' on the whole CodeableConcept and in your pattern declare a system and a code.)</p>",
        "id": 231960648,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616764125
    },
    {
        "content": "<p>Okay the way of defining this slicing rule could be optimized, but it would be valid to set every sclice to 0..0 and rule ele-1 would be satisfied since the Extension was integrated. I couldn't understand why this is faulty and got this error? The profile prohibits the slices and the example has not any.</p>",
        "id": 232027032,
        "sender_full_name": "Mark Kleop",
        "timestamp": 1616790373
    },
    {
        "content": "<p>test2 defines closed slicing on identifier.  That means <em>every</em> identifier in the instance MUST match one of the slices defined in the test2 profile.  By constraining out all of the declared profiles, you've essentially said \"you can't have an identifier here\" because the closed slicing in the base says \"all identifiers must match one of these slices\" and the child profile says \"no identifier can match any of the slices defined in the parent\"</p>",
        "id": 232029394,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616791644
    },
    {
        "content": "<p>This is one of the reasons why closed slicing should be used with great caution - it's saying \"there can be no exceptions\" - and in healthcare, there's almost always a need for exceptions...</p>",
        "id": 232029467,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616791682
    },
    {
        "content": "<p>Okay i think i got it now... Thanks for the detailed explanation</p>",
        "id": 232066588,
        "sender_full_name": "Mark Kleop",
        "timestamp": 1616824014
    }
]