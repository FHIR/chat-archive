[
    {
        "content": "<p>I would like to process a batch on my FHIR Server will some conditional logic. The batch will contain a MedicationOrder entry, a Patient and Prescriber(Practitioner). The client will not know the logical identifiers when it submits the bundle (my FHIR creates logical ids during create) but the client will know the business identifiers for each of these resources. If my logic is to only create a Patient if they don't already exist, then what value should i put to reference the Patient to the MedicationOrder in the bundle. Should I reference using the business identifier?<br>\ne.g.           &lt;reference value=\"Patient?Identifier=1234123512341235\"/&gt;</p>",
        "id": 153825781,
        "sender_full_name": "Paul Barry",
        "timestamp": 1462771137
    },
    {
        "content": "<p>well, see the discussion for the Conditional Reference connectathon track: </p>",
        "id": 153825795,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462782614
    },
    {
        "content": "<p><a href=\"http://wiki.hl7.org/index.php?title=201605_Conditional_Reference_Connectathon_Proposal\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=201605_Conditional_Reference_Connectathon_Proposal\">http://wiki.hl7.org/index.php?title=201605_Conditional_Reference_Connectathon_Proposal</a></p>",
        "id": 153825797,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462782681
    },
    {
        "content": "<p>note that what is proposed there is a  change to the specification; having implemented it, it's far from clear to me that this is the overall correct approach to implement this. </p>",
        "id": 153825798,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462782724
    },
    {
        "content": "<p>and note that you need transaction not batch for this</p>",
        "id": 153825799,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462782736
    },
    {
        "content": "<p>Hi Paul,</p>",
        "id": 153825897,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462803437
    },
    {
        "content": "<p>please note that the conditional Reference will not create the Patient if it's missing!</p>",
        "id": 153825898,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462803460
    },
    {
        "content": "<p>In that case you should use a conditional create on the patient resource instead</p>",
        "id": 153825899,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462803483
    },
    {
        "content": "<p>...or maybe a conditional update, depending on whether you want your patient resource to update an existing resource on the server in case it already exists.<br>\nKind of like this: </p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;20160508123402&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;fullUrl</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:f9935843-19a2-4a1a-4016-7bea52de77f6&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;resource&gt;</span>\n            <span class=\"nt\">&lt;Patient&gt;</span>\n                <span class=\"nt\">&lt;meta&gt;</span>\n                    <span class=\"nt\">&lt;tag&gt;</span>\n                        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CLOVERLEAF&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/tag&gt;</span>\n                <span class=\"nt\">&lt;/meta&gt;</span>\n                <span class=\"nt\">&lt;identifier&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;usual&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;type&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/v2/0203&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MR&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/type&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://www.ghh.org/identifiers&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;presentation2&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;assigner&gt;</span>\n                        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;TCPAS&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/assigner&gt;</span>\n                <span class=\"nt\">&lt;/identifier&gt;</span>\n                <span class=\"nt\">&lt;name&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;official&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;family</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;given</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Guy&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/name&gt;</span>\n                <span class=\"nt\">&lt;telecom&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;phone&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;277543&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;home&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/telecom&gt;</span>\n                <span class=\"nt\">&lt;gender</span> <span class=\"na\">value=</span><span class=\"s\">&quot;female&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;birthDate</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1928-05-24&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;address&gt;</span>\n                    <span class=\"nt\">&lt;line</span> <span class=\"na\">value=</span><span class=\"s\">&quot;22 Stable Road&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;city</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Whitstable&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;state</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Kent&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;country</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CR5 1EL&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/address&gt;</span>\n                <span class=\"nt\">&lt;contact&gt;</span>\n                    <span class=\"nt\">&lt;relationship&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/patient-contact-relationship&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;parent&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/relationship&gt;</span>\n                    <span class=\"nt\">&lt;name&gt;</span>\n                        <span class=\"nt\">&lt;family</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;given</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Dad&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/name&gt;</span>\n                <span class=\"nt\">&lt;/contact&gt;</span>\n            <span class=\"nt\">&lt;/Patient&gt;</span>\n        <span class=\"nt\">&lt;/resource&gt;</span>\n        <span class=\"nt\">&lt;request&gt;</span>\n            <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PUT&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient?identifier=http://www.ghh.org/identifiers|presentation2&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/request&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;fullUrl</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:0aa4e89f-90dc-446a-4234-ad9caaff20e6&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;resource&gt;</span>\n            <span class=\"nt\">&lt;Encounter&gt;</span>\n                <span class=\"nt\">&lt;meta&gt;</span>\n                    <span class=\"nt\">&lt;tag&gt;</span>\n                        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CLOVERLEAF&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/tag&gt;</span>\n                <span class=\"nt\">&lt;/meta&gt;</span>\n                <span class=\"nt\">&lt;identifier&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;usual&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;type&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/v2/0203&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MR&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/type&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://general-hospital.co.uk/Identifiers&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;presentation1&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;assigner&gt;</span>\n                        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;GENHOS&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/assigner&gt;</span>\n                <span class=\"nt\">&lt;/identifier&gt;</span>\n                <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;in-progress&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;class</span> <span class=\"na\">value=</span><span class=\"s\">&quot;inpatient&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;patient&gt;</span>\n                    <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:f9935843-19a2-4a1a-4016-7bea52de77f6&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef, Guy(*24.05.1928)&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/patient&gt;</span>\n                <span class=\"nt\">&lt;period&gt;</span>\n                    <span class=\"nt\">&lt;start</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2015-05-02T09:00:00+01:00&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/period&gt;</span>\n            <span class=\"nt\">&lt;/Encounter&gt;</span>\n        <span class=\"nt\">&lt;/resource&gt;</span>\n        <span class=\"nt\">&lt;request&gt;</span>\n            <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PUT&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Encounter?identifier=http://general-hospital.co.uk/Identifiers|presentation1&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/request&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>",
        "id": 153825902,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462803643
    },
    {
        "content": "<p>Note how the uuid assigned in the fullurl of the bundle entry can be used to create references within the bundle...</p>",
        "id": 153825904,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1462803732
    },
    {
        "content": "<p>Thanks Simone,<br>\nSo just to clarify, the full URL you provided on the patient entry was just a randomly generated Guid by the client?<br>\n&lt;fullUrl value=\"urn:uuid:f9935843-19a2-4a1a-4016-7bea52de77f6\" /&gt;<br>\nYou use this uuid to link the patient to the Encounter entry?<br>\n  &lt;reference value=\"urn:uuid:f9935843-19a2-4a1a-4016-7bea52de77f6\" /&gt;<br>\nIf the patient did exist in this scenario, how would you save the Encounter entry? Would you update the Encounter patient reference to use the Logical Id of the pre-existing Patient?</p>",
        "id": 153826222,
        "sender_full_name": "Paul Barry",
        "timestamp": 1462833993
    },
    {
        "content": "<p>Thanks Grahame, I am hoping to attend the NCTS connectathon in Melbourne next week. So possibly I could show you a working implementation of this scenario on our FHIR Server?</p>",
        "id": 153826248,
        "sender_full_name": "Paul Barry",
        "timestamp": 1462840147
    },
    {
        "content": "<p>ok</p>",
        "id": 153826254,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1462841670
    }
]