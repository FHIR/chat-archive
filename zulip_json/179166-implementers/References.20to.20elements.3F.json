[
    {
        "content": "<p>I have a use case where I need to point to a specific attachment inside of a DocumentReference. I was planning to do something like:</p>\n<div class=\"codehilite\"><pre><span></span><code>&quot;extension&quot;: [{\n  &quot;url&quot;: &quot;https://examle.org/derived-from-attachment&quot;,\n  &quot;valueSomething&quot;: {} //???  &quot;DocumentReference/123#abc&quot;\n}]\n</code></pre></div>\n<p>... assuming that <code>#abc</code> is an element id for a specific attachment in <code>DocumentReference/123</code>.</p>\n<p>I was initially planning to use a <code>valueReference</code>, but I think that's invalid because I'm not pointing to a <em>resource</em> but rather an <em>element</em>. So, I'm now planning to use a <code>valueUri</code> here to point to a specific attachment.</p>\n<p>Does this make sense? Has anyone else used this approach or found something they like better?</p>",
        "id": 263323825,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638378753
    },
    {
        "content": "<p>There is an approved CR from FHIR-I that addresses this but has not been applied. This was approved 16 months ago. I have been waiting for it to be applied as I have CR for Provenance to use it.   <a href=\"https://jira.hl7.org/browse/FHIR-21284\">https://jira.hl7.org/browse/FHIR-21284</a></p>",
        "id": 263325660,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638379532
    },
    {
        "content": "<p>there is no indication in that CR on how FHIR-I expected to solve the need.</p>",
        "id": 263325730,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638379562
    },
    {
        "content": "<p>Yeah, that's not a super helpful resolution, but it's good to know about this. For my use case, I don't think I'd want an extension inside the <code>valueReference</code> of my extension...</p>",
        "id": 263325998,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638379654
    },
    {
        "content": "<p>im not sure I follow you...  is this not what you are trying to do? A Reference not just to a Resource but an element within a Resource?</p>",
        "id": 263326842,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638379982
    },
    {
        "content": "<p>your use-case does bring up a question of not just a named element, but an indexable element.</p>",
        "id": 263326964,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638380031
    },
    {
        "content": "<p>I'm just saying that the following \"feels OK\" to me in terms of usability:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Condition\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"id\"</span><span class=\"p\">:</span> <span class=\"s2\">\"789\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n    <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"https://example.org/derived-from-attachment\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"valueUri\"</span><span class=\"p\">:</span> <span class=\"s2\">\"DocumentReference#123\"</span>\n  <span class=\"p\">}]</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>... whereas the following seems (to me) like it crosses some kind of line into \"difficult territory\":</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Condition\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"id\"</span><span class=\"p\">:</span> <span class=\"s2\">\"789\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n    <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"https://example.org/derived-from-attachment\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"valueReference\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"nt\">\"reference\"</span><span class=\"p\">:</span> <span class=\"s2\">\"DocumentReference/123\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n        <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/StructureDefinition/Reference-targetElement\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"valueUri\"</span><span class=\"p\">:</span> <span class=\"s2\">\"abc\"</span>\n      <span class=\"p\">}]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 263332499,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638382246
    },
    {
        "content": "<p>well, I was hoping that your engagement would solve this for more use-cases. But if you see a general solution as combersome, than I am not sure I can convince you otherwise.</p>",
        "id": 263333652,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638382697
    },
    {
        "content": "<p>Let me noodle on this. Fundamentally I think a FHIR \"Reference\" is supposed to be a pointer  to a resource (not an arbitrary element), so the idea of using an extension to change this would at the very least be a \"modiferExtension\", which is always a bit of a red flag.</p>",
        "id": 263336601,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638383933
    },
    {
        "content": "<p>I think the intent of the use-cases I have are that it is a pointer to a Resource, with emphasis on an element(s) within that Resource. Not a pointer to ONLY the element within a Resource.   <br>\nI was also looking for something in core, something in R5. Not sure it needs to be an extension in my case. In your case, urgency might drive that an extension must be used.</p>",
        "id": 263337044,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384125
    },
    {
        "content": "<p>but, that question of what is the meaning of an element pointer is a good question</p>",
        "id": 263337140,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384169
    },
    {
        "content": "<p>seems any element pointer would have that question</p>",
        "id": 263337321,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384259
    },
    {
        "content": "<p>The use-cases for this that I am aware of:<br>\nProvenance -- where one wants to record a provenance statement of a subset of a target Resource. I provided the data in the X element. -- <a href=\"http://jira.hl7.org/browse/FHIR-23076\">FHIR-23076</a></p>",
        "id": 263337475,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384337
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191651\">@Rik Smithies</span> has commented on the FHIR-I approved CR</p>",
        "id": 263337508,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384353
    },
    {
        "content": "<p>as has <span class=\"user-mention\" data-user-id=\"191403\">@Michelle (Moseman) Miller</span> (I think)</p>",
        "id": 263337640,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638384392
    },
    {
        "content": "<p>And my use case is just: pointing to a specific Attachment.</p>",
        "id": 263338148,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638384580
    },
    {
        "content": "<p>I don't follow the use case. The intent of a document reference is that's what you reference - a wrapper around an attachment with metadata</p>",
        "id": 263340854,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638385531
    },
    {
        "content": "<p>The use  case is to point to a specific attachment (e.g., if a DocumentReference has more than one).</p>\n<p>In the general case, a DocumentReference can include a whole array of attachments (e.g., different formats of the same content), and the aim here is to be able to say things like \"This Condition was derived from bytes 300-325 of a particular attachment\". So if I have a DocRef containing a .txt and .pdf attachment with the same clinical content, I want a way to point specifically to the .txt file.</p>",
        "id": 263343505,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638386565
    },
    {
        "content": "<p>(Haven't shared a full proposal yet; I was trying to iron out this one detail of how to point to an Attachment first.)</p>",
        "id": 263343653,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638386627
    },
    {
        "content": "<p>seems like a very Provenance like use-case... :-)</p>",
        "id": 263344073,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638386775
    },
    {
        "content": "<blockquote>\n<p>I don't follow the use case. </p>\n</blockquote>\n<p>Let me know if this helps <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 263344076,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638386776
    },
    {
        "content": "<p>how do you intend to further refine to bytes 300-325?</p>",
        "id": 263344211,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638386822
    },
    {
        "content": "<p>well, it certainly seems very much what the extension is for - 'and I mean this particular element is of interest in the target resource'</p>",
        "id": 263344372,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638386878
    },
    {
        "content": "<p>but also, why are you using an extension for the reference in the first place. How is this not Condition.evidence.detail?</p>",
        "id": 263344556,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638386930
    },
    {
        "content": "<blockquote>\n<p>how do you intend to further refine to bytes 300-325?</p>\n</blockquote>\n<p>There's a team at MS looking to make a proposal for NLP annotations as a FHIR Core (complex) extension, if we can work out something simple enough.</p>",
        "id": 263344611,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638386946
    },
    {
        "content": "<blockquote>\n<p>How is this not Condition.evidence.detail?</p>\n</blockquote>\n<p>Aim is many kinds of derived resources with a consistent approach, not just Conditions.</p>",
        "id": 263344795,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638387006
    },
    {
        "content": "<p>it might not have been clear that in Provenance there is both a need to say here is the provenance for that specific element in that resource, but also when I created some target, I used (Provenance.entity) this specific element from this specific resource (which seems like Josh use-case). Provenance use-cases are waiting for the FHIR-I CR to get applied.</p>",
        "id": 263344814,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638387013
    },
    {
        "content": "<p>it does seem like provenance to me - need a profile on provenance that provides the details</p>",
        "id": 263344931,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638387062
    },
    {
        "content": "<p>FHIR-I approved, but not yet applied -- <a href=\"http://jira.hl7.org/browse/FHIR-23076\">FHIR-23076</a></p>",
        "id": 263345089,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638387124
    },
    {
        "content": "<p>Agreed that Provenance can convey these semantics; still, externalizing this information into Provenance is going to a tough sell. Same basic reason we see Meta.source used even though Provenance can tell this story.</p>",
        "id": 263345138,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638387131
    },
    {
        "content": "<p>Josh, I am not saying something else should never be done (see fiveWs), but creating extensions for the same function seems like bad governance.  Meaning, I would like you to help get Provenance to be functional for your use-cases, rather than building something else because Provenance seems not usable.  but, I don't have the vsibility into your project that you do.</p>",
        "id": 263345811,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638387386
    },
    {
        "content": "<p>there is an extension to forward reference Provenance. And that would be better than using a really complex extension. Or you put a contained provenance in the resource (no need to forward reference it, and the target reference is just #)</p>",
        "id": 263346163,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638387510
    },
    {
        "content": "<p>yes, but we still don't have, even in Provenance, the ability to say this specific element at this Proveanance.entity.what <br>\nso,  as much as I want to push Provenance upon Josh... It still does not solve his specific \"element\" need... until FHIR-I updates <a href=\"http://build.fhir.org\">build.fhir.org</a> to explain what that kind of a Reference looks like.</p>",
        "id": 263346739,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638387731
    },
    {
        "content": "<p>I put it on my todo list for today or tomorrow</p>",
        "id": 263346844,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638387782
    },
    {
        "content": "<p>thus, short term we need an extension for the \"this element within...\" this Reference.   but that extension should look very much like what FHIR-I intends for R5 Reference use-case</p>",
        "id": 263346859,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638387786
    },
    {
        "content": "<p>Would a \"path\" element of datatype uri be relevant for \"this element within...\"?  This is what we are using in ArtifactAssessment Resource when referring to a specific element within the referenced resource.</p>",
        "id": 263370038,
        "sender_full_name": "Brian Alper",
        "timestamp": 1638399688
    },
    {
        "content": "<p>My use case is for an element level Provenance target. A simple extension like Josh showed would do (i.e. extension/valueUrl). But it could also work outside of Provenance. <br>\nI don't see the need for an extension that has more than just a single element reference. If you need a list (mentioned in some of the jira referenced threads) then just repeat the extension, keeping it simpler for the majority of cases.</p>",
        "id": 263372357,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1638401154
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> Thinking about the use of Provenance here -- let's say I have a whole bunch of resources derived from a single source document, and a whole bunch of individual elements within these resources for which even more detailed attribution can be expressed. So I want to say things like:</p>\n<ul>\n<li>Condition 123 came from this source doc, character range X</li>\n<li>Condition 123's status came from this source doc X'</li>\n<li>Condition 123's onset date came from this source doc X''</li>\n<li>Condition 456 came from this source doc, character range Y</li>\n<li>Condition 456's status came from this source doc Y'</li>\n<li>Condition 456's onset date came from this source doc Y''</li>\n</ul>\n<p>Is there a way to do this with just one Provenance instance, or would I need 2 or 6?</p>",
        "id": 263465195,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638463251
    },
    {
        "content": "<p>I think that would need 6. The way it is today. Your need is not been presented before</p>",
        "id": 263465639,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638463429
    },
    {
        "content": "<p>Understood! Just trying to work through some examples and get an intuition here.</p>",
        "id": 263466242,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638463667
    },
    {
        "content": "<p>A single Provenance can have more than one target, so a single change can point at Condition 123 and 456, and could have several extensions to say which elements were affected. So it could be less than 6. But you would need at least one for doc X and doc Y, because they are different \"changes\" I assume. <br>\nI suppose it depends if we consider that a single \"change process\" (the source doc)  can cause <em>multiple</em> FHIR level changes. I don't see why it cannot - they are conceptually part of one change. But if there are 2 change processes (2 documents, or 2 users doing different things) then that would presumably need 2 provenances.</p>",
        "id": 263471094,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1638465564
    },
    {
        "content": "<p>In a \"plain old extension\" world, this is pretty easy: you just decorate each resource and element with  a \"came from NLP of ...\" extension. It's less generic/abstract, which is part of what makes it more ergonomic.</p>",
        "id": 263482416,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638470491
    },
    {
        "content": "<p>ergonomics is a matter of perspective. If an NLP system constructs a resource and litters it with NPL process related extensions, what should another system do when it updates a value? preserve the extensions, or strip some of them, or all of them? </p>\n<p>I really think that having the NLP traceability in a separate resource has a lot going for it, even if it's more complex initially</p>",
        "id": 263485135,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638471680
    },
    {
        "content": "<p>FWIW, I believe my prior use cases were all around provenance, per</p>\n<ul>\n<li><a href=\"#narrow/search/pop.20and.20health.20and.20person.20and.20patient.20and.20provenance\">https://chat.fhir.org/#narrow/search/pop.20and.20health.20and.20person.20and.20patient.20and.20provenance</a> </li>\n<li><a href=\"#narrow/stream/179166-implementers/topic/Source.20of.20information\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Source.20of.20information</a> </li>\n</ul>\n<p>Both of which led me to log <a href=\"http://jira.hl7.org/browse/FHIR-20583\">J#20583</a> summarizing my two use cases (resolved in 2019, but not applied yet)</p>",
        "id": 263488696,
        "sender_full_name": "Michelle (Moseman) Miller",
        "timestamp": 1638473267
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/extension-targetelement.html\">http://build.fhir.org/extension-targetelement.html</a> and <a href=\"http://build.fhir.org/extension-targetpath.html\">http://build.fhir.org/extension-targetpath.html</a></p>",
        "id": 263806246,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638762807
    },
    {
        "content": "<p>Can we work up the Provenance examples that <span class=\"user-mention\" data-user-id=\"191403\">@Michelle (Moseman) Miller</span> indicated as examples of how to use this in Provenance? I am not exactly sure what it looks like in use.</p>",
        "id": 263843951,
        "sender_full_name": "John Moehrke",
        "timestamp": 1638794609
    },
    {
        "content": "<p>I added some examples</p>",
        "id": 265793151,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1640172246
    },
    {
        "content": "<p>ah, I had not seen those show up on build Provenance examples.</p>\n<ul>\n<li>Targeted Provenance Example #1 -- this is a .target use with  targetElement extension. that is to an element by .id.</li>\n<li>Targeted Provenance Example #2 -- similar</li>\n<li>Targeted Provenance Example #3 -- this is a .target use with targetPath extension.<br>\nThese address the first usecase in <a href=\"http://jira.hl7.org/browse/FHIR-20583\">FHIR-20583</a>, the second more of the same but use with the extension in .entity.</li>\n</ul>",
        "id": 265802687,
        "sender_full_name": "John Moehrke",
        "timestamp": 1640178755
    }
]