[
    {
        "content": "<p>We are using the new c# validation functionality. It seems that the code is not threadsafe. It started when we got some random errors. When running a test running 100000 tasks in parallell we are getting some random errors as well. To improve the performance in our service I have set the Validator object as static. I have attached the output.<a href=\"/user_uploads/10155/uNv_G5U-gWEuCjccrtBvSTEp/threadrun.xml\" target=\"_blank\" title=\"threadrun.xml\">threadrun.xml</a> </p>\n<p>It works fine if I put a lock around validator.Validate(someXmlReader), that ofcourse reduces the performance.</p>\n<p>The code for setting up the validator looks like this: <br>\n var profilePath = Path.Combine(directoryInfo.FullName) + @\"\\Definitions\";<br>\n                    var coreSource = new CachedResolver(ZipSource.CreateValidationSource());<br>\n                    var cachedResolver = new CachedResolver(new DirectorySource(profilePath, includeSubdirectories: true));<br>\n                    var combinedSource = new MultiResolver(cachedResolver, coreSource);<br>\n                    var settings = ValidationSettings.Default;<br>\n                    settings.EnableXsdValidation = validateXsd;<br>\n                    settings.GenerateSnapshot = true;<br>\n                    settings.Trace = showTrace;<br>\n                    settings.ResourceResolver = combinedSource;<br>\n                    _validator = new Validator(settings);</p>",
        "id": 153864542,
        "sender_full_name": "Jon-Vidar Schneider",
        "timestamp": 1482309366
    },
    {
        "content": "<p>This should probably be moved across to the dotnet thread<br>\n<a href=\"https://chat.fhir.org/#narrow/stream/dotnet\" target=\"_blank\" title=\"https://chat.fhir.org/#narrow/stream/dotnet\">https://chat.fhir.org/#narrow/stream/dotnet</a></p>",
        "id": 153864737,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1482380559
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192439\">@Jon-Vidar Schneider</span> - Thanks for the feedback. We'll make note of it. But beware that the Validator is still an alpha release. There also is a known issue around bi-directional references, which causes a stack overflow.</p>",
        "id": 153864753,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1482409073
    },
    {
        "content": "<p>I created an issue of it: <a href=\"https://github.com/ewoutkramer/fhir-net-api/issues/280\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/issues/280\">https://github.com/ewoutkramer/fhir-net-api/issues/280</a></p>",
        "id": 153864754,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1482409272
    },
    {
        "content": "<p>Thank you. We are also getting some other random errors, even not with this threadissue. We are going to disable the validation on our production enviroment until we get a solution for all these errors. Will create issues for them in github.</p>",
        "id": 153864755,
        "sender_full_name": "Jon-Vidar Schneider",
        "timestamp": 1482409680
    },
    {
        "content": "<p>Please note that the FHIR .NET API validator is still under development and not yet ready for production environments. For example, slicing validation needs some more work, as well as the interaction with the snapshot generator. Also the validator still needs to detect and handle endless recursion (e.g. Organization.partOf =&gt; Organization). Feel free to evaluate/test the code and submit bugs!</p>",
        "id": 153864787,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1482420212
    },
    {
        "content": "<p>We will. We are only using it in the development phase so we don't deliver fhir-services that is not valid according to the customized profiles.</p>",
        "id": 153864789,
        "sender_full_name": "Jon-Vidar Schneider",
        "timestamp": 1482420352
    },
    {
        "content": "<p>You can however use the invariant validation code in there, it is quite good.<br>\nAll the examples pass through it, and i've been using it on our server for some time now.</p>",
        "id": 153864853,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1482448645
    },
    {
        "content": "<p>There is a unit test that checks this if you want to see how to use it.</p>",
        "id": 153864854,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1482448688
    },
    {
        "content": "<p>(and is in both DSTU2 and STU3)</p>",
        "id": 153864855,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1482448700
    }
]