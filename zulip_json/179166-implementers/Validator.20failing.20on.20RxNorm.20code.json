[
    {
        "content": "<p>I'm looking at the validation of a FHIR Resource and seeing an invalid code error for a code that seems to be valid.  That code specifically is <code>2123111</code> in RxNorm (<a href=\"https://mor.nlm.nih.gov/RxNav/search?searchBy=RXCUI&amp;searchTerm=2123111\" title=\"https://mor.nlm.nih.gov/RxNav/search?searchBy=RXCUI&amp;searchTerm=2123111\">can be seen here on RxNav</a>).</p>\n<p>This small example resource can be used to reproduce the error: <a href=\"/user_uploads/10155/GjonnnJ4vgWIsHsqQ_S4TyHS/medication_example.json\" title=\"medication_example.json\">medication_example.json</a> </p>\n<p>Below is what I see when validating the resource:</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar medication_example.json -version <span class=\"m\">4</span>.0.1\nFHIR Validation tool Version <span class=\"m\">4</span>.2.14-SNAPSHOT <span class=\"o\">(</span>Git# 3edfeda13a8b<span class=\"o\">)</span>. Built <span class=\"m\">2020</span>-04-06T10:21:10.485+10:00 <span class=\"o\">(</span><span class=\"m\">16</span> hours old<span class=\"o\">)</span>\nDetected Java version: <span class=\"m\">1</span>.8.0_222 from /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre on x86_64 <span class=\"o\">(</span>64bit<span class=\"o\">)</span>. 3641MB available\nArguments: medication_example.json -version <span class=\"m\">4</span>.0.1\nDirectories: <span class=\"nv\">Current</span> <span class=\"o\">=</span> /Users/radamson/Desktop, Package <span class=\"nv\">Cache</span> <span class=\"o\">=</span> /Users/radamson/.fhir/packages\n  .. FHIR Version <span class=\"m\">4</span>.0, definitions from hl7.fhir.r4.core#4.0.1\n  .. connect to tx server @ http://tx.fhir.org\n    <span class=\"o\">(</span>v4.0.1<span class=\"o\">)</span>\n  .. validate <span class=\"o\">[</span>medication_example.json<span class=\"o\">]</span>\nTerminology server: Check <span class=\"k\">for</span> supported code systems <span class=\"k\">for</span> http://www.nlm.nih.gov/research/umls/rxnorm\n*FAILURE* validating medication_example.json:  error:1 warn:0 info:0\n  Error @ Medication.code.coding<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span> <span class=\"o\">(</span>line <span class=\"m\">5</span>, col8<span class=\"o\">)</span> : The code <span class=\"s2\">&quot;2123111&quot;</span> is not valid in the system http://www.nlm.nih.gov/research/umls/rxnorm<span class=\"p\">;</span> The code provided <span class=\"o\">(</span>http://www.nlm.nih.gov/research/umls/rxnorm#2123111<span class=\"o\">)</span> is not  valid in the value <span class=\"nb\">set</span> All codes known to the system <span class=\"k\">for</span> <span class=\"s2\">&quot;http://www.nlm.nih.gov/research/umls/rxnorm#2123111&quot;</span>\n</pre></div>\n\n\n<p>I suspect that this is occurring because the code seems relatively new and might not be represented in <a href=\"http://tx.fhir.org\" title=\"http://tx.fhir.org\">tx.fhir.org</a>. <br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> any insight onto why this code is failing or as to what I'm doing wrong here?  Also based on a cursory search through your <a href=\"https://github.com/grahamegrieve/fhirserver/blob/7204abcdc27bd5403ad2ebe19bfede86e5710069/utilities/UtilitiesForm.pas#L683\" title=\"https://github.com/grahamegrieve/fhirserver/blob/7204abcdc27bd5403ad2ebe19bfede86e5710069/utilities/UtilitiesForm.pas#L683\">fhirserver implementation it looks like UMLS is used for sourcing RxNorm codes</a>.  I'm not very familiar with Pascal or the structure of the repo though so I could be totally wrong.  Are you using UMLS here and is there any documentation on the version being used and for what codesystems?  We are using UMLS with inferno and I'd be interested in learning from your approach.</p>",
        "id": 193074346,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1586194143
    },
    {
        "content": "<p>the RxNorm distribution is the same format as UMLS but we only install the latest RxNorm. I'm not actually sure what version is running...</p>",
        "id": 193085611,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586199332
    },
    {
        "content": "<p>I don't believe that RxNorm has been updated on <a href=\"http://tx.fhir.org\" title=\"http://tx.fhir.org\">tx.fhir.org</a> for a while (not sure exactly which version we're on at the moment, either).</p>",
        "id": 193085927,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1586199467
    },
    {
        "content": "<p>I was just looking at it.  It's time to get it updated.</p>",
        "id": 193085963,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1586199481
    },
    {
        "content": "<p>yes please</p>",
        "id": 193086012,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586199488
    },
    {
        "content": "<p>will do</p>",
        "id": 193086075,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1586199519
    },
    {
        "content": "<p>Thanks that is helpful.</p>\n<p>It sounds like you download the RxNorm RRF files directly from NLM (are you getting them from <a href=\"https://www.nlm.nih.gov/research/umls/rxnorm/docs/rxnormfiles.html\" title=\"https://www.nlm.nih.gov/research/umls/rxnorm/docs/rxnormfiles.html\">here</a>?).  I see there is a <a href=\"https://github.com/grahamegrieve/fhirserver/blob/ee1b658d11fecb50ac2d90ed0ec08c4bc3d49cfd/resources/sql/rxnorm_import.sql\" title=\"https://github.com/grahamegrieve/fhirserver/blob/ee1b658d11fecb50ac2d90ed0ec08c4bc3d49cfd/resources/sql/rxnorm_import.sql\">SQL file here</a> too where it looks like these concepts are loaded into a database.</p>\n<p>I didn't see any similar files for some of the other code systems included in UMLS (SNOMED, ICD10, CPT, CVX, etc.  Can you provide me some insight onto where those codesystems are sourced and how they are managed in the fhirserver?  Happy to move this discussion elsewhere if its more appropriate or take a look at any available documentation.  Thanks again for the responses!</p>",
        "id": 193087995,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1586200462
    },
    {
        "content": "<p>each different code system is managed differently depending on it's internal semantics and how it is distributed. Snomed and LOINC are processed to an internal fully cross-linked memory structure, and then loaded into memory at start up. ICD-10 is loaded out of a custom text file format. CVX is read out of a CSV. A few (UCUM, Lang) are supported from specific code. Also, the CodeSystem resource is supported directly.</p>",
        "id": 193088317,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586200673
    },
    {
        "content": "<p>If needed, further specific details can be discussed in the <a href=\"#narrow/stream/179281-pascal\" title=\"#narrow/stream/179281-pascal\">pascal</a> stream.</p>",
        "id": 193104884,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1586208781
    }
]