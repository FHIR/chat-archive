[
    {
        "content": "<p>For any server implementers, it's probably worth looking at this issue just opened on HAPI <br>\n<a href=\"https://github.com/jamesagnew/hapi-fhir/issues/339​\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/339​\">https://github.com/jamesagnew/hapi-fhir/issues/339​</a> and the associated XXE links about the issue and a mitigation</p>",
        "id": 153822419,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1461042581
    },
    {
        "content": "<p>Thanks Michael, i have added this as a todo on the .NET XML parser as well.</p>",
        "id": 153822439,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461056792
    },
    {
        "content": "<p>Have you looked into it yet Ewout?</p>",
        "id": 153822445,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1461058863
    },
    {
        "content": "<p>Just checked the dotnet XML Serializer<br>\n<code>settings.IgnoreProcessingInstructions = true;</code></p>",
        "id": 153822449,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1461059431
    },
    {
        "content": "<p>Seems that msxml is not affected? It's hard to find good information about this!</p>",
        "id": 153822450,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461062446
    },
    {
        "content": "<p>this is in the dotnet System.Xml.XmlReader class that we use.</p>",
        "id": 153822452,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1461064067
    },
    {
        "content": "<p>(not necessarily the msxml parser)</p>",
        "id": 153822453,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1461064079
    },
    {
        "content": "<p>See <a href=\"https://github.com/ewoutkramer/fhir-net-api/issues/190\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/issues/190\">https://github.com/ewoutkramer/fhir-net-api/issues/190</a>.</p>\n<p>Verified resilience with a unit-test, .NET parser refuses to parse this DTD</p>",
        "id": 153822459,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461068119
    },
    {
        "content": "<p>For a test case: POST this to [base]/ValueSet/$expand</p>\n<p>&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM \"file:///etc/\"&gt;]&gt; &lt;Parameters xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\" &gt;&lt;parameter&gt; &lt;name value=\"identifier\" /&gt;&lt;valueUri value=\"<a href=\"http://snomed.info/sct/32506021000036107/version/20120531?fhir_vs=isa/900000000000455006\" target=\"_blank\" title=\"http://snomed.info/sct/32506021000036107/version/20120531?fhir_vs=isa/900000000000455006\">http://snomed.info/sct/32506021000036107/version/20120531?fhir_vs=isa/900000000000455006</a>\" /&gt;&amp;xxe; &lt;/parameter&gt;&lt;/Parameters&gt;</p>",
        "id": 153822465,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1461073800
    },
    {
        "content": "<p>so, the maintainers of the reference implementations just discussed this. In order to protect against this, we have to turn off all processing of entities - we can't just turn off some of them</p>",
        "id": 153822507,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461096349
    },
    {
        "content": "<p>the upshot of this is that we propose to make a new rule: no entity definitions in the xml. Only pre-defined entities allowed. </p>",
        "id": 153822508,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461096377
    },
    {
        "content": "<p>The \"pre-defined ones\" including the \"normal\" character entities. Now to decide which those are, I didn't know there were this much: <a href=\"https://dev.w3.org/html5/html-author/charref\" target=\"_blank\" title=\"https://dev.w3.org/html5/html-author/charref\">https://dev.w3.org/html5/html-author/charref</a></p>",
        "id": 153822582,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461143009
    },
    {
        "content": "<p>DTDs for XHTML entities: <a href=\"https://www.w3.org/TR/xhtml1/dtds.html#h-A2\" target=\"_blank\" title=\"https://www.w3.org/TR/xhtml1/dtds.html#h-A2\">https://www.w3.org/TR/xhtml1/dtds.html#h-A2</a></p>",
        "id": 153822590,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1461147367
    },
    {
        "content": "<p>Y. That's the list I used. The link I sent has many more, like <code>&amp;dopf;</code></p>",
        "id": 153822592,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461149748
    },
    {
        "content": "<p>Aha, apparently HTML5 introduced some new entities.</p>",
        "id": 153822594,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1461150439
    },
    {
        "content": "<p>we're using xhtml, not html. the only entities defined are those in xml, not xhtml </p>",
        "id": 153822600,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461153223
    },
    {
        "content": "<p>Well, there might be some in the narrative too, which is xhtml. It's a different namespace, but I'd think it would be surprising to the user if it's allowed in one place but not in the other.  If I look at this: <a href=\"https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references\" target=\"_blank\" title=\"https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references\">https://en.wikipedia.org/wiki/List_of_XML_and_HTML_character_entity_references</a>, it seems there are only a few xml entities. I'd really like to support stuff like &amp;ecirc; for common diacritics in (european) languages...</p>",
        "id": 153822715,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461224940
    },
    {
        "content": "<p>FYI to any HAPI users, a new release is now in the Maven stable repos (1.5) which addresses this issue.</p>",
        "id": 153822737,
        "sender_full_name": "James Agnew",
        "timestamp": 1461246140
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> I'm not thrilled with the notion of supporting things that aren't valid XHTML.  I don't think we can count on support for those in a lot of off-the-shelf tools.  Plus it creates technical issues with the spec.</p>",
        "id": 153822738,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1461246332
    },
    {
        "content": "<p>Well, I had to support it (just like the Java implementation I guess), since our examples had those entities in them. But sure, we could discuss removing this support....</p>",
        "id": 153823114,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1461679842
    },
    {
        "content": "<p>I don't think you'll find them in any examples any more</p>",
        "id": 153823115,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461680005
    },
    {
        "content": "<p>they're not valid, and I don't think anything like this still escapes testing</p>",
        "id": 153823116,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461680021
    },
    {
        "content": "<p>though I eliminated some from the json examples while on the plane</p>",
        "id": 153823117,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1461680041
    }
]