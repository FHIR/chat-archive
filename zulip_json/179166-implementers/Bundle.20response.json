[
    {
        "content": "<p>Hello,<br>\ni have a question regarding the Bundle message. When my server receives a POST, according to the FHIR spec, we should return a Bundle. My doubt is, it is mandatory send back the whole resource created plus the response tag inside the Bundle, or can can we just send the response tag inside the Bundle, just to avoid send back \"everything\" again?<br>\nExample: <br>\n&lt;Bundle&gt;<br>\n     &lt;entry&gt;<br>\n          &lt;response&gt;...&lt;/response&gt;<br>\n     &lt;/entry&gt;<br>\n&lt;/Bundle&gt; </p>\n<p>Thank you</p>",
        "id": 153990763,
        "sender_full_name": "Alex Neiva",
        "timestamp": 1535124060
    },
    {
        "content": "<p>See <a href=\"http://build.fhir.org/http.html#prefer\" target=\"_blank\" title=\"http://build.fhir.org/http.html#prefer\">http://build.fhir.org/http.html#prefer</a></p>",
        "id": 153990766,
        "sender_full_name": "John Moehrke",
        "timestamp": 1535124433
    },
    {
        "content": "<p>Oh great... i did not see that! Thank you very much</p>",
        "id": 153990770,
        "sender_full_name": "Alex Neiva",
        "timestamp": 1535124699
    },
    {
        "content": "<p>The link that John posted gives the best guidance, but I just wanted to question your statement \"...according to the FHIR spec, we should return a Bundle.\"  If I'm POSTing a single resource, I'm pretty sure that you don't return a Bundle, but either just the response code, the resource I just posted (with metadata filled in) or an OperationOutcome.</p>",
        "id": 153990771,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1535124723
    },
    {
        "content": "<p>At the end of that link is a table where it is mentioned the Interaction:Response. It is only mandatory for the <em>search</em> and <em>transaction</em> interactions.<br>\nIn my case i was using the transaction so i mentioned that it is mandatory. For the <em>created</em> it is optional but preferred.</p>",
        "id": 153990773,
        "sender_full_name": "Alex Neiva",
        "timestamp": 1535125046
    },
    {
        "content": "<p>Ah, you didn't mention that you were sending a transaction.  Sorry.</p>",
        "id": 153990775,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1535125128
    },
    {
        "content": "<p>Yes, my mistake eheheh <span class=\"emoji emoji-1f44d\" title=\"thumbs up\">:thumbs_up:</span></p>",
        "id": 153990777,
        "sender_full_name": "Alex Neiva",
        "timestamp": 1535125381
    },
    {
        "content": "<p>Hello,</p>\n<p>I've got a question about the return value of a batch bundle. We are working with a custom build FHIR server and asked the following question to the Dev team.</p>\n<p>note: the CDR being the FHIR server.<br>\n-------------------Start-----------------<br>\nWe have an issue when posting a batch bundle to the CDR with validation enabled. </p>\n<p>When there is one item in the batch that does not pass validation the whole batch is rejected and a single OperationOutcome is returned instead of a bundle with an OperationOutcome per item in the request batch bundle.</p>\n<p>This would be the right behavior in case of a transaction bundle but not in case of a batch bundle.  A Bundle posted to the batch-transaction endpoint should(<a href=\"https://www.hl7.org/fhir/http.html#transaction-response\">https://www.hl7.org/fhir/http.html#transaction-response</a>): \"For a batch, or a successful transaction, the response the server SHALL return a Bundle with type set to batch-response or transaction-response that contains one entry for each entry in the request, in the same order, with the outcome of processing the entry. For a failed transaction, the server returns a single OperationOutcome instead of a Bundle.\"</p>\n<p>So only a failed transaction should return a single OperationOutcome. In case of a batch all entries should be processed and validated separately as stated (<a href=\"https://www.hl7.org/fhir/http.html#transaction\">https://www.hl7.org/fhir/http.html#transaction</a>): \" The resources in the bundle are each processed separately as if they were an individual interaction or operation as otherwise described on this page, or the Operations framework. The actions are subject to the normal processing for each, including the meta element, verification and version aware updates, and transactional integrity. In the case of a batch each entry is treated as if an individual interaction or operation, in the case of a transaction all interactions or operations either succeed or fail together (see below).\"</p>\n<p>We already had ad quick discussion about this and the reasoning of validating the bundle as a whole is that a Bundle is also a resource of its own and should be validated as such. This is true if we were actually posting a Bundle as a data entry in the type specific url like <a href=\"http://cdrurl/tenantid/Bundle\">http://cdrurl/tenantid/Bundle</a>. But in this case we are posting it to the transaction endpoint where it must be processed in a different way as described above.<br>\n-------------------END-----------------</p>\n<p>The response is that they still believe that the implementation is according to spec. Can anyone shed some light on this?</p>\n<p>Kind regards,</p>\n<p>Marco Westerink</p>",
        "id": 215727716,
        "sender_full_name": "Marco Westerink",
        "timestamp": 1604590340
    },
    {
        "content": "<p>The <a href=\"http://build.fhir.org/http.html#transaction-response\">specification seems to be clear</a>:</p>\n<blockquote>\n<p>For a <strong>batch</strong>, or a <strong>successful transaction</strong>, the response the server <strong>SHALL return</strong> a <em>Bundle with type set to batch-response or transaction-response that contains one entry for each entry in the request, in the same order, with the outcome of processing the entry</em>. For a <strong>failed transaction</strong>, the server returns a single OperationOutcome instead of a Bundle.</p>\n</blockquote>\n<p>What is the nature of the failed validation in <code>one item in the batch that does not pass validation</code>?</p>",
        "id": 215730441,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1604591400
    },
    {
        "content": "<p>Thanks for your answer. My thoughts exactly.<br>\nIt's a profile violation fabricated to test the behavior.</p>",
        "id": 216046952,
        "sender_full_name": "Marco Westerink",
        "timestamp": 1604902434
    },
    {
        "content": "<p>I work for the \"custom built\" FHIR server referenced above. Our FHIR server, by design, performs input validation and DDoS content limit enforcement at the boundary as requests are being read. Any request with a body goes through this process and the requests are only handled by their respective handlers only after they are deemed to be not violating validation rules or content limits. This validation acts on the entire Bundle in this case, is unaware whether it is a single resource or batch bundle or transaction bundle and any validation failures are returned as a single OperationOutcome.<br>\nAfter the validation, the bundle is \"processed\" as a batch where each entry is processed independently and any failing entry results in a OperationOutcome entry that is returned together with successful entries in a response bundle.</p>\n<p>The question in point is <br>\nAre we in violation of the spec if we return a single OperationOutcome  instead of a Bundle at any stage of the batch request processing? Are the servers always expected to return a bundle even if the given Bundle is wrong or misses Authorization header or if a 10GB bundle is posted as a batch.</p>\n<p>I had tested this on <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> 's reference server with an intentionally fabricated bundle and of course was able to simulate the case where it returned a single OperationOutcome within a couple attempts.</p>",
        "id": 217243026,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1605776635
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 217243112,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1605776676
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>curl --location --request POST &#39;http://test.fhir.org/r3&#39; \\\n--header &#39;Accept: application/json&#39; \\\n--header &#39;Content-Type: application/json&#39; \\\n--data-raw &#39;{\n    &quot;resourceType&quot;: &quot;Bundle&quot;,\n    &quot;type&quot;: &quot;batch&quot;,\n    &quot;entry&quot;: [\n        {\n            &quot;fullUrl&quot;: &quot;Observation/127&quot;,\n            &quot;resource&quot;: {\n                &quot;resourceType&quot;: &quot;Observation&quot;,\n                &quot;status&quot;: &quot;reviewed&quot;,\n                &quot;category&quot;: [\n                    {\n                        &quot;coding&quot;: [\n                            {\n                                &quot;system&quot;: &quot;http://hl7.org/fhir/observation-category&quot;,\n                                &quot;code&quot;: &quot;vital-signs&quot;,\n                                &quot;display&quot;: &quot;Vital Signs&quot;\n                            }\n                        ]\n                    }\n                ],\n                &quot;code&quot;: {\n                    &quot;coding&quot;: [\n                        {\n                            &quot;system&quot;: &quot;http://loinc.org&quot;,\n                            &quot;code&quot;: &quot;29463-7&quot;,\n                            &quot;display&quot;: &quot;Body Weight&quot;\n                        },\n                        {\n                            &quot;system&quot;: &quot;http://loinc.org&quot;,\n                            &quot;code&quot;: &quot;3141-9&quot;,\n                            &quot;display&quot;: &quot;Body weight Measured&quot;\n                        },\n                        {\n                            &quot;system&quot;: &quot;http://snomed.info/sct&quot;,\n                            &quot;code&quot;: &quot;27113001&quot;,\n                            &quot;display&quot;: &quot;Body weight&quot;\n                        },\n                        {\n                            &quot;system&quot;: &quot;http://acme.org/devices/clinical-codes&quot;,\n                            &quot;code&quot;: &quot;body-weight&quot;,\n                            &quot;display&quot;: &quot;Body Weight&quot;\n                        }\n                    ]\n                },\n                &quot;subject&quot;: {\n                    &quot;reference&quot;: &quot;Patient/example&quot;\n                },\n                &quot;context&quot;: {\n                    &quot;reference&quot;: &quot;Encounter/example&quot;\n                },\n                &quot;effectiveDateTime&quot;: &quot;2016-03-28&quot;,\n                &quot;valueQuantity&quot;: {\n                    &quot;value&quot;: 185,\n                    &quot;unit&quot;: &quot;lbs&quot;,\n                    &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n                    &quot;code&quot;: &quot;[lb_av]&quot;\n                }\n            },\n            &quot;request&quot;: {\n                &quot;method&quot;: &quot;POST&quot;,\n                &quot;url&quot;: &quot;Observation&quot;\n            }\n        }\n    ]\n}&#39;```\n</code></pre></div>",
        "id": 217243115,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1605776677
    },
    {
        "content": "<p>I had given an invalid code for Observation.status as reviewed. And that returns a single OperationOutcome as below</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;text&quot;: {\n        &quot;status&quot;: &quot;generated&quot;,\n        &quot;div&quot;: &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;p&gt;unknown code: reviewed from a set of choices of (\\&quot;\\&quot;, \\&quot;registered\\&quot;, \\&quot;preliminary\\&quot;, \\&quot;final\\&quot;, \\&quot;amended\\&quot;, \\&quot;corrected\\&quot;, \\&quot;cancelled\\&quot;, \\&quot;entered-in-error\\&quot;, \\&quot;unknown\\&quot;) for \\&quot;$.entry[0].resource/status\\&quot;&lt;/p&gt;&lt;/div&gt;&quot;\n    },\n    &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;details&quot;: {\n                &quot;text&quot;: &quot;unknown code: reviewed from a set of choices of (\\&quot;\\&quot;, \\&quot;registered\\&quot;, \\&quot;preliminary\\&quot;, \\&quot;final\\&quot;, \\&quot;amended\\&quot;, \\&quot;corrected\\&quot;, \\&quot;cancelled\\&quot;, \\&quot;entered-in-error\\&quot;, \\&quot;unknown\\&quot;) for \\&quot;$.entry[0].resource/status\\&quot;&quot;\n            },\n            &quot;diagnostics&quot;: &quot;(00000000017C84D3){FHIRServer.exe} [0000000001BC94D3] Unknown function at TMethodImplementationIntercept + $1720E63\\r\\n(0000000005AE1BAC){FHIRServer.exe} [0000000005EE2BAC] Unknown function at TMethodImplementationIntercept + $5A3A53C\\r\\n(0000000005AE3AE0){FHIRServer.exe} [0000000005EE4AE0] Unknown function at TMethodImplementationIntercept + $5A3C470\\r\\n(000000000004B717){FHIRServer.exe} [000000000044C717] Unknown function at __dbk_fcall_wrapper + $2E157\\r\\n(000000000004C00B){FHIRServer.exe} [000000000044D00B] Unknown function at __dbk_fcall_wrapper + $2EA4B\\r\\n(00000000000115D6){FHIRServer.exe} [00000000004125D6]\\r\\n(0000000000011611){FHIRServer.exe} [0000000000412611]\\r\\n(00000000017C84D3){FHIRServer.exe} [0000000001BC94D3] Unknown function at TMethodImplementationIntercept + $1720E63\\r\\n(00000000018D11CF){FHIRServer.exe} [0000000001CD21CF] Unknown function at TMethodImplementationIntercept + $1829B5F\\r\\n(00000000018D0FC8){FHIRServer.exe} [0000000001CD1FC8] Unknown function at TMethodImplementationIntercept + $1829958\\r\\n(00000000019535FE){FHIRServer.exe} [0000000001D545FE] Unknown function at TMethodImplementationIntercept + $18ABF8E\\r\\n(00000000016291D5){FHIRServer.exe} [0000000001A2A1D5] Unknown function at TMethodImplementationIntercept + $1581B65\\r\\n(00000000016292E2){FHIRServer.exe} [0000000001A2A2E2] Unknown function at TMethodImplementationIntercept + $1581C72\\r\\n(000000000180CD52){FHIRServer.exe} [0000000001C0DD52] Unknown function at TMethodImplementationIntercept + $17656E2\\r\\n(000000000180CBF8){FHIRServer.exe} [0000000001C0DBF8] Unknown function at TMethodImplementationIntercept + $1765588\\r\\n(000000000180CBA2){FHIRServer.exe} [0000000001C0DBA2] Unknown function at TMethodImplementationIntercept + $1765532\\r\\n(0000000000686A37){FHIRServer.exe} [0000000000A87A37] Unknown function at TMethodImplementationIntercept + $5DF3C7\\r\\n(000000000180EC0E){FHIRServer.exe} [0000000001C0FC0E] Unknown function at TMethodImplementationIntercept + $176759E\\r\\n(000000000180E938){FHIRServer.exe} [0000000001C0F938] Unknown function at TMethodImplementationIntercept + $17672C8\\r\\n(0000000001952B54){FHIRServer.exe} [0000000001D53B54] Unknown function at TMethodImplementationIntercept + $18AB4E4\\r\\n(00000000016291D5){FHIRServer.exe} [0000000001A2A1D5] Unknown function at TMethodImplementationIntercept + $1581B65\\r\\n(000000000068612F){FHIRServer.exe} [0000000000A8712F] Unknown function at TMethodImplementationIntercept + $5DEABF\\r\\n(000000000068945B){FHIRServer.exe} [0000000000A8A45B] Unknown function at TMethodImplementationIntercept + $5E1DEB\\r\\n(00000000058DDE93){FHIRServer.exe} [0000000005CDEE93] Unknown function at TMethodImplementationIntercept + $5836823\\r\\n(00000000058D6483){FHIRServer.exe} [0000000005CD7483] Unknown function at TMethodImplementationIntercept + $582EE13\\r\\n(00000000058D2F0A){FHIRServer.exe} [0000000005CD3F0A] Unknown function at TMethodImplementationIntercept + $582B89A\\r\\n(00000000058F6F39){FHIRServer.exe} [0000000005CF7F39] Unknown function at TMethodImplementationIntercept + $584F8C9\\r\\n(00000000006EDAE9){FHIRServer.exe} [0000000000AEEAE9] Unknown function at TMethodImplementationIntercept + $646479\\r\\n(00000000006EF46A){FHIRServer.exe} [0000000000AF046A] Unknown function at TMethodImplementationIntercept + $647DFA\\r\\n(0000000000456C99){FHIRServer.exe} [0000000000857C99] Unknown function at TMethodImplementationIntercept + $3AF629\\r\\n(0000000000454CAA){FHIRServer.exe} [0000000000855CAA] Unknown function at TMethodImplementationIntercept + $3AD63A\\r\\n(000000000045994B){FHIRServer.exe} [000000000085A94B] Unknown function at TMethodImplementationIntercept + $3B22DB\\r\\n(0000000000458AEB){FHIRServer.exe} [0000000000859AEB] Unknown function at TMethodImplementationIntercept + $3B147B\\r\\n(0000000000139683){FHIRServer.exe} [000000000053A683] Unknown function at TMethodImplementationIntercept + $92013\\r\\n(000000000001219D){FHIRServer.exe} [000000000041319D]\\r\\n(00000000000074D4){KERNEL32.DLL} [00007FFD2DF284D4] BaseThreadInitThunk + $14\\r\\n(0000000000050791){ntdll.dll   } [00007FFD2E021791] RtlUserThreadStart + $21\\r\\n&quot;\n        }\n    ]\n}\n</code></pre></div>",
        "id": 217243401,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1605776872
    },
    {
        "content": "<p>I don't know how specific we are about this, but a single operation outcome with an error means that the entire batch processing failed altogether. A single operation with a success is an error on the part of the server</p>",
        "id": 217244105,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1605777295
    }
]