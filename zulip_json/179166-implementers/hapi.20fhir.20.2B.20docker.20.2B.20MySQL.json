[
    {
        "content": "<p>Hi everyone</p>\n<p>We are trying to set up a HAPI FHIR Server with docker  and  connected to a MySQL Docker and are getting the error <br>\n\"com.myslql.cj.jdbc.exception.CommunicationException: Communicationlink failure\"  <br>\n<a href=\"user_uploads/10155/O2CflqJYWsF6Cy1mH27JmHJj/error.log\">error.log</a><br>\nAnyone an idea? </p>\n<p>Further infos if needed: </p>\n<p>---&gt; What is working<br>\n-&gt; Start HAPI FHIR without config file  (docker run -p 8080:8080 -e hapi.fhir.default_encoding=xml hapiproject/hapi)<br>\n-&gt; Start HAPI FHIR with default config file (<a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/resources/application.yaml\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/blob/master/src/main/resources/application.yaml</a>) <br>\n-&gt; Check if mysql database is created <a href=\"user_uploads/10155/0q4KW2nFNcVxUhzo73BQg2UA/console-output-mysql.txt\">console-output-mysql.txt</a></p>\n<p>---&gt; What  is NOT working <br>\n-&gt; Start HAPI FHIR with following changes in config file <br>\n     url: 'jdbc:mysql://localhost:3306/hapi_dstu3' (the database has already been created)<br>\n     driverClassName: com.mysql.cj.jdbc.Driver<br>\nstarting with comand: docker run -p 8080:8080 --name happy2 -v /home/ubuntu/HAPI_FHIR:/configs -e \"--spring.config.location=file:///configs/application.yaml\" hapiproject/hapi:latest</p>",
        "id": 232117929,
        "sender_full_name": "Traven",
        "timestamp": 1616878754
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span></p>",
        "id": 232134914,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616898629
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"394748\">@Traven</span> <br>\n<code>url: 'jdbc:mysql://localhost:3306/hapi_dstu3'</code> </p>\n<p>the localhost here would mean that the SQL server is located in the same container as HAPI FHIR sever. If you are using the same docker compose file for running both MYSQL and HAPI then you'll need to change the <code>localhost</code> to your mysql container name. Otherwise if the mysql container's port is mapped to a port on the host machine you'll need to use the hosts IP address instead of <code>localhost</code></p>",
        "id": 232141147,
        "sender_full_name": "Aditya Kurkure",
        "timestamp": 1616906149
    },
    {
        "content": "<p>This isn't really an error. By design the docker uses H2 defaulting to a file-based database (the in-mem variant is also listed in the config file), which works fine inside docker. It gets you quicly up and running. If you need real persistence like eg. MySQL, then you need to change the defaults, and yes, then you need to point to an adress outside the docker container hosting the hapi-fhir-jpaserver-starter. This is entirely as intended an also very much in line with scoping services in Docker. The configurations listed at <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter#mysql-configuration\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter#mysql-configuration</a> does not take into account that you are running it in Docker which is a choice of your own.</p>",
        "id": 232146700,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1616913235
    },
    {
        "content": "<p>Also note that you can now provide env vars to HAPI to change the config without editing it directly.</p>",
        "id": 232182210,
        "sender_full_name": "Richard Stanley",
        "timestamp": 1616954200
    },
    {
        "content": "<p>Thanks alot -&gt; this was indeed our problem and after getting the right ip of the mysql docker it all worked. Big shout-out to <span class=\"user-mention\" data-user-id=\"396904\">@Aditya Kurkure</span>  , <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span>  and the rest of this  super helpful community!</p>",
        "id": 232473339,
        "sender_full_name": "Traven",
        "timestamp": 1617128653
    }
]