[
    {
        "content": "<p>I seek clarification to this part of the spec (<a href=\"http://www.hl7.org/implement/standards/fhir/search.html#reference\" target=\"_blank\" title=\"http://www.hl7.org/implement/standards/fhir/search.html#reference\">http://www.hl7.org/implement/standards/fhir/search.html#reference</a>):</p>\n<blockquote>\n<p>Some references are allowed to point to more than one type of resource; e.g. subject : Reference(Patient|Group|Device|..). In these cases, multiple resources may have the same logical identifier. Servers SHOULD reject a search where the logical id refers to more than one matching resource across different types.\" </p>\n</blockquote>\n<p>The search parameter general-practitioner on Patient is such a parameter, it may reference Organization and Practitioner.</p>\n<p>Let's assume a FHIR Server with the following data, and a few searches on it.</p>\n<ul>\n<li>Practitioner/1</li>\n<li>Practitioner/2, with no patient linking to it</li>\n<li>Organization/1, with no patient linking to it.</li>\n<li>Organization/2, with name=\"SomeCorp\"</li>\n<li>Patient/pat1, with general-practitioner=Practitioner/1</li>\n<li>Patient/pat2, with general-practitioner=Organization/2</li>\n</ul>\n<p>Search nr1: /Patient?general-practitioner=1<br>\nIf I read the text, I assume this is valid, since the logical id '1' happens to refer to only 1 resource, being Practitioner/1.</p>\n<p>Search nr2: /Patient?general-practitioner=2<br>\nI assume this should be rejected, since the logical id '2' refers to both Practitioner/2 and Organization/2. Even though Practioner/2 is never linked to.</p>\n<p>Search nr3: /Patient?general-practitioner.name=SomeCorp<br>\nThis does not involve a logical id, but is - within the above data - equivalent to Search nr2. Is it valid?</p>\n<p>Now I have a few problems:<br>\n1. The first search is valid, the second is not, but I could not tell the difference beforehand<br>\n2. The validity of search nr3 is not clear to me.<br>\n3. This is - at least in our implementation of Vonk - not very efficient, since this issue could happen some levels deep inside a chained search, and we do not execute all the subqueries separately.</p>\n<p>I would be in favour of a narrowing it further like this:<br>\n\"Some references are allowed to point to more than one type of resource; e.g. subject : Reference(Patient|Group|Device|..). In these cases, multiple resources may have the same logical identifier and thus Servers SHOULD reject a search if it does not specify the resourcetype (either in the url, or in the type modifier). If a client wished to search for more than one type, it can use the choice construct to do so.\"</p>",
        "id": 153913107,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1507552058
    },
    {
        "content": "<p>My 2 cents... nr2 should be legal. It is a search after all...</p>",
        "id": 153913279,
        "sender_full_name": "Jason Walonoski",
        "timestamp": 1507636407
    }
]