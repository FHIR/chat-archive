[
    {
        "content": "<p>CompartmentDefinition.code is restricted to Patient | Encounter | RelatedPerson | Practitioner | Device. Why is it not permitted to create a CompartmentDefinition for e.g. Location?</p>",
        "id": 153924735,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1513172277
    },
    {
        "content": "<p>And if the client does a request for /Organization within a Patient compartment, is the client authorized to get:<br>\n- all Organizations (since the compartment is not linked to Organization, so it does not restrict it)<br>\n- no Organizations (since the compartment is not linked to Organization, and you cannot query outside of it)?</p>\n<p>Obviously access to Organization could be restricted in another way (e.g. Smart scopes), but I see this decision apart from that.</p>",
        "id": 153924737,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1513172508
    },
    {
        "content": "<p>Compartments tie deeply into how query can work, so we don't want implementers going off and defining their own compartments - and particularly defining them differently.  If there's a use-case for a Location compartment, submit a change request.  I do agree that we should clarify expectations around querying for a resource within a compartment when that resource isn't defined as being part of the compartment.  Personally, I think this should be an error.  I think that's safest for forward compatibility reasons.  In any case, definitely submit a change proposal for us to clarify expectations.</p>",
        "id": 153924756,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1513180635
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\nI think it is not so uncommon to go beyond the bounderies of a compartment, e.g. for an _include:</p>\n<div class=\"codehilite\"><pre><span></span>[base]/Patient?_include=general-practitioner\n</pre></div>\n\n\n<p>where Practitioner nor Organization is in the patient CompartmentDefinition.<br>\nSo I agree, I'll make a change proposal for clarification.</p>",
        "id": 153925170,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1513253986
    },
    {
        "content": "<p><a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=75\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=75\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=75</a></p>",
        "id": 153925175,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1513254664
    },
    {
        "content": "<p>Look out for _revinclude on Compartments. I had to cater for this search on Compartments  to ensure the user did not get all Observations for all the Organizations they can access:  {{ServiceRootUrl}}/Patient/FCC-PAT-00001/Observation?_revinclude=Observation:performer</p>",
        "id": 153954751,
        "sender_full_name": "Angus Millar",
        "timestamp": 1524822835
    },
    {
        "content": "<p>I don't see the problem: Observation:performer has no Observation type as target, so think this _revInclude will not do anything. Or am I missing the point?</p>",
        "id": 153955618,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1525329024
    },
    {
        "content": "<p>Sorry <span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span> i ballsed that query up, I mean this query:<br>\n<code>[base]/Patient/[id]/Organization?_revinclude=DiagnosticReport:performer</code><br>\nDon't want a patient who can access all Organization to then be able to reinclude all Observations</p>",
        "id": 153955639,
        "sender_full_name": "Angus Millar",
        "timestamp": 1525342824
    },
    {
        "content": "<p>Actually, looking at this again, I can see it is not clear what it means to have a Resource listed as in the Compartment yet have no search parameters. Such as Organization in the Patient CompartmentDefinition opposed to a resource type that is not listed at all in the CompartmentDefinition? I had interpreted a Resource listed yet with no search parameters to infer that all instances are in the compartment, much like a general search query with no parameters and then a Resource not listed at all to mean no instances of that type are in the compartment.</p>",
        "id": 153955640,
        "sender_full_name": "Angus Millar",
        "timestamp": 1525343443
    },
    {
        "content": "<p>That is indeed not very clear, see <a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=0\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=0\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14332&amp;start=0</a></p>",
        "id": 153955675,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1525350104
    }
]