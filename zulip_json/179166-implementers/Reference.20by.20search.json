[
    {
        "content": "<p>Can a literal reference point to a search? I've seen this somewhere, but I don't think this is accepted. e.g.<br>\nPOST /Observation</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n<span class=\"err\">...</span>\n  <span class=\"nt\">\"subject\"</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">\"reference\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"Patient?identifier=xyz\"</span>\n  <span class=\"p\">}</span>\n<span class=\"err\">...</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 226374856,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613390236
    },
    {
        "content": "<p>The response would be a bundle.</p>",
        "id": 226377965,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1613392289
    },
    {
        "content": "<p>correct.</p>",
        "id": 226378562,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613392639
    },
    {
        "content": "<p>which is why i ask if this would make sense - i think not but maybe there is some section in the spec I've missed</p>",
        "id": 226378602,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613392661
    },
    {
        "content": "<p>No. Such conditional references may be used as  part of a conditional-create or conditional-update, but not as part of a literal reference. Use reference .identifier instead.</p>",
        "id": 226379047,
        "sender_full_name": "René Spronk",
        "timestamp": 1613392895
    },
    {
        "content": "<p>thank you</p>",
        "id": 226380868,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1613394071
    },
    {
        "content": "<p>This is legal as a conditional reference in a transaction bundle.</p>",
        "id": 226391353,
        "sender_full_name": "Paul Church",
        "timestamp": 1613399877
    },
    {
        "content": "<p>True \"Note, in addition, that a reference may be by identifier, and if it is, and there is no URL, it may be resolved by scanning the ids in the bundle. Note also that transactions may contain conditional references that must be resolved by the server before processing the matches. \"</p>",
        "id": 226391768,
        "sender_full_name": "René Spronk",
        "timestamp": 1613400110
    },
    {
        "content": "<p>Josh has a proposal out there to revamp <a href=\"http://build.fhir.org/bundle.html#references\">http://build.fhir.org/bundle.html#references</a> - referencing within bundles remains a tricky subject ...</p>",
        "id": 226391894,
        "sender_full_name": "René Spronk",
        "timestamp": 1613400173
    },
    {
        "content": "<p>So in HAPI we can post this resource</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"AllergyIntolerance\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"type\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"allergy\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"category\"</span> <span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"s2\">\"food\"</span>\n  <span class=\"p\">],</span>\n  <span class=\"nt\">\"code\"</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">\"text\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"Allergic to shrimp\"</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">\"patient\"</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">\"reference\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"Patient?identifier=https://www.ehealth.fgov.be/standards/fhir/NamingSystem/ssin|60102047165\"</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">\"recordedDate\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"2014-10-09T14:58:00+11:00\"</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 227413311,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614078494
    },
    {
        "content": "<p>should that  be allowed?</p>",
        "id": 227413358,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614078534
    },
    {
        "content": "<p>I don't think so, but perhaps I'm missing something</p>",
        "id": 227413417,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614078569
    },
    {
        "content": "<p>No, only if it's part of a transaction..</p>",
        "id": 227413572,
        "sender_full_name": "René Spronk",
        "timestamp": 1614078650
    },
    {
        "content": "<p>thank you. Should I submit an issue against HAPI?</p>",
        "id": 227416562,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614080192
    },
    {
        "content": "<p>It's not technically non-conformant to handle that on an individual call - there's just no expectation it would be handled.</p>",
        "id": 227440681,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614091384
    },
    {
        "content": "<p>Since this is equivalent to </p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"nt\">\"patient\"</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n  <span class=\"nt\">\"identifier\"</span> <span class=\"p\">:</span> <span class=\"p\">{</span>\n       <span class=\"nt\">\"value\"</span> <span class=\"p\">:</span> <span class=\"nt\">\"60102047165\"</span>\n       <span class=\"nt\">\"system\"</span> <span class=\"p\">:</span> <span class=\"s2\">\"https://www.ehealth.fgov.be/standards/fhir/NamingSystem/ssin\"</span>\n   <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I think it is not helpful to allow the search string in the reference....</p>",
        "id": 227460037,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614097864
    },
    {
        "content": "<p>It's not really the same.  In a transaction, there's an expectation that conditional references will be resolved - and that failure to resolve or resolution to more than one is an error.  On the other hand, specifying Reference.identifier imposes no such expectations.</p>",
        "id": 227461871,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614098482
    },
    {
        "content": "<p>Also, the example with an identifier is just one of the possible ways a conditional reference could be used.</p>",
        "id": 227461968,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614098523
    },
    {
        "content": "<p>I was referring to the observed behavior where there was no bundle. If there is no expectation that the search in the reference will result in any specific action, it seems to be equivalent to a logical reference...</p>",
        "id": 227473774,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614102815
    },
    {
        "content": "<p>In a transaction, search in the reference must be executed and resolved - or result in an error if not supported.  It won't be stored as the search.</p>",
        "id": 227496593,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614111473
    },
    {
        "content": "<p>My point is that when POSTing an individual resource, search in reference will not be executed and resolved, and it shall not be stored as the search. Is that incorrect? </p>\n<p>I am not arguing about transaction bundles.</p>",
        "id": 227498992,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614112485
    },
    {
        "content": "<p>If you POST a bare resource like that, you're non-conformant.  Server is free to reject, ignore the element, resolve or whatever it likes.</p>",
        "id": 227499087,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614112552
    },
    {
        "content": "<p>It seems to me that HAPI, being a reference implementation, should reject such a POST in order to alert the client that they are non-conformant.</p>",
        "id": 227509930,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614117211
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span></p>",
        "id": 227510924,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614117628
    },
    {
        "content": "<p>Resolving inline search expressions in references is an optional non-standard feature in HAPI FHIR that is disabled by default (but enabled on the public server)</p>",
        "id": 227520380,
        "sender_full_name": "James Agnew",
        "timestamp": 1614121427
    },
    {
        "content": "<p>Can you disable it on the public server <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> - people often use that to see what they can expect in production.</p>",
        "id": 227543534,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614138125
    },
    {
        "content": "<p>(and to test conformance)</p>",
        "id": 227543546,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1614138131
    },
    {
        "content": "<p>Yeah, I suppose we should.</p>",
        "id": 227579049,
        "sender_full_name": "James Agnew",
        "timestamp": 1614163366
    },
    {
        "content": "<p>thank you. Indeed, we used that to see what could be admissible</p>",
        "id": 227651893,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1614192757
    }
]