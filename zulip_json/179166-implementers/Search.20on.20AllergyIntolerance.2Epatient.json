[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> has picked up an issue in my server which is an an issue in the specification itself</p>",
        "id": 153966842,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163280
    },
    {
        "content": "<p>the symptom is that the search <a href=\"http://test.fhir.org/r3/AllergyIntolerance?patient=1\" target=\"_blank\" title=\"http://test.fhir.org/r3/AllergyIntolerance?patient=1\">http://test.fhir.org/r3/AllergyIntolerance?patient=1</a> returns an error which should be:</p>\n<div class=\"codehilite\"><pre><span></span>Parameter &quot;patient&quot; is invalid because the type of resource referenced is not specified\n</pre></div>",
        "id": 153966843,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163352
    },
    {
        "content": "<p>but if you check at <a href=\"http://hl7.org/fhir/STU3/allergyintolerance.html#search\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/allergyintolerance.html#search\">http://hl7.org/fhir/STU3/allergyintolerance.html#search</a> you'll see that patient is apparently only defined for the patient resource, and so that error is wrong.</p>",
        "id": 153966844,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163386
    },
    {
        "content": "<p>only... not so fast. if you look carefully, you'll see that it has 31 other resources using the common search parameter</p>",
        "id": 153966845,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163451
    },
    {
        "content": "<p>and if you hunt down the formal definition in the downloads - because this it is never published - you'll see that this search parameter has 2 target types: Patient and Group. Because some of the other resources allow group, even though AllergyIntolerance doesn't</p>",
        "id": 153966846,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163527
    },
    {
        "content": "<p>my server is actually implementing the underlying search parameter</p>",
        "id": 153966847,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528163539
    },
    {
        "content": "<p>so the question is, what does it mean when a resource shares the parameter, but has a lesser target type range?</p>",
        "id": 153966861,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528171193
    },
    {
        "content": "<p>Isn't that a mistake in the formal definitions? (I actually did notice it in our own auto-generated code and I programmed around it...)</p>",
        "id": 153967035,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1528204799
    },
    {
        "content": "<p>See also <a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13601\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13601\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13601</a></p>",
        "id": 153967036,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1528204804
    },
    {
        "content": "<p>Yes, this is the same issue</p>",
        "id": 153967039,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528206607
    },
    {
        "content": "<p>there's a mistake somewhere, but I'm not sure where it is.</p>",
        "id": 153967040,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528206625
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> - you drove this...?</p>",
        "id": 153967041,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528206633
    },
    {
        "content": "<p>related question -- is this property name going to be 'harmonized' to 'subject' like is done in other STU3 or newer resources?  ( <a href=\"https://www.hl7.org/fhir/encounter.html#tabs-diff\" target=\"_blank\" title=\"https://www.hl7.org/fhir/encounter.html#tabs-diff\">https://www.hl7.org/fhir/encounter.html#tabs-diff</a> )</p>",
        "id": 153967125,
        "sender_full_name": "John Silva",
        "timestamp": 1528219691
    },
    {
        "content": "<p>Our general rule is that if it's just patient, then it should be patient, where as it would be subject if it can be something other than patient (such as group)</p>",
        "id": 153967136,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528224379
    },
    {
        "content": "<p>Just added to the issue that it is also raised on nr. #15903. In Vonk we override this searchparameter with a corrected version of it that targets only Patient because we got this same question several times.</p>",
        "id": 153967143,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1528224942
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> - you drove this...?</p>\n</blockquote>\n<p>In what sense do you mean?  </p>\n<p>The background I have is this: We've found this because users of the .NET API reported it: <a href=\"https://github.com/ewoutkramer/fhir-net-api/issues/339\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/issues/339\">https://github.com/ewoutkramer/fhir-net-api/issues/339</a>, on 30 june 2017 I wrote</p>\n<p>\"I found the cause. No, it's not all of them. Some resources have their own defined parameter \"patient\", here the target is just \"Patient\". However, there is a searchparameter in the spec called \"clinical-patient\" that is defined for a number of resources, and which has both Patient and Group. This is the cause. It does not seem to make sense to me. I'll continue this discussion in Zulip....\"</p>\n<p>this is talking about the search parameters in \"search-parameters.xml\", a file that we use to generate the API. It has</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;target value=&quot;Patient&quot; /&gt;\n    &lt;target value=&quot;Group&quot; /&gt;\n</pre></div>\n\n\n<p>so, this seems to be the cause.</p>",
        "id": 153967384,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1528297367
    },
    {
        "content": "<p>you drove that the cross-research search parameters should be correctly defined</p>",
        "id": 153967530,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528314948
    },
    {
        "content": "<p>what I'm not sure about here is which way to resolve this:<br>\n- if the shared resource doesn't have all the target types on a particular resource to which it applies, then the target need not be specified<br>\n- a search parameter can't be shared across multiple resources in this case<br>\n- this search parameter is wrong because \"patient\" should never target \"Group\"</p>",
        "id": 153967532,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528315045
    },
    {
        "content": "<p>So, I am leaning to the third option - if we've noticed these parameters are actually \"the same\" across resources, we might ask a committee why they deviate. The result of this discussion might be a conclusion that either</p>\n<p>a)  the search parameter is not \"the same\", and should be renamed, so it is no longer shared<br>\nb) yes, it should be aligned, and the additional targets added or removed</p>\n<p>The second option is not possible I think - we consider adding a new reference type  a non-breaking change, but it would make a shared search parameter disappear - which is a breaking change.</p>\n<p>The first option would cause \"runtime\" errors: there would be no way to avoid causing errors by looking at just the definitions we provide, unless we would define a parameter with the same name both on the general resource and on the more specific resource where it deviates.  This adds complexity.</p>\n<p>I think we can get away with option 3 for now, as this might well be the only case.</p>",
        "id": 153967795,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1528360984
    },
    {
        "content": "<p>+1 for changing the definition of the \"patient\" search parameter to target only Patient</p>",
        "id": 153967854,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1528393745
    }
]