[
    {
        "content": "<p>What are implementers using for runtime validation for FHIR resource profile compliance? Are implementers using the HL7 FHIR Validator JAR at runtime, or using the validation included as part of HAPI?</p>\n<p>Interested to hear what folks are using, thanks!</p>",
        "id": 187088077,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1580480951
    },
    {
        "content": "<p>(in the context of runtime validation as messages are received, not for conformance testing)</p>",
        "id": 187088600,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1580481319
    },
    {
        "content": "<p>HAPI offers validation against profiles that can be used quite easily standalone or as part of a HAPI server:</p>\n<p><a href=\"https://hapifhir.io/hapi-fhir/docs/validation/introduction.html\" target=\"_blank\" title=\"https://hapifhir.io/hapi-fhir/docs/validation/introduction.html\">https://hapifhir.io/hapi-fhir/docs/validation/introduction.html</a></p>\n<p>The core Java validator can also be used without HAPI, see the comment starting on line 66 in this class:</p>\n<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java\">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java</a></p>",
        "id": 187092418,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1580484032
    },
    {
        "content": "<p>Is the hapi validator (with or without HAPI) intended to be used to support $validate operations, or is it designed/implemented for system performance in mind e.g. runtime validation on resources during production RESTful interactions?</p>",
        "id": 187102128,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1580490301
    },
    {
        "content": "<p>I'm not sure what you mean by 'designed with system performance in mind'. It's designed to validate, and it does as thorough a job as it knows how to. </p>\n<p>Most of the performance issues involve 4 things:</p>\n<ul>\n<li>where's the terminology server, and how fast is it?</li>\n<li>how do you manage the cache of conformance resources the validator uses?</li>\n<li>how do you look up other resources (transaction boundaries!)</li>\n<li>how much validation do you actually want to do?</li>\n</ul>\n<p>The more profiles involved, and the more constraints involved in the profiles, the slower profile processing is.</p>\n<p>When you host the validator in HAPI, you make the choices for the first 3 (to some degree). We could consider changes on the last.</p>",
        "id": 187114262,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580498234
    },
    {
        "content": "<p>however, generally, my focus is on complete validation over fast validation. The main internal thing I could do to speed things up is parallelization, or to keep validating the instance while some other thread is off doing the terminology stuff. But when it comes to slicing, I need to wait for terminology validation anyway, and also if the terminology server is close and fast, all I'm doing it introducing threading bugs....</p>",
        "id": 187114442,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580498348
    },
    {
        "content": "<p>Thanks Graham, maybe I'm not being clear enough with the question.</p>\n<p>Are implementers using the validator as part of pre-processing HTTP Create requests, to check for errors/etc? Or are they using some other sort of validation, e.g. JSON Schema validator or some bespoke validation code?</p>",
        "id": 187116404,
        "sender_full_name": "Ken Sinn",
        "timestamp": 1580499663
    },
    {
        "content": "<p>some are, some aren't - I've run into people using schema</p>",
        "id": 187117558,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580500430
    },
    {
        "content": "<p>by recommendation in practice is: in general, only run the business rules that you need to protect the system. These are typically different from validation things anyway.</p>\n<p>but that advice depends on the trading environment. A server that is relatively public needs to at least always run the security relevant validation features. I should make it possible to run just the security relevant features of the validator...</p>",
        "id": 187117845,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580500570
    },
    {
        "content": "<p>I know of one that's using it for messaging in production.</p>",
        "id": 187130637,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1580510313
    },
    {
        "content": "<p>I've used it. I'm intending to fully validate on test instances but on live, I may not validate terminology - performance of core validation is good.</p>",
        "id": 187166315,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1580571936
    },
    {
        "content": "<p>Hi guys, I understand that there is a 'validator' and that is something that is advised to use.  What if our code is not Java based?  We have an application that is running on Node.js (TypeScript app) and we need to validate the FHIR resources that are coming in.  So what what we have done is use a fhir-json-schema-validator to validate against the R4 JSON schema that we pulled down form <a href=\"http://hl7.org\" target=\"_blank\" title=\"http://hl7.org\">hl7.org</a> site, but are struggling to find a library or a method to validate against StructureDefinition that is defined in our implementation guide (SIMPLIFIER).  We were able to export a StructureDefinition resource in JSON format from SIMPLIFIER, but it is not a JSON schema that we can use to validate against.  Are there tools that would allow us to convert the StructureDefinition resource into a standard JSON schema that we could just use a json-schema-validator for?  Or are there standard/approved fhir libraries for Node.js/TypeScript that we could use to validate against our implementation guide specifications?</p>",
        "id": 187374177,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1580834037
    },
    {
        "content": "<p>you can host the validator inside your node code if you need to.</p>\n<p>the structure definitions can say (and often do) things that can't be stated in json schema at all, and very often when I push json schema I find that the tools are not consistent.</p>",
        "id": 187403103,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580852193
    },
    {
        "content": "<p>there's been some talk about a javascript validator, but it's a very large amount of work, so I don't think it's really happened</p>",
        "id": 187403143,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580852224
    },
    {
        "content": "<p>if you want to host the validator, we can talk about how to do that (JNI + NativeHostServices.java)</p>",
        "id": 187403181,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580852250
    },
    {
        "content": "<p>Thanks Grahame, we thought about hosting the validator as a service, but that would add a lot more to the performance of the application.  Do you have a different way of hosting it so that it doesn't have this type of performance impact?<br>\nAlso, about the tool that you are talking about that you run against the structure definition.  If our implementation Guide is not that complicated, can we run it and see if it covers everything?  Could we use it?</p>",
        "id": 187409562,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1580857308
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"246465\">@Arthur Krughkov</span>, you could also set up a FHIR server like Vonk based on the resources in you <a href=\"http://Simplifier.net\" target=\"_blank\" title=\"http://Simplifier.net\">Simplifier.net</a> project (<a href=\"http://docs.simplifier.net/vonk/features/conformanceresources.html#conformance-fromsimplifier\" target=\"_blank\" title=\"http://docs.simplifier.net/vonk/features/conformanceresources.html#conformance-fromsimplifier\">http://docs.simplifier.net/vonk/features/conformanceresources.html#conformance-fromsimplifier</a>) and validate your data against the server with the <code>$validate</code> endpoint (<a href=\"http://docs.simplifier.net/vonk/features/validation.html\" target=\"_blank\" title=\"http://docs.simplifier.net/vonk/features/validation.html\">http://docs.simplifier.net/vonk/features/validation.html</a>). Keeps it nicely separated from the rest of your code and offloads the validation to a separate server. Would that work?</p>",
        "id": 187425268,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1580878015
    },
    {
        "content": "<p>Hi Weistra, I see that working for development or for testing purposes, but for runtime I am trying to optimize the performance as much as possible.  The most efficient way that I see possible is to use a light weight/native libraries to do schema validation (please let me know if there are other ways that I may not be thinking of).  So I can see this option work along the side of runtime validation:</p>\n<ol>\n<li>setup a FHIR resource in Simplifier and expose $validate endpoint</li>\n<li>since our StructureDefinition is derived from base R4 FHIR schema,  use a tool (from <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?) to generate a custom JSON schema</li>\n<li>manually verify and run tests to validate our own FHIR JSON schema</li>\n<li>at runtime  use JSON schema validation class to validate against:<br>\n     2a. R4 JSON FHIR schema from <a href=\"http://hl7.org\" target=\"_blank\" title=\"http://hl7.org\">hl7.org</a><br>\n     2b. Our custom schema</li>\n</ol>",
        "id": 187449522,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1580906472
    },
    {
        "content": "<p>you can also set up a HAPI Server much close to your system and get it to do the validation must faster. Or you can host the java validator inside your project too. </p>\n<p>Or yes, it's true I have code that generates json schema from structure definitions. It has to drop a lot of nuance etc to do so, so it's a much less effective schema validation tool. And, btw, I challenge the nation that the json schema engines are lighterweight than the FHIR specific validator</p>",
        "id": 187451668,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580908391
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> its good to hear that you think that the FHIR validator is just as quick if not quicker than a JS schema validator.  We are using @asymmetrik/fhir-json-schema-validator, which is built on ajv (Currently Ajv is the fastest and the most standard compliant JS validator - according to a set of benchmarks) ... are there any performance metrics or details on the Java Validator? (I haven't looked at how to run Java Validator on my Node.JS server as of yet)</p>\n<p>So if that is true and using the ajv based schema validator is just as quick as FHIR validator, which of the following is a better/quicker:</p>\n<ol>\n<li>HAPI FHIR server with a $validate endpoint</li>\n<li>Vonk FHIR server with a $validate endpoint (as per Ward's suggestion)</li>\n</ol>\n<p>Outside of performance, is one validator more complete than the other?</p>\n<p>I'm open to all solutions, as long as I can meet my performance requirements :)</p>",
        "id": 187469175,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1580920034
    },
    {
        "content": "<p>I haven't done metrics, and I don't know about 'quicker'. So I'm not making promises. But also, the validator is much more thorough than json schema; in particular, it gets the terminology correct in way that schema can't. </p>\n<p>but that also takes a performance hit - validating terminology is slow compared to anything else, so people sometimes turn that off - but therefore if json schema doesn't do it, it won't take that hit. </p>\n<p>As for which of the local servers is faster - vonk or hapi... I've not seen any comparison and haven't tested it. Nor can I comment on which validator is more thorough with authority, though I can tell you that it looks like the dotnet validator has 6 test cases, while the java validator has 248 test cases</p>",
        "id": 187486249,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1580930975
    },
    {
        "content": "<p>The other dimension here is the level of Terminology support available to the validator.  Ontoserver provides a $validate endpoint and very complete terminology support including for SNOMED CT with ECL.  Under the hood, the core validation code is the same as that for HAPI, except for terminology.</p>",
        "id": 187499869,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1580940221
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> are you saying that HAPI FHIR validator does not have a complete terminology support and the <a href=\"http://hl7.com/fhir/validator\" target=\"_blank\" title=\"http://hl7.com/fhir/validator\">hl7.com/fhir/validator</a> does have full terminology support?</p>",
        "id": 187859857,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1581369950
    },
    {
        "content": "<p>I'm not up to date on the current state of HAPI's support as there were major improvements in either 4.0 or 4.1 IIRC.</p>\n<p>However, I'm fairly certain that neither service has support for Snomed's ECL (which gets a lot of use in Australia).</p>\n<p>Other common \"edge cases\" in terminology servers that I'm aware of include:</p>\n<p>*   Snomed postcoordination<br>\n  *   Infinite code systems (eg UCUM)<br>\n  *   Display Language support<br>\n  *   CodeSystem supplement support<br>\n  *   Versioning<br>\n  *   Dynamic ValueSets<br>\n  *   Implicit ValueSets for various CodeSystem (LOINC, Snomed, )</p>\n<p>Sent from my iPhone</p>",
        "id": 187861297,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1581370810
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , I have been looking into more details today and found a Node library to use <a href=\"https://github.com/joeferner/node-java\" target=\"_blank\" title=\"https://github.com/joeferner/node-java\">https://github.com/joeferner/node-java</a>.  Essentially I will have to create, host, and manage a JVM and from reading the <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java\">https://github.com/hapifhir/org.hl7.fhir.core/blob/master/org.hl7.fhir.validation/src/main/java/org/hl7/fhir/r5/validation/NativeHostServices.java</a> , it states that \"this solutions uses lots of RAM\".   If this is the only way for me to embed the validator in my code then we may need to run some tests and see if its worth doing it vs validation against a JSON schema.<br>\nMeanwhile, has anyone else asked about the conversion tool that you use to convert the StructureDefinition into a JSON schema?  The reason I am asking is that I see the benefit of both applications.  For data submission, I would want to make sure that there is more validation done to ensure that we have minimal data issues (and use the validator); but for cases where I may be building and just storing the data temporary (such as CMS), I would want to pay more attention to performance and stability (hence use JSON Schema validation only).</p>",
        "id": 187862285,
        "sender_full_name": "Arthur Krughkov",
        "timestamp": 1581371476
    },
    {
        "content": "<p>so I have code that converts profiles to json schemas. But so little of the things people do in real profiles can be done in JSON schema:</p>\n<ul>\n<li>invariants</li>\n<li>value set bindings</li>\n<li>slicing by those (or by profile on a reference)</li>\n</ul>",
        "id": 187867062,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374879
    },
    {
        "content": "<p>these are core things that profiles do.</p>",
        "id": 187867107,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374890
    },
    {
        "content": "<p>the validator does all these things. If I try to generate JSON schema I have to strip all these things out, and all I get left with is a few cardinality constraints. It barely seems worthwhile to me</p>",
        "id": 187867146,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374934
    },
    {
        "content": "<p>just use the base json schemas. If they work, that is. My experience with json schema tooling is that they are very unreliable for the kind of schemas that we produce</p>",
        "id": 187867180,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581374969
    },
    {
        "content": "<p>I did write that 'this uses lots of RAM'. \"lots\" is a relative term; you'd have to try it out and see.</p>",
        "id": 187867295,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1581375058
    },
    {
        "content": "<p>is that json schema generator available? I have some RAM left, can I give it a try? <br>\n(and I want to see if we can generate json schemas for our profiles, to see if it is worth the effort)</p>",
        "id": 188551801,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1582124579
    },
    {
        "content": "<p>I'm sure I remember writing something that collapsed slicing out - for this purpose. but I can't find it now</p>",
        "id": 188600123,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582158189
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/HL7.20Validator.20for.20Runtime.20Validation/near/187867062\" title=\"#narrow/stream/179166-implementers/topic/HL7.20Validator.20for.20Runtime.20Validation/near/187867062\">said</a>:</p>\n<blockquote>\n<p>so I have code that converts profiles to json schemas. But so little of the things people do in real profiles can be done in JSON schema:</p>\n<ul>\n<li>invariants</li>\n<li>value set bindings</li>\n<li>slicing by those (or by profile on a reference)</li>\n</ul>\n</blockquote>\n<p>Is this the code that generates <a href=\"https://www.hl7.org/fhir/fhir.schema.json.zip\" target=\"_blank\" title=\"https://www.hl7.org/fhir/fhir.schema.json.zip\">https://www.hl7.org/fhir/fhir.schema.json.zip</a> ? If so, is it available somewhere?</p>",
        "id": 188942700,
        "sender_full_name": "Misha Kaletsky",
        "timestamp": 1582562416
    },
    {
        "content": "<p>yes org.hl7.fhir.definitions.generators.specification.json.SchemaGenerator</p>",
        "id": 188960220,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1582574332
    }
]