[
    {
        "content": "<p>Аccording to Fhir R4 and earlier versions, for the Conditional Create operation, we shoud use the If-None-Exist header with search parameters. However, non-ASCII characters are prohibited by RFC7230 in header values, see <a href=\"https://tools.ietf.org/html/rfc7230#section-3.2.4\">https://tools.ietf.org/html/rfc7230#section-3.2.4</a> So, conditional create with non-ascii parameters like 'name=Грайм' won't work. We avoid this by using batch/transaction, but it is not convenient for creating single resource. I propose in future versions of standart to abandon the use of the header and use query params in urls as well as conditional delete and update. Another approach is to use base64string encoding in If-None-Exist header.</p>",
        "id": 208871198,
        "sender_full_name": "Aleksandr Sorokin",
        "timestamp": 1599073085
    },
    {
        "content": "<p>Use a transaction?</p>",
        "id": 208875735,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599075095
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191912\">Michele Mottini</span> <a href=\"#narrow/stream/179166-implementers/topic/If-None-Exist.20header.20and.20non-ASCI.20search.20params/near/208875735\">said</a>:</p>\n<blockquote>\n<p>Use a transaction?</p>\n</blockquote>\n<p><a href=\"https://www.hl7.org/fhir/http.html#transaction\">https://www.hl7.org/fhir/http.html#transaction</a></p>",
        "id": 208875984,
        "sender_full_name": "Aleksandr Sorokin",
        "timestamp": 1599075211
    },
    {
        "content": "<p>Yes, that. <code>If-None-Exist</code> will be inside the bundle, no longer in the header, so without limitations in the character set I guess</p>",
        "id": 208876471,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599075433
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191912\">Michele Mottini</span> <a href=\"#narrow/stream/179166-implementers/topic/If-None-Exist.20header.20and.20non-ASCI.20search.20params/near/208876471\">said</a>:</p>\n<blockquote>\n<p>Yes, that. <code>If-None-Exist</code> will be inside the bundle, no longer in the header, so without limitations in the character set I guess</p>\n</blockquote>\n<p>Did you read the full message?<br>\nWe already avoid this by using transaction, but it is not convenient for creating single resource</p>",
        "id": 208877174,
        "sender_full_name": "Aleksandr Sorokin",
        "timestamp": 1599075773
    },
    {
        "content": "<blockquote>\n<p>non-ASCII characters are prohibited in header values</p>\n</blockquote>\n<p>we certainly overlooked that. :-(</p>",
        "id": 208880697,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1599077462
    },
    {
        "content": "<p>no we didn't. you can URL encode in the headers, like in the URL</p>",
        "id": 208880899,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1599077549
    },
    {
        "content": "<blockquote>\n<p>Did you read the full message?</p>\n</blockquote>\n<p>Clearly I didn't !</p>",
        "id": 208881765,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1599077990
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/If-None-Exist.20header.20and.20non-ASCI.20search.20params/near/208880899\">said</a>:</p>\n<blockquote>\n<p>no we didn't. you can URL encode in the headers, like in the URL</p>\n</blockquote>\n<p>ok, but what are the advantages of using custom header for conditional create?<br>\nwhy can't it be done the same everywhere?</p>",
        "id": 208900680,
        "sender_full_name": "Aleksandr Sorokin",
        "timestamp": 1599088559
    },
    {
        "content": "<p>I think the point is that it's not custom; it's a standard header.</p>",
        "id": 208901197,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599088931
    },
    {
        "content": "<p>In practice I don't know how important this is :-)</p>",
        "id": 208901231,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599088955
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/179166-implementers/topic/If-None-Exist.20header.20and.20non-ASCI.20search.20params/near/208901197\">said</a>:</p>\n<blockquote>\n<p>I think the point is that it's not custom; it's a standard header.</p>\n</blockquote>\n<p>Really? Of course it's standard header because it's defined by fhir standard :)<br>\nDue to docs <a href=\"https://www.hl7.org/fhir/http.html#ccreate\">https://www.hl7.org/fhir/http.html#ccreate</a><br>\n HL7 defined extension header \"If-None-Exist\"</p>",
        "id": 208901797,
        "sender_full_name": "Aleksandr Sorokin",
        "timestamp": 1599089371
    },
    {
        "content": "<p>I don't recall whether we discussed using a URL parameter instead</p>",
        "id": 208932224,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1599119882
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196269\">@Aleksandr Sorokin</span>  you're totally right -- I was thinking about If-None-Match, etc, the etag-based conditionals (<a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Conditional_requests</a>).  I do think there's benefit in parallelism here, but you're right then we're still inventing something.</p>",
        "id": 208965063,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1599139196
    }
]