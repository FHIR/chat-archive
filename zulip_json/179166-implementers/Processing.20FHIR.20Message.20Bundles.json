[
    {
        "content": "<p>I have created a specification for messaging child health data around our healthcare system. The specification tells an implementer how to format a message bundle, and how to send it to a recipient. I think I'm OK explaining how to format the message bundle (creating the resources and reference links etc.). What I'm less sure about is explaining how a recipient might process the message bundle - given that the references will point in directions in accordance to the FHIR spec (an Encounter can reference (point to) a HealthcareService, but Observations, Procedures etc. all point back to the Encounter. Does anyone have some clear literature on how a novice to FHIR might go about writing code to process a FHIR message bundle?Processing FHIR Message Bundle</p>",
        "id": 154026900,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1545387652
    },
    {
        "content": "<p><a href=\"http://build.fhir.org/documentation.html\" target=\"_blank\" title=\"http://build.fhir.org/documentation.html\">http://build.fhir.org/documentation.html</a></p>",
        "id": 154026912,
        "sender_full_name": "John Moehrke",
        "timestamp": 1545399964
    },
    {
        "content": "<p>The Bundle resource definition page is the place to start. There is a section there on resolving references in a Bundle, which is a key part of processing them.  <a href=\"http://build.fhir.org/bundle.html#references\" target=\"_blank\" title=\"http://build.fhir.org/bundle.html#references\">http://build.fhir.org/bundle.html#references</a>   -  It can be tricky depending on what you are doing. If the processing system is assigning it's own resource IDs you have to work out the dependency order in the bundle so you persist the resources in the correct order so you can update the references properly.</p>",
        "id": 154026951,
        "sender_full_name": "Craig McClendon",
        "timestamp": 1545410595
    },
    {
        "content": "<p>I have been trying to process a MessageBundle by reading it after it has been posted on a HAPI server.</p>\n<p>But the reference resolution is not happning for \"Practitioner/598af951-66e4-4910-a964-7e41533b183c\" in the Bundle.</p>\n<p>Below is the paste link to the bundle.</p>\n<p><a href=\"https://pastebin.com/xrAZJCMV\" target=\"_blank\" title=\"https://pastebin.com/xrAZJCMV\">https://pastebin.com/xrAZJCMV</a></p>\n<p>I have tried validating it against the validate operation on HAPI Server 3.5.0</p>\n<p>Also I have the fhir validator jar results below.</p>\n<div class=\"codehilite\"><pre><span></span>rguments: ./instances/Referral-A.xml -version 3.0\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1-null)\n  .. validate [./instances/Referral-A.xml]\nTerminology server: Check for supported code systems for https://www.hl7.org/fhir/valueset-message-events.html\nException in thread &quot;main&quot; java.lang.Error: Not done yet - resolve Practitioner/598af951-66e4-4910-a964-7e41533b183c locally\n    at org.hl7.fhir.r4.validation.InstanceValidator$ValidatorHostServices.resolveReference(InstanceValidator.java:198)\n    at org.hl7.fhir.r4.utils.FHIRPathEngine.funcResolve(FHIRPathEngine.java:3058)\n    at org.hl7.fhir.r4.utils.FHIRPathEngine.evaluateFunction(FHIRPathEngine.java:2520)\n</pre></div>\n\n\n<p>Any ideas ? <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span></p>",
        "id": 155284578,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1547669954
    },
    {
        "content": "<p>I think your syntax needs to be <br>\n&lt;reference value=\"urn:uuid:ffa2bf53-ee09-43a1-b11a-73ed0f1cd73b\"/&gt;<br>\n instead of <br>\n&lt;reference value=\"PractitionerRole/ffa2bf53-ee09-43a1-b11a-73ed0f1cd73b\"/&gt;</p>",
        "id": 155294926,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547678484
    },
    {
        "content": "<p>Both syntaxes should work.  In looking at the instance, everything seems like it should work.  Double-check that you're using the most recent validator from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">http://build.fhir.org</a>.  If you are, then please submit a change request and attach your instance and point to this zulip thread.</p>",
        "id": 155295017,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1547678575
    },
    {
        "content": "<p>I think Simone is correct. The reference is Practitioner/598af951-66e4-4910-a964-7e41533b183c</p>\n<p>But the entry has this:</p>\n<p>&lt;fullUrl value=\"urn:uuid:598af951-66e4-4910-a964-7e41533b183c\"/&gt;</p>",
        "id": 155295230,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1547678772
    },
    {
        "content": "<p>it should look like this:<br>\n<a href=\"/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/QryX-VuZ0E-QvCLiWTSb0oED/pasted_image.png\"></a></div>",
        "id": 155295235,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547678780
    },
    {
        "content": "<p>Reference needs to become urn:uuid:598af951-66e4-4910-a964-7e41533b183c, or the fullUrl needs to become \"<a href=\"http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c\" target=\"_blank\" title=\"http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c\">http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c</a></p>",
        "id": 155295292,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1547678878
    },
    {
        "content": "<p>If the format is Practitoner/x, that means you're doing a local reference - which means you take the base URL of the referencing resource and use it as the base for the referenced URL.  The base of the referencing resource is urn:uuid:, so the two expressions should be equivalent.  If changing the reference style works, that's fine, but it's still a bug if the validator doesn't support both.  I'm pretty sure it used to...</p>",
        "id": 155295480,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1547679018
    },
    {
        "content": "<p>Quote from <a href=\"http://hl7.org/implement/standards/fhir/bundle.html#reference\" target=\"_blank\" title=\"http://hl7.org/implement/standards/fhir/bundle.html#reference\">http://hl7.org/implement/standards/fhir/bundle.html#reference</a></p>\n<blockquote>\n<p>How to resolve a reference in a Bundle:</p>\n<p>If the reference is not an absolute reference, convert it to an absolute URL:<br>\nif the reference has the format [type]/[id], and<br>\nif the fullUrl for the bundle entry containing the resource is a RESTful one (see the RESTful URL regex)<br>\nextract the [root] from the fullUrl, and append the reference (type/id) to it<br>\nthen try to resolve within the bundle as for a RESTful URL reference.<br>\nIf no resolution is possible, then the reference has no defined meaning within this specification<br>\nelse no resolution is possible and the reference has no defined meaning within this specification<br>\nelse<br>\nLook for an entry with a fullUrl that matches the URI in the reference<br>\nif no match is found, and the URI is a URL that can be resolved (e.g. if an http: URL), try accessing it directly)</p>\n</blockquote>",
        "id": 155295632,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547679163
    },
    {
        "content": "<p>Since the condition \"if the reference has the format [type]/[id] <em>and</em> if the fullUrl for the bundle entry containing the resource is a RESTful one\"  is a \"no\" because \"urn:uuid\" doesn't match the RESTFul pattern, we're in the \"else\" branch:<br>\n\"Look for an entry with a fullUrl that <em>matches</em> the URI in the reference\"</p>",
        "id": 155295716,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547679248
    },
    {
        "content": "<p>I read that as \"matches exactly\"...</p>",
        "id": 155295726,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547679262
    },
    {
        "content": "<p>Though the spec could be a bit more verbose about this :)</p>",
        "id": 155295869,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547679429
    },
    {
        "content": "<p>Think of the reverse. Let say I have this reference:<br>\n&lt;reference value=\"urn:uuid:598af951-66e4-4910-a964-7e41533b183c\"/&gt;</p>\n<p>And two fullUrls with the following:</p>\n<p>&lt;fullUrl value=\"http://SOME-FHIR-ENDPOINT/Practitioner/598af951-66e4-4910-a964-7e41533b183c\"/&gt;<br>\n&lt;fullUrl value=\"http://SOME-FHIR-ENDPOINT/Encounter/598af951-66e4-4910-a964-7e41533b183c\"/&gt;</p>\n<p>These are both valid, but which does the reference resolve too? You can't mix the urn format with the RESTful</p>",
        "id": 155296017,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1547679553
    },
    {
        "content": "<p>I think this is not the point of <strong>uu</strong>ids :D</p>",
        "id": 155296174,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1547679679
    },
    {
        "content": "<p>I am going to give what <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> suggested and will report back.<br>\n<span class=\"user-mention\" data-user-id=\"191813\">@ArunSrinivasan</span> <span class=\"user-mention\" data-user-id=\"196402\">@AbdulMalik Shakir</span> <span class=\"user-mention\" data-user-id=\"195048\">@John Loonsk</span> <span class=\"user-mention\" data-user-id=\"194273\">@Marcelo caldas</span></p>",
        "id": 155341828,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1547737604
    },
    {
        "content": "<p>Following are my observations.<br>\n1. The urn:uuid in references passes $validate operation on the Bundle on HAPI 3.5.0 Server (SUCCESS)<br>\n2. It passes the HAPI Client 3.6.0 to parse and resolve references for processing (SUCCESS)<br>\n3. It fails the Hl7 Validation jar validation from the latest build on <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> (see results below) (ERROR)</p>\n<p>Here is the latest paste with urn:uuid in references.<br>\n<a href=\"https://pastebin.com/JH2QEs6z\" target=\"_blank\" title=\"https://pastebin.com/JH2QEs6z\">https://pastebin.com/JH2QEs6z</a></p>\n<div class=\"codehilite\"><pre><span></span>Arguments: ./instances/Referral-A.xml -version 3.0\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1-null)\n  .. validate [./instances/Referral-A.xml]\nTerminology server: Check for supported code systems for https://www.hl7.org/fhir/valueset-message-events.html\nException in thread &quot;main&quot; java.lang.Error: Not done yet - resolve urn:uuid:598af951-66e4-4910-a964-7e41533b183c locally\n    at org.hl7.fhir.r4.validation.InstanceValidator$ValidatorHostServices.resolveReference(InstanceValidator.java:198)\n</pre></div>\n\n\n<p>1 and 2 above are what I need right now to do what I am doing for HIMSS Interp Showcase. But I will post my notes with this sample as <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  suggested .</p>",
        "id": 155345222,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1547739949
    },
    {
        "content": "<p>Are you using the current validator from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a>?</p>",
        "id": 155348001,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1547741905
    },
    {
        "content": "<p>I am using the one from here <a href=\"http://build.fhir.org/validator.zip\" target=\"_blank\" title=\"http://build.fhir.org/validator.zip\">http://build.fhir.org/validator.zip</a></p>",
        "id": 155357389,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1547750052
    },
    {
        "content": "<p>Please submit a tracker item</p>",
        "id": 155359097,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1547751402
    }
]