[
    {
        "content": "<p>Should FHIRPath work on complex extensions?</p>\n<p>Have this extension <a href=\"https://simplifier.net/ukdigitalmedicine/extension-dm-controlleddrug\">https://simplifier.net/ukdigitalmedicine/extension-dm-controlleddrug</a> used by MedicationRequest.<br>\nbelieve the expression would be in the profile not the extension.</p>\n<p>What I want to say is:<br>\nis schedule is A or B then controlledDrugs words must not be null.</p>\n<p>Something like this </p>\n<p>((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='quantityWords').exists())</p>\n<p>This bit works but not having much luck checking for codes.</p>",
        "id": 243374362,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624278365
    },
    {
        "content": "<p>checking for codes?</p>",
        "id": 243378530,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624280703
    },
    {
        "content": "<p>Yes something like <br>\n((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='schedule').<strong>valueCoding.code='CD2')</strong></p>",
        "id": 243383140,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624282769
    },
    {
        "content": "<p>don't you need a where at the end? What are you trying to achieve?</p>",
        "id": 243384481,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624283349
    },
    {
        "content": "<p>To check the code is equal to CD2 &lt;- not working<br>\nand then check another extension is present &lt;- works</p>\n<p>Have tried a few combinations with where at the end but they always come back as true (in fhirpath tester)</p>",
        "id": 243389516,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624285415
    },
    {
        "content": "<p>E.g. this always comes back as true </p>\n<p>((extension.where(url = 'https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug')).extension.where(url='schedule')).valueCoding.where(code='CD2')</p>",
        "id": 243389926,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624285590
    },
    {
        "content": "<div class=\"codehilite\" data-code-language=\"XML\"><pre><span></span><code>  <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"https://fhir.nhs.uk/StructureDefinition/Extension-DM-ControlledDrug\"</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">\"schedule\"</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;valueCoding&gt;</span>\n        <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">\"https://fhir.nhs.uk/CodeSystem/medicationrequest-controlled-drug\"</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">\"CD2 not true\"</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">\"Schedule 2\"</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/valueCoding&gt;</span>\n    <span class=\"nt\">&lt;/extension&gt;</span>\n  <span class=\"nt\">&lt;/extension&gt;</span>\n</code></pre></div>",
        "id": 243390136,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624285674
    },
    {
        "content": "<p>Shouldn't that be <code>value.code</code>, not <code>valueCoding.code</code></p>",
        "id": 243450503,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624313929
    },
    {
        "content": "<p>Ah ha..... all is now clear. Many thanks</p>",
        "id": 243481545,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624347681
    },
    {
        "content": "<p>Validated fine also.... noticed a difference in behavior between fhirpath tester and FHIR Validation<br>\nfhirPath evaluates <br>\nexpr1 or or expr2<br>\nbut for fhir validation (hapi)  this needs to be changed to <br>\n(expr1 or or expr2)<br>\nopening and closing brackets.</p>",
        "id": 243488831,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624352533
    },
    {
        "content": "<p>that doesn't make sense</p>",
        "id": 243496510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624357497
    },
    {
        "content": "<p>which one my comment or fhirtester?</p>",
        "id": 243497616,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624358299
    },
    {
        "content": "<p>that you need the brackets</p>",
        "id": 243497638,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624358336
    },
    {
        "content": "<p>ah ok</p>",
        "id": 243497706,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624358392
    },
    {
        "content": "<p>Also note that there is a shortcut syntax for extensions so </p>\n<div class=\"codehilite\"><pre><span></span><code>extension.where(url=&#39;schedule&#39;)\n</code></pre></div>\n<p>can be written as </p>\n<div class=\"codehilite\"><pre><span></span><code>extension(&#39;schedule&#39;)\n</code></pre></div>",
        "id": 243610627,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624428892
    },
    {
        "content": "<p>Does hapi use same fhirpath library. I seem to be having problems on extensions.</p>",
        "id": 243772792,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624535256
    },
    {
        "content": "<p>same as what?</p>",
        "id": 243773559,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624535727
    },
    {
        "content": "<p>Same as the one used in FHIRPath Tester.</p>\n<p>Presuming its different as extensions test ok in but fail in HAPI</p>",
        "id": 243774096,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624536011
    },
    {
        "content": "<p>I don't know what the FHIR Path tester is, but the HAPI one is the one used in the validator. What expression doesn't work? Add it to the FHIRPath test cases at <a href=\"https://github.com/FHIR/fhir-test-cases/blob/master/r5/fhirpath/tests-fhir-r5.xml\">https://github.com/FHIR/fhir-test-cases/blob/master/r5/fhirpath/tests-fhir-r5.xml</a></p>",
        "id": 243774329,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1624536137
    },
    {
        "content": "<p>argh! Spotted an error - deleted</p>",
        "id": 243775551,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624536771
    },
    {
        "content": "<p>Many thanks. <br>\nThe test scripts were very useful. <br>\nProblem was with the FHIRPathTester behaving differently to hapi. </p>\n<p>if an extension dosen't exist FHIRTester would true  for this expression</p>\n<p>(extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.reference.exists() or extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').value.system.exists())</p>\n<p>hapi would return false. Solution was to add check for existence</p>\n<p>or extension('https://fhir.nhs.uk/StructureDefinition/Extension-DM-ResponsiblePractitioner').exists().not() </p>\n<p>hapi version seems to make more sense.</p>",
        "id": 243817819,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624555059
    },
    {
        "content": "<p>As an extract, or as a validate? FhirPathTester does both ways.</p>",
        "id": 243867252,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624585389
    },
    {
        "content": "<p>I put that expression into fptester here and it returns false - interesting.</p>",
        "id": 243867311,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624585464
    },
    {
        "content": "<p>Is the latest version on windows store? It was a couple of years old.</p>",
        "id": 243872743,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1624592599
    },
    {
        "content": "<p>Yes the one on the windows store is current.<br>\n(as at 4.0.0 - don't think I updated it for 4.0.1 as yet)</p>",
        "id": 243872898,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624592833
    },
    {
        "content": "<p>(But is on my list of things to do - need a local build of the fhir client, not the nuget ones due to an appstore limitation on reflection/emit - or at least did for the 1.4 libs)</p>",
        "id": 243872955,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1624592924
    }
]