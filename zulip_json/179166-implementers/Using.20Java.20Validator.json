[
    {
        "content": "<p>Hello all,<br>\nI was trying to use java-validator to validate profiles. I found an existing one here, <a href=\"https://www.hl7.org/fhir/uslab/uslab-patient.profile.xml.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/uslab/uslab-patient.profile.xml.html\">https://www.hl7.org/fhir/uslab/uslab-patient.profile.xml.html</a> and an example patient for this profile <a href=\"https://www.hl7.org/fhir/uslab/patient-uslab-example1.xml.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/uslab/patient-uslab-example1.xml.html\">https://www.hl7.org/fhir/uslab/patient-uslab-example1.xml.html</a>. I downloaded the java-validator and FHIR Definitions as xml from downloads page.</p>\n<p>I am running it as below</p>\n<p><code>java -jar org.hl7.fhir.validator.jar example_us_lab_patient.xml -defn validation-min.xml.zip -profile patient-us-lab.profile.xml</code></p>\n<p>below is the result </p>\n<p><code>Validating valid_patient_with_mandatory_fields.xml: 2 messages\nERROR @ /f:Patient/f:extension[1] (line 3, col505) Element is unknown or does not match any slice (src = InstanceValidator)\nERROR @ /f:Patient/f:extension (line 10, col78) Element is unknown or does not match any slice (src = InstanceValidator)\n â€¦failure</code></p>\n<p>I am not sure whether I am missing something or the example patient is incorrect. I also want to know how to do the same using java code.</p>",
        "id": 153851509,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475469440
    },
    {
        "content": "<p>the java question - the validator is also packaged in HAPI - org.hl7.fhir.dstu2.validation.ValidationEngine is the java class that the jar uses to launch the actual validator</p>",
        "id": 153851510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475470179
    },
    {
        "content": "<p>I'm not sure why you're getting that error - it looks uncorrect to me </p>",
        "id": 153851511,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475470206
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, thanks for your response. I tried using it in java code. I added downloaded <code>org.hl7.fhir.validator.jar</code> itself as a dependency for my project, but it fails when I say below</p>",
        "id": 153851514,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475471668
    },
    {
        "content": "<p><code>engine.loadProfile(\"/Users/mritunjd/Downloads/validator/patient-us-lab.profile.xml\");</code></p>",
        "id": 153851515,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475471812
    },
    {
        "content": "<p>It goes to <code>SimpleWorkerContext</code> and fails saying <code>java.lang.Error: not done yet</code>. </p>",
        "id": 153851516,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475471817
    },
    {
        "content": "<p>Even I tried adding <code>me.fhir:fhir-dstu2:1.0.1.7108</code> as dependency and do it, but same problem, can you please tell me what can be wrong here ?</p>",
        "id": 153851517,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475471824
    },
    {
        "content": "<p>You have to refer to the profile by it's url, not it's location </p>",
        "id": 153851524,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475474079
    },
    {
        "content": "<p>okey, I tried changing this with <code>engine.loadProfile(\"patient-us-lab.profile.xml\")</code>, it fails with an error <code>Unable to find named profile (source = patient-us-lab.profile.xml)</code>, but if I pass the same from command line it works fine. Is there a way to load the profile from file?</p>",
        "id": 153851527,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475475140
    },
    {
        "content": "<p>if I see the code, there it says if it's a url(i.e. startswith <code>http(s)</code>), load it from url otherwise load it from file.</p>",
        "id": 153851528,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475475323
    },
    {
        "content": "<p>but when I pass it as a profile location, it fails in <code>SimpleWorkerContext</code>.</p>",
        "id": 153851529,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475475368
    },
    {
        "content": "<p>well, whatever you put in the -profile parameter is passed straight to ValidationEngine.loadprofile()</p>",
        "id": 153851530,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475476715
    },
    {
        "content": "<p>I also thought the same, and passed the same argument (value for <code>-profile</code> option) to <code>loadProfile()</code> method, but seems like there is something missing. What is the recomonnded way to validate against a <code>profile.xml</code> file. Is there a tutorial available for this ?</p>",
        "id": 153851537,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475480508
    },
    {
        "content": "<p>All we have at the moment is the validation page in the spec. And that doesn't deal with using it in java, but the code for Validator.java is in the fhir svn</p>",
        "id": 153851544,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475489956
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, I cloned  the fhir-svn repo, and run the build with <code>sh publish.sh</code>, the build fails  saying <code>error: cannot find symbol return StringUtils.equals(getValueAsString(), theString);</code><br>\nI am using it on macos.</p>",
        "id": 153852107,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475722888
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/YuKN5PJt2vbdDoyF3dYXaxD_/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/YuKN5PJt2vbdDoyF3dYXaxD_/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\"><img src=\"/user_uploads/10155/YuKN5PJt2vbdDoyF3dYXaxD_/pasted_image.png\"></a></div>",
        "id": 153852108,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475722907
    },
    {
        "content": "<p>What does <code>java -version</code> say?</p>",
        "id": 153852109,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1475725164
    },
    {
        "content": "<p>java 1.8.0_92</p>",
        "id": 153852110,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475726033
    },
    {
        "content": "<p>Well, I checked out a specific commit 6cc899af2017c3819f5448165434450bced7b047 because I wanted the DSTU2-last, and here it build successfuly.</p>",
        "id": 153852111,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475727598
    },
    {
        "content": "<p>DSTU2? carumna. that's a problem. why do you want to build</p>",
        "id": 153852112,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475727961
    },
    {
        "content": "<p>As I told above, I was trying to use java-validator jar in my code directly. For some reason it is failing, but I am not able to debug it beacasue I don't have codebase of same version.</p>",
        "id": 153852113,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475728106
    },
    {
        "content": "<p>I thought I will build the jar with DSTU2 version and debug it on same code base, to get an idea of what's going wrong while validation.</p>",
        "id": 153852114,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475728131
    },
    {
        "content": "<p>hm. well, you don't need to run the build, but ok, you do need to get it compiling. I'll have to figure out what your problem is .....</p>",
        "id": 153852115,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475728194
    },
    {
        "content": "<p>I got it working, thanks for the support, Now I have a different question. In my patient profile I am making <a href=\"http://patient.name\" target=\"_blank\" title=\"http://patient.name\">patient.name</a>, patient.name.family and patient .name.given as mandatory (i.e. cardinality 1..1). </p>\n<p>When I try to validate it gives error for patient.name(when I don't send <a href=\"http://patient.name\" target=\"_blank\" title=\"http://patient.name\">patient.name</a>, expexted), but for patient.name.given and patient.name.family it's validating. I think that might be because of they are grand-child of parent(patient=&gt;name=&gt;family). Is there another way to validate them?</p>",
        "id": 153852150,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475760156
    },
    {
        "content": "<p>below is the relavant part of profile-differential generated by Forge tool</p>\n<div class=\"codehilite\"><pre>&lt;element&gt;\n  &lt;path value=&quot;Patient.name&quot; /&gt;\n  &lt;min value=&quot;1&quot; /&gt;\n  &lt;max value=&quot;1&quot; /&gt;\n  &lt;base&gt;\n    &lt;path value=&quot;Patient.name&quot; /&gt;\n    &lt;min value=&quot;0&quot; /&gt;\n    &lt;max value=&quot;*&quot; /&gt;\n  &lt;/base&gt;\n&lt;/element&gt;\n&lt;element&gt;\n  &lt;path value=&quot;Patient.name.family&quot; /&gt;\n  &lt;min value=&quot;1&quot; /&gt;\n  &lt;max value=&quot;1&quot; /&gt;\n  &lt;base&gt;\n    &lt;path value=&quot;Patient.name.family&quot; /&gt;\n    &lt;min value=&quot;0&quot; /&gt;\n    &lt;max value=&quot;*&quot; /&gt;\n  &lt;/base&gt;\n&lt;/element&gt;\n&lt;element&gt;\n  &lt;path value=&quot;Patient.name.given&quot; /&gt;\n  &lt;min value=&quot;1&quot; /&gt;\n  &lt;max value=&quot;1&quot; /&gt;\n  &lt;base&gt;\n    &lt;path value=&quot;Patient.name.given&quot; /&gt;\n    &lt;min value=&quot;0&quot; /&gt;\n    &lt;max value=&quot;*&quot; /&gt;\n  &lt;/base&gt;\n&lt;/element&gt;\n</pre></div>",
        "id": 153852151,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475760156
    },
    {
        "content": "<p>that should work</p>",
        "id": 153852171,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475779260
    },
    {
        "content": "<p>what does 'I got it working' mean?</p>",
        "id": 153852172,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1475779271
    },
    {
        "content": "<p>what does 'I got it working' mean?</p>\n<p>I meant that I was not able to Use <code>org.hl7.fhir.dstu2.validation.ValidationEngine</code> for some reason, but I am able to use it in a fresh project, but I am still facing problem validation for field which are not directly children to parent. I think it might be because to validate <code>patient.name.family</code> it might be reading the standard <code>humanname.profile.xml</code>. Is there a way I can force it to use overridden snapshot? The snapshot says family and given are mandatory fields.</p>",
        "id": 153852242,
        "sender_full_name": "Mritunjay Dubey",
        "timestamp": 1475808599
    }
]