[
    {
        "content": "<p>Just wondering if a bundle being returned from a resource's history should also satisfy all the invariants, as I don't think that invariant <code>bdl-7</code> can be satisfied if there are deletes in the results (as they don't have a resource, and therefore no meta.versionId).</p>",
        "id": 153863537,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481764203
    },
    {
        "content": "<p>This is causing some of the connectathon tests in Touchstone to fail. (on my server anyway)</p>",
        "id": 153863538,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481764239
    },
    {
        "content": "<p>multiple deletes on the same resource?</p>",
        "id": 153863539,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1481764356
    },
    {
        "content": "<p>can do.</p>",
        "id": 153863540,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481765221
    },
    {
        "content": "<p>a create, delete, update (which re-creates) then delete would do it</p>",
        "id": 153863541,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481765245
    },
    {
        "content": "<p>What if <code>bld-7</code> and <code>bld-8</code> only applied when (type = 'history).not()?</p>\n<p>Then add a new invariant for when (type = 'history) where fullUrl is version specific.</p>",
        "id": 153863588,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481781486
    },
    {
        "content": "<p>bdl-8 I'm ok with, bdl-7 I think needs your addition in there.</p>",
        "id": 153863590,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481781680
    },
    {
        "content": "<p>So <code>bld-7</code> would look like this:</p>\n<p>(type = 'history').not() and entry.where(fullUrl).select(fullUrl&amp;resource.meta.versionId).isDistinct()</p>",
        "id": 153863600,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481782032
    },
    {
        "content": "<p>If that looks right I can update Touchstone's fhir validator for 1.8.0.  (Tomorrow - heading off to bed now)</p>",
        "id": 153863603,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481782327
    },
    {
        "content": "<p>Cool, now that I've updated my FhirPathTester to support both DSTU2 and STU3, should be easy to check.</p>",
        "id": 153863604,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1481782457
    },
    {
        "content": "<p>Nice. I'll let you know when I have that done.<br>\n(Signing off now...)</p>",
        "id": 153863606,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481782610
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> I've updated the <code>bdl-7</code> invariant in Touchstone and ran one of the TestScripts that had the failure and it now passes.</p>",
        "id": 153863655,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481851071
    },
    {
        "content": "<p>The actual change to <code>bdl-7</code> was slightly different. It's now defined as:<br>\n(type = 'history') or entry.where(fullUrl).select(fullUrl&amp;resource.meta.versionId).isDistinct()</p>",
        "id": 153863656,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1481851155
    }
]