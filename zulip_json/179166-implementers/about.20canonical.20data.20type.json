[
    {
        "content": "<p>Hi All,</p>\n<p>I'm trying to confirm whether or not the canonical data type (i.e. <a href=\"http://build.fhir.org/datatypes.html#canonical\" target=\"_blank\" title=\"http://build.fhir.org/datatypes.html#canonical\">http://build.fhir.org/datatypes.html#canonical</a>) can contain a relative url or it should  be an absolute url always. It seems odd to me for a canonical to contain a relative url, as in this example: <a href=\"http://build.fhir.org/questionnaireresponse-example-ussg-fht-answers.json.html\" target=\"_blank\" title=\"http://build.fhir.org/questionnaireresponse-example-ussg-fht-answers.json.html\">http://build.fhir.org/questionnaireresponse-example-ussg-fht-answers.json.html</a></p>\n<p>In that example, the QuestionnaireResponse seems to point to the Questionnaire resource id itself and not to its url.</p>",
        "id": 190248461,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1583898331
    },
    {
        "content": "<p><a href=\"http://hl7.org/fhir/references.html#canonical-fragments\" target=\"_blank\" title=\"http://hl7.org/fhir/references.html#canonical-fragments\">http://hl7.org/fhir/references.html#canonical-fragments</a></p>",
        "id": 190248516,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583898389
    },
    {
        "content": "<p>Sorry I don't understand. The QuestionnaireResponse points to an external Questionnaire, not to an internal one</p>\n<div class=\"codehilite\"><pre><span></span>&quot;questionnaire&quot;: &quot;Questionnaire/ussg-fht&quot;\n</pre></div>\n\n\n<p>Assuming the referenced Questionnaire has the definition:</p>\n<div class=\"codehilite\"><pre><span></span>&quot;url&quot;: &quot;http://abc&quot;,\n&quot;version&quot;: &quot;1&quot;\n</pre></div>\n\n\n<p>I was expecting the QuestionnaireResponse <code>questionnaire</code> property to contain</p>\n<div class=\"codehilite\"><pre><span></span>&quot;questionnaire&quot;: &quot;http://abc&quot;\n</pre></div>\n\n\n<p>or</p>\n<div class=\"codehilite\"><pre><span></span>&quot;questionnaire&quot;: &quot;http://abc|1&quot;\n</pre></div>",
        "id": 190248929,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1583899089
    },
    {
        "content": "<p>then you're right.</p>",
        "id": 190248941,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583899163
    },
    {
        "content": "<p>So the example QuestionnaireResponse is wrong? Or is a <code>canonical</code> property allowed to contain relative url references to other resources by their resource id? If yes, what are those cases?</p>",
        "id": 190249067,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1583899386
    },
    {
        "content": "<p>example is wrong</p>",
        "id": 190249143,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583899493
    },
    {
        "content": "<p>only case where relative urls are allowed is references to contained resources</p>",
        "id": 190249153,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583899516
    },
    {
        "content": "<p>Thanks.</p>\n<p>Some more questions: Suppose I have the following Questionnaire:</p>\n<div class=\"codehilite\"><pre><span></span>id: xyz\nurl: http://abc\nversion: 1\nname: myquestion\n</pre></div>\n\n\n<p>and QuestionnaireResponse:</p>\n<div class=\"codehilite\"><pre><span></span>id: qr1\nquestionnaire: &quot;http://abc&quot;\n</pre></div>\n\n\n<p>I suppose the following searches would work and return me QuestionnaireResponse with resource id qr1?</p>\n<div class=\"codehilite\"><pre><span></span>[baseurl]/QuestionnaireResponse?questionnaire=Questionnaire/xyz\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>[baseurl]/QuestionnaireResponse?questionnaire.name=myquestion\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>[baseurl]/QuestionnaireResponse?questionnaire=http://abc\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>[baseurl]/QuestionnaireResponse?questionnaire=http://abc|1\n</pre></div>",
        "id": 190251780,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1583904745
    },
    {
        "content": "<p>2 and 3 yes. I don't think that #1 works, and #4 is not right</p>",
        "id": 190252192,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583905653
    },
    {
        "content": "<p>[deleted] my mistake</p>",
        "id": 190272425,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1583926986
    },
    {
        "content": "<p><a href=\"https://www.hl7.org/fhir/search.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/search.html\">https://www.hl7.org/fhir/search.html</a> says:</p>\n<blockquote>\n<p>For canonical references, servers SHOULD support searching by Canonical URLs, and SHOULD support automatically detecting a |[version] portion as part of the search parameter and interpreting that portion as a search on the business version of the target resource.</p>\n</blockquote>",
        "id": 190272906,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1583927470
    },
    {
        "content": "<p>so it seems like #4 SHOULD work on some servers, although I'm not sure why the spec has a SHOULD here...</p>",
        "id": 190272989,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1583927531
    },
    {
        "content": "<p>Agree that #4 looks like it should work.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, what's wrong with it?<br>\nNote that #2 is suspect because there's no requirement that <a href=\"http://Questionnaire.name\" target=\"_blank\" title=\"http://Questionnaire.name\">Questionnaire.name</a> be unique - within any context.</p>",
        "id": 190286322,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1583936582
    },
    {
        "content": "<p>whats' wrong with 4 is that I don't think there's any assigned meaning to using a versioned canonical reference in a reference like that</p>",
        "id": 190324139,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583956473
    },
    {
        "content": "<p>So we haven't defined search for versioned canonical URLs?</p>",
        "id": 190340076,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1583966583
    },
    {
        "content": "<p>Is that something we can/should do?</p>",
        "id": 190340092,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1583966593
    },
    {
        "content": "<p>we have on the url itself, but not if it's a reference like that</p>",
        "id": 190340535,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583966890
    },
    {
        "content": "<p>We are building an ordering platform for lab tests, allowing practitioner to order tests from Quest Diagnostics, LabCorp and others.<br>\nWe are following the <a href=\"https://build.fhir.org/ig/HL7/fhir-order-catalog/labservices.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/fhir-order-catalog/labservices.html\">IG</a> to model our catalogs but encountered a problem when trying to create a link between the PlanDefinition (service) and the ActivityDefinition (procedure):<br>\nThe link is made using a canonical reference. This poses a problem since we are using Quest’s masterfile and the links between services and procedures are local references, we are not sure whose responsibility is it to create those urls nor what rules should we follow. If they were regular references it would be easy, we just map the masterfile to PlanDefinitions and ActivityDefinitions, but as it is, we don’t know what the links should be.<br>\nThe examples in the IG use local references and according to <a href=\"#narrow/stream/179166-implementers/topic/about.20canonical.20data.20type/near/190249143\" title=\"#narrow/stream/179166-implementers/topic/about.20canonical.20data.20type/near/190249143\">Grahame</a> those are wrong.<br>\nCan you please show us an example of a proper canonical url for a case like the ones in the IG examples or point us in the right direction?<br>\nThanks in advance</p>",
        "id": 191268065,
        "sender_full_name": "Guillermo Rdguez Glez",
        "timestamp": 1584722206
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span></p>",
        "id": 191272844,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1584724191
    },
    {
        "content": "<p>So the canonical is a global, version-stable identifier for the artifact. Here's an example of a <a href=\"http://build.fhir.org/ig/HL7/cqf-recommendations/PlanDefinition-anc-contact-schedule.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/cqf-recommendations/PlanDefinition-anc-contact-schedule.html\">WHO Antenatal Care Contact Schedule</a> referencing a <a href=\"http://build.fhir.org/ig/HL7/cqf-recommendations/PlanDefinition-anc-contact.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/HL7/cqf-recommendations/PlanDefinition-anc-contact.html\">Contact Plan Definition</a>. I would think in this case the canonical's would be the base URL of the steward (Quest) + <code>/PlanDefinition/&lt;name&gt;</code>, or <code>/ActivityDefinition/name</code>, and then when you reference, if it's a version-independent reference, just the canonical, if it's a version-specific reference, then <code>&lt;canonical&gt;|&lt;version&gt;</code>.</p>",
        "id": 191309315,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1584742349
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> ,  in the case of Quest, it defines different CDC per labsite(TMP, MIA, NEL, ...), with lab services identifiers that may or may not match across other labsites, so, I am not sure including labsite code in the canonical url may be a good idea because it becomes too specific(not global for quest procedures), nor using the identifier when same procedure may have different identifiers on different labsites.</p>\n<p>Example:<br>\nPanel: 10010<br>\nName: TORCH PANEL, CONVALESCENT<br>\nLabSite: NEL </p>\n<p>what should be an accurate canonical url for this case?</p>\n<p><code>http://www.questdiagnostics.com/ActivityDefinition/10010</code><br>\nor<br>\n<code>http://www.questdiagnostics.com/NEL/ActivityDefinition/10010</code></p>\n<p>keep in mind each Quest lab service identifier is labsite specific, each labsite manages its lab services catalog, so, we can say, Quest needs labsite in addition to lab service identifier in order to unambiguously resolve labservice.</p>\n<p>Thank you for helping, in advance!</p>",
        "id": 191482921,
        "sender_full_name": "Guillermo Rdguez Glez",
        "timestamp": 1584974729
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span>  can you help me on that <span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span> please?</p>",
        "id": 191668705,
        "sender_full_name": "Guillermo Rdguez Glez",
        "timestamp": 1585082158
    },
    {
        "content": "<p>I defer to Bryn, but adding a comment.   As you have noted, labs need unique identifiers for their test panels and components since LOINC , CPT, etc are not specific enough, but that identifier will vary across Quest sub lab entities/locations.   Also the Name would not  be consistent across different sub lab entities.  As a suggestion ,consider <a href=\"http://www.questdiagnostics.com/ActivityDefinition/NEL/10010\" title=\"http://www.questdiagnostics.com/ActivityDefinition/NEL/10010\">http://www.questdiagnostics.com/ActivityDefinition/NEL/10010</a> where ActivityDefinition could be LOINC  rather  than just name (since need to consider units such as mass/volume vs Moles/volume, etc).  Thus searching for a specific LOINC could pull irrespective of LAB entity (NEL 3 char identifier)  and yet have  have the required unique ID.</p>",
        "id": 191952156,
        "sender_full_name": "Peter Muir",
        "timestamp": 1585258443
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"195980\">@Peter Muir</span> I don't understand if you are actually recommending to avoid using LOINC or recommending it. I am so sorry <span aria-label=\"disappointed\" class=\"emoji emoji-1f61e\" role=\"img\" title=\"disappointed\">:disappointed:</span> .  Or are you recommending using both, LOINC(when available) and specific LAB identifier? Notice  10010 is the lab service identifier inside specific LAB. What do you mean with name? I don't understand if you are recommending to change \"ActivityDefinitin\" with a LOINC, or LAB/quest-id combination at all. Who am I supposed to use LOINC in order to compose an accurate ActivityDefinition canonical url. Should I keep a separate catalog for each specific quest lab(NEL, MIA, ...). I really appreciate your help. Thanks in advance.</p>",
        "id": 192069040,
        "sender_full_name": "Guillermo Rdguez Glez",
        "timestamp": 1585337433
    },
    {
        "content": "<p>For canonicals managed by Quest, I'd use the Quest ids, not LOINC.  It's entirely possible that Quest might have multiple ActivityDefinitions (with different codes) that share the same LOINC value.  And of course there might be some that that won't have a corresponding LOINC code at all.  In theory, LOINC might eventually define ActivityDefinitions themselves (which of course would have canonicals based on the LOINC codes).  The Quest ActivityDefinitions could point to those using the 'instantiates' property.  In the meantime, they can also link to the relevant LOINC using one of the codings in ActivityDefinition.code.</p>",
        "id": 192083458,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585344993
    }
]