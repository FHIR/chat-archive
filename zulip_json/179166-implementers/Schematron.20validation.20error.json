[
    {
        "content": "<p>Can anyone help me with this?  I'm getting this error when I do schematron validation of my FHIR logical models (<code>StructureDefinitions</code>):</p>\n<div class=\"codehilite\"><pre>sdf-7: If the structure describes a base Resource or Type, the URL has to start with &quot;http://hl7.org/fhir/StructureDefinition/&quot; and the tail must match the id\n</pre></div>\n\n\n<p>I looked at the <a href=\"http://build.fhir.org/structuredefinition-definitions.html#StructureDefinition\" target=\"_blank\" title=\"http://build.fhir.org/structuredefinition-definitions.html#StructureDefinition\">StructureDefinition documentation</a> and under sdf-7 the expression includes \"...or  (kind = 'logical')...\" so I would expect that I wouldn't get this error.  However, I did notice that the XPath expression does not include a phrase equivalent to \"...or  (kind = 'logical')...\".  So, am I doing something wrong, or is there a bug in the sdf-7 constraint specification?</p>",
        "id": 153856466,
        "sender_full_name": "Stephen Royce",
        "timestamp": 1478828568
    },
    {
        "content": "<p>does your url start with '<a href=\"http://hl7.org/fhir/StructureDefinition/\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/\">http://hl7.org/fhir/StructureDefinition/</a>'</p>",
        "id": 153856467,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1478829036
    },
    {
        "content": "<p>No.  But these are logical models; it shouldn't have to should it?</p>",
        "id": 153856468,
        "sender_full_name": "Stephen Royce",
        "timestamp": 1478829281
    },
    {
        "content": "<p>The relevant parts of the XML look like this:</p>\n<div class=\"codehilite\"><pre>    &lt;id value=&quot;lm-AdverseReaction&quot;/&gt;\n...\n    &lt;url value=&quot;http://mct-cidbstg-01:8080/exist/apps/cimm/StructureDefinition/lm-AdverseReaction&quot;/&gt;\n...\n    &lt;kind value=&quot;logical&quot;/&gt;\n    &lt;abstract value=&quot;false&quot;/&gt;\n    &lt;type value=&quot;AdverseReaction&quot;/&gt;\n    &lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/DomainResource&quot;/&gt;\n    &lt;derivation value=&quot;specialization&quot;/&gt;\n</pre></div>",
        "id": 153856469,
        "sender_full_name": "Stephen Royce",
        "timestamp": 1478829411
    },
    {
        "content": "<p>The constraint specification in the <code>StructureDefinition</code> resource looks like this:</p>\n<div class=\"codehilite\"><pre>      &lt;constraint&gt;\n        &lt;key value=&quot;sdf-7&quot;/&gt;\n        &lt;severity value=&quot;error&quot;/&gt;\n        &lt;human value=&quot;If the structure describes a base Resource or Type, the URL has to start with &amp;quot;http://hl7.org/fhir/StructureDefinition/&amp;quot; and the tail must match the id&quot;/&gt;\n        &lt;expression value=&quot;(derivation = &#39;constraint&#39;) or (kind = &#39;logical&#39;) or (url = &#39;http://hl7.org/fhir/StructureDefinition/&#39;+id)&quot;/&gt;\n        &lt;xpath value=&quot;(f:derivation/@value = &#39;constraint&#39;) or f:url/@value=concat(&#39;http://hl7.org/fhir/StructureDefinition/&#39;, f:id/@value)&quot;/&gt;\n      &lt;/constraint&gt;\n</pre></div>\n\n\n<p>The logical statements in the <code>expression</code> and <code>xpath</code> (XML) elements are not equivalent (unless kind='logical' =&gt; derivation = 'constraint').</p>",
        "id": 153856470,
        "sender_full_name": "Stephen Royce",
        "timestamp": 1478829877
    },
    {
        "content": "<p>yes the xpath is wrong. </p>",
        "id": 153856472,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1478829934
    },
    {
        "content": "<p>We have noticed when validating e.g. RelatedPerson.xml structureDefinition (profile) file against structureDefinition.sch, the following schematron rules do not seem to check what the error message conveys.</p>\n<p>e.g.</p>\n<div class=\"codehilite\"><pre><span></span>&lt;sch:assert test=&quot;count(*/f:element)=count(*/f:element/@id)&quot;&gt;sdf-16: All element definitions must have unique ids (snapshot)&lt;/sch:assert&gt; - \n</pre></div>\n\n\n<p>The error message conveys that the snapshot element must have unique ids however, the test is performing that all the elements in the structureDefinition shall have id's and rather it is not testing the uniqueness of the <a href=\"http://element.id\" target=\"_blank\" title=\"http://element.id\">element.id</a>.<br>\nAs a suggestion, we have come up with the following two rules which can effectively test both requirements.</p>\n<div class=\"codehilite\"><pre><span></span>&lt;sch:assert test=&quot;count(f:snapshot/f:element)=count(f:snapshot/f:element/@id)&quot;&gt;sdf-16: All element definitions must have ids (snapshot)&lt;/sch:assert&gt;\n&lt;sch:assert test=&quot;count(f:snapshot/f:element)=count(distinct-values(f:snapshot/f:element/@id))&quot;&gt;sdf-ABC: All element definitions must have unique ids (snapshot)&lt;/sch:assert&gt;\n</pre></div>\n\n\n<p>Similar rules apply to sdf-17 schematron error as well.</p>",
        "id": 153891870,
        "sender_full_name": "Uday Chandrupatla",
        "timestamp": 1496278517
    },
    {
        "content": "<p>Hi Uday,</p>",
        "id": 153891871,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1496278697
    },
    {
        "content": "<p>Can you raise this as a change request?</p>",
        "id": 153891872,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1496278706
    },
    {
        "content": "<p>Thanks for the quick reply Lloyd, we will raise this in G Forge.</p>",
        "id": 153891873,
        "sender_full_name": "Uday Chandrupatla",
        "timestamp": 1496278859
    },
    {
        "content": "<p>Hi Lloyd, I have requested GForge to register me (uday_adha) to raise change request, but the request has not been approved yet. i will raise the ticket ones i get the access.</p>",
        "id": 153892258,
        "sender_full_name": "Uday Chandrupatla",
        "timestamp": 1496619075
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192202\">@Uday Chandrupatla</span> Sorry for the delay (and thanks for the poke).  HQ normally monitors more actively.  I've gone in and approved the request.</p>",
        "id": 153892259,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1496620273
    },
    {
        "content": "<p>Thanks Lloyd.</p>",
        "id": 153892260,
        "sender_full_name": "Uday Chandrupatla",
        "timestamp": 1496620540
    }
]