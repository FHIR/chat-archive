[
    {
        "content": "<p>Hi I am relatively new to FHIR and and now working on a project to do FHIR resources validation. This is for DSTU3 and using HAPI FHIR Validator 4.2.0 . I have couple of questions</p>\n<p>1) How to validate  snomed ,rxnorm codes and any other external codes  to see that codes in our fhir response json are valid? <br>\n2)  Secondly I am testing patient resource and it has extensions for Race and Ethnicity. I did  add structuredefinitions, valuesets  to the validator and ran the program. It is throwing NullPointerException  </p>\n<p>Exception in thread \"main\" java.lang.NullPointerException<br>\n    at org.hl7.fhir.r5.model.Element.getExtensionString(Element.java:419)<br>\n    at org.hl7.fhir.r5.model.ElementDefinition$TypeRefComponent.getWorkingCode(ElementDefinition.java:2285)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4390)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4376)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkExtension(InstanceValidator.java:1627)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:4495)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:4376)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:3287)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:5047)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:851)<br>\n    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:684)<br>\n    at org.hl7.fhir.common.hapi.validation.ValidatorWrapper.validate(ValidatorWrapper.java:141)<br>\n    at org.hl7.fhir.dstu3.hapi.validation.FhirInstanceValidator.validate(FhirInstanceValidator.java:288)<br>\n    at org.hl7.fhir.dstu3.hapi.validation.BaseValidatorBridge.doValidate(BaseValidatorBridge.java:20)<br>\n    at org.hl7.fhir.dstu3.hapi.validation.BaseValidatorBridge.validateResource(BaseValidatorBridge.java:43)<br>\n    at org.hl7.fhir.dstu3.hapi.validation.FhirInstanceValidator.validateResource(FhirInstanceValidator.java:59)<br>\n    at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:245)<br>\n    at ca.uhn.fhir.validation.FhirValidator.validateWithResult(FhirValidator.java:200)<br>\n    at com.ecw.fhir.validator.ValidatorTest.main(ValidatorTest.java:171)</p>\n<p>I am using R3 but it is using object from R5. My sample json for extension is<br>\n\"extension\": [<br>\n    {<br>\n      \"url\": \"<a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-race\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-race</a>\",<br>\n      \"extension\": [<br>\n        {<br>\n          \"url\": \"ombCategory\",<br>\n          \"valueCoding\": {<br>\n            \"system\": \"urn:oid:2.16.840.1.113883.6.238\",<br>\n            \"code\": \"2106-3\",<br>\n            \"display\": \"White\"<br>\n          }<br>\n        }<br>\n      ]<br>\n    },<br>\n    {<br>\n      \"url\": \"<a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity</a>\",<br>\n      \"extension\": [<br>\n        {<br>\n          \"url\": \"ombCategory\",<br>\n          \"valueCoding\": {<br>\n            \"system\": \"2.16.840.1.113883.6.238\",<br>\n            \"code\": \"2186-5\",<br>\n            \"display\": \"Not Hispanic or Latino\"<br>\n          }<br>\n        }<br>\n      ]<br>\n    },<br>\n    {<br>\n      \"url\": \"<a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex</a>\",<br>\n      \"valueCoding\": {<br>\n        \"code\": \"M\"<br>\n      }<br>\n    }<br>\n  ]</p>\n<p>While debugging my observation is org.hl7.fhir.r5.model.Element.getExtensionString(..) gets called with \"<a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-fhir-type\">http://hl7.org/fhir/StructureDefinition/structuredefinition-fhir-type</a>\" and it returns null. Seems like this is happening while validating \"urn:oid:2.16.840.1.113883.6.238\". </p>\n<p>Thanks in advance and any guidance is appreciated. Thanks.</p>",
        "id": 198770810,
        "sender_full_name": "Radharani Sonnathi",
        "timestamp": 1590503773
    },
    {
        "content": "<ol>\n<li>You'll need to ensure that when you launch the validator, it points to a terminology server that has access to the terminologies you need.  (The default HL7 one <em>should</em> have most SNOMED CT partitions as well as RxNorm</li>\n<li>You should not be defining extensions for US-Core extensions - just point to the U.S. Core IG as a dependency.  (The validator uses R5 internally, regardless of what version of the spec is being used, so the references to R5 are expected.)</li>\n</ol>",
        "id": 198779991,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590507166
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  thanks a lot for your quick response.<br>\n1) Terminology server is that something do I need to configure in my code?<br>\n2) Should not be defining extensions for US-Core extensions,  you meant in my json response? I am using all US Core profiles.</p>",
        "id": 198781761,
        "sender_full_name": "Radharani Sonnathi",
        "timestamp": 1590507877
    },
    {
        "content": "<ol>\n<li>The validator takes a parameter indicating what terminology server to use.  I generally use it from commandline, but you should be able to set the configuration in code too</li>\n<li>The validator should be pointing to the US Core profiles and extensions as they're defined in the official IG - you shouldn't be defining them yourself.</li>\n</ol>",
        "id": 198782066,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590508003
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\n1)That is what I don't know what terminology server to use.<br>\n2) is it possible for you to provide a sample Patient Json please?  Thanks.</p>",
        "id": 198782910,
        "sender_full_name": "Radharani Sonnathi",
        "timestamp": 1590508366
    },
    {
        "content": "<ol>\n<li><a href=\"http://tx.fhir.org\">tx.fhir.org</a> should support both SNOMED and RxNorm</li>\n<li>There are lots of example Patient json files in the core spec, and there are some in the US Core IG as well.  Do you need something other than those?</li>\n</ol>",
        "id": 198785225,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590509342
    }
]