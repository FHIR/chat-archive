[
    {
        "content": "<p>Hi, I am unable to download packages from Simplifier via <code>npm</code>, e.g. <a href=\"https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1\">FHIR R4 Core</a>. Tested with npm 7.4.3 and 7.5.6. Error ist <code>Invalid package manifest: no 'dist.tarball' field</code>. Can anyone reproduce this?</p>",
        "id": 227648786,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1614191586
    },
    {
        "content": "<p>I think you need to provide more details</p>",
        "id": 227681706,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614204295
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"263785\">@Marcus Wurlitzer</span> , what was your npm invocation?</p>",
        "id": 227681907,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1614204350
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191452\">@Eric Prud'hommeaux</span> I used the command from simplifier: <code>npm --registry https://packages.simplifier.net install hl7.fhir.r4.core@4.0.1</code> IIRC, it did work with an older (?) version of <code>npm</code>. Or am I missing something else?</p>",
        "id": 227687708,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1614206606
    },
    {
        "content": "<p>i can reproduce the error</p>",
        "id": 227688581,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1614207036
    },
    {
        "content": "<p>not sure yet whether i can go further</p>",
        "id": 227688669,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1614207095
    },
    {
        "content": "<p>Thank you. So if there is no obvious mistake, I might just send a 'feedback' to <a href=\"http://simplifier.net\">simplifier.net</a>.</p>",
        "id": 227690020,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1614207725
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> someone should look into this?</p>",
        "id": 227690245,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614207827
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"263785\">@Marcus Wurlitzer</span> <span class=\"user-mention\" data-user-id=\"191452\">@Eric Prud'hommeaux</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nJust installed the LTS version of Node.js and NPM on my new laptop, which indeed has an older NPM (<code>6.14.11</code>) and there it installs without trouble.</p>\n<p>Does it work for you if you download the package first and then install it?</p>\n<div class=\"codehilite\"><pre><span></span><code>npm pack hl7.fhir.r4.core@4.0.1 --registry https://packages.simplifier.net\nnpm install .\\hl7.fhir.r4.core-4.0.1.tgz\n</code></pre></div>\n<p>I really know very little about Node/NPM, perhaps <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> or <span class=\"user-mention\" data-user-id=\"191782\">@Brian Kaney</span> know what this is about.</p>",
        "id": 227745781,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1614248515
    },
    {
        "content": "<p>looks indeed like an incompatibility with v7 of npm. I installed a local copy of 6.14.11 and it worked:</p>\n<div class=\"codehilite\"><pre><span></span><code>mkdir fhirtoy &amp;&amp;\ncd $_ &amp;&amp; npm init -y &gt; /dev/null &amp;&amp;\nmkdir oldnpm &amp;&amp;\ncd oldnpm &amp;&amp;\nnpm init -y &gt; /dev/null &amp;&amp; npm install npm@6.14.11 &gt; /dev/null &amp;&amp;\ncd .. &amp;&amp;\n./oldnpm/node_modules/.bin/npm --registry https://packages.simplifier.net install hl7.fhir.r4.core@4.0.1\n</code></pre></div>",
        "id": 227765193,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1614259207
    },
    {
        "content": "<p>(I stuck 6.14.11 in a <code>oldnpm</code> subdir 'cause i didn't want to default to using an old npm for all npm commands run from that hierarchy)</p>",
        "id": 227766325,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1614259693
    },
    {
        "content": "<p>Interesting...  I don't know the differences between NPM6 and NPM7 well enough to comment on what might be going on here.  I looked at the NPM7 announcement (<a href=\"https://github.blog/2021-02-02-npm-7-is-now-generally-available/\">here</a>) and didn't see anything that looked like it would break package resolution in this way (<code>Invalid package manifest: no 'dist.tarball' field</code>).  It looks like they treat peer dependencies different now, but that doesn't seem to be what's going on here.  Based on the error message, I guess I'd ask -- does the simplifier registry provide that \"dist.tarball\" field in the package manifest?</p>",
        "id": 227769639,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1614261210
    },
    {
        "content": "<p>Simplifier does not touch the package manifest, just serves as is.</p>",
        "id": 227778502,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1614264624
    },
    {
        "content": "<p>Looks like this is not about the manifest inside the package, but the package version listing API.<br>\nWe'll make it compliant with npm 7 in the coming days.</p>\n<p>If you're in a hurry. you can always use Firely.Terminal. It was built for this purpose. ;)</p>",
        "id": 227781376,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1614265693
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191335\">@Martijn Harthoorn</span> what changes are needed?</p>",
        "id": 227807465,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614275070
    },
    {
        "content": "<p>Thank you all for looking into this!<br>\n<span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> the <code>pack</code> command gives me <code>Cannot read property '0' of undefined</code>.<br>\n<span class=\"user-mention\" data-user-id=\"191335\">@Martijn Harthoorn</span> I had chosen <code>npm</code> because it is ready to run on the target machine running ubuntu, while the .NET SDK is not. So I was quite happy that <code>npm</code> is provided as an option to fetch packages. :) Looking forward to your API update!</p>",
        "id": 227896996,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1614328714
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I believe the <a href=\"https://simplifier.net/docs/package-server/VersionListing\">versions endpoint</a> needs an additional <code>dist</code> entry per version with <code>shasum</code> and <code>tarball</code>:<br>\n<a href=\"/user_uploads/10155/TdWV7gnIwkAWbj8-4jRcyYpb/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/TdWV7gnIwkAWbj8-4jRcyYpb/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/TdWV7gnIwkAWbj8-4jRcyYpb/image.png\"></a></div>",
        "id": 227910133,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1614336317
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"263785\">@Marcus Wurlitzer</span> , wat do you mean by \"ready-to-run\". Because In itself .NET SDK is definitely available for Ubuntu. And Firely Terminal has been made cross platform too.</p>",
        "id": 228214601,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1614598121
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> - As far as I can see the dist.shasum and dist.tarball is indeed all that is required to make it work for NPM-7, but we need to do this fix, to make sure nothing more is needed.</p>",
        "id": 228215010,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1614598378
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191335\">Martijn Harthoorn</span> Yes - I did not mean to say that Firely Terminal is not compatible. Just that <code>npm</code> is readily available on our system, while the <code>.NET SDK</code> is not. This may of course be specific to our systems. Basically, this was to encourage you not to drop <code>npm</code> support, if feasible. :)</p>",
        "id": 228215323,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1614598550
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"263785\">@Marcus Wurlitzer</span> Can you please try again? We've made some major changes to now precompute all package tar-balls, instead of creating them only when requested, so we can serve the <code>dist.shasum</code> and <code>dist.tarball</code> in the API.</p>",
        "id": 231766720,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1616663073
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> I can confirm package fetching now works with <code>npm 7.5.6/ubuntu</code> and <code>npm 7.4.3/MacOS</code>. Thank you!</p>",
        "id": 231768802,
        "sender_full_name": "Marcus Wurlitzer",
        "timestamp": 1616664248
    },
    {
        "content": "<p>Thanks for confirming <span class=\"user-mention\" data-user-id=\"263785\">@Marcus Wurlitzer</span> <span aria-label=\"thumbs up\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"thumbs up\">:thumbs_up:</span> <br>\ncc <span class=\"user-mention\" data-user-id=\"191452\">@Eric Prud'hommeaux</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <span class=\"user-mention\" data-user-id=\"191782\">@Brian Kaney</span></p>",
        "id": 231768938,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1616664323
    }
]