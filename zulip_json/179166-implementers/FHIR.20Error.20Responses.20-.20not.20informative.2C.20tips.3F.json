[
    {
        "content": "<p>Hello,<br>\nMy issue fully documented here if you can view this:<br>\n<a href=\"http://community.fhir.org/t/fhir-error-responses-finding-helpful-info-in-them/744\" target=\"_blank\" title=\"http://community.fhir.org/t/fhir-error-responses-finding-helpful-info-in-them/744\">http://community.fhir.org/t/fhir-error-responses-finding-helpful-info-in-them/744</a></p>\n<p>1. How to find useful information in the error response?<br>\n2. Why is the error response slightly different (less useful) if I use fhir.js to make the CRUD request to <a href=\"http://fhirtest.uhn.ca\" target=\"_blank\" title=\"http://fhirtest.uhn.ca\">fhirtest.uhn.ca</a>, versus when I use fhirtest.uhn.ca's UI (more helpful, see example below)</p>\n<p>### Example<br>\n<strong>Send a bad POST body using fhir.js to fhirtest.uhn</strong><br>\nSend a reference with <code>12345/Practitioner</code> (incorrect) instead of <code>Practitioner/12345</code> (correct) then I get error:<br>\n<code>Unprocessable Entity</code></p>\n<p><strong>Send a bad POST body using the UI on fhirtest.uhn</strong><br>\nSend a reference with <code>12345/Practitioner</code> (incorrect) instead of <code>Practitioner/12345</code> (correct) then I get error:<br>\n<code>Error: HTTP 422 Unprocessable Entity: Invalid reference found at path 'PractitionerRole.practitioner'. Resource type '787132' is not valid for this path</code></p>\n<p>^^ <em>much more helpful!!</em></p>",
        "id": 153948235,
        "sender_full_name": "William Capozzoli",
        "timestamp": 1522102009
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ?</p>",
        "id": 153948236,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1522102074
    },
    {
        "content": "<p>I tried logging every <code>key</code> in the response and <code>response[key]</code> (e.g. status, errors, headers) and tried <code>response.body</code> <code>response.data</code> but didn't have much success in finding anything useful. I guess I could log it recursively. Its a ton of metadata/http jargon that's not relevant. Been through a bunch of documentation and tried examining the HAPI FHIR source code. Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span></p>",
        "id": 153948238,
        "sender_full_name": "William Capozzoli",
        "timestamp": 1522102458
    },
    {
        "content": "<p>I would be looking at fhir.js not HAPI for what's happening.  If you do this in a web browser like Chrome/Safari, then you can use the developer tools to inspect the actual network traffic.</p>",
        "id": 153948322,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1522138900
    },
    {
        "content": "<p>Agree with Michael. <span class=\"user-mention\" data-user-id=\"195518\">@William Capozzoli</span> can you check the Chrome developer console network tab to see what's actually being passed across the wire?</p>",
        "id": 153948328,
        "sender_full_name": "James Agnew",
        "timestamp": 1522146276
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> its a request being made to our own back-end, which then makes a call to <a href=\"http://fhirtest.uhn.ca\" target=\"_blank\" title=\"http://fhirtest.uhn.ca\">fhirtest.uhn.ca</a>. So its a huge body of data from front-end to back-end, and then from there the data gets transformed into fhir Resource objects which <a href=\"http://fhirtest.uhn.ca\" target=\"_blank\" title=\"http://fhirtest.uhn.ca\">fhirtest.uhn.ca</a> can digest to make a bunch of fhir resources.</p>\n<p>Ill look for the actual request, <strong>do you want to see Request Headers?</strong> </p>\n<p>Though I think it was my backend-code causing the error in this situation, as opposed to the quality of the data being sent from front to back. To re-produce the error I just have to update some  backend code to mess up the EpisodeOfCare's reference to a practitioner (i.e. make it '12345/Practitioner' instead of 'Practitioner/12345'). Either way its the same '12345' value being sent from front to back.</p>\n<p>So the call is not directly from my frontEnd to <a href=\"http://fhirtest.uhn.ca\" target=\"_blank\" title=\"http://fhirtest.uhn.ca\">fhirtest.uhn.ca</a>, if that's what you were thinking.</p>",
        "id": 153948907,
        "sender_full_name": "William Capozzoli",
        "timestamp": 1522281776
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> I'm seeing your response now. I guess I was sending the error response all the way back to the front-end so I could read it in the Network tab &gt; Preview/Response. Same info I was reading in the log on my back-end regarding failure to create the Resource in HAPI.</p>\n<p>You said look to fhir.js to see what's happening, you mean to use this library to somehow inspect the response? Maybe i'm not following you here.</p>",
        "id": 153948908,
        "sender_full_name": "William Capozzoli",
        "timestamp": 1522282016
    },
    {
        "content": "<p>Here are my <strong>request headers</strong> from Chrome Network tab. Maybe some of this is affecting the call that my back-end makes to HAPI?:</p>\n<div class=\"codehilite\"><pre><span></span>POST /claim HTTP/1.1\nHost: localhost:3001\nConnection: keep-alive\nContent-Length: 1539\nPragma: no-cache\nCache-Control: no-cache\nOrigin: http://localhost:3000\nUser-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_13_3) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/65.0.3325.181 Safari/537.36\ncontent-type: application/json\nAccept: */*\nReferer: http://localhost:3000/newclaim\nAccept-Encoding: gzip, deflate, br\nAccept-Language: en-US,en;q=0.9\n</pre></div>\n\n\n<p>and the <strong>response</strong>:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;status&quot;: 422,\n  &quot;headers&quot;: {\n\n  },\n  &quot;config&quot;: {\n    &quot;resource&quot;: {\n      &quot;identifier&quot;: [\n        {\n          &quot;system&quot;: &quot;http:\\/\\/claimcdr.com\\/claimid&quot;,\n          &quot;value&quot;: &quot;SDF2-KMD3&quot;\n        },\n        {\n          &quot;system&quot;: &quot;http:\\/\\/claimcdr.com\\/claimfolder&quot;,\n          &quot;value&quot;: &quot;019ab685-ec64-416a-9dc4-2495ae75088b&quot;\n        }\n      ],\n      &quot;status&quot;: &quot;active&quot;,\n      &quot;patient&quot;: {\n        &quot;reference&quot;: &quot;1960729\\/Patient&quot;\n      },\n      &quot;careManager&quot;: {\n        &quot;reference&quot;: &quot;221712\\/Practitioner&quot;\n      },\n      &quot;managingOrganization&quot;: {\n        &quot;reference&quot;: &quot;601587\\/Organization&quot;\n      },\n      &quot;resourceType&quot;: &quot;EpisodeOfCare&quot;\n    },\n    &quot;baseUrl&quot;: &quot;http:\\/\\/hapi.fhir.org\\/baseDstu3&quot;,\n    &quot;credentials&quot;: &quot;same-origin&quot;,\n    &quot;headers&quot;: {\n      &quot;Content-Type&quot;: &quot;application\\/fhir+json&quot;,\n      &quot;Accept&quot;: &quot;application\\/json&quot;,\n      &quot;Prefer&quot;: &quot;return=representation&quot;\n    },\n    &quot;data&quot;: &quot;{\\&quot;identifier\\&quot;:[{\\&quot;system\\&quot;:\\&quot;http:\\/\\/claimcdr.com\\/claimid\\&quot;,\\&quot;value\\&quot;:\\&quot;SDF2-KMD3\\&quot;},{\\&quot;system\\&quot;:\\&quot;http:\\/\\/claimcdr.com\\/claimfolder\\&quot;,\\&quot;value\\&quot;:\\&quot;019ab685-ec64-416a-9dc4-2495ae75088b\\&quot;}],\\&quot;status\\&quot;:\\&quot;active\\&quot;,\\&quot;patient\\&quot;:{\\&quot;reference\\&quot;:\\&quot;1960729\\/Patient\\&quot;},\\&quot;careManager\\&quot;:{\\&quot;reference\\&quot;:\\&quot;221712\\/Practitioner\\&quot;},\\&quot;managingOrganization\\&quot;:{\\&quot;reference\\&quot;:\\&quot;601587\\/Organization\\&quot;},\\&quot;resourceType\\&quot;:\\&quot;EpisodeOfCare\\&quot;}&quot;,\n    &quot;method&quot;: &quot;POST&quot;,\n    &quot;url&quot;: &quot;http:\\/\\/hapi.fhir.org\\/baseDstu3\\/EpisodeOfCare&quot;,\n    &quot;body&quot;: &quot;{\\&quot;identifier\\&quot;:[{\\&quot;system\\&quot;:\\&quot;http:\\/\\/claimcdr.com\\/claimid\\&quot;,\\&quot;value\\&quot;:\\&quot;SDF2-KMD3\\&quot;},{\\&quot;system\\&quot;:\\&quot;http:\\/\\/claimcdr.com\\/claimfolder\\&quot;,\\&quot;value\\&quot;:\\&quot;019ab685-ec64-416a-9dc4-2495ae75088b\\&quot;}],\\&quot;status\\&quot;:\\&quot;active\\&quot;,\\&quot;patient\\&quot;:{\\&quot;reference\\&quot;:\\&quot;1960729\\/Patient\\&quot;},\\&quot;careManager\\&quot;:{\\&quot;reference\\&quot;:\\&quot;221712\\/Practitioner\\&quot;},\\&quot;managingOrganization\\&quot;:{\\&quot;reference\\&quot;:\\&quot;601587\\/Organization\\&quot;},\\&quot;resourceType\\&quot;:\\&quot;EpisodeOfCare\\&quot;}&quot;\n  },\n  &quot;error&quot;: {\n    &quot;size&quot;: 0,\n    &quot;timeout&quot;: 0\n  }\n}\n</pre></div>",
        "id": 153948909,
        "sender_full_name": "William Capozzoli",
        "timestamp": 1522282326
    }
]