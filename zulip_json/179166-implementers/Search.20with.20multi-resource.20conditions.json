[
    {
        "content": "<p>Hello everyone,</p>\n<p>I have a question about a search query on a FHIR API, in particular to include mother/daughter resources to the answer (using _include, _revinclude and _iterate parameters,  <a href=\"https://www.hl7.org/fhir/search.html#revinclude\">here</a> in FHIR doc) and to specify chained parameters (<a href=\"https://www.hl7.org/fhir/search.html#chaining\">here</a> and <a href=\"https://www.hl7.org/fhir/search.html#has\">here</a>).</p>\n<p>Here is what I want to query to the API :<br>\nI wish to return Condition, AllergyIntolerance, Patient and Practitioner resources that meet all of the following conditions:</p>\n<ul>\n<li>patients were born in 1970 (associated search parameter of the resource Patient : birthdate=1970)</li>\n<li>theyâ€™ve been diagnosed allergic to Cashew nuts (associated search parameter of the resource AllergyIntolerance: code=http://snomed.info/sct|227493005)</li>\n<li>the source of the information about the allergy is a practitioner who lives in France (associated search parameter of the resource Practitioner: address-state=france)</li>\n<li>patients have had fever (associated search parameter of the resource Condition: code=http://snomed.info/sct|386661006)</li>\n</ul>\n<p>A priori, I thought I could do a search that might look like:</p>\n<div class=\"codehilite\"><pre><span></span><code>/AllergyIntolerance?\ncode=http://snomed.info/sct|227493005&amp;\npatient:Patient.birthdate=1970&amp;\npatient:Patient:_has:Condition:code=http://snomed.info/sct|386661006&amp;\nasserter:Practitioner.address-state=france&amp;\n_include=AllergyIntolerance:patient&amp;\n_revinclude:iterate=Condition:subject&amp;\n_include=AllergyIntolerance:asserter\n</code></pre></div>\n\n\n<p>But I have serious doubts about the legality of the parameters: <br>\n<code>patient:_has:Condition:subject:code=http://snomed.info/sct|386661006&amp;</code> and <code>_revinclude:iterate=Condition:subject</code></p>\n<p>In summary, the difficulty I have comes from the fact that I want to link resources together (Allergy And Condition) that refer to Patient, but that are not linked by a reference to each other.</p>\n<p>This is my first question on this forum. Feel free to tell me if it's better that I ask my question on another stream.</p>\n<p>Thank you in advance for your time!</p>\n<p><a href=\"/user_uploads/10155/7-5lmZBifq7FZME54_fuVijj/Graph_fhir-page-001.jpg\">diagram of the situation</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/7-5lmZBifq7FZME54_fuVijj/Graph_fhir-page-001.jpg\" title=\"diagram of the situation\"><img src=\"/user_uploads/10155/7-5lmZBifq7FZME54_fuVijj/Graph_fhir-page-001.jpg\"></a></div>",
        "id": 198212172,
        "sender_full_name": "Lucile",
        "timestamp": 1589987361
    },
    {
        "content": "<p>For chaining, the syntax would just be <code>patient.birthdate=1970</code>.  I don't know that we support chaining to _has though.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <br>\n(this is the right place - and congrats on raising an evil first question :&gt;)</p>",
        "id": 198213794,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1589987968
    },
    {
        "content": "<p>Thank you so much for getting back to me so quickly!</p>",
        "id": 198214323,
        "sender_full_name": "Lucile",
        "timestamp": 1589988169
    },
    {
        "content": "<p>I don't want to make assumptions about your use-case here, but most EHRs I've worked with don't support the parameters you're attempting to use. A simpler method to perform this lookup would be to pull the relevant resources via unique API calls then utilizing server-side logic to achieve your purpose with the retrieved data.</p>",
        "id": 198215244,
        "sender_full_name": "Scott Rossignol",
        "timestamp": 1589988492
    },
    {
        "content": "<p>It helps me a lot to know that most EHRs don't support the parameters I'm attempting to use.<br>\nI'm going to do as you suggested!</p>",
        "id": 198216822,
        "sender_full_name": "Lucile",
        "timestamp": 1589989148
    },
    {
        "content": "<p>Wow. A chained <code>_has</code>. I have never even considered this. :)</p>\n<p>Technically the correct syntax for that would be: </p>\n<div class=\"codehilite\"><pre><span></span><code>patient:Patient._has:Condition:subject:code=http://snomed.info/sct|386661006\n</code></pre></div>\n\n\n<p>..or just..</p>\n<div class=\"codehilite\"><pre><span></span><code>patient._has:Condition:subject:code=http://snomed.info/sct|386661006\n</code></pre></div>\n\n\n<p>I had my doubts this would work, but looks like HAPI is ok with it:</p>\n<p><a href=\"http://hapi.fhir.org/baseR4/AllergyIntolerance?patient._has:Condition:subject:code=http://snomed.info/sct|386661006\">http://hapi.fhir.org/baseR4/AllergyIntolerance?patient._has:Condition:subject:code=http://snomed.info/sct|386661006</a></p>",
        "id": 198233395,
        "sender_full_name": "James Agnew",
        "timestamp": 1589996926
    },
    {
        "content": "<p>Works also fine with Vonk. Not totally uncommon, I think it came up in a few threads here.</p>",
        "id": 198234020,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1589997213
    },
    {
        "content": "<p>I'm so glad it's working! Thank you so much for your help.</p>",
        "id": 198235140,
        "sender_full_name": "Lucile",
        "timestamp": 1589997778
    },
    {
        "content": "<p>Another small correction - you probably want address_country to be France, not address-state. I suspect many French people would be dismayed that their country has become an Australian state (for example). <span aria-label=\"grinning\" class=\"emoji emoji-1f600\" role=\"img\" title=\"grinning\">:grinning:</span></p>",
        "id": 198240353,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1590000170
    },
    {
        "content": "<p>Thank you very much! Indeed I would have been surprised</p>",
        "id": 198414908,
        "sender_full_name": "Lucile",
        "timestamp": 1590134443
    }
]