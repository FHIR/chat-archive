[
    {
        "content": "<p>Definition-based extraction directs us to \"fill in the Questionnaire.definition to point to the resource or profile element that Questionnaire item corresponds to ... The definition SHALL have the full canonical URL of the resource (or profile) followed by '#' followed by the snapshot.path of the element the Questionnaire item corresponds to.\"</p>\n<p>This makes sense to me with <code>Patient.active</code>, for example:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-itemContext&quot;,\n      &quot;valueExpression&quot;: {\n            &quot;expression&quot;: &quot;Patient&quot;,\n            &quot;language&quot;: &quot;application/x-fhir-query&quot;\n          }\n    }\n  ],\n  &quot;item&quot;: [\n    {\n      &quot;linkId&quot;: &quot;patient-active&quot;,\n      &quot;definition&quot;: &quot;http://hl7.org/fhir/StructureDefinition/Patient#Patient.active&quot;,\n      &quot;type&quot;: &quot;boolean&quot;,\n      &quot;required&quot;: false,\n      &quot;repeats&quot;: false\n    }\n  ]\n}\n</pre></div>\n\n\n<p>But I'm not sure what to do in the case of <code>Patient.name</code>. The complex data type <code>HumanName</code> doesn't have a direct mapping to an available <code>item.type</code>, and would require several pieces of information to answer anyways. But the snapshot.path on <code>Patient</code> doesn't go into the fields of <code>HumanName</code>, so we shouldn't (?) reference these from a Patient definition path:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;id&quot; : &quot;Patient.name&quot;,\n  &quot;path&quot; : &quot;Patient.name&quot;,\n    ...\n  &quot;min&quot; : 0,\n  &quot;max&quot; : &quot;*&quot;,\n  &quot;base&quot; : {\n    &quot;path&quot; : &quot;Patient.name&quot;,\n    &quot;min&quot; : 0,\n    &quot;max&quot; : &quot;*&quot;\n  },\n  &quot;type&quot; : [{\n    &quot;code&quot; : &quot;HumanName&quot;\n  }],\n    ...\n}\n</pre></div>\n\n\n<p>Does it make sense to do something like map the complex type to a \"group\", and then have the nested questions specify definitions on the complex type definition? e.g.</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Questionnaire&quot;,\n  &quot;extension&quot;: [\n    {\n      &quot;url&quot;: &quot;http://hl7.org/fhir/uv/sdc/StructureDefinition/sdc-questionnaire-itemContext&quot;,\n      &quot;valueExpression&quot;: {\n            &quot;expression&quot;: &quot;Patient&quot;,\n            &quot;language&quot;: &quot;application/x-fhir-query&quot;\n          }\n    }\n  ],\n  &quot;item&quot;: [\n    {\n      &quot;linkId&quot;: &quot;patient-name&quot;,\n      &quot;definition&quot;: &quot;http://hl7.org/fhir/StructureDefinition/Patient#Patient.name&quot;,\n      &quot;type&quot;: &quot;group&quot;,\n      &quot;repeats&quot;: false,\n      &quot;item&quot;: [\n        {\n          &quot;linkId&quot;: &quot;humanname-given&quot;,\n          &quot;definition&quot;: &quot;http://hl7.org/fhir/StructureDefinition/HumanName#HumanName.given&quot;,\n              &quot;type&quot;: &quot;string&quot;,\n              &quot;required&quot;: &quot;false&quot;,\n              &quot;repeats&quot;: &quot;true\n        },\n        ...\n      ]\n    }\n  ]\n}\n</pre></div>\n\n\n<p>It's still unclear how you would designate a complex type element as required with this set up, because what does it mean for a group to be \"required\"?</p>\n<p>Thoughts?</p>",
        "id": 181167647,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574208040
    },
    {
        "content": "<p>if you want to pre-populate like this, I think you need to use the SDC facilities around variables</p>",
        "id": 181179745,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574225410
    },
    {
        "content": "<p>In this case I'm not trying to pre-populate a QuestionnaireResponse item with initialValue or initialExpression, I still want the user to supply the information that goes into the <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a> element. I guess another way of phrasing is, \"how would I write a Questionnaire such that when definition-based extraction is run on a completed QuestionnaireResponse, an element with a complex type like <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a> can be captured?\"</p>",
        "id": 181234950,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574274429
    },
    {
        "content": "<p>You'd have to break it into multiple questions and the population process would map those into the individual elements</p>",
        "id": 181237242,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574276219
    },
    {
        "content": "<p>What definition path would you put on the item that's collecting a value for <code>Patient.name.family</code>?</p>",
        "id": 181272680,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574306136
    },
    {
        "content": "<p>that path</p>",
        "id": 181277327,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574313660
    },
    {
        "content": "<p>Right, this totally makes sense as a way to refer to that element, but it's not a <code>snapshot path</code>, is it? Or if it is, where is <code>snapshot path</code> defined? I'm taking it to mean a path that exists on a snapshot element of a resource StructureDefinition, which <code>Patient.name.family</code> is not.</p>\n<p>Thank you for being patient with me :)</p>",
        "id": 181574410,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574363833
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> why did we say 'snapshot' path? I can't think that this is useful - all it can do is confuse people like this?</p>",
        "id": 181611785,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574401506
    },
    {
        "content": "<p>Perhaps to reflect that you have access to all of the paths in the snapshot, not just the differential?  Given you can drill deeper than the  snapshot, agree it's confusing.</p>",
        "id": 181613066,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574403821
    },
    {
        "content": "<p>guess we should make a task to clarify that then</p>",
        "id": 181617474,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1574410323
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197081\">@Gabriela Brown</span> Are you able to submit a change request asking us to clarify the current language?</p>",
        "id": 181629296,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1574422124
    },
    {
        "content": "<p>yep, will do! Thanks, this is helpful.</p>",
        "id": 181668769,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574450386
    },
    {
        "content": "<p>Hm, so I was just reading <a href=\"https://www.hl7.org/fhir/questionnaire.html#definition\" target=\"_blank\" title=\"https://www.hl7.org/fhir/questionnaire.html#definition\">https://www.hl7.org/fhir/questionnaire.html#definition</a>, which has some relevant info that I'll include in the ticket but think is worth posting here too:</p>\n<p>\"The url refers to an ElementDefinition in StructureDefinition, and always starts with the canonical URL for the target resource. When referring to a StructureDefinition, a fragment identifier is used to specify the element definition by its id (<a href=\"http://Element.id\" target=\"_blank\" title=\"http://Element.id\">Element.id</a>). E.g. <a href=\"http://hl7.org/fhir/StructureDefinition/Observation#Observation.value[x]\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Observation#Observation.value[x]\">http://hl7.org/fhir/StructureDefinition/Observation#Observation.value[x]</a>. In the absence of a fragment identifier, the first/root element definition in the target is the matching element definition.\"</p>\n<p>This \"fragment identifier\" isn't really mentioned anywhere else in the specification that I can find, but suggests constraining to the \"snapshot path\" as well.</p>",
        "id": 181670668,
        "sender_full_name": "Gabriela Brown",
        "timestamp": 1574451856
    }
]