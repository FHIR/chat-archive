[
    {
        "content": "<p>Last week, the terminology server used by default by the Java JAR validator (<a href=\"http://tx.fhir.org/r3\" target=\"_blank\" title=\"http://tx.fhir.org/r3\">tx.fhir.org/r3</a>) was down for several days, causing validation errors. Now it's back up again, but I am seeing validation errors when validating codes in resources that had no errors before. All the errors have the same form, e.g.:</p>\n<p><code>Error @ Observation.code.coding (line 8, col17) : Error null validating Coding</code></p>\n<p>As far as I can tell, I get this for every field containing a code with a coding system. I am using a validator JAR downloaded today. </p>\n<p>Was there a deliberate change in the way codes are handled or is it a bug?</p>",
        "id": 153975992,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1531897282
    },
    {
        "content": "<p>bug</p>",
        "id": 153975995,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1531897653
    },
    {
        "content": "<p>things are changing too quickly.... my aim is to have all the substantiative changes made and things stable by the end of next week</p>",
        "id": 153975996,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1531897683
    },
    {
        "content": "<p>OK, thanks for the update!</p>",
        "id": 153976003,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1531901218
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Reviving this thread as I came across what seems to be a related problem. The validator now appears to break completely with the default terminology server.:</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar -defn http://hl7.org/fhir patient-example.xml\n  .. load FHIR from http://hl7.org/fhir\n  .. connect to tx server @ http://tx.fhir.org/r3\nException in thread &quot;main&quot; org.hl7.fhir.dstu3.utils.client.EFhirClientException: Error parsing response message\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:284)\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:179)\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:161)\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:152)\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.issueGetResourceRequest(ClientUtils.java:99)\n        at org.hl7.fhir.dstu3.utils.client.FHIRToolingClient.getCapabilitiesStatementQuick(FHIRToolingClient.java:169)\n        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:161)\n        at org.hl7.fhir.dstu3.validation.ValidationEngine.connectToTSServer(ValidationEngine.java:316)\n        at org.hl7.fhir.dstu3.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:169)\n        at org.hl7.fhir.dstu3.validation.Validator.main(Validator.java:214)\nCaused by: org.hl7.fhir.exceptions.FHIRFormatError: only whitespace content allowed before start tag and not D (position: START_DOCUMENT seen D... @1:1)\n        at org.hl7.fhir.dstu3.formats.XmlParserBase.parse(XmlParserBase.java:90)\n        at org.hl7.fhir.dstu3.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:277)\n        ... 9 more\nCaused by: org.xmlpull.v1.XmlPullParserException: only whitespace content allowed before start tag and not D (position: START_DOCUMENT seen D... @1:1)\n        at org.xmlpull.mxp1.MXParser.parseProlog(MXParser.java:1519)\n        at org.xmlpull.mxp1.MXParser.nextImpl(MXParser.java:1395)\n        at org.xmlpull.mxp1.MXParser.next(MXParser.java:1093)\n        at org.hl7.fhir.dstu3.formats.XmlParserBase.next(XmlParserBase.java:192)\n        at org.hl7.fhir.dstu3.formats.XmlParserBase.loadXml(XmlParserBase.java:182)\n        at org.hl7.fhir.dstu3.formats.XmlParserBase.parse(XmlParserBase.java:87)\n</pre></div>\n\n\n<p>If I explicitly switch off the terminology server (i.e. add <code>-tx n/a</code>), it works fine. However, if I do not set the <code>-defn</code> option, I get another error with or without terminology server (same error in both cases):</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar patient-example.xml -tx n/a\n  .. load FHIR from http://build.fhir.org/\n  .. connect to tx server @ null\nException in thread &quot;main&quot; java.lang.ClassCastException: com.google.gson.JsonArray cannot be cast to com.google.gson.JsonObject\n        at com.google.gson.JsonObject.getAsJsonObject(JsonObject.java:182)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseCodeSystemProperties(JsonParser.java:5018)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseCodeSystem(JsonParser.java:5007)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseResource(JsonParser.java:19571)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleBundleEntryComponentProperties(JsonParser.java:2754)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleBundleEntryComponent(JsonParser.java:2737)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundleProperties(JsonParser.java:2710)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseBundle(JsonParser.java:2685)\n        at org.hl7.fhir.dstu3.formats.JsonParser.parseResource(JsonParser.java:19555)\n        at org.hl7.fhir.dstu3.formats.JsonParserBase.parse(JsonParserBase.java:90)\n        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.loadFromFileJson(SimpleWorkerContext.java:199)\n        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.loadDefinitionItem(SimpleWorkerContext.java:151)\n        at org.hl7.fhir.dstu3.context.SimpleWorkerContext.fromDefinitions(SimpleWorkerContext.java:142)\n        at org.hl7.fhir.dstu3.validation.ValidationEngine.loadDefinitions(ValidationEngine.java:174)\n        at org.hl7.fhir.dstu3.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:168)\n        at org.hl7.fhir.dstu3.validation.Validator.main(Validator.java:214)\n</pre></div>\n\n\n<p>I'm using a validator I just downloaded.</p>",
        "id": 153990730,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535099367
    },
    {
        "content": "<p>Just for clarification, it's the validator you downloaded from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">http://build.fhir.org</a>?</p>",
        "id": 153990761,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1535123368
    },
    {
        "content": "<p>I don't think it is</p>",
        "id": 153990915,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1535320710
    },
    {
        "content": "<p>Indeed, I was using the STU 3 validator downloaded from</p>\n<p><a href=\"https://www.hl7.org/fhir/downloads.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/downloads.html\">https://www.hl7.org/fhir/downloads.html</a></p>\n<p>I tested again with the validator from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> but three I also run into errors (despite trying out different combinations of <code>-defn</code> and <code>-tx</code>). I see two errors reported, depending on the options passed:</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar patient-example.xml\n  .. connect to tx server @ http://tx.fhir.org/r4\nException in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: Unable to resolve the package &#39;hl7.fhir.core-3.5.0&#39;\n        at org.hl7.fhir.utilities.cache.PackageCacheManager.resolvePackage(PackageCacheManager.java:491)\n        at org.hl7.fhir.r4.validation.ValidationEngine.resolvePackage(ValidationEngine.java:541)\n        at org.hl7.fhir.r4.validation.ValidationEngine.fetchByPackage(ValidationEngine.java:530)\n        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgSource(ValidationEngine.java:390)\n        at org.hl7.fhir.r4.validation.ValidationEngine.loadDefinitions(ValidationEngine.java:298)\n        at org.hl7.fhir.r4.validation.ValidationEngine.loadInitialDefinitions(ValidationEngine.java:263)\n        at org.hl7.fhir.r4.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:288)\n        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:337)\n</pre></div>\n\n\n<p>and</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar -defn http://hl7.org/fhir patient-example.xml\n  .. connect to tx server @ http://tx.fhir.org/r4\n   ... Using version 3.0.1\n-tx cache miss: Connect to http://tx.fhir.org/r4\n    (v3.0.1-null)\n  .. validate [patient-example.xml]\nException in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: Unable to resolve the package &#39;patient-example.xml&#39;\n        at org.hl7.fhir.utilities.cache.PackageCacheManager.resolvePackage(PackageCacheManager.java:491)\n        at org.hl7.fhir.r4.validation.ValidationEngine.resolvePackage(ValidationEngine.java:541)\n        at org.hl7.fhir.r4.validation.ValidationEngine.fetchByPackage(ValidationEngine.java:530)\n        at org.hl7.fhir.r4.validation.ValidationEngine.loadIgSource(ValidationEngine.java:390)\n        at org.hl7.fhir.r4.validation.ValidationEngine.loadContent(ValidationEngine.java:720)\n        at org.hl7.fhir.r4.validation.ValidationEngine.validate(ValidationEngine.java:750)\n        at org.hl7.fhir.r4.validation.Validator.main(Validator.java:395)\n</pre></div>\n\n\n<p>(this is what I see after the specs were already fetched and cached - failed be fore caching, too, though)</p>",
        "id": 153990960,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535366136
    },
    {
        "content": "<p>have you followed the instructions here: <a href=\"http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\">http://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator</a></p>",
        "id": 153990967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1535367875
    },
    {
        "content": "<p>I thought I had - but after following your hint, I realized that I had simply forgotten \"./\" in the path to the file to validate (didn't know the <code>-version</code> parameter, either)...   So now the following runs through fine on the <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> validator -  thanks!</p>\n<div class=\"codehilite\"><pre><span></span>java -jar org.hl7.fhir.validator.jar ./patient-example.xml -version 3.0.1\n</pre></div>\n\n\n<p>So I will just use that now. (The validator downloaded from the STU 3 page still seems to give an error with this command, however.)</p>",
        "id": 153990969,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535369407
    },
    {
        "content": "<p>I don't understand why ./ makes any difference</p>",
        "id": 153990970,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1535369443
    },
    {
        "content": "<p>My apologies if I am confusing things here - I just noticed that if the file to validate is in the same directory as the validator itself, then giving the file path as simply \"example-patient.xml\" causes an error while \"./example-patient.xml\" works (when running the validator from the directory).</p>",
        "id": 153990976,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535371698
    },
    {
        "content": "<p>.. that's... weird. Doesn't happen on windows. I'll have to debug on OSX...</p>",
        "id": 153990980,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1535371905
    },
    {
        "content": "<p>I'm seeing it on Window 10,. I tested on three different shells now (normal CMD, Git CMD and PowerShell): All of them work with \"./\" or \".\\\" prefixed to the filename, but none work without such a prefix.</p>",
        "id": 153990982,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535372252
    },
    {
        "content": "<p>what directory are you in? I never use ./ on windows 10</p>",
        "id": 153990984,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1535372410
    },
    {
        "content": "<p>In the directory containing both the validator and the file I want to validate.</p>",
        "id": 153990986,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535372700
    },
    {
        "content": "<p>BTW: I seemed to see another validator problem, but since I am pretty sure it has nothing to do with terminology servers, I decided to put it in a separate thread to have a more fitting title: <a href=\"#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles\" title=\"#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles\">https://chat.fhir.org/#narrow/stream/4-implementers/subject/Validator.20-.20trouble.20loading.20custom.20profiles</a></p>",
        "id": 153991240,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1535464917
    }
]