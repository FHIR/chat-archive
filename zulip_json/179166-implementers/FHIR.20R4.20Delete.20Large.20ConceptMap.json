[
    {
        "content": "<p>Hi All, I am new to this portal and do not exactly know the question template so please bear with me.</p>\n<p><strong>Preface</strong>: We are using hapi fhir r4 5.1 version and the FHIR client update method to update a resource or create a resource (if the resource doesn't already exist).</p>\n<p><strong>Problem</strong>: We have a large ConcepMap containing thousands of mapping. When an existing ConceptMap is upserted, it takes around 25 minutes to perform the operation. More importantly and <em>surprisingly</em>, the delete operation in the upsert is taking 20min (<strong>~67%</strong> time).<br>\nIs there a way to optimize it?</p>\n<p>We are using elastic search with FHIR.</p>\n<p>Thanks.</p>",
        "id": 244439750,
        "sender_full_name": "Surendra",
        "timestamp": 1625066188
    },
    {
        "content": "<p>What FHIR server are you using?  That certainly sounds like a database design/indexing issue.  (If the problem was just transmission time, you could look at using PATCH for a pure update, but for upsert, that wouldn't work.)</p>",
        "id": 244445251,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1625068273
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> We are using hapi-fhir-jpa-server. Database design/indexing is provided by hapi-fhir itself.</p>\n<p>using IGenericClient to perform the operation like this</p>\n<div class=\"codehilite\"><pre><span></span><code>fhiClient.update().resource(&lt;RESOURCE&gt;).execute()\n</code></pre></div>",
        "id": 244445745,
        "sender_full_name": "Surendra",
        "timestamp": 1625068468
    },
    {
        "content": "<p>Here is the code which takes this 66% of the time to delete the existing resource before creating a new</p>\n<p><a href=\"https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermConceptMappingSvcImpl.java#L583-L598\">https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-jpaserver-base/src/main/java/ca/uhn/fhir/jpa/term/TermConceptMappingSvcImpl.java#L583-L598</a></p>",
        "id": 244446632,
        "sender_full_name": "Surendra",
        "timestamp": 1625068791
    },
    {
        "content": "<p>You may be best raising this on the <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a> stream</p>",
        "id": 244467569,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1625077505
    },
    {
        "content": "<p>This is definitely a known limitation that we'd like to address. Most of our perf work has been done to the lookup of codes/valuesets/concept mappings since that is more critical to be fast, but some of the write operations are quite unoptimized.</p>",
        "id": 244469442,
        "sender_full_name": "James Agnew",
        "timestamp": 1625078298
    }
]