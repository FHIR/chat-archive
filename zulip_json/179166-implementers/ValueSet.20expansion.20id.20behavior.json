[
    {
        "content": "<p>When you ask for an expansion of a ValueSet then:</p>\n<p>- <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> SHOULD be a uuid to allow receivers to track a particular expansion (<a href=\"http://hl7-fhir.github.io/valueset-operations.html#expand\" target=\"_blank\" title=\"http://hl7-fhir.github.io/valueset-operations.html#expand\">http://hl7-fhir.github.io/valueset-operations.html#expand</a>)</p>\n<p>- ValueSet.identifier SHOULD be what? Definition: \"Additional identifier for the value set\"<br>\n- ValueSet.expansion.identifier SHOULD be what? Definition: \"Uniquely identifies this expansion\"</p>\n<p>It occurs to me that ValueSet.expansion.identifier is in fact a duplicate of ValueSet.identifier, and because of the nature of expansions, ValueSet.identifier in turn is duplicating <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a>.</p>\n<p>So should, for expansion, the ValueSet.identifier and ValueSet.expansion.identifier be populated at all?</p>",
        "id": 153839348,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468845774
    },
    {
        "content": "<p>Second thing: if you picture a system that at some interval asks for expansions of a ValueSet, what happens when you retrieve a new expansion for the same logical ValueSet when every expansion has a shiny new UUID?</p>\n<p>I am asking because we supply Bundles with expansions for all relevant ValueSets in a paricular use case. How would an implementer know that expansion X1 is of logical valueset Y so that upon receiving expansion X2 of valueset Y, he knows that he needs to update X1 in his system?</p>",
        "id": 153839349,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468846194
    },
    {
        "content": "<p>you missed canonical URL which si that most important thing </p>",
        "id": 153839350,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468846352
    },
    {
        "content": "<p>canonical URL and identifier have the same scope, but identifier is used for non-FHIR usage </p>",
        "id": 153839351,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468846373
    },
    {
        "content": "<p>.expansion.id you can reuse as long as the expansion is identical. </p>",
        "id": 153839352,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468846397
    },
    {
        "content": "<p>I don't remember what I do with <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> on return</p>",
        "id": 153839353,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468846422
    },
    {
        "content": "<p>Canonical URL always points to the object it is on right? But if the object is a runtime generated object (expansion), then the canonical URL also shall be of the expansion, not of the definitional valueset it was generated from?</p>",
        "id": 153839357,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468846705
    },
    {
        "content": "<p>Suppose what you say is right then both ValueSet.identifier and ValueSet.url SHALL be of the definitional valueset (intensional/extensional) which makes them behave differently on ValueSet expansions then on any other FHIR resource as far as I can tell</p>",
        "id": 153839358,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468846803
    },
    {
        "content": "<p>(<a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> is 'defined' in the examples under <a href=\"http://hl7-fhir.github.io/valueset-operations.html#expand\" target=\"_blank\" title=\"http://hl7-fhir.github.io/valueset-operations.html#expand\">http://hl7-fhir.github.io/valueset-operations.html#expand</a> in an XML comment :-) as \"&lt;!-- the server SHOULD populate the id with a newly created UUID so clients can easily track a particular expansion  --&gt;\")</p>",
        "id": 153839360,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468846905
    },
    {
        "content": "<p>Your system (<a href=\"http://fhir-dev.healthintersections.com.au/open/ValueSet/v2-0354/$expand\" target=\"_blank\" title=\"http://fhir-dev.healthintersections.com.au/open/ValueSet/v2-0354/$expand\">http://fhir-dev.healthintersections.com.au/open/ValueSet/v2-0354/$expand</a>):<br>\n- Does not do <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a><br>\n- Gives the definitional ValueSet.identifier (e.g. &lt;url value=\"http://hl7.org/fhir/ValueSet/v2-0354\"/&gt;)<br>\n- Gives the expansion UUID in ValueSet.expansion.identifier (e.g. &lt;identifier value=\"urn:uuid:0ea43aa0-d645-41c2-b77c-a05679abe78b\"/&gt;)</p>",
        "id": 153839361,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468847143
    },
    {
        "content": "<blockquote>\n<p>canonical URL and identifier have the same scope, but identifier is used for non-FHIR usage</p>\n</blockquote>\n<p>This also raises an interesting question: I can find no text that says that a canonical URL needs to resolve to somewhere although there is a preference it does. But more importantly: I cannot find any text that says that *if* it resolves *then* it SHALL be a FHIR endpoint. Background: we offer a service that produces FHIR STU2 compatible ValueSet expansions, but not on a FHIR Terminology Services endpoint.</p>",
        "id": 153839362,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468848141
    },
    {
        "content": "<p>Created <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=10375\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=10375\">GF#10375</a></p>",
        "id": 153839415,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468871138
    },
    {
        "content": "<p>hang on! too quick! I'll get to this, but I've been asleep and on the phone....</p>",
        "id": 153839438,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468876068
    },
    {
        "content": "<p>O I wasn't trying to bypass you. I thought you would actually appreciate the task. Sorry I've already created it. I can withdraw if we get closure here, but I believe some enhancement text is in order anyhow.</p>",
        "id": 153839448,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879482
    },
    {
        "content": "<p>having a task is not a problem, but I think had we waited it, it would have been more precise</p>",
        "id": 153839450,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879515
    },
    {
        "content": "<p>Ah. Ok let's give that a try, and I can withdraw and open a new one that aims for just that</p>",
        "id": 153839451,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879568
    },
    {
        "content": "<p>so, the canonical URL and the identifier both identify the value set object. That is, whether you have a cld or an expansion, it's still the same value set</p>",
        "id": 153839453,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879629
    },
    {
        "content": "<p>So the basic question is better guidance on these paths:<br>\n- <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a><br>\n- ValueSet.identifier -- Shall be that of the definitional ValueSet<br>\n- ValueSet.url -- Shall be that of the definitional ValueSet<br>\n- ValueSet.expansion.identifier</p>",
        "id": 153839454,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879679
    },
    {
        "content": "<p><a href=\"http://ValueSet.expansion.id\" target=\"_blank\" title=\"http://ValueSet.expansion.id\">ValueSet.expansion.id</a> identifies a specific expansion of the value set - may be filtered, a particular page in a paged view, and is subject to expansion conditions</p>",
        "id": 153839455,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879690
    },
    {
        "content": "<p>a terminology server might re-issue an expansion with the same expansion id, but it must be identical</p>",
        "id": 153839456,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879720
    },
    {
        "content": "<p>And <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> == ValueSet.expansion.identifier? At least according to current guidance it appears to be</p>",
        "id": 153839458,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879760
    },
    {
        "content": "<p><a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> is the local identifier for the resource. In an expansion response, I'd expect that to blank, unles a GET ValueSet/[id] returns the same expansion</p>",
        "id": 153839459,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879769
    },
    {
        "content": "<p>so, no, not necessarily the same</p>",
        "id": 153839460,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879787
    },
    {
        "content": "<p>though I'm not sure when it would be different as opposed to missing. I'll have to think through scenarios on that</p>",
        "id": 153839461,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879820
    },
    {
        "content": "<p>So how would you read this then: <a href=\"http://hl7-fhir.github.io/valueset-operations.html#expand\" target=\"_blank\" title=\"http://hl7-fhir.github.io/valueset-operations.html#expand\">http://hl7-fhir.github.io/valueset-operations.html#expand</a></p>",
        "id": 153839462,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879821
    },
    {
        "content": "<p>-- <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> SHOULD be a uuid to allow receivers to track a particular expansion</p>",
        "id": 153839463,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879846
    },
    {
        "content": "<p>Is that remark not accurate?</p>",
        "id": 153839464,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468879859
    },
    {
        "content": "<p>I think that should say '<a href=\"http://ValueSet.expansion.id\" target=\"_blank\" title=\"http://ValueSet.expansion.id\">ValueSet.expansion.id</a>\"</p>",
        "id": 153839465,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879885
    },
    {
        "content": "<p>where is that remark? I don't see it</p>",
        "id": 153839466,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468879937
    },
    {
        "content": "<p>It is an xml comment in the Response example</p>",
        "id": 153839467,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468880021
    },
    {
        "content": "<p>ah</p>",
        "id": 153839469,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880051
    },
    {
        "content": "<p>I think it's wrong. </p>",
        "id": 153839470,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880055
    },
    {
        "content": "<p>should be on <a href=\"http://expansion.id\" target=\"_blank\" title=\"http://expansion.id\">expansion.id</a></p>",
        "id": 153839471,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880066
    },
    {
        "content": "<p>Right. So I think I am clear on where we're heading. Just one thing that hunts my mind: the .identifier and .url in any resource points to the object it is on. In an expansion it points to a different object (the definitional ValueSet). Isn't that inconsistent?</p>",
        "id": 153839472,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468880072
    },
    {
        "content": "<p>And to summarize where we go so far:</p>\n<p>On a ValueSet expansion:<br>\n- <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> -- leave empty unless one can retrieve the exact same expansion under that id<br>\n- ValueSet.identifier -- SHALL be that of the definitional ValueSet<br>\n- ValueSet.url -- SHALL be that of the definitional ValueSet<br>\n- ValueSet.expansion.identifier -- SHOULD be a uuid to allow receivers to track a particular expansion</p>\n<p>I would prefer SHALL on that last one.</p>",
        "id": 153839477,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468880377
    },
    {
        "content": "<p>- ValueSet.identifier -- SHALL be that of the definitional ValueSet<br>\n- ValueSet.url -- SHALL be that of the definitional ValueSet</p>",
        "id": 153839481,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880572
    },
    {
        "content": "<p>not quite </p>",
        "id": 153839482,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880575
    },
    {
        "content": "<p>- ValueSet.identifier -- SHALL be that of the master ValueSet<br>\n- ValueSet.url -- SHALL be that of the master ValueSet</p>",
        "id": 153839483,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880583
    },
    {
        "content": "<p>the master may just be an expansion. I think that's terrible practice, myself, and you may happily not have that practice, but there's plenty of legacy value sets where that will be true</p>",
        "id": 153839484,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880612
    },
    {
        "content": "<p>if you asume that you always have a definition, then you're correct</p>",
        "id": 153839485,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468880628
    },
    {
        "content": "<p>Fair enough. I did not think of expansion on expansion, but I guess it is possible. Leaves the disjunct between how .identifier/.url normally behave and how they behave on expansion. Would you say that is inconsistent or how would you explain it is not?</p>",
        "id": 153839498,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468881924
    },
    {
        "content": "<p>what's the disjuncture?</p>",
        "id": 153839503,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468882234
    },
    {
        "content": "<p>the .identifier and .url in any resource points to the object it is on. In an expansion it points to a different object (the definitional/master ValueSet). Isn't that inconsistent?</p>",
        "id": 153839507,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468882697
    },
    {
        "content": "<p>the url identifies the master definition. An expansion is still derived from the master value set, and an expression of it. So I don't think it's inconsistent. The canonical URL points to the underling idea, not any particular instantiation of it </p>",
        "id": 153839508,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468882975
    },
    {
        "content": "<p>I was afraid you were going to say that. So an expansion cannot have its own identifier, nor url. So what about that awful use case you'd rather not see: the expansion that does not have a definition?</p>",
        "id": 153839509,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883078
    },
    {
        "content": "<p>well, presumably, that expansion is a proxy for the definition. So any subset of the expansion is still the same thing - a form of expression of the underyling idea. </p>",
        "id": 153839510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883169
    },
    {
        "content": "<p>Maybe yes maybe no. How about when I use that expansion without definition in an ImplementationGuide? Would I not need a canonical id/identifier/url for that ValueSet except that it cannot have one?</p>",
        "id": 153839511,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883311
    },
    {
        "content": "<p>'cannot have one'? </p>",
        "id": 153839516,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883450
    },
    {
        "content": "<p>Admitted, we established id is possible, but url and identifier are not. However id is not the same as a canonical thing. It varies from server to server.</p>",
        "id": 153839517,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883517
    },
    {
        "content": "<p>url and identifier are not possible because there is no definitional valueset to point to.</p>",
        "id": 153839518,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883562
    },
    {
        "content": "<p>I haven't said that, and wouldn't have</p>",
        "id": 153839519,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883578
    },
    {
        "content": "<p>I'm confused. How can one have an expansion without a valueset?</p>",
        "id": 153839521,
        "sender_full_name": "Jim Steel",
        "timestamp": 1468883623
    },
    {
        "content": "<p>Well maybe because the definitional ValueSet does not exist in the FHIR space?</p>",
        "id": 153839522,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883663
    },
    {
        "content": "<p>no, the right question is, 'how can I have an expansion without also *me* having the the definition\". And the answer is, if someone has it but didn't share it with you </p>",
        "id": 153839523,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883669
    },
    {
        "content": "<p>That sounds like a good second reason</p>",
        "id": 153839524,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883695
    },
    {
        "content": "<p>but the thought experiment is worthwhile: there is an idea somewhere, and that has the canonical URL, so an expansion only value set does</p>",
        "id": 153839525,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883700
    },
    {
        "content": "<p>Where you still chewing on that sentence or was that a finished statement? If it was, then who would be in charge of adding the canonical URL for the \"idea\" on that expansion?</p>",
        "id": 153839528,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468883903
    },
    {
        "content": "<p>whoever owns the original expansion. </p>",
        "id": 153839529,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468883989
    },
    {
        "content": "<p>VSAC, for instance, that only has expansions. Or at least, that's what they had till recently </p>",
        "id": 153839530,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884010
    },
    {
        "content": "<p>I'm still puzzled by the idea that the canonical URL on an expansion points to a different object than the thing it is on.</p>",
        "id": 153839532,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468884090
    },
    {
        "content": "<p>A derivative object and the object it is derived from, in my mind means we have 2 objects. Just like a profile on Patient receives a different canonical URL from a profile that is based on that profile.</p>",
        "id": 153839535,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468884265
    },
    {
        "content": "<p>If the canonical URL for and expansion would be [canonical URL of master]/$expand</p>\n<p>I would be less puzzled.</p>",
        "id": 153839536,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468884363
    },
    {
        "content": "<p>I think you're confused between <a href=\"http://ValueSet.id\" target=\"_blank\" title=\"http://ValueSet.id\">ValueSet.id</a> and ValueSet.url. The id does change as the object is cloned or new related objects are derived from it. </p>",
        "id": 153839537,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884666
    },
    {
        "content": "<p>it's the thing that identifies the object </p>",
        "id": 153839538,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884677
    },
    {
        "content": "<p>So it is wrong to assume that two objects carrying the same canonical URL will be the same and resolve to the same object?</p>",
        "id": 153839539,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468884754
    },
    {
        "content": "<p>we do not have 'expansion' as a concept on StructureDefinition, so there is no direct parallel. if we somehow defined conditions where the snapshot could be generated differently under different circumstances, then we'd be having the same dicussion about StructureDefinition</p>",
        "id": 153839540,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884776
    },
    {
        "content": "<p>yes. not necessarily the same *object*</p>",
        "id": 153839541,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884790
    },
    {
        "content": "<p>but must the same underling idea</p>",
        "id": 153839542,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468884798
    },
    {
        "content": "<p>I'm sorry but that idea doesn't come to me naturally. I should probably sleep on it since it is 01:34 here. What shall I do with the other things? Just update the existing tracker item with the summary or withdraw that and create a new one? Main goal is additional guidance along the lines of what we discussed</p>",
        "id": 153839543,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468884921
    },
    {
        "content": "<p>note sure. I'll think on that while you sleep</p>",
        "id": 153839544,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468885001
    },
    {
        "content": "<p>:-) ttyl</p>",
        "id": 153839545,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468885030
    },
    {
        "content": "<p>Back online. My sleep did not bring new insights, other than a clear head. Did you reach any conclusions?</p>",
        "id": 153839640,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468930849
    },
    {
        "content": "<p>well no one else said anything. let me try something</p>",
        "id": 153839643,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468931009
    },
    {
        "content": "<p>see the terminology stream</p>",
        "id": 153839646,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1468931062
    },
    {
        "content": "<p>Continuing conversation in <a href=\"https://chat.fhir.org/#narrow/stream/terminology/subject/ValueSet.2Eurl.20and.20.2Eidentifier.20on.20expansions\" target=\"_blank\" title=\"https://chat.fhir.org/#narrow/stream/terminology/subject/ValueSet.2Eurl.20and.20.2Eidentifier.20on.20expansions\">https://chat.fhir.org/#narrow/stream/terminology/subject/ValueSet.2Eurl.20and.20.2Eidentifier.20on.20expansions</a> closing here.</p>",
        "id": 153839675,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1468944509
    }
]