[
    {
        "content": "<p>I want to profile Patient (<a href=\"https://my.profile\">https://my.profile</a>) that a certain slice SHOULD exist, not MUST, and hence want a validation warning rather than an error, on the conformant Resource.</p>\n<p>Getting a <code>Error: Exception in thread \"main\" java.lang.Error: Not done yet (ValidatorHostServices.resolveFunction): slice</code> from HL7 validator.</p>\n<p>Is my approach in the right direction, and how to overcome .slice() apparently not being implemented yet?</p>\n<div class=\"codehilite\"><pre><span></span><code>   &lt;element id=&quot;Patient.identifier&quot;&gt;\n      &lt;path value=&quot;Patient.identifier&quot;/&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=&quot;pattern&quot;/&gt;\n          &lt;path value=&quot;type.coding&quot;/&gt;\n        &lt;/discriminator&gt;\n        &lt;description value=&quot;At least MR type Identifier is required&quot;/&gt;\n        &lt;rules value=&quot;open&quot;/&gt;\n      &lt;/slicing&gt;\n      &lt;constraint&gt;\n        &lt;key value=&quot;mrslice&quot; /&gt;\n        &lt;severity value=&quot;warning&quot; /&gt;\n        &lt;human value=&quot;MyPatient SHOULD have an MR Identifier slice&quot; /&gt;\n        &lt;expression value=&quot;$this.slice(&#39;https://my.profile&#39;, &#39;MRSlice&#39;).exists()&quot; /&gt;\n        &lt;source value=&quot;https://my.profile&quot; /&gt;\n      &lt;/constraint&gt;\n      &lt;mustSupport value=&quot;true&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Patient.identifier:MRSlice&quot;&gt;\n      &lt;path value=&quot;Patient.identifier&quot;/&gt;\n      &lt;sliceName value=&quot;MRSlice&quot;/&gt;\n      &lt;min value=&quot;0&quot;/&gt;\n      &lt;max value=&quot;1&quot;/&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Patient.identifier:MRSlice.use&quot;&gt;\n      &lt;path value=&quot;Patient.identifier.use&quot;/&gt;\n      &lt;fixedCode value=&quot;official&quot;/&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;Patient.identifier:MRSlice.type.coding&quot;&gt;\n      &lt;path value=&quot;Patient.identifier.type.coding&quot;/&gt;\n      &lt;patternCoding&gt;\n        &lt;system value=&quot; http://terminology.hl7.org/CodeSystem/v2-0203&quot;/&gt;\n        &lt;code value=&quot;MR&quot;/&gt;\n      &lt;/patternCoding&gt;\n    &lt;/element&gt;\n</code></pre></div>",
        "id": 276119421,
        "sender_full_name": "David Simons",
        "timestamp": 1647899870
    },
    {
        "content": "<p>It seems right.  Only way to overcome the slice not existing would be to drive the invariant by the discriminator values for the slice</p>",
        "id": 276125591,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647904318
    },
    {
        "content": "<p>For completeness, indeed I switched to a constraint at the Patient resource level, for example:</p>\n<div class=\"codehilite\"><pre><span></span><code>  &lt;differential&gt;\n    &lt;element id=&quot;Patient&quot;&gt;\n      &lt;path value=&quot;Patient&quot;/&gt;\n      &lt;constraint&gt;\n        &lt;key value=&quot;identifierofficial&quot; /&gt;\n        &lt;severity value=&quot;warning&quot; /&gt;\n        &lt;human value=&quot;SHOULD have exactly 1 &#39;official&#39; Identifier&quot; /&gt;\n        &lt;expression value=&quot;identifier.where(use=&#39;official&#39;).count() = 1&quot; /&gt;\n        &lt;source value=&quot;https://my.profile&quot; /&gt;\n      &lt;/constraint&gt;\n    &lt;/element&gt;\n  &lt;/differential&gt;\n</code></pre></div>",
        "id": 276842176,
        "sender_full_name": "David Simons",
        "timestamp": 1648456535
    },
    {
        "content": "<p>As an example, drawing from my own jurisdiction, 'official' would be the medical record number assigned by the clinic.  'usual' would be a provincial health number.  (Most people know and use their provincial health number, almost no-one knows their MRN.)</p>",
        "id": 276887356,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1648480039
    }
]