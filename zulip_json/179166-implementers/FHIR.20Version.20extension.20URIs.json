[
    {
        "content": "<p>This section of the FHIR spec: <a href=\"http://build.fhir.org/versions.html#extensions\">http://build.fhir.org/versions.html#extensions</a> describes / defines how to use URIs of the form <code>http://hl7.org/fhir/[version]/StructureDefinition/extension-[Path]</code> to reference elements from an arbitrary FHIR Version as an extension element.</p>\n<p>It also states:</p>\n<blockquote>\n<p>The [Path] is actually the <a href=\"http://ElementDefinition.id\">ElementDefinition.id</a> from the relevant StructureDefinition for the element.</p>\n</blockquote>\n<p>However, the <a href=\"http://ElementDefinition.id\">ElementDefinition.id</a> I wish to refer to ends with <code>.value[x]</code> which contains the characters \"[\" and \"]\" which are not permitted in a URI.</p>\n<p>Should I instead be %-encoding these values leading to an extension looking like:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code>  <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n    <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.dependsOn.value%5Bx%5D\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"valueDateTime\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2015-03-13\"</span>\n  <span class=\"p\">}]</span>\n</code></pre></div>",
        "id": 269063018,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1643003930
    },
    {
        "content": "<p>I think they were replaced with _ but I'm not 100% sure, I'll see if I can dig something out as reference material</p>",
        "id": 269097277,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1643026985
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> , _ would be good because %-encoding introduces variability around case (%5b %5B etc)</p>",
        "id": 269206110,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1643082168
    },
    {
        "content": "<p>The other question I have about this relates to what should be done in the case of a \"sibling\" element that is defined in terms of another element via a contentReference.  In my case, <code>ConceptMap.group.element.target.product</code> is defined by reference to <code>ConceptMap.group.element.target.dependsOn</code>, so does this imply correspondingly re-based element Paths/Ids?</p>",
        "id": 269208043,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1643084245
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/qmYO0ltKJ9MVbaW3Ki6ExUxk/image.png\">image.png</a> <br>\nYup, underscore.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/qmYO0ltKJ9MVbaW3Ki6ExUxk/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/qmYO0ltKJ9MVbaW3Ki6ExUxk/image.png\"></a></div>",
        "id": 269208054,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1643084263
    },
    {
        "content": "<p>Great, so:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"w\">  </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.dependsOn.value_x_\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"valueDateTime\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2015-03-13\"</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}]</span><span class=\"w\"></span>\n</code></pre></div>\n<p>and</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"w\">  </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product.value_x_\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"valueDateTime\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"2015-03-13\"</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}]</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 269208287,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1643084543
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> is that underscore replacement approach documented somewhere in the spec?</p>",
        "id": 269539110,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1643272201
    },
    {
        "content": "<p>I don't remember.</p>",
        "id": 269543870,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1643275108
    },
    {
        "content": "<p>I've now tried running the latest command line validator on a ValueSet resource containing one of these extensions and it \"doesn't work\".<br>\nThe input included:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"w\">        </span><span class=\"nt\">\"contains\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"code\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"inactive\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"value[x]\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"valueBoolean\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"code\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"parent\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">},</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"value_x_\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"302168000\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://snomed.info/sct\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"74400008\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"display\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Appendicitis\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"> </span><span class=\"p\">]</span><span class=\"w\"></span>\n</code></pre></div>\n<p>and it accepts the <code>value[x]</code> (which includes the URI-invalid characters '[' and ']'), but rejects <code>value_x_</code></p>\n<div class=\"codehilite\"><pre><span></span><code>FHIR Validation tool Version 5.6.34 (Git# edd2c43e64b7). Built 2022-02-16T14:24:56.912Z (33 hours old)\n  Java:   11.0.11 from /Library/Java/JavaVirtualMachines/zulu-11.jdk/Contents/Home on aarch64 (64bit). 8192MB available\n  Paths:  Current = /Users/law223/Documents/SRC/ontoserver4, Package Cache = /Users/law223/.fhir/packages\n  Params: -version 4.0 /tmp/vs.json\nLoading\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1 - 4575 resources (00:02.0868)\n  Load hl7.terminology#3.0.0 - 3795 resources (00:01.0289)\n  Terminology server http://tx.fhir.org - Version 2.0.12-SNAPSHOT (00:02.0789)\n  Get set...  go (00:00.0067)\nValidating\n  Validate /tmp/vs.json   ..Detect format for /tmp/vs.json\nInternal error in location for message: &#39;Error @1, 1: Premature ExpressionNode termination at unexpected token &quot;[&quot;&#39;, loc = &#39;ValueSet.expansion.contains[0].extension[1].extension[1][url=&#39;value_x_&#39;]&#39;, err = &#39;Sub-extension url &#39;value_x_&#39; is not defined by the Extension http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property&#39;\n 00:02.0549\nDone. Times: Loading: 00:07.0143, validation: 00:02.0549. Memory = 845Mb\n\n*FAILURE*: 1 errors, 0 warnings, 1 notes\n  Error @ ValueSet.expansion.contains[0].extension[1].extension[1][url=&#39;value_x_&#39;] (line 40, col7): Sub-extension url &#39;value_x_&#39; is not defined by the Extension http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\n  Information @ ValueSet.expansion.contains[0].extension[1].extension[1] (line 40, col7): This element does not match any known slice defined in the profile http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\n</code></pre></div>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> this looks like a tooling error?</p>",
        "id": 272344122,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1645144075
    },
    {
        "content": "<p>it should be just <code>value</code> according to decision made by FHIR-I</p>",
        "id": 272348174,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645147396
    },
    {
        "content": "<p>Which also gives an error:</p>\n<div class=\"codehilite\"><pre><span></span><code>Internal error in location for message: &#39;Error @1, 1: Premature ExpressionNode termination at unexpected token &quot;[&quot;&#39;, loc = &#39;ValueSet.expansion.contains[0].extension[0].extension[1][url=&#39;value&#39;]&#39;, err = &#39;Sub-extension url &#39;value&#39; is not defined by the Extension http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property&#39;\nInternal error in location for message: &#39;Error @1, 1: Premature ExpressionNode termination at unexpected token &quot;[&quot;&#39;, loc = &#39;ValueSet.expansion.contains[0].extension[1].extension[1][url=&#39;value&#39;]&#39;, err = &#39;Sub-extension url &#39;value&#39; is not defined by the Extension http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property&#39;\n</code></pre></div>",
        "id": 272348334,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1645147534
    },
    {
        "content": "<p>I'm also running into questions with elements defined by content reference e.g.,</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"w\">  </span><span class=\"nt\">\"ConceptMap.group.element.target.product\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"types\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"s2\">\"@ConceptMap.group.element.target.dependsOn\"</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">},</span><span class=\"w\"></span>\n</code></pre></div>\n<p>the URI <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product.value[x]</code> is rejected, and if I instead attempt to use <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product</code> with a nested extension for the <code>value[x]</code> part, then the validator throws <code>org.hl7.fhir.exceptions.DefinitionException</code></p>\n<div class=\"codehilite\"><pre><span></span><code>Validation Infrastructure fail validating /tmp/cm.json: StructureDefinition http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product at Extension.value[x]: illegal constrained type @ConceptMap.group.element.target.dependsOn from base64Binary, boolean, canonical, code, date, dateTime, decimal, id, instant, integer, markdown, oid, positiveInt, string, time, unsignedInt, uri, url, uuid, Address, Age, Annotation, Attachment, CodeableConcept, Coding, ContactPoint, Count, Distance, Duration, HumanName, Identifier, Money, Period, Quantity, Range, Ratio, Reference, SampledData, Signature, Timing, ContactDetail, Contributor, DataRequirement, Expression, ParameterDefinition, RelatedArtifact, TriggerDefinition, UsageContext, Dosage, Meta in http://hl7.org/fhir/StructureDefinition/Extension\nException in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: org.hl7.fhir.exceptions.DefinitionException: StructureDefinition http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product at Extension.value[x]: illegal constrained type @ConceptMap.group.element.target.dependsOn from base64Binary, boolean, canonical, code, date, dateTime, decimal, id, instant, integer, markdown, oid, positiveInt, string, time, unsignedInt, uri, url, uuid, Address, Age, Annotation, Attachment, CodeableConcept, Coding, ContactPoint, Count, Distance, Duration, HumanName, Identifier, Money, Period, Quantity, Range, Ratio, Reference, SampledData, Signature, Timing, ContactDetail, Contributor, DataRequirement, Expression, ParameterDefinition, RelatedArtifact, TriggerDefinition, UsageContext, Dosage, Meta in http://hl7.org/fhir/StructureDefinition/Extension\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:419)\n    at org.hl7.fhir.validation.cli.services.ValidationService.validateSources(ValidationService.java:106)\n    at org.hl7.fhir.validation.ValidatorCli.doValidation(ValidatorCli.java:279)\n    at org.hl7.fhir.validation.ValidatorCli.main(ValidatorCli.java:164)\nCaused by: org.hl7.fhir.exceptions.DefinitionException: StructureDefinition http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.product at Extension.value[x]: illegal constrained type @ConceptMap.group.element.target.dependsOn from base64Binary, boolean, canonical, code, date, dateTime, decimal, id, instant, integer, markdown, oid, positiveInt, string, time, unsignedInt, uri, url, uuid, Address, Age, Annotation, Attachment, CodeableConcept, Coding, ContactPoint, Count, Distance, Duration, HumanName, Identifier, Money, Period, Quantity, Range, Ratio, Reference, SampledData, Signature, Timing, ContactDetail, Contributor, DataRequirement, Expression, ParameterDefinition, RelatedArtifact, TriggerDefinition, UsageContext, Dosage, Meta in http://hl7.org/fhir/StructureDefinition/Extension\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.checkTypeDerivation(ProfileUtilities.java:3199)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.updateFromDefinition(ProfileUtilities.java:3056)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1230)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1094)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:658)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.generateSnapshot(SimpleWorkerContext.java:816)\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.generateSnapshot(SimpleWorkerContext.java:786)\n    at org.hl7.fhir.validation.BaseValidator.getXverExt(BaseValidator.java:1010)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkExtension(InstanceValidator.java:1680)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:5012)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4861)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4813)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:5035)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4861)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4813)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:5035)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4861)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4813)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:5035)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4861)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4813)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChildByDefinition(InstanceValidator.java:5035)\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkChild(InstanceValidator.java:4861)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateElement(InstanceValidator.java:4813)\n    at org.hl7.fhir.validation.instance.InstanceValidator.startInner(InstanceValidator.java:4503)\n    at org.hl7.fhir.validation.instance.InstanceValidator.start(InstanceValidator.java:4366)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validateResource(InstanceValidator.java:5637)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:763)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:611)\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:441)\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:411)\n    ... 3 more\n</code></pre></div>",
        "id": 272349232,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1645148390
    },
    {
        "content": "<p>Based on current behaviour of the validator, it seems that I should be using <code>http://hl7.org/fhir/5.0/StructureDefinition/extension-ConceptMap.group.element.target.dependsOn.value</code> in the context of <code>target.product</code>.<br>\nDoes this seem correct <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 272743637,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1645485098
    },
    {
        "content": "<p>on my todo list</p>",
        "id": 272747912,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645489707
    },
    {
        "content": "<p>which bit ? At the moment I just need clarity on what the extension URI should be so I can push out a stable release for a customer</p>",
        "id": 272752048,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1645494742
    },
    {
        "content": "<p>hey <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> just getting to this now (sorry). Quoting from <a href=\"https://jira.hl7.org/browse/FHIR-31348\">https://jira.hl7.org/browse/FHIR-31348</a>:</p>\n<blockquote>\n<p>Will clarify that when referencing a polymorphic type, the extension URL is always for the base element.  E.g. \"<a href=\"http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.value\">http://hl7.org/fhir/5.0/StructureDefinition/extension-Observation.value</a>\".  This is true even if the referenced element already exists in the version referencing the extension and only one or two 'distinct' polymorphic types are trying to be referenced. </p>\n</blockquote>\n<p>Therefore, this is correct:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"w\">  </span><span class=\"nt\">\"expansion\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"contains\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"code\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"inactive\"</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"value\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"valueBoolean\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"kc\">false</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://hl7.org/fhir/5.0/StructureDefinition/extension-ValueSet.expansion.contains.property\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"extension\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">[</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"code\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"parent\"</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"value\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"valueCode\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"302168000\"</span><span class=\"w\"></span>\n<span class=\"w\">              </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">          </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">],</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"system\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"http://snomed.info/sct\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"code\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"74400008\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"display\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"Appendicitis\"</span><span class=\"w\"></span>\n<span class=\"w\">      </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">]</span><span class=\"w\"></span>\n<span class=\"w\">  </span><span class=\"p\">}</span><span class=\"w\"></span>\n</code></pre></div>",
        "id": 273611828,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1646127066
    },
    {
        "content": "<p>the next release of the validator will call that valid (bug in the current one, nothing can be valid)</p>",
        "id": 273611861,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1646127087
    },
    {
        "content": "<p>Awesome, that's very helpful!</p>",
        "id": 273615522,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1646128972
    }
]