[
    {
        "content": "<p>Hi, there are some errors in the json-schema schemas. The problem is that basically sometimes a value can be either an array or an object, but the schema only defines the case of an array. For example,  Encounter.reason, the json-schema currently is: </p>\n<div class=\"codehilite\"><pre><span></span>&quot;reason&quot;: {\n        &quot;description&quot;:\n              &quot;Reason the encounter takes place, expressed as a code. For admissions, this can be used for a coded admission diagnosis.&quot;,\n            &quot;type&quot;: &quot;array&quot;,\n              &quot;items&quot;: {\n              &quot;$ref&quot;:\n                &quot;CodeableConcept.schema.json#/definitions/CodeableConcept&quot;\n            }\n          }\n</pre></div>\n\n\n<p>but it should be </p>\n<div class=\"codehilite\"><pre><span></span>      &quot;reason&quot;: {\n              &quot;oneOf&quot;: [\n                {\n                  &quot;description&quot;:\n                    &quot;Reason the encounter takes place, expressed as a code. For admissions, this can be used for a coded admission diagnosis.&quot;,\n                  &quot;type&quot;: &quot;array&quot;,\n                  &quot;items&quot;: {\n                    &quot;$ref&quot;:\n                      &quot;CodeableConcept.schema.json#/definitions/CodeableConcept&quot;\n                  }\n                },\n                {\n                  &quot;$ref&quot;:\n                    &quot;CodeableConcept.schema.json#/definitions/CodeableConcept&quot;\n                }\n              ]\n            },\n</pre></div>\n\n\n<p>I could use the <code>$validate</code> operation of a public server, but that would be slower and less reliable than doing it in my own server with json-schema</p>",
        "id": 153945237,
        "sender_full_name": "emilio",
        "timestamp": 1521145883
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191678\">@Abigail Watson</span> ?</p>",
        "id": 153945248,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1521150715
    },
    {
        "content": "<p>umm, I don't undertand the base claim here: \"sometimes a value can be either an array or an object\" - not so</p>",
        "id": 153945257,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521156133
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Well, I used the <code>$validate</code> endpoint of this server  <code>http://hapi.fhir.org/baseDstu3</code> and it validates an Encounter in both cases,  when <code>reason</code> is an object (codeableConcept), and also when its an array of objects</p>",
        "id": 153945259,
        "sender_full_name": "emilio",
        "timestamp": 1521157426
    },
    {
        "content": "<p>I discovered this when uploading data to my server from the <a href=\"https://github.com/synthetichealth/synthea\" target=\"_blank\" title=\"https://github.com/synthetichealth/synthea\">Synthea Project</a>. It writes codeableConcepts independently and also inside of arrays.</p>",
        "id": 153945260,
        "sender_full_name": "emilio",
        "timestamp": 1521157542
    },
    {
        "content": "<p>The <code>.org.hl7.fhir.validator.jar</code> also validates both formats without errors.</p>",
        "id": 153945261,
        "sender_full_name": "emilio",
        "timestamp": 1521157986
    },
    {
        "content": "<p>well, you've found bugs in at least the validators then. and probably in the synthea project. I've already reported some cardinality bugs in the synthea data.</p>",
        "id": 153945262,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521158337
    },
    {
        "content": "<p>want to post the actual examples here?</p>",
        "id": 153945263,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521158354
    },
    {
        "content": "<p>I have just been using a simple Encounter resource:</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Encounter&quot;,\n  &quot;id&quot;: &quot;f003&quot;,\n  &quot;text&quot;: {\n    &quot;status&quot;: &quot;generated&quot;,\n    &quot;div&quot;:\n      &quot;&lt;div xmlns=\\&quot;http://www.w3.org/1999/xhtml\\&quot;&gt;&lt;p&gt;&lt;b&gt;Generated Narrative with Details&lt;/b&gt;&lt;/p&gt;&lt;/div&gt;&quot;\n  },\n  &quot;identifier&quot;: [\n    {\n      &quot;use&quot;: &quot;official&quot;,\n      &quot;system&quot;: &quot;http://www.bmc.nl/zorgportal/identifiers/encounters&quot;,\n      &quot;value&quot;: &quot;v6751&quot;\n    }\n  ],\n  &quot;status&quot;: &quot;finished&quot;,\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/f001&quot;,\n    &quot;display&quot;: &quot;P. van de Heuvel&quot;\n  },\n  &quot;reason&quot;: {\n    &quot;extension&quot;: [\n      {\n        &quot;url&quot;:\n          &quot;http://hl7.org/fhir/StructureDefinition/encounter-primaryDiagnosis&quot;,\n        &quot;valuePositiveInt&quot;: 1\n      }\n    ]\n  },\n  &quot;serviceProvider&quot;: {\n    &quot;reference&quot;: &quot;Organization/f001&quot;\n  }\n}\n</pre></div>",
        "id": 153945265,
        "sender_full_name": "emilio",
        "timestamp": 1521158641
    },
    {
        "content": "<p>That resource gets validated by the <code>.jar</code>.  See how <code>reason</code> is not an array.</p>",
        "id": 153945266,
        "sender_full_name": "emilio",
        "timestamp": 1521158681
    },
    {
        "content": "<p>I no longer have the exact resource generated by Synthea, but it was something like that</p>",
        "id": 153945267,
        "sender_full_name": "emilio",
        "timestamp": 1521158721
    },
    {
        "content": "<p>yep sure was a bug in the validator - it will start noting an error if you provide an object in place of an array now</p>",
        "id": 153945271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521161887
    },
    {
        "content": "<p>Oh, thanks. I guess we'll have to report the issue to Synthea.<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> would you mind doing it yourself? I'm not sure about how to redact the issue</p>",
        "id": 153945272,
        "sender_full_name": "emilio",
        "timestamp": 1521162231
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191381\">@Jason Walonoski</span> I think I already reported this...</p>",
        "id": 153945275,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1521163389
    },
    {
        "content": "<p>It may be relevant to note that I didn't use Synthea directly. The bad data came from <a href=\"https://projectcrucible.org/testdata\" target=\"_blank\" title=\"https://projectcrucible.org/testdata\">Crucible</a> which <em>uses</em> Synthea</p>",
        "id": 153945278,
        "sender_full_name": "emilio",
        "timestamp": 1521164118
    },
    {
        "content": "<p>We've fixed this in Synthea already. <span class=\"user-mention\" data-user-id=\"192576\">@Robert Scanlon</span> The version of Synthea that Crucible uses needs to be updated.</p>",
        "id": 153945547,
        "sender_full_name": "Jason Walonoski",
        "timestamp": 1521236754
    }
]