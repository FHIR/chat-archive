[
    {
        "content": "<p>I am trying to retrieve SNOMED codelists with the Firely .net SDK, but so far no luck. I just keep getting an error \"Compose element(s) or 'url' parameter is expected to be present for an expansion, containing eg <a href=\"http://snomed.info/sct?fhir_vs=ecl/\">http://snomed.info/sct?fhir_vs=ecl/</a> or <a href=\"http://snomed.info/sct/45991000052106?fhir_vs=ecl/\">http://snomed.info/sct/45991000052106?fhir_vs=ecl/</a>)\" whatever i put into the Expand query. I guess I dont have the parameters right. Does anyone have a working sample of this? Any tips? I have tried these combinations of parameters for address and identifier / valueset         [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"<a href=\"http://snomed.info/sct/900000000000207008?fhir_vs=ecl\">http://snomed.info/sct/900000000000207008?fhir_vs=ecl</a>\", \"&lt;&lt;763158003:&lt;&lt;762951001=387517004\")]//Alle med prod som har en relasjon til paracetamol<br>\n        [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"<a href=\"http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;373873005\">http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;373873005</a>\", \"(Clinical Drug)\")]<br>\n        [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"<a href=\"http://snomed.info/sct?fhir_vs=ecl/\">http://snomed.info/sct?fhir_vs=ecl/</a>\", \"(Clinical Drug)\")]<br>\n        [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"url=http://snomed.info/sct/900000000000207008?fhir_vs=ecl/\", \"(Clinical Drug)\")]<br>\n        [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"url=http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;373873005\", \"(Clinical Drug)\")]<br>\n        [TestCase(\"<a href=\"https://snowstorm-training.snomedtools.org/fhir\">https://snowstorm-training.snomedtools.org/fhir</a>\", \"url=http://snomed.info/sct?fhir_vs=ecl/\", \"(Clinical Drug)\")]</p>",
        "id": 219224236,
        "sender_full_name": "Bjørn Erik Nordal",
        "timestamp": 1607443258
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span></p>",
        "id": 219232550,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1607446993
    },
    {
        "content": "<p>I'm not sure if this is an issue with the .NET SDK as I'm currently using that (latest version) and GET requests such as the one below receive valid responses from my Server...<br>\n<a href=\"https://terminz.azurewebsites.net/fhir/ValueSet/$expand?identifier=http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;73211009\">https://terminz.azurewebsites.net/fhir/ValueSet/$expand?identifier=http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;73211009</a><br>\nAlthough implementing ECL on any FHIR Terminology Server involves a certain amount of custom coding.</p>",
        "id": 219260017,
        "sender_full_name": "Peter Jordan",
        "timestamp": 1607460237
    },
    {
        "content": "<p>Thank you for the response. I am on Firely .NET sdk (lib) latest version. The lib sends POSTs to a Snowstorm server (trying to read SNOMED CT data) that speaks FHIR. I have GET samples that work in the browser, but cant get the parameters right for the POSTs in the lib. I keep getting \"Compose element(s) or 'url' parameter is expected to be present for an expansion, containing eg <a href=\"http://snomed.info/sct?fhir_vs=ecl/\">http://snomed.info/sct?fhir_vs=ecl/</a> or <a href=\"http://snomed.info/sct/45991000052106?fhir_vs=ecl/\">http://snomed.info/sct/45991000052106?fhir_vs=ecl/</a>)\" whatever i do. I have tried using all three overloads of Expand method in the lib, but getting none to work.  <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> do you know if there are known issues with the lib regarding code systems or Snowstorm?</p>",
        "id": 219317175,
        "sender_full_name": "Bjørn Erik Nordal",
        "timestamp": 1607508614
    },
    {
        "content": "<p>you should probably ask this on <a class=\"stream\" data-stream-id=\"179244\" href=\"/#narrow/stream/179244-snomed\">#snomed</a> ?</p>",
        "id": 219321526,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1607511548
    },
    {
        "content": "<p>I am not really sure, as I suspect that the problem is related to the client or at least how I am using it. Is there a separate forum for the Firely .NET lib? Anyhow, thanks for the pointer. I will post my request there.</p>",
        "id": 219322981,
        "sender_full_name": "Bjørn Erik Nordal",
        "timestamp": 1607512583
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"229128\">@Bjørn Erik Nordal</span>, you're always welcome to ask this on <a class=\"stream\" data-stream-id=\"179171\" href=\"/#narrow/stream/179171-dotnet\">#dotnet</a> too, but I've asked <span class=\"user-mention\" data-user-id=\"191347\">@Mirjam Baltus</span> and <span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span> to have a look at this to see if it's on the SDK side of things.</p>",
        "id": 219323113,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1607512685
    },
    {
        "content": "<p>Try the request with a tool like Postman maybe? In that way you can be sure if the problem is server-side or in the client</p>",
        "id": 219345384,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1607525167
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"229128\">@Bjørn Erik Nordal</span>. The error message is coming from the server. The server asks also to provide an url. In the standard <code>Expand</code> operation in our SDK , we do not provide the <code>url</code>, which we might do in future releases.</p>\n<p>But you can also provide the <code>url</code> parameter as well. I made a unit test to show you how:</p>\n<div class=\"codehilite\"><pre><span></span><code>        [TestMethod]\n        [TestCategory(&quot;IntegrationTest&quot;)]\n        public async System.Threading.Tasks.Task InvokeExpandWithIdentifierAndUrl()\n        {\n            var par = new Parameters()\n                .Add(&quot;identifier&quot;, new FhirUri(&quot;http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;763158003:&lt;&lt;762951001=387517004&quot;))\n                .Add(&quot;url&quot;, new FhirUri(&quot;http://snomed.info/sct?fhir_vs=ecl/&lt;&lt;763158003:&lt;&lt;762951001=387517004&quot;));\n\n            using var client = new FhirClient(&quot;https://snowstorm-training.snomedtools.org/fhir&quot;);\n            var vs = (await client.TypeOperationAsync&lt;ValueSet&gt;(RestOperation.EXPAND_VALUESET, par)).OperationResult&lt;ValueSet&gt;();\n            Assert.IsTrue(vs.Expansion.Contains.Any());\n        }\n</code></pre></div>\n<p>I hope this will bring you further.</p>\n<p>Marco Visser, Firely, lead developer of Firely .NET SDK</p>",
        "id": 219595566,
        "sender_full_name": "Marco Visser",
        "timestamp": 1607687292
    },
    {
        "content": "<p>Hi again and thank you for all your help. Actually I have managed to retrieve data now placing the Valueset id parameters in the base uri for the client (i.e. not as a Expand function parameter; yes it seems the url is not propagated that way). I need to qualify this solution further. I will also try the strategy provided here. Again; thank you</p>",
        "id": 219597760,
        "sender_full_name": "Bjørn Erik Nordal",
        "timestamp": 1607688635
    }
]