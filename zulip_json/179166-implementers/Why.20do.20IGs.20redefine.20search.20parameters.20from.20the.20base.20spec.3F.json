[
    {
        "content": "<p>I'm seeing some search parameter conflicts across IGs and I'm wondering if it would be possible for IGs to reference core spec search parameters instead of re-defining them.<br>\nFor example, consider an IG that is trying to declare <code>Organization.name</code> to be searchable.<br>\nThe base specification already defines a search parameter for this:  <a href=\"http://hl7.org/fhir/SearchParameter/Organization-name\">http://hl7.org/fhir/SearchParameter/Organization-name</a><br>\nThis has an expression like: <code>Organization.name | Organization.alias</code></p>",
        "id": 201657804,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858204
    },
    {
        "content": "<p>Now US Core comes along and defines their own search parameter for this field:  <a href=\"http://hl7.org/fhir/us/core/SearchParameter/us-core-organization-name\">http://hl7.org/fhir/us/core/SearchParameter/us-core-organization-name</a></p>",
        "id": 201657909,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858270
    },
    {
        "content": "<p>with the same search parameter type and the same code</p>",
        "id": 201657968,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858288
    },
    {
        "content": "<p>but, interestingly, their expression is just <code>Organization.name</code></p>",
        "id": 201657989,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858300
    },
    {
        "content": "<p>then PDEX Plan-Net comes along and defines their own search parameter for this field:  <a href=\"http://hl7.org/fhir/us/davinci-pdex-plan-net/SearchParameter/organization-name\">http://hl7.org/fhir/us/davinci-pdex-plan-net/SearchParameter/organization-name</a></p>",
        "id": 201658039,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858336
    },
    {
        "content": "<p>which is once again back to <code>Organization.name | Organization.alias</code></p>",
        "id": 201658075,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858357
    },
    {
        "content": "<p>I understand that IGs want to say which search parameters are required/optional/excluded in their CapabilityStatement, but is it possible for them to reference the base specification's search parameters instead of defining their own flavor of the same thing?</p>",
        "id": 201658207,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592858451
    },
    {
        "content": "<p>in the case of US Core we have refined the SP with a bunch of conformance language to say which mods and comparatos are supported and whether ANDs or ORs  or   Chains are supported.   This , along with the CapStatement, fully specifies the expectations for a server.   One way they could conflict with one and  another is if IG B has a looser conformance expectation than IG A.  In that case the server would go stick with the stricter conformance.</p>",
        "id": 201660160,
        "sender_full_name": "Eric Haas",
        "timestamp": 1592859571
    },
    {
        "content": "<p>Are those customizations in the SearchParameter definitions themselves or just verbiage around how search should work in general?</p>",
        "id": 201660856,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592859918
    },
    {
        "content": "<p>for example, i wouldn't expect ANDs, ORs, or Chains to be defined in the SearchParamter itself</p>",
        "id": 201660958,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592859967
    },
    {
        "content": "<p>interesting, i guess it IS in the SearchParameter definition for US Core:</p>\n<div class=\"codehilite\"><pre><span></span><code>NOTE: This US Core SearchParameter definition extends the usage context of capabilitystatement-expectation extension to formally express implementer expectations for these elements:\n- multipleAnd\n- multipleOr\n- modifier\n- comparator\n- chain\n</code></pre></div>",
        "id": 201661513,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592860298
    },
    {
        "content": "<p>Re-defining SearchParameters to constrain stuff like chaining is expected</p>",
        "id": 201667788,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592864065
    },
    {
        "content": "<p>Typically, real system CapabilityStatements <em>shouldn't</em> point to the base FHIR SearchParameters.  They should point to custom derived SearchParameters that define exactly what capabilities that particular system has.</p>",
        "id": 201667874,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592864126
    },
    {
        "content": "<p>the us core search parameter says it is derived from the base search parameter. So you know that it's still the same search parameter</p>",
        "id": 201788170,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592948933
    },
    {
        "content": "<p>I see that the pdex one isn't right.</p>",
        "id": 201788307,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592949008
    },
    {
        "content": "<p>given the definition of derivedFrom, I think the IG publisher should create an error if the expression , type, base, or component is different</p>",
        "id": 201788496,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592949082
    },
    {
        "content": "<p>Note, my team found <a href=\"https://www.hl7.org/fhir/us/core/SearchParameter-us-core-procedure-date.html\">https://www.hl7.org/fhir/us/core/SearchParameter-us-core-procedure-date.html</a> which redefines the base search spec.  It's a bit problematic when it doesn't reference an existing field.  I opened <a href=\"https://jira.hl7.org/browse/FHIR-27887\">https://jira.hl7.org/browse/FHIR-27887</a>. FYA...</p>",
        "id": 202362059,
        "sender_full_name": "Paul Bastide",
        "timestamp": 1593461548
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/Why.20do.20IGs.20redefine.20search.20parameters.20from.20the.20base.20spec.3F/near/201788496\">said</a>:</p>\n<blockquote>\n<p>given the definition of derivedFrom, I think the IG publisher should create an error if the expression , type, base, or component is different</p>\n</blockquote>\n<p>Not sure if this is something thats needed or not, but I think it would have helped to prevent the above error (and at least one more) in that version of US Core.<br>\nHowever, I did a little experimenting on my side and noticed that it might be tricky to get this kind of check just right.</p>",
        "id": 205609379,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596211761
    },
    {
        "content": "<p>For example, the base spec defines some search parameters across a bunch of resources (like <code>date</code>):<br>\n<code>AllergyIntolerance.recordedDate | CarePlan.period | CareTeam.period | ClinicalImpression.date | Composition.date | Consent.dateTime | DiagnosticReport.effective | Encounter.period | EpisodeOfCare.period | FamilyMemberHistory.date | Flag.period | Immunization.occurrence | List.date | Observation.effective | Procedure.performed | (RiskAssessment.occurrence as dateTime) | SupplyRequest.authoredOn</code></p>\n<p>Then, IGs like US Core redefine those SearchParameters for codes like <code>date</code> on a per-resource basis.<br>\nSo, if you want to treat those as \"matching\" you need to do something hacky like assume the structure of the search expression, split on <code>|</code> and compare the relevant subsection.</p>",
        "id": 205611124,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596212675
    },
    {
        "content": "<p>I wrote a little code that does that and it identified 3 remaining discrepencies between US Core and FHIR R4 (although I don't think these ones are too bad):</p>\n<div class=\"codehilite\"><pre><span></span><code>   SearchParameter with code &#39;onset-date&#39; already exists with a different expression;\nreplacing url=&#39;http://hl7.org/fhir/SearchParameter/Condition-onset-date&#39; and expression=&#39;Condition.onset.as(dateTime) | Condition.onset.as(Period)&#39; with url=&#39;http://hl7.org/fhir/us/core/SearchParameter/us-core-condition-onset-date&#39; and expression=&#39;Condition.onset.as(dateTime)&#39;\n\n   SearchParameter with code &#39;name&#39; already exists with a different expression;\nreplacing url=&#39;http://hl7.org/fhir/SearchParameter/Organization-name&#39; and expression=&#39;Organization.name | Organization.alias&#39; with url=&#39;http://hl7.org/fhir/us/core/SearchParameter/us-core-organization-name&#39; and expression=&#39;Organization.name&#39;\n\n   SearchParameter with code &#39;name&#39; already exists with a different expression;\nreplacing url=&#39;http://hl7.org/fhir/SearchParameter/Location-name&#39; and expression=&#39;Location.name | Location.alias&#39; with url=&#39;http://hl7.org/fhir/us/core/SearchParameter/us-core-location-name&#39; and expression=&#39;Location.name&#39;\n</code></pre></div>",
        "id": 205612515,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596213436
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> assuming these aren't purposeful, shall I open an issue for them?</p>",
        "id": 205612698,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596213525
    },
    {
        "content": "<p>summary:<br>\n<code>Condition.onset.as(dateTime) | Condition.onset.as(Period)</code> vs <br>\n<code>Condition.onset.as(dateTime)</code></p>\n<p><code>Organization.name | Organization.alias</code> vs <br>\n<code>Organization.name</code></p>\n<p><code>Location.name | Location.alias</code> vs <br>\n<code>Location.name</code></p>",
        "id": 205612879,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596213624
    },
    {
        "content": "<p>You can make a tracker but be aware that the context for the US Core Search Parameters is stated in the IG:</p>\n<p>\"NOTE: These search parameters SHALL NOT be interpreted on their own as requirements for server: This section lists the search parameters definitions that are used within the capability statement to define the search capabilities expectations for the US Core Server. This is not a list of search requirements for the client or server.\"</p>\n<p>in short basically to be able to computationally show what the conformance expectations for individual search parameters are...</p>\n<p>They are all generated using a script and so can update those although I don't know what .alias means nor how that would be interpreted by conformance testing.</p>",
        "id": 205618713,
        "sender_full_name": "Eric Haas",
        "timestamp": 1596216948
    },
    {
        "content": "<p>I actually use the FHIRPath parser to parse them and look inside their structure</p>",
        "id": 205637659,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1596227017
    },
    {
        "content": "<p>I opened <a href=\"http://jira.hl7.org/browse/FHIR-28181\">FHIR#28181</a> on US Core for the above discrepencies.<br>\nI can't tell from Grahame's comment whether its something that IG publisher is already checking or if it will in some future release, but IMHO it would be good to clean these up.</p>",
        "id": 205828637,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1596478753
    },
    {
        "content": "<p>I'm following on this issue although my question is slightly different.   My FHIR server specifies a search parameter with  expression\": \"Coverage.payor\" for a base of Coverage.  The Carin Blue Button specifies the exact same expression and path and description.  The differences are with the name, url, version, contact information and jurisdiction.  Other parameters are also mostly duplicates but may include a new derived from element.   Should both search parameters be created in the system?  If the search parameter already exists and is duplicate in certain key elements (and which ones are those?), then do we ignore it?</p>",
        "id": 231415207,
        "sender_full_name": "Ruth berge",
        "timestamp": 1616467698
    },
    {
        "content": "<p>Normally, IGs redefine search parameters so they can make clear expectations around support for particular comparators or modifiers.  They also reference the base search parameter so you know it's the same thing, just slightly more constrained.  There's no good reason for an IG to redefine something that already exists without both referencing it and somehow constraining it.</p>",
        "id": 231416397,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616468946
    },
    {
        "content": "<p>That means that if the search parameter already exists and has the same - expression, xpath, definition and has no addition modifiers for searching like eq etc - then there is no reason to add it again?  The url is the only item defined to require uniqueness so I am trying to identify which elements are used in creating the search.</p>",
        "id": 231501611,
        "sender_full_name": "Ruth berge",
        "timestamp": 1616517371
    },
    {
        "content": "<p>Correct - if you're not doing anything new, no reason to create a derivation</p>",
        "id": 231512702,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1616521494
    }
]