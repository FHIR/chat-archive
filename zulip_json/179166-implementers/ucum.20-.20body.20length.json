[
    {
        "content": "<p>Hello all,  I have a question about the body size is limited to the following ValueSet:  <a href=\"http://hl7.org/fhir/STU3/valueset-ucum-bodylength.html\">http://hl7.org/fhir/STU3/valueset-ucum-bodylength.html</a><br>\nthis valueset contains only cm and inch  !<br>\nhow do we represent height in feet &amp; inch as single unit? <br>\nis it required source applications should convert them to single unit (ex.. cm or inches)?</p>\n<p>Thanks</p>",
        "id": 259200483,
        "sender_full_name": "Krishna Moorthi",
        "timestamp": 1635318749
    },
    {
        "content": "<p>Almost all measurements are collapsed into the lowest common unit or decimal for exchange. If you want to display feet and inches you can, you can store feet and inches too. But when you exchange information you exchange the single value.</p>",
        "id": 259232924,
        "sender_full_name": "Daniel Venton",
        "timestamp": 1635338968
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"335936\">@Daniel Venton</span>      do we have ucum unit that represents the height ..for ex...5.7 feet/inch ?</p>\n<p>\"valueQuantity\": {<br>\n              \"value\": \"5.7\",<br>\n              \"unit\": \"?\",<br>\n              \"system\": \"<a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>\",<br>\n              \"code\": \"?\"<br>\n            }</p>",
        "id": 259357246,
        "sender_full_name": "Krishna Moorthi",
        "timestamp": 1635410734
    },
    {
        "content": "<p>I think if anybody saw 5.7 ft they'd translate that to 5 ft 8.4 in. So that isn't a good UOM. </p>\n<p>You'd use either cm or [in_i] for inches (67).  There is no UOM that does what you are looking for. Convert your ft/inches to just inches or cm.</p>",
        "id": 259377182,
        "sender_full_name": "Daniel Venton",
        "timestamp": 1635422529
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"223393\">@Krishna Moorthi</span> !! Nice to talk to you again! I fully agree with <span class=\"user-mention\" data-user-id=\"335936\">@Daniel Venton</span> : STU3 \"Vital Signs\" profile and other related ones only allows cm and inch! But you're lucky: with this two units you are able to transform any measurement from both Imperial system and Metric system; and as far as these conversions will be using a multiplier (almost all cases), your software won't  need to apply full medical device regulation caused by this. All the best!! Cheers.</p>",
        "id": 259380465,
        "sender_full_name": "Mario Villace",
        "timestamp": 1635424269
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"194233\">@Mario Villace</span>  nice to see your response again. thanks for the response. I am completely agree that answers from you &amp; <span class=\"user-mention\" data-user-id=\"335936\">@Daniel Venton</span> . we have already decided the approach of conversion to cm or inches but  I would like to double check if there are any one implemented something different. Thanks!</p>",
        "id": 259381119,
        "sender_full_name": "Krishna Moorthi",
        "timestamp": 1635424647
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"223393\">Krishna Moorthi</span> <a href=\"#narrow/stream/179166-implementers/topic/ucum.20-.20body.20length/near/259200483\">said</a>:</p>\n<blockquote>\n<p>Hello all,  I have a question about the body size is limited to the following ValueSet:  <a href=\"http://hl7.org/fhir/STU3/valueset-ucum-bodylength.html\">http://hl7.org/fhir/STU3/valueset-ucum-bodylength.html</a><br>\nthis valueset contains only cm and inch  !<br>\nhow do we represent height in feet &amp; inch as single unit? <br>\nis it required source applications should convert them to single unit (ex.. cm or inches)?</p>\n<p>Thanks</p>\n</blockquote>\n<p>IMHO that particular spec., which I haven't seen before, is not ideal.</p>\n<p>If the receiving systems all have full implementations of UCUM available, then (ignoring numerical accuracy issues) in principle any valid unit of length could be used for a patient height / length.</p>\n<p>If one makes the more cautious assumptions that (a) the receiving systems might not be able to do unit conversions; and (b) the message needs to be easily intelligible by humans, then the list of acceptable units should cover the common cases.</p>\n<p>In the UK and Europe, it is more common to describe human height in m (metres). Some authorities (NPU for one) also prefer prefixes for SI units that increase/decrease in factors of 10^3 (i.e. um, mm, m, km...) so at the very least m needs to be on the list of allowed units, and in some environments cm would be deprecated.</p>",
        "id": 261487298,
        "sender_full_name": "Colin E.",
        "timestamp": 1636977223
    },
    {
        "content": "<p>How it gets displayed is a different design problem. FHIR is focused on interoperability. Please don't impose display look-and-feel criteria in the data encoding layer.</p>",
        "id": 261490233,
        "sender_full_name": "John Moehrke",
        "timestamp": 1636979347
    },
    {
        "content": "<p>I had not seen this valueset referred to before, and I'm surprised that FHIR would concern itself with trying to constrain the UoM applied to particular patient measurements. I would say that's an issue for a particular country or other bounded environment, not something you start trying to hard code into the messaging standard, so if that's the same point you were making <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> then I agree.</p>\n<p>I should probably have been clearer on that, I'd say if there HAS to be a valueset for the units on patient height measurements, then it should include metres, but that's not really a job for a common internaional standard.</p>",
        "id": 261492928,
        "sender_full_name": "Colin E.",
        "timestamp": 1636981088
    },
    {
        "content": "<p>You seemed to have stumbled on the valueset for this FHIR profile: <a href=\"http://hl7.org/fhir/STU3/bodylength.html\">http://hl7.org/fhir/STU3/bodylength.html</a> .  This may give you more context.   The HL7 committees decided that this is job for this standard international standard.</p>",
        "id": 261518757,
        "sender_full_name": "Eric Haas",
        "timestamp": 1636992509
    },
    {
        "content": "<p>That's the version referred to by the OP, but that valueset still seems to be around in 4.0.1: <a href=\"https://www.hl7.org/fhir/valueset-ucum-bodylength.html\">https://www.hl7.org/fhir/valueset-ucum-bodylength.html</a></p>",
        "id": 261529333,
        "sender_full_name": "Colin E.",
        "timestamp": 1636996925
    },
    {
        "content": "<p>? ... yes the profile is still around around in 4.0.1 too.</p>",
        "id": 261544996,
        "sender_full_name": "Eric Haas",
        "timestamp": 1637003747
    },
    {
        "content": "<p>FHIR has defined mandatory profiles for certain vital signs.  Body length is one of those.  So any system that is sharing body lengths (and is aware that they're sending body lengths) SHALL comply with it.  I.e. They shall use the specified LOINC code and specified units of measure.  They are expected to translate to and from whatever they use locally.</p>",
        "id": 261551809,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637006815
    },
    {
        "content": "<blockquote>\n<p>I would say that's an issue for a particular country or other bounded environment</p>\n</blockquote>\n<p>indeed that is how we've always thought of it but the combination of patient access to data and international consumer software means that we acted to standardise a few very minimal features of vital signs for patient safety. Some countries have proven very unhappy with this</p>",
        "id": 261558301,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637010040
    },
    {
        "content": "<p>I've added a comment / bug report on the item in question (bodylength), hopefully following the correct procedure, which basically says IMHO FHIR should not be allocating preferred unit mappings to measurements on an ad hoc basis, BUT if there has to be a valueset on this particular item, then needs to include metres (m).</p>\n<p>metres are commonly used day to day in the UK for patient height reporting, so that's a pragmatic argument. At a more academic level, the NPU guidelines (a great resource) recommend a preference for \"engineering\" versions of SI units (where prefixes/multipliers increase in steps of 10^3) for multiple reasons. On that basis cm do not qualify as preferred unit.</p>",
        "id": 261629563,
        "sender_full_name": "Colin E.",
        "timestamp": 1637063356
    },
    {
        "content": "<p>On the principle of saying elements (e.g. UoM) are a messaging requirement, and do not impact or constrain the presentation of results- while I might agree with that personally, that's going to be a really \"hard sell\" to some key users groups, at least in our environment in the UK.</p>\n<p>Units of measure (UoM) is my area of interest. There are deeply held beliefs here among Pathologists, Laboratory Scientists, and Lab managers, which could be summarised as-</p>\n<p>1) The Lab WILL/MUST issue results using the UoM that come from the analyser, test kit or other source<br>\n  2) The UoM reported by the lab are expected* to be what the receiving system will show to the clinician<br>\n  3) The receiving system should always record the UoM as received, even if a converted \"local version\" value is stored against the patient record</p>\n<div class=\"codehilite\"><pre><span></span><code> * No (2) is not always met in practice, but this is not popular with Labs, and raises questions around who owns the responsibility for the validity and accuracy of the results.\n</code></pre></div>\n\n<p>One might think this would be a driver for a lot of variation in the way results are reported, and potential data quality problems, and I wouldn't disagree, but changing decades of training, culture, and established + documented practice will not happen easily.</p>\n<p>Hence my comment on the bodylength profile. Trying to slip \"standard units\" into the FHIR standard and assuming that's going to slip past the decision making bodies and interest groups involved at a country level is misguided and just going to be overturned by reality.</p>",
        "id": 261645536,
        "sender_full_name": "Colin E.",
        "timestamp": 1637071786
    },
    {
        "content": "<p>Given that units can be converted and displayed as you wish, I'm not sure that's necessarily a justification.  The objective here is to ensure that key vitals are shareable and understandable no matter where in the world they're captured.  There's an extension if you want to share exactly what the user entered.</p>",
        "id": 261645627,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637071815
    },
    {
        "content": "<p>There's no intention to 'slip' anything in.  The expectations are pretty clearly highlighted at the top of the Observation resource.  The intention is to increase interoperability.  Doing that always creates tension (I can't count the number of person hours it took to get Patient.gender to normative).  However, part of using a standard means that you sometimes need to adjust how you share information for the benefit of others.</p>",
        "id": 261646038,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637072000
    },
    {
        "content": "<p>The principle that \"units can be converted and displayed as you wish\" is not a done deal, not even close.</p>\n<p>I've raised this point quite a few times with various stakeholder groups here in the UK, but whenever I've brought it up with Lab specialists I've been rebuffed pretty firmly. It seems to be a \"religious\" issue, and it's going to take a lot of persuading at levels well above my pay grade to change.</p>\n<p>As I said, at a personal level I agree that harmonising units in use for patient records would benefit health systems enormously, but that's a major programme of work even at a national level, involving powerfuil stakeholder groups including clinicians, Lab scientists, commissioners, suppliers and more.</p>\n<p>Much as I might like it to be otherwise, expecting that some people, even very very clever ones, working on the messaging layer can decide \"we are all going to use cm for a particular measurement now, and you can just convert if you need to\" and the various professional bodies (for example) will simply do as they are told strikes me as misguided. Hence the \"slip\" comment, that might not have been anyones' intention, but putting in a defined UoM restriction in the messaging layer and expecting that it will somehow bypass decades established practice and professional training and become the new way of doing things without involvement from the many key stakeholder groups involved does loook very much like trying to slip a decision past those stakeholders.</p>\n<p>I was going to use the term \"optimistic\" instead of misguided above but I changed my mind because I don't think this kind of piecemeal approach (if that's a fair characterisation) is soemthing to be optimistic about. If the FHIR community wants to start standardising on recommended UoM, then as a first step it would need to set out design or editorial guidelines on (a) which UoM to select as preferred; and (b) how to represent them (e.g. in UCUM syntax). IMHO if those steps had been gone through it's unlikely that cm would have been on the list, so that's rather a giveaway that those initial steps have probably not been done?</p>",
        "id": 261654382,
        "sender_full_name": "Colin E.",
        "timestamp": 1637075306
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>, do you want to speak to the process OO used in selecting the UoM in the vitals profiles?</p>",
        "id": 261655292,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637075651
    },
    {
        "content": "<blockquote>\n<p>we are all going to use cm for a particular measurement now, and you can just convert if you need to</p>\n</blockquote>\n<p>I think the idea is more like \"we are all going to use cm to <strong>exchange a</strong> particular measurement now, and <strong>we will convert it to what the user needs</strong>\".</p>",
        "id": 261657662,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1637076513
    },
    {
        "content": "<p>I appreciate the concerns raised, but these issue have undergone extensive review and have been in place for years.  There is an established implementation base using them. I don't see the point in reopening this discussion considering the downstream consequences.   In other words, <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  No.</p>",
        "id": 261658881,
        "sender_full_name": "Eric Haas",
        "timestamp": 1637076936
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/ucum.20-.20body.20length/near/261655292\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191401\">Eric Haas</span>, do you want to speak to the process OO used in selecting the UoM in the vitals profiles?</p>\n</blockquote>\n<p>I appreciate the concerns raised, but these issue have undergone extensive review and have been in place for years.  There is an established implementation base using them. I don't see the point in reopening this discussion considering the downstream consequences.   In other words, <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  No.</p>",
        "id": 261659050,
        "sender_full_name": "Eric Haas",
        "timestamp": 1637076984
    },
    {
        "content": "<p>I have to wonder who might have been involved in those reviews from a UK perspecitive, if anyone. However it sounds as if a path has been chosen and it's not going to be easy to change.</p>\n<p>I don't claim any particular authority personally, but as someone aiming to support FHIR implementation in the UK this looks like a significant gap in expectations that is going to make aligning to the common standard much harder for us, maybe impossible,</p>",
        "id": 261673429,
        "sender_full_name": "Colin E.",
        "timestamp": 1637082463
    },
    {
        "content": "<p>I am wondering, do Lab specialists read/write FHIR data directly without any App/Client?</p>",
        "id": 261682655,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1637086345
    },
    {
        "content": "<p>UK reviewers were unhappy with the mandatory choice of LOINC in this profile, back in 2016. But we didn't get our way with that. No one raised an issue with the units at the time that I can remember.</p>",
        "id": 261684255,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1637087004
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/ucum.20-.20body.20length/near/261558301\">said</a>:</p>\n<blockquote>\n<blockquote>\n<p>I would say that's an issue for a particular country or other bounded environment</p>\n</blockquote>\n<p>indeed that is how we've always thought of it but the combination of patient access to data and international consumer software means that we acted to standardise a few very minimal features of vital signs for patient safety. Some countries have proven very unhappy with this</p>\n</blockquote>\n<p>IMHO if international consumer software is aware of units on measurements (and it shouild be) and the software has a preferred target set of units, or better- the Patient can select a preferred set of units, the that software should be able to do unit conversions to the target set properly. Ideally it would also retain the \"as received\" measurement permanently with an audit record of the conversion, and allow the user to \"drill through\" the converted value to the received version. However that's putting medical device type expectations on consumer software and that may not be realistic.</p>",
        "id": 261766689,
        "sender_full_name": "Colin E.",
        "timestamp": 1637145149
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191651\">Rik Smithies</span> <a href=\"#narrow/stream/179166-implementers/topic/ucum.20-.20body.20length/near/261684255\">said</a>:</p>\n<blockquote>\n<p>UK reviewers were unhappy with the mandatory choice of LOINC in this profile, back in 2016. But we didn't get our way with that. No one raised an issue with the units at the time that I can remember.</p>\n</blockquote>\n<p>Yes I must admit that is the kicker. Given that we can't agree on the concept coding system, the units are a secondary issue.</p>",
        "id": 262300456,
        "sender_full_name": "Colin E.",
        "timestamp": 1637576152
    },
    {
        "content": "<p>But we did agree, and we have a standard. It is just that it is not perfect for everyone. UK people can use LOINC. The fact they don't want to in some cases is unfortunate, but it not a technical problem for interoperability.</p>",
        "id": 262309285,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1637582299
    },
    {
        "content": "<p>More specifically, they can use LOINC <em>and</em> SNOMED.  We're not preventing the transmission of what you want to transmit, merely forcing that additional information is transmitted as well.</p>",
        "id": 262336117,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637595873
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>it's not a technical problem for interoperability.</p>\n</blockquote>\n</blockquote>\n<p>I think it's a potential problem for end to end integrity of the information. Interested to hear counter-arguments though.</p>\n<p>An A-B-A conversion of a quantity using a UCUM encoded UoM can probably be achieved \"mostly non damaging\", but even for the common continuous quantities there is the possibility of numeric calculations introducing digit-level changes, rounding errors etc.</p>\n<p>The coding is a bigger problem. As you know Rik the UK is aiming to use Snomed wherever possible, and while the concepts being defined in Snomed will cover the same space as LOINC, it's not part of the design requirement that there will necessarily be an information-preserving bidirectional mapping between Snomed concepts and LOINC. If the messaging layer tries to mandate a change in coding scheme, that A-B-A transformation therefore could lose information.</p>\n<p>That sounds like a problem to me.</p>",
        "id": 262349551,
        "sender_full_name": "Colin E.",
        "timestamp": 1637601372
    },
    {
        "content": "<p>For SNOMED there is no conversion A to B to A, and no change. There is only an addition. If A is SNOMED then you start with A, and add B (LOINC)- to conform. Then you can ignore B and just look at the A, no conversion. Others can use B, and get the benefit of seeing that data even though they don't know SNOMED.</p>\n<p>It is true that B is derived from A and if that mapping is somehow incorrect or lossy you have a problem. That problem is possible in every single part of every electronic interchange. But some maps are good enough. The vital signs are relatively unambiguous.</p>",
        "id": 262351534,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1637602297
    },
    {
        "content": "<p>I hit send on that last comment after it had been sat in the edit box for a while, so I hadn't read Lloyd's comment until afterwards.</p>\n<p>I see that test names, as a CodeableConcepts, can be coded multiple times on the same result with different coding schemes. However that would still seem to require that the sender has access to a mapping of the preferred coding scheme (if that isn't LOINC) to LOINC.</p>\n<p>Not that I like this idea, but in this situation, if you know the receiving system is going to ignore the LOINC codes, but they have to be present to adhere to the message profile, presumably you could bodge it by just sending a generic top levelLOINC code for \"test result\" with every result, assuming such a code exists.</p>\n<p>However Observation.value has a cardinality of 0..1, and a Quantity datatype doesn't appear to allow for multiple representations, unlike a CodeableConcept, so I don't see a built in mechanism to support sending (say) a ptient height of 1.78m  as both 1.78m and 178cm?</p>",
        "id": 262355025,
        "sender_full_name": "Colin E.",
        "timestamp": 1637603863
    },
    {
        "content": "<p>There's no choice about which LOINC code gets sent.  The vital signs identify specific LOINC codes that SHALL be used for each type of vital sign (and they are indeed as generic and high-level as LOINC allows)</p>\n<p>There's an extension where you can continue to transmit the body length in meters or non-UCUM or whatever units you wish.  So if you really want to retain the 'original' units, you have an option to do so.  There should <em>never</em> be a situation in FHIR where you have to lose information, though there might be rules that require you to place that extra information in a place other than where you might most prefer it to be.</p>",
        "id": 262356036,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637604283
    },
    {
        "content": "<p>Which extension is that? I don't find it easy to idetify which extensions might be applicable in a specific situation, or profile?</p>",
        "id": 262360690,
        "sender_full_name": "Colin E.",
        "timestamp": 1637606630
    },
    {
        "content": "<p>You can see the extensions available for Quantity here: <a href=\"https://hl7.org/fhir/datatypes-extras.html#Quantity\">https://hl7.org/fhir/datatypes-extras.html#Quantity</a><br>\nThe one you want is <a href=\"https://hl7.org/fhir/extension-iso21090-pq-translation.html\">https://hl7.org/fhir/extension-iso21090-pq-translation.html</a></p>",
        "id": 262365420,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1637608770
    },
    {
        "content": "<p>'As a developer' in the UK I don't want to see this kind of thing profiled. It's a bit of a pain in the butt to look into either profiles or examples and extract preferred units or the code to use. </p>\n<p>I would rather see something like a spreadsheet or ideally the use of FHIR ObservationDefinition. </p>\n<p>e.g. for body height (and extracting from <a href=\"https://simplifier.net/guide/ClinicalObservations/Home\">https://simplifier.net/guide/ClinicalObservations/Home</a>) we get this </p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"ObservationDefinition\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"id\"</span><span class=\"p\">:</span> <span class=\"s2\">\"snomed-871552002\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">\"coding\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://snomed.info/sct\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"50373000\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Body height measure\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"p\">{</span>\n        <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://loinc.org\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"8302-2\"</span><span class=\"p\">,</span>\n        <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Body height\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n  <span class=\"p\">},</span>\n  <span class=\"nt\">\"quantitativeDetails\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n    <span class=\"nt\">\"customaryUnit\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n      <span class=\"nt\">\"coding\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"cm\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"centimeter\"</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">]</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">}</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 262417476,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1637648685
    },
    {
        "content": "<p>Part of the reason for going for ObservatonDefinition is  it can easily be  displayed in a Implementation Guide e.g. </p>\n<p><a href=\"https://simplifier.net/guide/NHSDigital/ObservationDefinition2\">https://simplifier.net/guide/NHSDigital/ObservationDefinition2</a></p>\n<p>Add it to an off the shelf FHIR server and it's a searchable resource. </p>\n<p>For testing, I think it's possible to autogenerate profiles or even alter FHIR validation to take into account the ObservationDefinition. </p>\n<p>It's also not tied to FHIR, FHIR is just the definition mechanism. So if I was build a HL7 v2 ORU_R01 I can access the ObservationDefinition and see the preferred codes and units (a reason not  to profile this?). It could also be viewed as an extension to the ontology/terminology service (should the unit be a property of the SNOMED CT?)</p>",
        "id": 262418162,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1637649513
    },
    {
        "content": "<p>If I understand your point correctly <span class=\"user-mention\" data-user-id=\"191687\">@Kevin Mayfield</span> (hopefully I do) then I think we're pushing in the same direction. Personally, I would like to see preferred/allowed UoM mapped to reportable test codes (which would be Snomed codes for us) at national level, but the appetite to take that on isn't there yet, so it's an unfilled space.</p>\n<p>If and when it does happen, it would be a significant piece of work involving detailed clinical + technical input and governamce, and I would expect it to deliver a mapping table as a substantial separate artifact. Hopefully that could then be delivered in a way that's convenient for FHIR developers and other users / software suppliers, although I looked into that a while back and neither FHIR or or Snomed seemed to have the ideal mechanism for it. At the outset it could well be a semi-static data set outside of FHIR or Snomed, it's not data that changes rapidly.</p>\n<p>What wouldn't be helpful would be to go through that large-scale exercise, and then at the implementation stage find that there are a bunch of non-aligned (mandatory) default mappings of codes and units scattered throughout FHIR at the profile level, so on a per- data item basis implementers (I think?) would have to check every profile to see if they could use a national standard code and unit \"as is\". or whether they would need to use multi-coding and an extension mechanism to sidestep FHIR defaults that are incompatible with local standards.</p>",
        "id": 262438422,
        "sender_full_name": "Colin E.",
        "timestamp": 1637664355
    },
    {
        "content": "<p>several comments:</p>\n<ul>\n<li>I haven't hooked up observation definition to the validation yet, but I'm intending to once it gets a little more mature.</li>\n<li>yes, it could be used in v2 as well. In fact, the conceptual model of Observation is sufficiently stable that I'd like to document using ObservationDefinition like that more clearly, though I have more work to do around making v2 codes computable to a terminology server before that </li>\n<li>we didn't fix the displayed units <em>at all</em>, only the computable units. So you can still have whatever representation you want on the unit, as long as it's consistent with the UCUM code.</li>\n<li>I'd support adding m to the units as well as cm. But really, wearing my metrologist hat (I was one before), on body length it's not going to make any difference to the way precision is represented. Other things, I totally agree it's a big deal </li>\n<li>It's not always clear, but the LOINC codes we chose are pretty abstract (deliberately). Even a system that's totally LOINC based is probably going to have a more specific LOINC code as well as the fixed LOINC code. It might have been clearer if we had simply described it as \"consumer level code, fixed to this LOINC code, and health system code, use whatever you are already using' - cause less FUD from some quarters </li>\n<li>there is a project to standardise request and observable codes, along with units and even reference ranges, for laboratory tests in Australia - a very worthy project that is gaining traction, but it's certainly something that develops slowly.  It's not FHIR business though - it's owned and run by the pathologists in charge of the labs (look up PITUS RCPA)</li>\n</ul>",
        "id": 262448726,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637670575
    },
    {
        "content": "<blockquote>\n<p>f we had simply described it as \"consumer level code, fixed to this LOINC code, and health system code, use whatever you are already using' </p>\n</blockquote>\n<p>Though that doesn't quite get at what's going on - it's not just for consumer level software; all software other than uber lab experts faces the same problem: what do I query to make sure I get all the relevant observations? This is clearly a significant safety concern, and in many cases, it's very difficult to answer. But not for vital signs, at least. That does come with a price, and you're focusing on the price. I'd like to extend that to cover all labs related to homeostasis too, but it will never happen. But really, scanning through 30 years of clinical safety issues I've been involved with that involve missed lab reports, the ones that really hurt patients are missed cancer marker tests for patients coming out of remission, and that deserves focus (from someone, that's not going to be us)</p>",
        "id": 262449101,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637670823
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>body length it's not going to make any difference to the way precision is represented</p>\n</blockquote>\n</blockquote>\n<p>I agree body-length is a probably not a great example of when conversions might pose a problem, but I'm not sure even this is guaranteed issue-free.</p>\n<p>I don't think the UCUM standard itself has much if anything to say about how the numeric magnitudes of Quantities expressed in UCUM are represented and processed within an implementation of the standard in a library. If an implementation of UCUM is free to use binary floating point, then converting from m to cm (and possibly back again) might seem trivial, but we also know 0.1 does not exist in floating point [https://www.exploringbinary.com/why-0-point-1-does-not-exist-in-floating-point/] </p>\n<p>I'm not suggesting that a number getting switched down in the least significant digits is likely to cause a material change in the value of a result, but in some cases it can ripple up into the more significant digits and cause a change in the display of the value, so for example a result value of 1.9956 might round up to 2.00 on the sending side but round down to 1.99 on the receiving system</p>\n<p>Our labs are currently in the habit of doing \"eyeball based\" end to end integrity checks on reported results when (say) a new test is implemented, a key piece of software changes, or a new client system comes on board. Something like the digits changing in a reported result, even if it's not a material change, could be a cause for concern, expecially if it's happening down in the lower layers of a system where it is difficult to trace.</p>",
        "id": 262478064,
        "sender_full_name": "Colin E.",
        "timestamp": 1637684473
    },
    {
        "content": "<p>just fiddled with some jq and found a nice way to recursively get all the codes in a FHIR json blob</p>\n<div class=\"codehilite\"><pre><span></span><code>from rich import print\nimport jq\n\n\ndef find_fhir_codes_with_jq(\n    bundle: Any,\n) -&gt; Any:\n    &quot;&quot;&quot;\n    Recursively find {system, code, display} tuples in FHIR data\n\n    Parameters\n    ----------\n    bundle : Mapping\n        A bundle of patient data.\n\n    Returns\n    -------\n    codes: List[Mapping[str, Any]\n\n    &quot;&quot;&quot;\n    return jq.all(\n        &#39;.. | objects | select(. | (has(&quot;system&quot;) and has(&quot;display&quot;) and has(&quot;code&quot;))) | .&#39;,\n        bundle,\n    )\n\n\ndef main():\n    sample = {\n        &quot;entry&quot;: (\n            {\n                &quot;resource&quot;: {\n                    &quot;resourceType&quot;: &quot;Patient&quot;,\n                    &quot;id&quot;: &quot;example&quot;,\n                    &quot;name&quot;: (\n                        {\n                            &quot;prefix&quot;: &quot;Dr.&quot;,\n                            &quot;given&quot;: [&quot;Bob&quot;, &quot;B.&quot;],\n                            &quot;family&quot;: &quot;Bobbins&quot;,\n                        }\n                    ),\n                },\n            },\n            {\n                &quot;resource&quot;: {\n                    &quot;resourceType&quot;: &quot;Observation&quot;,\n                    &quot;id&quot;: &quot;example_code_and_valueQuantity&quot;,\n                    &quot;subject&quot;: {\n                        &quot;reference&quot;: &quot;Patient/example&quot;,\n                    },\n                    &quot;code&quot;: {\n                        &quot;coding&quot;: [\n                            {\n                                &quot;system&quot;: &quot;http://loinc.org&quot;,\n                                &quot;code&quot;: &quot;29463-7&quot;,\n                                &quot;display&quot;: &quot;Body weight&quot;,\n                            }\n                        ],\n                    },\n                    &quot;valueQuantity&quot;: {\n                        &quot;value&quot;: &quot;70&quot;,\n                        &quot;unit&quot;: &quot;kg&quot;,\n                        &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n                        &quot;code&quot;: &quot;kg&quot;,\n                    },\n                },\n            },\n            {\n                &quot;resource&quot;: {\n                    &quot;resourceType&quot;: &quot;Observation&quot;,\n                    &quot;id&quot;: &quot;example_component&quot;,\n                    &quot;subject&quot;: {\n                        &quot;reference&quot;: &quot;Patient/example&quot;,\n                    },\n                    &quot;code&quot;: {\n                        &quot;coding&quot;: [\n                            {\n                                &quot;system&quot;: &quot;http://loinc.org&quot;,\n                                &quot;code&quot;: &quot;55284-4&quot;,\n                                &quot;display&quot;: &quot;Blood Pressure&quot;,\n                            }\n                        ]\n                    },\n                    &quot;component&quot;: (\n                        {\n                            &quot;code&quot;: {\n                                &quot;coding&quot;: (\n                                    {\n                                        &quot;system&quot;: &quot;http://loinc.org&quot;,\n                                        &quot;code&quot;: &quot;8462-4&quot;,\n                                        &quot;display&quot;: &quot;Diastolic Blood Pressure&quot;,\n                                    }\n                                ),\n                                &quot;text&quot;: &quot;Diastolic Blood Pressure&quot;,\n                            },\n                            &quot;valueQuantity&quot;: {\n                                &quot;value&quot;: 84.51637275024623,\n                                &quot;unit&quot;: &quot;mm[Hg]&quot;,\n                                &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n                                &quot;code&quot;: &quot;mm[Hg]&quot;,\n                            },\n                        },\n                        {\n                            &quot;code&quot;: {\n                                &quot;coding&quot;: (\n                                    {\n                                        &quot;system&quot;: &quot;http://loinc.org&quot;,\n                                        &quot;code&quot;: &quot;8480-6&quot;,\n                                        &quot;display&quot;: &quot;Systolic Blood Pressure&quot;,\n                                    }\n                                ),\n                                &quot;text&quot;: &quot;Systolic Blood Pressure&quot;,\n                            },\n                            &quot;valueQuantity&quot;: {\n                                &quot;value&quot;: 119.11425717022348,\n                                &quot;unit&quot;: &quot;mm[Hg]&quot;,\n                                &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n                                &quot;code&quot;: &quot;mm[Hg]&quot;,\n                            },\n                        },\n                    ),\n                },\n            },\n        ),\n    }\n    print(&quot;SAMPLE:&quot;)\n    print(sample)\n    codes = find_fhir_codes_with_jq(sample)\n    print(&quot;CODES:&quot;)\n    print(codes)\n\n\nif __name__ == &quot;__main__&quot;:\n    main()\n\n# SAMPLE:\n# {\n#     &#39;entry&#39;: (\n#         {\n#             &#39;resource&#39;: {\n#                 &#39;resourceType&#39;: &#39;Patient&#39;,\n#                 &#39;id&#39;: &#39;example&#39;,\n#                 &#39;name&#39;: {&#39;prefix&#39;: &#39;Dr.&#39;, &#39;given&#39;: [&#39;Bob&#39;, &#39;B.&#39;], &#39;family&#39;: &#39;Bobbins&#39;}\n#             }\n#         },\n#         {\n#             &#39;resource&#39;: {\n#                 &#39;resourceType&#39;: &#39;Observation&#39;,\n#                 &#39;id&#39;: &#39;example_code_and_valueQuantity&#39;,\n#                 &#39;subject&#39;: {&#39;reference&#39;: &#39;Patient/example&#39;},\n#                 &#39;code&#39;: {&#39;coding&#39;: [{&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;29463-7&#39;, &#39;display&#39;: &#39;Body weight&#39;}]},\n#                 &#39;valueQuantity&#39;: {&#39;value&#39;: &#39;70&#39;, &#39;unit&#39;: &#39;kg&#39;, &#39;system&#39;: &#39;http://unitsofmeasure.org&#39;, &#39;code&#39;: &#39;kg&#39;}\n#             }\n#         },\n#         {\n#             &#39;resource&#39;: {\n#                 &#39;resourceType&#39;: &#39;Observation&#39;,\n#                 &#39;id&#39;: &#39;example_component&#39;,\n#                 &#39;subject&#39;: {&#39;reference&#39;: &#39;Patient/example&#39;},\n#                 &#39;code&#39;: {&#39;coding&#39;: [{&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;55284-4&#39;, &#39;display&#39;: &#39;Blood Pressure&#39;}]},\n#                 &#39;component&#39;: (\n#                     {\n#                         &#39;code&#39;: {\n#                             &#39;coding&#39;: {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;8462-4&#39;, &#39;display&#39;: &#39;Diastolic Blood Pressure&#39;},\n#                             &#39;text&#39;: &#39;Diastolic Blood Pressure&#39;\n#                         },\n#                         &#39;valueQuantity&#39;: {\n#                             &#39;value&#39;: 84.51637275024623,\n#                             &#39;unit&#39;: &#39;mm[Hg]&#39;,\n#                             &#39;system&#39;: &#39;http://unitsofmeasure.org&#39;,\n#                             &#39;code&#39;: &#39;mm[Hg]&#39;\n#                         }\n#                     },\n#                     {\n#                         &#39;code&#39;: {\n#                             &#39;coding&#39;: {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;8480-6&#39;, &#39;display&#39;: &#39;Systolic Blood Pressure&#39;},\n#                             &#39;text&#39;: &#39;Systolic Blood Pressure&#39;\n#                         },\n#                         &#39;valueQuantity&#39;: {\n#                             &#39;value&#39;: 119.11425717022348,\n#                             &#39;unit&#39;: &#39;mm[Hg]&#39;,\n#                             &#39;system&#39;: &#39;http://unitsofmeasure.org&#39;,\n#                             &#39;code&#39;: &#39;mm[Hg]&#39;\n#                         }\n#                     }\n#                 )\n#             }\n#         }\n#     )\n# }\n# CODES:\n# [\n#     {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;29463-7&#39;, &#39;display&#39;: &#39;Body weight&#39;},\n#     {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;55284-4&#39;, &#39;display&#39;: &#39;Blood Pressure&#39;},\n#     {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;8462-4&#39;, &#39;display&#39;: &#39;Diastolic Blood Pressure&#39;},\n#     {&#39;system&#39;: &#39;http://loinc.org&#39;, &#39;code&#39;: &#39;8480-6&#39;, &#39;display&#39;: &#39;Systolic Blood Pressure&#39;}\n# ]\n</code></pre></div>\n<p>the key bit is  '.. | objects | select(. | (has(\"system\") and has(\"display\") and has(\"code\"))) | .'</p>",
        "id": 262481360,
        "sender_full_name": "bion howard",
        "timestamp": 1637686096
    },
    {
        "content": "<p><a href=\"https://stedolan.github.io/jq/\">https://stedolan.github.io/jq/</a> looks pretty good for this stuff</p>",
        "id": 262481475,
        "sender_full_name": "bion howard",
        "timestamp": 1637686166
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/zTQNRh5MMKqjeshaiRgnD3Hd/all_synthea_r4_codes.zip\">all_synthea_r4_codes.zip</a> here's a zipped csv file with all the system,display,code objects in synthea r4 dataset</p>",
        "id": 262502320,
        "sender_full_name": "bion howard",
        "timestamp": 1637695867
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/NCYWm54Li4WYoGVotEyU7IxS/all_synthea_r4_values.zip\">all_synthea_r4_values.zip</a> here's all the values with codes / units / systems</p>",
        "id": 262502470,
        "sender_full_name": "bion howard",
        "timestamp": 1637695944
    },
    {
        "content": "<p>but you have that problem whatever. And a conformant FHIR implementation has to deal with that. So I don't think that this is a good argument why it's a problem for body length. There's lots of observations that we could indentify where there is a problem</p>",
        "id": 262531672,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637712311
    },
    {
        "content": "<p>I think a big problem you face in this area is suppliers and NHS trusts won't want to change the existing HL7 2.x ORU_R01 messages. They've not done this for years, no or limited move to EDIFACT, ASTM, HL7v3 and expect they aren't moving to FHIR STU3 Messaging either. </p>\n<p>So if they aren't changing the message format or interaction style, it follows they are not standardising on codes or units.<br>\nHence no appetite.</p>\n<p>However this is the old/legacy way of sharing data by distributing data only between a sender and receiver. What we should be moving to is shared records (I believe this is what many of the LHCRE and ICS are preferring), which can be used by any clinical system who has been given access (not just the sender and receivers). <br>\nI've worked on api like this in Manchester and immediately we had a demand for standardised codes and units.</p>\n<p>So my suggestion is look at these new use cases as a way of getting standardisation and don't try to modernise the old uses directly or head on.  Standards applied to the new use cases will naturally leak into the older use cases/standards.</p>",
        "id": 262550725,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1637735517
    },
    {
        "content": "<p>An example of this new shared record use case  is here <a href=\"https://digital.nhs.uk/developer/api-catalogue/covid-19-test-results-fhir\">https://digital.nhs.uk/developer/api-catalogue/covid-19-test-results-fhir</a> (and FHIR documentation is here <a href=\"https://simplifier.net/guide/nhsdigital/NHSDigital-Observation\">https://simplifier.net/guide/nhsdigital/NHSDigital-Observation</a>).</p>\n<p>Ignoring how the data got to central repositories (believe this was a mix of Hl7v2 and v3 feeds). It's a heck of lot easier to get easier to build an API like this (we are talking days/weeks, not months). No legacy to contend with, it's the modern solution (no competing technical viewpoints), fits with shared record demands from LHCRE and ICS.</p>",
        "id": 262552294,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1637737335
    },
    {
        "content": "<p>we won't be trying to impose the FHIR rules around vital signs on v2, don't worry about that</p>",
        "id": 262569466,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1637749316
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>there is a project to standardise request and observable codes, along with units and even reference ranges, for laboratory tests in Australia</p>\n</blockquote>\n</blockquote>\n<p>I've seen some of the work done in Australia, e.g. on the RCPA web site (which I hope is the right place to look) and it is does look very good. It's slightly bittersweet to poke about in the history and find links to the 'Pathology Harmony' work done in the UK over a decade ago, but all credit to the teams in Aus for making it real long term and at national level.</p>\n<p>Per the RCPA site, the Australian project have boil down their standard list to just over a hundred unique units, which is a great result. The equivalent list in the Uk is currently closer to 240 items, and I see aiming for a similiarly small set of a hundred or so as a much more useful goal than just adopting UCUM syntax, but maintaining \"open season\" on the actual unit concepts in use. Tough sell bottom-up though.</p>",
        "id": 262571228,
        "sender_full_name": "Colin E.",
        "timestamp": 1637750374
    }
]