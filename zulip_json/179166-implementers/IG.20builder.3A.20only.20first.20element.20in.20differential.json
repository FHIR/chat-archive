[
    {
        "content": "<p>Hi, I am trying to run IG builder with the test-ig examples from FHIR svn. I tried both DSTU 3 branch and master with the respective igbuilder jar. For resources created from the spreadsheet all elements are shown in the differential view, but for the test-ig-sd example the differential view only shows the first element. Same if I try with own StructureDefinitions exported from Forge. Does that sound familiar to anyone? <a href=\"/user_uploads/10155/X0rjdSdpCYpkjLstzM_pH7HN/only-first-element-in-differential.PNG\" target=\"_blank\" title=\"only-first-element-in-differential.PNG\">only-first-element-in-differential.PNG</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/X0rjdSdpCYpkjLstzM_pH7HN/only-first-element-in-differential.PNG\" target=\"_blank\" title=\"only-first-element-in-differential.PNG\"><img src=\"/user_uploads/10155/X0rjdSdpCYpkjLstzM_pH7HN/only-first-element-in-differential.PNG\"></a></div>",
        "id": 153928147,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515517069
    },
    {
        "content": "<p>If you create a profile, the differential will only show the elements listed in the spreadsheet, not everything.  Is that what's happening for you?</p>",
        "id": 153928149,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1515517661
    },
    {
        "content": "<p>Other examples using the the IG Builder here: <a href=\"https://github.com/Healthedata1/IG-Sampler\" target=\"_blank\" title=\"https://github.com/Healthedata1/IG-Sampler\">https://github.com/Healthedata1/IG-Sampler</a>   as Lloyd stated the Diff only shows only the stuff you have profiled.   The Snapshot shows everything.</p>",
        "id": 153928150,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515518889
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194778\">@Martin von Siebenthal</span> note that Forge provides a configuration setting in the Options menu to toggle saving with snapshot component (disabled by default). If you enable this option, then Forge will generate the snapshot component when saving a profile.</p>",
        "id": 153928152,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1515520907
    },
    {
        "content": "<p>it doesn't matter whether you save the snapshot or not - the IG publisher will generate it if it wants to.</p>",
        "id": 153928167,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1515534272
    },
    {
        "content": "<p>this immediately makes me think that the differential is out of order - the spreadsheet sorts, but if you provide a SD directly, it doesn't</p>",
        "id": 153928168,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1515534300
    },
    {
        "content": "<p>Thanks for your quick replies! The StructureDefinitions I tried have multiple elements profiled, both the test-ig example and my own. The problem is that I only get the first of them displayed in differential. I don't know where in the chain it goes wrong. But the intermediate *-sd.csv that is built in the temp folder already has only the first profiled element correct. Multiplicities of the other profiled elements are as in the base resource and not taken from the SD xml. test-ig-sd.xml has only one multiplicity constraint. But it has for example a mustSupport on generalPractitioner which does not make it to the test-ig-sd.csv.</p>",
        "id": 153928213,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515569290
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  which order do you mean? The order in which the elements in the differential appear compared to the order in the base resource SD? This looks the same. The test-ig-sd.xml has the constrained elements in the same order as the base resource: Patient.active, Patient.gender, ....., Patient.generalPractitioner. Or how does the spreadsheet sort?</p>",
        "id": 153928215,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515570231
    },
    {
        "content": "<p>Double check what version you're declaring.  Patient.active has moved around.  If you're building against the wrong version of FHIR, the sort order would be wrong.</p>",
        "id": 153928263,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1515595577
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> In the json control file I have \"specification\": “http://hl7.org/fhir/” and “version” : “3.0.1”.<br>\nIn the tests\\ig30\\resources\\test-ig-sd.xml I changed fhirVersion value=\"1.4.0\" to “3.0.1” but no change. The forge example profile sd.xml already said version “3.0.1” when exported from Forge. <br>\nIG publisher says \"Definitions 3.0.1.-11917\" when running.<br>\nAnywhere else where I may be pointing to a too old version? Thanks for your help.</p>",
        "id": 153928275,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515599052
    },
    {
        "content": "<p>I would have expected the change from 1.4.0 to 3.0.1 would do it.  I can't think of anything else that would be relevant.  Are you able to post your differential?</p>",
        "id": 153928278,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1515601150
    },
    {
        "content": "<p>You mean post here? I am just trying to use the tests\\ig30 example from FHIR svn, where the differential on the patient is  <br>\n&lt;differential&gt;  <br>\n  &lt;!-- <br>\n    make active required<br>\n    fix the type for deceased<br>\n    fix the value for gender<br>\n    constrain birthdate<br>\n  --&gt;<br>\n  &lt;element&gt;<br>\n    &lt;path value=\"Patient.active\"/&gt;<br>\n    &lt;min value=\"1\"/&gt;<br>\n  &lt;/element&gt;<br>\n  &lt;element&gt;<br>\n    &lt;path value=\"Patient.gender\"/&gt;<br>\n    &lt;fixedCode value=\"female\"/&gt;<br>\n  &lt;/element&gt;<br>\n  &lt;element&gt;<br>\n    &lt;path value=\"Patient.birthDate\"/&gt;<br>\n    &lt;constraint&gt;<br>\n      &lt;key value=\"tst-1\"/&gt;<br>\n      &lt;severity value=\"error\"/&gt;<br>\n      &lt;human value=\"A full date is required\"/&gt;<br>\n      &lt;expression value=\"length() = 8\"/&gt;<br>\n    &lt;/constraint&gt;<br>\n  &lt;/element&gt;<br>\n  &lt;element&gt;<br>\n    &lt;path value=\"Patient.deceased[x]\"/&gt;<br>\n    &lt;type&gt;<br>\n      &lt;code value=\"dateTime\"/&gt;<br>\n    &lt;/type&gt;<br>\n    &lt;mustSupport value=\"true\"/&gt;<br>\n  &lt;/element&gt;<br>\n  &lt;element&gt;<br>\n    &lt;path value=\"Patient.generalPractitioner\"/&gt;<br>\n    &lt;type&gt;<br>\n      &lt;code value=\"Reference\"/&gt;<br>\n      &lt;profile value=\"http://hl7.org/fhir/StructureDefinition/Organization\"/&gt;<br>\n      &lt;aggregation value=\"contained\"/&gt;<br>\n    &lt;/type&gt;<br>\n    &lt;mustSupport value=\"true\"/&gt;<br>\n  &lt;/element&gt;<br>\n &lt;/differential&gt;</p>\n<p>I tried one on CareTeam with only multiplicities (my forge example. Just clicked some, not trying to make clinical sense in this example):</p>\n<p>&lt;differential&gt;<br>\n    &lt;element id=\"CareTeam.subject\"&gt;<br>\n      &lt;path value=\"CareTeam.subject\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"CareTeam.context\"&gt;<br>\n      &lt;path value=\"CareTeam.context\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"CareTeam.period\"&gt;<br>\n      &lt;path value=\"CareTeam.period\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"CareTeam.reasonCode\"&gt;<br>\n      &lt;path value=\"CareTeam.reasonCode\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n      &lt;max value=\"1\" /&gt;<br>\n      &lt;mustSupport value=\"true\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"CareTeam.reasonReference\"&gt;<br>\n      &lt;path value=\"CareTeam.reasonReference\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n      &lt;max value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"CareTeam.note\"&gt;<br>\n      &lt;path value=\"CareTeam.note\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n      &lt;max value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n  &lt;/differential&gt;</p>",
        "id": 153928282,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515602606
    },
    {
        "content": "<p>That looks fine for 3.0.1.  Can you attach the StructureDefinition that's generated by the build process?</p>",
        "id": 153928289,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1515605639
    },
    {
        "content": "<p>Look at the qa.html  file to see what is wrong with the StructureDefinition for this profile <code>test-ig-sd.xml</code> its missing the id element and the order of elements is wrong.  I think that is the problemo</p>",
        "id": 153928290,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515605711
    },
    {
        "content": "<p>What's wrong with the order?</p>",
        "id": 153928292,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1515605826
    },
    {
        "content": "<p><code>date</code> was in the wrong place.  After fixing the qa issues, I can't get it to render either.  it will only display a single element in the diff even if comment out active will only display gender etc.   Mysterious.</p>",
        "id": 153928305,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515607540
    },
    {
        "content": "<p>here is my modified sd.xml file<a href=\"/user_uploads/10155/vxWtOd3DuTLDEkSrizz9doHO/test-ig-sd.xml\" target=\"_blank\" title=\"test-ig-sd.xml\">test-ig-sd.xml</a></p>",
        "id": 153928306,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515608086
    },
    {
        "content": "<p>The Patient.generalPractitioner element has an invalid profile constraint. This should be a typeProfile constraint, since the referenced profile constrains the target of the reference (Organization), not the reference itself.<br>\nDon't know if this fixes the rendering error...</p>",
        "id": 153928395,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1515664279
    },
    {
        "content": "<p>I'm getting the same \"only first profiled element\" symptom in rendering with above CareTeam differential, which only has multiplicities and a mustSupport.... indeed mysterious as some of the IG sampler examples such as structuredefinition-template-basic2.xml are also xml (non-spreadsheet)  based and properly generated Dec 13, 2017...???</p>",
        "id": 153928404,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515665483
    },
    {
        "content": "<p>does anyone have an example of this that is open source somewhere so I can have a look at it?</p>",
        "id": 153928410,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1515668109
    },
    {
        "content": "<p>I have my dummy example that I can zip and post. Here? Or do you have a location where I can drop it?</p>",
        "id": 153928420,
        "sender_full_name": "Martin von Siebenthal",
        "timestamp": 1515676043
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>   look at   /tests/ig30 out of the build.</p>",
        "id": 153928462,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515697921
    },
    {
        "content": "<p>and run it out of the box and you will see profile #1 only list the first element in the diff</p>",
        "id": 153928463,
        "sender_full_name": "Eric Haas",
        "timestamp": 1515697966
    },
    {
        "content": "<p>ok</p>",
        "id": 153928491,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1515702323
    }
]