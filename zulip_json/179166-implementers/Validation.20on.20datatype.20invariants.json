[
    {
        "content": "<p>Hello,  I wanted to add invariant over Quantity datatype to say system should be(warning) an UCUM system(<a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>) and created a datatype profile over Quantity, now this profile referenced at MedicationStatement.dosage.doseAndRate.dose[x] for quantity type.</p>\n<p>While validating the medication statement instance(updated HL7 medication statement sample to mentioned quantity system other then UCUM )  against medication statement profile using latest Java validator which got success instead of expected warning.</p>\n<p>Quantity.system invariant  - <br>\n&lt;severity value=\"warning\"/&gt;<br>\n&lt;expression value=\"system.exists() implies system='http://unitsofmeasure.org'\"/&gt;</p>\n<p>instance snippet - assume all other need data are there including meta {<br>\n  \"resourceType\": \"MedicationStatement\",<br>\n  \"dosage\": [<br>\n    {<br>\n      \"doseAndRate\": [<br>\n        {<br>\n          \"doseQuantity\": {<br>\n            \"value\": 1,<br>\n            \"unit\" : \"Dosage\",<br>\n            \"system\": \"<a href=\"http://snomed.info/sct\">http://snomed.info/sct</a>\",<br>\n            \"code\": \"260911001\"<br>\n          }<br>\n        }<br>\n      ]<br>\n    }<br>\n  ]<br>\n} </p>\n<p>I think validator should give a warning as per invariant on datatype, but it is not giving any warning.<br>\nLet me know if I am missing anything here, thanks</p>",
        "id": 251226371,
        "sender_full_name": "Kailash",
        "timestamp": 1630328999
    },
    {
        "content": "<p>Can you post both your data type and MedicationStatement profile here as well as your instance and how you're invoking the validator?</p>",
        "id": 251252139,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630339490
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> ,, thanks for reply, please find the attachment. <a href=\"/user_uploads/10155/nOnVemXzAPvH6bo3GKLuywal/DataTypeInvariantValidation.zip\">DataTypeInvariantValidation.zip</a></p>",
        "id": 251340520,
        "sender_full_name": "Kailash",
        "timestamp": 1630393057
    },
    {
        "content": "<p>The location of your invariant is incorrect.  It's being declared on 'system', but the invariant is <code>        &lt;expression value=\"system.exists() implies system='http://unitsofmeasure.org'\" /&gt;</code><br>\nThat means \"if system.system exists, then system.system needs to be <a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>\".  Move your extension up to be declared on Quantity and try again</p>",
        "id": 251387174,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630417560
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  for finding, on first hand testing its working!!</p>",
        "id": 251528126,
        "sender_full_name": "Kailash",
        "timestamp": 1630488168
    }
]