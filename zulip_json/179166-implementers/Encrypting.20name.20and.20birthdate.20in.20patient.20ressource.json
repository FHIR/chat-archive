[
    {
        "content": "<p>Hi,<br>\nwe need to encrypt the patient's name and birthdate before we store it. So we would like to store a patient like this (other fields that don't need to be encrypted were neglected now):</p>\n<p>&lt;Patient xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n   ..... <br>\n   &lt;name&gt;<br>\n        &lt;family&gt;<br>\n            &lt;extension url=\"<a href=\"http://fhir.de/StructureDefinition/encrypted\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/encrypted\">http://fhir.de/StructureDefinition/encrypted</a>\"&gt;<br>\n                &lt;valueString value=\"hffsklghskh\" /&gt;<br>\n            &lt;/extension&gt;<br>\n        &lt;/family&gt;<br>\n        &lt;given&gt;<br>\n            &lt;extension url=\"<a href=\"http://fhir.de/StructureDefinition/encrypted\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/encrypted\">http://fhir.de/StructureDefinition/encrypted</a>\"&gt;<br>\n                &lt;valueString value=\"fsdkfhsjkd\" /&gt;<br>\n            &lt;/extension&gt;<br>\n        &lt;/given&gt;<br>\n    &lt;/name&gt;<br>\n    &lt;birthDate&gt;<br>\n     &lt;extension url=\"<a href=\"http://fhir.de/StructureDefinition/encrypted\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/encrypted\">http://fhir.de/StructureDefinition/encrypted</a>\"&gt;<br>\n                &lt;valueString value=\"jksdfgsdhkgfsj\" /&gt;<br>\n            &lt;/extension&gt;<br>\n   &lt;/birthDate&gt;<br>\n&lt;/Patient&gt;</p>\n<p>However, our Vonk-Server does not allow this Ressource, because it expects a value for the fields \"given\" and \"family\". The \"birthDate\" field however is accepted without a value. I could set the value of \"given\" and \"family\" to ENCRYPTED but I would just like to leave it empty.</p>\n<p>Are there no null values for \"given\" and  \"family\"? Or is there a better \"FHIR\"-way to solve this?</p>",
        "id": 161664023,
        "sender_full_name": "Paul Pawletta",
        "timestamp": 1553533295
    },
    {
        "content": "<p>For internal persistence, you can store data however you like.  In most systems, it won't look like FHIR at all.  All that matters is that when you <em>exchange</em> the data, it's valid FHIR and is as correct as it can be.  I.e. when exchanging, the birth date and name need to be the real (unencrypted) birth date and name.  If encryption is needed during transport it happens at the channel level or applies to the resource as a whole.</p>",
        "id": 161664748,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1553533778
    },
    {
        "content": "<p>If you're using a FHIR persistence layer and you need to add encryption, you'll have to customize the persistence layer to achieve that.</p>",
        "id": 161664845,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1553533822
    },
    {
        "content": "<p>Hm, in our case some of the fields like \"given\", \"family\" and \"birthDate\" come encrypted from the client and we are only allowed to store the encrypted fields. Other fields are not encrypted and should be stored un-encrpyted.</p>",
        "id": 161665414,
        "sender_full_name": "Paul Pawletta",
        "timestamp": 1553534165
    },
    {
        "content": "<blockquote>\n<p>our Vonk-Server does not allow this Ressource, because it expects a value for the fields \"given\" and \"family\".</p>\n</blockquote>\n<p>Looks like a bug in Vonk to me - that resource is valid</p>",
        "id": 161665844,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1553534465
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span></p>",
        "id": 161681898,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553544091
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"214893\">@Paul Pawletta</span> : This resource is accepted at <a href=\"http://vonk.fire.ly\" target=\"_blank\" title=\"http://vonk.fire.ly\">vonk.fire.ly</a> (currently version 2.0.0-beta) and also on version 1.0.0 (tested both because of considerable changes in 2.0). So maybe the problem is in the prevalidation (validation upon create / update), but to test that I would also need the StructureDefinition for the extension. And since I could not find it on Simplifier - could you provide it?</p>",
        "id": 161755856,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1553603117
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span> <a href=\"/user_uploads/10155/c5c52VMxOoByGkOYu8-oZavL/encrypted.json\" target=\"_blank\" title=\"encrypted.json\">encrypted.json</a></p>\n<p>We see the following error stacktrace</p>\n<p>System.ArgumentNullException: String reference not set to an instance of a String.<br>\nParameter name: s<br>\n   at System.Text.Encoding.GetBytes(String s)<br>\n   at Vonk.Core.Support.StringExtensions.GetMd5Hash(String input)<br>\n   at Vonk.Repository.EntityFramework.Db.EfStringComponent.set_Value(String value)<br>\n   at Vonk.Repository.EntityFramework.Db.EfEntryBuilder.AddStringComponent(String name, String value)<br>\n   at Vonk.Core.Repository.EntryIndexer<code>1.AddHumanNameComponent(String name, IElementNavigator nav)\n   at Vonk.Core.Repository.EntryIndexer</code>1.AddComponentsForParameter(VonkSearchParameter searchParameter, IElementNavigator root)<br>\n   at Vonk.Core.Repository.EntryIndexer<code>1.AddComponentsForParameters(IEnumerable</code>1 searchParameters)<br>\n   at Vonk.Core.Repository.EntryIndexer<code>1.InternalIndexForParameters(IEnumerable</code>1 parameters)<br>\n   at Vonk.Repository.EntityFramework.Change.EfChangeRepository.InsertEntry(IResource input)<br>\n   at Vonk.Repository.Sql.SqlChangeRepository.InsertEntry(IResource input)<br>\n   at Vonk.Repository.Generic.GenericChangeRepository.Create(IResource input)<br>\nVonk.Core.Operations.Crud.CreateService:Error: Error encountered when creating resource 'Patient/cef015dc-a055-447f-b0a3-e5466282f7da/_history/63d5dc2c-7fcd-4c75-9cd7-56a64ae60072'</p>",
        "id": 161757860,
        "sender_full_name": "Paul Pawletta",
        "timestamp": 1553604558
    },
    {
        "content": "<p>on a Security/Privacy front.. I hope no one is thinking that this kind of encrypting of the name is protecting privacy or adding any security. This kind of a system is bad security. An adversary can easily identify the encrypted blobs as being equal to an unencrypted text. The prime mistake here is to encrypt element-by-element, leaving the length, and not adding random strings to get better entropy.   Serious re-identification risk exists.</p>",
        "id": 161759884,
        "sender_full_name": "John Moehrke",
        "timestamp": 1553605979
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> : don't worry, nothing of that kind. MD5 is not for encryption, we know that much. Or did you mean the solution with encrypted extensions by Paul?<br>\n<span class=\"user-mention\" data-user-id=\"214893\">@Paul Pawletta</span> : Confirmed, consider it fixed in the next release.</p>",
        "id": 161766434,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1553610397
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span>  great. Thank you!</p>",
        "id": 161766826,
        "sender_full_name": "Paul Pawletta",
        "timestamp": 1553610631
    },
    {
        "content": "<p>I am concerned about the use of encryption that I see in Paul's initial message.</p>",
        "id": 161772194,
        "sender_full_name": "John Moehrke",
        "timestamp": 1553613752
    },
    {
        "content": "<p>y it probably doesn't make much sense but there's lots out there that doesn't and Paul's comments make clear that this is one of the previously made decisions that you live with</p>",
        "id": 161801881,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553633738
    },
    {
        "content": "<p>I live with lots of past bad decisions... I thus want everyone else reading this thread to understand that Paul is living with this bad decision. Thus they should not think it is an approved good practice.</p>",
        "id": 161856663,
        "sender_full_name": "John Moehrke",
        "timestamp": 1553691858
    }
]