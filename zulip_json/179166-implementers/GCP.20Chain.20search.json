[
    {
        "content": "<p>Hello,<br>\nI wanna search Encounter base on Patient Birthdate with GCP healthcare api.<br>\nQuery be like: <code>&lt;Base Path&gt;Encounter?patient.active=false&amp;patient.birthdate=2020-01-01</code><br>\nExpect: 6 data in response<br>\nActual: </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;issue&quot;: [\n    {\n      &quot;code&quot;: &quot;no-store&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;storage_error&quot;\n      },\n      &quot;severity&quot;: &quot;error&quot;\n    }\n  ],\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;\n}\n</code></pre></div>\n\n\n<p>After that, i try to remove param <code>patient.active=false</code> on search <br>\nQuery be like: <code>&lt;Base Path&gt;Encounter?patient.birthdate=2020-01-01</code><br>\nExpect: 6 data<br>\nActual: 6 data</p>",
        "id": 205473327,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1596113097
    },
    {
        "content": "<p>With what server?  The OperationOutcome is certainly a little light on detail...</p>",
        "id": 205489397,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1596121197
    },
    {
        "content": "<p>(GCP = Google Cloud Platform)</p>\n<p>I'm unable to reproduce this error, the same chained query works for me. The generic storage_error usually indicates an internal error in the storage layer so there are a variety of possible causes. I'll have to investigate further - I would expect this query to succeed.</p>",
        "id": 205506029,
        "sender_full_name": "Paul Church",
        "timestamp": 1596129414
    },
    {
        "content": "<p>Seem like the error relate to relationship.<br>\nI try with another birthdate which return only 1, 2 result and the query work like a charm.</p>",
        "id": 205545240,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1596152751
    },
    {
        "content": "<p>For example:</p>\n<p>Query be like: <code>&lt;Base Path&gt;Encounter?patient.active=false&amp;patient.birthdate=2020-02-01</code><br>\nExpect: 2 data as response<br>\nActual: 2 data</p>\n<p>I was try search PractitionerRole base on  <a href=\"http://Practitioner.name\">Practitioner.name</a> and <a href=\"http://Organization.name\">Organization.name</a>. If response result is bigger than 7. Same error will return</p>",
        "id": 205545459,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1596152950
    },
    {
        "content": "<p>Thanks for the detailed report. I have identified a bug triggered by having two chained search clauses in a query, where both clauses are chaining on the same search parameter (patient, in this case). I'm working on a fix.</p>",
        "id": 205620992,
        "sender_full_name": "Paul Church",
        "timestamp": 1596218125
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> <br>\nThank you so much,<br>\nI have one more problem with chain search in here<br>\nI try to write a query to get all Encounter where have <code>participant:PractitionerRole._id= {Id1}</code><br>\nQuery will like:<br>\n<code> Encounter?participant:PractitionerRole._id=001</code><br>\nData base will like:</p>\n<p>Encounter 1: include <code>PractitionerRole id = 001</code><br>\nEncounter 2: include <code>PractitionerId = 001</code></p>\n<p>Expect: GCP return Encounter 1</p>\n<p>Actual: GCP return both Encounter 1 &amp; 2</p>\n<p>I was try to add header \"Prefer: handling=strict \" and no error with query above.<br>\nSeem like server ignore ResourceType in <code>participant:PractitionerRole._id</code> and only care about <code>participant._id</code>. So, result is incorrect</p>",
        "id": 205670401,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1596268604
    },
    {
        "content": "<p>I'll take a look at that as well. There is a known issue where a resource with references to A/001 and B/002 will incorrectly match searches for A/002 or B/001 but your example might not be the same case. We do check the type on a typed chain query so if the IDs are unique I expect it to work.</p>",
        "id": 205923480,
        "sender_full_name": "Paul Church",
        "timestamp": 1596555742
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"279912\">@Hue Nguyen</span> I tested this out and confirmed that it is the known issue that I thought it was.</p>\n<p>You will only encounter this issue in the case where the Encounter contains multiple participant references, one of which is Practitioner/001 and another is PractitionerRole/&lt;any ID&gt;. This resource will incorrectly match PractitionerRole/001. In general, typed chained search is filtered by resource type. The issue is specific to references that have multiple values of different resource types.</p>\n<p>We recommend keeping resource IDs unique where possible as the easiest workaround.</p>",
        "id": 206977037,
        "sender_full_name": "Paul Church",
        "timestamp": 1597436326
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> Sorry for late response.<br>\nThank you for your supporting</p>",
        "id": 207150619,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1597674626
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197072\">Paul Church</span> <a href=\"#narrow/stream/179166-implementers/topic/GCP.20Chain.20search/near/205620992\">said</a>:</p>\n<blockquote>\n<p>Thanks for the detailed report. I have identified a bug triggered by having two chained search clauses in a query, where both clauses are chaining on the same search parameter (patient, in this case). I'm working on a fix.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> How's this going?<br>\nDo you know when will it done <span aria-label=\"pray\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"pray\">:pray:</span></p>",
        "id": 208516038,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1598842635
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"279912\">@Hue Nguyen</span> The fix is rolled out to some regions already, it should be live in all regions in about 2 more days.</p>",
        "id": 208609958,
        "sender_full_name": "Paul Church",
        "timestamp": 1598905060
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> I see, thank you so much</p>",
        "id": 208626742,
        "sender_full_name": "Hue Nguyen",
        "timestamp": 1598915268
    }
]