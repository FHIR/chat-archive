[
    {
        "content": "<p>Getting a NullPointerException upon Snapshot generation with the HL7Validation tool 5.1.16 (using FHIR R4 profiles on top of Observation)</p>\n<p>BASEDEFINITION HAS:<br>\n   &lt;element id=\"Observation.value[x]:valueQuantity.code\"&gt;<br>\n      &lt;path value=\"Observation.value[x].code\" /&gt;<br>\n      &lt;binding&gt;<br>\n        &lt;strength value=\"required\" /&gt;<br>\n        &lt;valueSet value=\"<a href=\"http://hl7.org/fhir/ValueSet/ucum-vitals-common\">http://hl7.org/fhir/ValueSet/ucum-vitals-common</a>\" /&gt;<br>\n      &lt;/binding&gt;<br>\n    &lt;/element&gt;</p>\n<p>THIS WORKS on the derived profile:<br>\n    &lt;element id=\"Observation.value[x]:valueQuantity.code\"&gt;<br>\n      &lt;path value=\"Observation.value[x].code\" /&gt;<br>\n      &lt;fixedCode value=\"Cel\" /&gt;<br>\n    &lt;/element&gt;</p>\n<p>REPLACING BY THIS THROWS NULLPOINTEREXCEPTION on the Derived profile<br>\n    &lt;element id=\"Observation.value[x]:valueQuantity.code\"&gt;<br>\n      &lt;path value=\"Observation.value[x].code\" /&gt;<br>\n      &lt;binding&gt;<br>\n        &lt;strength value=\"required\" /&gt;<br>\n        &lt;valueSet value=\"<a href=\"http://hl7.org/fhir/ValueSet/ucum-bodytemp\">http://hl7.org/fhir/ValueSet/ucum-bodytemp</a>\" /&gt;<br>\n      &lt;/binding&gt;<br>\n    &lt;/element&gt;</p>\n<p>We're at loss... since the profiles do validate and work fine in Simplifier and IG Publisher snapshot generation. A bug?</p>\n<p>I can supply the full profiles.</p>\n<p>FHIR Validation tool Version 5.1.16 (Git# ea0b4c0c1c10). Built 2020-10-01T04:39:09.65Z (105 days old)<br>\n  Java:   15 from /usr/java/openjdk-15 on amd64 (64bit). 4012MB available<br>\n  Paths:  Current = /usr/data/npmpackage/package, Package Cache = /root/.fhir/packages<br>\n  Params: ./BodyTemperatureVitalSign.structuredefinition.xml -ig /usr/data/npmpackage/package -tx n/a -version 4.0 -snapshot -output /usr/data/npmpackage/package_snapshots/./BodyTemperatureVitalSign.structuredefinition.xml<br>\nLoading<br>\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1 - 4575 resources (00:05.0209)<br>\n  Terminology server null - Version n/a: No Terminology Server (00:00.0000)<br>\n  Load /usr/data/npmpackage/package - 179 resources (00:00.0348)<br>\n  Get set...  go (00:00.0765)<br>\nException in thread \"main\" java.lang.NullPointerException: Cannot invoke \"java.util.List.add(Object)\" because \"this.messages\" is null<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.updateFromDefinition(ProfileUtilities.java:2717)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1088)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1521)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:985)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:985)<br>\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:572)<br>\n    at org.hl7.fhir.validation.ValidationEngine.snapshot(ValidationEngine.java:1597)<br>\n    at org.hl7.fhir.validation.cli.services.ValidationService.generateSnapshot(ValidationService.java:119)<br>\n    at org.hl7.fhir.validation.Validator.main(Validator.java:198)</p>",
        "id": 222723781,
        "sender_full_name": "David Simons",
        "timestamp": 1610634507
    },
    {
        "content": "<p>as questions about the IG publisher on the <a class=\"stream\" data-stream-id=\"179252\" href=\"/#narrow/stream/179252-IG-creation\">#IG creation</a> stream will get best results</p>",
        "id": 222724223,
        "sender_full_name": "John Moehrke",
        "timestamp": 1610634717
    },
    {
        "content": "<p>so you are trying to constrain the UCUM codes to just the body temperature ones?   Have you tried changing your vocabulary url root to <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a>?</p>",
        "id": 222724544,
        "sender_full_name": "John Moehrke",
        "timestamp": 1610634840
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span></p>\n<p>yes indeed, the derived profile for BodyTemperatureVitalSign.structuredefinition constrains the VitalSign.structuredefinition further down.</p>\n<p>Note that if I copy the &lt;valueSet value=\"<a href=\"http://hl7.org/fhir/ValueSet/ucum-bodytemp\">http://hl7.org/fhir/ValueSet/ucum-bodytemp</a>\" /&gt; to the baseDefinition (parent), it resolves just fine.</p>\n<p>Seems to relate to the overwriting of the parent valueSet binding with a (narrower, subset) valueSet binding - and more a bug than a profiling error (to me :))</p>\n<p>where would I make that change on url root to <a href=\"http://terminology.hl7.org\">http://terminology.hl7.org</a>? ? (in what tool, specifically) did you mean via hl7validator -tx ?</p>\n<p>PS: this is rather about profiling and HL7Validation tool - should I use <a class=\"stream\" data-stream-id=\"179239\" href=\"/#narrow/stream/179239-tooling\">#tooling</a> ?</p>",
        "id": 222725093,
        "sender_full_name": "David Simons",
        "timestamp": 1610635050
    },
    {
        "content": "<p><a class=\"stream\" data-stream-id=\"179239\" href=\"/#narrow/stream/179239-tooling\">#tooling</a> is legit, but <a class=\"stream\" data-stream-id=\"179252\" href=\"/#narrow/stream/179252-IG-creation\">#IG creation</a> is most active for validator issues (because that's where a <em>whole</em> lot of them manifest :)</p>",
        "id": 222771891,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1610653269
    },
    {
        "content": "<p>oh wow... looks like the culprit is indeed due to our validation not including a terminology server access  -- removing -tx n/a - which we had done for reliability of our build pipeline - resolves the above issue apparently!  </p>\n<p>still not good that this throws a nullpointerexception - rather than an error message <br>\nthere's a lot of uncaught  this.messages.add() calls that do not filter on (this.messages != null) in the code, at a glance.</p>\n<p>thanks for thinking along!</p>",
        "id": 222848053,
        "sender_full_name": "David Simons",
        "timestamp": 1610711702
    },
    {
        "content": "<p>I agree that NPEs shouldn't happen. How do I reproduce this?</p>",
        "id": 222911871,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1610738901
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/.5BHL7.20Validation.20tool.5D.20NullPointerException/near/222911871\">said</a>:</p>\n<blockquote>\n<p>I agree that NPEs shouldn't happen. How do I reproduce this?</p>\n</blockquote>\n<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> will send you a set of profiles soon - peeling it out of our buld pipeline now.</p>",
        "id": 223151041,
        "sender_full_name": "David Simons",
        "timestamp": 1610993880
    }
]