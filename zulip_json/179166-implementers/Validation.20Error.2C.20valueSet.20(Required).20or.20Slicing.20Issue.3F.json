[
    {
        "content": "<p>Hi, please can I get some advice on the following HAPI validation error on a STU3 patient profile :</p>\n<p>ERROR — Problem evaluating slicing expression for element in profile &lt;<a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\">https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1</a>&gt; path Bundle.entry[4].resource.entry[4].resource.name[1] (fhirPath = true and (use memberOf ‘http://hl7.org/fhir/ValueSet/name-use’)).</p>\n<p>I can think of two possible causes of the error, but there might be another reason:</p>\n<p>1. The error mentions the valueSet “http://hl7.org/fhir/ValueSet/name-use”.  Looking at the FHIR base profile this has a binding strength of “Required” for Patient.name(HumanName).use.  I think the problem is that in the name.use attribute of the CareConnect-Patient-1 profile, we have used the ValueSet, “https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1”  (this references “http://hl7.org/fhir/ValueSet/name-use” and uses the CodeSystem <a href=\"http://hl7.org/fhir/name-use\" target=\"_blank\" title=\"http://hl7.org/fhir/name-use\">http://hl7.org/fhir/name-use</a>, but has ConceptMap and mapping information, hence it has a different name to the FHIR base resource ValueSet).    We did wonder if the ValueSet uses the same CodeSystem as the FHIR base resource, then shouldn’t this pass the HAPI validation tests?<br>\n2. The other possibility is that it might not be the ValueSet, but the slicing on .name attribute of the CareConnect-Patient-1 profile, where both .name (other) attribute and name (official) attribute of the CareConnect-Patient-1 profile, are Sliced with a Discriminator: use. A slicing problem could occur where the .name (official).use attribute and the .name (other).use attribute both use “official” as the value, and thus the discriminator can’t work.<br>\nIf anyone has seen this type of error before, and know what the solution is, I’d very much appreciate some advice.</p>\n<p>Many thanks<br>\nJohn<br>\nValidation Error, valueSet required or slicingValidation Error, valueSet required or slicing</p>",
        "id": 166286511,
        "sender_full_name": "John George",
        "timestamp": 1558543721
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> (also, you might raise this on the <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a> stream)</p>",
        "id": 166287740,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1558544611
    },
    {
        "content": "<p>well, the error will be inside the validator, and it shouldn't relate to how the validator is packaged, so I expect it's something I should look at. <span class=\"user-mention\" data-user-id=\"191847\">@John George</span> can you package it up as a test case?</p>",
        "id": 166303842,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558555096
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  , many thanks for sparing the time to look into this.  The error message is:</p>\n<p>ERROR — Problem evaluating slicing expression for element in profile <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\">https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1</a> path Bundle.entry[4].resource.entry[4].resource.name[1] (fhirPath = true and (use memberOf ‘http://hl7.org/fhir/ValueSet/name-use’))</p>\n<p>The STU3 FHIR profile can be viewed at: &lt; <a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1\">https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Patient-1</a>&gt;</p>\n<p>For the test case, I have also attached the Validation Report and the relevant XML instance example.  Please let me know if there is anything else you need to investigate this.  </p>\n<p>Many thanks, John<br>\n<a href=\"/user_uploads/10155/-PS0afzDenPBV5WuyL3-UMLP/ITK009D_20190515143638865.xml\" target=\"_blank\" title=\"ITK009D_20190515143638865.xml\">ITK009D_20190515143638865.xml</a> <br>\n<a href=\"/user_uploads/10155/UClAA25HQAUXrl7XtU8YmRH7/validation_report_ITK009D_20190515143638865.html.txt\" target=\"_blank\" title=\"validation_report_ITK009D_20190515143638865.html.txt\">validation_report_ITK009D_20190515143638865.html.txt</a></p>",
        "id": 166317790,
        "sender_full_name": "John George",
        "timestamp": 1558566994
    },
    {
        "content": "<p>looking at this:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;coding&gt;\n  &lt;system value=&quot;http://snomed.info/sct&quot; /&gt;\n  &lt;code value=&quot;eligcrit&quot; /&gt;\n   &lt;display value=&quot;Eligibility criteria&quot; /&gt;\n&lt;/coding&gt;```\n\nis an error from the validator for me. But not flagged as an error in your error report... weird. There&#39;s several other snomed issues - unknown codes - which I will take as UK distribution codes\n</pre></div>",
        "id": 166326929,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558578469
    },
    {
        "content": "<p>and other than that it all validates ok for me</p>",
        "id": 166327005,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558578564
    },
    {
        "content": "<p>it's possible that it's a versioning issue - the 3.8 validator is running behind.</p>",
        "id": 166327012,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558578594
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, that’s interesting that your version of the validator does not find the error regarding \"<a href=\"http://hl7.org/fhir/ValueSet/name-use\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/name-use\">http://hl7.org/fhir/ValueSet/name-use</a>\". We are using HAPI FHIR Software Version: 3.7.0 February 2nd, 2019, do you know when the new version of HAPI will be available for public use?</p>\n<p>Thanks for highlighting the SNOMED errors, those should be easy to correct in the XML instance example.  Regards, John</p>",
        "id": 166346351,
        "sender_full_name": "John George",
        "timestamp": 1558604727
    },
    {
        "content": "<p>you'll have to ask on the HAPI support forum what that roadmap is</p>",
        "id": 166357847,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558616367
    },
    {
        "content": "<p>Hi  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , though I appreciate your validator is not finding the ValueSet error,  I am wondering about the way we have constrained a FHIR profile, where the FHIR base resource has a  binding strength of “Required” for a valueSet.    Looking at the FHIR base profile, <a href=\"http://Patient.name\" target=\"_blank\" title=\"http://Patient.name\">Patient.name</a> (HumanName).use, the valueSet &lt;<a href=\"http://hl7.org/fhir/ValueSet/name-use\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/name-use\">http://hl7.org/fhir/ValueSet/name-use</a>&gt; has a binding strength of “Required”.  In our profile, CareConnect-Patient-1, for the name.use attribute we have used a different ValueSet, &lt;<a href=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\">https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1</a>&gt;, but this references the FHIR base valueSet &lt;<a href=\"http://hl7.org/fhir/ValueSet/name-use\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/name-use\">http://hl7.org/fhir/ValueSet/name-use</a>&gt; and uses the CodeSystem &lt;<a href=\"http://hl7.org/fhir/name-use\" target=\"_blank\" title=\"http://hl7.org/fhir/name-use\">http://hl7.org/fhir/name-use</a>&gt;.   It has a different name to the FHIR base resource ValueSet, to allow for the use of ConceptMap and mapping information.  Is our approach for a “Required” for this valueSet correct in these circumstances?</p>",
        "id": 166372041,
        "sender_full_name": "John George",
        "timestamp": 1558625603
    },
    {
        "content": "<p>well, I'm not sure what I'm seeing. I see 'old' multiple times in the value set here: <a href=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\">https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1</a></p>",
        "id": 166392483,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558640212
    },
    {
        "content": "<p>that seems ... weird. Is it a view issue, or is something more implied?</p>",
        "id": 166392527,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558640243
    },
    {
        "content": "<p>the value set is the same, no? I don't understand why to redefine it if you aren't redefining it?</p>",
        "id": 166392650,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558640306
    },
    {
        "content": "<p>thought that's just redundant, not wrong</p>",
        "id": 166392680,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558640336
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191847\">@John George</span> James Agnew mentioned in <a href=\"#narrow/stream/179167-hapi/topic/FhirInstanceValidator.20-.20code.20in.20a.20slice\" title=\"#narrow/stream/179167-hapi/topic/FhirInstanceValidator.20-.20code.20in.20a.20slice\">this thread</a> that the new 3.8 release of HAPI is coming next Tuesday.</p>",
        "id": 166429188,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1558682382
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  the reason 'old' is displayed  multiple times is due to the way our tooling renders the ConceptMap information with the ValueSet.   The valueSet itself, only has &lt;code value=\"old\"/&gt; mentioned once, as shown in the XML for that ValueSet here:  &lt;<a href=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1/_history/3.0.1?_format=xml\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1/_history/3.0.1?_format=xml\">https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1/_history/3.0.1?_format=xml</a>&gt;.  My limited understanding of this is that we had a requirement for a mapping to patient demographic service (PDS) codes, such as, \"PREVIOUS-BACHELOR\", which would map to the code of \"OLD\", in the FHIR base valueSet, so we needed to use a ConceptMap &lt;<a href=\"https://fhir.hl7.org.uk/STU3/ConceptMap/CareConnect-PersonNameType-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/ConceptMap/CareConnect-PersonNameType-1\">https://fhir.hl7.org.uk/STU3/ConceptMap/CareConnect-PersonNameType-1</a>&gt;.  However, the way our tooling works with ConceptMaps is that we need to use local ValueSets, hence we created &lt;<a href=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1\">https://fhir.hl7.org.uk/STU3/ValueSet/CareConnect-NameUse-1</a>&gt; that references the FHIR base valueSet.</p>",
        "id": 166435976,
        "sender_full_name": "John George",
        "timestamp": 1558689607
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span> , thanks for the  release date of the latest version of HAPI.</p>",
        "id": 166436079,
        "sender_full_name": "John George",
        "timestamp": 1558689727
    }
]