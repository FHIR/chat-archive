[
    {
        "content": "<p>Hi all!<br>\nI'm using the javascript fhirclient library (and currently the public sandbox for SMART on FHIR) to try and search for Patients with particular attributes. I'm currently wrestling with how to craft the search query for MedicationRequests for specific medications. For example, if I wanted to find Patients who were taking a 325 mg oral table of Acetaminophen, I know that has a code of: 313782.  I've tried a couple things:</p>\n<p>Doing this search:</p>\n<p>client.request(<code>/MedicationRequest?medication.code=313782</code>, {<br>\n      pageLimit: 1,<br>\n      flat: true<br>\n    });</p>\n<p>returns an empty list. So, it seems to be correctly crafted but the results are not what I expect. I know there are patients in the sandbox who have taken this pill.</p>\n<p>And actually that's not the query I want. I want to use the name of the medication, not the code, so that I get ALL instances of someone taking Acetaminophen, not just the 325mg oral pill.  So, I'd like to do something like this:</p>\n<p>client.request(<code>/MedicationRequest?medication.text=acetaminophen</code>, {<br>\n      pageLimit: 1,<br>\n      flat: true<br>\n    })</p>\n<p>But that returns an error:   \"Invalid parameter chain: medication.text\"</p>\n<p>So, how do I query for medication requests that involve a particular medication (e.g. acetaminophen)</p>\n<p>Many thanks!</p>",
        "id": 180655430,
        "sender_full_name": "Mike",
        "timestamp": 1573669068
    },
    {
        "content": "<p>medication:text should work better.  ('text' is a qualifier that says to search the CodeableConcept.text and Coding.display elements)</p>",
        "id": 180659020,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573671275
    },
    {
        "content": "<p>The <code>medication</code> search parameter targets <code>medicationReference</code>. You should use <code>code:text</code> to target <code>medicationCodeableConcept</code> (but it won't work on most servers)</p>",
        "id": 180660839,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1573672384
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> Thank you for the help! Feels like I'm on the right track, but not quite there.</p>\n<p>So, doing this returns an empty list:</p>\n<div class=\"codehilite\"><pre><span></span>client.request(`/MedicationRequest?medication:text=Acetaminophen`, {\n      pageLimit: 1,\n      resolveReferences: [&quot;MedicationReference&quot;],\n      flat: true\n    })\n</pre></div>\n\n\n<p>But if I were instead to not qualify my search at all, and just get ALL MedicationRequests back, I do see some that look like this:</p>\n<div class=\"codehilite\"><pre><span></span>authoredOn: &quot;2017-07-03T05:38:05-04:00&quot;\ndosageInstruction: [{…}]\nencounter: {reference: &quot;Encounter/5530d672-fb57-4edd-85de-81af6c89930b&quot;}\nid: &quot;448595e7-fc3c-4a04-bef1-91483b8a4ea8&quot;\nintent: &quot;order&quot;\nmedicationCodeableConcept:\n  coding: Array(1)\n    0:\n      code: &quot;313782&quot;\n      display: &quot;Acetaminophen 325 MG Oral Tablet&quot;\n      system: &quot;http://www.nlm.nih.gov/research/umls/rxnorm&quot;\n      __proto__: Object\n    length: 1\n  __proto__: Array(0)\n  text: &quot;Acetaminophen 325 MG Oral Tablet&quot;\n__proto__: Object\nmeta: {versionId: &quot;3&quot;, lastUpdated: &quot;2019-06-06T02:59:27.248-04:00&quot;, tag: Array(1)}\nrequester: {reference: &quot;Practitioner/85aeca59-6261-4704-a2e4-1846ec5831a6&quot;}\nresourceType: &quot;MedicationRequest&quot;\nstatus: &quot;stopped&quot;\nsubject: {reference: &quot;Patient/2c4e4abf-b81d-4791-9046-7cdff816061f&quot;}\n</pre></div>\n\n\n<p><a href=\"/user_uploads/10155/-Y-8adFUt88bP1vUT6v0F9OA/Screen-Shot-2019-11-13-at-11.10.13-AM.png\" target=\"_blank\" title=\"Screen-Shot-2019-11-13-at-11.10.13-AM.png\">Screen-Shot-2019-11-13-at-11.10.13-AM.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/-Y-8adFUt88bP1vUT6v0F9OA/Screen-Shot-2019-11-13-at-11.10.13-AM.png\" target=\"_blank\" title=\"Screen-Shot-2019-11-13-at-11.10.13-AM.png\"><img src=\"/user_uploads/10155/-Y-8adFUt88bP1vUT6v0F9OA/Screen-Shot-2019-11-13-at-11.10.13-AM.png\"></a></div><p>Any idea what I'm doing wrong? Thanks again!</p>",
        "id": 180661031,
        "sender_full_name": "Mike",
        "timestamp": 1573672484
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> Thanks for help! So, I've tried both ways, both this:</p>\n<div class=\"codehilite\"><pre><span></span>client.request(`/MedicationRequest?code:text=acetaminophen`, {\n      pageLimit: 1,\n      resolveReferences: [&quot;MedicationReference&quot;],\n      flat: true\n    })\n</pre></div>\n\n\n<p>and this</p>\n<div class=\"codehilite\"><pre><span></span>    client.request(`/MedicationRequest?medication:text=acetaminophen`, {\n      pageLimit: 1,\n      resolveReferences: [&quot;MedicationReference&quot;],\n      flat: true\n    })\n</pre></div>\n\n\n<p>And both just return empty lists. Do you think this type of search is simply not supported? Seems like search for patients taking a specific medication would be a reasonable thing to do.</p>\n<p>Thank you!</p>",
        "id": 180663865,
        "sender_full_name": "Mike",
        "timestamp": 1573674266
    },
    {
        "content": "<p>My guess would be that the server does not support <code>:text</code> - can you find the MedicationRequest using the actual medication code instead than its display name? (medication:text is surely wrong - :text does not apply to reference search params)</p>",
        "id": 180665767,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1573675385
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span>  Ooh, yes I can.  Doing this:</p>\n<div class=\"codehilite\"><pre><span></span>client.request(`/MedicationRequest?code=313782`, {\n      pageLimit: 1,\n      resolveReferences: [&quot;MedicationReference&quot;],\n      flat: true\n    })\n</pre></div>\n\n\n<p>Returns a page of excellent results. It's just that the exact code is way too specific. I need ALL medication requests with a particular substring in the medication name. </p>\n<p>Do you think search is simply not supported?</p>\n<p>Many thanks!</p>",
        "id": 180670646,
        "sender_full_name": "Mike",
        "timestamp": 1573678089
    },
    {
        "content": "<p>Yes, <code>:text</code> (that would be the way to do it) appear not t be supported. I do not know of any production server that implements it.</p>",
        "id": 180671165,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1573678356
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> Ok, that's the info I needed.  I'll find another way to get my users their data. Thank you so much!</p>",
        "id": 180672248,
        "sender_full_name": "Mike",
        "timestamp": 1573678944
    },
    {
        "content": "<p>We implemented <code>:text</code> in the Google server but testing this example led me to discover a bug where the modifier doesn't trigger at the end of a chained search. So we can do code:text but not medication.code:text. <span aria-label=\"face palm\" class=\"emoji emoji-1f926\" role=\"img\" title=\"face palm\">:face_palm:</span></p>",
        "id": 180740695,
        "sender_full_name": "Paul Church",
        "timestamp": 1573745105
    },
    {
        "content": "<p>Does the server support medication._text (a text search over all text in the Medication resource?) Unlikely, but one never knows..</p>",
        "id": 180802093,
        "sender_full_name": "René Spronk",
        "timestamp": 1573793146
    }
]