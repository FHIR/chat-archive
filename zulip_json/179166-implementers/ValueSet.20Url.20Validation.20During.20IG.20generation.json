[
    {
        "content": "<p>Hi everyone,</p>\n<p>I have a value set with the following id and url:<br>\nid: irrs-advance-directive<br>\nurl: <a href=\"http://cihi.ca/fhir/ValueSet/irrs/irrs-advance-directive\" target=\"_blank\" title=\"http://cihi.ca/fhir/ValueSet/irrs/irrs-advance-directive\">http://cihi.ca/fhir/ValueSet/irrs/irrs-advance-directive</a></p>\n<p>When running the IG tool, I get an error and it seems that the tool doesn't like the fact that my URL has /irrs in it's path. Looking at the IG tool code I see that it assumes that url is composed of canonical url + resource id. Can someone shed some light as to why? And also why this is not an issue for code system? Is that because value sets are considered full fledged resources but code systems are not?</p>\n<div class=\"codehilite\"><pre>String u = igpkp.getCanonical()+r.getUrlTail();\n        if (r.getResource() != null &amp;&amp; r.getResource() instanceof MetadataResource) {\n          String uc = ((MetadataResource) r.getResource()).getUrl();\n          if (uc != null &amp;&amp; !u.equals(uc) &amp;&amp; !u.startsWith(&quot;http://hl7.org/fhir/template-adhoc-ig&quot;) &amp;&amp; !(r.getResource() instanceof CodeSystem) &amp;&amp; !(r.getResource() instanceof ImplementationGuide))\n            throw new Exception(&quot;URL Mismatch &quot;+u+&quot; vs &quot;+uc);\n        }\n</pre></div>",
        "id": 153877544,
        "sender_full_name": "Ross Shnaper",
        "timestamp": 1489699281
    },
    {
        "content": "<p>I'm dealing with a similar issue for code systems where the id!= url too.   I think this  makes it easier for the publisher to sort things out when generating the fragments.  But will wait for GGs response.</p>",
        "id": 153877555,
        "sender_full_name": "Eric Haas",
        "timestamp": 1489703763
    },
    {
        "content": "<p>likewise here for code systems owner/definer of the set is (external system url defined); we are holding and managing the FHIR representation under our cannonical base url... reasonably  common usage I think?  </p>",
        "id": 153877556,
        "sender_full_name": "Brett Esler",
        "timestamp": 1489704809
    },
    {
        "content": "<p>so if the IG publishes the content, it will insist that the canonical URL is also the regular end-point of the resource, so that the IG itself is an instance of the FHIR spec</p>",
        "id": 153877562,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489706665
    },
    {
        "content": "<p>but I had to allow the rule to be broken for code systems because they sometimes have fixed external urls </p>",
        "id": 153877563,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489706692
    },
    {
        "content": "<p>Grahame Grieve: but I had to allow the rule to be broken for code systems because they sometimes have fixed external urls</p>\n<p>Good to know but this is not working for me: </p>\n<p>id = blah<br>\nurl =  urn:oid:[OID]</p>\n<p>is causing qa.html errors and inability to share definitiions.</p>",
        "id": 153877575,
        "sender_full_name": "Eric Haas",
        "timestamp": 1489708000
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192999\">@Ross Shnaper</span> In general, there's not much point in having \"ValueSet\" in your URL if you're not going to have a valid FHIR URL - and that's not a valid FHIR URL.  No structure is allowed after the resource name that isn't explicitly defined by FHIR (at least not if you want FHIR systems to recognize it).</p>",
        "id": 153877593,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1489715478
    },
    {
        "content": "<p>Thanks everyone. Good to know I'm not the only one puzzled by this. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> so ValueSet url should conform to the same rule as one for other FHIR types like StructureDefinition for example (i.e. canonicalUrl/Type/id). Would you or <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  recommend we use the same rule for CodeSystem resources as well although the validation for this rule is intentionally broken in IG to be able to support fixed external urls? Does anything change now that CodeSystem is a resource in itself in STU3?</p>",
        "id": 153877606,
        "sender_full_name": "Ross Shnaper",
        "timestamp": 1489718353
    },
    {
        "content": "<p>If you're planning to define the code system in FHIR, then it probably makes sense for the canonical URL to be a valid RESTful URL.  For code systems like SNOMED, UCUM, LOINC, etc. that won't be defined as FHIR code systems, that's not important and having the URL point somewhere \"useful\" is more important.</p>",
        "id": 153877607,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1489718745
    },
    {
        "content": "<p>Understood. Thanks for the clarification <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> </p>",
        "id": 153877608,
        "sender_full_name": "Ross Shnaper",
        "timestamp": 1489719507
    },
    {
        "content": "<p>Maintaining a valid RESTful URL as a ValueSet's canonical URL could, over time, become complicated and unwieldly.  For example, if the ValueSet needs to be utilized by systems running different versions of the FHIR specification, some of them might eventually have difficulty interacting with the canonical resource.  The potential for breakage might also induce pressure that would tend to discourage any upgrades and/or increase the complexity of upgrades.  From an implementation standpoint, to me it seems simpler to maintain the canonical URL as a human-readable landing page.</p>",
        "id": 153877826,
        "sender_full_name": "Joel Schneider",
        "timestamp": 1489767154
    },
    {
        "content": "<p>simpler is not always better. </p>",
        "id": 153877858,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489779311
    },
    {
        "content": "<p>but there's a lot to think about there</p>",
        "id": 153877859,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489779321
    },
    {
        "content": "<p>My general leaning is that if you request HTML, you get the human readable navigation page.  If you request FHIR XML/JSON/whatever, you get the current version of the resource.</p>",
        "id": 153877892,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1489787423
    },
    {
        "content": "<p>My general feeling on CodeSystem and ValueSet URLs is that they should work as URIs first and URLs second.  If you;ve multiple versions then you can use the version string along with the URI to disambiguate, but if you assume the URI is *the* FHIR URL, then that breaks because you can only have one thing at the end.</p>",
        "id": 153877961,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1489823436
    },
    {
        "content": "<p>there is a way to retrieve by canonical url and version</p>",
        "id": 153877985,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1489835779
    },
    {
        "content": "<p>API versioning is a tricky topic.  Here's a blog article about a service that offers \"3 different wrong ways\" of doing it (URL versioning, custom request header, and content type), and lets the client pick which one to use:  <a href=\"https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/\" target=\"_blank\" title=\"https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/\">https://www.troyhunt.com/your-api-versioning-is-wrong-which-is/</a></p>",
        "id": 153878241,
        "sender_full_name": "Joel Schneider",
        "timestamp": 1489938673
    },
    {
        "content": "<p>I apologize for resurrecting an old topic, but... I'd just like to cast my vote that it would be really great if we could provide FHIR representations of value sets with external URIs (outside the IG's canonical url, and not necessarily ending with /ValueSet/${id}).  For example, we might want to create an IG providing a FHIR representation of an existing logical model that has value sets with pre-defined URIs.  Given that many implementors will likely support processing value set definitions in FHIR format, it would be nice if our IG could include the logical model's value sets in the FHIR format -- but right now, it cannot do that without re-assigning a whole new URI to the value set (so there is no longer *one* unique URI for the VS).</p>",
        "id": 153879218,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1490211801
    },
    {
        "content": "<p>is there a task about this?</p>",
        "id": 153879222,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1490212790
    },
    {
        "content": "<p>and I wonder how to make this possible, without also making something authors do by accident?</p>",
        "id": 153879223,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1490212815
    },
    {
        "content": "<p>Maybe these valueset URLs need to be called out in the definitions file separately as exceptions so that is :</p>\n<ul>\n<li>a) more of a hassle and </li>\n<li>b) you have to understand what you are doing.  </li>\n</ul>",
        "id": 153879283,
        "sender_full_name": "Eric Haas",
        "timestamp": 1490226689
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> and <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>.  I've posted an item in the tracker to propose this change:<br>\n<a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13131&amp;start=0\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13131&amp;start=0\">http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13131&amp;start=0</a></p>\n<p>To Eric's point, I think that requiring it to be an intentional action for the author (via configuration or something else) is fine -- especially if it helps to allieviate Grahame's concern about unintentionally mis-matching the URIs.</p>\n<p>Thanks for considering!</p>",
        "id": 153879597,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1490302475
    },
    {
        "content": "<p>The key is distinguising URI (universal, but needs resolving) from URL (just one of the locations you might find the thing).  Unfortunately FHIR doesn't help here in its naming of certain properties.  There is only one *URI* for a VS</p>",
        "id": 153879696,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1490338094
    },
    {
        "content": "<p>I don't recall anything in the URI spec that says that a given entity is only permitted to have a single URI.  And I think any such assertion would be fairly unworkable in many environments.</p>",
        "id": 153879752,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490369264
    },
    {
        "content": "<p>I don't think that having multiple URIs for a value set should be encouraged.  If there is a single URI, then implementors don't need to worry about maintaining a mapping of equivalent URIs.  But I understand that arguments could be made on either side.  Despite that, I still think that FHIR shouldn't _require_ me to fragment my identifying URIs if I don't want to...  My preference is that each of my value sets has a _single_ URI -- because I want an unambiguous and singular way to reference it.  So, ideally, the FHIR IG publisher would allow me to maintain that one singular identifying URI -- even if that URI isn't prefixed by a canonical FHIR IG URL.</p>",
        "id": 153879755,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1490371208
    },
    {
        "content": "<p>I'm not saying we should encourage it.  And for FHIR purposes, we only allow a single canonical URL.  But that doesn't mean there can't be more than one.  If you're going to have a FHIR resource instance, I think it's reasonable to require that the URL be a valid FHIR URL.  It's already possible to have bindings to arbitrary URLs when there's no expectation that the artifact at that URL will be expressible in FHIR form.</p>",
        "id": 153879771,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490508032
    },
    {
        "content": "<p>I implemneted this - see <a href=\"http://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Special_URLs\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Special_URLs\">http://wiki.hl7.org/index.php?title=IG_Publisher_Documentation#Special_URLs</a></p>",
        "id": 153879781,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1490557324
    },
    {
        "content": "<p>Thank you, Grahame.  I will be careful with it.  I understand that with great power comes great responsibility!</p>",
        "id": 153879896,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1490619701
    }
]