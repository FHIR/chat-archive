[
    {
        "content": "<p>Re. <a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650</a><br>\nWe are about to implement them in our server .... so some ideas / questions<br>\nFor $add maybe instead of specify entire Group or List resources as parameters have only the items to add - as parameters with parts <br>\nFor $remove instead of specifying offset and count use a list of referenced item to be removed</p>",
        "id": 175946387,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568752624
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"218703\">@Nick Robison</span></p>",
        "id": 175946422,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568752637
    },
    {
        "content": "<p>(and not have optional offset for $add)</p>",
        "id": 175946474,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568752676
    },
    {
        "content": "<p>eg this would be a $add payload adding two members to a group:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;Parameters xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n  &lt;parameter&gt;\n    &lt;name value=&quot;member&quot;/&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;entity&quot;/&gt;\n      &lt;valueReference&gt;\n        &lt;reference value=&quot;Patient/123&quot;/&gt;\n      &lt;/valueReference&gt;\n    &lt;/part&gt;\n  &lt;/parameter&gt;\n  &lt;parameter&gt;\n    &lt;name value=&quot;member&quot;/&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;entity&quot;/&gt;\n      &lt;valueReference&gt;\n        &lt;reference value=&quot;Patient/234&quot;/&gt;\n      &lt;/valueReference&gt;\n    &lt;/part&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;period&quot;/&gt;\n      &lt;valuePeriod&gt;\n        &lt;start value=&quot;2015-04-02&quot;/&gt;\n      &lt;/valuePeriod&gt;\n    &lt;/part&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;inactive&quot;/&gt;\n      &lt;valueBoolean value=&quot;true&quot;/&gt;\n    &lt;/part&gt;\n  &lt;/parameter&gt;\n&lt;/Parameters&gt;\n</pre></div>",
        "id": 175947152,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568753064
    },
    {
        "content": "<p>And this would be the $remove payload to remove those same members:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;Parameters xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n  &lt;parameter&gt;\n    &lt;name value=&quot;member&quot;/&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;entity&quot;/&gt;\n      &lt;valueReference&gt;\n        &lt;reference value=&quot;Patient/123&quot;/&gt;\n      &lt;/valueReference&gt;\n    &lt;/part&gt;\n  &lt;/parameter&gt;\n  &lt;parameter&gt;\n    &lt;name value=&quot;member&quot;/&gt;\n    &lt;part&gt;\n      &lt;name value=&quot;entity&quot;/&gt;\n      &lt;valueReference&gt;\n        &lt;reference value=&quot;Patient/234&quot;/&gt;\n      &lt;/valueReference&gt;\n    &lt;/part&gt;\n  &lt;/parameter&gt;\n&lt;/Parameters&gt;\n</pre></div>",
        "id": 175947247,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568753141
    },
    {
        "content": "<p>If the same resource appears multiple time in the Group (or List) $remove removes all those members (items)</p>",
        "id": 175947456,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568753265
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> just saw in GForge comment that you are going to have a go to getPage - do you already have specific ideas?</p>",
        "id": 175950108,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568755030
    },
    {
        "content": "<p>Removing by value instead of offset avoids the problem of the list changing since the client last looked at it. Could solve with etags instead but then the client might have to retry many times.</p>\n<p>Does $add insert another copy if one or more of the same member is already in the group?</p>",
        "id": 175955736,
        "sender_full_name": "Paul Church",
        "timestamp": 1568760029
    },
    {
        "content": "<p>My thinking was no - if the same member is already there it is left alone - just update period and inactive if the $add operation specified them<br>\nDoes not seem to make much sense to have duplicates in a group - in our system they are flat out not allowed, and possibly in CMS as well.</p>",
        "id": 175955981,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568760307
    },
    {
        "content": "<p>From our discussion to day we are going to start with drafting the read operation. We were wondering for writes whether folks have tried this with existing patch operations?</p>",
        "id": 175958151,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1568762619
    },
    {
        "content": "<p>I'd prefer to use values or elementIds</p>",
        "id": 175960074,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1568765039
    },
    {
        "content": "<p>Is there any consideration of a normal read or search giving back a SUBSETTED resource with only the first page of contents? The alternative may be a failure to return anything if the resource is unreasonably large. With only PUT operations it's difficult to create an unreturnable resource, but with $add it's easy.</p>\n<p>I haven't implemented FHIRPath Patch but it looks like it already has add/remove type operators similar to what is being proposed. Has that had much adoption among clients or servers?</p>",
        "id": 175961446,
        "sender_full_name": "Paul Church",
        "timestamp": 1568766826
    },
    {
        "content": "<p>We talked about this in FHIR-I Q4 today. Summary:</p>\n<ul>\n<li>Some servers might not be able to return whole (large) resources like <code>Group</code> or <code>List</code> on <code>read</code> or <code>search</code> </li>\n<li>In this case they should <em>not</em> just return first-page results.</li>\n<li>Better to return an OperationOutcome indicating that the client needs to call <code>$getPage</code> (to avoid clients getting surprised/confused).</li>\n</ul>",
        "id": 175962085,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1568767725
    },
    {
        "content": "<p>In <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\">GF#21650</a> we outlined this as:</p>\n<blockquote>\n<p>We should define expectations on what servers should do when servers don't support READ but do support the paging operations.</p>\n</blockquote>",
        "id": 175962172,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1568767808
    },
    {
        "content": "<p>My only immediate feedback on the idea of $getPage is that it should be as consistent as possible with other pagination. In the linked tracker it mentions \"?offset=X&amp;count=Y\", and I think that should be \"?offset=X&amp;_count=Y\".</p>",
        "id": 175963766,
        "sender_full_name": "Paul Church",
        "timestamp": 1568770124
    },
    {
        "content": "<p>I'd be even happier if there was also a consistent _page or _page_token or _offset or something where only the token is opaque instead of the entire request url being opaque, but that's a broader topic.</p>",
        "id": 175963921,
        "sender_full_name": "Paul Church",
        "timestamp": 1568770337
    },
    {
        "content": "<p>We were clear in the room (and I hope in our GForge resolution!) that we'll define this with opaque pagination tokens rather than count/offset.</p>",
        "id": 175964219,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1568770824
    },
    {
        "content": "<blockquote>\n<ul>\n<li>We would like to use the same mechanism we have used for paged Bundles (so, opaque next/prev tokens or links)</li>\n</ul>\n</blockquote>",
        "id": 175964220,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1568770838
    },
    {
        "content": "<p>The CodeSystem resource could also fit into this bucket of large resource manipulation too.</p>",
        "id": 175965520,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1568772982
    },
    {
        "content": "<p>(and also has its own paging style outside the fhir search)</p>",
        "id": 175965591,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1568773120
    },
    {
        "content": "<p>We also said in the resolution that we want to look at PATCH instead of the $add, $remove.  <span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span>  have you considered doing that?</p>",
        "id": 175965980,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1568773719
    },
    {
        "content": "<p>Related problems introduced by having resources too large to return: what about vread and history?</p>\n<p>What about the return body from a successful patch operation - I guess the server can choose representation=minimal if it can't do more?</p>",
        "id": 175968179,
        "sender_full_name": "Paul Church",
        "timestamp": 1568777934
    },
    {
        "content": "<p>For vread, can just define $getPage on /_history/id/$getPage.</p>\n<p>I don't have any immediate ideas for how history could look.</p>",
        "id": 175968245,
        "sender_full_name": "Paul Church",
        "timestamp": 1568778041
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> for resources too big to return we fail them with a 413 and an OperationOutcome suggesting to use _summary</p>",
        "id": 175999833,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568809950
    },
    {
        "content": "<p>(and we do not have history....)</p>",
        "id": 175999844,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568809958
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> ...and ValueSet</p>",
        "id": 175999854,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568809972
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> no, we do not currently have any support for path and it seems a lot of work to go from that format to adding / removing elements</p>",
        "id": 175999886,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568810018
    },
    {
        "content": "<p>(does the .NET library offers anything for PATCH? I don't actually know)</p>",
        "id": 175999905,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568810040
    },
    {
        "content": "<p>Not at the moment <span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span></p>",
        "id": 176000627,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1568810604
    },
    {
        "content": "<p>I meant: paging could be useful for ValueSet as well</p>",
        "id": 176000879,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568810782
    },
    {
        "content": "<p>We have paging already through the expand operation.  Are you looking for paging for really long enumerated value sets?</p>",
        "id": 176000927,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1568810832
    },
    {
        "content": "<p>Yes - ValueSets in our system are just flat lists of codes</p>",
        "id": 176001080,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1568810927
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> Do you save those in ValueSet.compose?</p>",
        "id": 176210496,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1568998711
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> This leaves ValueSet.$expand having different behavior. I remember there was a strong push back from Vocab the last time we discussed to use paging token. <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span></p>",
        "id": 176211042,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1568999061
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span> yes, ValueSet.compose.include</p>",
        "id": 176216380,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569002444
    },
    {
        "content": "<p>OK, so what I have now is .<code>.../Group/5e8188d4-63d6-e911-b7f2-2816a856e19d/$getPage?element=member&amp;count=2</code>, that returns extensions within <code>meta</code>:</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Group&quot;,\n    &quot;id&quot;: &quot;5e8188d4-63d6-e911-b7f2-2816a856e19d&quot;,\n    &quot;meta&quot;: {\n        &quot;extension&quot;: [\n            {\n                &quot;url&quot;: &quot;http://careevolution.com/fhirextensions#first&quot;,\n                &quot;valueUrl&quot;: &quot;http://localhost:8080/fhir/Group/5e8188d4-63d6-e911-b7f2-2816a856e19d/$getPage?element=member&amp;query=dd7437e3-23f8-4a26-9716-a43b39040fa6&amp;start=1&amp;count=2&quot;\n            },\n            {\n                &quot;url&quot;: &quot;http://careevolution.com/fhirextensions#next&quot;,\n                &quot;valueUrl&quot;: &quot;http://localhost:8080/fhir/Group/5e8188d4-63d6-e911-b7f2-2816a856e19d/$getPage?element=member&amp;query=dd7437e3-23f8-4a26-9716-a43b39040fa6&amp;start=3&amp;count=2&quot;\n            }\n        ],\n        &quot;tag&quot;: [\n            {\n                &quot;system&quot;: &quot;http://hl7.org/fhir/v3/ObservationValue&quot;,\n                &quot;code&quot;: &quot;SUBSETTED&quot;\n            }\n        ]\n    },\n</pre></div>",
        "id": 176517723,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569366221
    },
    {
        "content": "<p>specifying first / next / previous URLs - similar to a normal search</p>",
        "id": 176517783,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569366259
    },
    {
        "content": "<p>You have to specify the element you want to page in the operation. Not sure how best to return that info - an extension within the paged element itself?</p>",
        "id": 176517821,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569366314
    },
    {
        "content": "<p>Is it useful to specify that in the operation? I assumed there would be only one paged element per resource type and it would be fixed.</p>",
        "id": 176521357,
        "sender_full_name": "Paul Church",
        "timestamp": 1569370304
    },
    {
        "content": "<p>Yes, but the notes in <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21650\">GF#21650</a> say 'where each method would specify which element gets pages'</p>",
        "id": 176522593,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569371862
    },
    {
        "content": "<p>I read that as saying that the definition of Group/$getPage would specify which element gets pages, and the definition of ValueSet/$getPage would specify an element on ValueSet, and so on - rather than \"which element\" being a parameter to the operation.</p>",
        "id": 176522805,
        "sender_full_name": "Paul Church",
        "timestamp": 1569372141
    },
    {
        "content": "<p>Indeed, <span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span> you read our intent correctly (from the working group discussion).</p>",
        "id": 176567553,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1569420252
    },
    {
        "content": "<p>OK, I'll remove that parameter it (easier)</p>",
        "id": 176567780,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569420370
    },
    {
        "content": "<p>Ideas about 'We would need to find a way to make it clear that a server is not returning the full resource, maybe beyond the subsetted marker (metadata about the element paged on?)' - what about a SUBSETTED or similar extension inside the element itself?</p>",
        "id": 176567869,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569420429
    },
    {
        "content": "<p>For adding I have POST .../Group/5e8188d4-63d6-e911-b7f2-2816a856e19d/$add</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n        &quot;name&quot;: &quot;member&quot;,\n        &quot;part&quot;:[\n            {\n              &quot;name&quot;: &quot;entity&quot;,\n              &quot;valueReference&quot;: { &quot;reference&quot;: &quot;Patient/aefc2155-69c6-4264-8d7e-db32c815fc9f&quot; }\n            }\n        ]\n    },\n    {\n        &quot;name&quot;: &quot;member&quot;,\n        &quot;part&quot;:[\n            {\n              &quot;name&quot;: &quot;entity&quot;,\n              &quot;valueReference&quot;: { &quot;reference&quot;: &quot;Patient/d42ffdd2-df47-4b13-9f7e-c56c438a2f67&quot; }\n            }\n        ]\n    }\n  ]\n}\n</pre></div>\n\n\n<p>adds those two patients</p>",
        "id": 176610458,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569449925
    },
    {
        "content": "<p>and POST ../Group/5e8188d4-63d6-e911-b7f2-2816a856e19d/$remove</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;entity&quot;,\n      &quot;valueReference&quot;: { &quot;reference&quot;: &quot;Patient/aefc2155-69c6-4264-8d7e-db32c815fc9f&quot; }\n    },\n    {\n      &quot;name&quot;: &quot;entity&quot;,\n      &quot;valueReference&quot;: { &quot;reference&quot;: &quot;Patient/d42ffdd2-df47-4b13-9f7e-c56c438a2f67&quot; }\n    }\n  ]\n}\n</pre></div>\n\n\n<p>removes them</p>",
        "id": 176610510,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1569449987
    },
    {
        "content": "<p>Cool! Scanning the discussion above, was there anyone who tried to use PATCH for this?</p>",
        "id": 176611404,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1569450812
    },
    {
        "content": "<p>An implementation of Groups with $add, $remove and $getPage is now available on our sandbox <a href=\"https://fhir.careevolution.com/Master.Adapter1.WebClient/fhir\" target=\"_blank\" title=\"https://fhir.careevolution.com/Master.Adapter1.WebClient/fhir\">https://fhir.careevolution.com/Master.Adapter1.WebClient/fhir</a></p>",
        "id": 178218315,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1571162606
    },
    {
        "content": "<p>I'll give that a try later <span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span>, looks good. Are there op definitions for them too?<br>\nI might add them to my server too.</p>",
        "id": 178363767,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1571303909
    },
    {
        "content": "<p>Yes, there are - contained in the conformance</p>",
        "id": 178376995,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1571316292
    },
    {
        "content": "<p>Perfect. Thanks.</p>",
        "id": 178450533,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1571383901
    },
    {
        "content": "<p>Hi, is this operation a candidate for being promoted up into the HL7 guides? Wasn't sure if there was a roadmap for this or not.</p>",
        "id": 261515466,
        "sender_full_name": "Brian Forbis",
        "timestamp": 1636991185
    }
]