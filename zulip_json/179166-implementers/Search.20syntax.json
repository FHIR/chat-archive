[
    {
        "content": "<p>Hi All,<br>\nI am trying to get syntax for Search API which does following:</p>\n<ul>\n<li>Select a patient and include additional resources ProcedureRequest and Encounter.</li>\n<li>Procedure request with specific code</li>\n<li>encounters linked to above selected procedure request</li>\n</ul>\n<p>is it possible to do it in one single request?<br>\nI was thinking of following;</p>\n<p>https://&lt;fhirserver/Patient?<br>\nrev_include=ProcedureRequest:code=123 &amp;<br>\nrev_include=Encounter[ How to select encounter linked to above procedure request ?]</p>\n<p>thanks.</p>",
        "id": 216456299,
        "sender_full_name": "Anand Jahagirdar",
        "timestamp": 1605180611
    },
    {
        "content": "<p>Probably best to go in from the ProcedureRequest, I don't have an example set up, so I'm doing this blind:<br>\n[base]/ProcedureRequest?code=123&amp;subject.identifier=923842&amp;include=ProcedureRequest:subject&amp;include=ProcedureRequest:context</p>\n<p>I don't know if the Patient could really be you're in, if you want the parameter for code to be included.</p>",
        "id": 216460663,
        "sender_full_name": "Marc Sandberg",
        "timestamp": 1605183989
    },
    {
        "content": "<p>Depending on what server you're connecting to, you may find it's better to stick with a couple of simpler calls rather than trying to do everything in a single query. Keep in mind that not all fhir servers support the full breadth of the search syntax. \"generic\" (aka \"native\").</p>",
        "id": 216476135,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605191914
    },
    {
        "content": "<p>That said, more technically: FHIR reverse inclusion <em>can't be combined</em> with chaining to only include a limited set of incoming references.</p>",
        "id": 216476350,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605192012
    },
    {
        "content": "<p>But in your particular example you can actually do something simpler: you can formulate three independent queries that fetch the data you need -- and on servers that support batch operations, you can submit a single batch query including all three requests, so you will get back a batch response including all three results. (You can do this because you already know the patient id up front, so you can write one query for that patient, one query for a limited set of encounters pointing that patient, and a third query for a limited set of procedure requests pointing to that patient.)</p>",
        "id": 216476571,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605192129
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/179166-implementers/topic/Search.20syntax/near/216476571\">said</a>:</p>\n<blockquote>\n<p>and on servers that support batch operations, you can submit a single batch query including all three requests, so you will get back a batch response including all three results.</p>\n</blockquote>\n<p>Funny you should say this, I was talking to someone about this just a few weeks ago, and he was adamant this was not the way to use the batch.</p>",
        "id": 216480421,
        "sender_full_name": "Marc Sandberg",
        "timestamp": 1605193763
    },
    {
        "content": "<p>re: batch, I believe the documentation on the <a href=\"http://hl7.org/fhir/http.html#transaction\">http</a> page is pretty good about the rules - as long as you don't need to use the results of any of the queries to process the others, this would work well.  If you needed to search for the patient id first, you could not use a batch because the later steps would depend on the results of the first query.</p>",
        "id": 216492267,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1605198563
    },
    {
        "content": "<p>For folks interested in the details: I used this question as a jumping off point for this week's \"Guided Walk Through FHIR\" episode (see <a href=\"https://youtu.be/W8F4cGmseo0\">https://youtu.be/W8F4cGmseo0</a>).</p>\n<div class=\"youtube-video message_inline_image\"><a data-id=\"W8F4cGmseo0\" href=\"https://youtu.be/W8F4cGmseo0\"><img src=\"https://i.ytimg.com/vi/W8F4cGmseo0/default.jpg\"></a></div><p>FYI <span class=\"user-mention\" data-user-id=\"221050\">@Anand Jahagirdar</span></p>",
        "id": 216680625,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605305347
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 216727963,
        "sender_full_name": "Anand Jahagirdar",
        "timestamp": 1605358629
    },
    {
        "content": "<p>Hmm - _revinclude=Procedure:patient:code=456 would have worked as well, one can specify a condition on a _revinclude</p>",
        "id": 216858447,
        "sender_full_name": "René Spronk",
        "timestamp": 1605525567
    },
    {
        "content": "<p>I've missed this -- your example of has two clauses separated by equals signs and no ampersands in between? Can you point me to the specs so I can review?</p>",
        "id": 216878640,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1605537296
    },
    {
        "content": "<p>My error - I was confusing _revinclude with _has, which does allow additional conditional expressions expressed as modifiers. _revinclude doesn't.</p>",
        "id": 216883509,
        "sender_full_name": "René Spronk",
        "timestamp": 1605539396
    },
    {
        "content": "<p>For this kind of exercise (the one you're tackling in your video) we force the attendees of our training courses to think about what they should use a 'focal' resource, which has a large impact on the remainder of the search URL. There are many ways to arrive at the same result, even more so if one accepts that a result bundle may include resource types other than the ones one is interested in.</p>",
        "id": 216883828,
        "sender_full_name": "René Spronk",
        "timestamp": 1605539523
    }
]