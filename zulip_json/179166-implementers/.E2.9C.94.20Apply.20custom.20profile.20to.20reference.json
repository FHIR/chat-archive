[
    {
        "content": "<p>Hello everyone! :)</p>\n<p>We are aiming to create a custom fhir profile for our application. The profile is for an observation containing a device element with a condensed structure (e.g MyDevice).</p>\n<p>Problem is that our initial attempt at defining a structure does not seem to be valid (we checked using the validator from <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/\">https://github.com/hapifhir/org.hl7.fhir.core/</a>). According to the profile element definition it cannot contain a reference.</p>\n<p>We want to define the following as a custom observation profile that can have a device element containing only \"identifier\" and \"manufacturer\".</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Observation&quot;,\n    // ...\n    &quot;contained&quot;: [\n        {\n            &quot;resourceType&quot;: &quot;Device&quot;,\n            &quot;id&quot;: &quot;1&quot;,\n            &quot;identifier&quot;: [\n                {\n                    &quot;value&quot;: &quot;myId&quot;\n                }\n            ],\n            &quot;manufacturer&quot;: &quot;myManufacturer&quot;\n        }\n    ],\n    &quot;device&quot;: {\n        &quot;reference&quot;: &quot;#1&quot;\n    }\n}\n</code></pre></div>\n<p>We could only achieve a valid structure definition if the device is not a reference to a \"contained\" element (see example 1). </p>\n<p>Example 1:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n// ...\n&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;\n&lt;differential&gt;\n&lt;element id=&quot;Observation.device&quot;&gt;\n      &lt;path value=&quot;Observation.device&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot; /&gt;\n        &lt;profile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;  // !!\n        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Device&quot; /&gt;\n      &lt;/type&gt;\n    &lt;/element&gt;\n&lt;/differential&gt;\n&lt;/StructureDefinition&gt;\n</code></pre></div>\n<p>For example 2, the validator would expect the sub elements \"identifier\"/\"manufacturer\" etc. to be inside the device element itself. It cannot resolve a reference to an element inside the contained array.</p>\n<p>Is there a way to fix/define this somehow?</p>\n<p>Example 2:</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n// ...\n&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;\n&lt;differential&gt;\n&lt;element id=&quot;Observation.device&quot;&gt;\n      &lt;path value=&quot;Observation.device&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot; /&gt;\n        &lt;profile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;  // !!\n        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Device&quot; /&gt;\n        &lt;aggregation value=&quot;contained&quot; /&gt;  // !!\n      &lt;/type&gt;\n    &lt;/element&gt;\n&lt;/differential&gt;\n&lt;/StructureDefinition&gt;\n</code></pre></div>",
        "id": 273105032,
        "sender_full_name": "Cado",
        "timestamp": 1645716972
    },
    {
        "content": "<p>Update:<br>\nWe managed to make it work after all. Sorry for spamming <span aria-label=\"sweat smile\" class=\"emoji emoji-1f605\" role=\"img\" title=\"sweat smile\">:sweat_smile:</span></p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;\n&lt;StructureDefinition xmlns=&quot;http://hl7.org/fhir&quot;&gt;\n// ...\n&lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Observation&quot; /&gt;\n&lt;differential&gt;\n&lt;element id=&quot;Observation.device&quot;&gt;\n      &lt;path value=&quot;Observation.device&quot; /&gt;\n      &lt;min value=&quot;1&quot; /&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot; /&gt;\n        &lt;targetProfile value=&quot;https://example.org/fhir/StructureDefinition/MyDevice&quot; /&gt;\n        &lt;aggregation value=&quot;contained&quot; /&gt;\n      &lt;/type&gt;\n    &lt;/element&gt;\n&lt;/differential&gt;\n&lt;/StructureDefinition&gt;\n</code></pre></div>",
        "id": 273110040,
        "sender_full_name": "Cado",
        "timestamp": 1645718973
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"388396\">Cado</span> has marked this topic as resolved.</p>",
        "id": 273110057,
        "sender_full_name": "Notification Bot",
        "timestamp": 1645718978
    }
]