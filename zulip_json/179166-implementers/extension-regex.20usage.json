[
    {
        "content": "<p>Looking at the StructureDefinitions in <code>profiles-types.json</code> from <a href=\"https://www.hl7.org/fhir/definitions.json.zip\" target=\"_blank\" title=\"https://www.hl7.org/fhir/definitions.json.zip\">the master set of FHIR definitions</a> I noticed that the <a href=\"https://www.hl7.org/fhir/extension-regex.json.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/extension-regex.json.html\">extension-regex</a> for <code>Extension.url</code> is on the <code>ElementDefinition.type.code</code>, whereas the other StructureDefinitions with a regex have it on the <code>ElementDefinition.type</code>.</p>\n<p>For reference the Extension.url regex extension looks like this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n              <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Extension.url&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Extension.url&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;representation&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;xmlAttr&quot;</span>\n              <span class=\"p\">],</span>\n              <span class=\"nt\">&quot;comment&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;The definition may point directly to a computable or human-readable definition of the extensibility codes, or it may be a logical URI as declared in some other specification. The definition SHALL be a URI for the Structure Definition defining the extension.&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;min&quot;</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;base&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Extension.url&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;min&quot;</span><span class=\"p\">:</span> <span class=\"mi\">1</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;1&quot;</span>\n              <span class=\"p\">},</span>\n              <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                  <span class=\"nt\">&quot;_code&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-json-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;string&quot;</span>\n                      <span class=\"p\">},</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-xml-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;xsd:string&quot;</span>\n                      <span class=\"p\">},</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-rdf-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;xsd:string&quot;</span>\n                      <span class=\"p\">},</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/regex&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;((http|https)://([A-Za-z0-9\\\\\\\\\\\\.\\\\:\\\\%\\\\$]*\\\\/)*)?(Account|ActivityDefinition|AdverseEvent|AllergyIntolerance|Appointment|AppointmentResponse|AuditEvent|Basic|Binary|BiologicallyDerivedProduct|BodyStructure|Bundle|CapabilityStatement|CarePlan|CareTeam|CatalogEntry|ChargeItem|ChargeItemDefinition|Claim|ClaimResponse|ClinicalImpression|CodeSystem|Communication|CommunicationRequest|CompartmentDefinition|Composition|ConceptMap|Condition|Consent|Contract|Coverage|CoverageEligibilityRequest|CoverageEligibilityResponse|DetectedIssue|Device|DeviceDefinition|DeviceMetric|DeviceRequest|DeviceUseStatement|DiagnosticReport|DocumentManifest|DocumentReference|EffectEvidenceSynthesis|Encounter|Endpoint|EnrollmentRequest|EnrollmentResponse|EpisodeOfCare|EventDefinition|Evidence|EvidenceVariable|ExampleScenario|ExplanationOfBenefit|FamilyMemberHistory|Flag|Goal|GraphDefinition|Group|GuidanceResponse|HealthcareService|ImagingStudy|Immunization|ImmunizationEvaluation|ImmunizationRecommendation|ImplementationGuide|InsurancePlan|Invoice|Library|Linkage|List|Location|Measure|MeasureReport|Media|Medication|MedicationAdministration|MedicationDispense|MedicationKnowledge|MedicationRequest|MedicationStatement|MedicinalProduct|MedicinalProductAuthorization|MedicinalProductContraindication|MedicinalProductIndication|MedicinalProductIngredient|MedicinalProductInteraction|MedicinalProductManufactured|MedicinalProductPackaged|MedicinalProductPharmaceutical|MedicinalProductUndesirableEffect|MessageDefinition|MessageHeader|MolecularSequence|NamingSystem|NutritionOrder|Observation|ObservationDefinition|OperationDefinition|OperationOutcome|Organization|OrganizationAffiliation|Patient|PaymentNotice|PaymentReconciliation|Person|PlanDefinition|Practitioner|PractitionerRole|Procedure|Provenance|Questionnaire|QuestionnaireResponse|RelatedPerson|RequestGroup|ResearchDefinition|ResearchElementDefinition|ResearchStudy|ResearchSubject|RiskAssessment|RiskEvidenceSynthesis|Schedule|SearchParameter|ServiceRequest|Slot|Specimen|SpecimenDefinition|StructureDefinition|StructureMap|Subscription|Substance|SubstanceNucleicAcid|SubstancePolymer|SubstanceProtein|SubstanceReferenceInformation|SubstanceSourceMaterial|SubstanceSpecification|SupplyDelivery|SupplyRequest|Task|TerminologyCapabilities|TestReport|TestScript|ValueSet|VerificationResult|VisionPrescription)\\\\/[A-Za-z0-9\\\\-\\\\.]{1,64}(\\\\/_history\\\\/[A-Za-z0-9\\\\-\\\\.]{1,64})?&quot;</span>\n                      <span class=\"p\">}</span>\n                    <span class=\"p\">]</span>\n                  <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">],</span>\n              <span class=\"nt\">&quot;isModifier&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;isSummary&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span>\n            <span class=\"p\">}</span>\n</pre></div>\n\n\n<p>whereas the other FHIR datatypes, like uri, have it on the type element:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n              <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;uri.value&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;uri.value&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;representation&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"s2\">&quot;xmlAttr&quot;</span>\n              <span class=\"p\">],</span>\n              <span class=\"nt\">&quot;min&quot;</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;base&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;uri.value&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;min&quot;</span><span class=\"p\">:</span> <span class=\"mi\">0</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;1&quot;</span>\n              <span class=\"p\">},</span>\n              <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                  <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                    <span class=\"p\">{</span>\n                      <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/regex&quot;</span><span class=\"p\">,</span>\n                      <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;\\\\S*&quot;</span>\n                    <span class=\"p\">}</span>\n                  <span class=\"p\">],</span>\n                  <span class=\"nt\">&quot;_code&quot;</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                    <span class=\"nt\">&quot;extension&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-json-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;string&quot;</span>\n                      <span class=\"p\">},</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-xml-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;xsd:anyURI&quot;</span>\n                      <span class=\"p\">},</span>\n                      <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;url&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-rdf-type&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;valueString&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;xsd:string&quot;</span>\n                      <span class=\"p\">}</span>\n                    <span class=\"p\">]</span>\n                  <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">],</span>\n              <span class=\"nt\">&quot;isModifier&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span><span class=\"p\">,</span>\n              <span class=\"nt\">&quot;isSummary&quot;</span><span class=\"p\">:</span> <span class=\"kc\">false</span>\n            <span class=\"p\">}</span>\n</pre></div>\n\n\n<p>based on the context from the regex-extension StructureDefinition I was expecting it to be on the ElementDefinition.  I can see that it might be undesirable to have it on the ElementDefinition because of elements that have a choice of type.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"s2\">&quot;context&quot;</span><span class=\"err\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;element&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;expression&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;Questionnaire.item&quot;</span>\n          <span class=\"p\">},</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;element&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;expression&quot;</span><span class=\"p\">:</span> <span class=\"s2\">&quot;ElementDefinition&quot;</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n</pre></div>\n\n\n<p>Is there a reason for putting the regex-extension in one place or the other and should they be treated differently depending on if its on the type or the type.code?</p>",
        "id": 169682454,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1562297058
    },
    {
        "content": "<p>should be consistent. But I'm not sure where it should be</p>",
        "id": 169695909,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1562318793
    },
    {
        "content": "<p>It should be on ElementDefinition.  We're qualifying the whole definition and that's where we put other constraints like maxLength.</p>",
        "id": 169711439,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562335800
    },
    {
        "content": "<p>Thanks!  Should I submit a tracker ticket for this?  I'd be happy to help implement a fix if desired.</p>",
        "id": 169872632,
        "sender_full_name": "Reece Adamson",
        "timestamp": 1562595209
    },
    {
        "content": "<p>Please.  And a pull request is always welcome</p>",
        "id": 169883066,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562602858
    }
]