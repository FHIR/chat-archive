[
    {
        "content": "<p>Quick background: <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span>  started a <a href=\"#narrow/stream/179166-implementers/topic/modeling.20specific.20details.20in.20FHIR.20Messaging\">thread</a> in Februrary that led to an approved Jira <a href=\"https://jira.hl7.org/browse/FHIR-26368#narrow/stream/179280-fhir.2Finfrastructure-wg/topic/Message.20forbids.20entry.2Erequest.20and.20entry.2Eresponse\">FHIR-26368</a> relaxing a limit on the use of Parameters so that it could  be used as the focus of a message. <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> submitted a <a href=\"https://jira.hl7.org/browse/FHIR-26390\">Jira (FHIR-26390)</a> to further clarify the resulting allowed use. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I see that you're working on the requested clarification in FHIR-I</p>\n<p>Question: I'm working on an IG where we have a similar need to what Josh described... to clarify the different purposes of two Patient resources in a message bundle... and would like to pursue using Parameters as the message focus to do that.  Is it safe to do that now?<br>\nThanks!</p>",
        "id": 203268036,
        "sender_full_name": "Frank McKinney",
        "timestamp": 1594215589
    },
    {
        "content": "<p>We are in the process of gathering use cases for where the use of Parameters beyond operations would make sense, so sharing the details of what you are trying to achieve will be helpful. In general, however, the MessageHeader resource can potentially be persisted at a RESTful endpoint, in which case the Reference in MessageHeader.focus will be non-resolvable, as the Parameters resource cannot be persisted.</p>",
        "id": 203268935,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1594216078
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> Our use case is focused on the US, and would enable a pharmacy to request additonal patient information related to a prescription they've received. The pharmacy won't typically be affiliated with the prescriber or clinic, and the pharmacy system typically goes through an intermediary/network to interact with prescribers/clinics (e.g., to receive electronic prescriptions or request refills using the NCPDP SCRIPT standard). We're looking at FHIR messaging because the stakeholders depend on intermediaries for locating the correct clinic and pharmacy systems and routing data. </p>\n<p>The basic scenario is...</p>\n<ul>\n<li>Initiating event: The pharmacy receives a prescription in a non-FHIR format (US regs require use of the NCPCP standard) and determines that it needs additional patient information to fulfill it (clinical and/or insurance info)</li>\n<li>Request: The pharmacy system bundles up a request message that includes the Patient from the pharmacy system (the pharmacy typically won't have a reference to the clinic's Patient resource), a MedicationRequest reflecting the prescription they received (to help the responder locate the patient and context) and search strings identifying the information needed</li>\n<li>Response: The responding clinic system performs a patient match and if successful, performs the searches using the matched patient and returns a message containing the search results, along with the matched Patient from the responder system and also the submitted pharmacy Patient for reference</li>\n</ul>\n<p>We're thinking that a Parameters resource in the request message could hold the search strings and references to bundled Patient and MedicationRequest resources as parameters. In the response, separate parameters would clarify which Patient is the responder's match and which is the requester's patient.</p>\n<p>I'm very interested in your thoughts. Thx</p>",
        "id": 203866405,
        "sender_full_name": "Frank McKinney",
        "timestamp": 1594749810
    },
    {
        "content": "<p>In R4 implementations, it's possible that zealous validators could treat Parameters in a Bundle as being invalid, but I suspect in general you'd be safe.  In terms of future guidance, I'm pretty confident we're going to land on saying that Parameters is fine in a message, but in the end that decision isn't \"final\" until we pass ballot - and that could be a year or more away.</p>\n<p>In general, I discourage the use of FHIR messaging.  However, your use-case is a space where I think it's reasonable and appropriate.</p>",
        "id": 203869243,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594751226
    },
    {
        "content": "<p>Is the response expected to be synchronous? If it is, I think that what you are describing sounds very much like an operation. The presence of an intermediary could be an issue to front an operation, but it doesn't necessarily mean you have to resort to FHIR Messaging.</p>\n<p>As for the use of the Parameters resource as the MessageHeader.focus, as Lloyd says it is not currently in the \"letter of the law\". To me the big question mark is whether and how the MessageHeader resource is going to be persisted, and how are references from MessageHeader.focus going to be handled. I don't think this is a well-implemented area, and my understanding is limited.</p>\n<p>Finally, have you considered a RESTful approach to handle your use case? The intermediaries will need to be very much involved in it, but it could be a better match to existing EHR capabilities.</p>",
        "id": 203875131,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1594754306
    },
    {
        "content": "<p>Operation doesn't allow for routing</p>",
        "id": 203881552,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594757578
    },
    {
        "content": "<p>One or more of the parameters can have sufficient information to route it.</p>",
        "id": 203881969,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1594757777
    },
    {
        "content": "<p>We'll need to support asynchronous responses as well. </p>\n<p>Related to this seeming like an operation... I noticed that the <a href=\"https://www.hl7.org/fhir/messaging.html\">FHIR Messaging</a> page has a section toward the bottom about how to invoke operations via messages. As I understand it, you do this by referencing an OperationDefinition in the MessageHeader's event element and including a Parameters resource as the focus (with the parameters matching what's defined in the OperationDefinition). <br>\nIt looks like the example on that page uses a pre-v3 FHIR version... I wonder if this is something that folks are doing nowadays.</p>",
        "id": 203882087,
        "sender_full_name": "Frank McKinney",
        "timestamp": 1594757851
    },
    {
        "content": "<blockquote>\n<p>As for the use of the Parameters resource as the MessageHeader.focus, as Lloyd says it is not currently in the \"letter of the law\"</p>\n</blockquote>\n<p>I don't agree with this. I think it's implicit in the definition. This is a question of clarity</p>",
        "id": 203884311,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1594758853
    },
    {
        "content": "<p>This has always been in scope for messaging IMHO, as this is the way to send a query in a message, or as a means to invoke an operation.</p>",
        "id": 203925446,
        "sender_full_name": "Ren√© Spronk",
        "timestamp": 1594799574
    },
    {
        "content": "<p>\"The Way\" to send queries via messages? Can't queries be expressed as the input/output of the Task resource which is referenced in the MessageHeader.focus? </p>\n<p>As for invoking operations over FHIR messages, given that the above mentioned STU2 content has survived this long well into R5,  is an indication that no one has tried to do this. If I am wrong on that, I would like to hear about it...</p>",
        "id": 204110048,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1594917734
    },
    {
        "content": "<p>FM uses operations for workflow pretty much exclusively</p>",
        "id": 204115198,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594920242
    },
    {
        "content": "<p>E.g. Claim/$submit</p>",
        "id": 204115301,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594920285
    },
    {
        "content": "<p>(in general because the systems involved don't expose RESTful endpoints and the back-end systems are used to consuming monolithic packages of data.</p>",
        "id": 204115373,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594920340
    },
    {
        "content": "<p>Operations are in wide use, I agree. Using a FHIR Message Bundle to invoke operations was what I was asking about...</p>",
        "id": 204116134,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1594920687
    },
    {
        "content": "<p>Mainly relevant where routing is needed.  I've seen a few places where that could occur, but aware of any where it is.</p>",
        "id": 204134010,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1594929004
    }
]