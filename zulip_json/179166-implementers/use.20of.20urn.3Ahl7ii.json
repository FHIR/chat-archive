[
    {
        "content": "<p>There is a defined way of encoding an HL7 II with root or root+extension. The value is <br>\n    urn:hl7ii:{ROOT}[:{EXTENSION}]<br>\nPresumably in FHIR the .system value would still be the URI identifier of \"urn:ietf:rfc:3986\", but I guess it is possible there could be a specific system to indicate a HL7 II identifier as different from simply URI...<br>\nthe most dominant place where root+extension is used is within CDA, but it is found elsewhere.<br>\nI am interested, on behalf of IHE and specifically the MHD profile, of assuring full round-trip of these kinds of identifiers. <br>\nSo I am interested in community opinion on the use of urn:hl7ii, vs not using this.<br>\nIf urn:hl7ii is not used, then a II value with just root, will be encoded as rfc3986; where as root+extension must be encoded with root in system, and extension in value.</p>\n<p>THIS text from IHE Appendix Z (that I am now updating to FHIR R4)</p>\n<p>Z.9.1.1 Identifier and HL7 version 3 \"root plus extension\"<br>\nIn HL7 version 3, uniqueId can be expressed as a root, or as a root plus extension. <br>\nWhen converting an HL7 version 3 uniqueId to FHIR, if no extension is provided, the root shall be placed into the Identifier.value, and the Identifier.system shall be set to “urn:ietf:rfc:3986”. For example, the HL7 version 3 value<br>\n&lt;identifier root=\"1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" /&gt;<br>\nwould be expressed in FHIR as<br>\n {<br>\n \"system\": \"urn:ietf:rfc:3986\",<br>\n \"value\": \"urn:oid:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\"<br>\n }<br>\nWhen an extension is provided, the extension shall be placed into the Identifier.value, and the Identifier.system shall be set to the root. For example, the HL7 version 3 value<br>\n&lt;identifier root=\"1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" extension=\"84566\" /&gt;<br>\nwould be expressed in FHIR as<br>\n {<br>\n \"system\": \"urn:oid:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\"<br>\n “value”:”84566”<br>\n }</p>\n<p>with use of urn:hl7ii, this simplifies to one pattern...</p>",
        "id": 154024107,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544461219
    },
    {
        "content": "<p>Reference: See Grahame's blog from June 2014  <a href=\"http://www.healthintersections.com.au/?p=2148\" target=\"_blank\" title=\"http://www.healthintersections.com.au/?p=2148\">http://www.healthintersections.com.au/?p=2148</a></p>",
        "id": 154024109,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544461259
    },
    {
        "content": "<p>(sigh) tables aren't as easy to use in zulip as I'd like...</p>\n<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> , just to clarify your examples:</p>\n<ul>\n<li>\n<p>HL7 V3 encoding:</p>\n<ul>\n<li>No extension: <code>&lt;identifier root=\"1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" /&gt;</code></li>\n<li>With extension: <code> &lt;identifier root=\"1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" extension=\"84566\" /&gt;</code></li>\n</ul>\n</li>\n<li>\n<p>Current FHIR practice:</p>\n<ul>\n<li>\n<p>No extension: <code>{ \"system\": \"urn:ietf:rfc:3986\", \"value\": \n \"urn:oid:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" }</code></p>\n</li>\n<li>\n<p>With extension: <code>{ \"system\":  \"urn:oid:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\", \"value\": \"84566\" }</code></p>\n</li>\n</ul>\n</li>\n<li>\n<p><strong>Proposed</strong>  hl7ii encoding:</p>\n<ul>\n<li>No extension: <code>{ \"system\": \"urn:ietf:rfc:3986\", \"value\": \"urn:hl7ii:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504\" }</code></li>\n<li>With extension: <code>{ \"system\": \"urn:ietf:rfc:3986\",\n\"value\": \"urn:hl7ii:1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629.41504:84566\" }</code></li>\n</ul>\n</li>\n</ul>\n<p>An advantage to this would be the clear ability to round-trip the identifier from V3 to FHIR and back, correct?</p>",
        "id": 154024207,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1544470792
    },
    {
        "content": "<p>yes. When encoding an II datatype, this would be the recommended way to encode it in FHIR...   Drawback is that everyone must know about hl7ii origin, and encoding.</p>",
        "id": 154024221,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544473057
    },
    {
        "content": "<p>Hmm, also raises issues about identifiers that pass through an II but don't originate there.</p>",
        "id": 154024223,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1544474268
    },
    {
        "content": "<p>yes, that is a problem... even where it is unknown that it did come from an II.  root+extension is a big problem for interoperability. Really wish HL7 had not invented that. root alone can easily be simply treated as a unique identifier. Given HL7 invented root+extension, then HL7 should determine the solution when FHIR is involved.</p>",
        "id": 154024228,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544475478
    },
    {
        "content": "<p>System in FHIR is equivalent to root, value in FHIR is equivalent to extension. If you will the 'odd ' use is when an oid is used without an extension - in your first example: 1.2.826.0.1.3680043.2.1611.1.2.32884.10619.27943.27629 is the namespace (system) for the instance (value) 41504.</p>",
        "id": 154024750,
        "sender_full_name": "Paul Knapp",
        "timestamp": 1544609485
    },
    {
        "content": "<p>yes, that works when one has root and extension... but it does not work when one has only root... Thus the problem, one must encode the two patterns totally differently... where as urn:hl7ii gives us one way to encode both.</p>",
        "id": 154024796,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544626009
    },
    {
        "content": "<p>Why is it a problem to encode them differently if it's deterministic?</p>",
        "id": 154024814,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544629111
    },
    {
        "content": "<p>More importantly, when converting an II to Identifier, you're often going to have to translate the OID to a URL - at least you will for any place where a standard URL has been defined.  There's no safe way to algorithmicly do the conversion</p>",
        "id": 154024815,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544629193
    },
    {
        "content": "<p>It is the rountrip problem... that is looking at the FHIR Identifier and understanding that the value there is an II that is just root, or an II that is root + extension, or someother kind of identifier</p>",
        "id": 154024828,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544629934
    },
    {
        "content": "<p>If you look at an Identifier instance and see a value that's an OID with the standard URL for a bare OID, then you've got an II with just a root.  If you've got anything else, you've got a root + extension</p>",
        "id": 154024832,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544630166
    },
    {
        "content": "<p>not really.. OIDs are used far wider than HL7...</p>",
        "id": 154024833,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544630211
    },
    {
        "content": "<p>If you're converting to an II, that's still the algorithm you'd need to use</p>",
        "id": 154024836,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544630283
    },
    {
        "content": "<p>I am converting it to a interface that understands bare OIDs, and also can take II... They are different in the real world</p>",
        "id": 154024840,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544630440
    },
    {
        "content": "<p>Then add an extension that says \"this came from an II\"</p>",
        "id": 154024842,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544630505
    },
    {
        "content": "<p>You won't be able to use your urn:hl7ii with all data that comes from an II, so I don't see the point of introducing it.</p>",
        "id": 154024844,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1544630570
    },
    {
        "content": "<p>I am simply asking the question to HL7 as a body... a body that has invented the root+extension concept... for the best way to handle that in FHIR.. when I think I have uncovered issues.. and for which I see the urn:hl7ii as a solution someone has invented... so I am simply asking for HL7 as a body to rule on the use of urn:hl7ii in the context of FHIR Identifier... I don't care if it is YES or NO or MAYBE...</p>",
        "id": 154024845,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544630571
    },
    {
        "content": "<p>I have a model, in IHE, for dealing with this without use of urn:hl7ii... I am just faced with comments asking for us to consider urn:hl7ii... so look at me considering it, and asking for community discussion.  I can have IHE forbid it, but I can't have IHE ignore it and thus end up with an interoperabilty problem where some use it and others don't. I am looking to avoid and interop problem.</p>",
        "id": 154024847,
        "sender_full_name": "John Moehrke",
        "timestamp": 1544630714
    },
    {
        "content": "<p>Well I invented hl7ii and you could use it as you suggest, but as Lloyd has said above you could simple check if the value is an OID or if the system is an OID and deal with those two situations.</p>",
        "id": 154024895,
        "sender_full_name": "Paul Knapp",
        "timestamp": 1544634489
    },
    {
        "content": "<p>I'm not seeing the need. The CDA/FHIR project mappings say:</p>",
        "id": 154024931,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644471
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>  source.root as r where source.extension.exists() -&gt; target.system = translate(r, &quot;http://hl7.org/fhir/ConceptMap/special-oid2uri&quot;, &quot;uri&quot;);\n  source.root as r where source.extension.empty() -&gt; target.system = &quot;urn:ietf:rfc:3986&quot;, target.value = append(&quot;urn:oid:&quot;, r);\n  source.extension as e -&gt; target.value = e;\n</pre></div>",
        "id": 154024932,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644532
    },
    {
        "content": "<p>that's for II -&gt; Identifier</p>",
        "id": 154024933,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644537
    },
    {
        "content": "<p>and for other way:</p>",
        "id": 154024934,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644544
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>    value.value as v where system.value = &#39;urn:ietf:rfc:3986&#39; -&gt; target.root = v;\n    system.value as v where system.value != &#39;urn:ietf:rfc:3986&#39; -&gt; target.root = v then {\n      value.value as v -&gt; target.extension = v;\n</pre></div>",
        "id": 154024938,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644915
    },
    {
        "content": "<p>that seems pretty simple to me, and is what Lloyd said</p>",
        "id": 154024939,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1544644938
    }
]