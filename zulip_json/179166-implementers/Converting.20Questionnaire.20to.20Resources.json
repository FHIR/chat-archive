[
    {
        "content": "<p>I'm looking at a use case where a \"referrer\" can ask for a refferal to a care setting. The Care Setting returns a request for the information they require to complete the referral. I was thinking that the request for information would be a Questionnaire. However, rather than a QuestionnaireResponse, I would prefer a Message Bundle as the response to the Quesionnaire (containing Patient details, Condition details, History detailas &amp; whatever). I see from SDC (Structured Data Capture) spec this all seems possible. Could someone point me to a live public test FHIR server that has implmented the URL: [base]/QuestionnaireResponse/[id]/$extract operation, so I can test this out?</p>",
        "id": 250594775,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1629881921
    },
    {
        "content": "<ol>\n<li>\n<p>Placer POSTs the ServiceRequest A (intent = proposal). (Or message 'referral' if that is the payload requirement)<br>\nexchange type = message</p>\n</li>\n<li>\n<p>Filler POSTs a 'task/complete-form' message with the SDC content ....  which is either a Task which specifies Questionnaire is to be completed (may contain Questionnaire)<br>\nexchange type = message or restful POST /Task</p>\n</li>\n<li>\n<p>Original Placer - POSTs the response is also a message which is 'patient-form' event which contains all your data (focus QuestionnaireResponse)<br>\nexchange type = message</p>\n</li>\n<li>\n<p>Filler POSTs back ServiceReques to indicate accepted, rejected, etc</p>\n</li>\n</ol>",
        "id": 250595904,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1629882722
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> has done somethign similar and has a good demonstration of that</p>",
        "id": 250599423,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629885208
    },
    {
        "content": "<p>Wondering if this is SDC, more accurately SDC is long term aim. At the moment its just asking for a form to be completed and responding with the completed form.</p>",
        "id": 250599753,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1629885459
    },
    {
        "content": "<p>I read that instead of a QuestionnaireResponse we want a MessageBundle - that is SDC.</p>",
        "id": 250600134,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629885674
    },
    {
        "content": "<p>Oliver's implementation has a working $extract operation</p>",
        "id": 250600287,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629885772
    },
    {
        "content": "<p><a href=\"https://ahdis.github.io/matchbox-formfiller/#/questionnaire/referral-min\">https://ahdis.github.io/matchbox-formfiller/#/questionnaire/referral-min</a></p>",
        "id": 250600520,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629885955
    },
    {
        "content": "<p>you could ask on <a class=\"stream\" data-stream-id=\"179255\" href=\"/#narrow/stream/179255-questionnaire\">#questionnaire</a></p>",
        "id": 250602385,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1629887387
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> - probably just me being a bit dumb. I can fill in the questionnaire, get the QuestionnaireResponse below to update - how do I call the $extract operation &amp; see the created resources?</p>",
        "id": 250604372,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1629888945
    },
    {
        "content": "<p>Sorry, this is the link: <a href=\"https://ahdis.github.io/matchbox-formfiller/#/questionnaire/sdc-extract\">https://ahdis.github.io/matchbox-formfiller/#/questionnaire/sdc-extract</a></p>",
        "id": 250604605,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1629889107
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191832\">@Jose Costa Teixeira</span> - a nice demo of what's possible with $extract</p>",
        "id": 250622017,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1629899193
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192158\">@Dave Barnet</span> the $extract operation is invoked after filling out the questionnaire, if it is specified in the questionnaire according to the SDC profile for <a href=\"http://build.fhir.org/ig/HL7/sdc/extraction.html#structuremap-based-extraction\">StructureMap-based</a> extraction. You can also invoke the $extract directly, however the server needs the questionnaire/structuremap available. we plan to set up a test server for the upcoming fhir connectathon that you can upload your questionnaires and fhir maps and will participate in the FHIR questionnaire track, if you are interested in using it do not hesitate to contact me.</p>",
        "id": 250637539,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1629906021
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>  - I'd be very interested in having a look at any test server you plan to set up in relation to SDC. I've had a \"dabble\" creating a couple of resources trying to create a Patient from a Questionnaire: <br>\nQuestionnaire <a href=\"http://server.fire.ly/Questionnaire/e5c5e2d9-deab-462f-9581-450f4847fd55\">http://server.fire.ly/Questionnaire/e5c5e2d9-deab-462f-9581-450f4847fd55</a> <br>\nQuestionnaireResponse <a href=\"http://server.fire.ly/QuestionnaireResponse/20f5a694-181a-452a-bcf8-a01f1e0f32ac\">http://server.fire.ly/QuestionnaireResponse/20f5a694-181a-452a-bcf8-a01f1e0f32ac</a> <br>\nStructureMap <a href=\"http://server.fire.ly/StructureMap/49c4e073-4ee0-4417-b6aa-962d0c81ca8d\">http://server.fire.ly/StructureMap/49c4e073-4ee0-4417-b6aa-962d0c81ca8d</a> <br>\nI'm sure the StructureMap isn't right, but I can't find anywhere to test it out?</p>",
        "id": 251856700,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1630664406
    },
    {
        "content": "<p>The FHIR validator allows you to execute StructureMaps</p>",
        "id": 251918060,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630691290
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192158\">@Dave Barnet</span> sorry for delayed response. Were you successful using the FHIR validator? If you want to try to run StructureMap you can post it also on our test server, see info here: <a href=\"https://github.com/ahdis/matchbox/blob/main/fml.http\">https://github.com/ahdis/matchbox/blob/main/fml.http</a></p>",
        "id": 253484743,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1631738689
    },
    {
        "content": "<p>Thanks for your help <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>. To be honest, I think I've struggled with the help and guidance on the wiki pages (<a href=\"https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content\">https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content</a>), which leads you to download the validator and set up the transform  along the lines of<br>\nValidator [fileToTransform] -transform -output [outputFile] -log [logFile] -map [uriOfMap] -ig [folderOfIG]<br>\n... which for me produced either  \"Exception: Can only nominate a single -map parameter\", or when I juggled the parameters and eventually got the validator to spark into life \"\"Exception: Can only have one source when doing a transform (found [c:\\BaRS\\TstQR.xml, <a href=\"http://fhir.nhs.uk/StructureMap/patientxform]\">http://fhir.nhs.uk/StructureMap/patientxform]</a>)\" - which are the file names of the QR I want to transform.<br>\nThe format that I eventually discovered that works (for me at least) is<br>\nValidator [fileToTransformFrom] -transform [StructureDefURI] -ig [IGFolder] -output [ResultsFile] -log [LogFile] -version <br>\nWhich was fine for creating a patient with a gender element - I can even add a birthDate, but anything more complicated involving complex data types seems to be even harder (for example a QR has a text field for a name, how do you load this into Patient.name.text ? - Just my frustration - thanks for your help !</p>",
        "id": 254060339,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1632148708
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"217312\">@Joee Garcia</span> Any words of advice?</p>",
        "id": 254069128,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1632152074
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192158\">@Dave Barnet</span> we started the same way as you did,  we moved then to a server side approach that the iteration gets faster. You can fill the patient.name.text with the following rule: </p>\n<div class=\"codehilite\"><pre><span></span><code>src.item as item where linkId.value in (&#39;patient.name.text&#39;) -&gt; tgt.name as name, name.text = (item.answer.valueString);\n</code></pre></div>",
        "id": 254097599,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1632163209
    },
    {
        "content": "<p>you can try the map here yourself: <a href=\"https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage\">https://ahdis.github.io/matchbox-formfiller/#/mappinglanguage</a><br>\nwhen you load the qr response and map into the editor <a href=\"/user_uploads/10155/HIqB1SB1puOBS_boG9HMibjB/qrpatienttext.json\">qrpatienttext.json</a> <a href=\"/user_uploads/10155/YTg9doae87kuRGbj99H6flZR/qrpatienttext.map\">qrpatienttext.map</a></p>",
        "id": 254097923,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1632163340
    },
    {
        "content": "<p>Thanks for that link <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> - that was very useful &amp; I've managed to create most  of a Patient resource from a QR (just using valueString in the QR). I'm not sure how to create a CodeableConcept in the target. For example, I (following your example) I tried to create Patient.maritalStatus. I tried<br>\n  src.item as thing where linkId.value in ('patient.maritalStatus') -&gt; tgt.maritalStatus as maritalStatus, maritalStatus=(thing.answer.valueString);<br>\n  src.item as thing where linkId.value in ('patient.maritalStatus') -&gt; tgt.maritalStatus as maritalStatus, maritalStatus.code=(thing.answer.valueString);<br>\n  src.item as thing where linkId.value in ('patient.maritalStatus') -&gt; tgt.maritalStatus as maritalStatus, maritalStatus.coding.code=(thing.answer.valueString);<br>\n  src.item as thing where linkId.value in ('patient.maritalStatus') -&gt; tgt.maritalStatus = cc(\"SomeSystem\", \"123\");<br>\n...but none of these worked. I also had issues creating anything described as element[x] (for example deceasedBoolean). For example none of these worked<br>\nsrc.item as thing where linkId.value in ('patient.deadOrNot') -&gt; tgt.deceasedBoolean as deceasedBoolean, deceasedBoolean= (\"true\");<br>\nsrc.item as thing where linkId.value in ('patient.deadOrNot') -&gt; tgt.deceasedBoolean = (\"true\");<br>\nsrc.item as thing where linkId.value in ('patient.deadOrNot') -&gt; tgt.deceasedBoolean as deceasedBoolean, deceasedBoolean.value= (\"true\");</p>\n<p>But overall I feel I'm making progress - Thanks again</p>",
        "id": 254335980,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1632301155
    },
    {
        "content": "<p>does the FHIR validator execute StructureMaps or FML files?</p>",
        "id": 257121504,
        "sender_full_name": "Rik Smithies",
        "timestamp": 1633989519
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"217312\">@Joee Garcia</span></p>",
        "id": 257121745,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633989648
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191651\">@Rik Smithies</span>  I don't think the FHIR Validator supports FML files.  I've only been able to execute StructureMaps with it.  Check-out <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language#UsingtheFHIRMappingLanguage-ExecutewithaTransform\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language#UsingtheFHIRMappingLanguage-ExecutewithaTransform</a></p>",
        "id": 257129342,
        "sender_full_name": "Joee Garcia",
        "timestamp": 1633995624
    }
]