[
    {
        "content": "<p>I appreciate canonical referenced did not appear until FHIR R4 but from a backwards-compatibility perspective, I'm trying to work out what the expected behaviour would be from an STU3 FHIR server when it encounters one.</p>\n<p>Currently on the Firely Vonk server if you post an STU3 reference with a canonical URL construct the response does not look correct to me.</p>\n<p>So for example posting the following</p>\n<p><a href=\"/user_uploads/10155/w0dU_HfoRlEwBGb1A1Pi4W4Q/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/w0dU_HfoRlEwBGb1A1Pi4W4Q/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/w0dU_HfoRlEwBGb1A1Pi4W4Q/image.png\"></a></div><p>Yields the following</p>\n<p><a href=\"/user_uploads/10155/LAjQXsjE6q2-luBOVmPuHNMZ/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/LAjQXsjE6q2-luBOVmPuHNMZ/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/LAjQXsjE6q2-luBOVmPuHNMZ/image.png\"></a></div><p>The canonical references have been interpreted as relative URLs rather than absolute URLs- is that the correct behaviour?</p>",
        "id": 256413626,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1633527977
    },
    {
        "content": "<p>When looking in to this it seems to be caused by the use of pipe versioning in the reference. When you remove the |33 the reference is stored correctly. I am not sure why the pipe versioning is include in the reference, but Firely Server does seem to handle this incorrectly. The pipe version should not influence the behavior and should be ignored.</p>",
        "id": 256740348,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1633700173
    },
    {
        "content": "<p>I don't think you can use the piping mechanism with a contained reference.  A contained reference is absolute and can't be further qualified.</p>",
        "id": 256765485,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1633710298
    }
]