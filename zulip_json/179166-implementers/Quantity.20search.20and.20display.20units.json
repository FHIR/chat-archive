[
    {
        "content": "<p>Last fall we ran into a case where our fhir server wasn't behaving as expected by a user...after digging in we found what we feel is ambiguous language in the spec and opened <a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597</a> (Clarify expected behavior for system-less quantity search).</p>",
        "id": 164554719,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1556643067
    },
    {
        "content": "<p>Lloyd asked me to poll the implementer community to see how others are handling this...does anyone index the displayable unit and make that available via search?  Does anyone not?</p>",
        "id": 164554795,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1556643123
    },
    {
        "content": "<p>For example, suppose you have an Observation with a quantity like</p>\n<div class=\"codehilite\"><pre><span></span>  &quot;valueQuantity&quot;: {\n    &quot;value&quot;: 7,\n    &quot;unit&quot;: &quot;yrs&quot;,\n    &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n    &quot;code&quot;: &quot;a&quot;\n  }\n</pre></div>\n\n\n<p>And you receive a search like <code>Observation?value-quantity=7||yrs</code>.</p>",
        "id": 164556273,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1556644235
    },
    {
        "content": "<p>/poll Does your server return the resource?</p>",
        "id": 164556320,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1556644275
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <span class=\"user-mention\" data-user-id=\"192710\">@Kenneth Myhra</span> <span class=\"user-mention\" data-user-id=\"191318\">@nicola (RIO/SS)</span> <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span></p>",
        "id": 164569881,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1556653643
    },
    {
        "content": "<p>Spark will match for this search: <a href=\"http://spark.kufu.no/fhir/Observation?value-quantity=36||pg\" target=\"_blank\" title=\"http://spark.kufu.no/fhir/Observation?value-quantity=36||pg\">http://spark.kufu.no/fhir/Observation?value-quantity=36||pg</a> but internally it will make an assumption that the system is UCUM. Doing the same search with an unit it does not recognize as an UCUM unit, as the one above, it will ignore the search parameter. So the answer is both yes and no. I would need to do some refactoring and probably change the library that Spark uses for unit conversion.</p>",
        "id": 164577334,
        "sender_full_name": "Kenneth Myhra",
        "timestamp": 1556658781
    },
    {
        "content": "<p>Thanks all.  Hopefully its enough to inform the FHIR working group on the best way to clarify this behavior (if at all).</p>",
        "id": 164588421,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1556669575
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193551\">@Marco Visser</span> <span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span> ?</p>",
        "id": 164611554,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1556703075
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span>:  I guess <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> 's vote is for Vonk.</p>",
        "id": 164617842,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1556711508
    },
    {
        "content": "<p>Ah yes, never mind.</p>",
        "id": 164618204,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1556711942
    },
    {
        "content": "<p>Yes, the search request does work in Vonk :)</p>",
        "id": 164618364,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1556712113
    },
    {
        "content": "<p>FYI - WildFHIR also supports this search.</p>",
        "id": 164646787,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1556736349
    },
    {
        "content": "<p>Does anyone know where we landed on this one?  <br>\n<a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=19597</a> is marked as resolved, but I forget how to tell if the full change has been applied or not (is there a GForge field for that or resolved implies that?).<br>\nWas the text in the resolution (which I do see in the spec) the text that was added to address the question?</p>",
        "id": 180732550,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573739796
    },
    {
        "content": "<p>If so, I don't think it actually clarifies the expected behavior in the case you search on just a unit (with no system).  It only covers the case when the client searches with both system and unit.  Safe to assume there will be no further clarification due to the existing implementation differences?</p>",
        "id": 180732652,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573739865
    },
    {
        "content": "<p>Status changes to 'Applied' when made in the CI build, then 'Published' when an official release goes out.</p>",
        "id": 180732764,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573739935
    },
    {
        "content": "<p>So nothing done yet</p>",
        "id": 180732775,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573739945
    },
    {
        "content": "<p>thanks lloyd</p>",
        "id": 180732924,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573740029
    },
    {
        "content": "<p>I also noticed some poor grammar in the existing text here:  \"In this case, it is inappropriate to search on the human display for the unit, which can be is uncontrolled and may unpredictable. \"</p>",
        "id": 180733016,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573740092
    },
    {
        "content": "<p>I'll just add that as a comment to this existing issue rather than open separate one</p>",
        "id": 180733103,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573740135
    },
    {
        "content": "<p>and, more importantly, did the team actually resolve on what is the 'correct' behavior?  or they just agree it needs clarification?</p>",
        "id": 180733156,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1573740181
    },
    {
        "content": "<p>My interpretation would be \"if you specify both code + system, them match against Quantity.code + Quantity.system only.  If you specify only code then match against Quantity.code or Quantity.unit\".  However, agree that's not super-clear in the disposition.</p>",
        "id": 180734154,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1573740903
    }
]