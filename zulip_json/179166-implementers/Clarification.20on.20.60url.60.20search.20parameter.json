[
    {
        "content": "<p><a href=\"https://build.fhir.org/search.html#uri\">https://build.fhir.org/search.html#uri</a> contains a section on <code>uri</code> parameters that says:</p>\n<blockquote>\n<p>Note that for uri parameters that refer to the Canonical URLs of the conformance and knowledge resources (e.g. StructureDefinition, ValueSet, PlanDefinition etc), servers SHOULD support searching by canonical references, and SHOULD support automatically detecting a |[version] portion as part of the search parameter, and interpreting that portion as a search on the version.</p>\n</blockquote>\n<p>I think that is saying that servers should automatically handle <code>ValueSet?url=http://acme.org/fhir/ValueSet/123%7C1.0.0</code> the same as <code>ValueSet?url=http://acme.org/fhir/ValueSet/123&amp;version=1.0.0</code>.</p>\n<ol>\n<li>Am I interpreting the spec right?</li>\n<li>Why recommend this special behavior for this one search parameter or type <code>uri</code> and is there anything in their SearchParameter definitions to indicate their special-ness?</li>\n</ol>",
        "id": 249766937,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629228612
    },
    {
        "content": "<p>The other interpretation I could imagine for this text is that its actually referring to uri search parameter which target canonical references (like the <code>_profile</code> search parameter).  This interpretation makes a lot more sense to me, but the preceding text in this latest draft seems to favor the other interpretation:</p>\n<blockquote>\n<p>The search type <code>uri</code> is used with elements of type uri and url. The type <code>reference</code> is used for the types Reference and canonical.</p>\n</blockquote>",
        "id": 249768024,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629228989
    },
    {
        "content": "<p>We say something similar at <a href=\"https://build.fhir.org/search.html#versions\">https://build.fhir.org/search.html#versions</a> --</p>\n<blockquote>\n<p>For canonical references, servers SHOULD support searching by Canonical URLs, and SHOULD support automatically detecting a |[version] portion as part of the search parameter and interpreting that portion as a search on the business version of the target resource. </p>\n</blockquote>\n<p>But I agree <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span>:  for <code>uri</code>, how do you know when to apply this logic?<del> It seems like you can't know to apply this logic based on the search param definition itself; rather, the logic depends on the <em>value</em> supplied. But how do you tell if a uri parameter \"refers to the Canonical URLs of the conformance and knowledge resources\"? This is an open set. Maybe you just... see if refer to the canonical URL of a conformance/knowledge resource <em>that your servers supports in some way</em>?</del></p>",
        "id": 249774962,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232322
    },
    {
        "content": "<p>I'm looking for examples to understand where this might apply... but yours (<code>?url=</code>) is the best I can find. Maybe it's the only one?</p>",
        "id": 249775086,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232384
    },
    {
        "content": "<p>OK, I guess:</p>\n<blockquote>\n<p>for uri parameters that refer to the Canonical URLs of the conformance and knowledge resources</p>\n</blockquote>\n<p>Just essentially means: \"search parameters of type 'uri' that index some instance of <a href=\"http://build.fhir.org/definition-definitions.html#Definition.url\">http://build.fhir.org/definition-definitions.html#Definition.url</a> or <a href=\"http://build.fhir.org/canonicalresource-definitions.html#CanonicalResource.url\">http://build.fhir.org/canonicalresource-definitions.html#CanonicalResource.url</a>\"</p>",
        "id": 249775448,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232573
    },
    {
        "content": "<p>Agreed it'd be really nice to mark these SearchParameters with some indication of their special-ness.</p>",
        "id": 249775501,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232607
    },
    {
        "content": "<p>i'm not even sure i understand why that would be needed.  can't clients just use the <code>url=&amp;version=</code> variant?</p>",
        "id": 249775561,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629232648
    },
    {
        "content": "<p>like i said the interpretation that makes more sense to me would be if it applied to uri search parameters which target elements of type canonical, because there we actually do need this kind of behavior to be smart about the version</p>",
        "id": 249775668,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629232701
    },
    {
        "content": "<p>are you pretty sure its about params like <code>ValueSet?url=</code> and not <code>[Resource]?_profile=</code> ?</p>",
        "id": 249775738,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629232755
    },
    {
        "content": "<blockquote>\n<p>Lee Surprenant: i'm not even sure i understand why that would be needed. can't clients just use the url=&amp;version= variant?</p>\n</blockquote>\n<p>I totally agree with this point, and the examples at <a href=\"https://www.hl7.org/fhir/references.html#canonical\">https://www.hl7.org/fhir/references.html#canonical</a> corroborate</p>",
        "id": 249775754,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232768
    },
    {
        "content": "<blockquote>\n<p>Lee Surprenant: are you pretty sure its about params like ValueSet?url= and not [Resource]?_profile= ?</p>\n</blockquote>\n<p>No. I'm just reading like you; I don't understand the intent here.</p>",
        "id": 249775941,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629232880
    },
    {
        "content": "<p>ok, great.  i'm glad its not just me :-)</p>",
        "id": 249775970,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629232895
    },
    {
        "content": "<p>Do you know why <code>_profile</code> SearchParam is of type <code>uri</code> instead of <code>reference</code>? </p>\n<p><a href=\"/user_uploads/10155/D2Iy6yROsL3g51QMMuVDeXjz/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/D2Iy6yROsL3g51QMMuVDeXjz/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/D2Iy6yROsL3g51QMMuVDeXjz/image.png\"></a></div><p>at <a href=\"http://build.fhir.org/search.html#table\">http://build.fhir.org/search.html#table</a> documents that this is expected, but I can't tell/recall why.</p>",
        "id": 249776152,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233002
    },
    {
        "content": "<p><a href=\"https://jira.hl7.org/browse/FHIR-30514\">https://jira.hl7.org/browse/FHIR-30514</a></p>",
        "id": 249776416,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233131
    },
    {
        "content": "<p>I just left a comment to similar effect on this \"applied\" jira issue</p>",
        "id": 249776494,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233164
    },
    {
        "content": "<blockquote>\n<p>The other interpretation I could imagine for this text is that its actually referring to uri search parameter which target canonical references (like the _profile search parameter). This interpretation makes a lot more sense to me...</p>\n</blockquote>\n<p>Reviewing up to this point: I agree. I think </p>\n<blockquote>\n<p>The search type uri is used with elements of type uri and url.</p>\n</blockquote>\n<p>should say</p>\n<blockquote>\n<p>The search type uri is used with elements of type uri, [url,??] and canonical.</p>\n</blockquote>\n<p>to match the table and current usage.~~</p>",
        "id": 249776533,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233177
    },
    {
        "content": "<p>My current opinion:</p>\n<ul>\n<li>_profile should be of type <code>reference</code></li>\n<li>the language about handling certain uri parameters specially should be stricken</li>\n</ul>",
        "id": 249776621,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233258
    },
    {
        "content": "<p>Phew, this is fun. I agree, based on the resolution of <a href=\"http://jira.hl7.org/browse/FHIR-30514\">FHIR-30514</a></p>",
        "id": 249776705,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233290
    },
    {
        "content": "<p>yes, definitely didn't intend to go down this rabbit hole today :-)</p>",
        "id": 249776746,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233321
    },
    {
        "content": "<p>One more addition to your current opinion: the \"Y\" in that table I screenshotted should be erased.</p>",
        "id": 249776865,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233385
    },
    {
        "content": "<p>yes, I agree</p>",
        "id": 249777018,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233452
    },
    {
        "content": "<p>I'll submit a Jira issue to capture these, since we might not review all the notes on an already applied isssue.</p>",
        "id": 249777297,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233592
    },
    {
        "content": "<p>thanks, that will be great.  i was gonna see if anyone can explain what we're missing first, but i think a ticket is smart so we don't forget</p>",
        "id": 249777381,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1629233643
    },
    {
        "content": "<p>Probably also relevant is <a href=\"http://jira.hl7.org/browse/FHIR-30697\">FHIR#30697</a> .<br>\nedit: note that this has actually been voted on, but not updated (I put a note in the FHIR-I stream).</p>",
        "id": 249777614,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1629233769
    },
    {
        "content": "<p>Submitted <a href=\"http://jira.hl7.org/browse/FHIR-33203\">FHIR-33203</a> -- though I'll note it assumes that other than _profile, there's nowhere <em>else</em> that a uri-type searchparam is used to index a canonical-type element.</p>",
        "id": 249777861,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1629233912
    },
    {
        "content": "<p>One question I have directly related to this is how can we \"resolve\" a canonical with versioning rules through the API?<br>\n(desiring just the relevant resource, not all versions, and latest if not specified)</p>",
        "id": 251823205,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630645288
    },
    {
        "content": "<p>Sorry Brian, I'm not quite clear what you mean</p>",
        "id": 251865331,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1630668544
    },
    {
        "content": "<p>Maybe you mean as a client you have a resource that has a canonical reference to a definitional resource and now you want to just go \"read\" that resource from somewhere?<br>\nI think you have two options in such cases:  go try to look it up in some registry OR try searching for it on a FHIR server (is there a difference?)<br>\nIf we went with the proposal in <a href=\"http://jira.hl7.org/browse/FHIR-33203\">FHIR-33203</a> then to look it up on a FHIR server the client would need to be able to parse the canonical url into is url and version parts so it can do a search like <code>GET [definitionalResourceType]?url=xx&amp;version=yy</code>.</p>",
        "id": 251865925,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1630668905
    },
    {
        "content": "<p>Is the lookup in some registry different to searching on the FHIR server - is there a defined way for that?<br>\nIf there is no version in the canonical, then you just search for that, then all versions will be returned, not just the latest active one (or whatever the rules should be)</p>",
        "id": 252126642,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630904095
    },
    {
        "content": "<p>Having the spec define how to resolve canonicals by a server, and not just general search to make the server do the hard work rather than the client is desirable...</p>",
        "id": 252127884,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630905456
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> <br>\nIf I understood you correctly, you want to either take a look at what the \"Content-Location\" header of your GET request says, to see version history: <br>\n❯ curl -v -H \"Content-Location\" <a href=\"http://fhir.hl7fundamentals.org/r4/Patient/500\">http://fhir.hl7fundamentals.org/r4/Patient/500</a></p>\n<ul>\n<li>Trying 34.220.222.151:80...</li>\n<li>TCP_NODELAY set</li>\n<li>\n<p>Connected to <a href=\"http://fhir.hl7fundamentals.org\">fhir.hl7fundamentals.org</a> (34.220.222.151) port 80 (#0)</p>\n<blockquote>\n<p>GET /r4/Patient/500 HTTP/1.1<br>\nHost: <a href=\"http://fhir.hl7fundamentals.org\">fhir.hl7fundamentals.org</a><br>\nUser-Agent: curl/7.68.0<br>\nAccept: <em>/</em></p>\n</blockquote>\n</li>\n<li>\n<p>Mark bundle as not supporting multiuse<br>\n&lt; HTTP/1.1 200 OK<br>\n&lt; X-Powered-By: HAPI FHIR 3.7.0-SNAPSHOT REST Server (FHIR Server; FHIR 4.0.0/R4)<br>\n&lt; ETag: W/\"18\"<br>\n&lt; Content-Location: <a href=\"http://fhir.hl7fundamentals.org/r4/Patient/500/_history/18\">http://fhir.hl7fundamentals.org/r4/Patient/500/_history/18</a></p>\n</li>\n</ul>\n<p>OR<br>\nyou want to tweek te search parameters, as described in: <a href=\"https://hl7.org/fhir/r4/search.html\">https://hl7.org/fhir/r4/search.html</a><br>\nHTH</p>",
        "id": 252161232,
        "sender_full_name": "Hank Lenzi",
        "timestamp": 1630927310
    },
    {
        "content": "<p>I wound up withdrawing <a href=\"http://jira.hl7.org/browse/FHIR-33203\">FHIR-33203</a> because the core change to the type of _profile in <a href=\"https://build.fhir.org/resource.html#search\">https://build.fhir.org/resource.html#search</a> <em>was applied</em> (... a couple of  months after being marked as applied :-)).</p>\n<p>That said, I'm still unclear on why the \"url\" search params like</p>\n<div class=\"codehilite\"><pre><span></span><code>GET /ValueSet?url=https://myvs.example.org\n</code></pre></div>\n\n<p>are defined with <code>SearchParameter.type</code> of <code>uri</code> instead of <code>referenence</code>. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> do you remember the rationale for this?</p>",
        "id": 263073203,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638223158
    },
    {
        "content": "<p>If you're searching by the URL property of ValueSet, there's no reference to resolve.  You're just searching by the string property.  In theory, you might want to use the 'above' or 'below' search modifiers.  E.g. \"Find me all valuesets with a url base of <a href=\"http://hl7.org\">http://hl7.org</a>\"</p>",
        "id": 263080810,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638227505
    },
    {
        "content": "<p>With reference, you're chasing a reference (canonical or Reference) to some other resource and things like 'identifier' come into play.</p>",
        "id": 263080922,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638227548
    },
    {
        "content": "<p>But we explicitly want things like piped version number syntax  to work here, and that syntax is defined  on reference type search parameters...  Put another way, why is \"_profile\"  a reference  when other canonicals are not?</p>",
        "id": 263091787,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638235724
    },
    {
        "content": "<p>No, we don't.  It <em>can't</em> be used here.  The ValueSet.url isn't of type 'canonical'.  If you want to search for a ValueSet by url + version, then you need to do it this way: ValueSet?url=http://foo&amp;version=bar</p>",
        "id": 263094464,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638238581
    },
    {
        "content": "<p>On the other hand, you can do this: StructureDefinition.valueset=http://foo|bar</p>",
        "id": 263094535,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638238674
    },
    {
        "content": "<p>That's because StructureDefinition.snapshot.element.binding.valueset has a type of canonical, not a type of uri.</p>",
        "id": 263094587,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638238699
    },
    {
        "content": "<p>I'm not entirely sure we don't want it work, but it certainly doesn't, and making it work would have pain, for sure. I'd vote against it as a server implementer</p>",
        "id": 263096353,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1638240867
    },
    {
        "content": "<blockquote>\n<p>it can't be used here</p>\n</blockquote>\n<p>Gah, sorry for the confusion about canonical (I jumped back into this thread after a related subject arose on FHIR-I call today without reminding myself what I was talking about!). But for uri type search parameters we do say:</p>\n<blockquote>\n<p>Note that for uri parameters that refer to the Canonical URLs of the conformance and knowledge resources (e.g. StructureDefinition, ValueSet, PlanDefinition etc), servers SHOULD support searching by canonical references, and SHOULD support automatically detecting a |[version] portion</p>\n</blockquote>\n<p>at <a href=\"http://build.fhir.org/search.html#uri\">http://build.fhir.org/search.html#uri</a> -- which suggests that <code>GET ValueSet?url=http://foo|v1</code>  \"SHOULD\" work. If it's unreliable and even Grahame would vote against supporting this and we have a workaround, it sure seems like we should eliminate this guidance</p>",
        "id": 263100602,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638246301
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> can you raise a tracker item?</p>",
        "id": 263151510,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1638282179
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-34398\">FHIR-34398</a></p>",
        "id": 263191173,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1638298523
    },
    {
        "content": "<p>What about this part of <a href=\"http://jira.hl7.org/browse/FHIR-33203\">FHIR#33203</a> ?</p>\n<ul>\n<li>The \"Y\" indicating that URIs can be used to index \"canonical\" elements should be removed from the \"Cross-map between search parameter types and Data types:\" table at <a href=\"http://build.fhir.org/search.html#table\">http://build.fhir.org/search.html#table</a></li>\n</ul>\n<p>Did we ever find a case where a search parameter of type uri is used to index an element of type canonical?</p>",
        "id": 263215672,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1638309982
    }
]