[
    {
        "content": "<p>Hi,</p>\n<p>I'm a bit confused about the examples and their corresponding descriptions in <a href=\"http://hl7.org/fhir/STU3/search.html#quantity\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/search.html#quantity\">http://hl7.org/fhir/STU3/search.html#quantity</a>:</p>\n<p>Example1: GET [base]/Observation?value=5.4|http://unitsofmeasure.org|mg<br>\nExample1 Description: Search for all the observations with a value of 5.4 mg where mg is understood as a UCUM unit (system/code)</p>\n<p>Example2: GET [base]/Observation?value=5.4||mg<br>\nExample2 Description: Search for all the observations with a value of 5.4 mg where the unit - either the code or the stated human unit (unit) are \"mg\"</p>\n<p>My understanding of Example1 is that when the 'system' part is provided in the search url, the the FHIR server will only use Quantity.code and not use Quantity.unit. However when 'system' is not provided then the FHIR server will also use Quantity.unit along with Quantity.code.</p>\n<p>Is this the correct interpretation? Or should all searches use both Quantity.unit and Quantity.code regardless of the 'system' part present?</p>",
        "id": 153897078,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500301680
    },
    {
        "content": "<p>\"My understanding of Example1 is that when the 'system' part is provided in the search url, the the FHIR server will only use Quantity.code and not use Quantity.unit. However when 'system' is not provided then the FHIR server will also use Quantity.unit along with Quantity.code.\"</p>\n<p>Yes that is how I interpret it as well.  But it is not explicit.  Can you submit a tracker to clarify the syntax?</p>",
        "id": 153897089,
        "sender_full_name": "Eric Haas",
        "timestamp": 1500305293
    },
    {
        "content": "<p>Yes.  I'm not sure whether the intention is to diverge from how token works or not.  We definitely need to make that clear, so please raise a tracker</p>",
        "id": 153897090,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1500305399
    },
    {
        "content": "<p>Thanks. I reported <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13646\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13646\">GF#13646</a>.</p>",
        "id": 153897115,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500313998
    },
    {
        "content": "<p>Some more questions I have regarding this topic:</p>\n<p>The description for <a href=\"http://hl7.org/fhir/STU3/datatypes.html#Quantity\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/datatypes.html#Quantity\">http://hl7.org/fhir/STU3/datatypes.html#Quantity</a> says: \"If the unit can be coded in UCUM and a code is provided, it SHOULD be a UCUM code\". Why is it not a 'SHALL' given that the system clearly indicates the UCUM namespace?</p>\n<p>And it isn't clear to me whether case-sensitive or case-insensitive comparison should be done on Quantity.unit or Quantity.code for FHIR servers that don't have a sophisticated UCUM engine or the cases where 'system' is not provided. I'm assuming case-insensitive comparison is done if it is intended to be similar to the token param type?</p>",
        "id": 153897132,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500322330
    },
    {
        "content": "<p>Quantity doesn't require that the code system be UCUM - it's allowed to use alternate code systems, but we prefer to use UCUM.  UCUM is case-sensitive.</p>",
        "id": 153897168,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1500346018
    },
    {
        "content": "<p>The token param type is also case sensitive unless the underlying code system indicates explicitly that codes should be handled in a case-insensitive manner.</p>",
        "id": 153897169,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1500346051
    },
    {
        "content": "<p>\"Quantity doesn't require that the code system be UCUM - it's allowed to use alternate code systems, but we prefer to use UCUM. UCUM is case-sensitive.\"</p>\n<p>A bit confused here especially your last sentence because <a href=\"http://unitsofmeasure.org/ucum.html\" target=\"_blank\" title=\"http://unitsofmeasure.org/ucum.html\">http://unitsofmeasure.org/ucum.html</a> section 2.1 contains notes about case sensitive and case insensitive symbols. However, I did some more digging in the FHIR spec and came across this: <a href=\"http://hl7.org/fhir/STU3/ucum.html\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/ucum.html\">http://hl7.org/fhir/STU3/ucum.html</a> with the note that the code is a \"   Valid expressions using the case sensitive symbols\".</p>\n<p>So do you actually mean that even though UCUM allows for case insensitive symbols, the FHIR spec only uses the case sensitive symbols hence FHIR servers should only do case sensitive comparison for UCUM codes?</p>",
        "id": 153897203,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500380493
    },
    {
        "content": "<p>\"The token param type is also case sensitive unless the underlying code system indicates explicitly that codes should be handled in a case-insensitive manner.\"</p>\n<p>I'm looking at these in the FHIR spec: <a href=\"http://hl7.org/fhir/STU3/search.html#token\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/search.html#token\">http://hl7.org/fhir/STU3/search.html#token</a> and <a href=\"http://build.fhir.org/search.html#token\" target=\"_blank\" title=\"http://build.fhir.org/search.html#token\">http://build.fhir.org/search.html#token</a>.</p>\n<p>As per my interpretation, the first sentence of the first paragraph supports what you say regarding exact matches. But the first sentence of the second paragraph threw me off. From the spec:</p>\n<p>\"For tokens, matches are literal (e.g. not based on subsumption or other code system features), but not case sensitive.\"</p>\n<p>The ending phrase of that sentence lead me to believe that token searches are case insensitive e.g. a search for Patient?identifier=someurl|someval will match [SOMEURL/sOmeVAL].</p>",
        "id": 153897204,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500381330
    },
    {
        "content": "<p>Yup, that wording isn't consistent and is potentially problematic.  Can you submit a change request?</p>",
        "id": 153897213,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1500385221
    },
    {
        "content": "<p>Which one are you referring to? The wording on token or the wording on UCUM?</p>",
        "id": 153897219,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500386430
    },
    {
        "content": "<p>The wording on token.  If you're using UCUM with FHIR, you're required to use the case-sensitive version</p>",
        "id": 153897225,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1500388619
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> I filed <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13655\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13655\">GF#13655</a>.</p>",
        "id": 153897231,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1500392201
    },
    {
        "content": "<p>I am now confused what needs to be clarified.... As I understand it the token search is case insentive but the code system determines whether the codes need to be case sensitive.  they are two different things.</p>\n<p>I can search UCUM using <code>mg/l</code>  which will match<code>mg/L</code>   </p>\n<p>On the other hand <code>mg/l</code>  will fail validation as a UCUM code in <code>quantity.code</code> and  <code>mg/L</code> will pass</p>",
        "id": 153897239,
        "sender_full_name": "Eric Haas",
        "timestamp": 1500396177
    },
    {
        "content": "<p>Hi, I have a question about how a quantity search is supposed to work when the target value has a comparator (&lt;, &lt;=, &gt;, &gt;=) and the search value has a prefix (gt, ge, lt, le, etc.).  (All of this assumes the units either match or can be converted to match.)  So my interpretation of the spec is that when a quantity value has a comparator, for search purposes it is a range with either an upper bound or a lower bound, but not both.  So if an Observation.valueQuantity has comparator=\"&gt;\" and value=\"180\", for search purposes that is a range from 180 to infinity.  The \"range\" interpretation of the \"gt\" search prefix is: \"the range above the search value intersects (i.e. overlaps) with the range of the target value\".  So it seems that <em>any</em> search of the form \"/Observation?value-quantity=gt[value]\" will select this resource, because no matter where \"[value]\" lies in relation to 180, the range \"[value] to infinity\" always intersects \"180 to infinity\".  Am I understanding all that correctly?</p>",
        "id": 153898831,
        "sender_full_name": "Jorge de la Garza",
        "timestamp": 1501178211
    },
    {
        "content": "<p>I think so</p>",
        "id": 153898853,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1501188096
    }
]