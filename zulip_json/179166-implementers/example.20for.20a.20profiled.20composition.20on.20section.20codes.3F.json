[
    {
        "content": "<p>has anyone an example for a profiled composition on sections (fixing the codes and order for the sections in which they are appearing in the composition) with the latest R3 StructureDefinition format? </p>\n<p>I tried it with the following:</p>\n<div class=\"codehilite\"><pre>    &lt;element id=&quot;Composition&quot;&gt;\n            &lt;path value=&quot;Composition&quot; /&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n        &lt;/element&gt;\n\n        &lt;element id=&quot;Composition.section&quot;&gt;\n            &lt;path value=&quot;Composition.section&quot; /&gt;\n            &lt;slicing&gt;\n                &lt;discriminator&gt;\n                    &lt;type value=&quot;value&quot; /&gt;\n                    &lt;path value=&quot;code.coding.code&quot; /&gt;\n                &lt;/discriminator&gt;\n                &lt;ordered value=&quot;true&quot; /&gt;\n                &lt;rules value=&quot;closed&quot; /&gt;\n            &lt;/slicing&gt;\n            &lt;min value=&quot;2&quot; /&gt;\n            &lt;max value=&quot;2&quot; /&gt; \n        &lt;/element&gt;\n\n        &lt;!-- first slice --&gt;\n        &lt;element id=&quot;Composition.section:sectionmed&quot;&gt;\n            &lt;path value=&quot;Composition.section&quot; /&gt;\n            &lt;sliceName value=&quot;sectionmed&quot; /&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n        &lt;/element&gt;\n... snip ...\n</pre></div>\n\n\n<p>however the validator spits outs the message with two sections in a sample file: </p>\n<div class=\"codehilite\"><pre>  Error @ Composition.section[1] (line 35, col11) : Profile ..., Element matches more than one slice\n  Error @ Composition.section[2] (line 57, col11) : Profile ..., Element matches more than one slice\n  Error @ Composition (line 1, col42) : Profile ...., Element &#39;Composition.section[sectionmed]&#39; minimum required = 1, but only found 0\n</pre></div>\n\n\n<p>I think I did not setup the path value correctly, but I'm not 100% sure, the examples about slicing are not yet following the new syntax as far as I have found. any help greatly appreciated.</p>",
        "id": 153872966,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1487696926
    },
    {
        "content": "<p>There's currently a bug in how the validator handles slicing in a couple of areas.  I hope to get to it tomorrow.  (So the problem is likely mine, not yours.)</p>",
        "id": 153872973,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1487699433
    },
    {
        "content": "<p>We are doing this in DSTU2 using Forge to build the StructureDefinitions. Looking at you definition of your first slice what within it makes it a uniquie slice? Should you now have something that states the \"code\" of the section that resolves to that slice as that is what your discriminator is based on.</p>",
        "id": 153873031,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1487765174
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> . I just upgraded today to trunk and retried the validator, however I get still the same error message with my composition.(Element matches more than one slice). Could you already look into the slicing bug of the validator?</p>",
        "id": 153877676,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1489747691
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> On my list for this weekend.  Has kept getting pushed back :(</p>",
        "id": 153877891,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1489787259
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> Which example/profile? We have had this error a few times and managed to resolve it</p>",
        "id": 153877912,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1489793843
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191362\">@Richard Kavanagh</span> . Thanks for you message. I have problems with slicing/validating  a specific extensions as well as two sections in a Composition: </p>\n<p>Example: <a href=\"https://github.com/ahdis/chmed16af/blob/master/resources/Composition/chmed16af-mp-composition-s01.xml\" target=\"_blank\" title=\"https://github.com/ahdis/chmed16af/blob/master/resources/Composition/chmed16af-mp-composition-s01.xml\">https://github.com/ahdis/chmed16af/blob/master/resources/Composition/chmed16af-mp-composition-s01.xml</a><br>\nProfile: <a href=\"https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-mp-composition.xml\" target=\"_blank\" title=\"https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-mp-composition.xml\">https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-mp-composition.xml</a></p>\n<div class=\"codehilite\"><pre><span></span>  Error @ Composition.extension (line 8, col93) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element matches more than one slice\n  Error @ Composition.section[1] (line 40, col11) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element matches more than one slice\n  Error @ Composition.section[2] (line 62, col11) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element matches more than one slice\n  Error @ Composition.section[3] (line 102, col11) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element matches more than one slice\n  Error @ Composition (line 1, col42) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element &#39;Composition.section[sectionmed]&#39;: minimum required = 1, but only found 0\n  Error @ Composition (line 1, col42) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-mp-composition, Element &#39;Composition.section[sectionnote]&#39;: minimum required = 1, but only found 0\n</pre></div>\n\n\n<p>I tried a simliar setup following the BP profile from <a href=\"http://build.fhir.org/bp.profile.xml.html\" target=\"_blank\" title=\"http://build.fhir.org/bp.profile.xml.html\">http://build.fhir.org/bp.profile.xml.html</a> for time of gestation with two coded entries in components:</p>\n<p>Example: <a href=\"https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-obs-timeofgestation.xml\" target=\"_blank\" title=\"https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-obs-timeofgestation.xml\">https://github.com/ahdis/chmed16af/blob/master/resources/StructureDefinition/chmed16af-obs-timeofgestation.xml</a><br>\nProfile: <a href=\"https://github.com/ahdis/chmed16af/blob/master/resources/Observation/chmed16af-observation-s01-timeofgestation.xml\" target=\"_blank\" title=\"https://github.com/ahdis/chmed16af/blob/master/resources/Observation/chmed16af-observation-s01-timeofgestation.xml\">https://github.com/ahdis/chmed16af/blob/master/resources/Observation/chmed16af-observation-s01-timeofgestation.xml</a></p>\n<p>But I get also similar errors:</p>\n<div class=\"codehilite\"><pre><span></span>  Error @ Observation.code.coding (line 15, col17) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-obs-timeofgestation, Element matches more than one slice\n  Error @ Observation.component[1] (line 24, col16) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-obs-timeofgestation, Element matches more than one slice\n  Error @ Observation.component[2] (line 39, col16) : Profile http://emediplan.ch/fhir/chmed16af/StructureDefinition/chmed16af-obs-timeofgestation, Element matches more than one slice\n</pre></div>\n\n\n<p>So thats why I first thought its a problem with the validator after <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  message. But if you have any idea why my profiles are not working I would be glad to try alternate approaches.</p>",
        "id": 153878501,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1490000199
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> Right now, the issue is with snapshot generation, not the validator.  It's an evil bit of code, so it's taking a while.</p>",
        "id": 153878975,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490155575
    },
    {
        "content": "<p>trying to dig deeper into the validation problems:</p>\n<ul>\n<li>I used the sample observation-example-body-height(body-height).xml from the release, it validates correctly, however the sample references the <a href=\"http://hl7.org/fhir/StructureDefinition/vitalsigns\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/vitalsigns\">http://hl7.org/fhir/StructureDefinition/vitalsigns</a></li>\n<li>If i change the profile in the sample to <a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a> the validator gives the error message: Profile <a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a>, Element matches more than one slice (error message on the code.coding Element)</li>\n<li>if i remove the differential elements from the <a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a> profile (snapshot elements left), the error from the validator stays the same.</li>\n</ul>\n<p>This raises the questions for me, if the snapshot in the <a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a> profile is not correct or the error message comes from the validator. <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> any idea how i can track down further the problem? </p>",
        "id": 153879461,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1490258147
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> seems that in the <a href=\"http://hl7.org/fhir/StructureDefinition/bodyheight\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/bodyheight\">http://hl7.org/fhir/StructureDefinition/bodyheight</a> profile, the differential introduces a slicing component on the element with id \"Observation:vitalsignsprofile.code.coding\" (xml line 2938), but that slicing component is missing from the snapshot...?</p>",
        "id": 153879484,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490264665
    },
    {
        "content": "<p>Yes, that's the problem.  Snapshot generation is currently broken when slicing is involved.  There are at least two issues, possibly more.  Grahame is working on it.  We'll plan to release a patch for the main spec next week that fixes this and a few other things.</p>",
        "id": 153879516,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490281323
    },
    {
        "content": "<p>Poor Grahame, snapshots and slicing hurts my brain... ;p</p>",
        "id": 153879520,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1490281681
    },
    {
        "content": "<p>As I said,  \"evil code\" . . .</p>",
        "id": 153879525,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1490282016
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> and <span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> for your feedback and glad to hear that it is on the agenda, you have my support for testing ...</p>",
        "id": 153879550,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1490287642
    }
]