[
    {
        "content": "<p>The .NET validator currently rejects all instances conforming to the US Core profile for Provenance as the provenance-1 is always failing. The constraint is defined on Provenance.agent.onBehalfOf, which is therefore the focus of the FHIRPath evaluation. However, the constraint starts with \"$this\" instead of \"%resource\". The \"agent\" child in \"$this.agent.who.resolve()\" is due to this never found.</p>\n<p>Can someone confirm that this is a bug in the constraint?</p>",
        "id": 225466824,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1612708924
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>, the fact the invariants (and specifically the expressions) don't actually show up on the profile home page is problematic.</p>\n<p>And yes, it's wrong.  $this is only available in the context of a function.  The expression should be using %resource.  Can you raise a tracker item?<br>\nAlso, we probably need a separate tracker item to figure out why the Java reference implementation didn't catch the issue.</p>",
        "id": 225470547,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1612713701
    },
    {
        "content": "<p>That fact the invariant table is half a page long  for the diff view is also problematic.   I don’t want my readers sifting through element definition invariants whuch they don’t need to care about.</p>",
        "id": 225507762,
        "sender_full_name": "Eric Haas",
        "timestamp": 1612766134
    },
    {
        "content": "<p>Fair.</p>",
        "id": 225508035,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1612766610
    },
    {
        "content": "<p>Created <a href=\"https://jira.hl7.org/browse/FHIR-31020\">https://jira.hl7.org/browse/FHIR-31020</a><br>\nThanks for the clarification</p>",
        "id": 225515740,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1612774197
    },
    {
        "content": "<p>A fairly recent version of the HL7 FHIR Validator raises an exception on this: </p>\n<blockquote>\n<p>org.hl7.fhir.exceptions.FHIRException: Problem processing expression ($this.agent.who.resolve().is Practitioner or Device) implies exists() in profile <a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-provenance</a> path Provenance.agent[0].onBehalfOf: Error in ?? at 1, 2: Found Practitioner expecting a \")\"<br>\nat org.hl7.fhir.validation.instance.InstanceValidator.checkInvariant(InstanceValidator.java:4833)</p>\n</blockquote>",
        "id": 225610348,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1612819393
    },
    {
        "content": "<p>Though this is somewhat new, because an older version we are running did not pick up on this issue.</p>",
        "id": 225610643,
        "sender_full_name": "Robert Scanlon",
        "timestamp": 1612819535
    },
    {
        "content": "<p>want to raise an issue against the validator?</p>",
        "id": 225620108,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1612823998
    },
    {
        "content": "<p>($this.agent.who.resolve().is Practitioner or Device) implies exists() isn't correct fhirpath right? it should be x.is(y) or 'x is y' not '<a href=\"http://x.is\">x.is</a> y'<br>\nnote: CI build for us-core provenance-1 should be fine and is <br>\n(($this.agent.who.resolve() is Practitioner) or ($this.agent.who.resolve() is Device)) implies exists()</p>",
        "id": 225621438,
        "sender_full_name": "ryan moehrke",
        "timestamp": 1612824752
    },
    {
        "content": "<p>so <a href=\"https://jira.hl7.org/browse/FHIR-31020\">https://jira.hl7.org/browse/FHIR-31020</a> got closed, but I think this expression is still problematic (for a different reason)</p>",
        "id": 275542176,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647449583
    },
    {
        "content": "<p>I'll open a new JIRA for it, but thought I'd mention hear as well (in case I got it wrong):</p>\n<p>agent is a repeating field and so <code>%resource.agent.who.resolve()</code> is potentially a collection with multiple items.  but <code>is</code> only works over singletons</p>",
        "id": 275542310,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647449632
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-36328\">FHIR-36328</a></p>",
        "id": 275546081,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1647450812
    }
]