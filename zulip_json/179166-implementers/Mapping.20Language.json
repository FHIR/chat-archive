[
    {
        "content": "<p>In the description of the mapping language, it states that the language can work on specs that don;t have a typing system like v2. Do you still create a logical model (StructureDefinition) for a v2 message when used as a target/source of a mapping? If so, what type would you use?</p>",
        "id": 153858201,
        "sender_full_name": "David Hay",
        "timestamp": 1479881882
    },
    {
        "content": "<p>no typing system, you probably can't define a logical model for it. If you can't, you can still use the mapping language, but you have to be careful about what you try to achieve</p>",
        "id": 153858376,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1479974739
    },
    {
        "content": "<p>I was thinking or using it to convert between v2 &amp; FHIR. Can't you define a separate type system in a Logical Model? Not understanding why we can't do that for v2...</p>",
        "id": 153858390,
        "sender_full_name": "David Hay",
        "timestamp": 1479991433
    },
    {
        "content": "<p>I've just committed a set of updates to the R3/R4 transforms.  They are in final state for the following resources:</p>\n<ul>\n<li>AuditEvent</li>\n<li>Basic</li>\n<li>Binary</li>\n<li>CapabilityStatement</li>\n<li>CodeSystem</li>\n<li>CompartmentDefinition</li>\n<li>Composition</li>\n<li>ConceptMap</li>\n<li>DocumentManifest</li>\n<li>DocumentReference</li>\n<li>GraphDefinition</li>\n<li>ImplementationGuide</li>\n<li>Linkage</li>\n<li>MessageDefinition</li>\n<li>MessageHeader</li>\n<li>NamingSystem</li>\n<li>Observation</li>\n<li>OperationDefinition</li>\n<li>OperationOutcome</li>\n<li>Parameters</li>\n<li>Patient</li>\n<li>Provenance</li>\n<li>SearchParameter</li>\n<li>StructureDefinition</li>\n<li>StructureMap</li>\n<li>Subscription</li>\n<li>ValueSet</li>\n</ul>",
        "id": 154011168,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540235699
    },
    {
        "content": "<p>this includes all the normative resources. Round-tripping is 100% ok, and most of the R4 resources are valid (there's a few mandatory attributes here and there that mean that the R3-&gt;R4 process will never produce valid r4 resources</p>",
        "id": 154011169,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540235774
    },
    {
        "content": "<p>I've changed the syntax of the mapping language a little, to make it more efficient. Changes:</p>\n<ul>\n<li>changed the group declaration - moved group inputs to be like parameters </li>\n<li>removed 'for' from the statements</li>\n<li>replaced 'make' with '-&gt;'</li>\n<li>added a ; at the end of each rule to reduce ambiguity</li>\n<li>moved the rule name to the end of the rule</li>\n<li>defaulted the rule name for simple rules so that it doesn't need to be present</li>\n</ul>\n<p>The outcome is much more readable. Here's an example:</p>\n<div class=\"codehilite\"><pre><span></span>group string2Annotation(source src : stringR3, target tgt : Annotation) extends Element &lt;&lt;types&gt;&gt; {\n  src -&gt; tgt.text as vt0 then string(src, vt0);\n}\n</pre></div>",
        "id": 154011174,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540235931
    },
    {
        "content": "<p>The only change that is not purely syntatical is the last one - defaulting names</p>",
        "id": 154011175,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540235967
    },
    {
        "content": "<p>I can easily revert this change, but I think it's a real improvement. We have a week to decide whether to adopt it as the only option, allow it, or just revert</p>",
        "id": 154011176,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540236019
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191363\">@Vadim Peretokin</span> <span class=\"user-mention\" data-user-id=\"194020\">@Gustav Vella</span> <span class=\"user-mention\" data-user-id=\"193633\">@Robinette Renner</span>  (some users I know will be interested)</p>",
        "id": 154011178,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540236074
    },
    {
        "content": "<p>So R4 is making elements mandatory that weren't in R3?  Are we confident that those newly mandatory elements are appropriate global constraints?</p>",
        "id": 154011182,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1540236542
    },
    {
        "content": "<p>I'm okay with all of those rules except for: \"moved the rule name to the end of the rule\"  Why did you make that one?</p>",
        "id": 154011185,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1540236938
    },
    {
        "content": "<p>looking at all of my map files, the other rules would greatly clean up the maps and make them easier to read (imnsho)</p>",
        "id": 154011186,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1540236962
    },
    {
        "content": "<p>because it lead to consistency. There's no need for the name, mostly, now. Prefixing it, it got in the way of reading it. Task this:</p>",
        "id": 154011207,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540242902
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>group ValueSet(source src : ValueSet, target tgt : ValueSetR3) extends DomainResource &lt;&lt;type+&gt;&gt; {\n  src.url -&gt; tgt.url;\n  src.identifier -&gt; tgt.identifier;\n  src.version -&gt; tgt.version;\n  src.name -&gt; tgt.name;\n  src.title -&gt; tgt.title;\n  src.status -&gt; tgt.status;\n  src.experimental -&gt; tgt.experimental;\n  src.date -&gt; tgt.date;\n  src.publisher -&gt; tgt.publisher;\n  src.contact -&gt; tgt.contact;\n  src.description -&gt; tgt.description;\n  src.useContext -&gt; tgt.useContext;\n  src.jurisdiction -&gt; tgt.jurisdiction;\n  src.immutable -&gt; tgt.immutable;\n  src.purpose -&gt; tgt.purpose;\n  src.copyright -&gt; tgt.copyright;\n  src.extension as ext where url = &#39;http://hl7.org/fhir/StructureDefinition/X34-vs-extensible&#39; then {\n    ext.value : boolean as vs0 -&gt; tgt.extensible = vs0 &quot;extensible2&quot;;\n  } &quot;extensible&quot;;\n  src.compose as vs0 -&gt; tgt.compose as vt0 then compose(vs0, vt0);\n  src.expansion as vs0 -&gt; tgt.expansion as vt0 then expansion(vs0, vt0);\n}\n</pre></div>",
        "id": 154011208,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540243044
    },
    {
        "content": "<p>compare to this:</p>\n<div class=\"codehilite\"><pre><span></span>group ValueSet(source src : ValueSet, target tgt : ValueSetR3) extends DomainResource &lt;&lt;type+&gt;&gt; {\n  src.url -&gt; tgt.url;\n  src.identifier -&gt; tgt.identifier;\n  src.version -&gt; tgt.version;\n  src.name -&gt; tgt.name;\n  src.title -&gt; tgt.title;\n  src.status -&gt; tgt.status;\n  src.experimental -&gt; tgt.experimental;\n  src.date -&gt; tgt.date;\n  src.publisher -&gt; tgt.publisher;\n  src.contact -&gt; tgt.contact;\n  src.description -&gt; tgt.description;\n  src.useContext -&gt; tgt.useContext;\n  src.jurisdiction -&gt; tgt.jurisdiction;\n  src.immutable -&gt; tgt.immutable;\n  src.purpose -&gt; tgt.purpose;\n  src.copyright -&gt; tgt.copyright;\n  &quot;extensible&quot;: src.extension as ext where url = &#39;http://hl7.org/fhir/StructureDefinition/X34-vs-extensible&#39; then {\n    &quot;extensible2&quot; : ext.value : boolean as vs0 -&gt; tgt.extensible = vs0;\n  };\n  src.compose as vs0 -&gt; tgt.compose as vt0 then compose(vs0, vt0);\n  src.expansion as vs0 -&gt; tgt.expansion as vt0 then expansion(vs0, vt0);\n}\n</pre></div>",
        "id": 154011209,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540243079
    },
    {
        "content": "<p>it's not something I feel about strongly</p>",
        "id": 154011210,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540243085
    },
    {
        "content": "<blockquote>\n<p>There's no need for the name, mostly, now. Prefixing it, it got in the way of reading it.</p>\n</blockquote>\n<p>Okay, let me ask a different question then - when do we need names for rules?  I don't remember being able to call a rule explicitly so why do we name them at all?</p>",
        "id": 154011215,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1540245189
    },
    {
        "content": "<p>the name appears in the conversion log, so you can see what rules were used in what order.</p>",
        "id": 154011216,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245222
    },
    {
        "content": "<p>I rely on that log to understand what is going on when I get results I don't expect - and I've just beefed up the usefulness of the log this week</p>",
        "id": 154011217,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245279
    },
    {
        "content": "<p>the automatic name for the rule is the element name + the type if specified e.g. <br>\n\"url\" for  </p>\n<div class=\"codehilite\"><pre><span></span>  src.url -&gt; tgt.url\n</pre></div>",
        "id": 154011218,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245344
    },
    {
        "content": "<p>or \"value-boolean\" for </p>\n<div class=\"codehilite\"><pre><span></span>  src.value : boolean -&gt; tgt.value\n</pre></div>",
        "id": 154011219,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245371
    },
    {
        "content": "<p>you only need to name the rules now if that automatic name won't differentiate them enough in the log, like </p>\n<div class=\"codehilite\"><pre><span></span>  src.extension where url = &#39;xxxx&#39; -&gt; ...\n  src.extension where url = &#39;yyy&#39; -&gt; ...\n</pre></div>",
        "id": 154011220,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245419
    },
    {
        "content": "<p>though the engine could automatically name those extension1, extension2 etc. perhaps the name is under useful altogether</p>",
        "id": 154011221,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540245488
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> what resources can I pick up on?</p>",
        "id": 154011557,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1540322543
    },
    {
        "content": "<p>anything in the Clinical panel - these would be a good place to start: AllergyIntolerance, Condition, Procedure, FamilyMemberHistory, ClinicalImpression, DetectedIssue - thanks</p>",
        "id": 154011593,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540328010
    },
    {
        "content": "<p>Will do</p>",
        "id": 154011720,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1540365493
    },
    {
        "content": "<p>keep track of work here: <a href=\"http://wiki.hl7.org/index.php?title=Progress_on_FHIR_R3/R4_conversions\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=Progress_on_FHIR_R3/R4_conversions\">http://wiki.hl7.org/index.php?title=Progress_on_FHIR_R3/R4_conversions</a></p>",
        "id": 154011739,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1540371728
    },
    {
        "content": "<p>The following is a small snippet of code using the previous syntax and the new syntax.  Please let me know if my interpretation of the changes is correct:</p>\n<p>Previous syntax:<br>\ngroup PatientElements<br>\n    input src: QuestionnaireResponse as source<br>\n    input tgt: Patient as target</p>\n<div class=\"codehilite\"><pre><span></span>&quot;section&quot;: for src.item as section then\n{\n    &quot;question&quot;: for section.item as question then\n    {\n        &quot;answer&quot;: for question.answer as answer then\n        {\n            &quot;gender&quot;:  for answer.valueString as gender make tgt.gender = gender\n        }\n    }\n}\n</pre></div>\n\n\n<p>endgroup</p>\n<p>New syntax:<br>\ngroup PatientElements (source src: QuestionnaireResponse, target tgt: Patient)<br>\n{<br>\n    src.item as section then<br>\n    {<br>\n        group.item as question then<br>\n        {<br>\n            question.answer as answer then<br>\n            {<br>\n                answer.valueString as gender -&gt; tgt.gender = gender \"gender\";<br>\n            } \"answer\";<br>\n        } \"question\";<br>\n    } \"section\";<br>\n}</p>",
        "id": 154011806,
        "sender_full_name": "Robinette Renner",
        "timestamp": 1540383744
    },
    {
        "content": "<p>I like all of the changes except the positioning of the rule name.  Having it at the end of the rule can be very confusing when there is a lot of nesting.  For most resources there will not be much nesting.  However, with questionnaires there can be a significant  amount.</p>\n<p>I recommend supporting both the previous and new syntax for a while.  This will prevent breaking existing applications such as Robert Worden's TBX tool.</p>",
        "id": 154011807,
        "sender_full_name": "Robinette Renner",
        "timestamp": 1540383936
    },
    {
        "content": "<p>It's a pitfall that the mapping language allows for double quotes but fhirpath only uses single-quotes for strings. Spent some time on why my matching rule <code>value = \"something\"</code> wasn't catching anything</p>",
        "id": 154019313,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1542409499
    },
    {
        "content": "<p>there's a long thread on the fhirpath stream about that. I completely agree. I've got to get around to improving the logging around that</p>",
        "id": 154019324,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1542431047
    },
    {
        "content": "<p>I'll be doing a quick break out from the network reception tonight at about 6pm on a couple of mapping language problems. I'll do it in regency ball room east #3</p>",
        "id": 155272496,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547660540
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> can you share summary after breakout  here?</p>",
        "id": 155302058,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1547686690
    },
    {
        "content": "<p>the breakout didn't really happen. Unfortunately - and my apologies. They were cleaning up the room, and I was scared off :-(</p>",
        "id": 155334375,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547731662
    },
    {
        "content": "<p>the summary was that I rewrote Oliver's mapping statements and posted them in a different topic here</p>",
        "id": 155334435,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547731689
    },
    {
        "content": "<p>do people think it's worth creating a specific mapping language stream?</p>",
        "id": 155334448,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547731709
    },
    {
        "content": "<p>Yes.  It would be good to have a specific mapping language stream.  It would help to build the community of mappers and facilitate the sharing of example code.</p>",
        "id": 155335407,
        "sender_full_name": "Robinette Renner",
        "timestamp": 1547732655
    },
    {
        "content": "<p>+1 for a separat stream and maybe an upcoming fhir connecathon track with fhir mapping language?</p>",
        "id": 155336023,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1547733177
    },
    {
        "content": "<p>do it as part of the connectathon stream we just agreed to</p>",
        "id": 155337888,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547734653
    },
    {
        "content": "<p>new stream: <a href=\"#narrow/stream/181579-mapping-framework\" title=\"#narrow/stream/181579-mapping-framework\">https://chat.fhir.org/#narrow/stream/181579-mapping-framework</a></p>",
        "id": 155338047,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547734774
    }
]