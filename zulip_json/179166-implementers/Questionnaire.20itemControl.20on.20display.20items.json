[
    {
        "content": "<p>We have markup in our display items. R4 cannot handle any markup in item.text. For that we use the <a href=\"http://hl7.org/fhir/extension-questionnaire-itemcontrol.html\">itemControl</a> extension. The itemControl extension goes onto a child item of the item it should <em>control</em>. When the item is a display item however, invariant que-1 kicks in:</p>\n<blockquote>\n<p>que-1 Rule    Questionnaire.item  Group items must have nested items, display items cannot have nested items</p>\n</blockquote>\n<p>Are we using the extension in the wrong way or did que-1 just never anticipate itemControl?</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"linkId\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2.16.840.1.113883.2.4.3.11.60.114.2.1.2--20210603151524\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"definition\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://decor.nictiz.nl/fhir/StructureDefinition/2.16.840.1.113883.2.4.3.11.60.114.4.2--20210603160554#2.16.840.1.113883.2.4.3.11.60.114.2.1.2--20210603151524\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"instructies\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"type\"</span><span class=\"p\">:</span> <span class=\"s2\">\"display\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"item\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/StructureDefinition/questionnaire-itemControl\"</span><span class=\"p\">,</span>\n          <span class=\"nt\">\"valueCodeableConcept\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n            <span class=\"p\">{</span>\n              <span class=\"nt\">\"coding\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                <span class=\"p\">{</span>\n                  <span class=\"nt\">\"system\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/questionnaire-item-control\"</span><span class=\"p\">,</span>\n                  <span class=\"nt\">\"code\"</span><span class=\"p\">:</span> <span class=\"s2\">\"help\"</span><span class=\"p\">,</span>\n                  <span class=\"nt\">\"display\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Help-Button\"</span>\n                <span class=\"p\">}</span>\n              <span class=\"p\">],</span>\n              <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Help-Button\"</span>\n            <span class=\"p\">}</span>\n          <span class=\"p\">]</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">],</span>\n      <span class=\"nt\">\"linkId\"</span><span class=\"p\">:</span> <span class=\"s2\">\"2.16.840.1.113883.2.4.3.11.60.114.2.1.2--20210603151524-help\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"text\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Selecteer het antwoord dat het beste beschrijft hoe u zich de afgelopen week heeft gevoeld.(Slechts één antwoord per vraag)\"</span><span class=\"p\">,</span>\n      <span class=\"nt\">\"_text\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n        <span class=\"nt\">\"extension\"</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"http://hl7.org/fhir/StructureDefinition/rendering-xhtml\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"valueString\"</span><span class=\"p\">:</span> <span class=\"s2\">\"&lt;div&gt;Selecteer het antwoord dat het beste beschrijft hoe u zich de &lt;strong&gt;afgelopen week&lt;/strong&gt; heeft gevoeld.&lt;br/&gt;(Slechts één antwoord per vraag)&lt;/div&gt;\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n      <span class=\"p\">},</span>\n      <span class=\"nt\">\"type\"</span><span class=\"p\">:</span> <span class=\"s2\">\"display\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">},</span>\n</code></pre></div>",
        "id": 265224035,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1639691185
    },
    {
        "content": "<p>You're using it wrong :)   The itemControl extension needs to appear on the 'display' item itself, not a nested item.  You can't nest one display inside another.  If you have multiple displays, they have to be sequential.</p>",
        "id": 265233603,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639696496
    },
    {
        "content": "<p>I'm trying to wrap around how to apply what you are saying. The way I understand the itemControl is that if you want a help button/text on something, you need to create child item that you mark with that extension. That is what I did above. If I make the item marked with itemControl a sibling of the thing it needs to be a Help text on, then how does one know what it belongs with?</p>\n<p>LHC Forms renders the item[type = display] + child help text exactly as I expect. LHC Forms does not render the Help text at all when I make them siblings. I think I would agree with LHC here. What do I miss?</p>",
        "id": 265264495,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1639728516
    },
    {
        "content": "<p>There's no mechanism to have help text 'on' a display item.  It can be before or after, but not 'inside'.</p>",
        "id": 265314110,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639756203
    },
    {
        "content": "<p>So this LHC feature is wrong then? The presumed way to display it, is attached to the question mark icon also visible in the screenshot<br>\n<a href=\"/user_uploads/10155/tbbb3HrdPiZNunvgMqVaSA0j/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/tbbb3HrdPiZNunvgMqVaSA0j/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/tbbb3HrdPiZNunvgMqVaSA0j/image.png\"></a></div>",
        "id": 265367474,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1639779026
    },
    {
        "content": "<p>For using markdown on the text use the markdown extension on the text rather than item control.</p>",
        "id": 265374103,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639782392
    },
    {
        "content": "<p>Alex, that help control thing is correct in lhcforms .</p>",
        "id": 265374156,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639782438
    },
    {
        "content": "<p>LHC forms is <em>incorrect</em>.  The rule is clearly that display items cannot contain nested items.  (At least for R4 - we could theoretically relax and allow nested display items in R5+ if someone were to submit a change request.)  <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span></p>",
        "id": 265387966,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639796880
    },
    {
        "content": "<p>The usual case is a question and an explanation thereof. The question normally is plain text, but could have markup in which case item.text + markdown extension could suffice. The additional explanation though, cannot really go anywhere else than under itemControl. All works fine for items other than display. For display items, LHC Forms still works fine, but the core invariant says it is wrong.</p>\n<p>LHC Forms does not support the item.text.extension for markdown unfortunately (I put in html there as LHC Forms does not do markdown at all). Since LHC Forms is the only viable open source implementation of Questionnaire out there, that makes being LHC Forms compatible more important than being FHIR compatible. I do we get those two goals to align?</p>",
        "id": 265482873,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1639924381
    },
    {
        "content": "<p>If you have a question, then it's not a display item, it's a question.  The only thing we prohibit is display under display.</p>",
        "id": 265486794,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639929897
    },
    {
        "content": "<p>You're free to have markdown on the text of a question or a display item.</p>",
        "id": 265486804,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639929920
    },
    {
        "content": "<p>This isn't helped by the tooltip text moving from the extension as it was back in DSTU2 (don't recall stu3) and to a child item. Means you lost the ability to have tooltip text on display items.</p>",
        "id": 265498508,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639945751
    },
    {
        "content": "<p>(and I guess help text too?)</p>",
        "id": 265498514,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1639945767
    },
    {
        "content": "<p>Correct.  We could relax the rule in R5 to allow displays to have child displays (do we limit how deep?), but it's definitely prohibited in R4.  Feel free to submit a change request.</p>",
        "id": 265502435,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1639951270
    },
    {
        "content": "<p>I would like to see an example of a questionnaire where it makes sense to have help text on a display item (as opposed to a question or group).</p>",
        "id": 265576213,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1640013491
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191375\">Alexander Henket</span> <a href=\"#narrow/stream/179166-implementers/topic/Questionnaire.20itemControl.20on.20display.20items/near/265482873\">said</a>:</p>\n<blockquote>\n<p>LHC Forms does not support the item.text.extension for markdown unfortunately (I put in html there as LHC Forms does not do markdown at all). Since LHC Forms is the only viable open source implementation of Questionnaire out there, that makes being LHC Forms compatible more important than being FHIR compatible. I do we get those two goals to align?</p>\n</blockquote>\n<p>You can submit a request for markdown support here:  <a href=\"https://github.com/lhncbc/lforms/issues\">https://github.com/lhncbc/lforms/issues</a>.  Or, you can submit a pull request for markdown support (though I suggest waiting until version 30 is out of beta, as we are reorganizing the code).</p>",
        "id": 265576745,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1640013734
    },
    {
        "content": "<p>I just might do that PR...</p>",
        "id": 265985976,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640333698
    },
    {
        "content": "<p>With the right lib, that's no harder than the HTML extension. (which is how I've done it)</p>",
        "id": 265986282,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1640334014
    }
]