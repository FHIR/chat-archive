[
    {
        "content": "<p>A few  of us (<span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> , <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> , <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> ) have been having a discussion about whether or not nested extensions on fields labeled as <code>isSummary=true</code> should be included when using the <code>_summary=true</code> search parameter. For example in the following Patient address:</p>\n<div class=\"codehilite\"><pre><span></span>    &quot;address&quot;: [\n        {\n            &quot;extension&quot;: [\n                {\n                    &quot;url&quot;: &quot;http://fhir.ufp/StructureDefinition/planet&quot;,\n                    &quot;valueString&quot;: &quot;Earth&quot;\n                }\n            ],\n            &quot;use&quot;: &quot;home&quot;,\n            &quot;type&quot;: &quot;both&quot;,\n            &quot;line&quot;: [\n                &quot;Milchstrasse 42&quot;\n            ],\n            &quot;city&quot;: &quot;Sp√∂ck&quot;,\n            &quot;postalCode&quot;: &quot;76297&quot;,\n            &quot;country&quot;: &quot;DE&quot;\n        }\n    ],\n</pre></div>\n\n\n<p>should the planet extension be included in summary view?</p>\n<p>The discussion started because some servers include the <code>rest.security.extension</code> content in <code>/metadata</code> and some do not. SMART on FHIR client libraries  query the capability statement to learn about the authorize and token endpoint and some default to doing this in summary mode to avoid pulling down a very large capability statement, e.g. on a mobile device. It is perfectly understandable why they would want to do it that way. </p>\n<p>The question is now if it is reasonable for a client to expect that auth information is included in summary view? </p>\n<p>The spec (<a href=\"https://www.hl7.org/fhir/search.html#summary\" target=\"_blank\" title=\"https://www.hl7.org/fhir/search.html#summary\">https://www.hl7.org/fhir/search.html#summary</a>) says \"This subset SHOULD consist solely of all supported elements that are marked as \"summary\" in the base definition of the resource(s)\", but the question is whether any nested extensions on elements labeled summary should be included? And the spec also includes the statement: \"Implementation Note: There is some question about the inclusion of extensions in the summary. Additional rules may be made around this in the future.\", so it is at least somewhat ambiguous. </p>\n<p>Servers that are based on the .NET FHIR API (Vonk, Microsoft FHIR Server, etc) don't include extensions in summary view (even nested extensions on elements that are labeled as is summary are excluded). Servers based on HAPI FHIR don't include extensions on resources (e.g. an extension on address is excluded in summary), but due to a bug that was discovered over the course of our discussion, it just happened to include them  on the capability statement, but not others. Since the SMART sandbox is based on HAPI, several SMART on FHIR client libraries now include a dependency on this bug.  The <a href=\"http://test.fhir.org\" target=\"_blank\" title=\"http://test.fhir.org\">test.fhir.org</a> server appears to include extensions nested on isSummary elements. The EMR based FHIR from Cerner, Epic, and AllScripts don't appear to support <code>_summary</code> at all. </p>\n<p>It would seem that it would at least be not recommended for a client to depend on this behavior, but some do nonetheless. We were wondering what the correct path forward is? </p>\n<p>1. Introduce the \"bug\" (if that is what it is) in all servers? If yes, only for capability statement?<br>\n2. \"Fix\" all the client libraries?<br>\n3. Update the spec to be explicit about the expected behavior one way or another?<br>\n4. Some combination of all of the above. <br>\n5. ??<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , would love to hear your thoughts on this?<br>\n<span class=\"user-mention\" data-user-id=\"195435\">@Kurt Ericson</span> what does the GCP FHIR service do?</p>",
        "id": 171136994,
        "sender_full_name": "Michael Hansen",
        "timestamp": 1563423548
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"195775\">@Michael Hansen</span>, great summary of our discussion.</p>",
        "id": 171162876,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1563451506
    },
    {
        "content": "<p>I deliberately ensured that those extensions are in the summary.</p>",
        "id": 171162993,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1563451614
    },
    {
        "content": "<p>the smart-app-launch spec is moving away from the extensions to known url based discovery. Which I prefer myself now</p>",
        "id": 171163022,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1563451638
    },
    {
        "content": "<p>in the mean time, I will keep my server returning those extensions in summary mode, irrespective of whether I return others or not</p>",
        "id": 171163042,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1563451668
    },
    {
        "content": "<p>I don't know what the correct answer should be</p>",
        "id": 171163086,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1563451683
    },
    {
        "content": "<p>I think in the near term, updating the two SMART libraries with this behavior (Python and  Swift) to avoid depending on _summary would help -- and in the process, updating them to also use /.well-known when available. FYI <span class=\"user-mention\" data-user-id=\"191339\">@Pascal Pfiffner</span>  and <span class=\"user-mention\" data-user-id=\"191660\">@Harold Solbrig</span>.</p>",
        "id": 171172163,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1563458148
    },
    {
        "content": "<p>For r5, I think we should pin down expectations for _summary to resolve this ambiguity. (My preference would be to say that complex extensions aren't included -- but clarify that simple extensions are, since they behave as \"data type properties\" )</p>",
        "id": 171172425,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1563458311
    },
    {
        "content": "<p>(And we might clarify that <em>modifier</em> extensions of any nesting level should be included; I'm not sure.)</p>",
        "id": 171172491,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1563458360
    },
    {
        "content": "<p>During this discussion, a question also came up about the <code>_elements</code> query parameter. The spec makes it unclear whether nested paths are allowed. (I assume not, though HAPI responds differently than Grahame's server for <code>/metadata?_elements=rest.security</code>)</p>",
        "id": 171172704,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1563458503
    },
    {
        "content": "<p>I guess a base question is whether _summary means that other elements are absolutely prohibited, or merely that they <em>should</em> be absent</p>",
        "id": 171180134,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1563462971
    },
    {
        "content": "<p>GCP FHIR has not yet implemented _summary=true (just data/text). If I had to guess based on how the server is generally implemented, we will probably default to including nested extensions on summary elements.</p>",
        "id": 171180597,
        "sender_full_name": "Paul Church",
        "timestamp": 1563463320
    },
    {
        "content": "<p>Related question, does _summary also summarize contained resources, or exclude them?</p>",
        "id": 171180678,
        "sender_full_name": "Paul Church",
        "timestamp": 1563463370
    },
    {
        "content": "<p>That's a good question <span class=\"user-mention\" data-user-id=\"197072\">@Paul Church</span>.  Can you submit a change request for us to put an answer to this into the core spec (once we figure out what the answer is :&gt;)</p>",
        "id": 171181502,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1563463911
    },
    {
        "content": "<p><a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22902&amp;start=0\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22902&amp;start=0\">GF#22902</a></p>",
        "id": 171182582,
        "sender_full_name": "Paul Church",
        "timestamp": 1563464597
    },
    {
        "content": "<p>Acknowledging that this pattern has cascaded into what it is today because of the early behavior of what is returned with <code>_summary</code> in the early SMART sandboxes. Agree with Josh that it would be good to have the Python <span class=\"user-mention\" data-user-id=\"191660\">@Harold Solbrig</span> and Swift <span class=\"user-mention\" data-user-id=\"191395\">@Dave Carlson</span> libraries stop issuing <code>_summary</code> when loading the capability statement and to add support for <code>.well-known</code> in a second step.</p>",
        "id": 171211337,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1563485970
    },
    {
        "content": "<p>Thanks for chiming in everybody. For Swift (<span class=\"user-mention\" data-user-id=\"191395\">@Dave Carlson</span>),  I added this issue <a href=\"https://github.com/smart-on-fhir/Swift-FHIR/issues/26\" target=\"_blank\" title=\"https://github.com/smart-on-fhir/Swift-FHIR/issues/26\">https://github.com/smart-on-fhir/Swift-FHIR/issues/26</a> the other day. In case you are tracking it.</p>",
        "id": 171223170,
        "sender_full_name": "Michael Hansen",
        "timestamp": 1563500768
    },
    {
        "content": "<p>Is there any standard way to represent rules for required search parameters in the capability statement?  What I mean is something like \"For the Patient resource, you must provide EITHER \"first name + last name + DOB\" OR \"first name + last name + phone number\" OR \"social security number\"?  If not, would an extension be appropriate?</p>",
        "id": 245826938,
        "sender_full_name": "Patrick Narkinsky",
        "timestamp": 1626184099
    },
    {
        "content": "<p>There's this: <a href=\"https://build.fhir.org/extension-capabilitystatement-search-parameter-combination.html\">https://build.fhir.org/extension-capabilitystatement-search-parameter-combination.html</a></p>",
        "id": 245832583,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1626186411
    }
]