[
    {
        "content": "<p>I received this error message when running HAPI 3.4 against the attached xml message instance named ITK-OPL-TEST-019-1.xml. I would like clarification as to why this error appears as I do not understand why HAPI is throwing it out as an error. I would not expect the entries it identifies as problematic in the second document bundle to be reachable from the first message bundle as I believe the two bundles should be separate. Also, there are many entries within the document bundle which cannot be reached from the first bundle and these are not highlighted as errors, so why these ones in particular? Should this error message rather be a warning instead?<br>\nThe entries which are highlighted as problematic are those in the document bundle which are based on the Practitioner and Organization resources. These resources are also referenced in the message bundle, specifically from the profile ITK-MessageHeader-2, but the profiles are different and differently named to those in the document bundle, e.g. in the message bundle they are named CareConnect-ITK-Header-Practitioner-1 and CareConnect-ITK-Header-Organization-1 and in the document bundle they are named CareConnect-Organization-1 and CareConnect-Practitioner-1.<br>\nBelow are the links to the raw xml for the relevant FHIR profiles too, as I believe these could be pertinent to solving this issue.</p>\n<p><a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Message-Bundle-1/_history/1.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Message-Bundle-1/_history/1.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Message-Bundle-1/_history/1.1?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Document-Bundle-1/_history/1.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Document-Bundle-1/_history/1.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/ITK-Document-Bundle-1/_history/1.1?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-MessageHeader-2/_history/2.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/ITK-MessageHeader-2/_history/2.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/ITK-MessageHeader-2/_history/2.1?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-ITK-MessageHandling-2/_history/2.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-ITK-MessageHandling-2/_history/2.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/Extension-ITK-MessageHandling-2/_history/2.1?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Practitioner-1/_history/1.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Practitioner-1/_history/1.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Practitioner-1/_history/1.1?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Organization-1/_history/1.1?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Organization-1/_history/1.1?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-Header-Organization-1/_history/1.1?_format=xml</a><br>\n<a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1/_history/1.0?_format=xml\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1/_history/1.0?_format=xml\">https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Practitioner-1/_history/1.0?_format=xml</a><br>\n<a href=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1/_history/1.0?_format=xml\" target=\"_blank\" title=\"https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1/_history/1.0?_format=xml\">https://fhir.hl7.org.uk/STU3/StructureDefinition/CareConnect-Organization-1/_history/1.0?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-OPL-Composition-1/_history/1.2?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-OPL-Composition-1/_history/1.2?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/CareConnect-ITK-OPL-Composition-1/_history/1.2?_format=xml</a><br>\n<a href=\"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-CareSettingType-1/_history/1.0?_format=xml\" target=\"_blank\" title=\"https://fhir.nhs.uk/STU3/StructureDefinition/Extension-CareSettingType-1/_history/1.0?_format=xml\">https://fhir.nhs.uk/STU3/StructureDefinition/Extension-CareSettingType-1/_history/1.0?_format=xml</a></p>\n<p>The full details of the errors are:-</p>\n<p>ITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[12] column: 0<br>\nITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[13] column: 0<br>\nITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[15] column: 0<br>\nITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[18] column: 0<br>\nITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[19] column: 0<br>\nITK-OPL-TEST-019-1.xml  FAIL    ERROR -- DOCUMENT BUNDLE: Entry isn't reachable by traversing from first Bundle entry * Location: Bundle.entry[20] column: 0<br>\nAttachments (1) <a href=\"/user_uploads/10155/_DI5NWPlWi5R5x4bDprTFgkC/ITK-OPL-TEST-019-1.xml\" target=\"_blank\" title=\"ITK-OPL-TEST-019-1.xml\">ITK-OPL-TEST-019-1.xml</a> <br>\n<span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> I wondered if you could help with this issue?</p>",
        "id": 153991221,
        "sender_full_name": "Katie Wheatley",
        "timestamp": 1535458936
    },
    {
        "content": "<p>Within the document Bundle, all entries in the Bundle need to be reachable by traversing from the Composition.  For example, your PractitionerRole cd734ce9-468d-4a36-8dac-e453aa4747e0 isn't pointed to by anything.  And Practitioner 88f1ca61-0200-4943-a066-baf9a1570029 is only pointed to by that PractitionerRole, so it's not connected either.</p>",
        "id": 153991298,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1535469470
    },
    {
        "content": "<p>That's a base rule in the FHIR specification, so it's not an issue with HAPI</p>",
        "id": 153991299,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1535469489
    },
    {
        "content": "<blockquote>\n<p>That's a base rule in the FHIR specification, so it's not an issue with HAPI</p>\n</blockquote>\n<p>Thanks very much for your response, Lloyd. Practitioner 88f1ca61-0200-4943-a066-baf9a1570029 is traversable from the Composition entry, but the PractitionerRole entries are not and I believe that is the problem which is generating the error. All the errors I believe relate to Practitioners and Organisations which are referenced in PractitionerRole entries.</p>",
        "id": 153991304,
        "sender_full_name": "Katie Wheatley",
        "timestamp": 1535472170
    },
    {
        "content": "<blockquote>\n<p>Within the document Bundle, all entries in the Bundle need to be reachable by traversing from the Composition.  For example, your PractitionerRole cd734ce9-468d-4a36-8dac-e453aa4747e0 isn't pointed to by anything.  And Practitioner 88f1ca61-0200-4943-a066-baf9a1570029 is only pointed to by that PractitionerRole, so it's not connected either.</p>\n</blockquote>\n<p>I have looked into this issue in a little more detail. Within the xml example attached, I don't have any orphaned resources and they are all reachable from Composition either directly or indirectly. This does seem to me to conform to the FHIR documents guidance at <a href=\"https://www.hl7.org/fhir/documents.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/documents.html\">https://www.hl7.org/fhir/documents.html</a> where it states that </p>\n<p>*The document bundle SHALL include only:<br>\nThe Composition resource, and any resources directly or indirectly (e.g. recursively) referenced from it*</p>\n<p>The HAPI validator error I received above is thrown against the Practitioner and Organization entries where they are referenced within the PractitionerRole entries. Both the Practitioner and Organization entries are referenced directly from Composition within the document bundle. PractitionerRole links to them as it contains references to them - that is how PractitionerRole works in FHIR as neither Practitioner nor Organization hold references to it - the referencing works the other way around. <br>\nThat is why I believe that the error thrown by the HAPI validator may be because HAPI is not interpreting the FHIR guidance correctly.  I would welcome more discussion on this.</p>",
        "id": 153994235,
        "sender_full_name": "Katie Wheatley",
        "timestamp": 1536300605
    },
    {
        "content": "<p>In STU3, there was no allowance for reverse-direction relationships.  That's fixed in R4.  However, you'd still want the Composition to point to PractitionerRole, not Practitioner.  If Composition points to Practitioner, you're saying \"this was created by Dr. Smith, but I don't know/care what role she did it in or on behalf of what organization she did it; oh and by the way, here's one of the roles that Dr. Smith works\".  Presumably that's not what you're wanting to say.</p>",
        "id": 153994242,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1536302540
    },
    {
        "content": "<p>This is an issue on 3.7 HAPI, we have a message Bundle which has focus of Encounter. </p>\n<p>Other entries have context of Encounter, they all come up as 'Entry isn't reachable by traversing from first Bundle entry'</p>",
        "id": 160482897,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1552314433
    },
    {
        "content": "<p>Believe this needs to be added to HAPI Validator </p>\n<p>Comment in InstanceValidator class</p>\n<p>// Todo - check if the remaining resources point <em>to</em> the elements in the referenced set.  Any that are still left over are errors</p>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> can you confirm implementing this TODO is still within FHIR rules?</p>",
        "id": 160488635,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1552318252
    },
    {
        "content": "<p>That comment is no longer in the shared HL7/HAPI code and I seem to recall refactoring it to address the issue, so that problem <em>shouldn't</em> exist in the most recent version of HAPI.</p>",
        "id": 160489822,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552319045
    },
    {
        "content": "<p>excellent (I should have checked r4). So the solution should be to move the fix from r4 to stu3</p>",
        "id": 160490413,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1552319435
    },
    {
        "content": "<p>Will look at making the change</p>",
        "id": 160490450,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1552319456
    },
    {
        "content": "<p>In principle, the current validator code should always be used regardless of version</p>",
        "id": 160492086,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552320596
    },
    {
        "content": "<p>r5 now... :-(</p>",
        "id": 160749099,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1552535456
    }
]