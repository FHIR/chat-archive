[
    {
        "content": "<p>Should FHIR server \"resolve\" bundle references for conditional updates as well?<br>\nFor example, in the following bundle:</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Bundle&quot;,\n    &quot;type&quot;: &quot;transaction&quot;,\n    &quot;entry&quot;: [{\n        &quot;fullUrl&quot;: &quot;urn:uuid:ac7ed09f-3711-4884-a0ff-13ed81ea21d0&quot;,\n        &quot;request&quot;: {\n            &quot;method&quot;: &quot;PUT&quot;,\n            &quot;url&quot;: &quot;Patient?identifier=patient-xyz&quot;\n        }\n        &quot;resource&quot;: ...\n    },\n    {\n        &quot;request&quot;: {\n            &quot;method&quot;: &quot;PUT&quot;,\n            &quot;url&quot;: &quot;RelatedPerson?patient=urn:uuid:ac7ed09f-3711-4884-a0ff-13ed81ea21d0&quot;\n        }\n        &quot;resource&quot;: ...\n    }]\n}\n</pre></div>\n\n\n<p>Is it reasonable to expect that <code>patient=</code> reference in the query is also replaced with real FHIR resource identity?</p>",
        "id": 191643314,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1585070020
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 191646272,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1585071195
    },
    {
        "content": "<p>That sounds technically problematic, it could require an unbounded number of passes to finish resolving all of the references in a bundle.</p>",
        "id": 191648626,
        "sender_full_name": "Paul Church",
        "timestamp": 1585072202
    },
    {
        "content": "<p>But that's not any different from using these references as references inside resources? I can have conditional PUT, then second entry having a reference to the first one and also doing a conditional PUT, then third entry having a reference to the second one, etc.</p>",
        "id": 191650206,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1585072887
    },
    {
        "content": "<p>The way I think of it is that you can do one pass to figure out what resource identities exist in the bundle (including resolving conditional create/updates) and then a second pass to rewrite references using that information.</p>",
        "id": 191650618,
        "sender_full_name": "Paul Church",
        "timestamp": 1585073069
    },
    {
        "content": "<p>Hmm, I see what you mean.</p>\n<p>I guess, this is where our use/implementation of transactions is non-conformant with the spec: we allow dependencies between entries (for example, through <a href=\"https://www.hl7.org/fhir/references.html#logical\" target=\"_blank\" title=\"https://www.hl7.org/fhir/references.html#logical\">logical references</a>) where we have to process resource fully for identifiers to resolve for the following entry. Extended operations would be another example where we have to process an operation before entries that depend on its result.</p>",
        "id": 191651669,
        "sender_full_name": "Ivan Dubrov",
        "timestamp": 1585073609
    },
    {
        "content": "<p>I think logical references could be done with only one pass though? As part of figuring out what resource identities exist in the bundle, the identifiers could be extracted. It's a bit more cumbersome because there could be other resources already on the server with those identifiers.</p>",
        "id": 191653578,
        "sender_full_name": "Paul Church",
        "timestamp": 1585074514
    },
    {
        "content": "<p>that makes my head hurt. My server certainly doesn't</p>",
        "id": 192168384,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585479452
    },
    {
        "content": "<p>Hi <br>\nI have a question regarding conditional update.  The section here <a href=\"http://build.fhir.org/http.html#cond-update\" title=\"http://build.fhir.org/http.html#cond-update\">http://build.fhir.org/http.html#cond-update</a><br>\nThe 4th bullet point says, the server returns a 400 Bad Request if a resource match is found but resource id doesn't match. <br>\nWhile, the last statement of the same section mentions that \"If an id is provided, the server SHALL ignore it\".  </p>\n<p>Any clarifications ?</p>",
        "id": 192907268,
        "sender_full_name": "Chidamber Kumar",
        "timestamp": 1586006400
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 192908495,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1586008284
    },
    {
        "content": "<p>Given the amount of detail we provide in the paragraphs above about exactly to do in circumstance when there is an ID or not an ID, and when the ID matches or does not match... I have to conclude that the sentence at the end is a mistake in our specification and should be deleted. At least this is trial use material :-)</p>",
        "id": 192910694,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1586011243
    },
    {
        "content": "<p>I will add an issue to our tracker</p>",
        "id": 192910705,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1586011263
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-26688\" title=\"http://jira.hl7.org/browse/FHIR-26688\">FHIR#26688</a></p>",
        "id": 192910913,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1586011522
    },
    {
        "content": "<p>Thanks Josh, we just stumbled across this one too. :)</p>",
        "id": 218042295,
        "sender_full_name": "David Moorhouse",
        "timestamp": 1606429360
    }
]