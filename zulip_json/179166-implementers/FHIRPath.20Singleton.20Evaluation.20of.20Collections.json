[
    {
        "content": "<p>I figured it would be best to branch of this specific topic from <a href=\"https://chat.fhir.org/#narrow/stream/implementers/topic/FHIRPath.20Specification.20Questions\" target=\"_blank\" title=\"https://chat.fhir.org/#narrow/stream/implementers/topic/FHIRPath.20Specification.20Questions\">https://chat.fhir.org/#narrow/stream/implementers/topic/FHIRPath.20Specification.20Questions</a> since that one kind of got taken to another direction.</p>\n<p>I downloaded the latest definitions.xml from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> and I still see a few invariants that I think will fail for this specific case.</p>\n<p>1. invariant cnt-3 for Count type: it still uses '(code or value.empty())...'<br>\n2. invariant dis-1 for Distance type: it still uses '(code or value.empty())...'<br>\n3. invariant opd-2 for OperationDefinition resource: it uses 'searchType implies type...'</p>\n<p>I presume these need to be updated to use code.exists() or searchType.exists() so that FHIRPath engines that follow the spec will not throw errors?</p>",
        "id": 153949370,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1522421209
    },
    {
        "content": "<p>And speaking of FHIRPath engines that follow this spec (i.e. <a href=\"https://github.com/FHIR/fluentpath/blob/master/spec/index.adoc#singleton-evaluation-of-collections\" target=\"_blank\" title=\"https://github.com/FHIR/fluentpath/blob/master/spec/index.adoc#singleton-evaluation-of-collections\">https://github.com/FHIR/fluentpath/blob/master/spec/index.adoc#singleton-evaluation-of-collections</a>), I don't think any of the FHIRPath reference implementations follow it.</p>\n<p>1. Pascal RI: <a href=\"https://github.com/grahamegrieve/fhirserver/blob/master/reference-platform/r4/FhirPath.pas\" target=\"_blank\" title=\"https://github.com/grahamegrieve/fhirserver/blob/master/reference-platform/r4/FhirPath.pas\">https://github.com/grahamegrieve/fhirserver/blob/master/reference-platform/r4/FhirPath.pas</a> (search for 'function TFHIRPathEngine.convertToBoolean(items: TFHIRSelectionList): boolean')<br>\n2. Java RI: <a href=\"https://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimplementations%2Fjava%2Forg.hl7.fhir.r4%2Fsrc%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FFHIRPathEngine.java&amp;view=markup&amp;revision=13543\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimplementations%2Fjava%2Forg.hl7.fhir.r4%2Fsrc%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FFHIRPathEngine.java&amp;view=markup&amp;revision=13543\">https://gforge.hl7.org/gf/project/fhir/scmsvn/?action=browse&amp;path=%2Ftrunk%2Fbuild%2Fimplementations%2Fjava%2Forg.hl7.fhir.r4%2Fsrc%2Forg%2Fhl7%2Ffhir%2Fr4%2Futils%2FFHIRPathEngine.java&amp;view=markup&amp;revision=13543</a> (search for 'public boolean convertToBoolean(List&lt;Base&gt; items) {')<br>\n3. .NET RI: <a href=\"https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.FhirPath/FhirPath/Functions/CollectionOperators.cs\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.FhirPath/FhirPath/Functions/CollectionOperators.cs\">https://github.com/ewoutkramer/fhir-net-api/blob/master/src/Hl7.FhirPath/FhirPath/Functions/CollectionOperators.cs</a> (search for 'public static bool? BooleanEval(this IEnumerable&lt;IElementNavigator&gt; focus)')</p>\n<p>Instead of 'raise error' they return true if the list is non-empty and non-Boolean. Perhaps it would be best to update these also?</p>",
        "id": 153949377,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1522422354
    },
    {
        "content": "<p>will look into this in 24hours</p>",
        "id": 153949497,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1522441187
    },
    {
        "content": "<p>personally, I think the spec is wrong on this point. It's a difference between editors, I guess. We will hve to reconcile this in the ballot due out next week</p>",
        "id": 153949559,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1522525689
    },
    {
        "content": "<p>but I fixed them for now, thanks</p>",
        "id": 153949560,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1522525872
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> ?</p>",
        "id": 153951189,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1523030625
    },
    {
        "content": "<p>so this should be sorted in the new version of FHIRPath being balloted now</p>",
        "id": 153951257,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1523043031
    }
]