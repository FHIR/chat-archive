[
    {
        "content": "<p>I haven't seen this scenario explicitly called out in <a href=\"http://hl7.org/fhir/references.html#contained\" target=\"_blank\" title=\"http://hl7.org/fhir/references.html#contained\">http://hl7.org/fhir/references.html#contained</a> : if a client creates a resource that contains another resource via POST, is it the server's call whether it pulls out the contained resource and creates a standalone resource for it (updating the reference of course) or should a server not decide that by itself and always leave contained resources as they are? Should we call out the preference and/or guidance on this scenario to the spec?</p>",
        "id": 185521045,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1578940067
    },
    {
        "content": "<p>if the client has provided a contained resource correctly - because there's not enough information to identify the contained resource - it would be futile and inappropriate to try to pull it out</p>",
        "id": 185530612,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578945218
    },
    {
        "content": "<p>Can you elaborate? What determines there is or isn't enough information? If the contained resource had an identifier and others fields that the server determined could become standalone, wouldn't it be up to the server?</p>",
        "id": 185530911,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578945362
    },
    {
        "content": "<p>If the contained resource has enough information to be stand alone, then it shouldn't have been sent as contained in the first place.</p>",
        "id": 185531310,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578945614
    },
    {
        "content": "<p>'contained' isn't an expedient way to send multiple resources at once.  It's a mechanism for sending resources that <em>cannot</em> live independently from their container.</p>",
        "id": 185531356,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578945648
    },
    {
        "content": "<p>If you want a convenient way to send multiple resources in a single call, use a batch or transaction Bundle.</p>",
        "id": 185531391,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578945669
    },
    {
        "content": "<p>contained resources really shouldn't contain an identifier. that would be a clear marker for someone abusing contained resources</p>",
        "id": 185531448,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578945713
    },
    {
        "content": "<p>Would it be safe to say: The mechanism by which an additional resource can be sent would be up to the individual servers to decide.</p>",
        "id": 185531638,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578945810
    },
    {
        "content": "<p>the mechanism?</p>",
        "id": 185531824,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578945930
    },
    {
        "content": "<p>Batch vs post vs operation as an example.</p>",
        "id": 185532115,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578946088
    },
    {
        "content": "<p>well, it can be up to individual servers, or it may be specified in some IG</p>",
        "id": 185532356,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578946239
    },
    {
        "content": "<p>or it may be implied by the rules in the specification</p>",
        "id": 185532379,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578946257
    },
    {
        "content": "<p>Fair enough. Then it really is up to the IG/Server to decide how handle the situation then.</p>",
        "id": 185532452,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578946308
    },
    {
        "content": "<p>Example would be serviceprovider on encounter.</p>",
        "id": 185532491,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578946323
    },
    {
        "content": "<p>The client may have a name/identifier for an organization, but nothing else. The server may deem that is sufficient for a standalone resource. Since organization (and many FHIR resources) doesn't require any fields, I thought the comment determining sufficient data was interesting because there isn't much required in that example. So one server may say post the organization first, another may say batch, and another may something else.</p>",
        "id": 185532815,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578946511
    },
    {
        "content": "<p>in principle you are correct. The server is always on slippery ground when it's double thinking the client, but there's circumstances in which it can be known to be safe.</p>",
        "id": 185538558,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578950210
    },
    {
        "content": "<p>Our server (as many other I am sure) has no concept of contained resources, so if we receive such a thing the options are either reject or try to convert the contained into a 'proper' stand alone resource - and we do both depending on the case</p>",
        "id": 185540945,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1578951777
    },
    {
        "content": "<p>That is the type of behavior I would have thought would have been \"standard\", but in the case where you create a resource, what do you respond with on a subsequent get of the resource? Still the contained, or using the reference datatype you reference the \"real\" resource?</p>",
        "id": 185543865,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578953741
    },
    {
        "content": "<p>the second</p>",
        "id": 185544316,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578954019
    },
    {
        "content": "<p>That is what I would expect as well.</p>",
        "id": 185544373,
        "sender_full_name": "Drew Torres",
        "timestamp": 1578954062
    },
    {
        "content": "<p>Clients sending resource A that contains resource B should generally expect to get back what they submit.  And they should expect that querying directly for B won't return anything (unless they use an advanced search mechanism that isn't widely supported).  If the server that receives A happens to be able to figure out how to get B to stand alone, they're permitted - but not required to break it out and store it as an independent resource - or change the link to be an existing standard resource.  (Just as they're permitted to change other data in the received resource based on 'special' knowledge or business rules they might have.)  Any system that makes such changes must be aware that doing so may invalidate any digital signatures present in the instance or elsewhere that refer to the resource.</p>",
        "id": 185544831,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578954369
    },
    {
        "content": "<p>Yes, in the cases where we process a contained resource we convert it to a stand-alone one, and that's what the client would see - a separate resource, no longer a contained one</p>",
        "id": 185544996,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1578954486
    },
    {
        "content": "<p>What does the client see in the response to the create when that conversion happens? It seems to me you can only return one resource at that point, even if multiple full resources were created.</p>",
        "id": 185546830,
        "sender_full_name": "Paul Church",
        "timestamp": 1578955923
    },
    {
        "content": "<p>You would see what was stored in the 'created' resource (if you get back a copy) or warning messages about what changes occurred if you don't.  If a contained reference got changed to a 'real' resource, you'd see the reference to whatever was pointed to (whether a newly created instance or something that existed before).</p>",
        "id": 185547161,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578956213
    },
    {
        "content": "<p>right. you see the focus resource returned as the server accepted it. Which means, in this case, the contained resources removed, and the references updated to the new location of the resource that was contained when submitted by the client</p>",
        "id": 185547172,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578956221
    },
    {
        "content": "<p>On a subsequent PUT operation, I am assuming the server will update both the focus resources and newly created ones?</p>",
        "id": 185556574,
        "sender_full_name": "Eric Haas",
        "timestamp": 1578964969
    },
    {
        "content": "<p>Note that a contained resources could be promoted to a stand-alone one at any point in time, not just when the resource is posted.</p>",
        "id": 185574038,
        "sender_full_name": "René Spronk",
        "timestamp": 1578990551
    },
    {
        "content": "<p>That's fun in the update. Was that an update to the existing, or a new one altogether. If you remove the reference and contained, does the server remember to cleanup the separate resource that is no pinger referenced?<br>\nLots of fun little gotchas. Just like patient contacts in v2 adt messages.</p>",
        "id": 185684735,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1579083521
    },
    {
        "content": "<p>Given that a contained resource doesn't have an identifier, one would have to assume some sort of 'snapshot' behaviour on the part of the client. But containment is not about grouping for the 'sole reason of grouping', so FHIR doesn't see snapshot as a valid behavior on the part of the client when containing resources. <br>\nIf Client A sends a resource to a server, then who knows what other clients, or the server based on its own logic, will do/modify/delete that resource? There can't be any expectation on behalf of A that the server will leave \"their\" resource alone, unless there is some explicit agreement between a server and a client prior to the post by A of a resource.</p>",
        "id": 185685064,
        "sender_full_name": "René Spronk",
        "timestamp": 1579083837
    }
]