[
    {
        "content": "<p>Hi. We're working on a Composition Bundle for spirometry and we're wondering what to profile. Bundle, Composition or both. Looking through the C-CDA on FHIR specs it seems that only the Composition was profiled, but that seems to leave a gap at Bundle level. Any advice appreciated.</p>",
        "id": 153868781,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485177171
    },
    {
        "content": "<p>What do you mean by \"leave a gap at Bundle level\"?</p>",
        "id": 153868782,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485177288
    },
    {
        "content": "<p>without a Bundle profile, I can send a Bundle with a different Composition, of a different Bundle.type etc.</p>",
        "id": 153868783,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485177332
    },
    {
        "content": "<p>Why? You could specify multiple profiles in <a href=\"http://www.hl7.org/FHIR/elementdefinition-definitions.html#ElementDefinition.type.profile\" target=\"_blank\" title=\"http://www.hl7.org/FHIR/elementdefinition-definitions.html#ElementDefinition.type.profile\">http://www.hl7.org/FHIR/elementdefinition-definitions.html#ElementDefinition.type.profile</a>, including one for a Bundle</p>",
        "id": 153868784,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485177729
    },
    {
        "content": "<p>Question is whether or not to create a profile for Bundle at all, not howto when I do :-) So you are advising me to create a Bundle profile here?</p>",
        "id": 153868785,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485177804
    },
    {
        "content": "<p>Nope. I didn't understand your original question and now I understand that you saw a flaw with their profile</p>",
        "id": 153868786,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485177889
    },
    {
        "content": "<p>I'd go for a Composition as well, but I don't know your data model...</p>",
        "id": 153868787,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485177932
    },
    {
        "content": "<p>So you would not profile the bundle to reference the composition profile explicitly.</p>",
        "id": 153868788,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485182366
    },
    {
        "content": "<p>I'd profile the reference for a composition or the resource for a bundle either way. Though putting a bundle into a composition to begin with seems redundant to me, but perhaps your data model dictates that's the best.</p>",
        "id": 153868791,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485183199
    },
    {
        "content": "<p>No, we're not reading eachother well :-) This is the thing:</p>\n<p>Bundle<br>\nBundle.entry.resource.Composition<br>\nBundle.entry.resource.Observation (panel)<br>\nBundle.entry.resource.Observation (FEV1 observation)<br>\nBundle.entry.resource.Observation (0..* other panel observations)<br>\nBundle.entry.resource.Organization (producer)<br>\nBundle.entry.resource.Patient<br>\n...</p>\n<p>Composition profile will tell me what other spirometry panel resources I need/can have. So at minimum I need a Composition profile. But... Composition is not the entry resource: Bundle is. So: without a Bundle profile, I need to inspect the Bundle.type and Bundle.entry.resource.Composition.meta.profile before I know what validation/processing I need to load.</p>",
        "id": 153868792,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485183526
    },
    {
        "content": "<p>Ack, sorry, the error is on my part and I see what you mean now. Creating a profile on Bundle would be a nice solution to this, agreed. It would cover off both identification at runtime and constraint validation.</p>",
        "id": 153868793,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1485184075
    },
    {
        "content": "<p>That's what I thought, but then I found that C-CDA on FHIR did not do this and I starting doubting</p>",
        "id": 153868795,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485187041
    },
    {
        "content": "<p>You don't really need to profile the entries in the Bundle beyond the first as you can (and should) use the \"aggregation\" property on your various Reference elements to flag what should be in the bundle vs. not.  So a single generic profile for FHIR documents (we should probably do that at the international level) plus a more restrictive profile that says \"this document instance must have a Composition that complies with profile X\" should be sufficient.</p>",
        "id": 153868801,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1485188081
    },
    {
        "content": "<p>Would StrucDoc be open for defining such an international profile? It would be nice indeed</p>",
        "id": 153868803,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485188414
    },
    {
        "content": "<p>Just checking: is it possible to leave open at panel level whether or not stuff is bundled, and specify at Bundle or Composition level that all immediate references and references in references shall be bundled? The only way to specify that in my mind is an invariant, right?</p>",
        "id": 153868804,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485188779
    },
    {
        "content": "<p>Hi Alexander,</p>",
        "id": 153868813,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1485192992
    },
    {
        "content": "<p>The base document profile would presumably enforce that the core composition references would be within the Bundle.  No need to use an invariant.  I'm not clear on whether references inside extensions on Composition must be in the bundle too.</p>",
        "id": 153868814,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1485193056
    },
    {
        "content": "<p>This might be me but I'm not reading that <a href=\"http://build.fhir.org/elementdefinition-definitions.html#ElementDefinition.type.aggregation\" target=\"_blank\" title=\"http://build.fhir.org/elementdefinition-definitions.html#ElementDefinition.type.aggregation\">http://build.fhir.org/elementdefinition-definitions.html#ElementDefinition.type.aggregation</a> is a recursive statement. I.e. it would control the current reference, but I do not read that if the referred resource in turn contains references, that these also shall be bundled. If that is the intention then a tracker item for clarification is in order</p>",
        "id": 153868838,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1485204118
    }
]