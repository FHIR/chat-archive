[
    {
        "content": "<p>Hi all, was working through parsing in different FHIR versions and had a question about URL resolution.  Specifically, since canonical URLs aren't versioned, how are people resolving them?  I did not see any hints on the <a href=\"http://hl7.org/fhir/versioning.html\" target=\"_blank\" title=\"http://hl7.org/fhir/versioning.html\">Versioning Guidance</a> page.</p>\n<p>So far, I have questions around two cases:</p>\n<p>1) Extension URLs, for example <code>1179-objectclass</code>.  The URL points to a StructureDefinition in the current (R4) version: <a href=\"https://www.hl7.org/fhir/extension-11179-objectclass.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/extension-11179-objectclass.html\">https://www.hl7.org/fhir/extension-11179-objectclass.html</a> , but if you want the DSTU2 version, you need to request <a href=\"https://www.hl7.org/fhir/DSTU2/extension-11179-objectclass.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/DSTU2/extension-11179-objectclass.html\">https://www.hl7.org/fhir/DSTU2/extension-11179-objectclass.html</a> .</p>\n<ul>\n<li>Is the general process that you should always inject the version into the URL?  A DSTU2 server would have worked as expected when DSTU2 was 'current', but would have stopped working when STU3 was published.</li>\n<li>I chose that particular example because it exists in many versions, and the definition is different between them - trying to parse the wrong version will either fail or cause some unexpected behaviors.</li>\n</ul>\n<p>2) Resource definition URLs, for example <code>Appointment</code>.  Looking at a conformance statement from a DSTU2 server, the URLs are styled <a href=\"http://hl7.org/fhir/profiles/Appointment\" target=\"_blank\" title=\"http://hl7.org/fhir/profiles/Appointment\">http://hl7.org/fhir/profiles/Appointment</a> - which no longer resolve.  The current style is <a href=\"http://hl7.org/fhir/StructureDefinition/Appointment\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Appointment\">http://hl7.org/fhir/StructureDefinition/Appointment</a>.  So again, if you need the DSTU2 version the URL you want is: <a href=\"http://hl7.org/fhir/DSTU2/StructureDefinition/Appointment\" target=\"_blank\" title=\"http://hl7.org/fhir/DSTU2/StructureDefinition/Appointment\">http://hl7.org/fhir/DSTU2/StructureDefinition/Appointment</a> .</p>\n<ul>\n<li>Are people just parsing and rebuilding those URLs to get the version they want?</li>\n<li>If so, does this mean that at some point everyone resolving DSTU2 URLs needed to change their code?</li>\n</ul>\n<p>Any thoughts / experiences / advice is welcome, thanks!</p>",
        "id": 189613557,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583255662
    },
    {
        "content": "<p>As a side-note, the <a href=\"http://hl7.org/fhir/versioning.html#mp-version\" target=\"_blank\" title=\"http://hl7.org/fhir/versioning.html#mp-version\">Versioning Guidance</a> you linked to says to use version numbers rather than release strings, e.g. '1.0' and not 'DSTU2'.  So your URL example for Appointment would look like <a href=\"http://hl7.org/fhir/1.0/StructureDefinition/Appointment\" target=\"_blank\" title=\"http://hl7.org/fhir/1.0/StructureDefinition/Appointment\">http://hl7.org/fhir/1.0/StructureDefinition/Appointment</a>.  The <a href=\"https://github.com/lhncbc/lforms\" target=\"_blank\" title=\"https://github.com/lhncbc/lforms\">LHC-Forms</a> Questionnaire widget uses that format in meta.profile when generating Questionnaires.</p>",
        "id": 189618954,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1583259354
    },
    {
        "content": "<p>I was thinking that maybe the \"right\" way to resolve these URLs is by downloading FHIR core conformance packages or looking things up in a registry. The conformance packages work okay for HL7-published content, but not so much for \"open world\" extensions. There, regsitries are the only approach I'm familiar with. But when I browse <a href=\"https://simplifier.net/ui/search/index?canonical=http://hl7.org/fhir/structuredefinition/11179-permitted-value-conceptmap\" target=\"_blank\" title=\"https://simplifier.net/ui/search/index?canonical=http://hl7.org/fhir/structuredefinition/11179-permitted-value-conceptmap\">https://simplifier.net/ui/search/index?canonical=http://hl7.org/fhir/structuredefinition/11179-permitted-value-conceptmap</a> I see dozens of copies of this extensions, all in different projects several of which look offical. Some match the published content, and some note exactly (for fields like <code>status</code> for example).</p>",
        "id": 189619033,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1583259382
    },
    {
        "content": "<p>Why / when would you want to resolve those as part of parsing? (and: other servers might have extension URL that do not resolve ... for example ours...)</p>",
        "id": 189619840,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1583259935
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span> .  Interesting that the HL7 server doesn't respect that guidance.</p>",
        "id": 189620054,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583260079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> , I am working on some code generation software for OpenAPI.  One of the options for configuration starts from a CapabilityStatement.</p>\n<p>For some items, the Josh process works (e.g., I have FHIR 4.0.2 downloaded and can look up the model for an <code>AllergyIntolerance</code>).  For 'official' extensions, this also works.  The system breaks down when there are external definition for anything, since I don't have a version reference to work from.  I figured it was easier to use the core specs as examples since they exhibit the same behavior.</p>\n<p>I think a lot of my confusion is trying to addressed versioned resources without versioned URLs, and I am looking for how it is being handled 'in the wild'.</p>",
        "id": 189621018,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583260664
    },
    {
        "content": "<p>In LHC-Forms, if someone does not provide a versioned URL in meta.profile, we try to guess the version based on the structure of the Questionnaire.  However, that guessing is not very good, and I think having a versioned URL in meta.profile should be considered necessary if you are going to send a resource to someone without the context of a FHIR server (which can tell you what version it is).</p>",
        "id": 189622709,
        "sender_full_name": "Paul Lynch",
        "timestamp": 1583261850
    },
    {
        "content": "<p>So that latter point is about how to tell what profiles are relevant for a given resource; but the <span class=\"user-mention\" data-user-id=\"222054\">@Gino Canessa</span> questions are mainly about how to <em>algorithmically resolve</em> a definition URL (extension or profile) when the URL is known.</p>",
        "id": 189623182,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1583262170
    },
    {
        "content": "<p>the canonical URL is not necessarily a literal URL reference. Josh is right that you should get the right package and resolve through that.</p>",
        "id": 189642083,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583274998
    },
    {
        "content": "<p>further, we have policy changes that mean that r2 is more broken than just in the versioning thing.</p>",
        "id": 189642133,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583275035
    },
    {
        "content": "<p>there are redirects for versions - .e.g <a href=\"http://hl7.org/fhir/3.0/StructureDefinition/Appointment\" target=\"_blank\" title=\"http://hl7.org/fhir/3.0/StructureDefinition/Appointment\">http://hl7.org/fhir/3.0/StructureDefinition/Appointment</a> should work, and the package hl7.fhir.xver.r4 includes structure definitions that have version specific URLs, though only the canonical itsellf</p>",
        "id": 189642238,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583275100
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> and <span class=\"user-mention\" data-user-id=\"195344\">@Paul Lynch</span>.  To make sure I have this right:</p>\n<ul>\n<li>for official definitions: download the correct versioned package and find the definition by matching URL</li>\n<li>for external definitions:<ul>\n<li>hope the <code>CapabilityStatement</code> has a versioned URL that resolves to a definition</li>\n<li>hope for a versioned URL in a resource <code>meta.profile</code></li>\n<li>hope the server has a definition available for whatever you are looking for (e.g., a <code>StructureDefinition</code> for an Extension)</li>\n</ul>\n</li>\n</ul>",
        "id": 189706969,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583338674
    },
    {
        "content": "<p>(And, to add to the \"external definitions\" bullet list:</p>\n<ul>\n<li>Gather versioned sets of all the definitions you can find for \"common\" stuff like US Core, possibly leaning on registries to help, and resolve URLs based on those when possible</li>\n</ul>\n<p>)</p>",
        "id": 189710609,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1583340775
    },
    {
        "content": "<p>and the place to start is <a href=\"http://packages.fhir.org\" target=\"_blank\" title=\"http://packages.fhir.org\">packages.fhir.org</a></p>",
        "id": 189726870,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583350717
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , I have been using <a href=\"http://hl7.org/fhir/&lt;releaseName&gt;/&lt;packageName&gt;.tgz\" target=\"_blank\" title=\"http://hl7.org/fhir/&lt;releaseName&gt;/&lt;packageName&gt;.tgz\">http://hl7.org/fhir/&lt;releaseName&gt;/&lt;packageName&gt;.tgz</a> (e.g., <a href=\"http://hl7.org/fhir/R4/hl7.fhir.r4.core.tgz\" target=\"_blank\" title=\"http://hl7.org/fhir/R4/hl7.fhir.r4.core.tgz\">http://hl7.org/fhir/R4/hl7.fhir.r4.core.tgz</a>) so far since the URLs are generic per release of FHIR.</p>\n<p>In trying to get the downloads from the packages site, I wasn't able to find a URL that worked without the full version (e.g., 4.0.2).  Is there one I didn't discover?</p>",
        "id": 189730337,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583352782
    },
    {
        "content": "<p>well, if you want to avoid knowing the full version in advance, you have to search for the versions available: <a href=\"http://packages.fhir.org/hl7.fhir.r4.core\" target=\"_blank\" title=\"http://packages.fhir.org/hl7.fhir.r4.core\">http://packages.fhir.org/hl7.fhir.r4.core</a></p>",
        "id": 189730648,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583352975
    },
    {
        "content": "<p>That's frustrating.  Will those other URLs continue to work, or will they disappear at some point?</p>",
        "id": 189730913,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583353165
    },
    {
        "content": "<p>For reference, I am using the definitions at runtime.  I don't want a dependency on NPM, nor do I particularly want to package all of the versions of FHIR at build-time.</p>",
        "id": 189731110,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583353285
    },
    {
        "content": "<p>The others will continue to work. It's probably easier and more reliable to hit the main website for the core packages if you only want the current ones</p>",
        "id": 189731302,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583353419
    },
    {
        "content": "<p>Nice!  Thanks!</p>",
        "id": 189731404,
        "sender_full_name": "Gino Canessa",
        "timestamp": 1583353460
    }
]