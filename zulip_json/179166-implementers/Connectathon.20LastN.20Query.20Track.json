[
    {
        "content": "<p>This is the chat stream for the <a href=\"http://wiki.hl7.org/index.php?title=201709_LastN_Query_Track\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=201709_LastN_Query_Track\">Connectathon LastN Query</a></p>",
        "id": 153905334,
        "sender_full_name": "Eric Haas",
        "timestamp": 1504981844
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  tried this ...   </p>\n<p><code>http://test.fhir.org/r3/Observation/$lastn?max=3&amp;patient=Patient/123&amp;category=vital-signs</code></p>\n<p>No response???</p>",
        "id": 153905336,
        "sender_full_name": "Eric Haas",
        "timestamp": 1504981907
    },
    {
        "content": "<p>I'll investigate</p>",
        "id": 153905344,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1504982744
    },
    {
        "content": "<p>the case is wrong to start with - lastN</p>",
        "id": 153905370,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1504984293
    },
    {
        "content": "<p>My server will allow lastn with patient (hard codes max to 5 right now), but requires oauth</p>",
        "id": 153905375,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504984372
    },
    {
        "content": "<p>Still working on removing that requirement :)</p>",
        "id": 153905376,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504984379
    },
    {
        "content": "<p>Initial DotNet implementation, restricted to only using loinc codes (all codes may be a challenge due to our server implementation which integrates multiple EMRs and carries the system codings as well).</p>\n<div class=\"codehilite\"><pre><span></span>    private IEnumerable&lt;Observation&gt; LastNLoincFilter(IEnumerable&lt;Observation&gt; obs, int max)\n    {\n        return obs.GroupBy(o =&gt; string.Join(&#39;|&#39;, (from c in o.Code.Coding where c.System.Equals(&quot;http://loinc.org&quot;) orderby c.Code select c.Code)))\n         .SelectMany(g =&gt; g.OrderByDescending(s =&gt; s.Effective.ToString()).\n                         Take(max));\n    }\n</pre></div>",
        "id": 153905379,
        "sender_full_name": "Brian Wright",
        "timestamp": 1504984615
    },
    {
        "content": "<p>My server example: <a href=\"https://fhir-open.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024\" target=\"_blank\" title=\"https://fhir-open.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024\">https://fhir-open.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024</a> (or <a href=\"https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024\" target=\"_blank\" title=\"https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024\">https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/Observation/$lastn?patient=1316024</a>)</p>",
        "id": 153905393,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504984978
    },
    {
        "content": "<p>sadly, both require auth. Register an app here for Cerner: <a href=\"https://code.cerner.com/developer/smart-on-fhir/\" target=\"_blank\" title=\"https://code.cerner.com/developer/smart-on-fhir/\">https://code.cerner.com/developer/smart-on-fhir/</a></p>",
        "id": 153905395,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504985037
    },
    {
        "content": "<p>And then let me know your client id and I can get it access to the staging servers above</p>",
        "id": 153905396,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504985054
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  the specification states <code>$lastn</code> still I'm getting an error like this when I use $lastN.  <br>\n<a href=\"/user_uploads/10155/nhrBtVjuuJFGdXFTo_j7qMdo/Screen-Shot-2017-09-09-at-12.31.43-PM.png\" target=\"_blank\" title=\"Screen-Shot-2017-09-09-at-12.31.43-PM.png\">Screen-Shot-2017-09-09-at-12.31.43-PM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/nhrBtVjuuJFGdXFTo_j7qMdo/Screen-Shot-2017-09-09-at-12.31.43-PM.png\" target=\"_blank\" title=\"Screen-Shot-2017-09-09-at-12.31.43-PM.png\"><img src=\"/user_uploads/10155/nhrBtVjuuJFGdXFTo_j7qMdo/Screen-Shot-2017-09-09-at-12.31.43-PM.png\"></a></div>",
        "id": 153905405,
        "sender_full_name": "Eric Haas",
        "timestamp": 1504985669
    },
    {
        "content": "<p>that's not an error</p>",
        "id": 153905414,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1504987046
    },
    {
        "content": "<p>that's just an empty outcome.</p>",
        "id": 153905415,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1504987110
    },
    {
        "content": "<p>agree that the spec says lastn - I will update it after 5pm tonight</p>",
        "id": 153905416,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1504987126
    },
    {
        "content": "<p>FYI - I have some TestScripts for $lastn deployed to Touchstone. I'd be interested in having them run against any server supporting that operation; i.e. I'd like to \"test the test\".</p>",
        "id": 153905443,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1504990045
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/B4ain7FQ-2XZhxTRHmAm1Zoi/FHIRConnectathon16Tests.png\" target=\"_blank\" title=\"FHIRConnectathon16Tests.png\">FHIRConnectathon16Tests.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/B4ain7FQ-2XZhxTRHmAm1Zoi/FHIRConnectathon16Tests.png\" target=\"_blank\" title=\"FHIRConnectathon16Tests.png\"><img src=\"/user_uploads/10155/B4ain7FQ-2XZhxTRHmAm1Zoi/FHIRConnectathon16Tests.png\"></a></div>",
        "id": 153905446,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1504990255
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191356\">@Jenni Syed</span>  I am getting the following trying to hit the lastN? endpoint you posted above:</p>",
        "id": 153905528,
        "sender_full_name": "Kevan Riley",
        "timestamp": 1504997669
    },
    {
        "content": "<p>&lt;h1&gt;Bad Request&lt;/h1&gt;<br>\n&lt;p&gt;Your browser sent a request that this server could not understand.&lt;br /&gt;</p>",
        "id": 153905529,
        "sender_full_name": "Kevan Riley",
        "timestamp": 1504997672
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191356\">@Jenni Syed</span> Update/correction, I am getting an unauthorized error (401), ignore the previous.</p>",
        "id": 153905537,
        "sender_full_name": "Kevan Riley",
        "timestamp": 1504997816
    },
    {
        "content": "<p>yeah :) you have to authenticate right now</p>",
        "id": 153905538,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504997832
    },
    {
        "content": "<p>For the next 15 minutes, this bearer token will work: Bearer eyJraWQiOiIyMDE3LTA5LTA5VDE5OjMzOjE3LjMzNi5lYyIsInR5cCI6IkpXVCIsImFsZyI6IkVTMjU2In0.eyJzdWIiOiJqdzY0OTkiLCJ1cm46Y29tOmNlcm5lcjphdXRob3JpemF0aW9uOmNsYWltcyI6eyJ2ZXIiOiIxLjAiLCJ0bnQiOiJhNzU4ZjgwZS1hYTc0LTQxMTgtODBhYS05OGNjNzU4NDZjNzYiLCJhenMiOiJ1c2VyXC9PYnNlcnZhdGlvbi5yZWFkIn0sImF6cCI6ImZoaXItbG9jYWwiLCJpc3MiOiJodHRwczpcL1wvYXV0aG9yaXphdGlvbi5zYW5kYm94Y2VybmVyLmNvbVwvIiwiZXhwIjoxNTA0OTk4NzM4LCJpYXQiOjE1MDQ5OTgxMzgsImp0aSI6ImVkNjgxMDNmLTM5YmMtNDg2Yy1iNWFiLTU1YmY2NmNiMjI5MyIsInVybjpjZXJuZXI6YXV0aG9yaXphdGlvbjpjbGFpbXM6dmVyc2lvbjoxIjp7InZlciI6IjEuMCIsInByb2ZpbGVzIjp7InNtYXJ0LXYxIjp7ImF6cyI6InVzZXJcL09ic2VydmF0aW9uLnJlYWQifX0sImNsaWVudCI6eyJuYW1lIjoiRkhJUiBMb2NhbCBUZXN0IENsaWVudCIsImlkIjoiZmhpci1sb2NhbCJ9LCJ1c2VyIjp7InByaW5jaXBhbCI6Imp3NjQ5OSIsInBlcnNvbmEiOiJwcm92aWRlciIsImlkc3AiOiJhNzU4ZjgwZS1hYTc0LTQxMTgtODBhYS05OGNjNzU4NDZjNzYiLCJwcmluY2lwYWxVcmkiOiJodHRwczpcL1wvbWlsbGVubmlhLnNhbmRib3hjZXJuZXIuY29tXC9pbnN0YW5jZVwvYTc1OGY4MGUtYWE3NC00MTE4LTgwYWEtOThjYzc1ODQ2Yzc2XC9wcmluY2lwYWxcLzAwMDAuMDAwMC4wMDE0LjE0QTciLCJpZHNwVXJpIjoiaHR0cHM6XC9cL21pbGxlbm5pYS5zYW5kYm94Y2VybmVyLmNvbVwvYWNjb3VudHNcL3N0Z2VuZy50ZW1wX3Joby5jZXJuZXJhc3AuY29tXC9hNzU4ZjgwZS1hYTc0LTQxMTgtODBhYS05OGNjNzU4NDZjNzZcL2xvZ2luIn0sInRlbmFudCI6ImE3NThmODBlLWFhNzQtNDExOC04MGFhLTk4Y2M3NTg0NmM3NiJ9fQ.LjmqfqW-OWqndPTKdLXaXAN2r_b1zJVplV-fSPEH2Zje4B8ZwdXjQv7hsgYxpO0sNoiRt2pCVa5JQSf9wHcxAQ</p>",
        "id": 153905546,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998164
    },
    {
        "content": "<p>For our server, to get tokens, you can use our demo app: <a href=\"https://authz-demo.sandboxcerner.com/client/demo\" target=\"_blank\" title=\"https://authz-demo.sandboxcerner.com/client/demo\">https://authz-demo.sandboxcerner.com/client/demo</a></p>",
        "id": 153905573,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998830
    },
    {
        "content": "<p>Use client id c4093c13-1ed1-47ef-95a6-a225d3e47023 if you don't have an app with a real redirect, leave redirect url empty</p>",
        "id": 153905574,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998858
    },
    {
        "content": "<p>the discovery step won't work, but the get access code and get access token should</p>",
        "id": 153905576,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998880
    },
    {
        "content": "<p>I can walk you through it if you have issues :) just let me know</p>",
        "id": 153905577,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998911
    },
    {
        "content": "<p>actually, discovery will work as long as you use this fhir server: <a href=\"https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/\" target=\"_blank\" title=\"https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/\">https://fhir-ehr.stagingcerner.com/stu3/a758f80e-aa74-4118-80aa-98cc75846c76/</a></p>",
        "id": 153905581,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1504998986
    },
    {
        "content": "<p>Spec test cases for local testing this morning:<br>\n<a href=\"http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs\" target=\"_blank\" title=\"http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs\">http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs</a><br>\n<a href=\"http://172.20.26.136:63532/fhir/Observation$lastn?patient=Patient/19300107&amp;category=laboratory\" target=\"_blank\" title=\"http://172.20.26.136:63532/fhir/Observation$lastn?patient=Patient/19300107&amp;category=laboratory\">http://172.20.26.136:63532/fhir/Observation$lastn?patient=Patient/19300107&amp;category=laboratory</a><br>\n<a href=\"http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs&amp;code=8302-2,29463-7\" target=\"_blank\" title=\"http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs&amp;code=8302-2,29463-7\">http://172.20.26.136:63532/fhir/Observation$lastn?max=3&amp;patient=Patient/19300100&amp;category=vital-signs&amp;code=8302-2,29463-7</a></p>\n<p>Extra credit - Diagnostic report<br>\n<a href=\"http://localhost:63532/fhir/DiagnosticReport$lastn?Patient=Patient/19300111&amp;max=1\" target=\"_blank\" title=\"http://localhost:63532/fhir/DiagnosticReport$lastn?Patient=Patient/19300111&amp;max=1\">http://localhost:63532/fhir/DiagnosticReport$lastn?Patient=Patient/19300111&amp;max=1</a></p>",
        "id": 153905863,
        "sender_full_name": "Brian Wright",
        "timestamp": 1505064031
    },
    {
        "content": "<p>Some takeaways from connectathon:</p>\n<p>Was not able to test on local network.  Will plan on hosting on cloud in future for access from test tools and other users.</p>\n<p>Used synthetic data from Mitre Synthea for test cases.</p>\n<p>Adding lastn as filter in fhir layer was effective, but in my mind anyway, disallows use of paging.  However, during discussions the use of lastn was planned to be limited to queries including patient/subject, so paging not usually necessary, but implies possibly processing large amounts of data on server.</p>\n<p>My implementation was limited to specifying a single code system.  For out environment, where we are integrating data from multiple systems, and carry source code systems as well as standard codes, this works will, but need to think about other multi-code systems use cases and whether this is generally appropriate.</p>",
        "id": 153905941,
        "sender_full_name": "Brian Wright",
        "timestamp": 1505069579
    },
    {
        "content": "<p>re: testing on local network: We used ngrok (<a href=\"https://ngrok.com/\" target=\"_blank\" title=\"https://ngrok.com/\">https://ngrok.com/</a> ) to avoid having to deploy anything. It gives you internet-facing url and tunnels it to localhost.</p>",
        "id": 153905951,
        "sender_full_name": "Nick Hatt",
        "timestamp": 1505070296
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153906616,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1505176756
    }
]