[
    {
        "content": "<p>I'm following the examples here <a href=\"https://www.hl7.org/fhir/profiling-examples.html#extensions\" target=\"_blank\" title=\"https://www.hl7.org/fhir/profiling-examples.html#extensions\">https://www.hl7.org/fhir/profiling-examples.html#extensions</a> to define slices for different extension.<br>\nHowever, when I run this through the ig publisher, with some example resources, the example resources are throwing warnings saying \"Profile <a href=\"http://hl7.org/fhir/ccda/StructureDefinition/CCDA-on-FHIR-Consultation-Note\" target=\"_blank\" title=\"http://hl7.org/fhir/ccda/StructureDefinition/CCDA-on-FHIR-Consultation-Note\">http://hl7.org/fhir/ccda/StructureDefinition/CCDA-on-FHIR-Consultation-Note</a>, Element matches more than one slice\" for each of the extensions in the example.</p>",
        "id": 153886825,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493832761
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/gvQHbCgL0P9FbI2OZ7V266Px/CCDA-on-FHIR-Referral-Note.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note.xml\">CCDA-on-FHIR-Referral-Note.xml</a><br>\n<a href=\"/user_uploads/10155/jOi7X7OqLTV13Z-x96WiJCor/CCDA-on-FHIR-US-Realm-Header.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-US-Realm-Header.xml\">CCDA-on-FHIR-US-Realm-Header.xml</a><br>\n<a href=\"/user_uploads/10155/fo1xy1Tfzqc_EuKjtQz8BWc2/CCDA-on-FHIR-Referral-Note-Example.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note-Example.xml\">CCDA-on-FHIR-Referral-Note-Example.xml</a></p>",
        "id": 153886826,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493832790
    },
    {
        "content": "<p>attached is the strucdef for referral note and its base profile us-realm-header, as well as the example instance it is failing on. can someone take a look and tell me what I'm doing wrong?</p>",
        "id": 153886827,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493832863
    },
    {
        "content": "<p>the extensions are defined in the base us-realm-header profile</p>",
        "id": 153886828,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493832876
    },
    {
        "content": "<p>First, make sure you're using the absolute latest version of the IGPublisher (from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a>) as several corrections have been made recently.</p>",
        "id": 153886877,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1493842658
    },
    {
        "content": "<p>so I shouldn't be using the ig publisher packaged with stu3?</p>",
        "id": 153886878,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493843393
    },
    {
        "content": "<p>seems like the stu3 should be updated (as though it were errata) with these kinds of important changes</p>",
        "id": 153886879,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493843420
    },
    {
        "content": "<p>just downloaded and ran with latest version of ig publisher</p>",
        "id": 153886880,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493843737
    },
    {
        "content": "<p>getting same errors</p>",
        "id": 153886881,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493843739
    },
    {
        "content": "<p>Ok.  I'll have a fix that should go in this weekend that will at least tell you which slices it's finding a match against that are a problem</p>",
        "id": 153886883,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1493843816
    },
    {
        "content": "<p>how about a screenshot of the spreadsheet to see how is defined.  </p>",
        "id": 153886884,
        "sender_full_name": "Eric Haas",
        "timestamp": 1493843838
    },
    {
        "content": "<p>and a screenshot of the CD snippet of interest</p>",
        "id": 153886885,
        "sender_full_name": "Eric Haas",
        "timestamp": 1493843864
    },
    {
        "content": "<p>I find inspection of the SD usually helps ferret out the issue</p>",
        "id": 153886886,
        "sender_full_name": "Eric Haas",
        "timestamp": 1493843898
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/OhTSphN9t6q22uDUpgh8OuvW/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/OhTSphN9t6q22uDUpgh8OuvW/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/OhTSphN9t6q22uDUpgh8OuvW/pasted_image.png\"></a></div>",
        "id": 153886887,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493844907
    },
    {
        "content": "<p>interesting... it doesn't show anything about the profile that those extensions are for</p>",
        "id": 153886888,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493844934
    },
    {
        "content": "<p>I didn't see a problem either except the error is for  <code>http://hl7.org/fhir/ccda/StructureDefinition/CCDA-on-FHIR-Consultation-Note</code>  and the example's declared profile is <code>http://hl7.org/fhir/ccda/StructureDefinition/CCDA-on-FHIR-Referral-Note</code>   ..so the error must lie there</p>",
        "id": 153886912,
        "sender_full_name": "Eric Haas",
        "timestamp": 1493865360
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span> sorry that was a copy/paste error. I'm getting the same error for ALL Composition.section slices across all of C-CDA on FHIR's composition profiles.</p>",
        "id": 153886933,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493873264
    },
    {
        "content": "<p>which makes the list of errors quite large...</p>",
        "id": 153886934,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493873286
    },
    {
        "content": "<p>but, if I can figure out why it is producing that error, then I can eliminate a TON of those errors with one code-fix</p>",
        "id": 153886935,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493873320
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, you mind taking a look at this thread when you get a sec, please?</p>",
        "id": 153886936,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493873341
    },
    {
        "content": "<p>maybe you'll see something...</p>",
        "id": 153886937,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1493873355
    },
    {
        "content": "<p>Could still use a hand here if someone wouldn't mind... just not figuring out why these slices aren't working</p>",
        "id": 153887313,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494003240
    },
    {
        "content": "<p>The discriminator should be expressed relative to the element being sliced.  So, for example, when Slicing Composition.section, the discriminator is \"code\", not \"Composition.section.code\"</p>",
        "id": 153887340,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494011646
    },
    {
        "content": "<p>See if that helps and if not, I'll dig deeper</p>",
        "id": 153887342,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494011672
    },
    {
        "content": "<p>(And sorry for taking so long to take a quick glance at your instances :()</p>",
        "id": 153887343,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494011689
    },
    {
        "content": "<p>oh man, that's it?!</p>",
        "id": 153887344,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494011725
    },
    {
        "content": "<p>awesome find, if so!</p>",
        "id": 153887345,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494011734
    },
    {
        "content": "<p>Unfortunately it's still showing the same errors</p>",
        "id": 153887356,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013293
    },
    {
        "content": "<p>Instance: <a href=\"/user_uploads/10155/34-_8ebGUUP1eKPXf0eaWjjI/CCDA-on-FHIR-Referral-Note-Example.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note-Example.xml\">CCDA-on-FHIR-Referral-Note-Example.xml</a> </p>",
        "id": 153887357,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013399
    },
    {
        "content": "<p>StructureDefinition: <a href=\"/user_uploads/10155/JhBBWIRhB9fs8kKsxgwB0NF-/CCDA-on-FHIR-Referral-Note.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note.xml\">CCDA-on-FHIR-Referral-Note.xml</a> </p>",
        "id": 153887358,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013415
    },
    {
        "content": "<p>Errors: <a href=\"/user_uploads/10155/YISYoFQK2v4156uD2Bugw3A2/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/YISYoFQK2v4156uD2Bugw3A2/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/YISYoFQK2v4156uD2Bugw3A2/pasted_image.png\"></a></div>",
        "id": 153887359,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013444
    },
    {
        "content": "<p>Hmmm.  You're slicing via pattern.  That's supposed to work, but I've never tested it.  I usually specify code.coding.system and code.coding.code as dual discriminators and assign fixed values.  It's possible pattern slicing doesn't work yet.</p>",
        "id": 153887360,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494013670
    },
    {
        "content": "<p>Well, we <em>could</em> fix the code</p>",
        "id": 153887361,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013705
    },
    {
        "content": "<p>but, I think we did <em>want</em> to leave it open to pattern</p>",
        "id": 153887362,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494013714
    },
    {
        "content": "<p>I understand exactly why you're doing what you're doing.  It just may be that you're treading in unexplored territory</p>",
        "id": 153887366,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494013933
    },
    {
        "content": "<p>So, how do we go about getting the ig publisher updated to support pattern-based slices?</p>",
        "id": 153887372,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494014141
    },
    {
        "content": "<p>:)</p>",
        "id": 153887373,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494014142
    },
    {
        "content": "<p>Well, at the moment, it means writing code to turn a pattern into a FHIRPath expression, which is not an easy thing to do.  My guess is we'll just handle the obvious one of Coding with code + system and throw an exception when we see anything else.  I may have time to do that tomorrow.</p>",
        "id": 153887375,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494015762
    },
    {
        "content": "<p>Note that when I change them to \"fixedCodeableConcept\" I get the following error:<br>\n\"Unsupported fixed value type for discriminator(code) for slice\"</p>",
        "id": 153888507,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494258682
    },
    {
        "content": "<p>actually... that message is a warning.<br>\nand then I still get \"Element matches more than one slice\" as an error a bunch of times.</p>",
        "id": 153888509,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1494258716
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> or <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <br>\nWere either of you ever able to take a look at this? Still not sure if this is a limitation of the IG Publisher (or validation logic used by the publisher) or if it is something I am doing wrong with the samples...</p>",
        "id": 153890991,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1495568013
    },
    {
        "content": "<p>You won't be able to use a fixed codeable concept.  You'll need to do a fixed system and a fixed code.  (and use both as discriminators)</p>",
        "id": 153890994,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1495568971
    },
    {
        "content": "<p>Would be better to get pattern-based slices working in the IG publisher. Lloyd, is this restricted to the IG publisher code, or do you think this is something deeper? If just in the IG publisher I'm happy to take a look early next week and try fixing the bug. </p>",
        "id": 153891202,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1495655942
    },
    {
        "content": "<p>Basically I worry that we are restricting what can be legally expressed in profiles to what we currently support in the IG publisher. </p>",
        "id": 153891203,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1495656416
    },
    {
        "content": "<p>It's not the publisher, but the validator (which is used by the publisher as well as stand-alone)</p>",
        "id": 153891220,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1495659689
    },
    {
        "content": "<p>If you want to take a stab at it <span class=\"user-mention\" data-user-id=\"191407\">@Rick Geimer</span>, you're most welcome.  I apologize for not getting to it yet.  And realisticly, I won't have bandwidth to look at it for at least another couple of weeks.</p>",
        "id": 153891222,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1495659757
    },
    {
        "content": "<p>Thanks, I'll work with Sean and take a look next week. Worst case will fall back to fixed system and fixed code per your suggestion. </p>",
        "id": 153891241,
        "sender_full_name": "Rick Geimer",
        "timestamp": 1495663877
    },
    {
        "content": "<p>I can have a look on Monday - need to do a run of validator stuff. </p>",
        "id": 153891259,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1495682097
    },
    {
        "content": "<p>I think I found the section of the InstanceValidator that needs to be improved to support fixedCodeableConcept and patternCodeableConcept... and Coding:<br>\n<a href=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java\" target=\"_blank\" title=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java\">https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java</a><br>\nLine #3478<br>\nprivate boolean valueMatchesCriteria(Element value, ElementDefinition criteria) throws FHIRException { ... }</p>",
        "id": 153891663,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496167430
    },
    {
        "content": "<p>can you turn this into a test case ?- that is: a structure definition, and an instance that fails and one that succeeds</p>",
        "id": 153891671,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496170002
    },
    {
        "content": "<p>well, I have examples of SD's that should succeed... how do you want me to modify it so that it fails? (it is already failing)</p>",
        "id": 153891672,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496170675
    },
    {
        "content": "<p>an instance that fails, not a SD that fails</p>",
        "id": 153891674,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496170790
    },
    {
        "content": "<p>e.g. that is not valid against the SD</p>",
        "id": 153891675,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496170801
    },
    {
        "content": "<p>Oh gotcha.. Yes, I will get those created and attach them here</p>",
        "id": 153891678,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496170842
    },
    {
        "content": "<p>thanks</p>",
        "id": 153891681,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496170961
    },
    {
        "content": "<p>Structure Definition: <a href=\"/user_uploads/10155/pTOZ7Nn_gs8XmdreMOvvoTYo/CCDA-on-FHIR-Referral-Note-orig.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note-orig.xml\">CCDA-on-FHIR-Referral-Note-orig.xml</a> <br>\nUses patternCodeableConcept for Composition.section.code, discriminates on Composition.section.code</p>",
        "id": 153891684,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171924
    },
    {
        "content": "<p>Bad example: <a href=\"/user_uploads/10155/PmANkG2uMWv-ZJoEIDIBizXo/CCDA-on-FHIR-Referral-Note-Example-bad.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note-Example-bad.xml\">CCDA-on-FHIR-Referral-Note-Example-bad.xml</a></p>",
        "id": 153891685,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171937
    },
    {
        "content": "<p>Good example: <a href=\"/user_uploads/10155/HGjef9ZNq3YqbqkLiNHQB_vn/CCDA-on-FHIR-Referral-Note-Example.xml\" target=\"_blank\" title=\"CCDA-on-FHIR-Referral-Note-Example.xml\">CCDA-on-FHIR-Referral-Note-Example.xml</a> </p>",
        "id": 153891686,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171963
    },
    {
        "content": "<p>the bad example duplicates one of the section, when it should be 1..1</p>",
        "id": 153891687,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171976
    },
    {
        "content": "<p>and it also has an improper code for one of the sections</p>",
        "id": 153891688,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171984
    },
    {
        "content": "<p>that section should not be matched to any slices</p>",
        "id": 153891689,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496171996
    },
    {
        "content": "<p>Is this what you were looking for <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 153891839,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496265507
    },
    {
        "content": "<p>probably - got distracted and haven't got to it yet. hopefully today</p>",
        "id": 153891861,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496273706
    },
    {
        "content": "<p>Did you ever get to this <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 153892554,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496778026
    },
    {
        "content": "<p>so I've spent about 8 hours on this now. Lloyd, umm, 'improved' the validator with the upshot that it's been ignoring profiles altogther </p>",
        "id": 153892656,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496838858
    },
    {
        "content": "<p>now I have figured that out, and also figured out your canonical url mismatch ('_' vs '-')</p>",
        "id": 153892657,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496838897
    },
    {
        "content": "<p>I'm finally debugging the actual slice code at last</p>",
        "id": 153892658,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496838909
    },
    {
        "content": "<p>well, good to hear there is progress (I think?) :)</p>",
        "id": 153892688,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496855506
    },
    {
        "content": "<p>sounds frustrating, though...</p>",
        "id": 153892689,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496855513
    },
    {
        "content": "<p>and yes, there have been problems with _ vs. - cause at one point the ig publisher wasn't handling dashes very well, so we converted them to underscores. Been a mess since then. trying to normalize them all now.</p>",
        "id": 153892690,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1496855576
    },
    {
        "content": "<p>I'm pretty sure it wasn't ignoring all profiles, but appologize for contributing to the problem.</p>",
        "id": 153892695,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1496857443
    },
    {
        "content": "<p>ok I just committed an update to the validator. <span class=\"user-mention\" data-user-id=\"191505\">@Sean McIlvenna</span>, the validator says that your example good resources is missing some required slices. I haven't had a chance to check that yet - can you have a look at that? </p>",
        "id": 153892738,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496868672
    },
    {
        "content": "<p>I'll be back on it in a few hours time</p>",
        "id": 153892739,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496868680
    },
    {
        "content": "<p>this i swrong:</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;element id=&quot;111256&quot;&gt;\n            &lt;path value=&quot;Composition.section.title&quot;/&gt;\n            &lt;sliceName value=&quot;section_slice_pos2&quot;/&gt;\n            &lt;short value=&quot;title&quot;/&gt;\n            &lt;definition value=&quot;SHALL contain exactly one [1..1] title (CONF:2219-2079).&quot;/&gt;\n            &lt;min value=&quot;1&quot;/&gt;\n            &lt;max value=&quot;1&quot;/&gt;\n        &lt;/element&gt;\n</pre></div>",
        "id": 153892764,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496873073
    },
    {
        "content": "<p>don't repeat the slice name on the parts of the slice, just on the first entry</p>",
        "id": 153892765,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496873084
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153892766,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496873113
    },
    {
        "content": "<p>And you're still using the wrong system URL for LOINC</p>",
        "id": 153892767,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496873426
    },
    {
        "content": "<p>and also, pattern is case sensitive. are you sure you want to specify the display in the pattern?</p>",
        "id": 153892768,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496874179
    },
    {
        "content": "<p>ok, all fixed. You should compare what I ended up with (ccda*.xml in build\\tests\\validation-examples) with what you gave me - will show the minimum changes I had to make to get the tests working.</p>",
        "id": 153892769,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1496874814
    }
]