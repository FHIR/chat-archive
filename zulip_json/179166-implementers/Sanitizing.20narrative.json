[
    {
        "content": "<p>FHIR spec says .narrative.div should be sanitized for html injection.  From users of aidbox we learned this server behaviour is confusing people by modifying original content; different systems want different sanitization rules; we have problems with digital signatures. From design point of view doing sanitization right in place you inject foriegn html is better.  Should i create an issue to discuss removal of this feature :)?</p>",
        "id": 178532256,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1571466934
    },
    {
        "content": "<p>I think sanitization just means you need to apply the schema rules - no buttons, scripts or other elements that contain active content.  If you're doing signatures, the digital signature algorithm should handle the rest</p>",
        "id": 178541814,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1571484283
    },
    {
        "content": "<p>I'm not sure - can you describe the specific changes that are needed and why they are confusing?</p>",
        "id": 178542391,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571485148
    },
    {
        "content": "<p>and which section exactly you are quoting?</p>",
        "id": 178542394,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571485164
    },
    {
        "content": "<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>",
        "id": 178569754,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1571531593
    },
    {
        "content": "<p>The reason we left it vague is because the things hackers learn change over time. If we said simply \"do not allow javascript\", which is all we cared about originally, then we would not be recognizing that cyber-security is a risk-mitigation art that changes as the attacks change.</p>",
        "id": 178652106,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571662793
    },
    {
        "content": "<p>However, any sanitization would indeed break a signature that existed on the 'un-sanitized' input. This is predictable. So, one should create a new version of the resource that has been sanitized, create a Provenance indicating the sanitization activity, and in that new Provenance include a new signature with linkage to the previous signature to show that the sanitization activity is verifiability linked to the unsanitized data.</p>",
        "id": 178652344,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571662925
    },
    {
        "content": "<blockquote>\n<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>\n</blockquote>\n<p>Good point, the sanitization activity was originally envisioned on an initial Create action; so that was also our simple world back then.</p>",
        "id": 178652503,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571663059
    },
    {
        "content": "<blockquote>\n<p>Could we suggest that there be 2 outcomes here then, a failure or correction. If the save detects active content return validation error rather than stripping it.</p>\n</blockquote>\n<p>A validation error is better than original content modification!</p>",
        "id": 178655123,
        "sender_full_name": "nicola (RIO/SS)",
        "timestamp": 1571665013
    },
    {
        "content": "<p>and an OperationOutcome can express the reason is due to unsafe content in the text html...</p>",
        "id": 178659298,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571667563
    },
    {
        "content": "<p>but if you MUST import,  then you need to make the content safe... which is where I recommended a version with safe content and a Provenance indicating the reason for change with signature linkage to the original signature</p>",
        "id": 178659747,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571667785
    },
    {
        "content": "<p>Nicola, I know of the content on sanitizing on the security page... <a href=\"http://build.fhir.org/security.html#narrative\" target=\"_blank\" title=\"http://build.fhir.org/security.html#narrative\">http://build.fhir.org/security.html#narrative</a>  <br>\nIt is very specific, and would not include further removal of content that is simply not  valid FHIR xhtml.</p>",
        "id": 178664313,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571670543
    },
    {
        "content": "<blockquote>\n<p>A validation error is better than original content modification!</p>\n</blockquote>\n<p>I am not aware of any text in the specification that suggests that content modification is a good or necessary thing</p>",
        "id": 178668510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571673047
    },
    {
        "content": "<p>That is why I pointed out the only place I know of which is the security narrative page. Which I think implies validation-error... but could be said more blunt if that helps</p>",
        "id": 178668608,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571673111
    },
    {
        "content": "<p>So let's say the content is sanitized and passes validation for the CREATE. What happens when the threat landscape shifts and the (possibly signed) and stored content is no longer safe?</p>",
        "id": 178815495,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1571794451
    },
    {
        "content": "<p>find those resources with bad narrative, and deal with them. Likely revising them, and keeping a Provenance record to the policy change</p>",
        "id": 178881991,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571855186
    },
    {
        "content": "<p>this is not likely to be needed, as the narrative is already highly constrained. but, never say never.</p>",
        "id": 178882094,
        "sender_full_name": "John Moehrke",
        "timestamp": 1571855270
    },
    {
        "content": "<blockquote>\n<p>I am not aware of any text in the specification that suggests that content modification is a good or necessary thing</p>\n</blockquote>\n<p><a href=\"https://www.hl7.org/fhir/updates.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/updates.html\">https://www.hl7.org/fhir/updates.html</a> ?</p>\n<p>In particular <a href=\"https://www.hl7.org/fhir/updates.html#7.14\" target=\"_blank\" title=\"https://www.hl7.org/fhir/updates.html#7.14\">https://www.hl7.org/fhir/updates.html#7.14</a></p>\n<blockquote>\n<p>Without any other agreement between exchange partners, FHIR systems are not obligated to store and return data as it was received.</p>\n</blockquote>\n<p>and <a href=\"https://www.hl7.org/fhir/updates.html#7.14.7\" target=\"_blank\" title=\"https://www.hl7.org/fhir/updates.html#7.14.7\">https://www.hl7.org/fhir/updates.html#7.14.7</a></p>\n<blockquote>\n<p>The SUBSETTED Security Label can be used to flag data that has had information removed.</p>\n</blockquote>",
        "id": 178903781,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1571870596
    },
    {
        "content": "<p>those suggest that it's a possible thing, and is in general no different to any content in a resource. I don't believe that these provide any reason to think that narrative modification is a good or necessary thing</p>",
        "id": 178904657,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1571871361
    }
]