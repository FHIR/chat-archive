[
    {
        "content": "<p>I ave just run into a problem applying dispositions. <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17336\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17336\">GF#17336</a> say that we'll add an example of how to reference from narrative to data in another resource. So I thought that I'd add an example of how to reference inside the same resource first... and I can't</p>",
        "id": 153980721,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180199
    },
    {
        "content": "<p>what we say is:</p>\n<blockquote>\n<p>References between the narrative and the resource data (in either direction) are mediated by the XML id/idref attributes.</p>\n</blockquote>",
        "id": 153980722,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180229
    },
    {
        "content": "<p>... but the problem is, there is no suitable attribute anywhere for the idref.</p>",
        "id": 153980729,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180325
    },
    {
        "content": "<p>I had thought that it would be </p>\n<div class=\"codehilite\"><pre><span></span>&lt;table&gt;&lt;tr idref=&quot;#link/&gt;&lt;td&gt;row content....\n</pre></div>",
        "id": 153980730,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180363
    },
    {
        "content": "<p>but it's not.</p>",
        "id": 153980731,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180365
    },
    {
        "content": "<p>The only option I've come up with so far is :</p>",
        "id": 153980732,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180384
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>&lt;td&gt;&lt;a rel=&quot;related&quot; href=&quot;#link&quot;&gt;text content&lt;/a&gt;&lt;/td&gt;\n</pre></div>",
        "id": 153980736,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180735
    },
    {
        "content": "<p>and I'm not finding that at all convincing for several reasons</p>",
        "id": 153980737,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180745
    },
    {
        "content": "<ul>\n<li>I don't know if it's legal to use href like that</li>\n<li>I don't know if 'related' is a valid attribute value in this context</li>\n<li>I expect that it will be rendered as a link which isn't what is desired</li>\n</ul>",
        "id": 153980744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180787
    },
    {
        "content": "<p>and you can't put this on any element</p>",
        "id": 153980745,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533180798
    },
    {
        "content": "<p>so... that's a problem.</p>",
        "id": 153980747,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533181099
    },
    {
        "content": "<p>Can we do the reverse?  Put ids in the xhtml and then use an extension on elements to point to them?</p>",
        "id": 153980748,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533181313
    },
    {
        "content": "<p>it's.. possible....</p>",
        "id": 153980751,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533181735
    },
    {
        "content": "<p>Do we have an issue with 'id' being required to be unique across a full instance - including across resources inside a Bundle?</p>",
        "id": 153980752,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533181924
    },
    {
        "content": "<p>well, not across resources inside a bundle. but if you flip the references over, ids might be a probelm</p>",
        "id": 153980761,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533182092
    },
    {
        "content": "<p><code>IDREF</code> is an XML datatype; as far as I am aware, the HTML spec does not define a default attribute of type IDREF. However the FHIR spec could introduce a custom data-* attribute of type IDREF, e.g. <code>data-fhir-elemdef</code>. That would allow a narrative HTML fragment to specify symbolic links to element definitions in the containing StructureDefinition.<br>\nAccording to W3C, for an XML document to be valid, all IDREF values <em>must</em> uniquely resolve to a target element in the same document:<br>\n<a href=\"https://www.w3.org/TR/xmlschema11-2/#IDREF\" target=\"_blank\" title=\"https://www.w3.org/TR/xmlschema11-2/#IDREF\">https://www.w3.org/TR/xmlschema11-2/#IDREF</a><br>\n<a href=\"https://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/structures.html#cvc-id\" target=\"_blank\" title=\"https://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/structures.html#cvc-id\">https://www.w3.org/TR/2012/REC-xmlschema11-1-20120405/structures.html#cvc-id</a><br>\nThis implies that an IDREF attribute value cannot link to an element in an <em>external</em> StructureDef. Also, a Bundle containing valid stand-alone StructureDefs is not guaranteed to be a valid XML document, because of possible duplicate element ID values. However this seems a minor concern, considering that FHIR already allows differential &amp; snapshot components to introduce duplicate id values within a StructureDefinition.</p>",
        "id": 153980864,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1533201232
    },
    {
        "content": "<p>but I don't think we can introduce our own attribute in the xhtml</p>",
        "id": 153980886,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533212040
    },
    {
        "content": "<p>Not and be valid against the schema.  And I suspect other tools would choke too.</p>",
        "id": 153980942,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533218753
    },
    {
        "content": "<p><code>data-</code> attributes are designed to safely store custom data and are ignored by any user agent. Indeed, XML Schema is not sufficiently expressive  to allow any data-* attribute, but we could extend the schema to allow one or more concrete fhir-specific data attributes.</p>",
        "id": 153980953,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1533220231
    },
    {
        "content": "<p>well, we do not at any time explain what version of XHTML we are using, but it's really xhtml 1.0</p>",
        "id": 153981029,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533236047
    },
    {
        "content": "<p>since all the (x)HTML 5 changes were active content we ban anyway, it has not mattered</p>",
        "id": 153981030,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533236067
    },
    {
        "content": "<p>One benefit of pointing from FHIR item to text rather than the reverse is it removes a reason to have an element with a bare id (where the narrative points to the element and provides the content).  If the element contains an extension pointing to an id in the narrative, that would be more clear.  And we could then prohibit elements with just an id.</p>",
        "id": 153982837,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533596844
    },
    {
        "content": "<p>so the question here is references in either direction. I'm not sure what that would look like.</p>",
        "id": 153982838,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533596892
    },
    {
        "content": "<p>&lt;Observation xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\" xmlns:xsi=\"<a href=\"http://www.w3.org/2001/XMLSchema-instance\" target=\"_blank\" title=\"http://www.w3.org/2001/XMLSchema-instance\">http://www.w3.org/2001/XMLSchema-instance</a>\" xsi:schemaLocation=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a> ../../schema/fhir-single.xsd\"&gt;<br>\n    &lt;id value=\"blood-pressure\"/&gt;<br>\n    &lt;text&gt;<br>\n    &lt;status value=\"generated\"/&gt;<br>\n    &lt;div xmlns=\"<a href=\"http://www.w3.org/1999/xhtml\" target=\"_blank\" title=\"http://www.w3.org/1999/xhtml\">http://www.w3.org/1999/xhtml</a>\"&gt;<br>\n      &lt;table&gt;<br>\n        &lt;tbody&gt;<br>\n          &lt;tr&gt;<br>\n            &lt;th&gt;Systolic&lt;/th&gt;<br>\n            &lt;td id=\"systolic\"&gt;107 mmHg&lt;/td&gt;<br>\n          &lt;/tr&gt;<br>\n          &lt;tr&gt;<br>\n            &lt;th&gt;Diastolic&lt;/th&gt;<br>\n            &lt;td id=\"diastolic\"&gt;60 mmHg&lt;/td&gt;<br>\n          &lt;/tr&gt;<br>\n        &lt;/tbody&gt;<br>\n      &lt;/table&gt;<br>\n    &lt;/div&gt;<br>\n  &lt;/text&gt;<br>\n    &lt;status value=\"final\"/&gt;<br>\n    &lt;code&gt;<br>\n        &lt;coding&gt;<br>\n            &lt;system value=\"http://loinc.org\"/&gt;<br>\n            &lt;code value=\"85354-9\"/&gt;<br>\n        &lt;/coding&gt;<br>\n    &lt;/code&gt;<br>\n    &lt;subject&gt;<br>\n        &lt;reference value=\"Patient/example\"/&gt;<br>\n    &lt;/subject&gt;<br>\n    &lt;effectiveDateTime value=\"2012-09-17\"/&gt;<br>\n    &lt;component&gt;<br>\n        &lt;code&gt;<br>\n            &lt;coding&gt;<br>\n                &lt;system value=\"http://loinc.org\"/&gt;<br>\n                &lt;code value=\"8480-6\"/&gt;<br>\n            &lt;/coding&gt;<br>\n        &lt;/code&gt;<br>\n        &lt;valueQuantity&gt;<br>\n      &lt;extension url=\"<a href=\"http://hl7.org/fhir/narrativeId\" target=\"_blank\" title=\"http://hl7.org/fhir/narrativeId\">http://hl7.org/fhir/narrativeId</a>\"&gt;<br>\n        &lt;valueString value=\"systolic\"<br>\n      &lt;/extension&gt;<br>\n            &lt;value value=\"107\"/&gt;<br>\n            &lt;unit value=\"mmHg\"/&gt;<br>\n            &lt;system value=\"http://unitsofmeasure.org\"/&gt;<br>\n            &lt;code value=\"mm[Hg]\"/&gt;<br>\n        &lt;/valueQuantity&gt;<br>\n    &lt;/component&gt;<br>\n    &lt;component&gt;<br>\n        &lt;code&gt;<br>\n            &lt;coding&gt;<br>\n                &lt;system value=\"http://loinc.org\"/&gt;<br>\n                &lt;code value=\"8462-4\"/&gt;<br>\n            &lt;/coding&gt;<br>\n        &lt;/code&gt;<br>\n        &lt;valueQuantity&gt;<br>\n      &lt;extension url=\"<a href=\"http://hl7.org/fhir/narrativeId\" target=\"_blank\" title=\"http://hl7.org/fhir/narrativeId\">http://hl7.org/fhir/narrativeId</a>\"&gt;<br>\n        &lt;valueString value=\"diastolic\"<br>\n      &lt;/extension&gt;<br>\n            &lt;value value=\"60\"/&gt;<br>\n            &lt;unit value=\"mmHg\"/&gt;<br>\n            &lt;system value=\"http://unitsofmeasure.org\"/&gt;<br>\n            &lt;code value=\"mm[Hg]\"/&gt;<br>\n        &lt;/valueQuantity&gt;<br>\n    &lt;/component&gt;<br>\n&lt;/Observation&gt;</p>",
        "id": 153982852,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533598575
    },
    {
        "content": "<p>Only question mark with this approach is whether having 'id' attributes in the narrative is going to cause grief for resources in Bundles due to XML's uniqueness expectation.</p>",
        "id": 153982856,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533598894
    },
    {
        "content": "<p>we sorted that a long time ago: idsa re not defined as xml:id because the uniqueness scope is the resource, not the xml document</p>",
        "id": 153982858,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533599292
    },
    {
        "content": "<p>Yes but these would be id attributes defined by xhtml</p>",
        "id": 153982871,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533601467
    },
    {
        "content": "<p>Do we have the same power to define behavior there?</p>",
        "id": 153982872,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533601476
    },
    {
        "content": "<p>well, sort of.... I'd have to hack that bit of the xhtml schema. but we already have a hacked xhtml schema</p>",
        "id": 153982881,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533601795
    },
    {
        "content": "<p>If we were willing to do that, I don't see any other downsides.</p>",
        "id": 153982893,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533602413
    },
    {
        "content": "<p>well, if we're going to have ids in xhtml, then it's an issue whatever....</p>",
        "id": 153982894,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533602477
    },
    {
        "content": "<p>I'm not following</p>",
        "id": 153982919,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533603678
    },
    {
        "content": "<p>if we're going to allow xhtml to have ids - which we do - then id uniquess is an issue with regard to Bundle/Parameters irrespective of anything we do in regard to this subject</p>",
        "id": 153982923,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533603745
    },
    {
        "content": "<p>Ah.  Yeah, I suppose.  But it's more of a problem if we have a reason for them to actually be used.</p>",
        "id": 153982931,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1533604131
    }
]