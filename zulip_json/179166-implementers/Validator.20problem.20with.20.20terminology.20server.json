[
    {
        "content": "<p>Hello,<br>\nI tried to validate my custom CodeSystem/Valueset with some resources.<br>\nI have setup HAPI server and tried with the following validator parameters.</p>\n<p>java -jar org.hl7.fhir.validator.jar -tx <a href=\"http://localhost:8080/hapi-fhir-jpaserver/fhir/\" target=\"_blank\" title=\"http://localhost:8080/hapi-fhir-jpaserver/fhir/\">http://localhost:8080/hapi-fhir-jpaserver/fhir/</a> -txLog term.txt -debug -version 4.0 Sample_CKUP_Observation.json -ig CKUP_Observation.StructureDefinition.xml   </p>\n<p>Even if I explicitly specified parameters to use FHIR R4, however, validator seems to access with FHIR R5 Specs.<br>\nHow to workarounds? And if the source code of validator is hosted in GitHub etc, I may be able to contribute something.</p>\n<p>Thank you.</p>\n<p>.. FHIR Version 4.0, definitions from hl7.fhir.r4.core#4.0.1<br>\n  .. connect to tx server @ <a href=\"http://localhost:8080/hapi-fhir-jpaserver/fhir/\" target=\"_blank\" title=\"http://localhost:8080/hapi-fhir-jpaserver/fhir/\">http://localhost:8080/hapi-fhir-jpaserver/fhir/</a><br>\n    (v4.0.1)<br>\n+  .. load IG from CKUP_Observation.StructureDefinition.xml</p>\n<ul>\n<li>load file: CKUP_Observation.StructureDefinition.xml .. success<br>\n  .. validate [Sample_CKUP_Observation.json]<br>\nTerminology server: Check for supported code systems for <a href=\"http://loinc.org\" target=\"_blank\" title=\"http://loinc.org\">http://loinc.org</a><br>\n<em>FAILURE</em> validating Sample_CKUP_Observation.json:  error:1 warn:0 info:0<br>\n  Error @ Observation.code.coding[0] (line 6, col8) : Error java.lang.ClassCastException: class org.hl7.fhir.r5.model.CapabilityStatement cannot be cast to class org.hl7.fhir.r5.model.TerminologyCapabilities (org.hl7.fhir.r5.model.CapabilityStatement and org.hl7.fhir.r5.model.TerminologyCapabilities are in unnamed module of loader 'app') validating Coding: org.hl7.fhir.exceptions.TerminologyServiceException: java.lang.ClassCastException: class org.hl7.fhir.r5.model.CapabilityStatement cannot be cast to class org.hl7.fhir.r5.model.TerminologyCapabilities (org.hl7.fhir.r5.model.CapabilityStatement and org.hl7.fhir.r5.model.TerminologyCapabilities are in unnamed module of loader 'app')</li>\n</ul>",
        "id": 182420177,
        "sender_full_name": "Eizen Kimura",
        "timestamp": 1575354391
    },
    {
        "content": "<p>the validator uses the R5 code base internally. The problem isn't the version thing, it's that API hasn't implemented the TerminologyCapabilities Resource yet, and so doesn't support the validator</p>",
        "id": 182425830,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575362190
    },
    {
        "content": "<p>Thank you for your comment. If a Terminology Server that supports R5 comes out, I'll  try again.</p>\n<blockquote>\n<p>the validator uses the R5 code base internally. The problem isn't the version thing, it's that API hasn't implemented the TerminologyCapabilities Resource yet, and so doesn't support the validator</p>\n</blockquote>",
        "id": 182502392,
        "sender_full_name": "Eizen Kimura",
        "timestamp": 1575411136
    },
    {
        "content": "<p><a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">tx.fhir.org</a> and ontoserver support the validator for R4.</p>",
        "id": 182502418,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575411168
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> are you planning to add support for TerminologyCapabilities.</p>",
        "id": 182502435,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575411184
    },
    {
        "content": "<p>the issue is not R5</p>",
        "id": 182502441,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575411188
    },
    {
        "content": "<p>Our team also ran into challenges using HAPI as a TX server with hl7validator...</p>\n<p>The <code>metadata?_summary=true</code>, and <code>metadata?mode=terminology</code> calls seem to work fine - but are followed by an exception. Let me collect some more detail, maybe a next layer of the onion...</p>",
        "id": 252191835,
        "sender_full_name": "David Simons",
        "timestamp": 1630942273
    },
    {
        "content": "<p>With a current hl7-validator it get's the CapabilityStatement from HAPI as TX, but cannot read it:</p>\n<p><code>Caused by: java.lang.ClassCastException: class org.hl7.fhir.r5.model.CapabilityStatement cannot be cast to class org.hl7.fhir.r5.model.TerminologyCapabilities (org.hl7.fhir.r5.model.CapabilityStatement and org.hl7.fhir.r5.model.TerminologyCapabilities are in unnamed module of loader 'app')</code><br>\nwhich seems to be the same as <span class=\"user-mention\" data-user-id=\"211972\">@Eizen Kimura</span> got back in 2019.. see above</p>\n<p>Looks like hl7-validator expects, when it asks for \"metadata?mode=terminology\", only the &lt;TerminologyCapabilities&gt; part. HAPI returns that embedded in the overall &lt;CapabilityStatement&gt;, while <a href=\"http://tx.fhir.org\">tx.fhir.org</a> and <a href=\"http://r4.ontoserver.csiro.au\">r4.ontoserver.csiro.au</a> return only the &lt;TerminologyCapabilities&gt; part, which then _is_ accepted by hl7-validator.</p>\n<ul>\n<li>HAPI FHIR Server - 5.4.2</li>\n<li>FHIR Validation tool Version 5.4.9 and  5.5.1 </li>\n</ul>\n<p>Has anyone been using the hl7validator with HAPI as TX succesfully? <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> </p>\n<p>Thank you for all your support!</p>\n<p>PS: will want to use with both STU3 and R4 - and corresponding hl7validator TerminologyClients.<br>\nPS: we're in part forced to look into this - alternative tx - because <a href=\"http://tx.fhir.org\">tx.fhir.org</a> being down so often...</p>",
        "id": 252262647,
        "sender_full_name": "David Simons",
        "timestamp": 1630999685
    },
    {
        "content": "<p><a href=\"http://tx.fhir.org\">tx.fhir.org</a> is down extremely rarely. So you should investigate why you wrongly think it is</p>",
        "id": 252362032,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631044185
    },
    {
        "content": "<p>That wasn't our experience over the summer Grahame.  I agree that it's gotten much better the last month or so, but those issues are recent enough that there's certainly not going to be an impression of \"high reliability\".</p>",
        "id": 252365613,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1631045686
    },
    {
        "content": "<p>well, I was absent, and the system went through some major disaster who's source I still haven't figured out, and the patch arrangements put in place while I was gone locked the server into instability. However I've invested deeply in stability in the last few weeks since I got back - my main priority. And it's much more stable now, though I'm still not there yet</p>",
        "id": 252366678,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631046179
    },
    {
        "content": "<p>and <span class=\"user-mention\" data-user-id=\"194580\">@David Simons</span> issues are extremely recent, and described while the server is actually up</p>",
        "id": 252366863,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1631046266
    },
    {
        "content": "<p>Thanks - and sorry to mix up topics. <br>\nLet's keep this thread on HL7Validator+HAPI, <br>\nand discuss <a href=\"http://tx.fhir.org\">tx.fhir.org</a> availability here: <a href=\"#narrow/stream/179252-IG-creation/topic/Term.20server.20is.20down.2E.2E.2E\">https://chat.fhir.org/#narrow/stream/179252-IG-creation/topic/Term.20server.20is.20down.2E.2E.2E</a> .</p>",
        "id": 252441900,
        "sender_full_name": "David Simons",
        "timestamp": 1631099687
    }
]