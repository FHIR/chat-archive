[
    {
        "content": "<p>I've got a collection of local references (e.g. Practitioner/1, Practitioner/2, Organization/3, PractitionerRole/4)<br>\nI want to define a single search that will retrieve all four resources<br>\nIs it possible?  If so, how?</p>",
        "id": 269521366,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643254145
    },
    {
        "content": "<p>write a batch bundle with 4 read operations in it?</p>",
        "id": 269526219,
        "sender_full_name": "Paul Church",
        "timestamp": 1643259660
    },
    {
        "content": "<p>A bit whacky perhaps, but on the quick I don't see why theoretically it shouldn't work: GET Resource?_id=Practitioner/1, Practitioner/2, Organization/3, PractitionerRole/4</p>",
        "id": 269534608,
        "sender_full_name": "René Spronk",
        "timestamp": 1643268689
    },
    {
        "content": "<p>The batch bundle is the only approach I've come up with, but it seems rather inefficient.  I don't think searching by _id allows preceding resource names.  Though if we could have a search at the 'root' level that could work that way, that'd be ideal...</p>",
        "id": 269597618,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643300703
    },
    {
        "content": "<p>GET [base]?_type=Practitioner,Organization&amp;_id=1,2,3 or even GET [base]?_id=1,2,3 certainly works, but one would have to assume that all of the logical ids are unique on a server for that to do exactly what it is you'd like to do.</p>",
        "id": 269598979,
        "sender_full_name": "René Spronk",
        "timestamp": 1643301305
    },
    {
        "content": "<p>bulk data pull everything, filter out locally.... You never said you wanted to have a single search return ONLY these.   :-)</p>",
        "id": 269599965,
        "sender_full_name": "John Moehrke",
        "timestamp": 1643301690
    },
    {
        "content": "<p>@Rene, ids aren't unique across resource types, so in theory you might get Organization/1 and Practitioner/1 and PractitionerRole/1</p>",
        "id": 269641500,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643319244
    },
    {
        "content": "<p>I definitely want the search to return <em>only</em> those.  The use-case is a CDS Hooks pre-fetch.</p>",
        "id": 269641583,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643319270
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/Searching.20by.20a.20collection.20of.20references/near/269641583\">said</a>:</p>\n<blockquote>\n<p>I definitely want the search to return <em>only</em> those.  The use-case is a CDS Hooks pre-fetch.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  one can create $youroperation with input resource parameters</p>",
        "id": 269934823,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1643551438
    },
    {
        "content": "<p>Sure, but that then requires custom support across all servers.  It seems to me that there <em>should</em> be a simple search mechanism to retrieve a list of local references without needing a Batch of reads.</p>",
        "id": 269937965,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643555639
    },
    {
        "content": "<blockquote>\n<p>The batch bundle is the only approach I've come up with, but it seems rather inefficient.</p>\n</blockquote>\n<p>What kind of \"efficiency\" are you thinking about here? Batch seems to meet your stated requirements neatly.</p>",
        "id": 269945145,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1643564026
    },
    {
        "content": "<blockquote>\n<p>The use-case is a CDS Hooks pre-fetch.</p>\n</blockquote>\n<p>For CDS Hooks pre-fetch, you can have as many individual pre-fetch keys as you require. Why not define distinct pre-fetch keys for each, so you can name them with useful labels and so the EHR can easily return any subset of them?</p>",
        "id": 269945295,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1643564191
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/Searching.20by.20a.20collection.20of.20references/near/269937965\">said</a>:</p>\n<blockquote>\n<p>Sure, but that then requires custom support across all servers.  It seems to me that there <em>should</em> be a simple search mechanism to retrieve a list of local references without needing a Batch of reads.</p>\n</blockquote>\n<p>I'm pretty ignorant here 'cause i've not dived into the specs, but i'da thunk that the phrase \"Batch of reads\" nicely describes the desired behavior.</p>",
        "id": 269945543,
        "sender_full_name": "Eric Prud'hommeaux",
        "timestamp": 1643564487
    },
    {
        "content": "<p>What I want to do is, for all draft orders passed in, retrieve the performers (Practitioners, PractitionerRoles, whatever) for all of the orders.  I don't know in advance how many orders there will be, so I can't reasonably name a distinct key for each.</p>",
        "id": 269951111,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643570904
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/Searching.20by.20a.20collection.20of.20references/near/269951111\">said</a>:</p>\n<blockquote>\n<p>What I want to do is, for all draft orders passed in, retrieve the performers (Practitioners, PractitionerRoles, whatever) for all of the orders.  I don't know in advance how many orders there will be, so I can't reasonably name a distinct key for each.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  use case basis store them as bundle resource of type collection.  This allow you to search and if you want to additional update that specific bundle. So the when client query they will get most current info. <br>\n-- I am trying to learn your use case</p>",
        "id": 269953112,
        "sender_full_name": "Jabeen Mohammed",
        "timestamp": 1643572896
    },
    {
        "content": "<p>The use-case is that a set of draft orders are passed to a CDS Hook.  The draft orders are not persisted on a server anywhere, so there's no ability to query them using a RESTful server.  The draft orders reference who 'performs' each order.  I want to define a pre-fetch query that will retrieve the performers for all of the specified orders.  I can easily create a comma-delimited list of reference URLs (absolute or relative).  But I <em>don't</em> have a way to retrieve the set of resources so referenced in a single query.  It needs to be a single query because the prefetch has to drop into a single prefetch variable - I can't have a distinct variable per record because you have to know how many variables you'll have at the outset - and I have no idea how many orders there will be, or how many performers per order.</p>",
        "id": 269954190,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643573738
    },
    {
        "content": "<p>I'm confused about how you are using the CDS hooks prefetch templating syntax. Can you share an example of the input variables that you are using to create a prefetch template? I'm having trouble understanding how the static prefetch template syntax would get access to an array of inputs...</p>",
        "id": 269959600,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1643579207
    },
    {
        "content": "<p>The CDS work group has talked about extending the syntax to allow navigating into the passed resource to allow retrieval.  (One of the most obvious needs is to be able to retrieve the Medication instances associated with MedicationRequests passed as draft or signed orders.)  The problem though is that even if we extend the syntax to allow navigating to the MedicationResource.medication element, there's no effective way to have a search that could use the results :(</p>",
        "id": 269961621,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643581594
    },
    {
        "content": "<p>If we're creating new capabilities, we can think about several options... e.g., an <code>include</code> array in the prefetch template that can take a set of expressions based on the context -- but this is all quite complex. Better, I think, to just let the CDS Service make REST API calls as needed, without prefetch.</p>",
        "id": 269969961,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1643592147
    },
    {
        "content": "<p>REST calls by the service are a non-starter in some cases.  Plus, the whole point of pre-fetch is to grab the content you need all the time.  And needing the medication for a MedicationRequest is an obvious situation where this is going to be needed.</p>",
        "id": 269975052,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643598605
    },
    {
        "content": "<p>I'm hearing this as a new feature request for the CDS Hooks prefetch language. It would be good to capture the use case and some proposed approach(es) to meet it (e.g., suggested semantics and syntax, evaluation of trade-offs).</p>",
        "id": 270607761,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1643918006
    },
    {
        "content": "<p>The new feature has been discussed on a couple of CDS calls already - but it was all based on the premise we could tie into the existing search syntax.  However, as best as I can determine, we can't.  So my first step was to make sure that I'm not missing something.  After that, then yes, we'll probably be looking at adding something completely net new in terms of prefetch for CDS Hooks.</p>",
        "id": 270616436,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643921878
    }
]