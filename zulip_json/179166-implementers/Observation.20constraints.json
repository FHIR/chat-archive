[
    {
        "content": "<p>We currently get two warnings when validating Observations on HAPI against core:</p>\n<div class=\"codehilite\"><pre><span></span>  &quot;diagnostics&quot;: &quot;All observations should have a performer&quot;,\n  &quot;diagnostics&quot;: &quot;All observations should have an effectiveDateTime or an effectivePeriod&quot;,\n</pre></div>\n\n\n<p>but we can't trace them back to any requirement7constraint in the spec. Is there an invariant we're not seeing or is HAPI just making this up?</p>",
        "id": 153959692,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526217599
    },
    {
        "content": "<p>VONK doesn't show any similar warnings. I'd like to test Grahame's server too, but it's down...</p>",
        "id": 153959693,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526217745
    },
    {
        "content": "<p>Ok, we found it. It's actually hardcoded into hapi...</p>",
        "id": 153959694,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526217999
    },
    {
        "content": "<p>Its actually hardcoded in the Java RI at <a href=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java#L3617\" target=\"_blank\" title=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java#L3617\">https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.validation/src/org/hl7/fhir/r4/validation/InstanceValidator.java#L3617</a>. It would be great if this can be fixed in Java RI.</p>",
        "id": 153960629,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526327382
    },
    {
        "content": "<p>what's wrong with them?</p>",
        "id": 153960710,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526332072
    },
    {
        "content": "<p>All of Observation.subject, Observation.performer, Observation.effective[x] are optional according to the StructureDefinition and AFAIK  there are no constraints that make them mandatory.</p>",
        "id": 153960747,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526336835
    },
    {
        "content": "<p>So the question is why are they made mandatory in the validator?</p>",
        "id": 153960749,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526336928
    },
    {
        "content": "<p>Moreover, Observation.performer has a cardinality of 0..*, whereas the code above expects only a single value (it calls getNamedChild from <a href=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.r4/src/org/hl7/fhir/r4/elementmodel/Element.java#L476\" target=\"_blank\" title=\"https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.r4/src/org/hl7/fhir/r4/elementmodel/Element.java#L476\">https://github.com/hl7-fhir/fhir-svn/blob/master/implementations/java/org.hl7.fhir.r4/src/org/hl7/fhir/r4/elementmodel/Element.java#L476</a>) which fails with the error \"Attempt to read a single element when there is more than one present\" when you send an observation with multiple performers. <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 153960754,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526338076
    },
    {
        "content": "<p>they are not made mandatory. It's a warning. And I think it's a good warning. But I definitely should fix the bug</p>",
        "id": 153960764,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526353605
    },
    {
        "content": "<p>I agree that those are good warnings, but such warnings are applicable to other resources as well and are not limited to Observations. I think its best to let profiles define such constraints and have the validator only validate based on base/profiles.</p>",
        "id": 153961366,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526416153
    },
    {
        "content": "<p>That was dropped a couple of releases ago, but I guess James never changed his rules.  Please submit a change request to get us to add the clarifying wording.</p>",
        "id": 153961368,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1526416865
    },
    {
        "content": "<p>ok</p>",
        "id": 153961369,
        "sender_full_name": "Brian Reinhold",
        "timestamp": 1526416897
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span></p>",
        "id": 153961373,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1526417202
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> what do you think was dropped a couple of releases ago? that error looks like it comes from the validator you and I maintain, not HAPI code</p>",
        "id": 153961388,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526420144
    },
    {
        "content": "<p>I thought we had dropped support for OIDs as temporary ids?</p>",
        "id": 153961392,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1526420229
    },
    {
        "content": "<p>OIDs?</p>",
        "id": 153961393,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526420433
    },
    {
        "content": "<p>Sorry, post was made to wrong thread.  Should have gone under \"temporary id\"</p>",
        "id": 153961395,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1526420664
    },
    {
        "content": "<p>Should I submit a change request for the removal of extra Observation checks? The other not-so-great solution for me is to fork and maintain InstanceValidator which is a pain given the amount of change it goes through.</p>",
        "id": 153961410,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526427554
    },
    {
        "content": "<p>I think <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> my have already done that?</p>",
        "id": 153961501,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526458394
    },
    {
        "content": "<p>Hi Anand, i already reported this unexpected behavior:<br>\n<a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17147&amp;start=0\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17147&amp;start=0\">GF17147</a></p>",
        "id": 153961524,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1526459722
    },
    {
        "content": "<p>i also reported it to hapi:<br>\n<a href=\"https://github.com/jamesagnew/hapi-fhir/issues/942\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/942\">https://github.com/jamesagnew/hapi-fhir/issues/942</a><br>\nWhere James stated, that these are disabled by default now (which they are not as i can see in the code).<br>\nBut you can disable them in the jpaserver-base config (e.g. BaseR4Config.java)</p>",
        "id": 153961525,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1526459944
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> . I can disable the best practice checks using RI too but the issue around Observation having multiple performers can not be fixed without changing InstanceValidator. I am interested in a fix for that.</p>",
        "id": 153961938,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1526480459
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> <br>\ni fixed it in HAPI, which works for now, until the next RI import of hapi.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nfix: <a href=\"https://github.com/jamesagnew/hapi-fhir/pull/951/files\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/pull/951/files\">https://github.com/jamesagnew/hapi-fhir/pull/951/files</a><br>\n<a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17221&amp;start=0\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17221&amp;start=0\">GF17221</a></p>",
        "id": 153963038,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1526545796
    }
]