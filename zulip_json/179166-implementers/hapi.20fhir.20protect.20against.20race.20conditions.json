[
    {
        "content": "<p>Hi, we're running into an issue with HAPI FHIR where multiple resources are created with the same identifier, even though we're doing a condition create  with the header <code>If-None-Exist</code>.  We believe the issue is because of a race condition where we're sending multiple create requests simultaneously, so HAPI is not able to reliably synchronously find the existing resource for a given identifier, and thus ends up creating multiple duplicates.</p>\n<p>We've made changes to the code so it's sending the requests synchronously to prevent this particular issue. But the root cause of the issue is still not solved because there could potentially be multiple processes writing to the HAPI server and we can't guarantee the order of operations.</p>\n<p>What is the best practice for protecting against race conditions? Is it possible to manually enforce uniqueness constraints at the db level in HAPI?</p>",
        "id": 240119016,
        "sender_full_name": "Pengyu Wang",
        "timestamp": 1621894108
    },
    {
        "content": "<p>you might want to ask this on <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a></p>",
        "id": 240124426,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1621897611
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179166-implementers/topic/hapi.20fhir.20protect.20against.20race.20conditions/near/240124426\">said</a>:</p>\n<blockquote>\n<p>you might want to ask this on <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a></p>\n</blockquote>\n<p>Thanks. Moved here: <a href=\"#narrow/stream/179167-hapi/topic/hapi.20fhir.20protect.20agains.20race.20conditions/near/240119267\">https://chat.fhir.org/#narrow/stream/179167-hapi/topic/hapi.20fhir.20protect.20agains.20race.20conditions/near/240119267</a></p>",
        "id": 240142685,
        "sender_full_name": "Pengyu Wang",
        "timestamp": 1621918772
    }
]