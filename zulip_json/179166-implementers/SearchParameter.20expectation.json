[
    {
        "content": "<p>Yesterday, we had a very deep discussion on FHIR-I call about multipleAnd/multipleOr  in SearchParameter. I am wondering how SearchParameter is used in real world by server and client implementers. For example, US Core defines Patient's name search as <a href=\"/user_uploads/10155/PP_LemUdaE2sFLz9EmdX3jIw/image.png\">image.png</a>. </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/PP_LemUdaE2sFLz9EmdX3jIw/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/PP_LemUdaE2sFLz9EmdX3jIw/image.png\"></a></div><p>The name search parameter has <code>multipleAnd: True, Conformance Expectation = MAY)</code>. So it is up to the server implementer to decide if a server instance supports multipleAnd search and the server implementer has to declare his own SearchParameter for patient's name search to make that clear. </p>\n<p>Should this searchParameter <code>derivedFrom</code> USCore's patient name search parameter? (I think so)</p>\n<p>Can this searchParameter have <code>multipleAnd: False</code>? (I think so too)</p>\n<p>I think the problem is that SearchParameter has multiple purpose, just like CapabilityStatement. When used in IG, it is a requirement for server implementation to meet. When used by a server instance, it is a capability the instance support. </p>\n<p>I think we should distinguish these two use cases.</p>\n<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> <span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span></p>",
        "id": 258204387,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1634653825
    },
    {
        "content": "<p>It is important to note that the SP in US Core are for documenting Server <strong>expected</strong> capabilities as Yunwei pointed out.</p>\n<blockquote>\n<p>Should this searchParameter derivedFrom USCore's patient name search parameter? (I think so)</p>\n</blockquote>\n<p>They are not intended to be a base SP upon which to be derived.  I would recommend using the base SP instead.</p>",
        "id": 258249965,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634668682
    },
    {
        "content": "<p>That is confusing. A US Core compliant server has a SP not derived from corresponding US Core SP.</p>",
        "id": 258258484,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1634672148
    },
    {
        "content": "<p>A US Core compliant server having a SP with the same code as a base SP is implicitly using the base SP not a derived SP.  They can document its capabilities the same way as the IG using the base SP and not US Core.</p>",
        "id": 258299507,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634693757
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191401\">Eric Haas</span> <a href=\"#narrow/stream/179166-implementers/topic/SearchParameter.20expectation/near/258299507\">said</a>:</p>\n<blockquote>\n<p>server having a SP with the same code as a base SP is implicitly using the base SP not a derived SP.  </p>\n</blockquote>\n<p>Is this written somewhere? <br>\nI thought it was the other way.</p>",
        "id": 258367009,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1634736588
    },
    {
        "content": "<p>That was the result of several chats and from <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span> who was all over this.  :-)  bottom line you can't make up your own SP and call the same thing - hows a client to know what its searching for if my <code>patient</code> searches for patient and yours redefined <code>patient</code> searches for status.  But you are correct, the spec only states this obliquely here:</p>\n<blockquote>\n<p>Also, there is a single page that lists all the search parameters. Note that search parameter names are case sensitive, though this specification never defines different parameters with names that differ only in case. <em>Clients SHOULD use correct case, and servers SHALL not define additional parameters with different meanings with names that only differ in case.</em></p>\n</blockquote>\n<p>And I cannot find any trackers...</p>",
        "id": 258384739,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634742535
    },
    {
        "content": "<p>You absolutely can make up your own SP and call it the same thing.  The obligation is actually on the client to look at the CapabilityStatement and determine what a given search string corresponds to.  I do agree that it's bad practice to name things the same as an official HL7 search parameter that mean something different, but given that HL7 can define new things in future versions and everyone else can make up search parameters named whatever they like, you <em>can't</em> trust that the meaning of a search string is the same on every server - you must always check the CapabilityStatement and the SearchParameter definitions.</p>",
        "id": 258418412,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634754304
    },
    {
        "content": "<p>Although I personally think those search parameters should be reserved and only mod,  comps, mult ands , mult ors  changeable,  that little nugget should be in the patient safety checklist</p>",
        "id": 258433199,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634759660
    },
    {
        "content": "<p>Feel free to submit a change request re: the safety list.<br>\nThe problem with \"reserving names\" is that core can introduce new names at any time.  So can HL7 International-published IGs.  So a name that was \"free\" to use a year ago might conflict with an HL7-defined name today.</p>",
        "id": 258440106,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634762231
    },
    {
        "content": "<p>How about the original question I asked, should we add a <code>.kind</code> (like CapabilityStatement) to indicate this SP is a \"requirement\" or a \"instance\"?</p>",
        "id": 258442583,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1634763260
    },
    {
        "content": "<p>I don't understand that.  A SearchParameter is always a 'definition' - it's a kind of thing that can be searched upon.  Servers can point to an SP defined in an IG directly.</p>",
        "id": 258451769,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634767521
    },
    {
        "content": "<p>uh-uh ... US Core express expected support of mods, comps, ors and ands. They are not implementable out of the box and have to be transformed to instances.   I think Yunwei's idea has merit.</p>",
        "id": 258468173,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634777007
    },
    {
        "content": "<p>The default is that everything is there - if you support everything, you can use the ones out-of-the-box from the FHIR spec.</p>",
        "id": 258473389,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634780145
    },
    {
        "content": "<p>The default is that everything is there<br>\n<span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/SearchParameter.20expectation/near/258473389\">said</a>:</p>\n<blockquote>\n<p>The default is that everything is there - if you support everything, you can use the ones out-of-the-box from the FHIR spec.</p>\n</blockquote>\n<p>Where is that asserted in the FHIR Spec?  to me that mean all mods, comps, ands and ors and types are supported.</p>",
        "id": 258481854,
        "sender_full_name": "Eric Haas",
        "timestamp": 1634786765
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191320\">Lloyd McKenzie</span> <a href=\"#narrow/stream/179166-implementers/topic/SearchParameter.20expectation/near/258418412\">said</a>:</p>\n<blockquote>\n<p>You absolutely can make up your own SP and call it the same thing.  The obligation is actually on the client to look at the CapabilityStatement and determine what a given search string corresponds to.  I do agree that it's bad practice to name things the same as an official HL7 search parameter that mean something different, but given that HL7 can define new things in future versions and everyone else can make up search parameters named whatever they like, you <em>can't</em> trust that the meaning of a search string is the same on every server - you must always check the CapabilityStatement and the SearchParameter definitions.</p>\n</blockquote>\n<p>Tips on preventing any future HL7 defined search parameter from stepping on your current custom search parameter. Don't name your search parameter the same as any attribute on any current resource. Name it with your vendor name. Instead of searching for \"thething\" \"epic_thething\" it's unlikely that HL7 will ever use a high profile vendor name in a core name.</p>",
        "id": 258540006,
        "sender_full_name": "Daniel Venton",
        "timestamp": 1634821011
    },
    {
        "content": "<p>You <em>can</em> do that.  However, the resolution mechanism is still \"don't trust the name, look at the declared URL in the CapabilityStatement\".</p>",
        "id": 258542644,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1634822037
    }
]