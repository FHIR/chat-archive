[
    {
        "content": "<p>Hi,<br>\nIs it possible to constrain the profile referenced in another profile ? Like e.g. when I want to build some report about pregnancy and I reference a \"Patient\" resource I would like to ensure thate the \"Patient.gender\" can only be \"female\". If possible, with which standard mechanism from the FHIR cosmos are such constrains modeled ?</p>",
        "id": 175057444,
        "sender_full_name": "Georg Fette",
        "timestamp": 1567771330
    },
    {
        "content": "<p>either a FHIRPath statement using resolve() or a GraphDefinition (though that needs an extension). But either way it's fragile since the rule is only know from the context of a different resource</p>",
        "id": 175057526,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771410
    },
    {
        "content": "<p>And you need to be careful about the validity of the invariant itself. Patients with a gender = other might also be pregnant. You can't know that information.</p>",
        "id": 175057738,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1567771605
    },
    {
        "content": "<p>technnically, in super edge cases, it's possi ble for patients with an administrative gender of m to be pregnant (though I think it's pretty unlikely given hormone treatment etc)</p>",
        "id": 175057967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771813
    },
    {
        "content": "<p>so, is it true that using the standard mechanisms that available by defining a profile merely through a StructureDefinition such a constraining is not possible ?</p>",
        "id": 175058470,
        "sender_full_name": "Georg Fette",
        "timestamp": 1567772260
    },
    {
        "content": "<p>Technical it is possible as <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> mentioned. Have a look at the resolve function defined here: <a href=\"https://www.hl7.org/fhir/fhirpath.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/fhirpath.html\">https://www.hl7.org/fhir/fhirpath.html</a><br>\nWith it you could in theory define invariants which cover multiple resources</p>",
        "id": 175060113,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1567773704
    },
    {
        "content": "<p>ah, cool, thank you. I will take a look at that.</p>",
        "id": 175060388,
        "sender_full_name": "Georg Fette",
        "timestamp": 1567773951
    },
    {
        "content": "<p>Can somebody give me an example of a structuredefinition in which a fhirpath statement has been used to constrain the profile? It does not need to be such a trans-profile constraint like i asked for in my initial question.</p>",
        "id": 175236278,
        "sender_full_name": "Georg Fette",
        "timestamp": 1568031882
    },
    {
        "content": "<p>I suspect that in most cases if the constraint doesn't go across the reference boundary, then the profile will just use the normal (non-FHIRPath) approach to constraining the reference to a profile (using the <code>type.targetProfile</code>).  But if you did want to use a FHIRPath invariant to do that, I expect you'd chain <code>resolve()</code> and <code>conformsTo(structure: string)</code> together to accomplish it (see: <a href=\"http://hl7.org/fhir/R4/fhirpath.html#functions\" target=\"_blank\" title=\"http://hl7.org/fhir/R4/fhirpath.html#functions\">http://hl7.org/fhir/R4/fhirpath.html#functions</a> for doc on <code>conformsTo</code>).</p>",
        "id": 175247877,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1568040169
    },
    {
        "content": "<p><a href=\"https://github.com/AuDigitalHealth/ci-fhir-stu3/blob/master/resources/composition-sml-prac-1.xml\" target=\"_blank\" title=\"https://github.com/AuDigitalHealth/ci-fhir-stu3/blob/master/resources/composition-sml-prac-1.xml\">https://github.com/AuDigitalHealth/ci-fhir-stu3/blob/master/resources/composition-sml-prac-1.xml</a> contains an invariant to force a referenced practitioner to conform to a profile. See inv-dh-cmp-06.<br>\n<code>&lt;expression value=\"resolve().conformsTo('http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/practitionerrole-withpractitionerident-1')\" /&gt;</code></p>",
        "id": 175500225,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1568265974
    },
    {
        "content": "<p>Why not use <code>ElementDefinition.type.targetProfile</code>?</p>",
        "id": 175519298,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1568287325
    },
    {
        "content": "<p>That works unless the invariant is conditional</p>",
        "id": 175519892,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1568287953
    }
]