[
    {
        "content": "<p>Currently testing conditional logic on the HAPI and getting some unexpected behaviour. I'm using a transaction withjust a single entry for now until I can see I am using the correct logic. In this instance I want to only 'Create' a practitioner if they dont already exist. Otherwise do nothing. So my bundle looks like this.</p>\n<div class=\"codehilite\"><pre><span class=\"o\">&lt;</span><span class=\"n\">Bundle</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span> <span class=\"n\">we</span> <span class=\"n\">need</span> <span class=\"n\">to</span> <span class=\"n\">use</span> <span class=\"n\">a</span> <span class=\"n\">transaction</span> <span class=\"k\">for</span> <span class=\"n\">this</span> <span class=\"nb\">type</span> <span class=\"n\">of</span> <span class=\"n\">procedure</span> <span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;transaction&quot;</span><span class=\"o\">/&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span> <span class=\"n\">Bundle</span> <span class=\"n\">Id</span> <span class=\"n\">will</span> <span class=\"n\">be</span> <span class=\"n\">generated</span> <span class=\"n\">by</span> <span class=\"n\">Map</span> <span class=\"n\">Force</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">client</span> <span class=\"o\">-</span> <span class=\"n\">this</span> <span class=\"ow\">is</span> <span class=\"n\">the</span> <span class=\"n\">resource</span> <span class=\"nb\">id</span> <span class=\"k\">for</span> <span class=\"n\">the</span> <span class=\"n\">bundle</span> <span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nb\">id</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;f9935843-19a2-4a1a-4016-7bea52de77f8&quot;</span><span class=\"o\">/&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Lets</span> <span class=\"n\">process</span> <span class=\"n\">patient</span> <span class=\"n\">first</span> <span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">We</span> <span class=\"n\">still</span> <span class=\"n\">need</span> <span class=\"n\">to</span> <span class=\"n\">include</span> <span class=\"n\">patient</span> <span class=\"ow\">in</span> <span class=\"n\">the</span> <span class=\"n\">bundle</span> <span class=\"k\">for</span> <span class=\"n\">our</span> <span class=\"n\">check</span> <span class=\"n\">even</span> <span class=\"n\">though</span> <span class=\"n\">it</span> <span class=\"n\">a</span> <span class=\"n\">cut</span> <span class=\"n\">down</span> <span class=\"n\">bogus</span> <span class=\"n\">entry</span><span class=\"o\">--&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Should</span> <span class=\"n\">this</span> <span class=\"n\">be</span> <span class=\"n\">provided</span> <span class=\"k\">for</span> <span class=\"n\">a</span> <span class=\"n\">Create</span> <span class=\"n\">i</span><span class=\"o\">.</span><span class=\"n\">e</span><span class=\"o\">.</span> <span class=\"n\">should</span> <span class=\"n\">the</span> <span class=\"n\">adapter</span> <span class=\"n\">generate</span> <span class=\"n\">the</span> <span class=\"n\">local</span> <span class=\"nb\">id</span> <span class=\"p\">(</span><span class=\"k\">if</span> <span class=\"n\">resource</span> <span class=\"ow\">not</span> <span class=\"n\">exist</span><span class=\"p\">)</span> <span class=\"ow\">or</span> <span class=\"n\">let</span> <span class=\"n\">the</span> <span class=\"n\">fhir</span> <span class=\"n\">server</span> <span class=\"n\">do</span> <span class=\"n\">it</span><span class=\"err\">?</span><span class=\"o\">--&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">This</span> <span class=\"ow\">is</span> <span class=\"n\">generate</span> <span class=\"n\">by</span> <span class=\"n\">Map</span> <span class=\"n\">Force</span> <span class=\"ow\">and</span> <span class=\"n\">use</span> <span class=\"k\">for</span> <span class=\"n\">references</span><span class=\"o\">.</span> <span class=\"n\">If</span> <span class=\"n\">Practitioner</span> <span class=\"n\">does</span> <span class=\"ow\">not</span> <span class=\"n\">exist</span> <span class=\"n\">FHIR</span> <span class=\"n\">server</span> <span class=\"n\">should</span> <span class=\"n\">use</span> <span class=\"n\">it</span> <span class=\"n\">at</span> <span class=\"n\">Local</span> <span class=\"n\">Resource</span> <span class=\"n\">Id</span><span class=\"o\">--&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">fullUrl</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;urn:uuid:47709cc7-b3ec-4abc-9d26-3df3d3d57907&quot;</span><span class=\"o\">/&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">resource</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">Practitioner</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">identifier</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;official&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Reuse</span> <span class=\"n\">value</span> <span class=\"kn\">from</span> <span class=\"nn\">CDA</span> <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;urn:oid:2.16.840.1.113883.2.4.6.3&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Reuse</span> <span class=\"n\">OIDs</span> <span class=\"kn\">from</span> <span class=\"nn\">CDA</span> <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span>    <span class=\"n\">BSN</span> <span class=\"n\">identification</span> <span class=\"n\">system</span>    <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;567IUI51C157&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">identifier</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">name</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;official&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">family</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;Heps&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">given</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;Simone&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">suffix</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;MD&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">name</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;phone&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;020556936&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;email&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;S.M.Heps@bmc.nl&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;fax&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;0205669283&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">address</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">line</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;Galapagosweg 91&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">city</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;Den Burg&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">postalCode</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;9105 PZ&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">country</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;NLD&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span>    <span class=\"n\">ISO</span> <span class=\"mi\">3166</span> <span class=\"n\">Codes</span> <span class=\"p\">(</span><span class=\"n\">Countries</span><span class=\"p\">)</span>    <span class=\"o\">--&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">address</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">gender</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;female&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">birthDate</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;1971-11-07&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;/</span><span class=\"n\">Practitioner</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;/</span><span class=\"n\">resource</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">request</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">For</span> <span class=\"n\">this</span> <span class=\"n\">entry</span> <span class=\"n\">we</span> <span class=\"n\">only</span> <span class=\"n\">want</span> <span class=\"n\">to</span> <span class=\"n\">create</span> <span class=\"n\">the</span> <span class=\"n\">practitioner</span> <span class=\"n\">based</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">entry</span> <span class=\"n\">data</span> <span class=\"k\">if</span> <span class=\"n\">we</span> <span class=\"n\">dont</span> <span class=\"n\">find</span> <span class=\"n\">one</span> <span class=\"o\">--&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">method</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;POST&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">url</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;Practitioner&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Use</span> <span class=\"n\">DrProviderNumber</span> <span class=\"n\">Paul</span> <span class=\"n\">to</span> <span class=\"n\">add</span> <span class=\"n\">more</span> <span class=\"n\">syntax</span> <span class=\"n\">below</span><span class=\"o\">--&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">ifNoneExist</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s\">&quot;identifier=567IUI51C157&quot;</span><span class=\"o\">/&gt;</span>\n    <span class=\"o\">&lt;/</span><span class=\"n\">request</span><span class=\"o\">&gt;</span>\n  <span class=\"o\">&lt;/</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n<span class=\"o\">&lt;/</span><span class=\"n\">Bundle</span><span class=\"o\">&gt;</span>\n</pre></div>\n\n\n<p>It creates a new practitioner the first time as expected. But if I post the same transaction again I would expect it to not create a new practitioner because it already exists. On the HAPI server it will create a new practitioner each time. Is my bundle correct?</p>",
        "id": 153827631,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463101058
    },
    {
        "content": "<p>Based on <a href=\"http://hl7-fhir.github.io/http.html#2.1.0.10.2\" target=\"_blank\" title=\"http://hl7-fhir.github.io/http.html#2.1.0.10.2\">Conditional Update</a> in the spec, shouldn't your <code>request</code> element be something more like this?</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;request&gt;</span>\n  <span class=\"c\">&lt;!--For this entry we only want to create the practitioner based on the entry data if we dont find one --&gt;</span>\n  <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PUT&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Practitioner?identifier=567IUI51C157&quot;</span><span class=\"nt\">/&gt;</span>\n<span class=\"nt\">&lt;/request&gt;</span>\n</pre></div>",
        "id": 153827635,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1463105741
    },
    {
        "content": "<p>When I try that I get an error on the Hapi server indicating a missing search parameter? However from what I understand, using PUT is when I want to either create new or update if exists already. The logic I want is to create if not exists otherwise do nothing - is that possible?</p>",
        "id": 153827639,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463106971
    },
    {
        "content": "<p>Did you try Chris' suggested URL with POST?</p>",
        "id": 153827644,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463110416
    },
    {
        "content": "<p>That should work...</p>",
        "id": 153827645,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463110429
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> are you saying I shouldn't use</p>\n<div class=\"codehilite\"><pre><span></span>      <span class=\"o\">&lt;</span><span class=\"n\">ifNoneExist</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Practitioner?identifier=567IUI51C157&quot;</span><span class=\"o\">/&gt;</span>\n</pre></div>",
        "id": 153827646,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463111167
    },
    {
        "content": "<p>I apologize, <span class=\"user-mention\" data-user-id=\"191949\">@Paul Barry</span>.  I mis-read your original intent.  I agree that what you're doing seems like it <strong>should</strong> work.  Based on documentation in Bundle, I think you're right about having <code>Practitioner</code> as the url value (without the query) and putting the query parameter(s) in the <code>ifNoneExist</code> value (<strong>without</strong> the <code>Practitioner?</code> part).  Perhaps <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> can chime in to confirm or deny if this functionality is implemented in HAPI.</p>\n<p>One thing you could try (although it shouldn't make a difference) is putting the system in the query too: <code>identifier=urn:oid:2.16.840.1.113883.2.4.6.3|567IUI51C157</code></p>",
        "id": 153827735,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1463146529
    },
    {
        "content": "<p>Hi Paul,</p>\n<p>Are you posting this against our public test server, or your own server? If the latter, what version of HAPI are you using?</p>\n<p>Your bundle looks correct to me, and if I post it to our public test server it seems to do the right thing (first time it created the resource, subsequent times is did not)</p>",
        "id": 153827863,
        "sender_full_name": "James Agnew",
        "timestamp": 1463180594
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> thanks for your response. I am using your public test server. Will include bundle again:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">Bundle</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;transaction&quot;</span><span class=\"o\">/&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"nb\">id</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;f9935843-19a2-4a1a-4016-7bea52de77f8&quot;</span><span class=\"o\">/&gt;</span>\n  <span class=\"o\">&lt;</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">fullUrl</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;urn:uuid:47709cc7-b3ec-4abc-9d26-3df3d3d57907&quot;</span><span class=\"o\">/&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">resource</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">Practitioner</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">identifier</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;official&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Reuse</span> <span class=\"n\">value</span> <span class=\"kn\">from</span> <span class=\"nn\">CDA</span> <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;urn:oid:2.16.840.1.113883.2.4.6.3&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Reuse</span> <span class=\"n\">OIDs</span> <span class=\"kn\">from</span> <span class=\"nn\">CDA</span> <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span>    <span class=\"n\">BSN</span> <span class=\"n\">identification</span> <span class=\"n\">system</span>    <span class=\"o\">--&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;567IUI51C157&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">identifier</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">name</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;official&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">family</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Heps&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">given</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Simone&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">suffix</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;MD&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">name</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;phone&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;020556936&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;email&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;S.M.Heps@bmc.nl&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">system</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;fax&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">value</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;0205669283&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">telecom</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">address</span><span class=\"o\">&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">use</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;work&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">line</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Galapagosweg 91&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">city</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Den Burg&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">postalCode</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;9105 PZ&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"n\">country</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;NLD&quot;</span><span class=\"o\">/&gt;</span>\n          <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span>    <span class=\"n\">ISO</span> <span class=\"mi\">3166</span> <span class=\"n\">Codes</span> <span class=\"p\">(</span><span class=\"n\">Countries</span><span class=\"p\">)</span>    <span class=\"o\">--&gt;</span>\n        <span class=\"o\">&lt;/</span><span class=\"n\">address</span><span class=\"o\">&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">gender</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;female&quot;</span><span class=\"o\">/&gt;</span>\n        <span class=\"o\">&lt;</span><span class=\"n\">birthDate</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;1971-11-07&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;/</span><span class=\"n\">Practitioner</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;/</span><span class=\"n\">resource</span><span class=\"o\">&gt;</span>\n    <span class=\"o\">&lt;</span><span class=\"n\">request</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">For</span> <span class=\"n\">this</span> <span class=\"n\">entry</span> <span class=\"n\">we</span> <span class=\"n\">only</span> <span class=\"n\">want</span> <span class=\"n\">to</span> <span class=\"n\">create</span> <span class=\"n\">the</span> <span class=\"n\">practitioner</span> <span class=\"n\">based</span> <span class=\"n\">on</span> <span class=\"n\">the</span> <span class=\"n\">entry</span> <span class=\"n\">data</span> <span class=\"k\">if</span> <span class=\"n\">we</span> <span class=\"n\">dont</span> <span class=\"n\">find</span> <span class=\"n\">one</span> <span class=\"o\">--&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">method</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;POST&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">url</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Practitioner&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"err\">!</span><span class=\"o\">--</span><span class=\"n\">Use</span> <span class=\"n\">DrProviderNumber</span> <span class=\"n\">Paul</span> <span class=\"n\">to</span> <span class=\"n\">add</span> <span class=\"n\">more</span> <span class=\"n\">syntax</span> <span class=\"n\">below</span><span class=\"o\">--&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">ifNoneExist</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Practitioner?identifier=567IUI51C157&quot;</span><span class=\"o\">/&gt;</span>\n    <span class=\"o\">&lt;/</span><span class=\"n\">request</span><span class=\"o\">&gt;</span>\n  <span class=\"o\">&lt;/</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n<span class=\"o\">&lt;/</span><span class=\"n\">Bundle</span><span class=\"o\">&gt;</span>\n</pre></div>\n\n\n<p>When I post the transaction the first time I get the following</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">Bundle</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"nb\">id</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;49f13866-319d-429a-8bab-1978951b6912&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;transaction-response&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"n\">link</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">relation</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;self&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">url</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://fhirtest.uhn.ca/baseDstu2&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;/</span><span class=\"n\">link</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">response</span><span class=\"o\">&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">status</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;201 Created&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">location</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Practitioner/69207/_history/1&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">etag</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;1&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">lastModified</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;2016-05-15T22:34:56.049-04:00&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;/</span><span class=\"n\">response</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;/</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n<span class=\"o\">&lt;/</span><span class=\"n\">Bundle</span><span class=\"o\">&gt;</span>\n</pre></div>\n\n\n<p>When I post the second time I get the same with a new logical id</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"o\">&lt;</span><span class=\"n\">Bundle</span> <span class=\"n\">xmlns</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://hl7.org/fhir&quot;</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"nb\">id</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;73614efd-e180-4c31-9695-e863931f367e&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"nb\">type</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;transaction-response&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"n\">link</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">relation</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;self&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">url</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;http://fhirtest.uhn.ca/baseDstu2&quot;</span><span class=\"o\">/&gt;</span>\n   <span class=\"o\">&lt;/</span><span class=\"n\">link</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n      <span class=\"o\">&lt;</span><span class=\"n\">response</span><span class=\"o\">&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">status</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;201 Created&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">location</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;Practitioner/69209/_history/1&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">etag</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;1&quot;</span><span class=\"o\">/&gt;</span>\n         <span class=\"o\">&lt;</span><span class=\"n\">lastModified</span> <span class=\"n\">value</span><span class=\"o\">=</span><span class=\"s2\">&quot;2016-05-15T22:36:19.942-04:00&quot;</span><span class=\"o\">/&gt;</span>\n      <span class=\"o\">&lt;/</span><span class=\"n\">response</span><span class=\"o\">&gt;</span>\n   <span class=\"o\">&lt;/</span><span class=\"n\">entry</span><span class=\"o\">&gt;</span>\n<span class=\"o\">&lt;/</span><span class=\"n\">Bundle</span><span class=\"o\">&gt;</span>\n</pre></div>",
        "id": 153827941,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463366581
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> . I did try that too but same result. Strangely when I search by 'Practitioner?identifier=567IUI51C157' it returns all the practitioners so the search syntax is working.</p>",
        "id": 153827944,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463366771
    },
    {
        "content": "<p>How are you sending this bundle in?</p>\n<p>I took the contents of your bundle and pasted it into a file called <code>transaction_bundle.xml</code> then used curl to send it to the public server with the following command:</p>\n<div class=\"codehilite\"><pre>curl -v -X POST -H &quot;Content-type: application/xml+fhir&quot; --data @transaction-bundle2.xml http://fhirtest.uhn.ca/baseDstu2/\n</pre></div>\n\n\n<p>The server correctly rejects it because the conditional has several matches:</p>\n<div class=\"codehilite\"><pre><span class=\"p\">{</span>\n    <span class=\"nt\">&quot;resourceType&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;OperationOutcome&quot;</span><span class=\"p\">,</span>\n    <span class=\"nt\">&quot;issue&quot;</span><span class=\"p\">:[</span>\n        <span class=\"p\">{</span>\n            <span class=\"nt\">&quot;severity&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;error&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;processing&quot;</span><span class=\"p\">,</span>\n            <span class=\"nt\">&quot;diagnostics&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Failed to CREATE resource with match URL \\&quot;Practitioner?identifier=567IUI51C157\\&quot; because this search matched 5 resources&quot;</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</pre></div>",
        "id": 153827971,
        "sender_full_name": "James Agnew",
        "timestamp": 1463408233
    },
    {
        "content": "<p>I paste the xml into the bundle textbox on the hapi landing page and click the 'transaction' button<br>\nHowever even when I choose a new identifier it still creates even when the condition has a single matach</p>",
        "id": 153828083,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463439348
    },
    {
        "content": "<p>Hi, I just checked my connectathon stuff and realized I am using conditional update mostly, which works perfectly.<br>\nThis bundle:</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;20160517191157&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;fullUrl</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:4bf66899-a14a-46ed-5346-9f49e7df7c87&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;resource&gt;</span>\n            <span class=\"nt\">&lt;Patient&gt;</span>\n                <span class=\"nt\">&lt;meta&gt;</span>\n                    <span class=\"nt\">&lt;tag&gt;</span>\n                        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CLOVERLEAF&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/tag&gt;</span>\n                <span class=\"nt\">&lt;/meta&gt;</span>\n                <span class=\"nt\">&lt;identifier&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;usual&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;type&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/identifier-type&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MR&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/type&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://www.ghh.org/identifiers&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;presentation3&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;assigner&gt;</span>\n                        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;TCPAS&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/assigner&gt;</span>\n                <span class=\"nt\">&lt;/identifier&gt;</span>\n                <span class=\"nt\">&lt;name&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;official&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;family</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;given</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Guy&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/name&gt;</span>\n                <span class=\"nt\">&lt;telecom&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;phone&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;277543&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;home&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/telecom&gt;</span>\n                <span class=\"nt\">&lt;gender</span> <span class=\"na\">value=</span><span class=\"s\">&quot;female&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;birthDate</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1928-05-24&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;address&gt;</span>\n                    <span class=\"nt\">&lt;line</span> <span class=\"na\">value=</span><span class=\"s\">&quot;22 Stable Road&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;city</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Whitstable&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;state</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Kent&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;country</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CR5 1EL&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/address&gt;</span>\n                <span class=\"nt\">&lt;contact&gt;</span>\n                    <span class=\"nt\">&lt;relationship&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/patient-contact-relationship&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;parent&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/relationship&gt;</span>\n                    <span class=\"nt\">&lt;name&gt;</span>\n                        <span class=\"nt\">&lt;family</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;given</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Dad&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/name&gt;</span>\n                <span class=\"nt\">&lt;/contact&gt;</span>\n            <span class=\"nt\">&lt;/Patient&gt;</span>\n        <span class=\"nt\">&lt;/resource&gt;</span>\n        <span class=\"nt\">&lt;request&gt;</span>\n            <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PUT&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient?identifier=http://www.ghh.org/identifiers|presentation3&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/request&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;fullUrl</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:ff89de6d-e4b2-4c6d-6f8d-929b0332a7df&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;resource&gt;</span>\n            <span class=\"nt\">&lt;Encounter&gt;</span>\n                <span class=\"nt\">&lt;meta&gt;</span>\n                    <span class=\"nt\">&lt;tag&gt;</span>\n                        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CLOVERLEAF&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/tag&gt;</span>\n                <span class=\"nt\">&lt;/meta&gt;</span>\n                <span class=\"nt\">&lt;identifier&gt;</span>\n                    <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;usual&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;type&gt;</span>\n                        <span class=\"nt\">&lt;coding&gt;</span>\n                            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/identifier-type&quot;</span> <span class=\"nt\">/&gt;</span>\n                            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MR&quot;</span> <span class=\"nt\">/&gt;</span>\n                        <span class=\"nt\">&lt;/coding&gt;</span>\n                    <span class=\"nt\">&lt;/type&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://general-hospital.co.uk/Identifiers&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;presentation1&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;assigner&gt;</span>\n                        <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;GENHOS&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;/assigner&gt;</span>\n                <span class=\"nt\">&lt;/identifier&gt;</span>\n                <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;in-progress&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;class</span> <span class=\"na\">value=</span><span class=\"s\">&quot;inpatient&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;patient&gt;</span>\n                    <span class=\"nt\">&lt;reference</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:uuid:4bf66899-a14a-46ed-5346-9f49e7df7c87&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CondRef, Guy(*24.05.1928)&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/patient&gt;</span>\n                <span class=\"nt\">&lt;period&gt;</span>\n                    <span class=\"nt\">&lt;start</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2015-05-02T09:00:00+01:00&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/period&gt;</span>\n            <span class=\"nt\">&lt;/Encounter&gt;</span>\n        <span class=\"nt\">&lt;/resource&gt;</span>\n        <span class=\"nt\">&lt;request&gt;</span>\n            <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PUT&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Encounter?identifier=http://general-hospital.co.uk/Identifiers|presentation1&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/request&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>\n\n\n<p>returns</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;83d18d6a-f73c-4e61-9740-635defd91eec&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction-response&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;link&gt;</span>\n        <span class=\"nt\">&lt;relation</span> <span class=\"na\">value=</span><span class=\"s\">&quot;self&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhirtest.uhn.ca/baseDstu2&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/link&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;201 Created&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient/69559/_history/1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:17:55.563-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;201 Created&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Encounter/69560/_history/1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:17:55.592-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>\n\n\n<p>the first time I send it and</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;cffd1412-3192-44fb-bdc9-35c5f336e900&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction-response&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;link&gt;</span>\n        <span class=\"nt\">&lt;relation</span> <span class=\"na\">value=</span><span class=\"s\">&quot;self&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhirtest.uhn.ca/baseDstu2&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/link&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;200 OK&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient/69559/_history/2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:18:21.271-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;200 OK&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Encounter/69560/_history/2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:18:21.312-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>\n\n\n<p>the second time, so no douplicates created</p>\n<p>Consecutively I changed the Method to POST and the url-Parameter to ifNoneExist and sent the same Bundle again.<br>\nResult:</p>\n<div class=\"codehilite\"><pre><span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;3bdb23da-4911-41f0-9ecf-517e70f33aa3&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction-response&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;link&gt;</span>\n        <span class=\"nt\">&lt;relation</span> <span class=\"na\">value=</span><span class=\"s\">&quot;self&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhirtest.uhn.ca/baseDstu2&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/link&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;200 OK&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Patient/69559/_history/2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:23:11.504-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n    <span class=\"nt\">&lt;entry&gt;</span>\n        <span class=\"nt\">&lt;response&gt;</span>\n            <span class=\"nt\">&lt;status</span> <span class=\"na\">value=</span><span class=\"s\">&quot;200 OK&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Encounter/69560/_history/2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;etag</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;lastModified</span> <span class=\"na\">value=</span><span class=\"s\">&quot;2016-05-17T13:23:11.504-04:00&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/response&gt;</span>\n    <span class=\"nt\">&lt;/entry&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>\n\n\n<p>So: no update and no duplicates! Exactly as expected.<br>\nSearching for  /Encounter?identifier=http://general-hospital.co.uk/Identifiers|presentation3<br>\nstill returns only one result. </p>\n<p>However, I don't see the difference to what you are trying to do. <br>\nI  used PostMan btw...</p>",
        "id": 153828162,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463506227
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191949\">@Paul Barry</span>  I think HAPI get's confused because you're mixing conditional update parameters with conditional creates.<br>\nYou should have either<br>\nmethod = PUT <br>\nurl = condition<br>\nOR<br>\nmethod = POST<br>\nifNoneMatch = condition</p>\n<p>Currently you're sending both url AND ifNoneMatch at the same time. Maybe that's the problem.</p>",
        "id": 153828163,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463506530
    },
    {
        "content": "<p>though I can's even point at the place in the specification, where this is explicitly stated. I just always did it that way...<br>\nThere's no invariant stating that you can't use both at the same time.<br>\nIf it is in fact the case, that you're only supposed to use EITHER url OR ifNoneMatch, then  I guess the spec needs to be more verbose about it.<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> ...?</p>",
        "id": 153828164,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463507096
    },
    {
        "content": "<p>the spec doesn't say anything about using url for conditional create</p>",
        "id": 153828199,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463513933
    },
    {
        "content": "<p>I'm confused... Paul's bundle looks like it's doing a normal conditional create to me?</p>\n<div class=\"codehilite\"><pre>   <span class=\"nt\">&lt;request&gt;</span>\n      <span class=\"nt\">&lt;method</span> <span class=\"na\">value=</span><span class=\"s\">&quot;POST&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;url</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Practitioner&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;ifNoneExist</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Practitioner?identifier=567IUI51C157&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/request&gt;</span>\n</pre></div>",
        "id": 153828206,
        "sender_full_name": "James Agnew",
        "timestamp": 1463514419
    },
    {
        "content": "<p>hmm I should have read more carefully then?</p>",
        "id": 153828207,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463514459
    },
    {
        "content": "<p>I'm questioning Simone's statement:</p>\n<blockquote>\n<p>I think HAPI get's confused because you're mixing conditional update parameters with conditional creates.</p>\n</blockquote>",
        "id": 153828208,
        "sender_full_name": "James Agnew",
        "timestamp": 1463514495
    },
    {
        "content": "<p>as far as I can see, the bundle that Paul is sending looks 100% correct... but he seems to get different behaviour when he posts it to what I get, so I feel like I'm missing something.</p>",
        "id": 153828209,
        "sender_full_name": "James Agnew",
        "timestamp": 1463514575
    },
    {
        "content": "<p>Yes, I just postmanned Barry's Bundle to HAPI and I don't get duplicates either. Funny though, that I - for some reason - never use \"url\" in conditional creates and neither yours nor Grahame's server seem to care :)</p>",
        "id": 153828210,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463515334
    },
    {
        "content": "<p>Heh- we're both being nice, since url is actually <code>1..1</code> in <code>Bundle.entry.request</code> :)</p>",
        "id": 153828211,
        "sender_full_name": "James Agnew",
        "timestamp": 1463515511
    },
    {
        "content": "<p>I wonder what would happen if you put a conditional URL there... In theory the server should tell you to take a hike, but it might not actually do that.</p>",
        "id": 153828213,
        "sender_full_name": "James Agnew",
        "timestamp": 1463515564
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> : it seems a little strange that when posting a transaction with two entries that, due to the given condition, remain both unchanged, the response looks like this:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"cp\">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span>\n<span class=\"nt\">&lt;Bundle</span> <span class=\"na\">xmlns=</span><span class=\"s\">&quot;http://hl7.org/fhir&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;id</span> <span class=\"na\">value=</span><span class=\"s\">&quot;92a864ac-8e0f-4e38-8592-b2f6ce909d&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;transaction-response&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;entry/&gt;</span>\n    <span class=\"nt\">&lt;entry/&gt;</span>\n<span class=\"nt\">&lt;/Bundle&gt;</span>\n</pre></div>",
        "id": 153828214,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463515588
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153828216,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463515770
    },
    {
        "content": "<p>oops. I must have never validated my Bundle, just the resources :-/</p>",
        "id": 153828217,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463516085
    },
    {
        "content": "<p>well, if you got that from my server it's certainly an error</p>",
        "id": 153828221,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1463520452
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> have you tried posting the bundle using the transaction textbox on the Hapi landing page? <a href=\"http://fhirtest.uhn.ca/\" target=\"_blank\" title=\"http://fhirtest.uhn.ca/\">http://fhirtest.uhn.ca/#</a><br>\nI will have a go with POSTMan tonight and see what happens. Cheers</p>",
        "id": 153828369,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463538106
    },
    {
        "content": "<p>Interesting. It seems indeed to be a textbox issue. I wonder how that happens!?</p>",
        "id": 153828428,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1463560652
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span> <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> I tried my bundle using POSTman and it worked so there must be something wroing with the transaction textbox feature on the hapi landing page. I also confirmed that I must use the syntax Simone specified for conditional creates vs updates i.e.</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"n\">You</span> <span class=\"n\">should</span> <span class=\"n\">have</span> <span class=\"n\">either</span>\n <span class=\"n\">method</span> <span class=\"o\">=</span> <span class=\"n\">PUT</span>\n <span class=\"n\">url</span> <span class=\"o\">=</span> <span class=\"n\">condition</span>\n <span class=\"n\">OR</span>\n <span class=\"n\">method</span> <span class=\"o\">=</span> <span class=\"n\">POST</span>\n <span class=\"n\">ifNoneMatch</span> <span class=\"o\">=</span> <span class=\"n\">condition</span>\n</pre></div>",
        "id": 153828490,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463609754
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153828522,
        "sender_full_name": "Paul Barry",
        "timestamp": 1463620288
    },
    {
        "content": "<p>Ahhhh ok, so it sounds like this is an issue with the Test Web UI as opposed to the server. That makes sense, I hadn't tested that.</p>\n<p>When you're in the UI, are you targeting the DSTU2 endpoint or the DSTU3?</p>",
        "id": 153828688,
        "sender_full_name": "James Agnew",
        "timestamp": 1463679392
    }
]