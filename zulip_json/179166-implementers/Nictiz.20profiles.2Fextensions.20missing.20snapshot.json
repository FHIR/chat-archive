[
    {
        "content": "<p>We are trying to add support for NL/Nictiz profiles/extensions and are unable to find/download the profiles/extensions with snapshot provided. If a profile doesn't have a snapshot filled, the validator(R4) gives a meaningful error message \"StructureDefinition has no snapshot - validation is against the snapshot, so it must be provided\". However, if the one of the extensions do not have a snapshot, it results in a IndexOutOfBoundException as the validator seems to be looking for the first element even if none exists. The problematic line is <a href=\"https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157\">https://github.com/jamesagnew/hapi-fhir/blob/master/hapi-fhir-validation/src/main/java/org/hl7/fhir/r4/validation/InstanceValidator.java#L1157</a></p>",
        "id": 167520715,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559853774
    },
    {
        "content": "<p>Two questions<br>\n1. Can anyone help me find the Nictiz STU3 Zib2017 profiles with snapshot filled?<br>\n2. Can the above bug be fixed in the Validator?</p>",
        "id": 167520932,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559853918
    },
    {
        "content": "<p>It really is a bug in the validator that it's not generating the snapshot, but for now you can use <a href=\"https://simplifier.net/downloads/torinox\" target=\"_blank\" title=\"https://simplifier.net/downloads/torinox\">Torinox</a> to create them <span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span></p>",
        "id": 167523176,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1559855422
    },
    {
        "content": "<p>I dont think the validator generates the snapshot as such. It relies on the snapshots to be already provided.</p>",
        "id": 167544470,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559879766
    },
    {
        "content": "<p>I am still googling for Nictiz profiles with snapshots but so far am unsuccessful. I know I can use the RI tooling to generate snapshots but isn't it the understanding that profiles should publish snapshot for them to be used in validation?</p>",
        "id": 167544604,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559879944
    },
    {
        "content": "<p>We are getting this issue very often because the current tooling (Simplifier et al) doesn't seem to publish profiles with snapshot.</p>",
        "id": 167544809,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559880145
    },
    {
        "content": "<p>the validator does not rely on the snapshots to be generated as of 48 hours ago (thanks <span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> )</p>",
        "id": 167546515,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559882466
    },
    {
        "content": "<p>So there's no such understanding that snapshots are mandatory for validation and it is just a deficiency in the validator implementation?</p>",
        "id": 167547252,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559883479
    },
    {
        "content": "<p>it was a bug - snapshots used to be generated and they are again now</p>",
        "id": 167547328,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883560
    },
    {
        "content": "<p>Unfortunately I still have to wait for the next release of HAPI to get this change and I am not sure if this helps me at all.</p>",
        "id": 167547339,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559883591
    },
    {
        "content": "<p>well, you should be using the R5 validator now, not the R4 one. The R4 one is no longer maintained. I need to get around to cleaning up the code so I can delete it.</p>",
        "id": 167547425,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883695
    },
    {
        "content": "<p>You'll have to ask on HAPI support when the next release is due</p>",
        "id": 167547430,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883712
    },
    {
        "content": "<p>OK, I am sorry, my understanding of the profile publication process is very limited. Are you saying that the profiles would indeed be published with snapshots?</p>",
        "id": 167547477,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559883730
    },
    {
        "content": "<p>or you can generate the snapshots yourself - it's pretty straight forward:</p>",
        "id": 167547480,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883733
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>  <span class=\"kd\">public</span> <span class=\"kt\">void</span> <span class=\"nf\">prepare</span><span class=\"o\">()</span> <span class=\"o\">{</span>\n    <span class=\"k\">for</span> <span class=\"o\">(</span><span class=\"n\">StructureDefinition</span> <span class=\"n\">sd</span> <span class=\"o\">:</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"na\">allStructures</span><span class=\"o\">())</span> <span class=\"o\">{</span>\n      <span class=\"k\">try</span> <span class=\"o\">{</span>\n        <span class=\"n\">makeSnapshot</span><span class=\"o\">(</span><span class=\"n\">sd</span><span class=\"o\">);</span>\n      <span class=\"o\">}</span> <span class=\"k\">catch</span> <span class=\"o\">(</span><span class=\"n\">Exception</span> <span class=\"n\">e</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n        <span class=\"n\">System</span><span class=\"o\">.</span><span class=\"na\">out</span><span class=\"o\">.</span><span class=\"na\">println</span><span class=\"o\">(</span><span class=\"s\">&quot;Process Note: Unable to generate snapshot for &quot;</span><span class=\"o\">+</span><span class=\"n\">sd</span><span class=\"o\">.</span><span class=\"na\">present</span><span class=\"o\">());</span>\n      <span class=\"o\">}</span>\n    <span class=\"o\">}</span>\n  <span class=\"o\">}</span>\n\n  <span class=\"kd\">private</span> <span class=\"kt\">void</span> <span class=\"nf\">makeSnapshot</span><span class=\"o\">(</span><span class=\"n\">StructureDefinition</span> <span class=\"n\">sd</span><span class=\"o\">)</span> <span class=\"kd\">throws</span> <span class=\"n\">DefinitionException</span><span class=\"o\">,</span> <span class=\"n\">FHIRException</span> <span class=\"o\">{</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">sd</span><span class=\"o\">.</span><span class=\"na\">hasSnapshot</span><span class=\"o\">())</span>\n      <span class=\"k\">return</span><span class=\"o\">;</span>\n    <span class=\"n\">StructureDefinition</span> <span class=\"n\">sdb</span> <span class=\"o\">=</span> <span class=\"n\">context</span><span class=\"o\">.</span><span class=\"na\">fetchResource</span><span class=\"o\">(</span><span class=\"n\">StructureDefinition</span><span class=\"o\">.</span><span class=\"na\">class</span><span class=\"o\">,</span> <span class=\"n\">sd</span><span class=\"o\">.</span><span class=\"na\">getBaseDefinition</span><span class=\"o\">());</span>\n    <span class=\"k\">if</span> <span class=\"o\">(</span><span class=\"n\">sdb</span> <span class=\"o\">!=</span> <span class=\"kc\">null</span><span class=\"o\">)</span> <span class=\"o\">{</span>\n      <span class=\"n\">makeSnapshot</span><span class=\"o\">(</span><span class=\"n\">sdb</span><span class=\"o\">);</span>\n      <span class=\"k\">new</span> <span class=\"n\">ProfileUtilities</span><span class=\"o\">(</span><span class=\"n\">context</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"kc\">null</span><span class=\"o\">).</span><span class=\"na\">generateSnapshot</span><span class=\"o\">(</span><span class=\"n\">sdb</span><span class=\"o\">,</span> <span class=\"n\">sd</span><span class=\"o\">,</span> <span class=\"n\">sd</span><span class=\"o\">.</span><span class=\"na\">getUrl</span><span class=\"o\">(),</span> <span class=\"kc\">null</span><span class=\"o\">,</span> <span class=\"n\">sd</span><span class=\"o\">.</span><span class=\"na\">getName</span><span class=\"o\">());</span>\n    <span class=\"o\">}</span>\n\n  <span class=\"o\">}</span>\n</pre></div>",
        "id": 167547493,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883772
    },
    {
        "content": "<p>the IG publisher always publishes snapshots as well. But it's not a requirement to do that. So add that code above somewhere in your loading code, and you should be right</p>",
        "id": 167547517,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559883818
    },
    {
        "content": "<p>Yes, I am aware of this like I mentioned. (ProfileUtilities/RI Tooling)</p>",
        "id": 167547522,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559883838
    },
    {
        "content": "<p>Thanks for your help. I will proceed this route. But IGs are not required to publish snapshots any more?</p>",
        "id": 167547590,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559883894
    },
    {
        "content": "<p>since I don't think we ever required IGs to publish snap shots, I don't think you can say that we don't require it anymore. The IG Publisher will continue to publish them though - and I am pushing all the tool chains to end up in the IG publisher</p>",
        "id": 167547895,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559884276
    },
    {
        "content": "<p>We may require that, yet</p>",
        "id": 167547899,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559884291
    },
    {
        "content": "<p>IGs that meet HL7's quality criteria will have to have snapshots to render properly.  And if they're producing the snapshots, I think it's reasonable to expect them to publish them.  However, not all IGs will necessarily meet HL7's quality criteria</p>",
        "id": 167585654,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1559920638
    },
    {
        "content": "<p>Even after generating snapshot, I see that some of the Nictiz profiles have issues with them. RI/HAPI's R4 validator gives the below errors<br>\neOverdrachtTransferDate.json</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;issue&quot;: [\n        {\n            &quot;extension&quot;: [\n                {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n                    &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n                }\n            ],\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;invariant&quot;,\n            &quot;details&quot;: {\n                &quot;text&quot;: &quot;Constraints must be unique by key [constraint.select(key).isDistinct()]&quot;\n            },\n            &quot;location&quot;: [\n                &quot;StructureDefinition.snapshot.element[1] (line 1, col 996)&quot;\n            ]\n        }\n    ]\n}\n</pre></div>\n\n\n<p>eAfspraakAppointmentOnlineEditable.json, ZIB-Deviating-Administration.json, MedicationOverview-Verification.json</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n    &quot;issue&quot;: [\n        {\n            &quot;extension&quot;: [\n                {\n                    &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n                    &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n                }\n            ],\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;invariant&quot;,\n            &quot;details&quot;: {\n                &quot;text&quot;: &quot;No slicing on the root element [element.first().slicing.empty()]&quot;\n            },\n            &quot;location&quot;: [\n                &quot;StructureDefinition.differential&quot;\n            ]\n        }\n    ]\n}\n</pre></div>\n\n\n<p>I got the second error on Grahame Grieve's server at <a href=\"http://test.fhir.org/r3\" target=\"_blank\" title=\"http://test.fhir.org/r3\">http://test.fhir.org/r3</a> but not the first</p>",
        "id": 167623961,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559952142
    },
    {
        "content": "<p>Any body from HL7 NL/Nictiz in this forum?</p>",
        "id": 167623997,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559952204
    },
    {
        "content": "<p>The first error is due to the derived extension (re)defining the ext-1 constraint that is already declared in base. The second error is due to not having the root element <code>Extension</code> in the differential and starting with <code>Extension.extension</code> and slicing it.</p>",
        "id": 167624137,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1559952383
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>  on the first error. The validator in <a href=\"http://test.fhir.org/r3\" target=\"_blank\" title=\"http://test.fhir.org/r3\">test.fhir.org/r3</a> is running behind, and is not reliable</p>",
        "id": 167629806,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559961667
    },
    {
        "content": "<p>Hi all: we are waiting for Simplifier to produce snapshots in the package upon producing a package. We really don't want them in our master definitions. Because we ourselves also need the snapshots for Touchstone, we have decided to produce them separately in GitHub: <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases\">https://github.com/Nictiz/Nictiz-STU3-Zib2017/releases</a>. <span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span></p>",
        "id": 167647652,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1559994114
    },
    {
        "content": "<p>Sorry for coming late to the thread with this info. It is still a good thing for the validator to handle the snapshots. Thanks for that <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 167647713,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1559994235
    },
    {
        "content": "<blockquote>\n<p>on the first error. The validator in <a href=\"http://test.fhir.org/r3\" target=\"_blank\" title=\"http://test.fhir.org/r3\">test.fhir.org/r3</a> is running behind, and is not reliable</p>\n</blockquote>\n<p>Not sure if that affects us, but it might affect our implementers.</p>",
        "id": 167647822,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1559994418
    },
    {
        "content": "<p>Thanks a lot <span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span></p>",
        "id": 167801003,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1560204591
    },
    {
        "content": "<p>RI/HAPI validation issues with the snapshots<br>\nStructureDefinition - 400 zib-Infusion-Product.json<br>\nStructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 images-List.json<br>\nStructureDefinition.snapshot.element[20].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 zib-FeedingTubeSystem-Product.json<br>\nStructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 nl-core-person.json<br>\nStructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.differential - No slicing on the root element [element.first().slicing.empty()<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"structure\",\"details\":{\"text\":\"URI values cannot have whitespace\"},\"location\":[\"StructureDefinition.snapshot.element[16].example.valueUri (line 1, col 20183)\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"No slicing on the root element [element.first().slicing.empty()]\"},\"location\":[\"StructureDefinition.differential\"]}]}</p>\n<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-Organization.json<br>\nStructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 gp-DiagnosticResult.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"No slicing on the root element [element.first().slicing.empty()]\"},\"location\":[\"StructureDefinition.differential\"]}]}</p>\n<p>StructureDefinition - 400 images-Media.json<br>\nStructureDefinition.snapshot.element[23].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 zib-VaccinationRecommendation.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[4].binding\"]}]}</p>\n<p>StructureDefinition - 400 nl-core-practitioner.json<br>\nStructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 zib-MedicalDeviceProduct.json<br>\nStructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 nl-core-organization.json<br>\nStructureDefinition.snapshot.element[16].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[25].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[34].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 zib-AdministrationAgreement.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[13].binding\"]}]}</p>\n<p>StructureDefinition - 400 gp-LaboratoryResult.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"No slicing on the root element [element.first().slicing.empty()]\"},\"location\":[\"StructureDefinition.differential\"]}]}</p>\n<p>StructureDefinition - 400 zib-Infusion.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[5].binding\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[7].binding\"]}]}</p>\n<p>StructureDefinition - 400 MedicationOverview.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"No slicing on the root element [element.first().slicing.empty()]\"},\"location\":[\"StructureDefinition.differential\"]}]}</p>\n<p>StructureDefinition - 400 zib-DrugUse.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"code-invalid\",\"details\":{\"text\":\"Coding.system must be an absolute reference, not a local reference\"},\"location\":[\"StructureDefinition.snapshot.element[111].example.valueCodeableConcept.coding (line 1, col 159521)\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"code-invalid\",\"details\":{\"text\":\"Coding.system must be an absolute reference, not a local reference\"},\"location\":[\"StructureDefinition.differential.element[27].example.valueCodeableConcept.coding (line 1, col 159521)\"]}]}</p>\n<p>StructureDefinition - 400 zib-Infusion-AdministeringSystem.json<br>\nStructureDefinition.snapshot.element[28].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-AdministrationAgreement.json<br>\nStructureDefinition.snapshot.element[27].example.valueUri - URI values cannot have whitespace</p>\n<p>StructureDefinition - 400 mp612-DispenseToFHIRConversion-Dispense.json<br>\nStructureDefinition.snapshot.element[29].example.valueUri - URI values cannot have whitespace<br>\nStructureDefinition.snapshot.element[39].example.valueUri - URI values cannot have whitespace </p>\n<p>StructureDefinition - 400 zib-FreedomRestrictingMeasures.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[4].binding\"]}]}</p>\n<p>StructureDefinition - 400 zib-MedicationAdministration.json<br>\nStructureDefinition.snapshot.element[28].example.valueUri - URI values cannot have whitespace </p>\n<p>StructureDefinition - 400 zib-TobaccoUse.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"structure\",\"details\":{\"text\":\"if a date has a time, it must have a timezone\"},\"location\":[\"StructureDefinition.snapshot.element[33].example.valueDateTime (line 1, col 159553)\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"structure\",\"details\":{\"text\":\"if a date has a time, it must have a timezone\"},\"location\":[\"StructureDefinition.differential.element[11].example.valueDateTime (line 1, col 159553)\"]}]}</p>\n<p>StructureDefinition - 400 zib-MedicationAgreement.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"structure\",\"details\":{\"text\":\"URI values cannot have whitespace\"},\"location\":[\"StructureDefinition.snapshot.element[72].example.valueCodeableConcept.coding.system (line 1, col 176179)\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[12].binding\"]},{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"structure\",\"details\":{\"text\":\"URI values cannot have whitespace\"},\"location\":[\"StructureDefinition.differential.element[38].example.valueCodeableConcept.coding.system (line 1, col 176179)\"]}]}</p>\n<p>StructureDefinition - 400 zib-MedicationUse.json<br>\n{\"resourceType\":\"OperationOutcome\",\"issue\":[{\"extension\":[{\"url\":\"http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source\",\"valueCode\":\"InstanceValidator\"}],\"severity\":\"error\",\"code\":\"invariant\",\"details\":{\"text\":\"provide either a reference or a description (or both) [valueSet.exists() or description.exists()]\"},\"location\":[\"StructureDefinition.differential.element[10]</p>",
        "id": 167810884,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1560216385
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> can you please let me know if I should post these issues somewhere? Is there a tracker for Nictiz?</p>",
        "id": 168184195,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1560561454
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> : bugs for this should be reported through <a href=\"https://bits.nictiz.nl/browse/MM\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM\">https://bits.nictiz.nl/browse/MM</a>. Login not required, all bugs are public</p>",
        "id": 168397491,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560862615
    },
    {
        "content": "<p>I see a lot of errors are about a white in a URI. Example fragment of where that goes sour:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;example&gt;\n  &lt;label value=&quot;General&quot; /&gt;\n  &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient or urn:ietf:rfc:3986 if the Identifier.value itself is a full uri&quot; /&gt;\n&lt;/example&gt;\n</pre></div>\n\n\n<p>I've tracked back to where that comes from, and the source is in the dependency we have on the FHIR Core Datatypes as expressed in Simplifier here: <a href=\"https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml\" target=\"_blank\" title=\"https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml\">https://simplifier.net/Simplifier.Core.Stu3.DataTypes/Identifier/~xml</a></p>\n<p><span class=\"user-mention\" data-user-id=\"191335\">@Martijn Harthoorn</span> / <span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> : Could one of you comment here?</p>",
        "id": 168398739,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560863442
    },
    {
        "content": "<p>This 'error' is a bug in HAPI/the fhirPath expression:</p>\n<div class=\"codehilite\"><pre><span></span>StructureDefinition - 400 nl-core-person.json\nStructureDefinition.differential - No slicing on the root element [element.first().slicing.empty()\n</pre></div>\n\n\n<p>The fragment it considers is this:</p>\n<div class=\"codehilite\"><pre><span></span>  &lt;differential&gt;\n    &lt;element id=&quot;Person.identifier&quot;&gt;\n      &lt;path value=&quot;Person.identifier&quot; /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=&quot;value&quot; /&gt;\n          &lt;path value=&quot;system&quot; /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=&quot;open&quot; /&gt;\n      &lt;/slicing&gt;\n</pre></div>\n\n\n<p>As you can see, there is slicing on the first element in the differential, but that element is not the root element of the resource. Hence the check does not apply. The same is true for every other occurrence of this error. We never sliced the root element in the differential. Forge will always remove elements from the differential that do not have any change in them. Hence, unless we 'fake' a change in the resource root element, it will not be present in the differential.</p>",
        "id": 168398943,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560863565
    },
    {
        "content": "<p>This is another bug in the HAPI validator:</p>\n<div class=\"codehilite\"><pre><span></span>StructureDefinition - 400 zib-AdministrationAgreement.json\n&quot;provide either a reference or a description (or both) [valueSet.exists() or description.exists()]&quot;\n</pre></div>\n\n\n<p>The fragment is:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;binding&gt;\n  &lt;strength value=&quot;required&quot; /&gt;\n&lt;/binding&gt;\n</pre></div>\n\n\n<p>What this does is make the binding strength required while the full valueset binding/description lives in the extension in this path. While you 'could' restate valueSet+description this is just error prone. As far ass I know the validator check that trigger this false negative has been updated to only work on bindings in the snapshot where everything is expected to be completed (which it is).</p>",
        "id": 168399737,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560864104
    },
    {
        "content": "<p>I believe these three types of errors are the only ones listed. Of those there isn't anything we can do right now as we depend on an updated datatype package in Simplifier, and on relaxed validation in HAPI, as far as I can tell. I'm not sure how to request an update for HAPI, but I believe <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> co maintains the underlying logic?</p>",
        "id": 168400161,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560864379
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> concerning the first issue, looks like an error in the official STU3 core definition of Identifier datatype (in profiles-types), seems fixed in R4.</p>\n<p>[STU3] profiles-types.xml:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;element id=&quot;Identifier.system&quot;&gt;\n  &lt;!-- ... --&gt;\n  &lt;example&gt;\n    &lt;label value=&quot;General&quot; /&gt;\n    &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient or urn:ietf:rfc:3986 if the Identifier.value itself is a full uri&quot; /&gt;\n  &lt;/example&gt;\n</pre></div>\n\n\n<p>[R4] profiles-types.xml:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;element id=&quot;Identifier.system&quot;&gt;\n  &lt;!-- ... --&gt;\n  &lt;example&gt;\n    &lt;label value=&quot;General&quot;/&gt;\n    &lt;valueUri value=&quot;http://www.acme.com/identifiers/patient&quot;/&gt;\n  &lt;/example&gt;\n</pre></div>\n\n\n<p>Note that the STU3 definition specifies an invalid example uri value.</p>",
        "id": 168405154,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1560867504
    },
    {
        "content": "<p>Spurious warnings about invalid slice names on the root element have been reported for a while, this is a known bug in the Java validator. Invariant sdf-20 disallows slice names on the <em>root</em> element; however the first element included in the differential component may (and often will) not be the root element.</p>",
        "id": 168405671,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1560867835
    },
    {
        "content": "<p>these all look like issues in the invariants - please create tasks for when we release a patch on R3 in about 6 weeks time</p>",
        "id": 168439022,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560880731
    },
    {
        "content": "<p>sdf-20 seems sufficiently covered for STU3: <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20391\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20391\">GF#20391</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20339\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=20339\">GF#20339</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13768\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13768\">GF#13768</a></p>\n<p>eld-10 is was fixed through <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13782\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13782\">GF#13782</a> in R4 -- I added <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22712\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22712\">GF#22712</a> to flag it for STU3</p>\n<p>the illegal datatype example is discussed here: <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17431\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=17431\">GF#17431</a> -- I added <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22711\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=22711\">GF#22711</a> to flag it for STU3</p>\n<p>Let me know if you need anything else <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 168463434,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560899091
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> : Thanks. As long as the illegal example is in the Simplifier core datatype package, it would seem impossible to produce valid snapshots as identifier.system is in any snapshot. We could wait for the official patch on STU3 to be released, update Simplifier and then update our dependency, and in the mean try hold off publications on our side. Alternatively we could patch all snapshots after creating them. The other option is an update in the identifier.system example in advance of the official STU3 patch.<br>\nWhat would you advise?</p>",
        "id": 168463782,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560899505
    },
    {
        "content": "<p>We ignored validation of the profiles for now and moved on to validating the published example resources against these profiles. For Appointment examples, the errors we get are (other than trivial processing instruction and xsi:schemaLocation errors):</p>\n<ul>\n<li>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile <a href=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</li>\n<li>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyUZI in profile <a href=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</li>\n</ul>",
        "id": 168543420,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1560976580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>, not sure if this works for you, but since this is caused by an issue in the spec and is therefore out of your control, I'd propose to ignore the invalid uri validation error for now (i.e. consider this a \"known issue\"), until HL7 has published a technical correction.<br>\nHowever if that causes confusion and you really need to suppress the validation error, then I suggest to (temporarily) override the invalid uri example values in the diff of all the consuming profiles.</p>",
        "id": 168582820,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1561025429
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> Thanks. We would not notice this as we do not check the snapshots through HAPI. We load them in Touchstone. It they work there, we assume they are valid. Touchstone uses the validator (STU3).</p>\n<p>In a sense it is a good thing that Simplifier cannot produce snapshots yet. We produce those separate from the package, so we can also post-process them and just kick out the problematic examples before uploading to github</p>",
        "id": 168596806,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1561038511
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> I honestly do not know what that error means. Appointment.specialty has two slices defined. Each carries an extensible binding to a ValueSet. The ValueSets have different systems they bind to.</p>\n<p>I cannot reproduce what you saw when I validate the examples on Simplifier (other things, but not that)</p>",
        "id": 168598051,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1561039239
    },
    {
        "content": "<p>Sorry for restarting this old thread. We had tried to validate profiles and valuesets from Nictiz 1.2.0 release ignoring some of the validation errors from above. Now only 2 issues remain w.r.t. profiles<br>\n<code>zib-TobaccoUse.xml</code>: The example dateTime value does not have a timezone as per the spec.</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;if a date has a time, it must have a timezone&quot;\n      },\n      &quot;location&quot;: [\n        &quot;StructureDefinition.snapshot.element[33].example.valueDateTime (line 1, col 52887)&quot;\n      ]\n    },\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;if a date has a time, it must have a timezone&quot;\n      },\n      &quot;location&quot;: [\n        &quot;StructureDefinition.differential.element[11].example.valueDateTime (line 1, col 222920)&quot;\n      ]\n    }\n  ]\n}\n</pre></div>\n\n\n<p><code>zib-DrugUse.xml</code>: The example coding for <code>Observation.component:RouteOfAdministration.value[x]:valueCodeableConcept</code> uses a OID without specifying it as urn:oid:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;system value=&quot;2.16.840.1.113883.2.4.4.9&quot; /&gt;\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;code-invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;Coding.system must be an absolute reference, not a local reference&quot;\n      },\n      &quot;location&quot;: [\n        &quot;StructureDefinition.snapshot.element[111].example.valueCodeableConcept.coding (line 1, col 172501)&quot;\n      ]\n    },\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;code-invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;Coding.system must be an absolute reference, not a local reference&quot;\n      },\n      &quot;location&quot;: [\n        &quot;StructureDefinition.differential.element[27].example.valueCodeableConcept.coding (line 1, col 224000)&quot;\n      ]\n    }\n  ]\n}\n</pre></div>",
        "id": 177107661,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569972308
    },
    {
        "content": "<p>Next, coming to ValueSets, there is one error in <code>RedenWijzigenStakenMedicatiegebruikCodelijst-2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254.xml</code> with url <code>http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254</code><br>\nThe error is with display having a whitespace at the start as shown below</p>\n<div class=\"codehilite\"><pre><span></span>&lt;include&gt;\n            &lt;system value=&quot;urn:oid:2.16.840.1.113883.2.4.3.11.60.20.77.5.2.2&quot;/&gt;\n            &lt;concept&gt;\n                &lt;code value=&quot;16&quot;/&gt;\n                &lt;display value=&quot; Allergie of non-allergische overgevoeligheid of bijwerking&quot;/&gt;\n            &lt;/concept&gt;\n</pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [\n    {\n      &quot;extension&quot;: [\n        {\n          &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/operationoutcome-issue-source&quot;,\n          &quot;valueCode&quot;: &quot;InstanceValidator&quot;\n        }\n      ],\n      &quot;severity&quot;: &quot;warning&quot;,\n      &quot;code&quot;: &quot;invalid&quot;,\n      &quot;details&quot;: {\n        &quot;text&quot;: &quot;value should not start or finish with whitespace&quot;\n      },\n      &quot;location&quot;: [\n        &quot;ValueSet.compose.include[3].concept[1].display (line 1, col 3553)&quot;\n      ]\n    }\n  ]\n}\n</pre></div>",
        "id": 177107819,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569972471
    },
    {
        "content": "<p>Also, there seem to be atleast 11 ValueSets which include the whole of SNOMED-CT without any filter as below</p>\n<div class=\"codehilite\"><pre><span></span>&lt;compose&gt;\n        &lt;include&gt;\n            &lt;system value=&quot;http://snomed.info/sct&quot;/&gt;\n        &lt;/include&gt;\n    &lt;/compose&gt;\n</pre></div>\n\n\n<p>Since we pre-compute the expansions at the time of writing of ValueSet, this causes enormous delays in importing these ValueSets.</p>",
        "id": 177108040,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569972643
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span></p>",
        "id": 177109852,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569974459
    },
    {
        "content": "<blockquote>\n<p>Since we pre-compute the expansions at the time of writing of ValueSet</p>\n</blockquote>\n<p>You can't do that</p>",
        "id": 177110309,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1569974906
    },
    {
        "content": "<p>Well, if we dont pre-compute, then testing for ValueSet membership during resource validation would be very costly right? We were OK with pre-computing during ValueSet Create/Update for base and US Core. If I remember correctly, other than encounter-reason and body-site, the other valuesets are not big.</p>",
        "id": 177112564,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569977481
    },
    {
        "content": "<p>that was just chance. The $validate-code operation is what the validator uses, so that you don't have to pre-compute expansions</p>",
        "id": 177115039,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1569981218
    },
    {
        "content": "<p>Yes, we implemented $validate-code based on the expansions. Otherwise, we would have had to expand the ValueSet at the $validate-code invocation which would be very costly.</p>",
        "id": 177120390,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569989962
    },
    {
        "content": "<p>Of course, we could have avoided duplicating whole code systems like SNOMED-CT as part of expansion, but I am wondering about the reason having many ValueSets including/importing whole of SNOMED-CT.</p>",
        "id": 177120577,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569990243
    },
    {
        "content": "<p>because any SNOMED code is valid</p>",
        "id": 177121221,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1569991372
    },
    {
        "content": "<p>Isn't that possible/preferable using <code>ValueSet.compose.include.valueSet</code> either using the implicit SNOMED ValueSet uri or using an explicitly defined ValueSet? Is there any advantage to have many ValueSets independently including from SNOMED? Sorry for the newbie questions, just trying to understand better.</p>",
        "id": 177123526,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569995481
    },
    {
        "content": "<p>But anyway, this is not breaking us currently, just some multi second delay to load the ValueSet. I really appreciate if anyone can answer regarding the other issues above</p>",
        "id": 177123580,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569995554
    },
    {
        "content": "<p>Also, while validating the Nictiz published resource examples against the profiles, the major cause of errors seems to be with slicing like below:</p>",
        "id": 177123664,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569995723
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment - does not have fixed value, binding or existence assertions\n</pre></div>",
        "id": 177123667,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569995728
    },
    {
        "content": "<p>That accounts for nearly 70% of validation errors from RI/HAPI.</p>",
        "id": 177123737,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1569995827
    },
    {
        "content": "<blockquote>\n<p>Is there any advantage to have many ValueSets independently including from SNOMED</p>\n</blockquote>\n<p>No, there isn't.</p>",
        "id": 177124681,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1569997272
    },
    {
        "content": "<p>but quite a few systems can't cope with the implicit value sets for SNOMED CT</p>",
        "id": 177124702,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1569997302
    },
    {
        "content": "<blockquote>\n<p>Next, coming to ValueSets, there is one error in RedenWijzigenStakenMedicatiegebruikCodelijst-2.16.840.1.113883.2.4.3.11.60.20.77.11.37--20181218104254.xml &lt;snip&gt; The error is with display having a whitespace at the start as shown below</p>\n</blockquote>\n<p>The ValueSets you see are created as exports from non FHIR CodeSystems/ValueSets. I think it is principally wrong in FHIR to have an invariant that effectively limits what a valid display name for a given code in a code system can be. It is just not for FHIR to decide. That invariant imho has to go away. That being said: in this particular case we can influence the master definition and so I have. We have just released an update to the package 1.2.0 yesterday. The next one is planned for end of October.</p>\n<p>Note: I have not been able to find any invariant in the spec that governs the error from the validator (<a href=\"http://hl7.org/fhir/STU3/valueset.html\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/valueset.html\">http://hl7.org/fhir/STU3/valueset.html</a>) so it might be that the error lives in the validator only.</p>\n<p>I've logged: <a href=\"https://bits.nictiz.nl/browse/MM-593\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-593\">https://bits.nictiz.nl/browse/MM-593</a></p>",
        "id": 177130436,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570004317
    },
    {
        "content": "<p>actually the issue is in the terminology server. I've fixed it but not deployed it.</p>",
        "id": 177131395,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570005472
    },
    {
        "content": "<p>The invariant simply says that a display can't have leading or trailing whitespace, and that's anchored in XML rules. You can't really claim that the whitespace is meaningful?</p>",
        "id": 177131460,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570005523
    },
    {
        "content": "<blockquote>\n<p>can you please let me know if I should post these issues somewhere? Is there a tracker for Nictiz?</p>\n</blockquote>\n<p>As replied here before: bugs for this should be reported through <a href=\"https://bits.nictiz.nl/browse/MM\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM\">https://bits.nictiz.nl/browse/MM</a>. Login not required, all issues are public</p>",
        "id": 177131595,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570005681
    },
    {
        "content": "<blockquote>\n<p>The invariant simply says that a display can't have leading or trailing whitespace, and that's anchored in XML rules. You can't really claim that the whitespace is meaningful?</p>\n</blockquote>\n<p>I cannot and I am not. I'm just saying the the terminologists do what they do in creating the display names. I just apply a FHIR 'jacket' or syntax to it. FHIR should not judge the whitespace on display names: they are outside of FHIRs span of control.</p>\n<p>That being said: in this very case I am able to talk to the creators directly and have already convinced them to drop the leading whitespace even though the definition was already final and published in many other forms than just for FHIR. So: this problem will be solved, but the bigger picture still remains.</p>",
        "id": 177131838,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570005935
    },
    {
        "content": "<blockquote>\n<p>Also, there seem to be at least 11 ValueSets which include the whole of SNOMED-CT without any filter as below &lt;snip&gt; Since we pre-compute the expansions at the time of writing of ValueSet, this causes enormous delays in importing these ValueSets.</p>\n</blockquote>\n<p>I understand it may be cumbersome to deal with that, but there simply is no reuse of value sets by the underlying zibs by design. Whenever there is a need for a value set, the definition is crafted for that specific purpose. The decision making process at the ZIB Centrum in crafting terminology for the zibs has decided that reuse of value sets is not semantically possible because each context is unique. The advantage is that maintenance on any given value set created this way can be done with only 1 context in mind.</p>\n<p>I may or may not agree with you that a value set that lists SNOMED CT without any restriction is not a very useful or even perhaps semantically sound statement in a given context, but discussing changes can only be done through the ZIB  Centrum that governs the zib contents that the FHIR IGs depend on. You may find the ZIB Centrum information here <a href=\"https://www.nictiz.nl/standaardisatie/zib-centrum/\" target=\"_blank\" title=\"https://www.nictiz.nl/standaardisatie/zib-centrum/\">https://www.nictiz.nl/standaardisatie/zib-centrum/</a></p>",
        "id": 177132447,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570006558
    },
    {
        "content": "<blockquote>\n<p>We had tried to validate profiles and valuesets from Nictiz 1.2.0 release ignoring some of the validation errors from above. Now only 2 issues remain w.r.t. profiles zib-TobaccoUse.xml: The example dateTime value does not have a timezone as per the spec.</p>\n</blockquote>\n<p>Maybe I misread the spec, but I don't see that requirement for <a href=\"http://hl7.org/fhir/STU3/datatypes.html#datetime\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/datatypes.html#datetime\">dateTime</a>. Only for <a href=\"http://hl7.org/fhir/STU3/datatypes.html#instant\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/datatypes.html#instant\">instant</a>. I have also validated the example manually against the regex pattern in the spec and found it matched. Why would you say it is not?</p>\n<p>matches('2012-02-28T00:00:00', '-?[0-9]{4}(-(0[1-9]|1[0-2])(-(0[0-9]|[1-2][0-9]|3[0-1])(T([01][0-9]|2[0-3]):[0-5][0-9]:[0-5]<a href=\"http://\\.[0-9]+\" target=\"_blank\" title=\"http://\\.[0-9]+\">0-9</a>?(Z|(\\+|-)((0[0-9]|1[0-3]):[0-5][0-9]|14:00)))?)?)?')</p>",
        "id": 177132758,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570006888
    },
    {
        "content": "<blockquote>\n<p>\"If hours and minutes are specified, a time zone SHALL be populated\"</p>\n</blockquote>",
        "id": 177135458,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570009615
    },
    {
        "content": "<p>Right, that is true. I've read right past that. <span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> I've flagged this for update in the next update cycle here: <a href=\"https://bits.nictiz.nl/browse/MM-594\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-594\">https://bits.nictiz.nl/browse/MM-594</a></p>",
        "id": 177146087,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570020654
    },
    {
        "content": "<blockquote>\n<p>Could not match discriminator (coding.system) for slice Appointment.specialty:specialtyAGB in profile <a href=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment\">http://nictiz.nl/fhir/StructureDefinition/eAfspraak-Appointment</a> - does not have fixed value, binding or existence assertions</p>\n</blockquote>\n<p>I dont see any ElementDefinition for the element corresponding to the discriminator coding.system with type as value. I think  this is a common problem across many Nictiz profiles. I will open a tracker item for this.</p>",
        "id": 177181449,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1570042886
    },
    {
        "content": "<p>Posted <a href=\"https://bits.nictiz.nl/browse/MM-597\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-597\">https://bits.nictiz.nl/browse/MM-597</a> for the issue with zib-DrugUse.xml using a OID without urn:oid</p>",
        "id": 177185067,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1570045478
    },
    {
        "content": "<blockquote>\n<p>Each slice must use the element definition for the element in the discriminator(s) to ensure that the slices are clearly differentiated (by assigning a fixed value, a specific type, or a profile, depending on the discriminator type. If the type is 'value', then the element definition must use either ElementDefinition.fixed[x] or, if the element has a terminology binding, a required binding with a Value Set that enumerates the list of possible codes in the value set (\"extensional definition\").</p>\n</blockquote>\n<p>Is my understanding right that the profile should have the ElementDefinition for the element corresponding to the path given in discriminator?</p>",
        "id": 177188866,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1570047888
    },
    {
        "content": "<p>Posted <a href=\"https://bits.nictiz.nl/browse/MM-598\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-598\">https://bits.nictiz.nl/browse/MM-598</a> for the issue <code>Could not match discriminator ... for slice ... in profile ...  - does not have fixed value, binding or existence assertions</code></p>",
        "id": 177193786,
        "sender_full_name": "Anand Mohan Tumuluri",
        "timestamp": 1570051407
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> We slice by value set in a number of cases. Each value set carries codes from a different system, so we define our discriminator based on value of system. Apparently HAPI has beef with that. We have not heard complaints from other systems thus far.</p>\n<ul>\n<li>Is what we do allowable? I believe so, but just checking</li>\n<li>Is there a better way?</li>\n<li>Would having required bindings rather than extensible help here?</li>\n</ul>\n<p>Example:</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;PractitionerRole.specialty.coding&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=&quot;value&quot; /&gt;\n          &lt;path value=&quot;system&quot; /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=&quot;open&quot; /&gt;\n      &lt;/slicing&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;sliceName value=&quot;SpecialtyUZI&quot; /&gt;\n        &lt;strength value=&quot;extensible&quot; /&gt;\n        &lt;valueSetReference&gt;\n          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.6--20171231000000&quot; /&gt;\n          &lt;display value=&quot;SpecialismeUZICodelijst&quot; /&gt;\n        &lt;/valueSetReference&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;sliceName value=&quot;SpecialtyAGB&quot; /&gt;\n        &lt;strength value=&quot;extensible&quot; /&gt;\n        &lt;valueSetReference&gt;\n          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.7--20171231000000&quot; /&gt;\n          &lt;display value=&quot;SpecialismeAGBCodelijst&quot; /&gt;\n        &lt;/valueSetReference&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n</pre></div>",
        "id": 177204446,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570061392
    },
    {
        "content": "<blockquote>\n<p>Posted <a href=\"https://bits.nictiz.nl/browse/MM-597\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-597\">https://bits.nictiz.nl/browse/MM-597</a> for the issue with zib-DrugUse.xml using a OID without urn:oid</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> <a href=\"https://bits.nictiz.nl/browse/MM-597\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-597\">MM-597</a> Fixed and marked for next update</p>",
        "id": 177204883,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570062082
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192218\">@Anand Mohan Tumuluri</span> <a href=\"https://bits.nictiz.nl/browse/MM-598\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-598\">MM-598</a> updated</p>",
        "id": 177205425,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570062814
    },
    {
        "content": "<p>looks like you forgot &lt;binding&gt; in your copy. But it's possible that the validator is not handling this right - can you give me an instance and a profile as a test case so I can investigate?</p>",
        "id": 177217096,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570081978
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> O dear, in creating a somewhat condensed view I deleted too much I see. The original is on <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Profiles%20-%20ZIB%202017/nl-core-practitionerrole.xml\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Profiles%20-%20ZIB%202017/nl-core-practitionerrole.xml\">GitHub</a> and there you may also find an <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-practitionerrole-ts-01.xml\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-practitionerrole-ts-01.xml\">example</a>. Alternatively you could work with the <a href=\"https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0\" target=\"_blank\" title=\"https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0\">current package</a> as a whole from Simplifier</p>",
        "id": 177221838,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570088659
    },
    {
        "content": "<p>where can I find the definition for the code system urn:oid:2.16.840.1.113883.2.4.6.7?</p>",
        "id": 177223283,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570090398
    },
    {
        "content": "<p>same for <a href=\"http://fhir.nl/fhir/NamingSystem/uzi-rolcode\" target=\"_blank\" title=\"http://fhir.nl/fhir/NamingSystem/uzi-rolcode\">http://fhir.nl/fhir/NamingSystem/uzi-rolcode</a></p>",
        "id": 177223369,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570090459
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  There is no FHIR expression for many of our CodeSystems. For OIDs we have the OID Registry which allows for export of NamingSystems.</p>\n<ul>\n<li>\n<p><a href=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7\">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.6.7</a> (Vektis Zorgverlenersspecificatie)<br>\n** Codes maintained in a <a href=\"https://www.vektis.nl/streams/standaardisatie/codelijsten/COD016-VEKT\" target=\"_blank\" title=\"https://www.vektis.nl/streams/standaardisatie/codelijsten/COD016-VEKT\">non-FHIR-aware online system</a> by some government body. Systems can subscribe themselves to updates in a non-FHIR way or download Excel files from the website when they see fit.</p>\n</li>\n<li>\n<p><a href=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri\">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/?value=http://fhir.nl/fhir/NamingSystem/uzi-rolcode&amp;id-type=uri</a> or</p>\n</li>\n<li><a href=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111\">http://decor.nictiz.nl/fhir/3.0/hl7nl/NamingSystem/2.16.840.1.113883.2.4.15.111</a> (uzi-rolcode)<br>\n** Codes maintained in a Certificate Practice Statement document in PDF based on national law by some government body. Periodically copied manually into a DECOR <a href=\"https://decor.nictiz.nl/art-decor/decor-valuesets--nictiz2bbr-?id=2.16.840.1.113883.2.4.3.11.60.1.11.2&amp;language=en-US\" target=\"_blank\" title=\"https://decor.nictiz.nl/art-decor/decor-valuesets--nictiz2bbr-?id=2.16.840.1.113883.2.4.3.11.60.1.11.2&amp;language=en-US\">ValueSet</a> and exported from there.</li>\n</ul>\n<p>But those CodeSystem contents are not relevant for the slice determination based on system are they? Not having access to code systems contents, only affects what FHIR validation you could perform on the code.</p>",
        "id": 177254241,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570115583
    },
    {
        "content": "<p>the validator is not smart enough at this time to see that:</p>\n<ul>\n<li>you have fixed the value of system</li>\n<li>you have bound the slices of Coding to a value set </li>\n<li>the value set specifies a fixed system</li>\n<li>it can therefore figure out the slicing. </li>\n</ul>\n<p>It says \"you fixed the system. I'm looking for a fixed value for system\". So then you get ```Could not match discriminator ... for slice ... in profile ...  - does not have fixed value, binding or existence assertions````</p>",
        "id": 177280190,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570132099
    },
    {
        "content": "<p>and nor is it smart enough to figure that out without access to the code system definition either.</p>",
        "id": 177280230,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570132133
    },
    {
        "content": "<p>(since it would use the terminology server for that, and it will say, can't access the code system to know what is going on)</p>",
        "id": 177280304,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570132160
    },
    {
        "content": "<p>And I think that what you are doing isn't conformant:</p>\n<blockquote>\n<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>\n</blockquote>",
        "id": 177280481,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570132246
    },
    {
        "content": "<p>I really fail to see why the profile validator would need a terminology server to find out what the value for system is when it has the ValueSet telling it just that? The only thing a terminology server could tell it that the ValueSet doesn't is which codes belong to the system, but for slicing this is not interesting. For instance validation you might need it, but alas I will never be able to distribute systems outside of my control or behind a pay wall (medication codes are to name one)</p>\n<p>What do you recommend for this situation in STU3? It sounds like the slicing mechanism has a missing feature: slicing by ValueSet is quite common for us.</p>",
        "id": 177344000,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570199527
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Presumably I could duplicate what the ValueSet is already telling me by adding a fixed system in the profile matching the ValueSet system? Forge at least lets me do that. Not sure what to do for ValueSets that pick from more than 1 system, but I did not check if we have those.</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;element id=&quot;PractitionerRole.specialty.coding&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;slicing&gt;\n        &lt;discriminator&gt;\n          &lt;type value=&quot;value&quot; /&gt;\n          &lt;path value=&quot;system&quot; /&gt;\n        &lt;/discriminator&gt;\n        &lt;rules value=&quot;open&quot; /&gt;\n      &lt;/slicing&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;sliceName value=&quot;SpecialtyUZI&quot; /&gt;\n      &lt;short value=&quot;SpecialtyUZI&quot; /&gt;\n      &lt;alias value=&quot;SpecialismeUZI&quot; /&gt;\n      &lt;binding&gt;\n        &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName&quot;&gt;\n          &lt;valueString value=&quot;PractitionerSpecialty&quot; /&gt;\n        &lt;/extension&gt;\n        &lt;strength value=&quot;extensible&quot; /&gt;\n        &lt;valueSetReference&gt;\n          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.6--20171231000000&quot; /&gt;\n          &lt;display value=&quot;SpecialismeUZICodelijst&quot; /&gt;\n        &lt;/valueSetReference&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyUZI.system&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding.system&quot; /&gt;\n      &lt;fixedUri value=&quot;http://fhir.nl/fhir/NamingSystem/uzi-rolcode&quot; /&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding&quot; /&gt;\n      &lt;sliceName value=&quot;SpecialtyAGB&quot; /&gt;\n      &lt;short value=&quot;SpecialtyAGB&quot; /&gt;\n      &lt;alias value=&quot;SpecialismeAGB&quot; /&gt;\n      &lt;binding&gt;\n        &lt;extension url=&quot;http://hl7.org/fhir/StructureDefinition/elementdefinition-bindingName&quot;&gt;\n          &lt;valueString value=&quot;PractitionerSpecialty&quot; /&gt;\n        &lt;/extension&gt;\n        &lt;strength value=&quot;extensible&quot; /&gt;\n        &lt;valueSetReference&gt;\n          &lt;reference value=&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.17.1.7--20171231000000&quot; /&gt;\n          &lt;display value=&quot;SpecialismeAGBCodelijst&quot; /&gt;\n        &lt;/valueSetReference&gt;\n      &lt;/binding&gt;\n    &lt;/element&gt;\n    &lt;element id=&quot;PractitionerRole.specialty.coding:SpecialtyAGB.system&quot;&gt;\n      &lt;path value=&quot;PractitionerRole.specialty.coding.system&quot; /&gt;\n      &lt;fixedUri value=&quot;urn:oid:2.16.840.1.113883.2.4.6.7&quot; /&gt;\n    &lt;/element&gt;\n</pre></div>",
        "id": 177344831,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570200076
    },
    {
        "content": "<blockquote>\n<p>And I think that what you are doing isn't conformant:</p>\n<blockquote>\n<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>\n</blockquote>\n</blockquote>\n<p>If you would let me in on what that message means I could agree or disagree :-) If I understand what it means correctly, I tend to disagree. I have an ElementDefinition that, through its binding, defines what the system is that I use to slice. So far I see a tooling issue, not a profile issue. More than happy to implement a workaround if one exists for STU3 that does not involve having to produce CodeSystems for systems I cannot produce.</p>",
        "id": 177345739,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570200536
    },
    {
        "content": "<blockquote>\n<p>I really fail to see why the profile validator would need a terminology server to find out what the value for system is when it has the ValueSet telling it just that</p>\n</blockquote>\n<p>I sad it wasn't smart enough to do that. Not that it's impossible. I might be able to sort that out - there's enough information present, but I don't think that what you are doing is conformant.</p>",
        "id": 177376605,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570221232
    },
    {
        "content": "<blockquote>\n<p>Each slice must use the element definition for the element(s) in the discriminator(s)</p>\n</blockquote>\n<p>You nominate the element on which you slice - <code>system</code><br>\nSo the validator goes looking for the element definition for the element in the discriminator - <code>system</code>, and doesn't find one</p>",
        "id": 177376699,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570221303
    },
    {
        "content": "<p>the fixedUri approach looks like it should work. if it doesn't, we can review further.</p>",
        "id": 177376794,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570221373
    },
    {
        "content": "<blockquote>\n<p>I sad it wasn't smart enough to do that. Not that it's impossible.</p>\n</blockquote>\n<p>Ok good then I missed that nuance.</p>",
        "id": 177496604,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570433630
    },
    {
        "content": "<blockquote>\n<p>the fixedUri approach looks like it should work. if it doesn't, we can review further.</p>\n</blockquote>\n<p>Ok, I will try to test that. There is a second solution. Looking in our archives of logged issues I found <a href=\"https://bits.nictiz.nl/browse/MM-433\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-433\">MM-433</a> that proposes to use $this + value set binding required (not: extensible). I'm told the .Net validator has been updated to support that as <a href=\"https://github.com/FirelyTeam/fhir-net-api/issues/1070\" target=\"_blank\" title=\"https://github.com/FirelyTeam/fhir-net-api/issues/1070\">recent as last week</a>. I'd expect that the Java validator would support the same. -- related topic: <a href=\"#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets\" title=\"#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets\">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/Slicing.20and.20value.20sets</a></p>\n<p>There is something uneasy about adding an ElementDefinition system to the profile: I do not want to duplicate ValueSet definitions in my profiles as that may go out of sync.</p>\n<p>There is also something uneasy in using $this as discriminator: how do I know what the rules are for the validator in that case? I would expect code + system, with fallback on just system if there is no expansion for the ValueSet. I definitely do not expect any check on display, version or userSelected to determine the slice. Is that how it is supposed to work, or is that just my interpretation?</p>",
        "id": 177497076,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570434133
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I wanted to check what happens with our profiles in the validator, and downloaded the validator. I don't get far using either the Simplifier package or the base folder:</p>\n<div class=\"codehilite\"><pre><span></span>mbp:STU3 ahenket$ java -jar org.hl7.fhir.validator.jar -ig nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\nFHIR Validation tool Version 4.0.23-SNAPSHOT - Built 2019-10-02T15:02:10.634+10:00 - Git 17e7333bcab7\nDetected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available\nArguments: -ig nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\nDirectories: Current = /Users/ahenket/Development/FHIR/STU3, Package Cache = /Users/ahenket/.fhir/packages\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1)\n+  .. load IG from nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz\nLoading nictiz.fhir.nl.stu3.zib2017-1.3.0.tgz to the package cache\n  Fetching:.......................... done.\nException in thread &quot;main&quot; java.lang.UnsupportedOperationException: JsonNull\n    at com.google.gson.JsonElement.getAsString(JsonElement.java:192)\n    at org.hl7.fhir.utilities.cache.NpmPackage.canonical(NpmPackage.java:278)\n    at org.hl7.fhir.utilities.cache.PackageCacheManager.extractLocally(PackageCacheManager.java:525)\n    at org.hl7.fhir.r5.validation.ValidationEngine.loadPackage(ValidationEngine.java:616)\n    at org.hl7.fhir.r5.validation.ValidationEngine.loadIgSource(ValidationEngine.java:511)\n    at org.hl7.fhir.r5.validation.ValidationEngine.loadIg(ValidationEngine.java:776)\n    at org.hl7.fhir.r5.validation.Validator.main(Validator.java:481)\n\nmbp:STU3 ahenket$ java -jar org.hl7.fhir.validator.jar -ig ../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles\\ -\\ ZIB\\ 2017/  -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\nFHIR Validation tool Version 4.0.23-SNAPSHOT - Built 2019-10-02T15:02:10.634+10:00 - Git 17e7333bcab7\nDetected Java version: 1.8.0_121 from /Library/Java/JavaVirtualMachines/jdk1.8.0_121.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available\nArguments: -ig &quot;../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles - ZIB 2017/&quot; -version 3.0 -recurse -debug instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\nDirectories: Current = /Users/ahenket/Development/FHIR/STU3, Package Cache = /Users/ahenket/.fhir/packages\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1)\n+  .. load IG from ../../GitHub/Nictiz/Nictiz-STU3-Zib2017/Profiles - ZIB 2017/\nException in thread &quot;main&quot; java.lang.StringIndexOutOfBoundsException: String index out of range: -1\n    at java.lang.String.substring(String.java:1967)\n    at org.hl7.fhir.utilities.Utilities.path(Utilities.java:549)\n    at org.hl7.fhir.r5.validation.ValidationEngine.loadIgSource(ValidationEngine.java:502)\n    at org.hl7.fhir.r5.validation.ValidationEngine.loadIg(ValidationEngine.java:776)\n    at org.hl7.fhir.r5.validation.Validator.main(Validator.java:481)\n</pre></div>\n\n\n<p>What am I missing? It also seems to error out on r5 classes after recognizing I'm calling on stu3.</p>",
        "id": 177499539,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570436818
    },
    {
        "content": "<p>I think you need the technical correction and package reconciliation to happen before that sequence will work</p>",
        "id": 177502584,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570439793
    },
    {
        "content": "<p>I'll add it to my queue</p>",
        "id": 177502591,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570439805
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  There's more. In Eclipse I can get more useful errors (no idea why though). I fear the validator needs more updates, or at least I don't get why the profiles would be in error:</p>\n<ul>\n<li>We have added an extension in our set to support PractitionerRole in places where STU3 forgot to list it. We then added the extension to our profiles under path Annotation.author[x].extension. We obviously had to slice extension, but never saw a need to slice Annotation.author[x] itself. The validator however seems to be forcing us into that, but the extension is valid across all slices so I don't see why.</li>\n</ul>\n<p><em>Exception in thread \"main\" java.lang.Error: Can't have children on an element with a polymorphic type - you must slice and constrain the types first (sortElements: Annotation.author[x]:Reference{[CanonicalType[http://hl7.org/fhir/StructureDefinition/Practitioner], CanonicalType[http://hl7.org/fhir/StructureDefinition/Patient], CanonicalType[http://hl7.org/fhir/StructureDefinition/RelatedPerson]]}, string)</em></p>\n<ul>\n<li>We have a Bundle profile that slices Bundle.entry.resource and assigns type List to that. It then marks Bundle.entry.resource.subject as \"bundled\" reference. Forge thinks that's fine. The validator does not.</li>\n</ul>\n<p><em>Unable to generate snapshot for <a href=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a> because Profile Medication Overview response structure (<a href=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a>). Error generating snapshot: Error sorting Differential: StructureDefinition <a href=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview\">http://nictiz.nl/fhir/StructureDefinition/Bundle-MedicationOverview</a>: Differential contains path <strong>Bundle.entry.resource.subject</strong> which is not found in the base</em></p>\n<ul>\n<li>We generally have open slicing. Forge thinks that's fine and will happily produce snapshots. The validator does not and can only continue if I let Forge generate snapshots</li>\n</ul>\n<p><em>Unable to generate snapshot for <a href=\"http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse\" target=\"_blank\" title=\"http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse\">http://nictiz.nl/fhir/StructureDefinition/zib-InstructionsForUse</a>: Error at path null: Type slicing with slicing.rules != closed</em></p>\n<ul>\n<li>We generally add XSD/SCH to instances as an immediate low key way to know we have valid instances. The validator marks that as an error, rather than a warning. That seems overdoing it imo.</li>\n</ul>",
        "id": 177505335,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570442433
    },
    {
        "content": "<p>where do I get instances/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml in your example?</p>",
        "id": 177525058,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1570459039
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> It is in the <a href=\"https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0\" target=\"_blank\" title=\"https://simplifier.net/packages/nictiz.fhir.nl.stu3.zib2017/1.3.0\">Simplifier package 1.3.0</a>. It is also on <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/master/Examples/medmij-bgz-fhir3-0-1-allergyintolerance-ts-01.xml\">GitHub</a></p>\n<p>I've been at it all day today and I've at least made some progress. Based on our ticket <a href=\"https://bits.nictiz.nl/browse/MM-433\" target=\"_blank\" title=\"https://bits.nictiz.nl/browse/MM-433\">MM-433</a> I've committed changes to all profiles that do slicing by ValueSet. They now all have discriminator $this and all bindings are now required. Everything has been committed in the <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/tree/develop\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/tree/develop\">GitHub develop branch</a>.</p>\n<ul>\n<li>If I create the snapshots, then the validator validates most cases as expected</li>\n<li>If I do not create the snapshots, the validator fails to build those</li>\n<li>discriminator $this does not work when I have slice based based on fixed code + system and a slice based on ValueSet<ul>\n<li>Profile <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Profiles%20-%20ZIB%202017/zib-LaboratoryTestResult-Observation.xml\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Profiles%20-%20ZIB%202017/zib-LaboratoryTestResult-Observation.xml\">zib-LaboratoryTestResult-Observation.xml</a> and <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Examples/medmij-bgz-fhir3-0-1-labresult-ts-01.xml\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/blob/develop/Examples/medmij-bgz-fhir3-0-1-labresult-ts-01.xml\">medmij-bgz-fhir3-0-1-labresult-ts-01.xml</a> will get you reproduction</li>\n</ul>\n</li>\n</ul>",
        "id": 177536691,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1570466139
    },
    {
        "content": "<p>just circling back - did we get to the bottom of this?</p>",
        "id": 180685522,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573688455
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I think we now know how to profile certain slicing cases within the specification. My recollection is that tooling updates are still required here and there, but details of which tooling needs which update, escapes me. The short version of my recollection for the Java validator was that snapshot generation is the biggest issue, while the slicing thing based on patterns either directly or by binding is supported. For .Net, snapshot generation is no issue, but the slicing is. Same goes for Touchstone.</p>\n<p>We have not yet applied the pattern thing throughout the package yet. My thinking: </p>\n<ul>\n<li>We create a package that has the slicing as agreed here</li>\n<li>We test that against the Java validator, and feed you with that?</li>\n</ul>",
        "id": 180723110,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1573732179
    },
    {
        "content": "<p>sure</p>",
        "id": 180724244,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1573733284
    }
]