[
    {
        "content": "<p>Hi Everyone,</p>\n<p>Needed a clarification regarding the FHIRPath expression defined in SearchParameter for value[x] fields.</p>\n<p>The expression for searchparameter to search a value[x] field should have all possible variants allowed for search ?<br>\nfor example, As of now the FHIRPath expression for the field CarePlan-&gt;activity-&gt;detail-&gt;scheduled  </p>\n<p>Which of the below expressions is the correct way of defining the FHIRPath expression ?</p>\n<ol>\n<li>\n<p>\"CarePlan.activity.detail.scheduled\"</p>\n</li>\n<li>\n<p>\"CarePlan.activity.detail.scheduled as Timing | CarePlan.activity.detail.scheduled as Period | CarePlan.activity.detail.scheduled as string\"</p>\n</li>\n</ol>",
        "id": 198023999,
        "sender_full_name": "Nikhil",
        "timestamp": 1589866850
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <br>\nIt will be very helpful if you could help me with this query.</p>",
        "id": 198049079,
        "sender_full_name": "Nikhil",
        "timestamp": 1589885911
    },
    {
        "content": "<p>What is the search type for your parameter?  I don't think there's a single search type that would work for Timing, Period and string...</p>",
        "id": 198082576,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1589901825
    },
    {
        "content": "<p>This is a standard SearchParameter defined in R5.<br>\nI am confused with the usage of FHIRPath expressions defined in SearchParameter. <br>\nFor example, <br>\nResource : \"CarePlan\" ,<br>\nsearchparameter : \"activity-date\" ,<br>\nexpression : \"CarePlan.activity.detail.scheduled\"<br>\nxpath : \"f:CarePlan/f:activity/f:detail/f:scheduledTiming | f:CarePlan/f:activity/f:detail/f:scheduledPeriod | f:CarePlan/f:activity/f:detail/f:scheduledString\"</p>\n<p>similarly for another resource which has a searchparameter on value[x] kind of field,<br>\nResource : \"Condition\" ,<br>\nsearchparameter : \"abatement-date\" ,<br>\nexpression : \"Condition.abatement.as(dateTime) | Condition.abatement.as(Period)\"<br>\nxpath : \"f:Condition/f:abatementDateTime | f:Condition/f:abatementPeriod\"</p>\n<p>The expression for the \"activity-date\"  searchparamter should have been,<br>\n\"CarePlan.activity.detail.scheduled.as(Timing) | CarePlan.activity.detail.scheduled.as(Period) | CarePlan.activity.detail.scheduled.as(string)</p>\n<p>Is my understanding right ?</p>",
        "id": 198188333,
        "sender_full_name": "Nikhil",
        "timestamp": 1589976555
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 198212429,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1589987467
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <br>\nCould you please help me with this query ?</p>",
        "id": 198299759,
        "sender_full_name": "Nikhil",
        "timestamp": 1590051784
    },
    {
        "content": "<p>Yes, the FHIRPath should be using the <code>as</code> operator or the <code>.as(...)</code> syntax, not the named choice</p>",
        "id": 198390740,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1590103310
    },
    {
        "content": "<p>Should I raise a ticket in Jira for this ?<br>\n<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>  <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span></p>",
        "id": 198427305,
        "sender_full_name": "Nikhil",
        "timestamp": 1590143989
    },
    {
        "content": "<p>I don't see anything wrong with the SearchParameter as written, FHIRPath allows for expressions that reference choice types, and the date search type allows for searching on the possible types for the scheduled element, so I'm not clear what the actual question is here?</p>",
        "id": 198448235,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1590157976
    },
    {
        "content": "<p>I think the questions is specifically, is</p>\n<div class=\"codehilite\"><pre><span></span><code>expression : &quot;CarePlan.activity.detail.scheduled&quot;\n</code></pre></div>\n\n\n<p>correct?</p>",
        "id": 198452992,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1590160301
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span>, the question is how you can have a single search parameter that searches against timing, period and string</p>",
        "id": 198460304,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590163842
    },
    {
        "content": "<p>Ah, the string choice, I missed that one. So that should probably explicitly specify the date-valued choices. Which would be a tracker, yes.</p>",
        "id": 198462305,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1590164653
    },
    {
        "content": "<p>Is this the same as <a href=\"https://jira.hl7.org/browse/FHIR-25210\">https://jira.hl7.org/browse/FHIR-25210</a> ?</p>",
        "id": 198465746,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1590166331
    },
    {
        "content": "<p>if so, that should have been fixed with <a href=\"https://github.com/HL7/fhir/pull/775/commits/6947f33720ee371e1b2ab3c29b350831ebaeb547\">https://github.com/HL7/fhir/pull/775/commits/6947f33720ee371e1b2ab3c29b350831ebaeb547</a></p>",
        "id": 198465841,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1590166377
    },
    {
        "content": "<p>and I don't see any <code>activity-date</code> at <a href=\"http://build.fhir.org/careplan.html#search\">http://build.fhir.org/careplan.html#search</a></p>",
        "id": 198466034,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1590166454
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"270740\">@Nikhil</span> where are you seeing this SearchParameter?</p>",
        "id": 198466174,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1590166534
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span>  It is same as that you mentioned. I remember seeing few more such cases in the R5 searchparameter set.<br>\nI saw that here,  <br>\n<a href=\"http://hl7.org/fhir/2020Feb/careplan.html\">http://hl7.org/fhir/2020Feb/careplan.html</a>.</p>\n<p>Looks like its fixed here <a href=\"https://github.com/HL7/fhir/pull/775/commits/6947f33720ee371e1b2ab3c29b350831ebaeb547\">https://github.com/HL7/fhir/pull/775/commits/6947f33720ee371e1b2ab3c29b350831ebaeb547</a> .</p>",
        "id": 198469125,
        "sender_full_name": "Nikhil",
        "timestamp": 1590167966
    },
    {
        "content": "<p>Yes, it is fixed in the current build: <a href=\"http://build.fhir.org/careplan.html\">http://build.fhir.org/careplan.html</a></p>",
        "id": 198470564,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1590168693
    },
    {
        "content": "<p>Hi everyone,</p>\n<p>As mentioned above, i found another searchparameter on \"Specimen\" resource having similar issue. <br>\ncurrent defined expression : \"Specimen.collection.collected\"<br>\nShould it be modified to  Specimen.collection.collected.as(dateTime) | Specimen.collection.collected.as(Period)</p>\n<p>Reference:<br>\n<a href=\"http://build.fhir.org/specimen.html\">http://build.fhir.org/specimen.html</a></p>",
        "id": 199458993,
        "sender_full_name": "Nikhil",
        "timestamp": 1591083909
    },
    {
        "content": "<p>Hi Nikhil.  In this particular case, both dateTime and Period will map to the same search parameter type:  date</p>",
        "id": 199486845,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591102707
    },
    {
        "content": "<p>Therefor, the \"as\" is not strictly required</p>",
        "id": 199486962,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591102756
    },
    {
        "content": "<p>its only required when you have an expression that could resolve to a type which cannot be mapped to the given search parameter type</p>",
        "id": 199487024,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591102793
    },
    {
        "content": "<p>see <a href=\"http://build.fhir.org/search.html#table\">http://build.fhir.org/search.html#table</a> for a summary of that and note that both dateTime and Period have a Y in the \"date\" column.</p>",
        "id": 199487305,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591102920
    },
    {
        "content": "<p>I'm pretty sure I caught all potential mismatches in the base spec in the past and it seems that most of those have now been resolved</p>",
        "id": 199487465,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591102988
    },
    {
        "content": "<p>hmm, actually I just went back and I see <a href=\"http://jira.hl7.org/browse/FHIR-24172\">FHIR#24172</a> still needs to get applied and <a href=\"http://jira.hl7.org/browse/FHIR-25174\">FHIR#25174</a> was closed as \"Not Persuasive\"</p>",
        "id": 199493955,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1591106044
    },
    {
        "content": "<p>This is helpful. Thanks <span class=\"user-mention\" data-user-id=\"191676\">@Lee Surprenant</span></p>",
        "id": 199589420,
        "sender_full_name": "Nikhil",
        "timestamp": 1591171114
    },
    {
        "content": "<p>Hi all, it looks like RiskAssessment-probability is another case of a typechoice missing the \"as\" preposition at the end of the FHIR path. There are some typechoice search params that are missing the \"as\" where the underlying types are both subtypes of the search param type (eg, MessageHeader-event can be either code or string, both of which can be token)<br>\nhowever, probability is either a decimal or a Range, which are number and Quantity search types respectively. Should we treat RiskAssessment-probability as a decimal or Range when doing the search?</p>",
        "id": 201674244,
        "sender_full_name": "Harrison Tarr",
        "timestamp": 1592869326
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"246988\">@Harrison Tarr</span> Can you submit a change request?  (Use the 'propose a change' link at the bottom of any page in the spec.)</p>",
        "id": 201683864,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592881448
    },
    {
        "content": "<p>Thats exactly what <a href=\"http://jira.hl7.org/browse/FHIR-25174\">FHIR#25174</a> was for.  I'm gonna hop on the CDS conference call tomorrow to try convincing them to reopen it, but the fix will not be easy because what they want is a single search parameter that you can use to search either choice type</p>",
        "id": 201716727,
        "sender_full_name": "Lee Surprenant",
        "timestamp": 1592914250
    }
]