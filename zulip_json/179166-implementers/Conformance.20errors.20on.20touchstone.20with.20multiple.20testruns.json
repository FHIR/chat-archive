[
    {
        "content": "<p>So I am trying to get a few tests running on <a href=\"https://touchstone.aegis.net/\" target=\"_blank\" title=\"https://touchstone.aegis.net/\">https://touchstone.aegis.net/</a> -- so far so good. What I have noted is that if I select any of the basic XML tests (for instance /FHIR3-0-1-Basic/I-O/Organization/Client Assigned Id/Organization-client-id-xml ) and then later run the same JSON tests against my server (without emptying the database) I get the following errors (during Step4-ResourceHistoryInstance): <a href=\"/user_uploads/10155/RLzDw3y08_73KVj40VXOBDrR/b18a7528-c317-4e17-9d6c-2927c28cc674.png\" target=\"_blank\" title=\"b18a7528-c317-4e17-9d6c-2927c28cc674.png\">b18a7528-c317-4e17-9d6c-2927c28cc674.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/RLzDw3y08_73KVj40VXOBDrR/b18a7528-c317-4e17-9d6c-2927c28cc674.png\" target=\"_blank\" title=\"b18a7528-c317-4e17-9d6c-2927c28cc674.png\"><img src=\"/user_uploads/10155/RLzDw3y08_73KVj40VXOBDrR/b18a7528-c317-4e17-9d6c-2927c28cc674.png\"></a></div><p>This somewhat makes sense since touchstone reuses the same Ids between the JSON &amp; XML runs. So while the first run is fine (there are no deletions in the history yet) the next one will fail because the history contains a deleted element for which I have a resource with only an ID.</p>\n<p>Now I am wondering if this is an oversight in touchstone or if my implementation misses something crucial. Any pointers would be appreciated :)</p>",
        "id": 160892354,
        "sender_full_name": "Florian Apolloner",
        "timestamp": 1552668779
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191370\">@Richard Ettema</span> ?</p>",
        "id": 160893810,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1552669854
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"213323\">@Florian Apolloner</span>, I have reviewed your test results for the Organization history interaction in the /FHIR3-0-1-Basic/I-O/Organization/Client Assigned Id/Organization-client-id-xml execution. The validation assert is correctly evaluating your history Bundle.</p>\n<p>Touchstone incorporates the FHIR validation engine from the FHIR specification Java code. The validation of a Bundle invokes validation for each contained Bundle.entry.resource. So, in this case each individual Organization resource is validated for conformance to the FHIR specification. The validation errors in this test execution from this assert:</p>\n<blockquote>\n<p>Validation of response body against profile '<a href=\"http://hl7.org/fhir/StructureDefinition/Bundle\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Bundle\">http://hl7.org/fhir/StructureDefinition/Bundle</a>' by FHIR specification's Validation Engine produced the following results:</p>\n<p>1. ERROR: The organization SHALL at least have a name or an id, and possibly more than one [(identifier.count() + name.count()) &gt; 0]. Location: Bundle.entry[3].resource (line 1, col3978).<br>\n2. ERROR: The organization SHALL at least have a name or an id, and possibly more than one [(identifier.count() + name.count()) &gt; 0]. Location: Bundle.entry[4].resource (line 1, col4469).</p>\n</blockquote>\n<p>are both produced via the Organization 'org-1' constraint - please see: <a href=\"http://hl7.org/fhir/STU3/organization.html#invs\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/organization.html#invs\">http://hl7.org/fhir/STU3/organization.html#invs</a></p>",
        "id": 161062942,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1552920069
    },
    {
        "content": "<p>The history interaction states in the specification, <a href=\"http://hl7.org/fhir/STU3/http.html#history\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/http.html#history\">http://hl7.org/fhir/STU3/http.html#history</a>, the following (snipped):</p>\n<blockquote>\n<p>If the entry.request.method is a PUT or a POST, the entry SHALL contain a resource</p>\n</blockquote>\n<p>The DELETE method is expected to follow the delete interaction definition, <a href=\"http://hl7.org/fhir/STU3/http.html#delete\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/http.html#delete\">http://hl7.org/fhir/STU3/http.html#delete</a>, where it states (snipped):</p>\n<blockquote>\n<p>For servers that maintain a version history, the delete interaction does not remove a resource's version history. From a version history respect, deleting a resource is the equivalent of creating a special kind of history entry that <strong>has no content</strong> and is marked as deleted. Note that there is no support for deleting past versions - see notes on the history interaction.</p>\n</blockquote>\n<p>Since the deleted resource <strong>has no content</strong>, the history Bundle.entry.resource for a deleted resource version is expected to not be present.</p>",
        "id": 161063562,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1552920483
    },
    {
        "content": "<p>For future reference, you may post Touchstone specific questions, comments, issues in the <a class=\"stream\" data-stream-id=\"179217\" href=\"/#narrow/stream/179217-Touchstone\">#Touchstone</a> stream. You may also send any support issues to our Touchstone Support Team at <a href=\"mailto:Touchstone_Support@aegis.net\" title=\"mailto:Touchstone_Support@aegis.net\">Touchstone_Support@aegis.net</a>.</p>",
        "id": 161063752,
        "sender_full_name": "Richard Ettema",
        "timestamp": 1552920635
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191370\">@Richard Ettema</span> Thanks, I've also found this out after a discussion in <a href=\"#narrow/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F\" title=\"#narrow/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Search.20by.20_lastUpdated.20for.20deleted.20resources.3F</a> -- apparently at least hapi and Google cloud keep an \"empty\" resource with just an ID even for deleted entries. This led me to believe that this is how the specification should be read, apologies for the mistake.</p>",
        "id": 161100960,
        "sender_full_name": "Florian Apolloner",
        "timestamp": 1552947003
    },
    {
        "content": "<p>On a second thought, does this also mean that a history bundle cannot include fullUrl for deleted entries due to the 'bdl-7' constraint? (bdl-7: FullUrl must be unique in a bundle, or else entries with the same fullUrl must have different meta.versionId (expression : entry.where(fullUrl).select(fullUrl&amp;resource.meta.versionId).isDistinct()))</p>",
        "id": 161130166,
        "sender_full_name": "Florian Apolloner",
        "timestamp": 1552983891
    },
    {
        "content": "<p>That's a really good question.  It would primarily be an issue where an item had been deleted twice.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> ?</p>",
        "id": 161159611,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1553008571
    },
    {
        "content": "<p>we revoked that in R4 for this reason (amongst others)</p>",
        "id": 161182820,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553024012
    }
]