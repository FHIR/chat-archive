[
    {
        "content": "<p>If I define an Operation via its <code>OperationDefinition</code> as having a parameter of type <code>token</code>, am I allowed to invoke that operation via a Parameters resource? If so, how does the resource look?</p>",
        "id": 153818159,
        "sender_full_name": "James Agnew",
        "timestamp": 1458941507
    },
    {
        "content": "<p>It's a string type. Current build makes this clear as of 48 hours ago</p>",
        "id": 153818167,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1458943304
    },
    {
        "content": "<p>Ahhhhh right, suddenly I remember the FHIR-I discussion where this was decided. Thanks!</p>",
        "id": 153818169,
        "sender_full_name": "James Agnew",
        "timestamp": 1458943438
    },
    {
        "content": "<p>Ok, I'm putting support for this into HAPI now.</p>\n<p>Is it reasonable to assume that if an operation uses a token named <code>foo</code>, it's ok to invoke it with a qualifier, such as <code>$myoperation?foo:below=http://system|value</code></p>\n<p>If so, what about when invoking it via the parmeters resource? Ie, is it ok for the Parameters resource to have a part named <code>foo:below</code> even though the definition defined the part as being called <code>foo</code>?</p>",
        "id": 153818243,
        "sender_full_name": "James Agnew",
        "timestamp": 1459005479
    },
    {
        "content": "<p>That would be a surprising result to me, at least. </p>",
        "id": 153818250,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1459006096
    },
    {
        "content": "<p>But I never understood <a href=\"https://chat.fhir.org/#narrow/stream/implementers/subject/OperationDefinition.2Eparameter.2EsearchType/near/7336\" target=\"_blank\" title=\"https://chat.fhir.org/#narrow/stream/implementers/subject/OperationDefinition.2Eparameter.2EsearchType/near/7336\">https://chat.fhir.org/#narrow/stream/implementers/subject/OperationDefinition.2Eparameter.2EsearchType/near/7336</a> (and I don't think anyone provided an example to clarify). </p>",
        "id": 153818251,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1459006254
    },
    {
        "content": "<p>Yeah, agreed. Don't know that I see any obvious better ways though.</p>\n<ul>\n<li>Define an extension for the qualifier</li>\n<li>Disallow qualifiers when invoking by Parameters</li>\n<li>Add another field to Parameters for the qualifier</li>\n</ul>",
        "id": 153818252,
        "sender_full_name": "James Agnew",
        "timestamp": 1459006330
    },
    {
        "content": "<p>Yeah, I think your question goes hand in hand with this one. Is there a way of merging streams? :)</p>\n<p>The <a href=\"http://hl7-fhir.github.io/operationdefinition-definitions.html#OperationDefinition.parameter.searchType\" target=\"_blank\" title=\"http://hl7-fhir.github.io/operationdefinition-definitions.html#OperationDefinition.parameter.searchType\">invariant</a> on <code>OperationDefinition.parameter.searchType</code> does agree with Grahame's answer above though. If an operation uses a search parameter, the <code>OperationDefinition.parameter.type</code> has to be <code>string</code> or <code>(missing)</code></p>",
        "id": 153818253,
        "sender_full_name": "James Agnew",
        "timestamp": 1459006607
    },
    {
        "content": "<p>So.. I guess the part in OperationDefinition makes sense to me, but I think we still have work to do in terms of explaining how qualifiers work with this.</p>",
        "id": 153818254,
        "sender_full_name": "James Agnew",
        "timestamp": 1459006657
    },
    {
        "content": "<p>(You can rename topics...) But anyway: my question was whether there is an example of how \"searchType\" is used. I didn't see it in the examples but may have missed it. If you understand this James maybe you can help explain it to me. </p>",
        "id": 153818256,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1459007462
    },
    {
        "content": "<p>I don't know of any examples yet, but I do remember the discussion on FHIR-I well at least.</p>\n<p>The idea is that for some people it might be useful to define operations where the parameter parts are search parameters. I guess the obvious use case for that would be for operations that are basically specialized searches, since that was you can make the URLs have the same semantics as other searches.</p>\n<p>In this case, you'd set <code>type</code> to <code>string</code> and <code>searchType</code> would be set to <code>token</code> or <code>date</code> or whatever. E.g from the unit test I'm writing as we speak:</p>\n<div class=\"codehilite\"><pre>   <span class=\"nt\">&lt;parameter&gt;</span>\n      <span class=\"nt\">&lt;name</span> <span class=\"na\">value=</span><span class=\"s\">&quot;valtok&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;use</span> <span class=\"na\">value=</span><span class=\"s\">&quot;in&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;string&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;searchType</span> <span class=\"na\">value=</span><span class=\"s\">&quot;token&quot;</span><span class=\"nt\">/&gt;</span>\n   <span class=\"nt\">&lt;/parameter&gt;</span>\n</pre></div>",
        "id": 153818259,
        "sender_full_name": "James Agnew",
        "timestamp": 1459008312
    },
    {
        "content": "<p><a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9770\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=9770\">tracker filed</a> to clarify this</p>",
        "id": 153818261,
        "sender_full_name": "James Agnew",
        "timestamp": 1459009166
    },
    {
        "content": "<p>I see, thanks! I guess I would argue for making this a get-only feature. Failing that, then  using x-www-urlencoded for POST, to stay parallel with normal search. Failing that, adding a \"modifier\" to params. </p>",
        "id": 153818262,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1459009173
    },
    {
        "content": "<p>(BTW what you call \"qualifiers\" FHIR calls \"modifiers\".) </p>",
        "id": 153818263,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1459009298
    },
    {
        "content": "<p>Ugh yes, bad habit. HAPI named them that before FHIR gave them a name :)</p>",
        "id": 153818264,
        "sender_full_name": "James Agnew",
        "timestamp": 1459009353
    },
    {
        "content": "<p>Josh - <a href=\"https://hl7-fhir.github.io/patient-operations.html#match\" target=\"_blank\" title=\"https://hl7-fhir.github.io/patient-operations.html#match\">https://hl7-fhir.github.io/patient-operations.html#match</a> though I see I have a red rendering problem there</p>",
        "id": 153818277,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1459022471
    },
    {
        "content": "<p>agree that how to do modifiers is unresolved</p>",
        "id": 153818278,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1459022506
    },
    {
        "content": "<p>And now, a new OperationDefinition question, per a <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/379\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/379\">HAPI ticket</a> raised by <span class=\"user-mention\" data-user-id=\"191343\">@Michael Lawley</span> </p>\n<p>The definition of <code>OperationDefinition.instance</code> is \"Indicates whether this operation can be invoked on a particular instance of one of the given types.\". Given the word \"can\", I take this to mean that:</p>\n<ul>\n<li>a value of <code>true</code> means the operation can be applied at both the type and instance level</li>\n<li>a value of <code>false</code> means that the operation can be applied at the type level</li>\n<li>there is no way of indicating that the resource can only be applied at the instance level</li>\n</ul>\n<p>Does my interpretation make sense? Is this a problem?</p>",
        "id": 153832450,
        "sender_full_name": "James Agnew",
        "timestamp": 1465672585
    },
    {
        "content": "<p>I do note that Grahame's server exposes only a single OperationDefinition for the <code>validate</code> operation, presumably covering both the type and instance variants. This seems to confirm my interpretation..</p>",
        "id": 153832451,
        "sender_full_name": "James Agnew",
        "timestamp": 1465672640
    },
    {
        "content": "<p>makes sense to me :)<br>\nIt would make more sense to me to separate the definition into two, one for type level and one for instance level because they often have parameters that make sense only in one invocation context and currently the only way to determine this (AFAIK) is to read the text</p>",
        "id": 153832597,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1465859769
    },
    {
        "content": "<p>I don't know about separating the definition into 2. While it serve some forms of computation better, it doubt it would be better overall. </p>",
        "id": 153832629,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465860850
    },
    {
        "content": "<p>but there is a common pattern where the operation works at either type or instance, and some parameters are proxies for 'the identity of the thing' </p>",
        "id": 153832630,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465860883
    },
    {
        "content": "<p>Conformance has Rest 0-* with mode (client | server) allowing to differentiate capabilities for the two modes. Would something like that be useful for OperationDefinition? Differentiation on OperationDefinition should be limited to a small set of properties, maybe just parameters. Otherwise it would effectively still be split into 2, albeit in one Resource then.</p>",
        "id": 153832714,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1465887318
    },
    {
        "content": "<p>IMO we probably don't need anything fancy here. One more boolean that indicates that the operation can be invoked at the type level would allow for this to be unambiguous.</p>",
        "id": 153832785,
        "sender_full_name": "James Agnew",
        "timestamp": 1465927121
    },
    {
        "content": "<p>yes it's clearly appropriate to do at least that. </p>",
        "id": 153832825,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1465947417
    },
    {
        "content": "<p><a href=\"http://hl7-fhir.github.io/operations.html#executing\" target=\"_blank\" title=\"http://hl7-fhir.github.io/operations.html#executing\">http://hl7-fhir.github.io/operations.html#executing</a> indicates that:</p>\n<blockquote>\n<p>Some Operations with primitive input types and a single Resource output parameter named 'return' can be invoked using a GET directly, with parameters as HTTP URL parameters.</p>\n</blockquote>\n<p>Do/should we have an equivalent \"nice syntax\" for inputs -- that is, allowing clients to just pass in a single resource, rather than a<code>Parameters</code>?</p>",
        "id": 153849864,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1474379519
    },
    {
        "content": "<p>we do</p>",
        "id": 153849874,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474380185
    },
    {
        "content": "<p>Can you show me where?</p>",
        "id": 153849875,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1474380193
    },
    {
        "content": "<p>\"If the only parameter to the operation is a resource, then the operation can also executed by a POST with that parameter as the body of the request.\" </p>",
        "id": 153849876,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474380246
    },
    {
        "content": "<p><a href=\"http://hl7-fhir.github.io//operations.html#request\" target=\"_blank\" title=\"http://hl7-fhir.github.io//operations.html#request\">http://hl7-fhir.github.io//operations.html#request</a></p>",
        "id": 153849877,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474380266
    },
    {
        "content": "<p>Thanks! So it's up to the client to decide, and a server needs to support both ways?</p>",
        "id": 153849878,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1474380281
    },
    {
        "content": "<p>pretty much, yes</p>",
        "id": 153849879,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474380311
    },
    {
        "content": "<p>Got it. And re:</p>\n<blockquote>\n<p>If the only parameter to the operation is a resource</p>\n</blockquote>\n<p>Is there a reason we can't take in (complex) datatypes this way, too?</p>",
        "id": 153849880,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1474380478
    },
    {
        "content": "<p>it simplifies all the implementations greatly - wrap it in a resource wrapper - use Parameters</p>",
        "id": 153849883,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474380630
    },
    {
        "content": "<p>That text might be a little ambiguous - does it mean \"the only declared parameter\" (in the op definition) or does it mean \"the only actual parameter\" (in a specific invocation)?  It's the latter, I know, but the wording could be more explicit.</p>",
        "id": 153850039,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1474403439
    },
    {
        "content": "<p>do you want to make a task to clarify the wording?</p>",
        "id": 153850047,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474407567
    },
    {
        "content": "<p>Done <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12070\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12070\">http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=12070</a></p>",
        "id": 153850054,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1474419576
    },
    {
        "content": "<p>thx</p>",
        "id": 153850072,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1474453021
    },
    {
        "content": "<p>Hi all,  We are using HAPI-FHIR server and perfoming some operations like  ActivityDefinition/[id]/$apply, CapabilityStatement/$subset, CapabilityStatement/$implements , CodeSystem/$lookup, CodeSystem/$subsumes , CodeSystem/$compose, Composition/$document.I want to know whether the HAPI-FHIR server is supports these operations or not? If yes how?</p>",
        "id": 153894308,
        "sender_full_name": "Mounika",
        "timestamp": 1497855594
    },
    {
        "content": "<p>Is there any hard rule that $Operations cannot occur on the DELETE verb? In my case, I have created an operation for the users (admin users) to load into the server CompartmentDefinition resources. That operation looks like this: <code>POST [base]/CompartmentDefinition$x-setcompartment</code> and takes a single CompartmentDefinition resource. It checks its validity and then make it an active Compatment on the server. This then begs the question how do they remove that active Compartment from the server. I feel like I want to implement another operation using the DELETE verb, something like <code>DELETE [base]/CompartmentDefinition$x-delete-compartment?code=Patient</code>, which removes the active compartment from the server. It that allowed?</p>",
        "id": 153954750,
        "sender_full_name": "Angus Millar",
        "timestamp": 1524822330
    },
    {
        "content": "<p>well, here's how i'd think about:</p>",
        "id": 153954866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1524871380
    },
    {
        "content": "<ul>\n<li>POST/PUT the compartment to the server</li>\n<li>so now it's [base]/Compartment/[the-id]</li>\n<li>operation: [base]/Compartment/[the-id] /$set-active</li>\n<li>now the compartment is good to go. maybe tagged by the server so you know it's active</li>\n<li>operation: [base]/Compartment/[the-id] /$set-inactive</li>\n<li>DELETE [base]/Compartment/[the-id]</li>\n</ul>",
        "id": 153954867,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1524871480
    },
    {
        "content": "<p>I can't imagine what it means to 'set a compartment active'</p>",
        "id": 153954868,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1524871497
    },
    {
        "content": "<p>Thanks Grahame, I understand you view and had considered it. I was concerned that haveing the server active CompartmentDefiniton resource in the general resource repository ran the risk of it being modified without the awareness of the consequences of that modification on the active server compartment. Would I be correct in thinking that your view is that any PUT, DELETE on that resource would be applied to the server active Compartment without calling $set-active again?</p>",
        "id": 153954876,
        "sender_full_name": "Angus Millar",
        "timestamp": 1524883748
    },
    {
        "content": "<p>I'd probably refuse to change it if it was active</p>",
        "id": 153954877,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1524887235
    },
    {
        "content": "<p>It is for such reasons that Vonk has a separate /administration endpoint. If you change resources there, you change the behaviour of Vonk.<br>\nAlthough Vonk does not provide an operation like the one <span class=\"user-mention\" data-user-id=\"191391\">@Angus Millar</span> describes. A compartment is conveyed per request, based on the compartment in the url ('compartment search') or in the authorization token.<br>\nI'm curious what the usecase is set a CompartmentDefinition to active for the server as a whole.</p>",
        "id": 153955170,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1525161666
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span>  I think we are doing something similar.  On the first install, my server begins its life with no active Compartments. That means users can not do a search as follows <code>[base]/Patient/[id]//Observation?identifier=http://acme.com/lab/reports/Observations|obs00000006</code>. That search would return an error of \"No active Patient Compartment exist in this server.\". Yet if the user adds a CompartmentDefinition resource to the server at the endpoint <code>[base]/CompartmentDefinition/10</code> and then calls an Operation I have defined call <code>$x-set-CompartmentDefinition-active</code> and called like this <code>[base]//CompartmentDefinition/10/$x-set-CompartmentDefinition-active</code> the server then processes that CompartmentDefinition resource with the id=10, checking it is valid, and then sets it as Active in the server. Active here meaning that now the search <code>[base]/Patient/[id]//Observation?identifier=http://acme.com/lab/reports/Observations|obs00000006</code> will work.</p>",
        "id": 153955323,
        "sender_full_name": "Angus Millar",
        "timestamp": 1525225790
    },
    {
        "content": "<p>Ah, I get it. Similar indeed. But to Vonk not the $x-set-CompartmentDefinition-active is the trigger but the fact that it is posted to the [base]/administration/CompartmentDefinition instead of the normal [base]/CompartmentDefinition.</p>",
        "id": 153955373,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1525263167
    },
    {
        "content": "<p>I would use the same operation with one input parameter for the status: boolean isDelete := true | false</p>",
        "id": 153955466,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1525291417
    }
]