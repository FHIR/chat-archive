[
    {
        "content": "<p>Hello, I am attempting to derive a profile from an existing profile of Condition, as found in the HL7 Australia IG: <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-condition.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-au-condition.html\">AU Condition</a>. Note that this AU Condition profile includes <a href=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-recorder.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7au/au-fhir-base/StructureDefinition-recorder.html\">an extension</a> to add the capability to represent the recorder of the condition data (with references to 3 STU3 participant resources); as the <a href=\"http://build.fhir.org/condition-definitions.html#Condition.recorder\" target=\"_blank\" title=\"http://build.fhir.org/condition-definitions.html#Condition.recorder\">R4 Condition counterpart</a> does.</p>\n<p>So, in my derived profile from the above I am adding a number of constraints such as adding must support etc, however the constraint of interest here regards the recorder extension. What I am trying to do is swap out the reference to the STU3 participants with more constrained versions that we have defined in a non-public IG.</p>\n<p>In order to do this I have added the following into the condition profile structure definition:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;element id=&quot;Condition.extension:recorder.valueReference:valueReference&quot;&gt;\n      &lt;path value=&quot;Condition.extension.value[x]&quot;/&gt;\n      &lt;sliceName value=&quot;valueReference&quot;/&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/patient-dh-base-1&quot;/&gt;\n      &lt;/type&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/practitioner-dh-base-1&quot;/&gt;\n      &lt;/type&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile value=&quot;http://ns.electronichealth.net.au/ci/fhir/3.0/StructureDefinition/relatedperson-dh-base-1&quot;/&gt;\n      &lt;/type&gt;\n&lt;/element&gt;\n</pre></div>\n\n\n<p>The IG builds without error or warnings however this appears in the generated differential table - ie the original recorder STU3 references as well as our local constrained variations:<br>\n<a href=\"/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/Vm2HWT5rnhplp-YW1JlY-26K/pasted_image.png\"></a></div><p>That may be OK, but the generated structuredefinition file reverts the extension's references to the STU3 like so (and is also rendered as such on the snapshot tab) :</p>\n<div class=\"codehilite\"><pre><span></span>&lt;element id=&quot;Condition.extension:recorder.valueReference:valueReference&quot;&gt;\n      &lt;path value=&quot;Condition.extension.valueReference&quot;/&gt;\n      &lt;sliceName value=&quot;valueReference&quot;/&gt;\n      &lt;short value=&quot;Who recorded the record&quot;/&gt;\n      &lt;definition\n                  value=&quot;Value of extension - may be a resource or one of a constrained set of the data types (see Extensibility in the spec for list).&quot;/&gt;\n      &lt;min value=&quot;1&quot;/&gt;\n      &lt;max value=&quot;1&quot;/&gt;\n      &lt;base&gt;\n        &lt;path value=&quot;Extension.value[x]&quot;/&gt;\n        &lt;min value=&quot;0&quot;/&gt;\n        &lt;max value=&quot;1&quot;/&gt;\n      &lt;/base&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile value=&quot;http://hl7.org/fhir/StructureDefinition/Patient&quot;/&gt;\n      &lt;/type&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile\n                       value=&quot;http://hl7.org/fhir/StructureDefinition/Practitioner&quot;/&gt;\n      &lt;/type&gt;\n      &lt;type&gt;\n        &lt;code value=&quot;Reference&quot;/&gt;\n        &lt;targetProfile\n                       value=&quot;http://hl7.org/fhir/StructureDefinition/RelatedPerson&quot;/&gt;\n      &lt;/type&gt;\n&lt;/element&gt;\n</pre></div>\n\n\n<p>My first question therefore is - is this form of constraint acceptable; or should I be considering another approach, like creating a new extension maybe or adding invariants?<br>\nAnd if it is acceptable, how to make it work (so that the snapshot contains the desired references to my constrained variants?</p>\n<p>Thank you!</p>",
        "id": 157744410,
        "sender_full_name": "Rob Eastwood",
        "timestamp": 1549503439
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191368\">@Brett Esler</span> and <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> - this is the query that I chatted with you a couple of days ago - FYI.</p>",
        "id": 157744560,
        "sender_full_name": "Rob Eastwood",
        "timestamp": 1549503641
    }
]