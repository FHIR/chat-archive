[
    {
        "content": "<p>I'm looking for some Apache help. </p>",
        "id": 153842739,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450616
    },
    {
        "content": "<p>some background:</p>",
        "id": 153842740,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450619
    },
    {
        "content": "<p>When a request for a canonical or literal URL of a resource is made (e.g. <a href=\"http://hl7.org/fhir/Patient/example\" target=\"_blank\" title=\"http://hl7.org/fhir/Patient/example\">http://hl7.org/fhir/Patient/example</a> or <a href=\"http://hl7.org/fhir/ValueSet/condition-status\" target=\"_blank\" title=\"http://hl7.org/fhir/ValueSet/condition-status\">http://hl7.org/fhir/ValueSet/condition-status</a>), the server responds with a redirect to the appropriate page in the spec</p>",
        "id": 153842741,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450775
    },
    {
        "content": "<p>the redirect first looks at the accept: header, and redirects to either json, xml depending on the accept content type, or else to the html page </p>",
        "id": 153842742,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450809
    },
    {
        "content": "<p>in this way, the spec is an example of itself (not conformant itself, but it will be)</p>",
        "id": 153842743,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450914
    },
    {
        "content": "<p><a href=\"http://hl7.org\" target=\"_blank\" title=\"http://hl7.org\">hl7.org</a> is hosted on IIS. So I have an ASP script that does the redirect. All good</p>",
        "id": 153842744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470450973
    },
    {
        "content": "<p>I'd like the same arrangements to apply to implementation guides. And these might be hosted ona variety of servers. But Apache is the most likely. </p>",
        "id": 153842746,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451111
    },
    {
        "content": "<p>how would do redirects like this on Apache? php? else...? </p>",
        "id": 153842747,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451156
    },
    {
        "content": "<p>most help explains how to use htaccess for this, but isn't that wrong for this context? (htaccess is server administrator stuff..?) (and it won't do Accept: header stuff..._</p>",
        "id": 153842748,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451270
    },
    {
        "content": "<p>for reference, the asp script:</p>",
        "id": 153842749,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451280
    },
    {
        "content": "<div class=\"codehilite\"><pre>&lt;%@ language=&quot;javascript&quot;%&gt;\n&lt;%\n  var s = String(Request.ServerVariables(&quot;HTTP_ACCEPT&quot;));\n  if (s.indexOf(&quot;json&quot;) &gt; -1) \n    Response.Redirect(&quot;http://hl7.org/fhir/&lt;%literal%&gt;.json&quot;);\n  else if (s.indexOf(&quot;xml&quot;) &gt; -1) \n    Response.Redirect(&quot;http://hl7.org/fhir/&lt;%literal%&gt;.xml&quot;);\n  else\n    Response.Redirect(&quot;http://hl7.org/fhir/&lt;%logical%&gt;.html&quot;);\n%&gt;\n&lt;!DOCTYPE html&gt;\n&lt;html&gt;\n&lt;body&gt;\nYou should not be seeing this page. If you do, ASP has failed badly.\n&lt;/body&gt;\n&lt;/html&gt;\n</pre></div>",
        "id": 153842750,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451299
    },
    {
        "content": "<p>on the server, this will be at e.g. /fhir/Patient/example/index.asp </p>",
        "id": 153842752,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451371
    },
    {
        "content": "<p>with the tokens replaced </p>",
        "id": 153842753,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470451380
    },
    {
        "content": "<p>Here's an example using nginx with about 10 lines of custom config.<br>\n<a href=\"https://github.com/jmandel/fhir-static-content-types\" target=\"_blank\" title=\"https://github.com/jmandel/fhir-static-content-types\">https://github.com/jmandel/fhir-static-content-types</a> </p>",
        "id": 153842756,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470453094
    },
    {
        "content": "<p>The relevant file is the nginx config <a href=\"https://github.com/jmandel/fhir-static-content-types/blob/master/nginx/default.conf\" target=\"_blank\" title=\"https://github.com/jmandel/fhir-static-content-types/blob/master/nginx/default.conf\">default.conf</a>, which demonstrates how to map a variable from the accept header.</p>",
        "id": 153842757,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470453119
    },
    {
        "content": "<p>The <a href=\"https://github.com/jmandel/fhir-static-content-types/blob/master/example-nginx.sh\" target=\"_blank\" title=\"https://github.com/jmandel/fhir-static-content-types/blob/master/example-nginx.sh\">example.sh</a> script just demonstrates that it works, by downloading the spec, running nginx in docker, and using this config to serve the spec as static content.</p>",
        "id": 153842758,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470453141
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> note that <a href=\"http://hl7.org\" target=\"_blank\" title=\"http://hl7.org\">hl7.org</a> isn't exposing FHIR MIME types:</p>\n<div class=\"codehilite\"><pre><span></span>$ curl -s -v http://hl7.org/fhir/patient-example.json 2&gt;&amp;1 | grep -i content-type\n&lt; Content-Type: application/json\n</pre></div>\n\n\n<p>My nginx config shows how to do this.</p>",
        "id": 153842759,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470454257
    },
    {
        "content": "<p>I don't have any clue how that example solves my problem. It's not for Apache, right? and I don't see where the name mapping happens? </p>",
        "id": 153842771,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470471279
    },
    {
        "content": "<p>as for the <a href=\"http://hl7.org\" target=\"_blank\" title=\"http://hl7.org\">hl7.org</a> server - I thought it was serving the correct mime types. I will investigate</p>",
        "id": 153842772,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470471346
    },
    {
        "content": "<p>Your question was about apache, but you indicated you didn't have an actual need to do this with apache specifically; so  I shared a way to do this with nginx (since it's my preferred tool for this kind of thing, and rapidly approaching Apache in usage numbers across the web). </p>",
        "id": 153842785,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470486148
    },
    {
        "content": "<p>The \"name mapping\" happens in the config file, if I understand what you're asking. It's the \"try_files\" rule, which says \"if the accept header wants json, look for a static file on disk by appending \".json\" to the requested url. </p>",
        "id": 153842786,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470486343
    },
    {
        "content": "<p>It's pretty succinct/powerful. </p>",
        "id": 153842787,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470486375
    },
    {
        "content": "<p>(Also, one  cool thing about my example is -- well,  if you have docker :p -- you can just run it and see how it works.) </p>",
        "id": 153842788,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470486570
    },
    {
        "content": "<p>so the name root mightn't match - the redirect has to not only deal with extensions, but deal with renaming</p>",
        "id": 153842789,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470490090
    },
    {
        "content": "<p>and, ok, nginx is fine, but still, what you showed was a config file approach, right? so I can't generate that? </p>",
        "id": 153842790,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1470490160
    },
    {
        "content": "<p>I'm not sure I understand the requirements, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>. Perhaps you could spell out a few examples of what you expect to happen when specific requests are made?</p>\n<p>But if you're looking to write a kind of explicit mapping file, and you want to do it with apache and a .htaccess file, then you can see this updated example  -- see the apache examples at <a href=\"https://github.com/jmandel/fhir-static-content-types\" target=\"_blank\" title=\"https://github.com/jmandel/fhir-static-content-types\">https://github.com/jmandel/fhir-static-content-types</a></p>",
        "id": 153842796,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1470503467
    }
]