[
    {
        "content": "<p>We are creating the patient resource based on information from both external registers and from internal systems. In order to make sure that internal systems do not update or delete information received from external systems we need to indicate on each element in the document what the source for the information is. Does anyone have input on how to solve this requirement?</p>",
        "id": 172770789,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565275273
    },
    {
        "content": "<p>You can indicate where each element comes from using Provenance resources and the (proposed) targetElement extension (see <a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21284\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21284\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21284</a>)</p>",
        "id": 172777893,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1565280031
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"216991\">@Ellen Gregusson</span>  - as a side question, are you maintaining a central registry of patients (ie a directory)? If so, will you be supporting the updating of data by clients? If so, interested in your thinking of which API you'll be using...</p>",
        "id": 172787466,
        "sender_full_name": "David Hay",
        "timestamp": 1565287013
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191321\">@David Hay</span> We are maintaining a registry of patients which have a relationship with the Health directorate in Norway. The clients will add and update part of the information on the patient. We will store some information that cannot be displayed in all clients so we will have to use patch-api's in order to add or update information from clients. We are using Microsoft FHIR server, so we are really looking forward to them implementing patch api's for person, patient, practitioner, related person and organization.</p>",
        "id": 172831644,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565336070
    },
    {
        "content": "<p>By patch - do you mean the patch operation?</p>",
        "id": 172832874,
        "sender_full_name": "David Hay",
        "timestamp": 1565337840
    },
    {
        "content": "<p>see: <a href=\"https://fhirblog.com/2019/07/09/thoughts-about-updating-registries/\" target=\"_blank\" title=\"https://fhirblog.com/2019/07/09/thoughts-about-updating-registries/\">https://fhirblog.com/2019/07/09/thoughts-about-updating-registries/</a> . - The team I work with isn't keen on PUT updates, and operations (as described in the post) have also received some criticism. We didn't really look at patch in detail, so interested in your approach to this...</p>",
        "id": 172833030,
        "sender_full_name": "David Hay",
        "timestamp": 1565337988
    },
    {
        "content": "<p>What I am thinking of is PATCH as opposed to PUT, GET, POST in REST. We are still at en early stage so we have not thought this really through yet, but in order to make sure that data received from external sources is not changed by clients we would like to have information about source on each element in order to not allow patches on them. As you mentioned in your document, we will probably also need an identifier for addresses and contact points/telecom in order to be able to update the correct item.</p>",
        "id": 172836671,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565342293
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191912\">@Michele Mottini</span> The information in the Provenance resource, is this available in the api to get for example patient, or do we need to do something special in the urls in order to get the provenance information related to each information element?</p>",
        "id": 172836814,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565342434
    },
    {
        "content": "<p>have you looked at the X-Provenance header?</p>",
        "id": 172837959,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565343825
    },
    {
        "content": "<p>The use of the header is not documented for other HTTP methods than PUT og POST. How do we use it for GET?</p>",
        "id": 172845615,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565352612
    },
    {
        "content": "<p>also PATCH</p>",
        "id": 172845646,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565352666
    },
    {
        "content": "<p>you wouldn't use it with a GET since nothing is changing</p>",
        "id": 172845649,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565352681
    },
    {
        "content": "<p>What we need is to show to the client which element has been received from which source when they get patient/practionerinformation. The client should not be able to change information provided by an external source, but should be able to change information created by internal systems.</p>",
        "id": 172845794,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565352852
    },
    {
        "content": "<p>Every patient search would have to include also Provenance: <code>.../Patient?_revinclude=Provenance:target&amp;. . . .</code><br>\nNote that this is just a way to make that information available, clients are still free to do everything they want in term of PUT/POST/PATCH - you server would have to implement checks to prevent forbidden modifications</p>",
        "id": 172847063,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1565354093
    },
    {
        "content": "<p>Is my understanding correct that we will not be able to get provenance information by using the GET method in REST, but that we have to do a search in order to find it? Will it be easy for the client to map the information from provenance with the information elements in Patient.</p>",
        "id": 172849864,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565356426
    },
    {
        "content": "<p>you can use _revinclude=Provenance:target on any GET... provided the server supports it, which you can require that it does</p>",
        "id": 172850637,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565356965
    },
    {
        "content": "<p>note that Provenance would indicate who made the change in a specific version of a resource. There is some client side processing one would need to do to determine which version changed a specific element (who updated the phone number?)</p>",
        "id": 172850790,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565357096
    },
    {
        "content": "<p>Does this mean that we have to fetch a provenance for each version of the Patient object, and the client will have to look through all of them in order to know who updated which element? If yes, I am not sure all our clients will be able to do this.<br>\nIn the Norwegian person registry they have a field for source under each element in the profile. See example from test below where Kilde = source. Is there any possibility that the field can be added to the profile in FHIR, or do we have to solve this with extensions?</p>\n<div class=\"codehilite\"><pre><span></span>    &quot;identifikasjonsnummer&quot;: [\n        {\n            &quot;ajourholdstidspunkt&quot;: &quot;2019-06-05T09:33:23+02:00&quot;,\n            &quot;erGjeldende&quot;: true,\n            &quot;kilde&quot;: &quot;dsf-folkeregister-synkronisering&quot;,\n            &quot;gyldighetstidspunkt&quot;: &quot;2019-06-05T00:00:00+02:00&quot;,\n            &quot;status&quot;: &quot;iBruk&quot;,\n            &quot;foedselsEllerDNummer&quot;: &quot;090524xxxxx&quot;,\n            &quot;identifikatortype&quot;: &quot;foedselsnummer&quot;\n        }\n    ],\n    &quot;status&quot;: [\n        {\n            &quot;ajourholdstidspunkt&quot;: &quot;2019-06-05T09:33:23+02:00&quot;,\n            &quot;erGjeldende&quot;: true,\n            &quot;kilde&quot;: &quot;&quot;,\n            &quot;aarsak&quot;: &quot;Innvandring&quot;,\n            &quot;gyldighetstidspunkt&quot;: &quot;2019-06-05T09:33:23+02:00&quot;,\n            &quot;status&quot;: &quot;bosatt&quot;\n        }\n    ],\n</pre></div>",
        "id": 172857074,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565362071
    },
    {
        "content": "<p>You'll have to go with extensions. Using Provenance would be the standard way to do it - so I think using an extension where a standard way to do the same thing (although more complex) exist would be discouraged (we have been there ourselves)</p>",
        "id": 172859543,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1565363796
    },
    {
        "content": "<p>See <a href=\"#narrow/stream/179166-implementers/topic/Source.20of.20information\" title=\"#narrow/stream/179166-implementers/topic/Source.20of.20information\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Source.20of.20information</a></p>",
        "id": 172859693,
        "sender_full_name": "Michele Mottini",
        "timestamp": 1565363906
    },
    {
        "content": "<p>we do have an improvement request (CR) to add more detail to the Provenance as to what element within the target resource was updated. The problem being that this is not in the model today, and is not clear how it would work.</p>",
        "id": 172859886,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565364050
    },
    {
        "content": "<p>It seems that CR (referenced in the chat Michele points at) did get approved.  it has not yet been integrated into the build.</p>",
        "id": 172860054,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565364176
    },
    {
        "content": "<blockquote>\n<p>you can use _revinclude=Provenance:target on any GET.</p>\n</blockquote>\n<p>I think that this is not true; only on search. But's only a small change in syntax for a client:</p>\n<p>GET [base]\\Patient\\X<br>\nGet [base]\\Patient?_id=X&amp;_revinclude...</p>",
        "id": 172883762,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565380449
    },
    {
        "content": "<p>I agree that doing revinclude leaves the client sorting out which provenance is the most recent for which element, and that logic to do that belongs on the server.</p>",
        "id": 172883806,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565380500
    },
    {
        "content": "<blockquote>\n<p>The client should not be able to change information provided by an external source, but should be able to change information created by internal systems.</p>\n</blockquote>\n<p>So if they were the source of the information, they can change it, but if it come from elsewhere, they can't?</p>",
        "id": 172883966,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565380593
    },
    {
        "content": "<p>There is also the VerificationResult resource that is similar to provenance however is appropriate when you're checking the content against multiple sources.<br>\nYku might have received the data from X, however you've cross referenced it with Y and Z.</p>",
        "id": 172987201,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1565564773
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  If the information comes from an official registry our internal systems will not be allowed to change the information. For example gender, identifiers and official addresses. We will be able to change non official phone numbers, e-mail adresses and temporary addresses.</p>",
        "id": 173109878,
        "sender_full_name": "Ellen Gregusson",
        "timestamp": 1565700689
    },
    {
        "content": "<p>so I think that this is definitely extension territory</p>",
        "id": 173185558,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565772709
    },
    {
        "content": "<p>This level of fine-grain access control and data manipulation is not the kind of problem REST intends to solve. So you will need to deal with this in ways that REST is not going to help you with. REST model sees the resource object boundary as the smallest atom to manage.</p>",
        "id": 173208296,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565793218
    },
    {
        "content": "<p>that doesn't mean it's impossible; it just explains why it's an extension</p>",
        "id": 173260560,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565836514
    },
    {
        "content": "<p>yes. an alternative is that we re-examine the layout of each Resource to determine if they need to be split up due to logical authorization boundaries. Such as the given that the addresses could be independent resources that are pointed to by the Practitioner.  I recommended this be part of the governance, especially when a resource gets very large.</p>",
        "id": 173299530,
        "sender_full_name": "John Moehrke",
        "timestamp": 1565883093
    },
    {
        "content": "<p>we do examine this. But we cannot divide in a way to make everyone happy - particularly in a case like this, where the granularity is at the element level</p>",
        "id": 173315490,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1565895895
    },
    {
        "content": "<p>I think we (my project) will need to implement this in a way that we do not need to define on the standard what are those boundaries (which elements, or which sources)</p>",
        "id": 173324795,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565903204
    },
    {
        "content": "<p>I am not sure those boundaries are at design level (use case specific) or at runtime level (looking at k-anonymity). But I believe we cannot get a consensus on which elements are more critical/sensitive than others.</p>",
        "id": 173325065,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565903429
    },
    {
        "content": "<p>Ellen's description seems to be relying on a fixed set of rules, so a flag extension + provenance could do it.</p>",
        "id": 173326464,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1565904562
    },
    {
        "content": "<blockquote>\n<blockquote>\n<p>you can use _revinclude=Provenance:target on any GET.</p>\n</blockquote>\n<p>I think that this is not true; only on search. But's only a small change in syntax for a client:</p>\n<p>GET [base]\\Patient\\X<br>\nGet [base]\\Patient?_id=X&amp;_revinclude...</p>\n</blockquote>\n<p>Would this be any different than searching for any Provenance resource referencing a specific Patient resource in target?<br>\nGET [base]/Provenance?target:identifier=X</p>",
        "id": 173968186,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1566566457
    },
    {
        "content": "<p>Provenance is about the resource it is pointing at in .target. Thus Provenance itself does not have a .subject element.  Thus you could search on Provenance with a target of the Patient, but that would only give you Provenance records about Create or Update events on that Patient resource itself.</p>",
        "id": 173973305,
        "sender_full_name": "John Moehrke",
        "timestamp": 1566570709
    },
    {
        "content": "<p>The specific question that started this thread is asking for a method of having more distinguishing Provenance. That has been addressed in <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21284\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=21284\">GF#21284</a></p>",
        "id": 173973600,
        "sender_full_name": "John Moehrke",
        "timestamp": 1566570912
    },
    {
        "content": "<blockquote>\n<p>Provenance is about the resource it is pointing at in .target. Thus Provenance itself does not have a .subject element.  Thus you could search on Provenance with a target of the Patient, but that would only give you Provenance records about Create or Update events on that Patient resource itself.</p>\n</blockquote>\n<p>Why only the Create or Update. The specific information about what is changed in the resource (recorded in the extensions of the target element discussed above). Should the information about what is changed in the Resource replace the information about the target resource itself?</p>",
        "id": 174884455,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1567605632
    },
    {
        "content": "<blockquote>\n<p>Should the information about what is changed in the Resource replace the information about the target resource itself?</p>\n</blockquote>\n<p>I'm not sure what you mean</p>",
        "id": 174920806,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567629581
    },
    {
        "content": "<p>The \"subject\" of the Provenance resource is called target. There is a proposal for two extensions to the target element to be able to describe what element is changed in the target resource. What I proposed was to search for all changes to a specific patient record using this transaction, Instead of the revinclude: <br>\nGET [base]/Provenance?target:identifier=X</p>\n<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> stated that this would only return the Provenance record about Create and Update events of the Patient record. I did not understand why it should not also return the delete, nullify transactions as well.</p>\n<p>I guess his point was that the transaction result would not include the patient resource itself.</p>",
        "id": 175045005,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1567758250
    },
    {
        "content": "<p>search does not return deleted records. that's the most obvious reason why. And most systems do not retain the deleted records since they are deleted</p>",
        "id": 175057467,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567771355
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192856\">@Thomas Tveit Rosenlund</span> delete is another action that a Provenance record can be made for. I simply was not exhaustive when I left it out. I also left it out as recording Provenance on delete will not be common, and thus domains that need it will specifically drive for it.</p>",
        "id": 175058827,
        "sender_full_name": "John Moehrke",
        "timestamp": 1567772564
    },
    {
        "content": "<blockquote>\n<p>search does not return deleted records. that's the most obvious reason why. And most systems do not retain the deleted records since they are deleted</p>\n</blockquote>\n<p>Sorry I don't get it. The search I tried to specify does not search for the deleted Patient resource but instead searches for all Provenance resources documenting the changes of the Patient resource, including the delete record. That Provenance resource should still exist even though the Patient resource is deleted? My guess would be if you put in the reference to the Patient that is not version specific, you should indeed get all changes to that Patient resource, even delete.</p>\n<p>After reviewing the Provenance resource again the documentation of the target reference states \"The Reference(s) that were generated or updated by the activity\" <br>\nIf the target element of a delete transaction is left empty a search on target would not return any Provenance resource documenting the deletion. Is that even allowed as the target reference has cardinality of 1..*?</p>",
        "id": 175059527,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1567773191
    },
    {
        "content": "<p>Thanks for the reply <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> In that case some clarification of that point could be added to the documentation. It is not totally clear to me how that should work based on the existing documentation.</p>",
        "id": 175059633,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1567773278
    },
    {
        "content": "<p>Please submit a CR with improvement recommendation.</p>",
        "id": 175061665,
        "sender_full_name": "John Moehrke",
        "timestamp": 1567774915
    },
    {
        "content": "<p>The effect of deleting a resource is not defined in the core given the various policies on what that might mean in various context (clinical is different than research is different than registry ...). The effect upon the Provenance records is even less defined. It is possible to have a policy where delete of a resoruce does indeed delete all Provenance (EU right to be forgotten implemented in a non-clinical system).</p>",
        "id": 175061865,
        "sender_full_name": "John Moehrke",
        "timestamp": 1567775036
    },
    {
        "content": "<blockquote>\n<p>The effect of deleting a resource is not defined in the core given the various policies on what that might mean in various context (clinical is different than research is different than registry ...). The effect upon the Provenance records is even less defined. It is possible to have a policy where delete of a resoruce does indeed delete all Provenance (EU right to be forgotten implemented in a non-clinical system).</p>\n</blockquote>\n<p>I agree, GDPR could demand the delete of all versions of Person and Provenance resources for the information about a given Person in non-clinical systems.</p>",
        "id": 175326681,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1568115098
    },
    {
        "content": "<p>if you are referencing the regulated fact that you must keep the data due to medical records retention regulation.. correct, but then no delete can be done on anything that might have been used...<br>\nMore important overall is that once that regulated reason under Medical Records Retention expire, you MUST delete all data unless you get authorization from the patient to keep it for a defined purpose. So the delete must happen eventually.<br>\nSee the GDPR analysis HL7 has done relative to FHIR   <a href=\"https://confluence.hl7.org/display/SEC/FHIR+-+GDPR\" target=\"_blank\" title=\"https://confluence.hl7.org/display/SEC/FHIR+-+GDPR\">https://confluence.hl7.org/display/SEC/FHIR+-+GDPR</a></p>",
        "id": 175329824,
        "sender_full_name": "John Moehrke",
        "timestamp": 1568118051
    },
    {
        "content": "<p>Would for this use-case the source field in the meta section of a resource not suffice? By setting the source field to the origin system in each of the resources, would it not be possible quickly identify what the 'external' vs 'internal' resources are?</p>",
        "id": 175427018,
        "sender_full_name": "Joost Reuzel",
        "timestamp": 1568205908
    },
    {
        "content": "<p>Depends what your rules are around distinguishing internal from external.  Does something that's updated become 'internal'?  What about something that came from outside but was \"approved\" to become part of the local record?</p>",
        "id": 175427945,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1568206553
    },
    {
        "content": "<p>Reading further, I see that Ellen needs source information per element of the resource. As the source field exist on the resource (meta) level, this won't be granular enough. Provenance indeed seems the way to go here...</p>",
        "id": 175429237,
        "sender_full_name": "Joost Reuzel",
        "timestamp": 1568207430
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192587\">@David Pyke</span> <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> do you want to entertain a discussion for that? I am thinking we may need a standard extensions that can be used for DS4P and things like this. The concepts should be also clarified in any guidance - IMO it's less about \"internal vs external\" but \"changeable acc policy X, not readable acc policy Y, accessible via consent X1\"...</p>",
        "id": 175431790,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568208922
    },
    {
        "content": "<p>(i'm pinging you 2 because of the chat we had earlier an because i do not know the secprivacy agenda for next week...)</p>",
        "id": 175431864,
        "sender_full_name": "Jose Costa Teixeira",
        "timestamp": 1568208965
    },
    {
        "content": "<blockquote>\n<p>if you are referencing the regulated fact that you must keep the data due to medical records retention regulation.. correct, but then no delete can be done on anything that might have been used...<br>\nMore important overall is that once that regulated reason under Medical Records Retention expire, you MUST delete all data unless you get authorization from the patient to keep it for a defined purpose. So the delete must happen eventually.<br>\nSee the GDPR analysis HL7 has done relative to FHIR   <a href=\"https://confluence.hl7.org/display/SEC/FHIR+-+GDPR\" target=\"_blank\" title=\"https://confluence.hl7.org/display/SEC/FHIR+-+GDPR\">https://confluence.hl7.org/display/SEC/FHIR+-+GDPR</a></p>\n</blockquote>\n<p>Is there any meaningful difference differencing the Delete and Nullify codes described in <a href=\"https://www.hl7.org/fhir/valueset-provenance-activity-type.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/valueset-provenance-activity-type.html\">https://www.hl7.org/fhir/valueset-provenance-activity-type.html</a><br>\nThe way DELETE is described in this discussion, they seem to be similar.</p>",
        "id": 175525192,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1568292665
    },
    {
        "content": "<p>so that is a comprensive valueset, and therefore not uncommon for there to be overlapping terms. I read the definition and Delete is actual delete, where as Nullify seems to be setting the .status element in a way that results in the data being not normally visible.</p>",
        "id": 175570174,
        "sender_full_name": "John Moehrke",
        "timestamp": 1568321541
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> agreed, it is actually described as a state change. Thanks for the clarification.</p>",
        "id": 175600048,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1568358590
    }
]