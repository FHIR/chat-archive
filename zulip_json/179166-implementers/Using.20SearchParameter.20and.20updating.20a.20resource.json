[
    {
        "content": "<p>I'm using the following SearchParameter to eliminate duplicate Identifiers for a Patient resource.  It works fine until I try to update that resource using the identifier as part of the PUT command with URL <a href=\"http://localhost:3111/myfhir/Patient?identifier=urn:uuid:555|26828F0386673\">http://localhost:3111/myfhir/Patient?identifier=urn:uuid:555|26828F0386673</a>. An error is returned</p>\n<p>Can not create resource of type Patient as it would create a duplicate unique index matching query: Patient?identifier=urn%3Auuid%3A555%7C26828F0386673 (existing index belongs to Patient/391494aa-0cba-4e88-85c8-7539a5e9506f, new unique index created by SearchParameter/11d73d9c-b13a-4f70-9e7d-a7a916d80765)</p>\n<p>If I use the id for the patient directly the update of the resource  works fine. <a href=\"http://localhost:3111/myfhir/Patient/391494aa-0cba-4e88-85c8-7539a5e9506f\">http://localhost:3111/myfhir/Patient/391494aa-0cba-4e88-85c8-7539a5e9506f</a>.</p>\n<p>Once I use a SearchParameter does that mean I can't use the identifier for the update?  What am I missing?</p>\n<p>It's worth noting that in the HFJ_IDX_CMP_STRING_UNIQ table the IDX_STRING column always has an entry like Patient?identifier=urn%3Auuid%3A555%7C26828F0386673 no matter if the SearchParameter expression is Patient.identifier or Patient.identifer.value</p>\n<p>Thanks.</p>\n<p>The SearchParameter looks like:<br>\n{<br>\n\"resourceType\": \"SearchParameter\",<br>\n\"meta\": {<br>\n\"lastUpdated\": \"2021-05-02T10:43:02.162-04:00\",<br>\n\"tag\": [ {<br>\n\"system\": \"<a href=\"https://my.health.com/x/Onc1C\">https://my.health.com/x/Onc1C</a>\",<br>\n\"code\": \"34a800fa-bba9-4cb9-77ed-0aa4d0eecef2\",<br>\n\"display\": \"FHIR Implementation Team\"<br>\n} ]<br>\n},<br>\n\"extension\": [<br>\n{<br>\n\"url\": \"<a href=\"http://hapifhir.io/fhir/StructureDefinition/sp-unique\">http://hapifhir.io/fhir/StructureDefinition/sp-unique</a>\",<br>\n\"valueBoolean\": true<br>\n}<br>\n],<br>\n\"url\": \"<a href=\"http://health.com/fhir/SearchParameter/uniq-patient-identifier\">http://health.com/fhir/SearchParameter/uniq-patient-identifier</a>\",<br>\n\"name\": \"unique-patient-identifier\",<br>\n\"status\": \"active\",<br>\n\"description\": \"A unique patient identifier\",<br>\n\"code\": \"unique-patient-identifier\",<br>\n\"base\": [<br>\n\"Patient\"<br>\n],<br>\n\"type\": \"token\",<br>\n\"expression\": \"Patient\",<br>\n\"component\": [<br>\n{<br>\n\"definition\": \"<a href=\"http://hl7.org/fhir/SearchParameter/patient-identifier\">http://hl7.org/fhir/SearchParameter/patient-identifier</a>\",<br>\n\"expression\": \"Patient.identifier\"<br>\n}<br>\n]<br>\n}</p>",
        "id": 270572182,
        "sender_full_name": "Joe Atterberry",
        "timestamp": 1643904068
    },
    {
        "content": "<p>This sounds like a server-specific question.  Are you using HAPI, .NET, something else?</p>",
        "id": 270578381,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643906454
    },
    {
        "content": "<p>Using HAPI FHIR Java on version 5.4.0</p>",
        "id": 270615038,
        "sender_full_name": "Joe Atterberry",
        "timestamp": 1643921140
    },
    {
        "content": "<p>sounds like a question for <a class=\"stream\" data-stream-id=\"179167\" href=\"/#narrow/stream/179167-hapi\">#hapi</a></p>",
        "id": 270615122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643921168
    },
    {
        "content": "<p>ok.  I'll post there</p>",
        "id": 270615151,
        "sender_full_name": "Joe Atterberry",
        "timestamp": 1643921192
    }
]