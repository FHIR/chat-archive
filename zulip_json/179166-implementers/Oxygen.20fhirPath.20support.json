[
    {
        "content": "<p>For most of what I do I use Oxygen XML Editor (java). Oxygen can be extended with an <a href=\"https://github.com/raducoravu/hl7-framework/\" target=\"_blank\" title=\"https://github.com/raducoravu/hl7-framework/\">XMLCatalog</a> for FHIR. Oxygen also recently added XPath support for JSON, which helps, but it got me thinking how much nicer life would be if there were fhirPath support inside.</p>\n<p>Oxygen is extensible in a <a href=\"https://www.oxygenxml.com/doc/versions/21.1/ug-editor/topics/extending-oxygen.html\" target=\"_blank\" title=\"https://www.oxygenxml.com/doc/versions/21.1/ug-editor/topics/extending-oxygen.html\">number of ways</a>, but did anyone by any chance already look into how that would work?</p>",
        "id": 168853263,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1561385860
    },
    {
        "content": "<p>I was also looking for the Java implementation of fhirPath, but the <a href=\"http://wiki.hl7.org/index.php?title=FHIRPath_Implementations\" target=\"_blank\" title=\"http://wiki.hl7.org/index.php?title=FHIRPath_Implementations\">Wiki</a> looks outdated or at the very least I cannot find something I would send to the Oxygen makers as part of my feature request. Is there really only a DSTU3 implementation or is there something separate from FHIR releases now that FHIRPath itself has been branched off?</p>",
        "id": 169549138,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1562142944
    },
    {
        "content": "<p>FHIRPath support is part of HAPI and has full support for all versions, including draft R5</p>",
        "id": 169566746,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1562161095
    },
    {
        "content": "<p>I thought HAPI inherited that from somewhere in <a href=\"http://github.com/hl7/fhir\" target=\"_blank\" title=\"http://github.com/hl7/fhir\">github.com/hl7/fhir</a>, but I could make out where/what. Apparently the code actually lives in HAPI?</p>\n<p><a href=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/utils\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/utils\">https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.dstu3/src/main/java/org/hl7/fhir/dstu3/utils</a><br>\n<a href=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/utils\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/utils\">https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r4/src/main/java/org/hl7/fhir/r4/utils</a><br>\n<a href=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils\" target=\"_blank\" title=\"https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils\">https://github.com/hapifhir/org.hl7.fhir.core/tree/master/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/utils</a></p>",
        "id": 169586257,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1562175196
    },
    {
        "content": "<p>The code has been migrated to the HAPI repository, yes</p>",
        "id": 169594956,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562181817
    },
    {
        "content": "<p>That's the right stuff you're looking at</p>",
        "id": 169594961,
        "sender_full_name": "Vadim Peretokin",
        "timestamp": 1562181822
    },
    {
        "content": "<p>I am trying to use oxygen with the current R4 schematrons. Keep getting error \"Cannot find a 0-argument function named {http://www.w3.org/2005/xpath-functions}name.exists()\". Before and after adding the XMLCatalog you mentioned. Any idea?</p>",
        "id": 179368954,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572379732
    },
    {
        "content": "<p>That sounds like we've got FHIRPath that suck into XPath somehow.  Can you look at the schematron and see where name.exists() is appearing?</p>",
        "id": 179373002,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572382338
    },
    {
        "content": "<p>fhir-invariants.sch line 4753:</p>\n<p>&lt;sch:assert test=\"((not(f:type/@value = 'named-event')) or name.exists()) and (not(f:type/@value = 'periodic') or timing.exists()) and (not(starts-with(f:type/@value, 'data-')) or data.exists())\"&gt;trd-3: A named event requires a name, a periodic event requires timing, and a data event requires data&lt;/sch:assert&gt;</p>\n<p>I am looking at the R4 release schemas/schematrons. Those from build.fhir yield schema errors earlier in the process.</p>",
        "id": 179377061,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572385272
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Any chance this was fixed in the technical correction?</p>",
        "id": 179377534,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572385574
    },
    {
        "content": "<p>Just tried the build version: Now the same error points to line 4999 in the same file.</p>",
        "id": 179377867,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572385827
    },
    {
        "content": "<p>I don't know of any reason it would have been fixed in the technical correction</p>",
        "id": 179381503,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572388007
    },
    {
        "content": "<p>and I just completed the gold build, and the clock is running...</p>",
        "id": 179384363,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1572389655
    },
    {
        "content": "<p>no worries, I am not in production. Just checking the validation tools in a good old experimental XML environment.</p>",
        "id": 179385338,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572390274
    },
    {
        "content": "<p>It should be:<br>\n<code>(not(f:type/@value='named-event') or exists(f:name)) and (not(f:type/@value='periodic') or exists(f:timing)) and (not(starts-with(f:type/@value, 'data-')) or exists(f:data))</code></p>",
        "id": 179396070,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572400548
    },
    {
        "content": "<p>Submitted as <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25088\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=25088\">GF#25088</a>]</p>",
        "id": 179396308,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572400921
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> ! I fixed this at two occurrences. And also a few other flaws, including a few unmatched closing brackets, and commented out two lines with erroneous regexp. <a href=\"/user_uploads/10155/azUqBBwVlmYtjBnQIPYOnMyg/fhir-invariants.sch\" target=\"_blank\" title=\"fhir-invariants.sch\">fhir-invariants.sch</a>. Now it appears to work as expected.</p>",
        "id": 179426891,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572439261
    },
    {
        "content": "<p>Can you tell us where the other errors were?</p>",
        "id": 179431531,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572442451
    },
    {
        "content": "<p>lines 2718-2721: unmatched closing bracket<br>\n      &lt;sch:assert test=\"exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='adr'])))\"&gt;ppc-4: IF Scope=adr, there must be a patient&lt;/sch:assert&gt;<br>\n      &lt;sch:assert test=\"exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='treatment'])))\"&gt;ppc-5: IF Scope=treatment, there must be a patient&lt;/sch:assert&gt;<br>\n      &lt;sch:assert test=\"exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='patient-privacy'])))\"&gt;ppc-2: IF Scope=privacy, there must be a patient&lt;/sch:assert&gt;<br>\n      &lt;sch:assert test=\"exists(f:patient) or not(exists(f:scope/f:coding[f:system/@value='something' and f:code/@value='research'])))\"&gt;ppc-3: IF Scope=research, there must be a patient&lt;/sch:assert&gt;</p>\n<p>line 4753 and 5047: function call<br>\n      &lt;sch:assert test=\"((not(f:type/@value = 'named-event')) or name.exists()) and (not(f:type/@value = 'periodic') or timing.exists()) and (not(starts-with(f:type/@value, 'data-')) or data.exists())\"&gt;trd-3: A named event requires a name, a periodic event requires timing, and a data event requires data&lt;/sch:assert&gt;</p>\n<p>line 10670: trailing garbage within first bracket (unmatched quote)<br>\n      &lt;sch:assert test=\"f:type/@value=('choice','open-choice','decimal','integer','date','dateTime','time','string','quantity',') or not(f:answerOption or f:answerValueSet)\"&gt;que-5: Only 'choice' and 'open-choice' items can have answerValueSet&lt;/sch:assert&gt;</p>\n<p>lines 12144 and 12182: parser complains about regexp (something with amp character... had no time to analyze):<br>\n      &lt;sch:assert test=\"matches(path/@value, '[^\\s\\.,:;\\'&amp;quot;\\/|?!@#$%&amp;amp;*()\\[\\]{}]{1,64}(\\.[^\\s\\.,:;\\'&amp;quot;\\/|?!@#$%&amp;amp;*()\\[\\]{}]{1,64}(\\[x\\])?(\\:[^\\s\\.]+)?)*')\"&gt;eld-19: Element names cannot include some special characters&lt;/sch:assert&gt;</p>",
        "id": 179462471,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572460335
    },
    {
        "content": "<p>If you diff the file I attached in previous message vs the original, you'll see what I changed.</p>",
        "id": 179464613,
        "sender_full_name": "Christof Gessner",
        "timestamp": 1572461498
    },
    {
        "content": "<p>thanks</p>",
        "id": 179466171,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1572462379
    }
]