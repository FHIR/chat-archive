[
    {
        "content": "<p>The Cerner API marks all responses with an X-Request-Id so they can trace support issues back to their logs. it works really well. But it presents a challenge for me - the level at which I use the request-id is a different one to where I'm handling the HTTP headers... which I think would not be unusual. So I need to track the request-id explicitly... and don't want to have server specific code for this.</p>",
        "id": 153918617,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510260684
    },
    {
        "content": "<p>is this something we should standardise?</p>",
        "id": 153918618,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510260694
    },
    {
        "content": "<p>as long as it is optional, I would say go for it. It is great for doing your correlation-log-stuff</p>",
        "id": 153918619,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1510260802
    },
    {
        "content": "<p>I think having this at the header level is very important - it's orthogonal to the actual data</p>",
        "id": 153918627,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1510261233
    },
    {
        "content": "<p>In our case, this is often inserted at a different layer - the FHIR server isn't directly aware of it (and this helps troubleshoot when things go wrong before getting to our server)</p>",
        "id": 153918628,
        "sender_full_name": "Jenni Syed",
        "timestamp": 1510261405
    },
    {
        "content": "<p>I'm with Jenni on this.  In HTTP we see this in headers, in SOAP, in the envelope, in SMTP also in headers.  It's tracking data.  IF it gets into the resource, it becomes a problematic to deal with.</p>",
        "id": 153918630,
        "sender_full_name": "Keith Boone",
        "timestamp": 1510261444
    },
    {
        "content": "<p>umm, I mean, standardise the name of the header in the http. Definitely not something to put in a resource</p>",
        "id": 153918633,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510262188
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> I'm not sure where this field goes in AuditEvent, btw</p>",
        "id": 153918648,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510264061
    },
    {
        "content": "<p>It isn't an active participant (agent), so I would put this into an AuditEvent.entity. it would likely just put the valu of X-Request-Id into <a href=\"http://AuditEvent.entity.name\" target=\"_blank\" title=\"http://AuditEvent.entity.name\">AuditEvent.entity.name</a> and set AuditEvent.entity.type to \"X-Request-Id\". Very little overhead, but easy to search/match.     I was expecting to find something like this in IHE for SOAP request identifiers...</p>",
        "id": 153918674,
        "sender_full_name": "John Moehrke",
        "timestamp": 1510269175
    },
    {
        "content": "<p>I didn't think of that because I don't see the log id is 'data or objects used'</p>",
        "id": 153918678,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510269660
    },
    {
        "content": "<p>We've started to look at this and are using this within our reference implementation. We are putting a correlation Id in X-Request-Id header and responses it's going in X-Correlation-Id.</p>",
        "id": 153918827,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1510310479
    },
    {
        "content": "<p>We're thinking it needs to be standardised (along with X-Forwarded-For and X-Forwarded-Host) for gateways.</p>",
        "id": 153918829,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1510310657
    },
    {
        "content": "<p>(the 'we' means our team, not project or organisation)</p>",
        "id": 153918830,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1510310688
    },
    {
        "content": "<p><a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14162\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14162\">GF#14162</a></p>",
        "id": 153918936,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510349576
    },
    {
        "content": "<p>Maybe name it without an X-? <code>fhir-request-id</code>? <a href=\"https://tools.ietf.org/html/rfc6648\" target=\"_blank\" title=\"https://tools.ietf.org/html/rfc6648\">https://tools.ietf.org/html/rfc6648</a></p>",
        "id": 153919304,
        "sender_full_name": "Nick Hatt",
        "timestamp": 1510590692
    },
    {
        "content": "<p>interesting. I had not seen that</p>",
        "id": 153919386,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1510621646
    },
    {
        "content": "<p>FYI: I wrote this up in a blog... that is the impact on AuditEvent record <a href=\"https://healthcaresecprivacy.blogspot.com/2017/11/extra-softwaretransaction-details-in.html\" target=\"_blank\" title=\"https://healthcaresecprivacy.blogspot.com/2017/11/extra-softwaretransaction-details-in.html\">https://healthcaresecprivacy.blogspot.com/2017/11/extra-softwaretransaction-details-in.html</a></p>",
        "id": 153919497,
        "sender_full_name": "John Moehrke",
        "timestamp": 1510674405
    },
    {
        "content": "<p>thanks. That link is very useful</p>",
        "id": 153919505,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1510674788
    },
    {
        "content": "<p>ok actioned task <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14162\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14162\">GF#14162</a>. But it was short on details, so I'm looking for review of what I wrote. see <a href=\"http://build.fhir.org/http.html#custom\" target=\"_blank\" title=\"http://build.fhir.org/http.html#custom\">build.fhir.org/http.html#custom</a>. <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> <span class=\"user-mention\" data-user-id=\"194031\">@Nick Hatt</span> <span class=\"user-mention\" data-user-id=\"194909\">@Kevin Mayfield</span> <span class=\"user-mention\" data-user-id=\"191356\">@Jenni Syed</span> <span class=\"user-mention\" data-user-id=\"191430\">@Paul Knapp</span> <span class=\"user-mention\" data-user-id=\"191396\">@Brian Pech</span> <span class=\"user-mention\" data-user-id=\"191369\">@Andy Stechishin</span></p>",
        "id": 153976773,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1532052843
    },
    {
        "content": "<p>That anchor doesn't resolve</p>",
        "id": 153976776,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1532053352
    },
    {
        "content": "<p>will soon. give it a little while to build...</p>",
        "id": 153976779,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1532054265
    },
    {
        "content": "<p>did you move that audit to another task?</p>",
        "id": 153976880,
        "sender_full_name": "John Moehrke",
        "timestamp": 1532110309
    },
    {
        "content": "<p>no I didn't do that</p>",
        "id": 153976890,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1532117718
    },
    {
        "content": "<p>I'm re-looking into this now (while implementing a form of gateway) and notices that the x-forwarded-host seems a little strange,<br>\nIs this meant to have the full URL of the request, just the base URL of the FHIR server for the request, or just the hostname of the request (which isn't going to be enough to work out what it was)<br>\ne.g. <br>\n<a href=\"http://apigatewayserver.example.com\" target=\"_blank\" title=\"http://apigatewayserver.example.com\">apigatewayserver.example.com</a><br>\n<a href=\"http://apigatewayserver.example.com/fhirserver2\" target=\"_blank\" title=\"http://apigatewayserver.example.com/fhirserver2\">http://apigatewayserver.example.com/fhirserver2</a><br>\n<a href=\"http://apigatewayserver.example.com/fhirserver2/Patient/45/_history/2\" target=\"_blank\" title=\"http://apigatewayserver.example.com/fhirserver2/Patient/45/_history/2\">http://apigatewayserver.example.com/fhirserver2/Patient/45/_history/2</a><br>\n<a href=\"http://apigatewayserver.example.com/fhirserver1/Practitioner?active=true\" target=\"_blank\" title=\"http://apigatewayserver.example.com/fhirserver1/Practitioner?active=true\">http://apigatewayserver.example.com/fhirserver1/Practitioner?active=true</a><br>\n(p.s. I'm really hoping its the latter of the formats, not the first one.</p>",
        "id": 161422993,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1553234648
    },
    {
        "content": "<p>Indeed - the first one won't even tell you http vs https (ouch)</p>",
        "id": 161425783,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1553239029
    },
    {
        "content": "<p>it would just be the FQDN of the server</p>",
        "id": 161484225,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553288955
    },
    {
        "content": "<p>why would that not be enough? enough for what?</p>",
        "id": 161484254,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553288983
    },
    {
        "content": "<p>Generally you want this sort of think for constructing URLs in responses that reference the external-facing endpoint rather than the internal deployment endpoint.</p>",
        "id": 161493448,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1553297141
    },
    {
        "content": "<p>how would that be solved elsewhere?</p>",
        "id": 161494160,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553297656
    },
    {
        "content": "<p>I was about to put in a setting for what the external base url is for the server so that when generating absolute urls they are created right.<br>\nRelative urls don't have the problem, which I would suspect most Web apps do.</p>",
        "id": 161504288,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1553311649
    },
    {
        "content": "<p>Yep. Ontoserver uses a setting, but that is limiting in some cases, and not as good as \"it just works\".<br>\nRelative links is generally fine for Web Apps, but not for FHIR Resources that require absolute URLs</p>",
        "id": 161504645,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1553312165
    },
    {
        "content": "<p>After more research over the weekend, this is just the hostname, nothing further - as per the standard HTTP stuff<br>\nBut we have missed X-Forwarded-Proto and X-Forwarded-Port which are not covered, and probably should be included.</p>",
        "id": 161605238,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1553474666
    },
    {
        "content": "<p>are these used elsewhere?</p>",
        "id": 161608568,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553479771
    },
    {
        "content": "<p>It's the full set of related headers. And many proxies set these.</p>",
        "id": 161623617,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1553502979
    },
    {
        "content": "<p>And then there's the <code>Forwarded</code> header, which is the standardised one:  <a href=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded\" target=\"_blank\" title=\"https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded\">https://developer.mozilla.org/en-US/docs/Web/HTTP/Headers/Forwarded</a> -- does it need to be included as well?</p>",
        "id": 161944081,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1553773397
    },
    {
        "content": "<p>well, we don't need to define it then</p>",
        "id": 161980295,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1553798059
    },
    {
        "content": "<p>has anyone started to log the X-Request-Id in their AuditEvent logs? If so, how do you encode it.. might be something useful to standardsize? Or at least provide an example?</p>",
        "id": 175075351,
        "sender_full_name": "John Moehrke",
        "timestamp": 1567783720
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>  <span class=\"s2\">&quot;entity&quot;</span> <span class=\"err\">:</span> <span class=\"p\">[{</span>\n   <span class=\"nt\">&quot;type&quot;</span> <span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"nt\">&quot;code&quot;</span> <span class=\"p\">:</span> <span class=\"s2\">&quot;X-Request-Id&quot;</span><span class=\"p\">},</span>\n   <span class=\"nt\">&quot;identifier&quot;</span> <span class=\"p\">:</span> <span class=\"p\">{</span> <span class=\"nt\">&quot;value&quot;</span> <span class=\"p\">:</span> <span class=\"s2\">&quot;[v]&quot;</span><span class=\"p\">}</span>\n  <span class=\"p\">}]</span>\n</pre></div>",
        "id": 175099107,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567800458
    },
    {
        "content": "<p>that's what I'm doing. I think there's a couple of problems with that</p>",
        "id": 175099124,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1567800474
    }
]