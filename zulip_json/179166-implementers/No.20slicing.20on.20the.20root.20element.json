[
    {
        "content": "<p>Hello, <br>\nI created a profile with an extension with forge and validated the xml that is generated by forge.<br>\nFor validation I use the FHIR Validator (<a href=\"https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\" target=\"_blank\" title=\"https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\">https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator</a>).<br>\nThe validation output shows the following error \"No slicing on the root element [element.first().slicing.empty()]\".<br>\nI found out, that the problem is that the extension is the first element in the differential in the xml. <br>\nWhen I change the order of the elements, so that the extension is not first element, I get no error. <br>\nWhy is the xml produced by forge not in the right order? Or is the validation tool not working correctly?<br>\nHas anyone had the same problem?</p>",
        "id": 173787074,
        "sender_full_name": "Katarina",
        "timestamp": 1566389180
    },
    {
        "content": "<p>This might be a validator problem rather than a Forge problem.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, is this another sparse differential issue we haven't dealt with?</p>",
        "id": 173787528,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1566389541
    },
    {
        "content": "<p>It may be a candidate for a technical correction for R4 too if this is being enforced on differential</p>",
        "id": 173787561,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1566389585
    },
    {
        "content": "<p>I tried also validate on Simplifier and $validate on vonk, both are showing the same error.</p>",
        "id": 173795842,
        "sender_full_name": "Katarina",
        "timestamp": 1566395638
    },
    {
        "content": "<p>Are there other fhir validation tools that can check Profiles. For example if a ValueSet that is used in a binding is defined for example in a repository?<br>\n Or that the profile follows some defined naming conventions?</p>",
        "id": 173796185,
        "sender_full_name": "Katarina",
        "timestamp": 1566395869
    },
    {
        "content": "<p>you'll have to share an instance (actually, both profile and test case) so we can understand what you are doing</p>",
        "id": 173825553,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1566416189
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"221154\">@Katarina</span>, as Grahame mentions, is it possible to share an instance?<br>\nForge indeed generates sparse differentials and the first element doesn't need to be the root. This is compliant to the FHIR spec. Validators should accept this; if they complain, then this indicates a bug in the validation logic.<br>\nAlso see the definition of invariant sdf-20:<br>\n<a href=\"http://hl7.org/fhir/structuredefinition.html\" target=\"_blank\" title=\"http://hl7.org/fhir/structuredefinition.html\">http://hl7.org/fhir/structuredefinition.html</a><br>\nThe expression applies to the root element without \".\" in the path - not the first element in the list.</p>",
        "id": 173865049,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566465025
    },
    {
        "content": "<p>Instance:</p>\n<p>&lt;?xml version=\"1.0\" encoding=\"utf-8\"?&gt;<br>\n&lt;StructureDefinition xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n  &lt;url value=\"<a href=\"https://example.de/fhir/StructureDefinition/ClinicalInformation\" target=\"_blank\" title=\"https://example.de/fhir/StructureDefinition/ClinicalInformation\">https://example.de/fhir/StructureDefinition/ClinicalInformation</a>\" /&gt;<br>\n  &lt;id value=\"clinicalInformation\"/&gt;<br>\n  &lt;version value=\"0.1\"/&gt;<br>\n  &lt;name value=\"ClinicalInformation\" /&gt;<br>\n  &lt;status value=\"draft\" /&gt;<br>\n  &lt;fhirVersion value=\"3.0.1\" /&gt;<br>\n  &lt;kind value=\"resource\" /&gt;<br>\n  &lt;abstract value=\"false\" /&gt;<br>\n  &lt;type value=\"Condition\" /&gt;<br>\n  &lt;baseDefinition value=\"<a href=\"http://fhir.de/StructureDefinition/condition-de-basis/0.2\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/condition-de-basis/0.2\">http://fhir.de/StructureDefinition/condition-de-basis/0.2</a>\" /&gt;<br>\n  &lt;derivation value=\"constraint\" /&gt;<br>\n  &lt;differential&gt;<br>\n    &lt;element id=\"Condition.extension\"&gt;<br>\n      &lt;path value=\"Condition.extension\" /&gt;<br>\n      &lt;slicing&gt;<br>\n        &lt;discriminator&gt;<br>\n          &lt;type value=\"value\" /&gt;<br>\n          &lt;path value=\"url\" /&gt;<br>\n        &lt;/discriminator&gt;<br>\n        &lt;rules value=\"open\" /&gt;<br>\n      &lt;/slicing&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Condition.extension:infection\"&gt;<br>\n      &lt;path value=\"Condition.extension\" /&gt;<br>\n      &lt;sliceName value=\"infection\" /&gt;<br>\n      &lt;type&gt;<br>\n        &lt;code value=\"Extension\" /&gt;<br>\n        &lt;profile value=\"<a href=\"https://example.de/fhir/StructureDefinition/Infection\" target=\"_blank\" title=\"https://example.de/fhir/StructureDefinition/Infection\">https://example.de/fhir/StructureDefinition/Infection</a>\" /&gt;<br>\n      &lt;/type&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Condition.evidence.code.coding.system\"&gt;<br>\n      &lt;path value=\"Condition.evidence.code.coding.system\" /&gt;<br>\n      &lt;binding&gt;<br>\n        &lt;strength value=\"required\" /&gt;<br>\n        &lt;valueSetUri value=\"<a href=\"https://example.de/fhir/ValueSet/symptom\" target=\"_blank\" title=\"https://example.de/fhir/ValueSet/symptom\">https://example.de/fhir/ValueSet/symptom</a>\" /&gt;<br>\n      &lt;/binding&gt;<br>\n    &lt;/element&gt;<br>\n  &lt;/differential&gt;<br>\n&lt;/StructureDefinition&gt;</p>",
        "id": 173865661,
        "sender_full_name": "Katarina",
        "timestamp": 1566465645
    },
    {
        "content": "<p>For this profile I got the mentioned error. When I changed the order so that the Condition.evidence.code.coding.system element appears first the error disappears.</p>",
        "id": 173865914,
        "sender_full_name": "Katarina",
        "timestamp": 1566465918
    },
    {
        "content": "<p>I also had the error that the id element was not in the right order.</p>",
        "id": 173866003,
        "sender_full_name": "Katarina",
        "timestamp": 1566465993
    },
    {
        "content": "<p>The <code>Condition.extension</code> element(s) should definitely appear first in the element list, before resource-specific fields, as for all common fields derived from abstract base <code>DomainResource</code>.</p>",
        "id": 173866731,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566466601
    },
    {
        "content": "<p>So this looks like a bug in the validator</p>",
        "id": 173866772,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566466649
    },
    {
        "content": "<p>Ok, thank you. Are there other validation tools that I overlooked?</p>",
        "id": 173869973,
        "sender_full_name": "Katarina",
        "timestamp": 1566469793
    },
    {
        "content": "<p>Possibly, but I am only aware of the open source .NET and HAPI/Java validator implementations.<br>\n<span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> I am surprised that the .NET validator trips on this? Should be able to handle sparse differentials.</p>",
        "id": 173871024,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566470889
    },
    {
        "content": "<p>oh - this is an error in invariant sdf-20, which is going to be fixed in the technical correciton</p>",
        "id": 173925748,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1566511783
    },
    {
        "content": "<p>I thought we already fixed that?<br>\n<a href=\"http://hl7.org/fhir/structuredefinition.html#invs\" target=\"_blank\" title=\"http://hl7.org/fhir/structuredefinition.html#invs\">http://hl7.org/fhir/structuredefinition.html#invs</a><br>\nsdf-20:<br>\n<code>element.where(path.contains('.').not()).slicing.empty()</code><br>\nThis expression only matches an actual root element (single path segment), and not the first element in the list.</p>",
        "id": 173953258,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566550985
    },
    {
        "content": "<p>the technical correction to R3 isn't yet made.</p>",
        "id": 173965428,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1566564169
    },
    {
        "content": "<p>the week after Atlanta</p>",
        "id": 173965431,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1566564176
    },
    {
        "content": "<p>Indeed, sdf-20 in STU3 is still broken. Thanks.</p>",
        "id": 173965790,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1566564449
    },
    {
        "content": "<p>Hi, when I validate my Profile with the FHIR Validator (<a href=\"https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\" target=\"_blank\" title=\"https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator\">https://wiki.hl7.org/index.php?title=Using_the_FHIR_Validator</a>) I get error \"No slicing on the root element [element.first().slicing.empty()]\" Does anybody know what this means? Maybe adding an extension is forbidden for the resource type?</p>\n<p>&lt;StructureDefinition xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n  &lt;id value=\"myName\" /&gt;<br>\n  &lt;url value=\"<a href=\"https://example/fhir/StructureDefinition/MyName\" target=\"_blank\" title=\"https://example/fhir/StructureDefinition/MyName\">https://example/fhir/StructureDefinition/MyName</a>\" /&gt;<br>\n  &lt;version value=\"0.1\" /&gt;<br>\n  &lt;name value=\"MyName\" /&gt;<br>\n  &lt;title value=\"MyName\" /&gt;<br>\n  &lt;status value=\"draft\" /&gt;<br>\n  &lt;description value=\"MyName\" /&gt;<br>\n  &lt;fhirVersion value=\"3.0.1\" /&gt;<br>\n  &lt;mapping&gt;<br>\n    &lt;identity value=\"rim\" /&gt;<br>\n    &lt;uri value=\"<a href=\"http://hl7.org/v3\" target=\"_blank\" title=\"http://hl7.org/v3\">http://hl7.org/v3</a>\" /&gt;<br>\n    &lt;name value=\"RIM Mapping\" /&gt;<br>\n  &lt;/mapping&gt;<br>\n  &lt;mapping&gt;<br>\n    &lt;identity value=\"cda\" /&gt;<br>\n    &lt;uri value=\"<a href=\"http://hl7.org/v3/cda\" target=\"_blank\" title=\"http://hl7.org/v3/cda\">http://hl7.org/v3/cda</a>\" /&gt;<br>\n    &lt;name value=\"CDA (R2)\" /&gt;<br>\n  &lt;/mapping&gt;<br>\n  &lt;mapping&gt;<br>\n    &lt;identity value=\"w5\" /&gt;<br>\n    &lt;uri value=\"<a href=\"http://hl7.org/fhir/w5\" target=\"_blank\" title=\"http://hl7.org/fhir/w5\">http://hl7.org/fhir/w5</a>\" /&gt;<br>\n    &lt;name value=\"W5 Mapping\" /&gt;<br>\n  &lt;/mapping&gt;<br>\n  &lt;kind value=\"resource\" /&gt;<br>\n  &lt;abstract value=\"true\" /&gt;<br>\n  &lt;type value=\"Composition\" /&gt;<br>\n  &lt;baseDefinition value=\"<a href=\"http://hl7.org/fhir/StructureDefinition/Composition\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureDefinition/Composition\">http://hl7.org/fhir/StructureDefinition/Composition</a>\" /&gt;<br>\n  &lt;derivation value=\"constraint\" /&gt;<br>\n  &lt;differential&gt;<br>\n    &lt;element id=\"Composition.extension\"&gt;<br>\n      &lt;path value=\"Composition.extension\" /&gt;<br>\n      &lt;slicing&gt;<br>\n        &lt;discriminator&gt;<br>\n          &lt;type value=\"value\" /&gt;<br>\n          &lt;path value=\"url\" /&gt;<br>\n        &lt;/discriminator&gt;<br>\n        &lt;rules value=\"open\" /&gt;<br>\n      &lt;/slicing&gt;<br>\n    &lt;/element&gt;<br>\n...<br>\n  &lt;/differential&gt;<br>\n&lt;/StructureDefinition&gt;</p>",
        "id": 184917885,
        "sender_full_name": "Katarina",
        "timestamp": 1578325806
    },
    {
        "content": "<p>that's an error in the 3.0 definitions. The invariant as written in the spec assumes that you have the first element as \"Composition\". This was fixed in R4</p>",
        "id": 185279318,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578626865
    },
    {
        "content": "<p>In R4 the same error occurs. </p>\n<p>Also the error occurs for complex extensions:</p>\n<p>&lt;StructureDefinition xmlns=\"<a href=\"http://hl7.org/fhir\" target=\"_blank\" title=\"http://hl7.org/fhir\">http://hl7.org/fhir</a>\"&gt;<br>\n&lt;id value=\"example\"/&gt;<br>\n&lt;url value=\"https://example.de/fhir/StructureDefinition/example\"/&gt;<br>\n&lt;version value=\"0.1\"/&gt;<br>\n&lt;name value=\"example\"/&gt;<br>\n&lt;status value=\"draft\"/&gt;<br>\n&lt;fhirVersion value=\"3.0.1\"/&gt;<br>\n &lt;mapping&gt;<br>\n&lt;identity value=\"rim\"/&gt;<br>\n&lt;uri value=\"http://hl7.org/v3\"/&gt;<br>\n&lt;name value=\"RIM Mapping\"/&gt;<br>\n&lt;/mapping&gt;<br>\n&lt;kind value=\"complex-type\"/&gt;<br>\n&lt;abstract value=\"false\"/&gt;<br>\n&lt;contextType value=\"resource\"/&gt;<br>\n&lt;context value=\"Composition.subject\"/&gt;<br>\n&lt;type value=\"Extension\"/&gt;<br>\n&lt;baseDefinition value=\"http://hl7.org/fhir/StructureDefinition/Extension\"/&gt;<br>\n&lt;derivation value=\"constraint\"/&gt;<br>\n &lt;differential&gt;<br>\n &lt;element id=\"Extension.extension\"&gt;<br>\n&lt;path value=\"Extension.extension\"/&gt;<br>\n &lt;slicing&gt;<br>\n &lt;discriminator&gt;<br>\n&lt;type value=\"value\"/&gt;<br>\n&lt;path value=\"url\"/&gt;<br>\n&lt;/discriminator&gt;<br>\n&lt;rules value=\"open\"/&gt;<br>\n&lt;/slicing&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:group\"&gt;<br>\n&lt;path value=\"Extension.extension\"/&gt;<br>\n&lt;sliceName value=\"group\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:group.url\"&gt;<br>\n&lt;path value=\"Extension.extension.url\"/&gt;<br>\n&lt;fixedUri value=\"group\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:group.value[x]:valueString\"&gt;<br>\n&lt;path value=\"Extension.extension.valueString\"/&gt;<br>\n&lt;sliceName value=\"valueString\"/&gt;<br>\n &lt;type&gt;<br>\n&lt;code value=\"string\"/&gt;<br>\n&lt;/type&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:facility\"&gt;<br>\n&lt;path value=\"Extension.extension\"/&gt;<br>\n&lt;sliceName value=\"facility\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:facility.url\"&gt;<br>\n&lt;path value=\"Extension.extension.url\"/&gt;<br>\n&lt;fixedUri value=\"facility\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.extension:facility.value[x]:valueReference\"&gt;<br>\n&lt;path value=\"Extension.extension.value[x]\"/&gt;<br>\n&lt;sliceName value=\"valueReference\"/&gt;<br>\n &lt;type&gt;<br>\n&lt;code value=\"Reference\"/&gt;<br>\n&lt;targetProfile value=\"https://example.de/fhir/StructureDefinition/example123\"/&gt;<br>\n&lt;/type&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.url\"&gt;<br>\n&lt;path value=\"Extension.url\"/&gt;<br>\n&lt;fixedUri value=\"https://example.de/fhir/StructureDefinition/example\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Extension.value[x]\"&gt;<br>\n&lt;path value=\"Extension.value[x]\"/&gt;<br>\n&lt;max value=\"0\"/&gt;<br>\n&lt;/element&gt;<br>\n&lt;/differential&gt;<br>\n&lt;/StructureDefinition&gt;</p>\n<p>Maybe it has to do with vonk? I use Vonk.Server/3.1.1.</p>",
        "id": 185916505,
        "sender_full_name": "Katarina",
        "timestamp": 1579268625
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191757\">@Christiaan Knaap</span></p>",
        "id": 185950385,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579290795
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"221154\">@Katarina</span> : If I validate the first SD ('MyName') against R4 on Vonk, it succeeds:<br>\n<code>POST https://vonk.fire.ly/R4/$validate</code><br>\nIf you validate it against R3 it indeed fails on sdf-20 because that was incorrect in the R3 spec.<br>\nThe second ('example') is not valid in R4 because of the &lt;contextType&gt; and &lt;context&gt; elements.</p>",
        "id": 186080789,
        "sender_full_name": "Christiaan Knaap",
        "timestamp": 1579507541
    },
    {
        "content": "<p>thank you.</p>",
        "id": 186084971,
        "sender_full_name": "Katarina",
        "timestamp": 1579512132
    },
    {
        "content": "<p>How is rule sdf-20 defined in R4? I looked into the specs, both STU3 (<a href=\"https://www.nuget.org/packages/Hl7.Fhir.Specification.STU3/1.5.0-beta1\" target=\"_blank\" title=\"https://www.nuget.org/packages/Hl7.Fhir.Specification.STU3/1.5.0-beta1\">https://www.nuget.org/packages/Hl7.Fhir.Specification.STU3/1.5.0-beta1</a>) and R4 (<a href=\"https://www.nuget.org/packages/Hl7.Fhir.Specification.R4/1.5.0-beta1\" target=\"_blank\" title=\"https://www.nuget.org/packages/Hl7.Fhir.Specification.R4/1.5.0-beta1\">https://www.nuget.org/packages/Hl7.Fhir.Specification.R4/1.5.0-beta1</a>) contain expression \"element.where(path.contains('.').not()).slicing.empty()\". Or where can I find the new definition?</p>",
        "id": 186112582,
        "sender_full_name": "Katarina",
        "timestamp": 1579535235
    },
    {
        "content": "<p>those packages are not official HL7 packages and should not be used (they should never have been defined)</p>",
        "id": 186129316,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579550311
    },
    {
        "content": "<p>That's what it is currently used by Vonk in STU3: <a href=\"https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-stu3/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml\" target=\"_blank\" title=\"https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-stu3/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml\">https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-stu3/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml</a></p>",
        "id": 186130437,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1579551541
    },
    {
        "content": "<p>Compared to <a href=\"https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-r4/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml\" target=\"_blank\" title=\"https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-r4/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml\">https://raw.githubusercontent.com/FirelyTeam/fhir-net-api/develop-r4/src/Hl7.Fhir.Core/Model/Source/profiles-resources.xml</a></p>",
        "id": 186130504,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1579551624
    },
    {
        "content": "<p>If you validate on Simplifier against the the hl7.fhir.r3.core package, you can see that it's already fixed in STU3 3.0.2: <a href=\"https://simplifier.net/packages/hl7.fhir.r3.core/3.0.2/files/61200/~json\" target=\"_blank\" title=\"https://simplifier.net/packages/hl7.fhir.r3.core/3.0.2/files/61200/~json\">https://simplifier.net/packages/hl7.fhir.r3.core/3.0.2/files/61200/~json</a></p>",
        "id": 186130641,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1579551792
    },
    {
        "content": "<p>Vonk is currently using the .NET API version 1.4.0 (based on STU3 3.0.1 and R4 4.0.0), as soon as the 1.5.0 (based on FHIR STU3 3.0.2 / R4 4.0.1) becomes stable Vonk will upgrade as well.</p>",
        "id": 186130767,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1579551905
    },
    {
        "content": "<p>So everything should be aligned soon :)</p>",
        "id": 186130782,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1579551925
    }
]