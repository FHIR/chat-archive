[
    {
        "content": "<p>Hi,<br>\nI've been trying to find out why I'm getting a validation error when validating the following resource:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl -X POST \\\n  &#39;http://hapi.fhir.org/baseDstu3/Patient/$validate&#39; \\\n  -H &#39;Cache-Control: no-cache&#39; \\\n  -H &#39;Content-Type: application/json&#39; \\\n  -d &#39;{\n    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;\n        ]\n    },\n    &quot;address&quot;: [\n        {\n            &quot;_use&quot;: {\n                &quot;extension&quot;: [\n                    {\n                        &quot;url&quot;: &quot;http://hl7.org/fhir/StructureDefinition/iso21090-AD-use&quot;,\n                        &quot;valueCode&quot;: &quot;PHYS&quot;\n                    }\n                ]\n            }\n        }\n    ]\n}&#39;\n</code></pre></div>\n\n\n<p>It produces the error:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;The extension http://hl7.org/fhir/StructureDefinition/iso21090-AD-use is not allowed to be used at this point (allowed = e:Address; this element is [[Patient.address.use, Address.use, code])&quot;,\n            &quot;location&quot;: [\n                &quot;Patient.address[0].use&quot;,\n                &quot;Line 11, Col 31&quot;\n            ]\n}\n</code></pre></div>\n\n\n<p>The profile that is used can be found here: <a href=\"https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview\">https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview</a><br>\nAs far as I can tell, the extension should be applied to <strong>address.use</strong>. What am I missing here?</p>",
        "id": 197167786,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589213203
    },
    {
        "content": "<p>Looking at the source for that extension: <a href=\"http://hl7.org/fhir/extension-iso21090-ad-use.json.html\">http://hl7.org/fhir/extension-iso21090-ad-use.json.html</a></p>\n<p>It looks like the context is just <code>\"address\"</code>, not <code>\"address.use\"</code>. So presumably you need to move it up one level.</p>",
        "id": 197186803,
        "sender_full_name": "James Agnew",
        "timestamp": 1589222372
    },
    {
        "content": "<ul>\n<li>Plus 5 bonus points for providing a short, complete, executable example with your question, and for stating your expectations vs observed behavior :)</li>\n</ul>",
        "id": 197209019,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1589233823
    },
    {
        "content": "<p>Thanks guys! I'll try moving it to the address element instead. <br>\nDoes this mean that they documented it wrongly at <a href=\"https://simplifier.net/NictizSTU3-Zib2017/nl-core-address\">https://simplifier.net/NictizSTU3-Zib2017/nl-core-address</a> ? When you look at the field list there, the extension is shown within the extensions of the \"use\" field.</p>",
        "id": 197237633,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589264843
    },
    {
        "content": "<p>I'm not sure why this is so confusing to me, but i'm running into a similar issue while trying to validate an extension on address.country:</p>\n<div class=\"codehilite\"><pre><span></span><code>curl -X POST \\\n  &#39;http://hapi.fhir.org/baseDstu3/Patient/$validate&#39; \\\n  -H &#39;Cache-Control: no-cache&#39; \\\n  -H &#39;Content-Type: application/json&#39; \\\n  -d &#39;{\n    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;meta&quot;: {\n        &quot;profile&quot;: [\n            &quot;http://fhir.nl/fhir/StructureDefinition/nl-core-patient&quot;\n        ]\n    },\n    &quot;address&quot;: [\n        {\n            &quot;_country&quot;: {\n                &quot;extension&quot;: [\n                    {\n                        &quot;url&quot;: &quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;,\n                        &quot;valueCodeableConcept&quot;: {\n                            &quot;coding&quot;: [\n                                {\n                                    &quot;code&quot;: &quot;NL&quot;,\n                                    &quot;system&quot;: &quot;urn:iso:std:iso:3166&quot;\n                                }\n                            ]\n                        }\n                    }\n                ]\n            }\n        }\n    ]\n}&#39;\n</code></pre></div>\n\n\n<p>this produces the errors:</p>\n<div class=\"codehilite\"><pre><span></span><code> &quot;issue&quot;: [\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;The extension http://nictiz.nl/fhir/StructureDefinition/code-specification is not allowed to be used at this point (allowed = e:CodeableConcept, e:code, e:Coding; this element is [[Patient.address.country, Address.country, string])&quot;,\n            &quot;location&quot;: [\n                &quot;Patient.address[0].country&quot;,\n                &quot;Line 12, Col 31&quot;\n            ]\n        },\n        {\n            &quot;severity&quot;: &quot;error&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;Profile http://fhir.nl/fhir/StructureDefinition/nl-core-address, Element matches more than one slice - LandGBACodelijst, LandISOCodelijst&quot;,\n            &quot;location&quot;: [\n                &quot;Patient.address[0].country.extension[0]&quot;,\n                &quot;Line 13, Col 22&quot;\n            ]\n        },\n        {\n            &quot;severity&quot;: &quot;warning&quot;,\n            &quot;code&quot;: &quot;processing&quot;,\n            &quot;diagnostics&quot;: &quot;None of the codes provided are in the value set http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000 (http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000, and a code should come from this value set unless it has no suitable code) (codes = urn:iso:std:iso:3166#NL)&quot;,\n            &quot;location&quot;: [\n                &quot;Patient.address[0].country.extension[0].value.ofType(CodeableConcept)&quot;,\n                &quot;Line 16, Col 40&quot;\n            ]\n        }\n    ]\n</code></pre></div>\n\n\n<p>The profile used is this: <a href=\"https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview\">https://simplifier.net/NictizSTU3-Zib2017/nl-core-patient/~overview</a></p>\n<p>I looked at the context of the extension (<a href=\"https://simplifier.net/NictizSTU3-Zib2017/Zibextensioncodespecification/~json\">https://simplifier.net/NictizSTU3-Zib2017/Zibextensioncodespecification/~json</a>) and one of the options is \"Address.country\", which I think I am using, so I don't expect to get the first error.</p>\n<p>The second error seems to be about country having 2 extensions with the same URL in the profile. What should I do to distinguish which one I am using?</p>",
        "id": 197240419,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589267887
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191319\">@James Agnew</span>  any idea?</p>",
        "id": 197269538,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589287595
    },
    {
        "content": "<blockquote>\n<p>Does this mean that they documented it wrongly</p>\n</blockquote>\n<p>looks like it to me, yes</p>",
        "id": 197270675,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589288178
    },
    {
        "content": "<blockquote>\n<p>The extension <a href=\"http://nictiz.nl/fhir/StructureDefinition/code-specification\">http://nictiz.nl/fhir/StructureDefinition/code-specification</a> is not allowed to be used at this point (allowed = e:CodeableConcept, e:code, e:Coding; this element is [[Patient.address.country, Address.country, string])</p>\n</blockquote>\n<p>looks like a bug to me.</p>",
        "id": 197270755,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589288225
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> you mean a bug in how that HAPI server handles the validation?</p>",
        "id": 197272813,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589289156
    },
    {
        "content": "<p>a bug in the validator, yes. I've added a test case taken from your post to the validator test cases ,but I can't run the test cases right now. Working on it</p>",
        "id": 197272957,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589289218
    },
    {
        "content": "<p>ok thanks!</p>",
        "id": 197274125,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589289760
    },
    {
        "content": "<p>ok back to this. Here's quoting from the NL profile:</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"p\">{</span>\n                <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;slicing&quot;</span><span class=\"p\">:{</span>\n                    <span class=\"nt\">&quot;discriminator&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                        <span class=\"p\">{</span>\n                            <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;value&quot;</span><span class=\"p\">,</span>\n                            <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;url&quot;</span>\n                        <span class=\"p\">},</span>\n                        <span class=\"p\">{</span>\n                            <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;value&quot;</span><span class=\"p\">,</span>\n                            <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;value.coding.system&quot;</span>\n                        <span class=\"p\">}</span>\n                    <span class=\"p\">],</span>\n                    <span class=\"nt\">&quot;rules&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;open&quot;</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">}</span><span class=\"err\">,</span>\n</code></pre></div>\n\n\n<p>ok, so the extension is sliced by url and code system.</p>\n<p>then 2 slices:</p>\n<div class=\"codehilite\"><pre><span></span><code>            <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension:LandGBACodelijst&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;sliceName&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandGBACodelijst&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;short&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandGBACode&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                    <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Extension&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;profile&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">]</span>\n            <span class=\"p\">}</span><span class=\"err\">,</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension:LandGBACodelijst.valueCodeableConcept:valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension.valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;sliceName&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;binding&quot;</span><span class=\"p\">:{</span>\n                    <span class=\"nt\">&quot;strength&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;extensible&quot;</span><span class=\"p\">,</span>\n                    <span class=\"nt\">&quot;description&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandGBACodelijst&quot;</span><span class=\"p\">,</span>\n                    <span class=\"nt\">&quot;valueSetReference&quot;</span><span class=\"p\">:{</span>\n                        <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.1--20171231000000&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;display&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandGBACodelijst&quot;</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">}</span><span class=\"err\">,</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension:LandISOCodelijst&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;sliceName&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandISOCodelijst&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;short&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandISOCode&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;max&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;1&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;type&quot;</span><span class=\"p\">:</span> <span class=\"p\">[</span>\n                    <span class=\"p\">{</span>\n                        <span class=\"nt\">&quot;code&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Extension&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;profile&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">]</span>\n            <span class=\"p\">}</span><span class=\"err\">,</span>\n            <span class=\"p\">{</span>\n                <span class=\"nt\">&quot;id&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension:LandISOCodelijst.valueCodeableConcept:valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;path&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;Address.country.extension.valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;sliceName&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;valueCodeableConcept&quot;</span><span class=\"p\">,</span>\n                <span class=\"nt\">&quot;binding&quot;</span><span class=\"p\">:{</span>\n                    <span class=\"nt\">&quot;strength&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;extensible&quot;</span><span class=\"p\">,</span>\n                    <span class=\"nt\">&quot;description&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandISOCodelijst&quot;</span><span class=\"p\">,</span>\n                    <span class=\"nt\">&quot;valueSetReference&quot;</span><span class=\"p\">:{</span>\n                        <span class=\"nt\">&quot;reference&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.20.5.2--20171231000000&quot;</span><span class=\"p\">,</span>\n                        <span class=\"nt\">&quot;display&quot;</span><span class=\"p\">:</span><span class=\"s2\">&quot;LandISOCodelijst&quot;</span>\n                    <span class=\"p\">}</span>\n                <span class=\"p\">}</span>\n            <span class=\"p\">}</span>\n</code></pre></div>",
        "id": 197350736,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589324152
    },
    {
        "content": "<p>The validator doesn't know what to do with this - no value is provided for the identified fixed value element <code>value.coding.system</code>, so it can't differentiate the extension between the 2 slices.</p>",
        "id": 197350811,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589324196
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> fyi</p>",
        "id": 197350824,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589324208
    },
    {
        "content": "<p>Job reached out yesterday directly too. Didn’t know this was on zulip as well. <span class=\"user-mention\" data-user-id=\"192301\">@Ardon Toonstra</span> created a ticket and we will fix the country extension slicing. We are bitten by lots of places where we needed slicing by valueset over the years and found a wrong way how to. This is one of first we ever made in HL7 NL</p>",
        "id": 197370515,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589347967
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"294094\">@Job Schipper</span> just in case you want to test the proposed update to the profile: <a href=\"https://bits.nictiz.nl/browse/MM-1155\">https://bits.nictiz.nl/browse/MM-1155</a></p>\n<p>I've attached the update profile-to-be. FHIR IG Publisher Version 1.0.94-SNAPSHOT validates using this updated profile.</p>",
        "id": 197378661,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589356506
    },
    {
        "content": "<p>At this point it is not certain yet if it makes the May 2020 updates. Deadline officially already passed. In that case it will make the next update (September/October latest)</p>",
        "id": 197378962,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589356764
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I've been testing this a bit further. Seems we don't need the explicit patternCodeableConcept. Just the pattern slice definition will do. <br>\nHowever I'm getting unexpected feedback in qa when the extension/@url matches but the value.coding.system does not. Because of of the pattern I would have expected something on having 'element does not match any known slice', but instead I get 'code system uri is unknown'. Is my expectation wrong or does the validator need an update here?</p>\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">&lt;!-- definition --&gt;</span>\n<span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Address.country.extension&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Address.country.extension&quot;</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;slicing&gt;</span>\n    <span class=\"nt\">&lt;discriminator&gt;</span>\n      <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;value&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;url&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/discriminator&gt;</span>\n    <span class=\"nt\">&lt;discriminator&gt;</span>\n      <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;pattern&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;$this.value&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/discriminator&gt;</span>\n    <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;open&quot;</span> <span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/slicing&gt;</span>\n<span class=\"nt\">&lt;/element&gt;</span>\n</code></pre></div>\n\n\n<div class=\"codehilite\"><pre><span></span><code><span class=\"c\">&lt;!-- Undefined extension slice, the url matches, but the system does</span>\n<span class=\"c\">not match any defined value set --&gt;</span>\n<span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">&quot;http://nictiz.nl/fhir/StructureDefinition/code-specification&quot;</span><span class=\"nt\">&gt;</span>\n  <span class=\"nt\">&lt;valueCodeableConcept&gt;</span>\n    <span class=\"nt\">&lt;coding&gt;</span>\n      <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;urn:oid:2.16.840.1.113883.2.4.4.16.35&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;6030&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;display</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Nederland&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/coding&gt;</span>\n  <span class=\"nt\">&lt;/valueCodeableConcept&gt;</span>\n<span class=\"nt\">&lt;/extension&gt;</span>\n</code></pre></div>",
        "id": 197381987,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589358772
    },
    {
        "content": "<p>is the code system actually known? That would be entirely separate to the slicing</p>",
        "id": 197382389,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589359043
    },
    {
        "content": "<p>The code system as stated in the instance is unknown to the IG Publisher. My intention was to test slice recognition, but indeed flagging if a detected code system exists is a secondary issue</p>",
        "id": 197383571,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589359896
    },
    {
        "content": "<p>so then I'm not sure what the issue is</p>",
        "id": 197383598,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589359917
    },
    {
        "content": "<ul>\n<li>The instance contains a fragment that does not match any of the defined slices -- this is not flagged in qa. I'm thinking it should have been</li>\n<li>The code system urn:oid:2.16.840.1.113883.2.4.4.16.35 is unknown -- this is flagged in qa</li>\n</ul>",
        "id": 197383727,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589359980
    },
    {
        "content": "<p>If I add an extension with a different url, it is flagged as unmatched slice. This fragment matches url, but not code system. It should still produce an 'unmatched' error in my mind</p>",
        "id": 197383954,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589360115
    },
    {
        "content": "<p>well, I'll have to debug - can you send me a whole example + profile?</p>",
        "id": 197383999,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589360144
    },
    {
        "content": "<p>Sure... will take me a few moments... I'll DM you the zip</p>",
        "id": 197384071,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589360168
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  thanks for looking into this! We will try out the profile-to-be in the meantime until the change gets released.</p>",
        "id": 197529992,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589449222
    },
    {
        "content": "<p>The current profile-to-be assumes 2 code-specification extension each with its own valueset binding (ISO or GBA). Grahame made me aware that 1 code-specification extension with 1 or 2 codings would suit the situation better. The slicing required for that, currently leads to validator issues and I've asked Grahame for help to investigate. This may lead to another update in the profile-to-be. Since the expectation is that you have ISO xor GBA not both at the same time, you would not have 2 code-specification extensions anyway.</p>",
        "id": 197530409,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589449469
    },
    {
        "content": "<p>should i keep following <a href=\"https://bits.nictiz.nl/browse/MM-1155\">https://bits.nictiz.nl/browse/MM-1155</a> for these changes?</p>",
        "id": 197531374,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589450044
    },
    {
        "content": "<p>If I need to update the profile, then yes, that ticket is updated. For now we have a profile that works, so for the short term I'm putting my money on that one.</p>",
        "id": 197603445,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589483289
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> Ok we'll have a try with that one. Talking about versioning, when i reference a Nictiz profile by it's URI, it does not seem to contain a version number (i.e. \"<a href=\"http://fhir.nl/fhir/StructureDefinition/nl-core-patient\">http://fhir.nl/fhir/StructureDefinition/nl-core-patient</a>\"). Let's say  that I have some patients that were made a while ago that reference the profile nl-core-patient, and they were made back when we had version 1.3 of that profile. Now when i load the latest nl-core-patient profile on the server, all my existing patient resources now all of a sudden point to the updated version of \"nl-core-patient\", and because of this they probably are not valid anymore. Do you have a suggestion on how we could best handle this? Wouldn't it make sense to add a version number to the profile URI so that we can have older resources referencing the older version, and newer resources referencing the newer version?</p>",
        "id": 197658342,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589529568
    },
    {
        "content": "<p>I could also imagine this leading to problems when I receive a Patient resource from a 3rd party, that references \"nl-core-patient\", but I don't know what version of \"nl-core-patient\" they are using</p>",
        "id": 197658430,
        "sender_full_name": "Job Schipper",
        "timestamp": 1589529611
    },
    {
        "content": "<p>There are many discussions on versions in the canonical or not. We've settled years ago for what I think still is the consensus which <em>not</em> to have the major version in the canonical. The second part is that all data is assumed to be valid against the same package. If you persist FHIR resources as-is, this requires you to map the persisted FHIR resource against the expected FHIR resource. This is in no way different from when you would have persisted in a SQL DB</p>",
        "id": 197666230,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1589534426
    },
    {
        "content": "<p>working further on this - you cannot use extensible bindings to differentiate slices</p>",
        "id": 197866366,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589745717
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> that's why the validator wasn't behaving as expected. I'll have to review the code - there should be some kind of message, but once the code systems are defined and the bindings are required, then it all works as expected</p>",
        "id": 197866825,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1589746344
    }
]