[
    {
        "content": "<p>i would like to constrain a bundle to a specific profiled composition.  i'm not successful with my structuredefinition, the validator doesn't raise an error if i don't put the profile on the composition. does anybody know an example for STU3 how a slice for a bundle  would work? I tried it the following way:</p>\n<div class=\"codehilite\"><pre>    &lt;baseDefinition value=&quot;http://hl7.org/fhir/StructureDefinition/Bundle&quot; /&gt;\n    &lt;derivation value=&quot;constraint&quot; /&gt;\n    &lt;differential&gt;\n        &lt;element id=&quot;Bundle&quot;&gt;\n            &lt;path value=&quot;Bundle&quot; /&gt;\n            &lt;base&gt;\n                &lt;path value=&quot;Bundle&quot; /&gt;\n                &lt;min value=&quot;1&quot; /&gt;\n                &lt;max value=&quot;1&quot; /&gt;\n            &lt;/base&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.type&quot;&gt;\n            &lt;path value=&quot;Bundle.type&quot; /&gt;\n            &lt;fixedCode value=&quot;document&quot; /&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry&quot;&gt;\n            &lt;path value=&quot;Bundle.entry&quot;/&gt;\n            &lt;slicing&gt;\n                &lt;discriminator value=&quot;resource&quot;/&gt;\n                &lt;ordered value=&quot;true&quot;/&gt;\n                &lt;rules value=&quot;open&quot;/&gt;\n            &lt;/slicing&gt;\n            &lt;min value=&quot;1&quot;/&gt;\n            &lt;max value=&quot;*&quot;/&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry.resource:Composition&quot;&gt;\n            &lt;path value=&quot;Bundle.entry.resource&quot;/&gt;\n            &lt;type&gt;\n                &lt;code value=&quot;Composition&quot;/&gt;\n                &lt;profile value=&quot;http://snip&quot;/&gt;\n            &lt;/type&gt;\n        &lt;/element&gt;\n    &lt;/differential&gt;\n</pre></div>\n\n\n<p>Any hints or link to a sample highly appreciated.</p>",
        "id": 153870772,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1486589508
    },
    {
        "content": "<p>Well, you've defined slicing but haven't actually declared your slice - you need to have an additional element with path \"Bundle.entry\" with a slice name that then has the child element.  As well, your slice discriminator is just a path - which means you're slicing by fixed value, value set or existence.  I think you probably want the discriminator to be resource.@type.</p>",
        "id": 153870785,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1486597756
    },
    {
        "content": "<p>Even if you fix this, it may not work - not sure if the validator supports slicing elements of type Resource as that requires somewhat special behavior.</p>",
        "id": 153870786,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1486597790
    },
    {
        "content": "<p>Thanks for your input <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>. I adjusted it to your recommendations and have not the following:</p>\n<div class=\"codehilite\"><pre><span></span>    &lt;differential&gt;\n        &lt;element id=&quot;Bundle&quot;&gt;\n            &lt;path value=&quot;Bundle&quot; /&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.type&quot;&gt;\n            &lt;path value=&quot;Bundle.type&quot; /&gt;\n            &lt;fixedCode value=&quot;document&quot; /&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry&quot;&gt;\n            &lt;path value=&quot;Bundle.entry&quot; /&gt;\n            &lt;slicing&gt;\n                &lt;discriminator value=&quot;resource.@type&quot; /&gt;\n                &lt;ordered value=&quot;true&quot; /&gt;\n                &lt;rules value=&quot;openAtEnd&quot; /&gt;\n            &lt;/slicing&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;*&quot; /&gt;\n        &lt;/element&gt;\n        &lt;!-- first slice --&gt;\n        &lt;element id=&quot;Bundle.entry:Composition&quot;&gt;\n            &lt;path value=&quot;Bundle.entry&quot; /&gt;\n&lt;!--            &lt;sliceName value=&quot;Composition&quot; /&gt; IG Publisher does not like the slicename --&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;Bundle.entry.resource:Composition&quot;&gt;\n            &lt;path value=&quot;Bundle.entry.resource&quot; /&gt;\n&lt;!--            &lt;sliceName value=&quot;Composition&quot; /&gt; --&gt;\n            &lt;min value=&quot;1&quot; /&gt;\n            &lt;max value=&quot;1&quot; /&gt;\n            &lt;type&gt;\n                &lt;code value=&quot;Composition&quot; /&gt;\n                &lt;profile value=&quot;http://snip&quot;/&gt;\n            &lt;/type&gt;\n        &lt;/element&gt;\n</pre></div>\n\n\n<p>validating with discriminator resource.@type works. when i enter another type an error is thrown. the profile is somehow honored, but I don't think the composition is then directly validated against the profile (i can change the composition content with errors and don't get a validation error afterwards).</p>\n<p>the ig publisher does not like the xml sample file which works with the validator (Unable to find discriminator definition for Bundle.entry.resource.@type in resource.@type at Bundle.entry[1]), there seems to be a difference between validator and ig publisher which i have to find out.</p>\n<p>if i have put discriminator with resource.@profile the validator throws an error (Validating against slices with discriminators based on profiles is not yet supported by the FHIRPath engine: resource.@profile).</p>\n<p>So I think I'm on a good path, I will try to figure out whats the difference between validating from ig publisher/validator and if successful send in a patch, thanks one more time for guiding me to the right direction.</p>",
        "id": 153870926,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1486677084
    },
    {
        "content": "<p>Not sure why it's yelling about slice name on your Bundle.entry.  Don't need one on Bundle.entry.resource</p>",
        "id": 153870950,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1486688955
    }
]