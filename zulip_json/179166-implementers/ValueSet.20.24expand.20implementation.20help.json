[
    {
        "content": "<p>Hey all, I'm trying to implement the $expand operation properly. For basic value sets it's straightforward, but I ran into an example that I need your clarification/help with. I have read the latest documentation linked to in some of the other discussion topics, and it's not clarifying this issue.</p>\n<p>The standard value set for location types is <a href=\"http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType\" title=\"http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType\">http://hl7.org/fhir/ValueSet/v3-ServiceDeliveryLocationRoleType</a>.</p>\n<p>The core of that value set is the following compose block:</p>\n<div class=\"codehilite\"><pre><span></span><code>      &quot;compose&quot;: {\n          &quot;include&quot;: [\n            {\n              &quot;system&quot;: &quot;http://hl7.org/fhir/v3/RoleCode&quot;,\n              &quot;filter&quot;: [\n                {\n                  &quot;property&quot;: &quot;concept&quot;,\n                  &quot;op&quot;: &quot;is-a&quot;,\n                  &quot;value&quot;: &quot;_ServiceDeliveryLocationRoleType&quot;\n                }\n              ]\n            }\n          ],\n          &quot;exclude&quot;: [\n            {\n              &quot;system&quot;: &quot;http://hl7.org/fhir/v3/RoleCode&quot;,\n              &quot;concept&quot;: [\n                {\n                  &quot;code&quot;: &quot;_ServiceDeliveryLocationRoleType&quot;\n                }\n              ]\n            }\n          ]\n        }\n</code></pre></div>\n\n\n<p>I'm not clear on how to expand this. _ServiceDeliveryLocationRoleType contains a whole list of child concepts, many of which include their own child concepts, and so on.</p>\n<p>So if I process the include rule, and follow the is-a relationship, I would end up with an expansion that had one parent code, _ServiceDeliveryLocationRoleType, and all its descendant concepts.</p>\n<p>But then if I then run the exclude rule, wouldn't I end up with an empty expansion (because I just removed the root node of the codes I included)?</p>",
        "id": 195604241,
        "sender_full_name": "Tim Dunnington",
        "timestamp": 1588097371
    },
    {
        "content": "<p>Removing the root code wouldn't remove any of the descendants</p>",
        "id": 195604588,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588097516
    },
    {
        "content": "<p>Are you saying that the result of the expansion should be flattened?</p>",
        "id": 195604823,
        "sender_full_name": "Tim Dunnington",
        "timestamp": 1588097623
    },
    {
        "content": "<p>expansion is flattened.</p>",
        "id": 195604915,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1588097667
    },
    {
        "content": "<p>Does a flattened expansion exclude abstract codes?</p>",
        "id": 195604997,
        "sender_full_name": "Tim Dunnington",
        "timestamp": 1588097719
    },
    {
        "content": "<p>For example, the _ServiceDeliveryLocationType is abstract, and all of its descendants are also abstract codes...you have to go several layers deep to get to an actual (non-abstract) code.</p>",
        "id": 195605274,
        "sender_full_name": "Tim Dunnington",
        "timestamp": 1588097857
    },
    {
        "content": "<p>Depends on terminology server. Take a look $expand operation: <a href=\"http://build.fhir.org/valueset-operation-expand.html\" title=\"http://build.fhir.org/valueset-operation-expand.html\">http://build.fhir.org/valueset-operation-expand.html</a></p>",
        "id": 195605547,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1588098000
    },
    {
        "content": "<p>The notion of 'abstract' is for a particular use - what's abstract in one use-case (e.g. user-selection) might still be concrete for other use-cases (e.g. decision support)</p>",
        "id": 195605639,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588098030
    },
    {
        "content": "<p>So we don't want to make excluding 'abstract' codes a general rule.  Also, the notion of 'abstract' is conveyed as a property and isn't necessarily handled in a standard way across code systems.</p>",
        "id": 195605720,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588098080
    },
    {
        "content": "<p>I found the flattening idea confusing because the ValueSet specification allows for child concepts (ValueSet.expand.contains.contains), and doesn't explicitly state that the expansion should be flattened anywhere that I could find. So I couldn't tell, if the ValueSet.expand.contains itself has a contains, what that means. Does that mean sometimes you can expand and not flatten the list? And if so, when is that the case?</p>\n<p>And thank you for answering all my questions here :)</p>",
        "id": 195607342,
        "sender_full_name": "Tim Dunnington",
        "timestamp": 1588098781
    },
    {
        "content": "<p>The ability to represent hierarchy in an expansion is going to be variable.  A value set can constrain out intermediary concepts.  It may also draw from multiple code systems and the relationships needed to determine cross-system relationships might not exist</p>",
        "id": 195608544,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588099321
    },
    {
        "content": "<p><a href=\"http://tx.fhir.org\" title=\"http://tx.fhir.org\">tx.fhir.org</a> will not do a heirarchical value set when you exclude an codes - the value set is always flat in that case, whether the client asks for it to be flat or not.</p>",
        "id": 195615937,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1588103074
    },
    {
        "content": "<p>Is there any example to show how to create filters in a code system and use them in relevant valuesets?  I'm wondering how to enable expansion of an intensional valueset with a filter (op=\"in\") for ICD-10.  For example, I want to create an intensional valueset which includes ICD-10 code A00.0 and all its descendants.</p>",
        "id": 214812041,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1603877581
    },
    {
        "content": "<p>Now, I'm still confused although there are separate instructions for creation and usage of filters in CodeSystem and ValueSet, respectively.  Any comprehensive tutorial for the whole process consisting of creation and usage of filters?  Thanks in advance.</p>",
        "id": 214812454,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1603877853
    },
    {
        "content": "<p><a href=\"http://filter.codes\">filter.codes</a> such as \"concept\", \"code\" or \"parent\" don't work when the filter is used to create valuesets.  BTW, HAPI  FHIR JPA Server is used.</p>",
        "id": 214812718,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1603878016
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 214813595,
        "sender_full_name": "Lin Zhang",
        "timestamp": 1603878592
    }
]