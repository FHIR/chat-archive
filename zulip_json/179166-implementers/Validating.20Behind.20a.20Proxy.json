[
    {
        "content": "<p>I'm trying to run the FHIR Validator 5.1.17 behind a proxy server. While I can access the packages just fine (hl7.fhir.r4.core#4.0.1), I can't access the terminology server (<a href=\"http://tx.fhir.org\">http://tx.fhir.org</a>). For the packages, proxy negotiation settles on NTLM as the authentication method. However, the terminology server request doesn't provide any authentication information. Does anyone have any clue what is happening or how I can get this working?</p>\n<p>Thanks ... Charlie</p>",
        "id": 213826558,
        "sender_full_name": "Charlie Filkins",
        "timestamp": 1603132274
    },
    {
        "content": "<p>I think it is very unlikely that there is any use of NTLM in the validating process. Unless we are talking about the some kind of npm authentication?</p>",
        "id": 213829572,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1603133800
    },
    {
        "content": "<p>Yes, it is in the process of authenticating to the proxy server. I can see the headers in WireShark.</p>",
        "id": 213833140,
        "sender_full_name": "Charlie Filkins",
        "timestamp": 1603135649
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 213844752,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1603141066
    },
    {
        "content": "<p>This is command I run ...<br>\ncygdrive/c/Program\\ Files/Common\\ Files/Oracle/Java/javapath/java -Dhttp.proxyHost=proxy -Dhttp.proxyPort=9119 -jar ./validator_cli.jar -version 4.0  FullUrl.json</p>\n<p>I have confirmed that the starting text that appears in the stacktrace is from our proxy server. I also used WireShark to view the exchange and saw Proxy-authentication : NTLM ...  in the HTTP headers to get the package, but not in the call to the terminology server.</p>\n<p>And here are the results ...<br>\n FHIR Validation tool Version 5.1.17 (Git# 44f7dca1c794). Built 2020-10-14T20:04:32.293Z (4 days old)<br>\n  Java:   11.0.8 from C:\\Program Files\\Java\\jdk11 on amd64 (64bit). 2048MB available<br>\n  Paths:  Current = XXX, Package Cache = C:\\Users\\XXX\\.fhir\\packages<br>\n  Params: -version 4.0 FullUrl.json<br>\nLoading<br>\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1Installing hl7.fhir.r4.core#4.0.1 to the package cache<br>\n  Fetching:....................................................................................................<br>\n  Installing: .................................................................................................... done.<br>\nInstalling hl7.fhir.xver-extensions#0.0.4 to the package cache<br>\n  Fetching:<br>\n  Installing:  done.</p>\n<ul>\n<li>4575 resources (01:45.0217)<br>\n  Terminology server <a href=\"http://tx.fhir.orgException\">http://tx.fhir.orgException</a> in thread \"main\" org.hl7.fhir.exceptions.FHIRException: Unable to connect to terminology server. Use parameter '-tx n/a' to run without using terminology services to validate LOINC, SNOMED, ICD-X etc. Error = Error parsing response message: only whitespace content allowed before start tag and not A (position: START_DOCUMENT seen &lt;!--Title--&gt;\\nA... @2:2)<br>\n        at org.hl7.fhir.r5.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:303)<br>\n        at org.hl7.fhir.validation.ValidationEngine.connectToTSServer(ValidationEngine.java:1033)<br>\n        at org.hl7.fhir.validation.ValidationEngine.setTerminologyServer(ValidationEngine.java:407)<br>\n        at org.hl7.fhir.validation.cli.services.ValidationService.getValidator(ValidationService.java:209)<br>\n        at org.hl7.fhir.validation.Validator.main(Validator.java:190)<br>\nCaused by: org.hl7.fhir.r5.utils.client.EFhirClientException: Error parsing response message: only whitespace content allowed before start tag and not A (position: START_DOCUMENT seen &lt;!--Title--&gt;\\nA... @2:2)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:378)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:242)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:224)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:215)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.issueGetResourceRequest(ClientUtils.java:151)<br>\n        at org.hl7.fhir.r5.utils.client.FHIRToolingClient.getCapabilitiesStatementQuick(FHIRToolingClient.java:185)<br>\n        at org.hl7.fhir.convertors.txClient.TerminologyClientR5.getCapabilitiesStatementQuick(TerminologyClientR5.java:95)<br>\n        at org.hl7.fhir.r5.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:299)<br>\n        ... 4 more<br>\nCaused by: org.hl7.fhir.exceptions.FHIRFormatError: only whitespace content allowed before start tag and not A (position: START_DOCUMENT seen &lt;!--Title--&gt;\\nA... @2:2)<br>\n        at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:122)<br>\n        at org.hl7.fhir.r5.formats.ParserBase.parse(ParserBase.java:61)<br>\n        at org.hl7.fhir.r5.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:371)<br>\n        ... 11 more<br>\nCaused by: org.xmlpull.v1.XmlPullParserException: only whitespace content allowed before start tag and not A (position: START_DOCUMENT seen &lt;!--Title--&gt;\\nA... @2:2)<br>\n        at org.xmlpull.mxp1.MXParser.parseProlog(MXParser.java:1519)<br>\n        at org.xmlpull.mxp1.MXParser.nextImpl(MXParser.java:1395)<br>\n        at org.xmlpull.mxp1.MXParser.next(MXParser.java:1093)<br>\n        at org.hl7.fhir.r5.formats.XmlParserBase.next(XmlParserBase.java:232)<br>\n        at org.hl7.fhir.r5.formats.XmlParserBase.loadXml(XmlParserBase.java:222)<br>\n        at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:119)<br>\n        ... 13 more</li>\n</ul>",
        "id": 213849764,
        "sender_full_name": "Charlie Filkins",
        "timestamp": 1603143534
    },
    {
        "content": "<p>make a github issue for this. I'll have to figure out whether there's anything I can do about it</p>",
        "id": 213992833,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603237386
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I see that there is an issue open for the Validator and proxies (<a href=\"https://github.com/hapifhir/org.hl7.fhir.core/issues/204\">https://github.com/hapifhir/org.hl7.fhir.core/issues/204</a>). Should I open a more specific one regarding the terminology server?</p>",
        "id": 214082450,
        "sender_full_name": "Charlie Filkins",
        "timestamp": 1603300010
    },
    {
        "content": "<p>make a comment against that task</p>",
        "id": 214102047,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1603308435
    },
    {
        "content": "<p>Comment written.</p>",
        "id": 214114716,
        "sender_full_name": "Charlie Filkins",
        "timestamp": 1603314329
    }
]