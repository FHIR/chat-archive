[
    {
        "content": "<p>Hi,<br>\nI want to create a FHIR profile for a bundle with the following constraints:</p>\n<ul>\n<li>the bundle should contain exactly one patient resource</li>\n<li>the bundle may contain any number of encounter resources.</li>\n</ul>\n<p>I'm using Forge where I sliced on the bundle entry and created two slices for each resource type <a href=\"/user_uploads/10155/mUrS3SsIQ8uwwBuOlQ2YM5ku/image.png\">see here</a>. I'm not sure which discriminator type to use and I don't know how to specify which of the two new slices is for the patient and which one is for the encounter.</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/mUrS3SsIQ8uwwBuOlQ2YM5ku/image.png\" title=\"see here\"><img src=\"/user_uploads/10155/mUrS3SsIQ8uwwBuOlQ2YM5ku/image.png\"></a></div><p>Does anyone have any tips of how to accomplish this or maybe an example of a structure definition where a bundle was sliced this way?</p>",
        "id": 226021574,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1613062329
    },
    {
        "content": "<p>This should work</p>\n<p>&lt;differential&gt;<br>\n    &lt;element id=\"Bundle\"&gt;<br>\n      &lt;path value=\"Bundle\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Bundle.entry\"&gt;<br>\n      &lt;path value=\"Bundle.entry\" /&gt;<br>\n      &lt;slicing&gt;<br>\n        &lt;discriminator&gt;<br>\n          &lt;type value=\"type\" /&gt;<br>\n          &lt;path value=\"resource\" /&gt;<br>\n        &lt;/discriminator&gt;<br>\n        &lt;rules value=\"open\" /&gt;<br>\n      &lt;/slicing&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Bundle.entry:pat\"&gt;<br>\n      &lt;path value=\"Bundle.entry\" /&gt;<br>\n      &lt;sliceName value=\"pat\" /&gt;<br>\n      &lt;max value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Bundle.entry:pat.resource\"&gt;<br>\n      &lt;path value=\"Bundle.entry.resource\"/&gt;<br>\n      &lt;min value=\"1\"/&gt;<br>\n      &lt;type&gt;<br>\n        &lt;code value=\"Patient\"/&gt;<br>\n      &lt;/type&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Bundle.entry:per\"&gt;<br>\n      &lt;path value=\"Bundle.entry\" /&gt;<br>\n      &lt;sliceName value=\"per\" /&gt;<br>\n      &lt;min value=\"1\" /&gt;<br>\n    &lt;/element&gt;<br>\n    &lt;element id=\"Bundle.entry:per.resource\"&gt;<br>\n      &lt;path value=\"Bundle.entry.resource\"/&gt;<br>\n      &lt;min value=\"1\"/&gt;<br>\n      &lt;type&gt;<br>\n        &lt;code value=\"Person\"/&gt;<br>\n      &lt;/type&gt;<br>\n    &lt;/element&gt;<br>\n  &lt;/differential&gt;</p>",
        "id": 226098765,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1613106176
    },
    {
        "content": "<p>I will check it out, thank you!</p>",
        "id": 226124620,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1613128822
    },
    {
        "content": "<p>This is the result from my attempt. Does that look okay to you?</p>\n<p>&lt;differential&gt;<br>\n &lt;element id=\"Bundle.entry\"&gt;<br>\n&lt;path value=\"Bundle.entry\"/&gt;<br>\n &lt;slicing&gt;<br>\n &lt;discriminator&gt;<br>\n&lt;type value=\"type\"/&gt;<br>\n&lt;path value=\"resource\"/&gt;<br>\n&lt;/discriminator&gt;<br>\n&lt;rules value=\"open\"/&gt;<br>\n&lt;/slicing&gt;<br>\n&lt;min value=\"1\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Bundle.entry:patientEntry\"&gt;<br>\n&lt;path value=\"Bundle.entry\"/&gt;<br>\n&lt;sliceName value=\"patientEntry\"/&gt;<br>\n&lt;min value=\"1\"/&gt;<br>\n&lt;max value=\"1\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Bundle.entry:patientEntry.resource\"&gt;<br>\n&lt;path value=\"Bundle.entry.resource\"/&gt;<br>\n&lt;min value=\"1\"/&gt;<br>\n &lt;type&gt;<br>\n&lt;code value=\"Resource\"/&gt;<br>\n&lt;profile value=\"Patient\"/&gt;<br>\n&lt;/type&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Bundle.entry:encounterEntry\"&gt;<br>\n&lt;path value=\"Bundle.entry\"/&gt;<br>\n&lt;sliceName value=\"encounterEntry\"/&gt;<br>\n&lt;/element&gt;<br>\n &lt;element id=\"Bundle.entry:encounterEntry.resource\"&gt;<br>\n&lt;path value=\"Bundle.entry.resource\"/&gt;<br>\n &lt;type&gt;<br>\n&lt;code value=\"Resource\"/&gt;<br>\n&lt;profile value=\"Encounter\"/&gt;<br>\n&lt;/type&gt;<br>\n&lt;/element&gt;<br>\n&lt;/differential&gt;</p>",
        "id": 226140613,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1613138930
    },
    {
        "content": "<p>Looks OK to me.<br>\nIf you want to prohibit entries that are neither Patient nor Encounter, make the slicing closed.</p>\n<div class=\"codehilite\"><pre><span></span><code>        &lt;slicing&gt;\n            &lt;discriminator&gt;\n                &lt;type value=&quot;type&quot;/&gt;\n                &lt;path value=&quot;resource&quot;/&gt;\n            &lt;/discriminator&gt;\n            &lt;rules value=&quot;closed&quot;/&gt;\n        &lt;/slicing&gt;```\n</code></pre></div>",
        "id": 226330566,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1613343608
    },
    {
        "content": "<p>If slicing is open, the encounterEncounter slice constrains nothing. If you want to allow Patient, Encounter and anything else, you do not need the Encounter slice, though you might want it as documentation for humans to show you are interested in encounters.</p>",
        "id": 226330787,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1613343869
    },
    {
        "content": "<p>On reflection, I think that </p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;type&gt;\n    &lt;code value=&quot;Resource&quot;/&gt;\n    &lt;profile value=&quot;Encounter&quot;/&gt;\n&lt;/type&gt;\n</code></pre></div>\n<p>should be</p>\n<div class=\"codehilite\"><pre><span></span><code>&lt;type&gt;\n    &lt;code value=&quot;Encounter&quot;/&gt;\n&lt;/type&gt;\n</code></pre></div>\n<p>As Encounter is a valid type.</p>",
        "id": 226331226,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1613344515
    },
    {
        "content": "<p>I actually want to prohibit any other resources, thank you for the tip about the closed slicing.</p>\n<p>About the type definition, I didn't know how to create this</p>\n<div class=\"codehilite\"><pre><span></span><code> &lt;type&gt;\n      &lt;code value=&quot;Encounter&quot;/&gt;\n &lt;/type&gt;\n</code></pre></div>\n<p>in Forge. I tried to set it in the Element properties of the resource (see <a href=\"/user_uploads/10155/nqU409IvuFYjLdRTHJPcMWJ3/image.png\">image.png</a> ), but the result is</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/nqU409IvuFYjLdRTHJPcMWJ3/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/nqU409IvuFYjLdRTHJPcMWJ3/image.png\"></a></div><div class=\"codehilite\"><pre><span></span><code>&lt;type&gt;\n   &lt;code value=&quot;Resource&quot;/&gt;\n   &lt;profile value=&quot;Encounter&quot;/&gt;\n&lt;/type&gt;\n</code></pre></div>\n<p>Any tips for how to do this in Forge?</p>",
        "id": 226383220,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1613395484
    },
    {
        "content": "<p>If Forge does it that way it should work just fine.</p>",
        "id": 226458955,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1613435466
    },
    {
        "content": "<p>Although it doesn't seem intuitive, you can specify the resource type by defining a \"profile\" on resource. Since all other core resources are technically profiles on resource. In the screenshot attached you can see how to define that you can only use \"Patient\" in this slice. You can add other canonical URLs to define other options, which can be core resources or local profiles.<br>\nThis would result in the following:</p>\n<div class=\"codehilite\"><pre><span></span><code> &lt;type&gt;\n       &lt;code value=&quot;Resource&quot;/&gt;\n       &lt;profile value=&quot;http://hl7.org/fhir/StructureDefinition/Patient&quot;/&gt;\n&lt;/type&gt;\n</code></pre></div>\n<p><a href=\"/user_uploads/10155/MmmFEMXhphP1KXpW7QkVnzch/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/MmmFEMXhphP1KXpW7QkVnzch/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/MmmFEMXhphP1KXpW7QkVnzch/image.png\"></a></div>",
        "id": 226511298,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1613481416
    },
    {
        "content": "<p>Thank you very much, it was the canonical URL that I was missing!</p>",
        "id": 226541499,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1613494597
    },
    {
        "content": "<p>I have now created my own profiles for the different entries as well (Patient, Encounter, etc). But when I link them in the Bundle via the URL I get the following error: <a href=\"/user_uploads/10155/OGfwOKL2URfBrANt8VcrwXvl/image.png\">image.png</a> .<br>\nDo you have any idea where this problem might originate from?</p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/OGfwOKL2URfBrANt8VcrwXvl/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/OGfwOKL2URfBrANt8VcrwXvl/image.png\"></a></div>",
        "id": 227399093,
        "sender_full_name": "Johanna Eicher",
        "timestamp": 1614070629
    }
]