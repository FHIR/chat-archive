[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> on a scale of 1 to 10 (1 == it's fine, 10 == it's the worst), how much do you dislike the following use of <code>contained</code>? Would you prefer to stick this kind of content in... <code>valueAttachment.data</code> with some kind of FHIR JSON content b64 encoded? Or in a single contained Bundle? And if so, how would you enable links among the resources inside?</p>\n<p>Goals here:</p>\n<p>1) provide a clear place to put data that a Task relies on, even before the \"receiving\" system has committed to storing/incorporating them at any persistent location --  which is why we've got this Task in the first place,<br>\n2) provide a way to explicitly call out certain resources like Observations as directly needed by the Task, and others like Device as ...  playing a supporting role,<br>\n3) provide a way to link between the Task and the supplied resources, and between supplied resources like Observation -&gt; Device</p>\n<h3>Example payload to POST /Task</h3>\n<div class=\"codehilite\" data-code-language=\"JavaScript\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"s2\">\"resourceType\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Task\"</span><span class=\"p\">,</span>\n  <span class=\"s2\">\"status\"</span><span class=\"o\">:</span> <span class=\"s2\">\"requested\"</span><span class=\"p\">,</span>\n  <span class=\"s2\">\"intent\"</span><span class=\"o\">:</span> <span class=\"s2\">\"order\"</span><span class=\"p\">,</span> <span class=\"c1\">// App is requesting the incorporation of the data</span>\n  <span class=\"s2\">\"basedOn\"</span><span class=\"o\">:</span> <span class=\"p\">{</span> <span class=\"c1\">// Optional \"data request\"; when known, this can help EHR process quickly/correctly</span>\n    <span class=\"s2\">\"reference\"</span><span class=\"o\">:</span> <span class=\"s2\">\"ServiceRequest/123\"</span>\n  <span class=\"p\">},</span>\n  <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"p\">{</span><span class=\"s2\">\"coding\"</span><span class=\"o\">:</span> <span class=\"p\">[{</span><span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"incorporate-external-data\"</span><span class=\"p\">}]},</span>\n  <span class=\"s2\">\"input\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"type\"</span><span class=\"o\">:</span> <span class=\"p\">{</span> <span class=\"s2\">\"coding\"</span><span class=\"o\">:</span> <span class=\"p\">[{</span> <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"data-to-incorporate\"</span><span class=\"p\">}]},</span>\n      <span class=\"s2\">\"valueReference\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"reference\"</span><span class=\"o\">:</span> <span class=\"s2\">\"#obs1\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"type\"</span><span class=\"o\">:</span> <span class=\"p\">{</span><span class=\"s2\">\"coding\"</span><span class=\"o\">:</span> <span class=\"p\">[{</span> <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"data-to-incorporate\"</span><span class=\"p\">}]},</span>\n      <span class=\"s2\">\"valueReference\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"reference\"</span><span class=\"o\">:</span> <span class=\"s2\">\"#obs2\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">],</span>\n  <span class=\"s2\">\"contained\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"resourceType\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Observation\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"id\"</span><span class=\"o\">:</span> <span class=\"s2\">\"obs1\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"effectiveDateTime\"</span><span class=\"o\">:</span> <span class=\"s2\">\"2021-06-02T10:14:51Z\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"coding\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"s2\">\"system\"</span><span class=\"o\">:</span> <span class=\"s2\">\"http://loinc.org\"</span><span class=\"p\">,</span>\n            <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"29463-7\"</span><span class=\"p\">,</span>\n            <span class=\"s2\">\"display\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Body Weight\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"valueQuantity\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"mf\">68.4</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"unit\"</span><span class=\"o\">:</span> <span class=\"s2\">\"kg\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"system\"</span><span class=\"o\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"kg\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"device\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"reference\"</span><span class=\"o\">:</span> <span class=\"s2\">\"#dev\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span>\n      <span class=\"s2\">\"resourceType\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Observation\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"id\"</span><span class=\"o\">:</span> <span class=\"s2\">\"obs2\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"effectiveDateTime\"</span><span class=\"o\">:</span> <span class=\"s2\">\"2021-06-02T18:25:10Z\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"coding\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n          <span class=\"p\">{</span>\n            <span class=\"s2\">\"system\"</span><span class=\"o\">:</span> <span class=\"s2\">\"http://loinc.org\"</span><span class=\"p\">,</span>\n            <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"29463-7\"</span><span class=\"p\">,</span>\n            <span class=\"s2\">\"display\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Body Weight\"</span>\n          <span class=\"p\">}</span>\n        <span class=\"p\">]</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"valueQuantity\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"mf\">68.4</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"unit\"</span><span class=\"o\">:</span> <span class=\"s2\">\"kg\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"system\"</span><span class=\"o\">:</span> <span class=\"s2\">\"http://unitsofmeasure.org\"</span><span class=\"p\">,</span>\n        <span class=\"s2\">\"code\"</span><span class=\"o\">:</span> <span class=\"s2\">\"kg\"</span>\n      <span class=\"p\">},</span>\n      <span class=\"s2\">\"device\"</span><span class=\"o\">:</span> <span class=\"p\">{</span>\n        <span class=\"s2\">\"reference\"</span><span class=\"o\">:</span> <span class=\"s2\">\"#dev\"</span>\n      <span class=\"p\">}</span>\n    <span class=\"p\">},</span>\n    <span class=\"p\">{</span> <span class=\"c1\">// This is for context only; the EHR may use it or not, and still consider the request fulfilled</span>\n      <span class=\"s2\">\"resourceType\"</span><span class=\"o\">:</span> <span class=\"s2\">\"Device\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"id\"</span><span class=\"o\">:</span> <span class=\"s2\">\"dev\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"identifier\"</span><span class=\"o\">:</span> <span class=\"p\">[</span>\n        <span class=\"p\">{</span>\n          <span class=\"s2\">\"system\"</span><span class=\"o\">:</span> <span class=\"s2\">\"http://wittech.net\"</span><span class=\"p\">,</span>\n          <span class=\"s2\">\"value\"</span><span class=\"o\">:</span> <span class=\"s2\">\"S200/123-xxx-456\"</span>\n        <span class=\"p\">}</span>\n      <span class=\"p\">],</span>\n      <span class=\"s2\">\"displayName\"</span><span class=\"o\">:</span> <span class=\"s2\">\"WiTscale S200 Bluetooth Smart Digital Bathroom Scale\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"manufacturer\"</span><span class=\"o\">:</span> <span class=\"s2\">\"WiT\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"modelNumber\"</span><span class=\"o\">:</span> <span class=\"s2\">\"S200\"</span><span class=\"p\">,</span>\n      <span class=\"s2\">\"serialNumber\"</span><span class=\"o\">:</span> <span class=\"s2\">\"123-xxx-456\"</span>\n    <span class=\"p\">}</span>\n  <span class=\"p\">]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 244199554,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624911771
    },
    {
        "content": "<p>From discussion on FHIR-I, using <code>contained</code> here gets an OK score from Lloyd (say 1-3 -- \"totally comfortable\")</p>",
        "id": 244204162,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624914141
    },
    {
        "content": "<p>One thing that still favors a dedicated <code>$incorporate</code> operation, over <code>POST /Task</code>: if the EHR wants to immediately accept (or reject) the request, the using Operations, the EHR can return a Task to the client as the operation's return value, without having to <em>persist</em> a Task resource anywhere. But using <code>POST /Task</code> kind of requires (I think!) the EHR to persist the Task. Is that right?</p>",
        "id": 244205227,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624914724
    },
    {
        "content": "<p>A POST of a Task could result in a response where the Task already had a completed status and an output, but yes, it'd be stored on the endpoint.  (How long the endpoint retains completed Tasks and who it allows to see Tasks created by someone else might vary.)  From an EHR perspective, presumably they do persist - at least for audit purposes - the fact that a request for write came in and what was done with it, whether processed synchronously or asynchronously.  So, at least in theory, there should be a persisted structure that could be used to satisfy the endpoint on read.</p>",
        "id": 244211702,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624918705
    },
    {
        "content": "<p>EHR data persistence requirements don't necessarily mean \"stuff we want to expose on a FHIR endpoint long-term\" though. Anyway, I don't think this is a show-stopping concern; just trying to evaluate pros and cons at this stage.</p>",
        "id": 244213607,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624920027
    },
    {
        "content": "<p>BTW <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> in the example above you encouraged me to use <code>Task.intent</code> of <code>order</code>  but the <a href=\"http://build.fhir.org/valueset-task-intent.html\">definition </a> doesn't apply:</p>\n<blockquote>\n<p>The request represents a request/demand and authorization for action by a Practitioner.</p>\n</blockquote>\n<p>Does this definition need to be updated, or is <code>request</code> a bitter fit for intent? (To be clear, I'd rather leave off intent altogether; I don't think marking it required is helping here.)</p>",
        "id": 244214310,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624920517
    },
    {
        "content": "<p>Can you submit a change request?  The intent is absolutely that order can be initiated by someone other than a Practitioner.  The key thing is that it's initiated by someone who has the authority to ask for it directly - as opposed to needing some subsequent step to ask for the action to occur.</p>",
        "id": 244216888,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624922563
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-32987\">FHIR-32987</a></p>",
        "id": 244222114,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624928375
    },
    {
        "content": "<p>For US Core We got beat up for this for 2 years a year by pharmacy over intent = \"order\" with this as a resolution</p>\n<blockquote>\n<p>SHALL include all prescribed and “self-prescribed” MedicationRequest resources with an intent = “plan” representing reported medications </p>\n</blockquote>\n<p>based on that  insanity the intent is going to be 'plan'  to avoid endless discussion</p>",
        "id": 244224541,
        "sender_full_name": "Eric Haas",
        "timestamp": 1624931216
    },
    {
        "content": "<p>Fine by me. Or <code>unknown</code>. The field isn't relevant for this use case, so I'm not sure why it's required.</p>",
        "id": 244225747,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1624932775
    },
    {
        "content": "<p>Plan is definitely wrong.</p>",
        "id": 244231512,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624939651
    },
    {
        "content": "<p>Plan is \"it'd be nice if this happened, but I'm not asking for anything to happen, and it's not appropriate for any action to happen yet\"</p>",
        "id": 244231519,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624939675
    },
    {
        "content": "<p>It's the equivalent of sticking something in a care plan.  It's expected/hoped to happen at some point in the future, but it's not supposed to happen 'now' and there's no actual 'request' for it to happen.</p>",
        "id": 244231570,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624939717
    },
    {
        "content": "<p>'order' is \"I have the authority to ask for this, and I'm asking for it right now\".</p>",
        "id": 244231583,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624939739
    },
    {
        "content": "<p>And the latter is definitely what's happening here.  The person requesting doesn't get to decide what happens with the request, but they definitely have authority to ask :)</p>",
        "id": 244231608,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624939772
    },
    {
        "content": "<p>Self-reported meds as a 'planned' MedicationRequest is fine because in that case, there's no request for action from the patient.  (It's a kludge because those should actually be MedicationUsage as they're not really 'requests' at all and you should be using two resources, but it's an accepted/workable kludge.)</p>",
        "id": 244231984,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624940289
    }
]