[
    {
        "content": "<p>In <a href=\"https://jira.hl7.org/browse/FHIR-34291\">jira</a> there is the following line:</p>\n<p>\"We will define two new launch contexts for SMART on FHIR that must be supported by DTR - current order and current QuestionnaireResponse.\"</p>\n<p>I'm a bit confused on how DTR is supposed to decide whether to include or exclude these launch contexts?  If you're trying to relaunch a previous session, how is DTR supposed to know that and ask for the launch/response scope?  At the point where DTR will be asking for scopes, it has no information beyond the fhir server's endpoint and, if included, a launch id.  During a standalone launch, DTR could ask for the launch/response scope, but when launching standalone the EHR won't have anything \"in context\" to return, given the nature of launching standalone.</p>",
        "id": 275411808,
        "sender_full_name": "Keeyan Ghoreshi",
        "timestamp": 1647367146
    },
    {
        "content": "<p>It depends what you're looking at in the EHR.  If you're currently looking at an order and launch DTR, you'd pass in the currentOrder context.  If you're currently looking at a QuestionnaireResponse, you'd pass in the current QR.  If you're not looking at either, you'd only pass in the patient context.  If you're not even looking at a patient, DTR launch should error out.</p>",
        "id": 275414546,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647368222
    },
    {
        "content": "<p>Right, but theoretically DTR should be including one or both of these new launch contexts in its request to the EHR.  Unless I'm misunderstanding  what \"launch context\" means, when DTR sends a request for an auth code, it tacks on a <code>launch/response</code> to the scopes to tell the EHR to send the QuestionnaireResponse in context.  But DTR isn't \"smart\" enough to make this decision.  </p>\n<p>The DTR app doesn't know whether it wants a QuestionnaireResponse or not, but it's the one that's supposed to make use of the <code>launch/response</code> scope. </p>\n<p>As an example workflow, I'm in the EHR looking at a QuestionnaireResponse.  I launch DTR and it opens the launch page with the iss and launch parameters.  At this point, DTR needs to ask the EHR for an auth code, and it's here that it would put together the scopes it's going to ask for.  How is DTR meant to decide whether to include <code>launch/response</code>, <code>launch/order</code>, both, or neither? </p>\n<p>According to <a href=\"https://build.fhir.org/ig/HL7/smart-app-launch/scopes-and-launch-context.html#apps-that-launch-from-the-ehr\">the SMART IG</a>, the app doesn't need to include these contexts when launching in the EHR (or rather, they're just hints to the EHR).  Though that still doesn't solve whether DTR should always be including both these scopes, or omitting them sometimes.</p>",
        "id": 275429019,
        "sender_full_name": "Keeyan Ghoreshi",
        "timestamp": 1647375110
    },
    {
        "content": "<p>When you launch DTR <em>from</em> the EHR, you pass in a launch context.  These new contexts (one or the other) would appear alongside the patient context typically used.  DTR doesn't ask for anything in terms of launch context.  If no order or QR is provided on launch, then the app will need to guide the user through the process of selecting one.</p>",
        "id": 275432724,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647377049
    },
    {
        "content": "<p>The 'scope' solicited by DTR is typically the whole patient record, though in some cases the app might know it needs less and thus ask for less.</p>",
        "id": 275432779,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647377092
    },
    {
        "content": "<p>Ok, I think I may be confusing some terminology then.  From my perspective, patient context is explicitly requested by DTR through inclusion of <code>launch/patient</code> in  the scope.  It is included on request for an authentication code, along with other contexts like <code>launch</code> or <code>launch/encounter</code>.  To me, \"context\" refers to these values which are included in the scope.</p>\n<p>For these new contexts, <code>launch/response</code> and <code>/launch/order</code>, it sounds more like a modification of the appContext bundle, with two extra fields the EHR may or may not fill out.</p>",
        "id": 275472487,
        "sender_full_name": "Keeyan Ghoreshi",
        "timestamp": 1647413200
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196310\">@Keeyan Ghoreshi</span> </p>\n<p>After some more research, I understand exactly what you're saying.  Also, the newest SMART Launch Framework spec provides some guidance and expectations that we didn't take into account when writing up the spec.  So some changes are definitely in order.</p>\n<p>My take is that we <em>are</em> wanting to use launch contexts - and you're correct that those do come back as part of the OAuth process.  However, we <em>don't</em> want to make our requests as typical 'fhir' context requests, as that would cause the EHR to prompt the user to select something, and furthermore would prompt the user to satisfy all contexts - whereas we want one or the other and we don't want the EHR to prompt for either because DTR can do a smarter job of filtering candidate request resources and QuestionnaireResponses than a generic EHR-driven search.</p>\n<p>I've created a place-holder <a href=\"https://jira.hl7.org/browse/FHIR-36331\">tracker item</a> for DTR and have <a href=\"#narrow/stream/179170-smart/topic/'Optional'.20launch.20parameters\">started a discussion</a> on the <a class=\"stream\" data-stream-id=\"179170\" href=\"/#narrow/stream/179170-smart\">#smart</a> stream.  Once the most appropriate approach is landed, we can create a tracker for CRD too.</p>",
        "id": 275597400,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1647479873
    }
]