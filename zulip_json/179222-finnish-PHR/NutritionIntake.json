[
    {
        "content": "<p>Hi,<br>\nI tried to add the StructureDefinition for the NutritionIntake, and it seemed to succeed. See <a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04</a>. How can I now add NutritionIntake entries to Kanta PHR?<br>\nI tried adding this Observation</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;Observation&quot;,\n  &quot;meta&quot;: {\n    &quot;profile&quot;: &quot;http://phr.kanta.fi/StructureDefinition/fiphr-sd-nutritionintake-stu3&quot;\n  },\n  &quot;identifier&quot;: [\n    {\n      &quot;system&quot;: &quot;urn:ietf:rfc:3986&quot;,\n      &quot;value&quot;: &quot;b149307e-0ef7-4f8b-95e0-4d63e370e3d4&quot;\n    }\n  ],\n  &quot;status&quot;: &quot;final&quot;,\n  &quot;category&quot;: [{\n    &quot;coding&quot;: [{\n      &quot;system&quot;: &quot;http://phr.kanta.fi/CodeSystem/fiphr-cs-observationcategory&quot;,\n      &quot;code&quot;: &quot;nutrition&quot;,\n      &quot;display&quot;: &quot;Ravintosisältö&quot;\n    }]\n  }],\n  &quot;code&quot;: {\n    &quot;coding&quot;: [\n      {\n        &quot;system&quot;: &quot;http://loinc.org&quot;,\n        &quot;code&quot;: &quot;9059-7&quot;,\n        &quot;display&quot;: &quot;Carbohydrate intake Estimated_fi&quot;\n      }\n    ],\n    &quot;text&quot;: &quot;Arvioitu hiilihydraattimäärä&quot;\n  },\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/812adecb-5358-413d-84cd-5eb8132f40a2&quot;\n  },\n  &quot;effectiveDateTime&quot;: &quot;2018-11-26T09:35:55&quot;,\n  &quot;performer&quot;: [{\n    &quot;reference&quot;: &quot;Patient/812adecb-5358-413d-84cd-5eb8132f40a2&quot;\n  }],\n  &quot;valueQuantity&quot;: {\n    &quot;value&quot;: 35,\n    &quot;unit&quot;: &quot;g&quot;,\n    &quot;system&quot;: &quot;http://unitsofmeasure.org&quot;,\n    &quot;code&quot;: &quot;g&quot;\n  }\n}\n</pre></div>\n\n\n<p>through the GUI, but got response</p>\n<div class=\"codehilite\"><pre><span></span>{\n  &quot;resourceType&quot;: &quot;OperationOutcome&quot;,\n  &quot;issue&quot;: [\n    {\n      &quot;severity&quot;: &quot;error&quot;,\n      &quot;code&quot;: &quot;processing&quot;,\n      &quot;details&quot;: {\n        &quot;coding&quot;: [\n          {\n            &quot;system&quot;: &quot;http://phr.kanta.fi/fiphr-cs-errorcodes&quot;,\n            &quot;code&quot;: &quot;500620&quot;\n          }\n        ],\n        &quot;text&quot;: &quot;No profile found&quot;\n      },\n      &quot;diagnostics&quot;: &quot;Unexpected failure while validating resource&quot;\n    }\n  ]\n}\n</pre></div>\n\n\n<p>Can you verify whether the error is in fact related to the profile resource not being found?<br>\nShould I perhaps somehow try to add a NutritionIntake resource instead of a profiled Observation?</p>",
        "id": 154020818,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1543233759
    },
    {
        "content": "<p>The nutrition-profile was missing and I added it. You could try again - and add language field to the observation resource, because its validation causes weird error  (which has been noted).</p>",
        "id": 154020996,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1543307613
    },
    {
        "content": "<p>Thanks! I'll try again.</p>",
        "id": 154020998,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1543307648
    },
    {
        "content": "<p>Thanks for the support <span class=\"user-mention\" data-user-id=\"192813\">@Eeva Turkka</span> , I was able to create resource <a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/Observation/16a93ad1-9379-42fc-8e07-29ea64e820c3?_pretty=true\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/Observation/16a93ad1-9379-42fc-8e07-29ea64e820c3?_pretty=true\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/Observation/16a93ad1-9379-42fc-8e07-29ea64e820c3?_pretty=true</a></p>",
        "id": 154021043,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1543319483
    },
    {
        "content": "<p>If I'd now like to modify the Finnish PHR Nutrition profile (the base profile added by <span class=\"user-mention\" data-user-id=\"192813\">@Eeva Turkka</span>), what would be the appropriate process? Can I just add another StructureDefinition resource, with the same url, etc? Or is there a way for me to search the existing StructureDefinition and modify that one?  And if so, how can we communicate changes to profile documents between all implementers?</p>",
        "id": 154021305,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1543412196
    },
    {
        "content": "<p>Existing structure definitions can be found using the search parameter url. Here is an example for Nutrition base profile search: <a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-nutrition-stu3&amp;_format=json\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-nutrition-stu3&amp;_format=json\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-nutrition-stu3&amp;_format=json</a></p>\n<p>Adding another structure definition with an existing url is not possible. If you want to test a new version of existing data content, you should use a different url (for example adding a postfix after url, like fiphr-sd-nutrition-stu3_test). This way the tested data content won't be overwritten by automatic updates. Also other possible conflicts can be avoided.</p>\n<p>See also the instructions at <a href=\"http://kanta.fi\" target=\"_blank\" title=\"http://kanta.fi\">kanta.fi</a> site <a href=\"https://www.kanta.fi/en/system-developers/sandbox-environments\" target=\"_blank\" title=\"https://www.kanta.fi/en/system-developers/sandbox-environments\">https://www.kanta.fi/en/system-developers/sandbox-environments</a>.</p>\n<p>For communicating profile document changes <a href=\"http://chat.fhir.org\" target=\"_blank\" title=\"http://chat.fhir.org\">chat.fhir.org</a> and Finnish PHR PH SIG meetings are recommended.</p>",
        "id": 154022053,
        "sender_full_name": "Rita Ahde",
        "timestamp": 1543569286
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192917\">@Mikael Rinnetmäki</span> </p>\n<p>As it was agreed in the last PH SIG meeting, here is the feedback on profile <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-nutritionintake-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-nutritionintake-stu3\">https://simplifier.net/finnishphrnutritionintake/fiphr-sd-nutritionintake-stu3</a></p>\n<p>Observation.code.coding.code is now binded to fiphr-vs-nutrition, which includes also the code for FluidIntake, that is not allowed for resources that conform to this profile (FluidIntake has its own profile).</p>\n<p>Observation.valueQuantity.unit/code allows now any unit, so it is not possible to validate that the unit is correct.</p>\n<p>Please inform us when you have finalized the new version of the base profile and the NutritionIntake profile, including the components.</p>",
        "id": 154023716,
        "sender_full_name": "Rita Ahde",
        "timestamp": 1544185201
    },
    {
        "content": "<p>Thanks, will do!</p>",
        "id": 154024768,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1544619330
    },
    {
        "content": "<p>I updated the Nutrition Intake profile to include components, <a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04?_format=json&amp;_pretty=true\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04?_format=json&amp;_pretty=true\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/74189f4f-9486-4867-be0b-26034b69be04?_format=json&amp;_pretty=true</a></p>",
        "id": 154027175,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1545986423
    },
    {
        "content": "<p>It still does not enforce units, though.</p>",
        "id": 154027176,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1545986456
    },
    {
        "content": "<p>It would be nice to get the code for the base entry added into <a href=\"https://simplifier.net/finnishphr/fiphr-vs-nutrition\" target=\"_blank\" title=\"https://simplifier.net/finnishphr/fiphr-vs-nutrition\">https://simplifier.net/finnishphr/fiphr-vs-nutrition</a>. As presented in last meeting, our proposal is <em>9052-2 Calorie intake total</em>.</p>",
        "id": 154027177,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1545986587
    },
    {
        "content": "<p>Regarding unit validation, I believe it would be _possible_ to build a validator that would validate the entries based on LOINC definitions, without having to duplicate the information in various profiles. Right?</p>",
        "id": 154027179,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1545986729
    },
    {
        "content": "<p>The recent message from <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> led at least me to rethink storing the nutrition intake as components. See<br>\n<a href=\"https://chat.fhir.org/#narrow/stream/179166-implementers/subject/variable.20value.20and.20percentage.20in.20component/near/154246708\" target=\"_blank\" title=\"https://chat.fhir.org/#narrow/stream/179166-implementers/subject/variable.20value.20and.20percentage.20in.20component/near/154246708\">https://chat.fhir.org/#narrow/stream/179166-implementers/subject/variable.20value.20and.20percentage.20in.20component/near/154246708</a></p>\n<p>So what do we think? Should a meal-logging app always store each macronutrient as a separate Observation? A diabetes treatment app might only be interested in carbohydrates and care less about fat and protein intake.</p>\n<p>In addition to storing each macronutrient separately, the meal-logging app could then also store one more observation for total calorie consumption that would perhaps include a reference to each of the marconutrient observations.</p>",
        "id": 154405850,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1546605102
    },
    {
        "content": "<p>And how about when we include micronutrients? The main reason they are not included in the currently proposed profile is that there's no LOINC code for point-in-time micronutrient consumption. The other reason is that we want to start with what matters most. But if we at some time do want to include all the micronutrients too (there are a lot of them), would it be best to store them as separate observations?</p>\n<p>Are there currently known (or imagined) use cases for accessing that data?</p>",
        "id": 154405984,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1546605311
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192917\">@Mikael Rinnetmäki</span> </p>\n<p>Storing macronutrients as separate Observations does sound better for Kanta PHR, as well as storing the total calorie consumption as a separate Observation as you suggested. </p>\n<p>Although there are a lot of micronutrients, it might be good to store them as separate Observations as well, based on the same reasoning as with macronutrients. Someone might be interested for example only in vitamin C intake if one's suffering from deficiency of vitamin C. Would you think this is enough, or do we need in addition a panel Observation linking all these together (proteins, carbohydrates, fats, total calorie consumption, and also micronutrients in the future)? For example per meal?</p>\n<p>About the unit validation: It certainly would be possible to build such a validator, we'll look into this and get back to you after we've estimated the work amount and a possible timetable for implementing it.                                             </p>\n<p>So, what we need for now is something like this:                            </p>\n<p>1) a profile for Nutrition Intake that would be used for storing proteins, carbohydrated and fats. For determining the allowed codes, one option could be to use slicing as used for example in <a href=\"https://simplifier.net/finnishphr/fiphr-stepstaken-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphr/fiphr-stepstaken-stu3\">https://simplifier.net/finnishphr/fiphr-stepstaken-stu3</a> or <a href=\"https://simplifier.net/finnishphr/fiphr-bodytemperature-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphr/fiphr-bodytemperature-stu3\">https://simplifier.net/finnishphr/fiphr-bodytemperature-stu3</a>. And without the suggested validator not yet in place, the unit of the value would be fixed to 'g'. We also came to think is 'Nutrition Intake' a good name for the profile for proteins, carbohydrates and fats, or should it be renamed (for example 'Macronutrients')? What do you think?</p>\n<p>2) a profile for Total Calorie Consumption with a fixed code of 9052-2 Calorie intake total (THL will hopefully shortly verify if the code itself is okay to use here). And also here, the unit of the value fixed to 'kcal'. And with references allowed to Nutrition Intake Observations.<br>\nHow does this sound?</p>\n<p>And at some point later on, a separate(?) profile for micronutrients.</p>",
        "id": 154714086,
        "sender_full_name": "Anna Korpela",
        "timestamp": 1547029766
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192917\">@Mikael Rinnetmäki</span>  Also, could you explain in which cases you will use the 'measured' codes, and when you'll use the 'estimated' codes for Nutrition Intake Observations?</p>",
        "id": 154714500,
        "sender_full_name": "Anna Korpela",
        "timestamp": 1547030232
    },
    {
        "content": "<p>Thanks for the feedback <span class=\"user-mention\" data-user-id=\"194340\">@Anna Korpela</span>!</p>\n<p>OK, I'll roll the NutritionIntake profile back to the original proposal, with each nutrient in its own observation, no components. Regarding the codes, I agree slicing would be one option. I guess another would be to have a hierarchical value set, i.e., a ValueSet resource listing all the macronutrients, having a <code>part-of</code> relationship to the wider ValueSet for all nutrition info. Any feedback on that approach? That would feel much easier and more natural for me.</p>",
        "id": 154714829,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1547030608
    },
    {
        "content": "<p>The current view is that <code>estimated</code> would be the more widely used, and is used when a person either directly estimates the macronutrients of a meal, or estimates the portions of each meal component that are entered to a meal logging app which then calculates the macronutrient content. The <code>measured</code> codes would be used when there is no estimation involved from the person. For instance, when fully consuming a packaged meal with labelled nutrition info, or when the quantities of meals or meal components are in fact measured.</p>\n<p>So</p>\n<ul>\n<li>myself estimating carbohydrate content in a meal server to me is clearly <code>estimated</code></li>\n<li>myself estimating the components of the meal (3 medium size potatoes, 1,5 dl of sauce, ...) that I then enter to MealLogger app to get the macronutrients is still <code>estimated</code>, even if MealLogger gets the macronutrient info from a Fineli-like database that's based on measurements.</li>\n<li>myself estimating to having eaten one third of a pack of ice-cream (the packaging having full nutrient info) is still <code>estimated</code>.</li>\n<li>\n<p>myself weighing and then consuming exactly half of that pack of ice-cream and entering the info based on the labeling would be <code>\nmeasured</code>.</p>\n</li>\n<li>\n<p>myself calculating eating 10 spinach pancaces out of a package of 20 (with full announced nutrition content) and entering the nutrition info based on that would be <code>measured</code>.</p>\n</li>\n</ul>\n<p>I'd say in some cases we leave it as a selection available to the person using an app whether they consider the value estimated or calculated.<br>\nIt may get a bit tricky when I'm for instance consuming one half of a pack of spinach pancakes from brand Saarioinen, and the database used by my meal logging app only has the information for spinach pancakes from brand Atria available. Personally, I think I'd still tag that case as <code>measured</code>, but I can be easily be convinced to tag that case otherwise.</p>",
        "id": 154715974,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1547031792
    },
    {
        "content": "<p>Regarding going further and including micronutrients, I think it would certainly be feasible to enter them. We would just need the point-in-time type LOINC-codes defined for all micronutrients. I personally don't see a need for a panel for these point-in-time measurements. I do see a use case for an app iterating through point-in-time observations and deriving panel observations like <code>81941-7 Micronutrient intake panel</code> or <code>81942-5 Vitamin intake panel</code> for daily intakes, based on individual meals.</p>\n<p>For macronutrients, in my view the code <code>9052-2 Calorie intake total</code> would be suitable for the \"panel\" observation grouping the diffferent macronutrient observations of a single meal.</p>",
        "id": 154716595,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1547032462
    },
    {
        "content": "<p>For the CalorieConsumption profile, do you have any views on whether it should refer to the (Macro)NutrientIntake observations using the <code>hasMember</code> or  <code>derivedFrom</code> attribute? I can see justifications for both.</p>\n<p>If it would have the same unit, i'd use <code>hasMember</code>. However, as the unit is different, I think you could argue that the calories are calculated (hence <code>derivedFrom</code>) the macronutrient observations. Any comments, anyone?</p>",
        "id": 154717056,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1547033054
    },
    {
        "content": "<blockquote>\n<p>Thanks for the feedback <span class=\"user-mention\" data-user-id=\"194340\">@Anna Korpela</span>!</p>\n<p>OK, I'll roll the NutritionIntake profile back to the original proposal, with each nutrient in its own observation, no components. Regarding the codes, I agree slicing would be one option. I guess another would be to have a hierarchical value set, i.e., a ValueSet resource listing all the macronutrients, having a <code>part-of</code> relationship to the wider ValueSet for all nutrition info. Any feedback on that approach? That would feel much easier and more natural for me.</p>\n</blockquote>\n<p>As long as this enables the platform to validate that one of the allowed codes is used, this would probably be okay. Maybe you could give an example of this?</p>",
        "id": 154729293,
        "sender_full_name": "Anna Korpela",
        "timestamp": 1547045730
    },
    {
        "content": "<p><span class=\"emoji emoji-1f44d\" title=\"+1\">:+1:</span>  Will do.</p>",
        "id": 154918406,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1547215199
    },
    {
        "content": "<blockquote>\n<p>For the CalorieConsumption profile, do you have any views on whether it should refer to the (Macro)NutrientIntake observations using the <code>hasMember</code> or  <code>derivedFrom</code> attribute? I can see justifications for both.</p>\n<p>If it would have the same unit, i'd use <code>hasMember</code>. However, as the unit is different, I think you could argue that the calories are calculated (hence <code>derivedFrom</code>) the macronutrient observations. Any comments, anyone?</p>\n</blockquote>\n<p>We'd agree to use <code>derived-from</code> based on what you wrote here, as well as based on what R4 says about these <a href=\"http://hl7.org/fhir/observation.html#gr-other\" target=\"_blank\" title=\"http://hl7.org/fhir/observation.html#gr-other\">http://hl7.org/fhir/observation.html#gr-other</a> .</p>",
        "id": 155074884,
        "sender_full_name": "Anna Korpela",
        "timestamp": 1547461785
    },
    {
        "content": "<blockquote>\n<p>I'd say in some cases we leave it as a selection available to the person using an app whether they consider the value estimated or calculated.<br>\nIt may get a bit tricky when I'm for instance consuming one half of a pack of spinach pancakes from brand Saarioinen, and the database used by my meal logging app only has the information for spinach pancakes from brand Atria available. Personally, I think I'd still tag that case as <code>measured</code>, but I can be easily be convinced to tag that case otherwise.</p>\n</blockquote>\n<p>It depends on the product really. For example in pyttipannu the amount of sausage can be double on some brand compared to other brand -&gt; I'd say <code>estimated</code> if it's convenience food (eines). But milk is the same regardless of the brand -&gt; <code>measured</code>.</p>",
        "id": 156685590,
        "sender_full_name": "Esko Niinimäki",
        "timestamp": 1548247559
    },
    {
        "content": "<p>The updates to the Nutrition Intake have been published at <a href=\"https://simplifier.net/finnishphrnutritionintake\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake\">https://simplifier.net/finnishphrnutritionintake</a>.</p>\n<p>As proposed, the valueset is now split in two files. <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-vs-macronutrients\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-vs-macronutrients\">https://simplifier.net/finnishphrnutritionintake/fiphr-vs-macronutrients</a> includes the codes for carbohydrate, fat, and protein intake. <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-vs-nutrition\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-vs-nutrition\">https://simplifier.net/finnishphrnutritionintake/fiphr-vs-nutrition</a> imports that list and adds codes for fluid intake and calorie intake.</p>\n<p>Macronutrient intake profile <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-macronutritientintake-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-macronutritientintake-stu3\">https://simplifier.net/finnishphrnutritionintake/fiphr-sd-macronutritientintake-stu3</a> limits the use to the macronutrient codes, and the unit to grams. This allows for adding another profile for micronutrients (in milligrams) in the future.</p>\n<p>A separate profile, <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-calorieintake-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-calorieintake-stu3\">https://simplifier.net/finnishphrnutritionintake/fiphr-sd-calorieintake-stu3</a> can be used to express total calorie intake.</p>\n<p>There's also a proposed profile for adding the URLs to the images by the MealLogger app, at <a href=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-mediareference-stu3\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/fiphr-sd-mediareference-stu3\">https://simplifier.net/finnishphrnutritionintake/fiphr-sd-mediareference-stu3</a>.</p>",
        "id": 156987764,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1548622548
    },
    {
        "content": "<p>The profiles are also stored in the sandbox environment, with <code>-wellnessfoundry</code> added to URLs, in order to avoid complications with existing resources and implementations.</p>\n<p>Valuesets:<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/33751478-adfd-4cce-a53f-29ced82b64db\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/33751478-adfd-4cce-a53f-29ced82b64db\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/33751478-adfd-4cce-a53f-29ced82b64db</a> (macronutrients)<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/b2f63801-6b4f-4d3b-9e17-0780a11612d9\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/b2f63801-6b4f-4d3b-9e17-0780a11612d9\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/ValueSet/b2f63801-6b4f-4d3b-9e17-0780a11612d9</a> (nutrition)</p>\n<p>StructureDefitions:<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/696661ea-7600-4bb3-a17f-dd95d0b53386\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/696661ea-7600-4bb3-a17f-dd95d0b53386\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/696661ea-7600-4bb3-a17f-dd95d0b53386</a> (nutrition)<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/087f171c-eaf7-4511-b9a7-44a886bb2086\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/087f171c-eaf7-4511-b9a7-44a886bb2086\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/087f171c-eaf7-4511-b9a7-44a886bb2086</a> (macronutrient intake)<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/0083e392-db47-44e3-ab41-31adb41b72ef\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/0083e392-db47-44e3-ab41-31adb41b72ef\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/0083e392-db47-44e3-ab41-31adb41b72ef</a> (calorie intake)<br>\n<a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/2cbb3538-463b-43d2-a8a0-e554b2156110\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/2cbb3538-463b-43d2-a8a0-e554b2156110\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition/2cbb3538-463b-43d2-a8a0-e554b2156110</a> (media reference)</p>",
        "id": 156988928,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1548624507
    },
    {
        "content": "<p>There's also an example transaction for storing the resources based on a single meal (just the macronutrients) at <a href=\"https://simplifier.net/finnishphrnutritionintake/bundle-example\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/bundle-example\">https://simplifier.net/finnishphrnutritionintake/bundle-example</a>. For some reason the sandbox environment does not like that bundle, rather rejects it with <code>Error: HTTP 400 Bad Request: This is the base URL of FHIR server. Unable to handle this request, as it does not contain a resource type or operation name.</code>. Any idea of what's failing? <span class=\"user-mention\" data-user-id=\"192813\">@Eeva Turkka</span> are you able to check the logs?</p>\n<p>The HAPI test server at <a href=\"https://fhirtest.uhn.ca/\" target=\"_blank\" title=\"https://fhirtest.uhn.ca/\">https://fhirtest.uhn.ca/</a> processes the bundle OK (the patient id's need to be changed there).</p>",
        "id": 156989136,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1548624900
    },
    {
        "content": "<p>I'm able to check the logs, but the issue is that transactions are not currently one of the supported operations on the sandbox server. The documentation in the capability statement works a bit backwardly - transaction is not listed in the supported operations in the server interactions (see: <a href=\"https://simplifier.net/finnishphr/capabilitystatement3\" target=\"_blank\" title=\"https://simplifier.net/finnishphr/capabilitystatement3\">https://simplifier.net/finnishphr/capabilitystatement3</a> ).</p>",
        "id": 157013363,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1548668246
    },
    {
        "content": "<p>OK, thanks! And :(, too.<br>\nIs there a reason for transactions not being supported? That may yet again affect the decision on whether we want to present each nutrient as a separate observation, or as components of a single observation.</p>",
        "id": 157015812,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1548671231
    },
    {
        "content": "<p>Hi, there is no single reason: we just have had to set some restrictions where to begin, so also these kind of change proposals are warmly welcome :-). Hope you can describe your needs more deeply at our Kanta PHR support meeting 13.2.2019 or even here before meeting, so we can think if we should support transactions.</p>",
        "id": 157188700,
        "sender_full_name": "Pirjo Vuorikallas",
        "timestamp": 1548856926
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194072\">@Pirjo Vuorikallas</span> the main point is for the client to be able to send all observations with one request, and either succeed or fail in a clerly defined manner.<br>\nThis is important when the application is entering a meal with many macronutrients. It's a lot more complicated when you need to send each macronutrient observation separately, and maintain their relationships and ids to form a summary entry. It also causes many additional network requests.<br>\nThere are now two examples at <a href=\"https://simplifier.net/finnishphrnutritionintake/~resources?category=Example&amp;exampletype=Bundle&amp;sortBy=RankScore_desc\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/~resources?category=Example&amp;exampletype=Bundle&amp;sortBy=RankScore_desc\">https://simplifier.net/finnishphrnutritionintake/~resources?category=Example&amp;exampletype=Bundle&amp;sortBy=RankScore_desc</a>. The earlier one (<a href=\"https://simplifier.net/finnishphrnutritionintake/bundle-example\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/bundle-example\">https://simplifier.net/finnishphrnutritionintake/bundle-example</a>) is a simple one, with just the macronutrients. Demonstrating how it would be much more convenient for the client to post just one message. The second example (<a href=\"https://simplifier.net/finnishphrnutritionintake/bundle-example-duplicate-2\" target=\"_blank\" title=\"https://simplifier.net/finnishphrnutritionintake/bundle-example-duplicate-2\">https://simplifier.net/finnishphrnutritionintake/bundle-example-duplicate-2</a>) is a more complex one, showing how the relationships between resources are a lot simpler to manage on client side when the client can use self-generated id's for new resources, which the server then updates to real id's for newly created resources.</p>",
        "id": 157511694,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1549274018
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192917\">@Mikael Rinnetmäki</span>  Have you already filled the PHR Data Content Proposal form for the media reference profile? If not, please do and send the form to <a href=\"mailto:kantakehitys@kanta.fi\" title=\"mailto:kantakehitys@kanta.fi\">kantakehitys@kanta.fi</a>. Could you also offer a use case to clarify how media reference is to be utilized.</p>",
        "id": 157522446,
        "sender_full_name": "Rita Ahde",
        "timestamp": 1549286850
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"197564\">@Rita Ahde</span>, I just sent the form.</p>",
        "id": 157592080,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1549357084
    },
    {
        "content": "<p>The use case is:<br>\nMealLogger is an AI assisted nutrition diary app. It analyses the contents of a meal image and helps the user to select the contents of the meal. It then calculates the nutrition intake based on selected ingredients and amounts.<br>\nThe application already stores information on the nutrition to Kanta PHR (test environment). It would be nice to be able to store information about the image too.<br>\nWe propose not to store the image itself, rather only the metadata (the url where the image can be fetched from, and optionally the type, file size and dimensions of the image.</p>",
        "id": 157592099,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1549357103
    },
    {
        "content": "<p>The latest profiles don't seem to be updated into the sandbox yet. Is this correct?</p>\n<p>For instance, <a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-macronutrientintake-stu3&amp;_format=json\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-macronutrientintake-stu3&amp;_format=json\">http://fhirsandbox.kanta.fi/phr-resourceserver/baseStu3/StructureDefinition?url=http://phr.kanta.fi/StructureDefinition/fiphr-sd-macronutrientintake-stu3&amp;_format=json</a> returns an empty result set.</p>",
        "id": 162218132,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1554106613
    },
    {
        "content": "<p>On a related note, it seems it's no longer possible to search for the StructureDefinitions via the sanbox GUI.</p>\n<p><a href=\"http://fhirsandbox.kanta.fi/phr-resourceserver-ui/resource?serverId=home&amp;pretty=false&amp;resource=StructureDefinition\" target=\"_blank\" title=\"http://fhirsandbox.kanta.fi/phr-resourceserver-ui/resource?serverId=home&amp;pretty=false&amp;resource=StructureDefinition\">http://fhirsandbox.kanta.fi/phr-resourceserver-ui/resource?serverId=home&amp;pretty=false&amp;resource=StructureDefinition</a> does show the <code>url</code> as a possible search parameter, but does not allow it to be entered anywhere?</p>",
        "id": 162218229,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1554106718
    },
    {
        "content": "<p>The url-parameter in the Hapi tester-page has been buggy quite a while (at least 2017: <a href=\"https://github.com/jamesagnew/hapi-fhir/issues/721\" target=\"_blank\" title=\"https://github.com/jamesagnew/hapi-fhir/issues/721\">https://github.com/jamesagnew/hapi-fhir/issues/721</a>)  and it's broken in the vanilla tester for me as well: <a href=\"http://hapi.fhir.org/resource?serverId=home_21&amp;pretty=false&amp;resource=StructureDefinition\" target=\"_blank\" title=\"http://hapi.fhir.org/resource?serverId=home_21&amp;pretty=false&amp;resource=StructureDefinition\">http://hapi.fhir.org/resource?serverId=home_21&amp;pretty=false&amp;resource=StructureDefinition</a> - the url parameter itself works though.</p>",
        "id": 162226328,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1554114937
    },
    {
        "content": "<p>The latest profiles should be available in Sandbox now.</p>",
        "id": 162228996,
        "sender_full_name": "Anna Korpela",
        "timestamp": 1554117633
    }
]