[
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"194072\">@Pirjo Vuorikallas</span> ! The authorization guide at <a href=\"http://www.kanta.fi/documents/12105/4106842/PHR+authorization/b2135f9f-5bfb-49d8-827e-4f5b44cdab2e\" target=\"_blank\" title=\"http://www.kanta.fi/documents/12105/4106842/PHR+authorization/b2135f9f-5bfb-49d8-827e-4f5b44cdab2e\">http://www.kanta.fi/documents/12105/4106842/PHR+authorization/b2135f9f-5bfb-49d8-827e-4f5b44cdab2e</a> states that in Sandbox environment, using the Authorization code flow, <a href=\"http://Suomi.fi\" target=\"_blank\" title=\"http://Suomi.fi\">Suomi.fi</a> e-Identification is not used and that the dummy identification can be bypassed by adding the request parameter \"user_id\" with a social security number. It's unclear what the value (that social security number) should be. How a developer can know which social security numbers have been mapped to users in the Sandbox environment? I.e, which are valid values for the parameter, to bypass the identification screen? Is there perhaps a way to set this value when creating patient resources?</p>",
        "id": 153902693,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1502974452
    },
    {
        "content": "<p>There probably should be some sort of registry to share the patient ids between developers and we'll return to this.</p>\n<p>Once you login with a official id that hasn't been used a mapping is automatically created and the patient is created to repository. The token response will contain this pseudonym of the patient in the sandbox. There is a mapping table of these ids, but that is not publicly available. The format of the patientid is should follow the pattern of Finnish social security numbers and because of that checksum parts above 900 should be used as they aren't used for real persons. The only problem is if the social security number is used and the patient resource is deleted (which can be done currently from the unauthorizing side) the mapping will be broken and in these cases either a new social security number can be picked or the mapping reseted.</p>",
        "id": 153903379,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1503482572
    },
    {
        "content": "<p>We needed a base patient to test our new observations, and in lack of Create operation on the HAPI went to trial-and-error with curl. We managed to create our own test patient (required value for gender, though not so in the cardinalities of the patient structuredef). I don't think the resulting _id we got with the 200OK was anything like a soc-sec #. Anyway, we can now use it.</p>",
        "id": 153903484,
        "sender_full_name": "Harri Honko",
        "timestamp": 1503554945
    },
    {
        "content": "<p>The social security number will not be available through PHR, but if you look at the PHR OAuth guide and the section handling  professional applications when they request an the access token, they do send the social security number to PHR and in the response they  get that uuid. So the software will have that id available all the time it needs to use some patient's records in the PHR system.</p>\n<p>I do think there needs to be some instructions for how this should be handles in the sandbox without the authorization to avoid confusion.</p>",
        "id": 153903799,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1503897799
    },
    {
        "content": "<p>I had same issue with SelfCarePlan  - it has also mandatory Patient reference. But if you can create a patient using curl, why can't you allow Create-operation with HAPI?</p>",
        "id": 153904772,
        "sender_full_name": "Jukka Pirinen",
        "timestamp": 1504766318
    },
    {
        "content": "<p>Patient Create seems to be enabled now :)</p>",
        "id": 153904783,
        "sender_full_name": "Jukka Pirinen",
        "timestamp": 1504778117
    },
    {
        "content": "<p>I was able to create a patient through the authorization process, using a fake social security number. I was also able to log in with that patient on subsequent app launches. (This was with the old implementation, not the one deployed yesterday).</p>",
        "id": 153904956,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1504858124
    },
    {
        "content": "<p>The Hapi UI had trouble rendering the CRUD page when no search operations were enabled, sorry about that :). Also the URL search parameter doesn't seem to be working there, but I did submit an issue to Hapi guthub about it.</p>",
        "id": 153904958,
        "sender_full_name": "Eeva Turkka",
        "timestamp": 1504858790
    },
    {
        "content": "<p>Just a minor nitpick regarding what's returned by the userinfo endpoint:</p>\n<div class=\"codehilite\"><pre><span></span>{\n    &quot;resourceType&quot;: &quot;Patient&quot;,\n    &quot;id&quot;: &quot;3b8785e1-1902-4ebe-81da-dbf609f154dd&quot;,\n    &quot;meta&quot;: {\n        &quot;versionId&quot;: &quot;1&quot;,\n        &quot;lastUpdated&quot;: &quot;2017-10-20T10:03:46.175+03:00&quot;,\n        &quot;profile&quot;: [&quot;http:\\/\\/phr.kanta.fi\\/StructureDefinition\\/fiphr-patient-stu3&quot;]\n    },\n    &quot;language&quot;: &quot;fi&quot;,\n    &quot;identifier&quot;: [{\n        &quot;system&quot;: &quot;urn:ietf:rfc:3986&quot;,\n        &quot;value&quot;: &quot;3b8785e1-1902-4ebe-81da-dbf609f154dd&quot;\n    }],\n    &quot;active&quot;: true,\n    &quot;status&quot;: &quot;ok&quot;\n}\n</pre></div>\n\n\n<p>Since the identifier system is <a href=\"https://www.ietf.org/rfc/rfc3986.txt\" target=\"_blank\" title=\"https://www.ietf.org/rfc/rfc3986.txt\">RFC 3986</a>, I would have expected the identifier value to be a full URL, in this case <a href=\"https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd\" target=\"_blank\" title=\"https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd\">https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd</a>.</p>",
        "id": 153915158,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1508561759
    },
    {
        "content": "<p>Not a big thing by any means. :)</p>",
        "id": 153915159,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1508561792
    },
    {
        "content": "<p>If this resource instance is created by server (in authorization process), then there is a mistake in the Patient.identifier. It should be in form urn:uuid:49d62881-acab-486d-a08e-414d715463ea. </p>\n<p>Check this: <a href=\"http://hl7.org/fhir/datatypes.html#Identifier\" target=\"_blank\" title=\"http://hl7.org/fhir/datatypes.html#Identifier\">http://hl7.org/fhir/datatypes.html#Identifier</a><br>\n\"If the identifier value itself is naturally a globally unique URI (e.g. an OID, a UUID, or a URI with no trailing local part), then the system SHALL be \"urn:ietf:rfc:3986\", and the URI is in the value (OIDs and UUIDs using urn:oid: and urn:uuid: - see examples).\"</p>\n<p>The identifier used in Patient.identifier is UUID.</p>",
        "id": 153915249,
        "sender_full_name": "Mika Tuomainen",
        "timestamp": 1508706950
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192558\">@Mika Tuomainen</span> Thanks! Yes, the resource was created by the server during authentication.</p>",
        "id": 153915329,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1508752402
    },
    {
        "content": "<p>I still wonder why you'd select the uuid syntax, even when <a href=\"https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd\" target=\"_blank\" title=\"https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd\">https://fhirsandbox2.kanta.fi/phr-resourceserver/baseStu3/Patient/3b8785e1-1902-4ebe-81da-dbf609f154dd</a> clearly resolves too (the identifier is also the id).</p>",
        "id": 153915330,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1508752472
    },
    {
        "content": "<p>But as said, not a big thing.</p>",
        "id": 153915331,
        "sender_full_name": "Mikael Rinnetmäki",
        "timestamp": 1508752554
    }
]