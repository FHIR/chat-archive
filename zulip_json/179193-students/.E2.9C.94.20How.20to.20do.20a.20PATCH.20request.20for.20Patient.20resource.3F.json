[
    {
        "content": "<p>Hi everyone --<br>\nI've created, successfully, a Patient Resource, but then I tried to do a PATCH request, adding (\"op\":\"add\") maritalStatus, and the server (I'm using the one on: <a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter</a> installed via docker container) responded with the following diagnostics error below. Why? </p>\n<p>{<br>\n  \"resourceType\": \"OperationOutcome\",<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;h1&gt;Operation Outcome&lt;/h1&gt;&lt;table border=\\\"0\\\"&gt;&lt;tr&gt;&lt;td style=\\\"font-weight: bold;\\\"&gt;ERROR&lt;/td&gt;&lt;td&gt;[]&lt;/td&gt;&lt;td&gt;&lt;pre&gt;parent of node to add does not exist&lt;/pre&gt;&lt;/td&gt;\\n\\t\\t\\t&lt;/tr&gt;\\n\\t\\t&lt;/table&gt;\\n\\t&lt;/div&gt;\"<br>\n  },<br>\n  \"issue\": [ {<br>\n    \"severity\": \"error\",<br>\n    \"code\": \"processing\",<br>\n    \"diagnostics\": \"parent of node to add does not exist\"<br>\n  } ]<br>\n}</p>\n<p>The resource was this patient:</p>\n<p>{<br>\n  \"resourceType\": \"Patient\",<br>\n  \"identifier\": [<br>\n    {<br>\n      \"value\": \"Johny\"<br>\n    }<br>\n  ],<br>\n  \"name\": [<br>\n    {<br>\n      \"family\": \"Goode\",<br>\n      \"given\": [<br>\n        \"Johny B.\"<br>\n      ]<br>\n    }<br>\n  ],<br>\n  \"telecom\": [<br>\n    {<br>\n      \"value\": \"(03) 5555 6789\",<br>\n      \"use\": \"home\"<br>\n    }<br>\n  ],<br>\n  \"gender\": \"male\",<br>\n  \"birthDate\": \"1977-07-17\",<br>\n  \"address\": [<br>\n    {<br>\n      \"line\": [<br>\n        \"3300 Washtenaw\"<br>\n      ],<br>\n      \"city\": \"Ann Harbour\",<br>\n      \"district\": \"Washtenaw\",<br>\n      \"state\": \"MI\",<br>\n      \"postalCode\": \"48104\",<br>\n      \"country\": \"EUA\"<br>\n    }<br>\n  ],<br>\n  \"communication\": [<br>\n    {<br>\n      \"language\": {<br>\n        \"coding\": [<br>\n          {<br>\n            \"system\": \"urn:ietf:bcp:47\",<br>\n            \"code\": \"pt-br\",<br>\n            \"display\": \"Português\"<br>\n          }<br>\n        ]<br>\n      }<br>\n    }<br>\n  ]<br>\n}</p>\n<p>And this is the curl PATCH command:<br>\ncurl -X PATCH -H \"Content-Type: application/json-patch+json\" -d '[ { \"op\" : \"add\",  \"path\" : \"/maritalStatus/text\", \"value\" : \"Polygamous\" } ]' <a href=\"http://localhost:8080/fhir/Patient/1\">http://localhost:8080/fhir/Patient/1</a></p>\n<p>TIA <br>\n-- Hank</p>",
        "id": 251703394,
        "sender_full_name": "Hank Lenzi",
        "timestamp": 1630584009
    },
    {
        "content": "<p>\"maritalStatus\" isn't an element you can add.  You'd have to add an 'extension' element (with the relevant URL and value children)</p>",
        "id": 251750662,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1630602849
    },
    {
        "content": "<p>Oh, I see...because it said \"extensible\" on the Patient resource page...Thanks, Lloyd</p>",
        "id": 251751844,
        "sender_full_name": "Hank Lenzi",
        "timestamp": 1630603258
    },
    {
        "content": "<p>Hi --</p>\n<p>I finally understood how to get (non-extension) JSON patches to work. So I'm posting a (self)follow-up here, for the record, because it might be of interest to other newbies. <br>\nFor the current task, I wish to to add a new telephone number. Currently, for the above patient, it is:</p>\n<p>\"telecom\": [ {<br>\n    \"value\": \"(03) 5555 6789\",<br>\n    \"use\": \"home\"<br>\n  } ],</p>\n<p>By reading the Patient resource, we can see that telecom has arity 0..*. This means this will boil down to a JSON array. <br>\nAlso, we see, by reading the Patient resource page and following telecom that it of type ContactPoint.<br>\nContactPoint is a General-Purpose FHIR Data Type, and, according to:<br>\n<a href=\"http://hl7.org/fhir/r4/datatypes.html#ContactPoint\">http://hl7.org/fhir/r4/datatypes.html#ContactPoint</a><br>\nit can be defined wrt to system (code:phone | fax | email | pager | url | sms | other), value(string), use(code:home | work | temp | old | mobile), etc<br>\nPatient → telecom → ContactPoint (General-Purpose Data types) → ContactPoint </p>\n<p>Let's try to add the following work number: (03) 5555-5555 which, again, has to fit here:<br>\n  \"telecom\": [ {<br>\n    \"value\": \"(03) 5555 6789\",<br>\n    \"use\": \"home\"<br>\n  } ],</p>\n<p>Let's read the JSON PATCH RFC, shall we?<br>\n<a href=\"https://datatracker.ietf.org/doc/html/rfc6902#page-12\">https://datatracker.ietf.org/doc/html/rfc6902#page-12</a></p>\n<p>Adding an Array Element</p>\n<p>An example target JSON document:</p>\n<p>{ \"foo\": [ \"bar\", \"baz\" ] }</p>\n<p>A JSON Patch document:</p>\n<p>[<br>\n     { \"op\": \"add\", \"path\": \"/foo/1\", \"value\": \"qux\" }<br>\n   ]</p>\n<p>So, likewise, in our case, we'll be adding an element to an array (the telcom array). What element? Well, a set of the following key/value pairs:<br>\n{ \"value\": \"(03) 5555 6789\",  \"use\": \"home\"   }<br>\nand we will choose to add it in the \"1\" position of the telecom array. So, by following the RFC, we conclude that the JSON syntax we need for our patch is:<br>\n[ <br>\n   { \"op\" : \"add\", \"path\" : \"/telecom/1\", \"value\" : { \"value\" : \"(03) 5555-5555\", \"use\" : \"work\" } } <br>\n]</p>\n<p>We use curl for this:<br>\ncurl -X PATCH -H \"Accept: Accept: application/fhir+json; fhirVersion=4.0\" -H \"Content-Type: application/json-patch+json\" -d '[ { \"op\" : \"add\", \"path\" : \"/telecom/1\", \"value\" : { \"value\" : \"(03) 5555-5555\", \"use\" : \"work\" } } ]' <a href=\"http://localhost:8080/fhir/Patient/1\">http://localhost:8080/fhir/Patient/1</a></p>\n<p>DONE!</p>\n<p>❯ curl -X PATCH -H \"Accept: Accept: application/fhir+json; fhirVersion=4.0\" -H \"Content-Type: application/json-patch+json\" -d '[ { \"op\" : \"add\", \"path\" : \"/telecom/1\", \"value\" : { \"value\" : \"(03) 5555-5555\", \"use\" : \"work\" } } ]' <a href=\"http://localhost:8080/fhir/Patient/1\">http://localhost:8080/fhir/Patient/1</a></p>\n<p>{<br>\n  \"resourceType\": \"Patient\",<br>\n  \"id\": \"1\",<br>\n  \"meta\": {<br>\n    \"versionId\": \"2\",<br>\n    \"lastUpdated\": \"2021-09-02T17:52:15.017+00:00\",<br>\n    \"source\": \"#mxZztGmxiV2ewr57\"<br>\n  },<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;&lt;div class=\\\"hapiHeaderText\\\"&gt;Johny B. &lt;b&gt;GOODE &lt;/b&gt;&lt;/div&gt;&lt;table class=\\\"hapiPropertyTable\\\"&gt;&lt;tbody&gt;&lt;tr&gt;&lt;td&gt;Identifier&lt;/td&gt;&lt;td&gt;Johny&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Address&lt;/td&gt;&lt;td&gt;&lt;span&gt;3300 Washtenaw &lt;/span&gt;&lt;br/&gt;&lt;span&gt;Ann Harbour &lt;/span&gt;&lt;span&gt;MI &lt;/span&gt;&lt;span&gt;EUA &lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;tr&gt;&lt;td&gt;Date of birth&lt;/td&gt;&lt;td&gt;&lt;span&gt;17 July 1977&lt;/span&gt;&lt;/td&gt;&lt;/tr&gt;&lt;/tbody&gt;&lt;/table&gt;&lt;/div&gt;\"<br>\n  },<br>\n  \"identifier\": [ {<br>\n    \"value\": \"Johny\"<br>\n  } ],<br>\n  \"name\": [ {<br>\n    \"family\": \"Goode\",<br>\n    \"given\": [ \"Johny B.\" ]<br>\n  } ],<br>\n  \"telecom\": [ {<br>\n    \"value\": \"(03) 5555 6789\",<br>\n    \"use\": \"home\"<br>\n  }, {<br>\n    \"value\": \"(03) 5555-5555\",<br>\n    \"use\": \"work\"<br>\n  } ],<br>\n  \"gender\": \"female\",<br>\n  \"birthDate\": \"1977-07-17\",<br>\n  \"address\": [ {<br>\n    \"line\": [ \"3300 Washtenaw\" ],<br>\n    \"city\": \"Ann Harbour\",<br>\n    \"district\": \"Washtenaw\",<br>\n    \"state\": \"MI\",<br>\n    \"postalCode\": \"48104\",<br>\n    \"country\": \"EUA\"<br>\n  } ],<br>\n  \"communication\": [ {<br>\n    \"language\": {<br>\n      \"coding\": [ {<br>\n        \"system\": \"urn:ietf:bcp:47\",<br>\n        \"code\": \"pt-br\",<br>\n        \"display\": \"Português\"<br>\n      } ]<br>\n    }<br>\n  } ]<br>\n}</p>",
        "id": 251763270,
        "sender_full_name": "Hank Lenzi",
        "timestamp": 1630607383
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"437401\">Hank Lenzi</span> has marked this topic as resolved.</p>",
        "id": 251763299,
        "sender_full_name": "Notification Bot",
        "timestamp": 1630607393
    }
]