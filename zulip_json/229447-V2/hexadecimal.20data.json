[
    {
        "content": "<p>depending on where one looks escaping of 2 specific hexadecimal characters is done differently.<br>\nthe 2 I am referring to are line feeds <code>\\n</code> or <code>\\X0A\\</code> or <code>\\X00A\\</code> in hexadecimal and carriage return <code>\\r</code> or <code>\\X0D\\</code> or <code>\\X00D\\</code> or <code>\\X000d\\</code>.<br>\nwhat is the correct way to decode/encode these characters?<br>\n<a href=\"https://github.com/Efferent-Health/HL7-dotnetcore/blob/9ca6f4b907960e062f35163283708ff2b6ceb1a7/src/Encoding.cs#L94\">https://github.com/Efferent-Health/HL7-dotnetcore/blob/9ca6f4b907960e062f35163283708ff2b6ceb1a7/src/Encoding.cs#L94</a> uses <code>\\X00D\\</code> but  <a href=\"https://github.com/hapifhir/hapi-hl7v2/blob/efca803e58aea1705ba6b28390ad24c4c3b1d3cb/hapi-base/src/main/java/ca/uhn/hl7v2/parser/DefaultEscaping.java#L286\">https://github.com/hapifhir/hapi-hl7v2/blob/efca803e58aea1705ba6b28390ad24c4c3b1d3cb/hapi-base/src/main/java/ca/uhn/hl7v2/parser/DefaultEscaping.java#L286</a> uses <code>\\X000d\\</code> and InterSystems (who make the ensemble integration engine) recommend <code>\\X0D\\</code> <a href=\"https://docs.intersystems.com/latest/csp/docbook/Doc.View.cls?KEY=EHL72_escape_sequences\">https://docs.intersystems.com/latest/csp/docbook/Doc.View.cls?KEY=EHL72_escape_sequences</a>.</p>",
        "id": 228294938,
        "sender_full_name": "Jake Aitchison",
        "timestamp": 1614628303
    },
    {
        "content": "<p>Per <span class=\"user-mention\" data-user-id=\"191749\">@Anthony(Tony) Julian</span> from the InM Work Group:<br>\nWhen exploring the escape sequences it is best to go to the source:  Chapter 2.  </p>\n<p>2.7.6   Hexadecimal<br>\nWhen the hexadecimal escape sequence (\\Xdddd...\\) is used the X SHALL be followed by 1 or more pairs of hexadecimal digits (0, 1,  . . . , 9, A,  . . . , F). Consecutive pairs of the hexadecimal digits represent 8-bit binary values. The interpretation of the data is entirely left to an agreement between the sending and receiving applications that is beyond the scope of this Standard.</p>\n<p>\\Xdddd\\  the X shall be followed by 1 or more pairs of hexadecimal digits.  Which means \\X0a\\ is legal, as is \\X000a\\.  The last sentence is there because the implementation changes based on the character set(s) used as well as the contract between the trading partners.</p>",
        "id": 228312349,
        "sender_full_name": "Craig Newman",
        "timestamp": 1614635417
    },
    {
        "content": "<p>The quote from chapter 2 is</p>\n<blockquote>\n<p>When the hexadecimal escape sequence (\\Xdddd...\\) is used the X SHALL be followed by 1 or more<br>\npairs of hexadecimal digits (0, 1, . . . , 9, A, . . . , F). Consecutive pairs of the hexadecimal digits<br>\nrepresent 8-bit binary values. The interpretation of the data is entirely left to an agreement between the<br>\nsending and receiving applications that is beyond the scope of this Standard.</p>\n</blockquote>\n<p>This means that the sequence \\X000A\\ is valid, but that represents a sequence of two bytes (aka octets). Unless there is a predefined agreement for the use of UTF-16 as the character encoding, line feed and carriage return are single byte values, and \\X0A\\ and \\X0D\\ are the hexadecimal representations of these characters. </p>\n<p>Note that HL7 V2 has only described the use of  UTF-8 Unicode encodings, so a theoretical use of UTF-16 or UTF-32 is probably non-compliant. See the definition of MSH-18 (section 2.14.9.18) and table 0211.</p>",
        "id": 228353591,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614660954
    },
    {
        "content": "<p>I'm not sure that this is correct. I think that defaulting to UTF-8 is a reasonable, but there's lots of messages out there that don't use UTF-8 - they are using some kind of old OEM character set when using \\X</p>",
        "id": 228355314,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1614662399
    },
    {
        "content": "<p>Originally we have had 7bit Ascii only. But a lot used 8bit or iso8859.<br>\nWe examined the use of Unicode which is also ok, but only as UTF-8 because it is sufficient and compatible. It is documented in the old wiki I believe to remember.</p>",
        "id": 228358712,
        "sender_full_name": "Frank Oemig",
        "timestamp": 1614665257
    },
    {
        "content": "<p>Thanks so much guys for these replies, so would you recommend <code>\\X0D\\</code> and <code>\\X0A\\</code> respectively?</p>",
        "id": 228365660,
        "sender_full_name": "Jake Aitchison",
        "timestamp": 1614670209
    },
    {
        "content": "<p>I was making the distinction between UTF-8 and other Unicode encodings. Other non-Unicode encodings are allowed, as per table 0211, but for all of them, as far as I can tell, \\n and \\r are single byte values, and their hexadecimal representations are \\X0A\\ and \\X0D\\</p>",
        "id": 228403896,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1614689440
    },
    {
        "content": "<p>By the way, if the field is formatted text (FT, which I suspect it is, if you are encoding line breaks in it) you may be able to avoid any encoding of newline or return, by using the <code>\\.br\\</code> formatting command.</p>",
        "id": 228469072,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1614712862
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192685\">@Vassil Peytchev</span> : AFAIR, UTF-16 and UTF-32 is not allowed, because you cannot parse the MSH segment. And since they are equivalent it is not necessary to use those.</p>",
        "id": 228481740,
        "sender_full_name": "Frank Oemig",
        "timestamp": 1614717619
    }
]