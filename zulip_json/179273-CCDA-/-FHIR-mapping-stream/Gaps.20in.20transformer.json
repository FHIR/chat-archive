[
    {
        "content": "<p>Here is a current list of gaps that I have found in the transform part of the validator.<br>\n-can not create non-FHIR resources<br>\n*-can not read ConceptMap resources so can not do vocabulary mapping for FHIR codes<br>\n*-source condition clauses don't seem to work<br>\n-can not cast to boolean</p>\n<p>For those marked as '*', it could be something I'm doing, but I've pretty sure it's actually the transform engine.</p>",
        "id": 153957919,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526055519
    },
    {
        "content": "<p>I don't understand the ConceptMap resource issue ? how can it not read them?</p>",
        "id": 153957932,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526057933
    },
    {
        "content": "<p>the create non-fhir resources is mine</p>",
        "id": 153957933,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526057949
    },
    {
        "content": "<p>sorry I didn't get to fix it - bandwith in italy seemed generally horrible and it got hard to focus on work too. Will try to get this sorted tonight</p>",
        "id": 153957934,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526057980
    },
    {
        "content": "<p>source conditions - they work for me - so I don't understand. they have to start with a variable name though</p>",
        "id": 153957935,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058014
    },
    {
        "content": "<p>when I was running the maps, it wouldn't do any conversions, even though I specified the conceptMap to use.  I debugged it and it appears that ConceptMaps aren't read.  as I said, I could be completely out-to-lunch</p>",
        "id": 153957936,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058031
    },
    {
        "content": "<p>how did you specify the concept map?</p>",
        "id": 153957937,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058081
    },
    {
        "content": "<p>source conditions - I don't think they do.  I'm using your II to Identifier map:<br>\n  root1: for source.root as r where extension.exists() make target.system = translate(r, \"<a href=\"http://hl7.org/fhir/ConceptMap/special-oid2uri\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/special-oid2uri\">http://hl7.org/fhir/ConceptMap/special-oid2uri</a>\", \"uri\")  <br>\n  root2: for source.root as r where extension.empty() make target.system = \"urn:ietf:rfc:3986\", target.value = append(\"urn:oid:\", r)</p>\n<p>root 1 never fires</p>",
        "id": 153957938,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058101
    },
    {
        "content": "<p>use: for source.use make target.use = translate(c, '<a href=\"http://hl7.org/fhir/ConceptMap/cm-name-use-v3\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/cm-name-use-v3\">http://hl7.org/fhir/ConceptMap/cm-name-use-v3</a>', 'code')</p>",
        "id": 153957939,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058119
    },
    {
        "content": "<p>so do we have a proper shared workspace in github somewhere, or do we have to send each other files?</p>",
        "id": 153957940,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058161
    },
    {
        "content": "<p>well, I have a shared workspace for my group, but not in github :)</p>",
        "id": 153957941,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058221
    },
    {
        "content": "<p>let me make something in github</p>",
        "id": 153957942,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058234
    },
    {
        "content": "<p>ok</p>",
        "id": 153957943,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058257
    },
    {
        "content": "<p>done and you were invited</p>",
        "id": 153957946,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058645
    },
    {
        "content": "<p><a href=\"https://github.com/jduteau/ccda-to-fhir-maps\" target=\"_blank\" title=\"https://github.com/jduteau/ccda-to-fhir-maps\">https://github.com/jduteau/ccda-to-fhir-maps</a></p>",
        "id": 153957947,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058654
    },
    {
        "content": "<p>shouldn't it be public?</p>",
        "id": 153957949,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058759
    },
    {
        "content": "<p>no, don't want just anyone touching my mappings at this time</p>",
        "id": 153957950,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526058858
    },
    {
        "content": "<p>touching? reading? just because it's public doesn't mean you have to let other people commit or accept pull requests</p>",
        "id": 153957951,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526058962
    },
    {
        "content": "<p>can we have sample documents and bundles in there too?</p>",
        "id": 153957953,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526059077
    },
    {
        "content": "<p>so that we're using the same examples when we test</p>",
        "id": 153957954,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526059085
    },
    {
        "content": "<p>i added three sample discharge summary documents</p>",
        "id": 153957956,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526059362
    },
    {
        "content": "<p>k thanks.</p>",
        "id": 153957964,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526059854
    },
    {
        "content": "<p>One other thing - you didn't create a CO structure definition.  We have some test documents that use CO in Observation.value.</p>",
        "id": 153957966,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526059908
    },
    {
        "content": "<p>but you didn't commit a bundle?</p>",
        "id": 153957967,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526059952
    },
    {
        "content": "<p>a CO? is that legal? how?</p>",
        "id": 153957968,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526059959
    },
    {
        "content": "<p>no bundle as we haven't tested our Bundle-&gt;ClinicalDocument maps yet</p>",
        "id": 153957969,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526059989
    },
    {
        "content": "<p>but that's one of the things you want me to check, no?</p>",
        "id": 153957970,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526060006
    },
    {
        "content": "<p>CO: the model/schema has ANY, so I would assume that a CO is legal<br>\nBundle: I can give you a skeleton Bundle to run, but our maps are very draft</p>",
        "id": 153957971,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526060105
    },
    {
        "content": "<p>test Bundle pushed</p>",
        "id": 153957974,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526060244
    },
    {
        "content": "<p>I thought CO was only defined in R2? that's why there's no logical model for it...</p>",
        "id": 153957990,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526062297
    },
    {
        "content": "<p>no, it's an R1 datatype as well.</p>",
        "id": 153958003,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526063628
    },
    {
        "content": "<p>really? who the hell edited all this stuff anyway?</p>",
        "id": 153958038,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526064288
    },
    {
        "content": "<p>it's not the MIF, anyhow.</p>",
        "id": 153958040,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526064296
    },
    {
        "content": "<p>ok. got the mapping all running locally (oops, had to rewrite part of my server to get it running)</p>",
        "id": 153958126,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526065601
    },
    {
        "content": "<p>you haven't committed any FHIR --&gt; CDA mappings?</p>",
        "id": 153958127,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526065611
    },
    {
        "content": "<p>yes.  CCDToCDA and DischargeSummaryToCDA</p>",
        "id": 153958129,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526065666
    },
    {
        "content": "<p>which is the start?</p>",
        "id": 153958130,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526065674
    },
    {
        "content": "<p>they don't do much</p>",
        "id": 153958131,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526065675
    },
    {
        "content": "<p>found it</p>",
        "id": 153958132,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526065691
    },
    {
        "content": "<p>just in time.. boarding now...</p>",
        "id": 153958133,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526065704
    },
    {
        "content": "<p>I think there is also a problem with ED-to-string.  The CDA attribute looks exactly the same as a ST: &lt;originalText&gt;text goes here&lt;/originalText&gt; but the same map won't convert it over.</p>",
        "id": 153958138,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526066939
    },
    {
        "content": "<p>I'll look at the concept map thing shortly</p>",
        "id": 153958152,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076417
    },
    {
        "content": "<p>ok. So:<br>\n- defined CO. Will have to push it<br>\n- sorted out the creation of ClinicalDocument, though I expect that there's downstream issues - we'll have to play ping pong as you find them and I fix them. <br>\n- the condition issue: the thing is: </p>\n<p>root1: for source.root as r where source.extension.exists() make target.system = translate(r, \"<a href=\"http://hl7.org/fhir/ConceptMap/special-oid2uri\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/special-oid2uri\">http://hl7.org/fhir/ConceptMap/special-oid2uri</a>\", \"uri\")  <br>\n  root2: for source.root as r where source.extension.empty() make target.system = \"urn:ietf:rfc:3986\", target.value = append(\"urn:oid:\", r)</p>\n<p>the source. in the where is critical. In the absence of that, the extension that this looks for is on root, not source.</p>",
        "id": 153958153,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076417
    },
    {
        "content": "<p>okay, that works better</p>",
        "id": 153958154,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526076589
    },
    {
        "content": "<p>committed my changes for creating ClinicalDocument - wait for the build and try again</p>",
        "id": 153958156,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076615
    },
    {
        "content": "<p>do you have a concept map in there that's not working?</p>",
        "id": 153958157,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076627
    },
    {
        "content": "<p>the cm-name-use-v3, cm-address-use-v3, and cm-telecom-use-v3 didn't seem to work</p>",
        "id": 153958158,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526076669
    },
    {
        "content": "<p>Exception in thread \"main\" java.lang.Error: org.hl7.fhir.exceptions.FHIRException: not done yet: can't fetch <a href=\"http://hl7.org/fhir/ConceptMap/cm-address-use-v3\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/cm-address-use-v3\">http://hl7.org/fhir/ConceptMap/cm-address-use-v3</a></p>",
        "id": 153958160,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526076716
    },
    {
        "content": "<p>and when I debugged it, it seemed that any ConceptMap couldn't be loaded.</p>",
        "id": 153958161,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526076734
    },
    {
        "content": "<p>ah. ok</p>",
        "id": 153958162,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076769
    },
    {
        "content": "<p>not inline concept maps . ok</p>",
        "id": 153958163,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076775
    },
    {
        "content": "<p>you got a stack dump or an example?</p>",
        "id": 153958165,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526076840
    },
    {
        "content": "<p>i have both.  just uncomment the use rules in ENHumanName, ADAddress, and/or TELContactPoint and it will fail.</p>\n<p>Exception in thread \"main\" java.lang.Error: org.hl7.fhir.exceptions.FHIRException: not done yet: can't fetch <a href=\"http://hl7.org/fhir/ConceptMap/cm-address-use-v3\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/cm-address-use-v3\">http://hl7.org/fhir/ConceptMap/cm-address-use-v3</a><br>\n    at org.hl7.fhir.r4.context.BaseWorkerContext.fetchResource(BaseWorkerContext.java:1136)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.translate(StructureMapUtilities.java:1858)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.translate(StructureMapUtilities.java:1804)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.runTransform(StructureMapUtilities.java:1691)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.processTarget(StructureMapUtilities.java:1615)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1222)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1207)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1242)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1207)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeDependency(StructureMapUtilities.java:1267)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1230)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1226)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1207)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1203)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeDependency(StructureMapUtilities.java:1267)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1230)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1207)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeDependency(StructureMapUtilities.java:1267)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeRule(StructureMapUtilities.java:1230)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.executeGroup(StructureMapUtilities.java:1207)<br>\n    at org.hl7.fhir.r4.utils.StructureMapUtilities.transform(StructureMapUtilities.java:1181)<br>\n    at org.hl7.fhir.r4.validation.ValidationEngine.transform(ValidationEngine.java:758)<br>\n    at org.hl7.fhir.r4.validation.ValidationEngine.transform(ValidationEngine.java:745)<br>\n    at org.hl7.fhir.r4.validation.Validator.main(Validator.java:268)</p>",
        "id": 153958166,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526076881
    },
    {
        "content": "<p>BaseWorkerContext.java:1024 (fetchResoruceWithException)</p>",
        "id": 153958167,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526077011
    },
    {
        "content": "<p>if you have a second, can you look at this group and tell me what I'm doing wrong.  I'm obviously not understanding the source context for where conditions:</p>\n<div class=\"codehilite\"><pre><span></span>group CCDAComposition extends ClinicalDocumentComposition\n    input source : ClinicalDocument as source\n    input target: Composition as target\n    input bundle: Bundle as target\n\n    component: for source.component as component then {\n        body: for component.structuredBody as body then {\n            bodyComponent: for body.component as component then {\n                allergySection: for component.section as srcSection where srcSection.code.code = &quot;48765-2&quot; make target.section as tgtSection then AllergySection(srcSection, bundle, tgtSection)\n                section: for component.section as srcSection where srcSection.code.code != &quot;48765-2&quot; make target.section as tgtSection then ClinicalDocumentSection(srcSection, tgtSection)\n            }\n        }\n    }\nendgroup\n</pre></div>",
        "id": 153958169,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526077895
    },
    {
        "content": "<p>the allergySection rule fires for every section</p>",
        "id": 153958170,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526077963
    },
    {
        "content": "<p>ok concept maps should work now. I had not tested external ones before and had not stumbled into that rather obvious bug in the context</p>",
        "id": 153958171,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526078499
    },
    {
        "content": "<p>I will look at the other tomorrow morning</p>",
        "id": 153958173,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526078568
    },
    {
        "content": "<p>okay.  have you pushed the CO definition?  and did you add it to the list of options in x.value?</p>",
        "id": 153958174,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526078604
    },
    {
        "content": "<p>yes you did and no you didn't.  But I added it on my side and they work now.  Thx</p>",
        "id": 153958176,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526079512
    },
    {
        "content": "<p>re: concept maps - good news and bad news: it doesn't throw an error for address and humanName, but it still throws an error for telecom.  This error is different:<br>\n...Failure: Exception executing transform target.use = translate(c, \"<a href=\"http://hl7.org/fhir/ConceptMap/cm-telecom-use-v3\" target=\"_blank\" title=\"http://hl7.org/fhir/ConceptMap/cm-telecom-use-v3\">http://hl7.org/fhir/ConceptMap/cm-telecom-use-v3</a>\", \"code\") on Rule \"use\": translation is not supported yet</p>\n<p>unfortunately, although it doesn't throw an error, it doesn't actually translate them</p>",
        "id": 153958178,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526080682
    },
    {
        "content": "<p>anyways, i too am done for the night</p>",
        "id": 153958179,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1526080693
    },
    {
        "content": "<p>the reason the translations don't work is because you are using them the wrong way around, I think</p>",
        "id": 153958193,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1526107219
    },
    {
        "content": "<p>ok I've cleared out my critical task list and now I'm down to the merely urgent... Jean, where's a condition that's not working for you?</p>",
        "id": 153964299,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1527059109
    },
    {
        "content": "<p>The DischargeSummaryToFHIR.map has a where condition for the sections that doesn't seem to work</p>",
        "id": 153964344,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1527088656
    },
    {
        "content": "<p>Any update on this?</p>",
        "id": 153965442,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1527655049
    }
]