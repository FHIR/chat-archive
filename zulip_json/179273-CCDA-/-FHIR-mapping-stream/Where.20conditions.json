[
    {
        "content": "<p>I'm slightly confused by the context that exists for where conditions in mapping rules.  I want to express a rule like this: <code>for source as srcSection where code.code = \"48765-2\"</code>  but that doesn't fire.  When I trace it in the debugger, it is quite tough to make heads or tails of whether it is supposed to work.  I am assuming that the context for my where clause is the initial variable, i.e. source.  So this should work when my XML is <code> &lt;section&gt;&lt;code code=\"48765-2\" .../&gt; </code></p>",
        "id": 153957093,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1525832796
    },
    {
        "content": "<p>hmm. maybe I could document this better. There's no implicit context for that FHIRPath statement. You need to do where srcSection.code.code</p>",
        "id": 153957105,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525844885
    },
    {
        "content": "<p>you can start with a reference to any of the variables in scope</p>",
        "id": 153957106,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1525844906
    },
    {
        "content": "<p>hmm, i must still have something wrong:</p>\n<div class=\"codehilite\"><pre><span></span>section: for source.component as component then {\n    body: for component.structuredBody as body then {\n        component: for body.component as component then {\n            allergySection: for component.section as srcSection where srcSection.code.code = &quot;48765-2&quot; make target.section as tgtSection then AllergySection(srcSection, bundle, tgtSection)\n            section: for component.section as srcSection where srcSection.code.code != &quot;48765-2&quot; make target.section as tgtSection then ClinicalDocumentSection(srcSection, tgtSection)\n        }\n    }\n}\n</pre></div>\n\n\n<p>the allergySection rule is always firing even though only one of my sections has a code with 48765-2.</p>",
        "id": 153957113,
        "sender_full_name": "Jean Duteau",
        "timestamp": 1525848143
    }
]