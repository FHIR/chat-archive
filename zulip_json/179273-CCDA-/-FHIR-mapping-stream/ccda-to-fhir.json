[
    {
        "content": "<p>I'm looking to try using the opensource solution here  <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language</a> for mapping CCDA to FHIR.</p>\n<p>I'm really struggling to get the CLI tool to work and was hoping someone might be able to point me in the right direction.</p>\n<p>It appears from the example I'm working with at <a href=\"https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content#CCDA_to_FHIR\">https://wiki.hl7.org/Using_the_FHIR_Validator_to_transform_content#CCDA_to_FHIR</a> which references this solution that there are numerous out of date / broken references.</p>\n<p>Does anyone have an up to date project/command that I could reference?</p>\n<p>I am trying /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/bin/java -jar org.hl7.fhir.validator.jar /Users/davidboerner/Documents/GitHub/ArielCCD.xml -transform /Users/davidboerner/Documents/GitHub/ccda-to-fhir/mappings/CCDAToFHIR.map -ig hl7.fhir.us.ccda -ig /Users/davidboerner/Documents/GitHub/ccda-to-fhir/mappings/ -output /Users/davidboerner/Documents/GitHub/ccda-to-fhir/output/ariel.json -ig hl7.fhir.r4.core -version 4.0 -log test.txt</p>\n<p>but getting this error, even though I'm referencing the input structure as CCDA (-ig hl7.fhir.us.ccda) which I had to update from -ig hl7.fhir.cda#2.0 which is a broken link</p>\n<p>...Failure: This does not appear to be a FHIR resource (unknown namespace/name \"urn:hl7-org:v3::ClinicalDocument\") at line 0 col 0<br>\norg.hl7.fhir.exceptions.FHIRFormatError: This does not appear to be a FHIR resource (unknown namespace/name \"urn:hl7-org:v3::ClinicalDocument\") at line 0 col 0</p>\n<p>Any help most appreciated!</p>",
        "id": 200463009,
        "sender_full_name": "David Boerner",
        "timestamp": 1591816444
    },
    {
        "content": "<p>The error message looks like the validator has the CDA Logical Model not available. I do not have experience with the CCDA Model, but maybe cou can specify the CDA Logical Model itself directly with the parameter -ig <a href=\"https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz\">https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz</a> to look if the validator can parse the file. Are you using the latest version of the validator?</p>",
        "id": 200516877,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1591863932
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>  that perhaps has gotten me a bit further? I am using the latest versions.</p>\n<p>I tried java -jar org.hl7.fhir.validator.jar /Users/davidboerner/Documents/GitHub/ArielCCD.xml -transform /Users/davidboerner/Documents/GitHub/ccda-to-fhir/mappings/CCDAToFHIR.map -ig <a href=\"https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz\">https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz</a> -ig /Users/davidboerner/Documents/GitHub/ccda-to-fhir/mappings/ -output /Users/davidboerner/Documents/GitHub/ccda-to-fhir/output/ariel.json -version 4.0 -log test.txt</p>\n<p>and now getting the following error:</p>\n<ul>\n<li>.. load IG from <a href=\"https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz\">https://build.fhir.org/ig/HL7/cda-core-2.0/package.tgz</a><br>\n ...Failure: Type 'IVL_TS' is not an acceptable type for 'effectiveTime' on property SubstanceAdministration.effectiveTime<br>\norg.hl7.fhir.exceptions.DefinitionException: Type 'IVL_TS' is not an acceptable type for 'effectiveTime' on property SubstanceAdministration.effectiveTime</li>\n</ul>\n<p>Is this a problem with the CDA logical definition I'm trying to pull from?</p>",
        "id": 200667214,
        "sender_full_name": "David Boerner",
        "timestamp": 1591967099
    },
    {
        "content": "<p>I edited my inbound CCD a bit and was able to get past those validation errors, but looks like I'm choking on the transform bit.</p>\n<p>In general I'm wondering if anybody has a functional project that transforms a CCDA to FHIR bundle?</p>\n<p>Should I be using <a href=\"https://github.com/HL7/ccda-to-fhir\">https://github.com/HL7/ccda-to-fhir</a> or the validator within <a href=\"https://github.com/hapifhir/org.hl7.fhir.core#download\">https://github.com/hapifhir/org.hl7.fhir.core#download</a> ?</p>",
        "id": 200671797,
        "sender_full_name": "David Boerner",
        "timestamp": 1591969666
    },
    {
        "content": "<p>The CDA logical model currently defines IVL-TS as type and not IVL_TS, I assume the error comes from that. I made a <a href=\"https://github.com/HL7/cda-core-2.0/pull/43\">PR</a> to propose a solution since the FHIR Mapping Language cannot work currently with the - character.  You can try to use apply the map with the CDA Model containing the PR and use -ig <a href=\"http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/pullrequests/package.tgz\">http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/pullrequests/package.tgz</a></p>",
        "id": 200816650,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1592141288
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>  Hi, I am looking of logical models for CDA similar what is there at <a href=\"http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/pullrequests/package.tgz\">http://build.fhir.org/ig/ahdis/cda-core-2.0/branches/pullrequests/package.tgz</a> and not in R4 but STU3. Thanks!</p>",
        "id": 218304683,
        "sender_full_name": "Kailash",
        "timestamp": 1606751475
    },
    {
        "content": "<p>The logical model is here: <a href=\"https://github.com/hl7/cda-core-2.0\">https://github.com/hl7/cda-core-2.0</a>. Why do you need that in a STU3 version? The logical model itself is independent of the version, however it is described in conformance resources with R4, I don't think backporting to STU3 would be easy.</p>",
        "id": 218306206,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606752084
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> I was assuming its version dependent. Thanks you for the help.</p>",
        "id": 218371448,
        "sender_full_name": "Kailash",
        "timestamp": 1606787013
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"263322\">@Kailash</span> depending what you want to use the model for, the logical model conformance resource versions could have an impact.</p>",
        "id": 218387676,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606807836
    },
    {
        "content": "<p>I want to use logical model for ccd to FHIR mapping (transformation) for STU3</p>",
        "id": 218389081,
        "sender_full_name": "Kailash",
        "timestamp": 1606809244
    },
    {
        "content": "<p>i think that might work, but you would need to develop the maps to STU3 and find or configure an mapping engine that can directly run the maps.</p>",
        "id": 218393132,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606812220
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span>  thanks , I am still not clear if transformation possible directly using maps (mapping using FHIR mapping language) or I need to first $convert it into StructureMap resource and then use $transform for input data? If both case are possible then should I choose the approach based on server capabilities for supported operations?</p>",
        "id": 218404698,
        "sender_full_name": "Kailash",
        "timestamp": 1606819434
    },
    {
        "content": "<p>this depends on the tooling you use. the java validator can handle maps directly (converts it to StructureMap internally), if you use a server based setup you will need to provide the StructureMap and can then use the $transform operation, see also <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Mapping+Language</a></p>",
        "id": 218405637,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606820012
    },
    {
        "content": "<p>Thanks for the input this will help to choose both the tooling and approach.</p>",
        "id": 218413993,
        "sender_full_name": "Kailash",
        "timestamp": 1606825301
    },
    {
        "content": "<p>I am getting \"The Coding provided (<a href=\"http://terminology.hl7.org/CodeSystem/v3-Ethnicity#2135-2\">http://terminology.hl7.org/CodeSystem/v3-Ethnicity#2135-2</a>) is not in the value set <a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.114222.4.11.837\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.114222.4.11.837</a>, and a code is required from this value set. (error message = Not in value set <a href=\"http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.114222.4.11.837\">http://cts.nlm.nih.gov/fhir/ValueSet/2.16.840.1.114222.4.11.837</a>)\" on FHIR validation.<br>\nI am trying to use <a href=\"http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity\">http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity</a> extension in Patient resource.<br>\nKindly help me on resolving this issue.</p>",
        "id": 243000436,
        "sender_full_name": "Ilayaraja",
        "timestamp": 1623927087
    },
    {
        "content": "<p>You might be best raising this in <a class=\"stream\" data-stream-id=\"179190\" href=\"/#narrow/stream/179190-united-states\">#united states</a> or <a class=\"stream\" data-stream-id=\"291844\" href=\"/#narrow/stream/291844-FHIR-Validator\">#FHIR Validator</a> as it doesn't seem like a mapping issue</p>",
        "id": 243845135,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1624568046
    },
    {
        "content": "<p>I am using .Net <strong>Hl7.Fhir.Validation</strong> and in that I tried <strong>ExternalTerminologyService</strong> but it is getting failed with the following error,<br>\n\"Terminology service failed while validating code 'work' (system ''): Operation was unsuccessful because of a client error (NotFound). OperationOutcome: Overall result: FAILURE (1 errors and 0 warnings)<br>\n[ERROR] (no details)(further diagnostics: Endpoint returned a body with contentType 'text/html', while a valid FHIR xml/json body type was expected. Is this a FHIR endpoint?).\"</p>\n<p>I am using the following .Net code for the implementation,</p>\n<p>var validationSource = new CachedResolver(ZipSource.CreateValidationSource());<br>\nvar settings = new FhirClientSettings<br>\n{<br>\n    Timeout = 12000,<br>\n    PreferredFormat = ResourceFormat.Json,<br>\n    VerifyFhirVersion = true,<br>\n    PreferredReturn = Prefer.ReturnMinimal<br>\n};</p>\n<p>var client = new FhirClient(new Uri(\"<a href=\"http://tx.fhir.org\">http://tx.fhir.org</a>\"), settings);<br>\nvar valuesetExpanderSettings = new ValueSetExpanderSettings()<br>\n{<br>\n    ValueSetSource = validationSource,<br>\n    MaxExpansionSize = 500,<br>\n    IncludeDesignations = true<br>\n};</p>\n<p>var validationSettings = new ValidationSettings()<br>\n{<br>\n    //ConstraintBestPractices = ConstraintBestPractices.Enabled,<br>\n    //SkipConstraintValidation = false,<br>\n    ResourceResolver = validationSource,<br>\n    GenerateSnapshot = true,<br>\n    EnableXsdValidation = true,<br>\n    Trace = false,<br>\n    ResolveExternalReferences = true,<br>\n    TerminologyService = new LocalTerminologyService(validationSource, valuesetExpanderSettings)//new ExternalTerminologyService(client)<br>\n};<br>\nvar validator1 = new Validator(validationSettings);<br>\nvar validationResult = validator1.Validate(collection);<br>\nif (!validationResult.Success) { }</p>\n<p>Kindly help me on resolving this issue.</p>",
        "id": 245982614,
        "sender_full_name": "Ilayaraja",
        "timestamp": 1626279391
    },
    {
        "content": "<p>I think you need to do \"<a href=\"http://tx.fhir.org/r4\">http://tx.fhir.org/r4</a>\"</p>",
        "id": 245985170,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1626280647
    }
]