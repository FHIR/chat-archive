[
    {
        "content": "<p>In our FHIR Overview training course we use an example of an operation  called $merge-patient, defined as follows:<br>\nInput parameters: 2..* Patient resources, of which the initial ‘master’ resource will ‘survive’<br>\nOutput parameter: 1 Patient resource<br>\nWhen used, the server:<br>\nUpdates all references in resources of any kind to merged Patient resources to the ‘master’ Patient resource.<br>\nCauses a HTTP 302 Redirect to happen should any external party still use the URL of one of the merged Patient resources. </p>\n<p>As always examples need to be realistic (although they may omit some side details) - any suggestions how to improve the above operation and/or its description ?</p>",
        "id": 153980879,
        "sender_full_name": "René Spronk",
        "timestamp": 1533211226
    },
    {
        "content": "<p>A theoretical operation?<br>\nOr a starting point for the conversation to get the operation defined?</p>",
        "id": 153980880,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1533211294
    },
    {
        "content": "<p>Could be both, my starting point is to have a good example, as if it were a real one. I don't have an implementation use-case of my own which motivates me to bring this forward, although (in general) I think this is a good operation to have.</p>",
        "id": 153980881,
        "sender_full_name": "René Spronk",
        "timestamp": 1533211394
    },
    {
        "content": "<p>If you wanted a real operation, you could look at patient/$match :)</p>",
        "id": 153980885,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1533211974
    },
    {
        "content": "<p>Sure - but that one doesn't have any server-side impact on the data, it's just a fancy query mechanism. Whole point of an operation is that it does something which one can't really do using CRUDS, so the best examples will have to differ as much as possible with anything that reeks of pure CRUDS.</p>",
        "id": 153980894,
        "sender_full_name": "René Spronk",
        "timestamp": 1533212831
    },
    {
        "content": "<p>true, no problems. merge needs to be addressed at some point.</p>",
        "id": 153980895,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1533212872
    },
    {
        "content": "<p>(after R4 is out)</p>",
        "id": 153980896,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1533212879
    },
    {
        "content": "<p>After looking at the current definition, I changed it to:<br>\n$merge operation<br>\nEndpoint: [base]/Patient/[id] (‘master resource’)<br>\nInput parameters: 1..* references to other Patient resources, these will be merged with the master Patient resource<br>\nOutput parameter: OperationOutcome<br>\nOperation behavior: Updates all references in resources of any kind to merged Patient resources to the ‘master’ Patient resource; causes a HTTP 302 Redirect to happen should any external party still use the URL of one of the merged Patient resources.</p>",
        "id": 153980982,
        "sender_full_name": "René Spronk",
        "timestamp": 1533228126
    },
    {
        "content": "<p>the 302 redirect is.. problematic. It's been talked about and .. .epic?... have implemented it. But it's not an obvious thing to require for me.Maybe it's a good thing to prompt a discussion about the pro's and con's of the thing...</p>",
        "id": 153981407,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533262885
    },
    {
        "content": "<p>the other thing to say is that there's likely to be impacts of this operation on information that is not exposed to the REST interface</p>",
        "id": 153981408,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1533262918
    },
    {
        "content": "<p>The other thing I glossed over is the merging of Patient resources across servers (the federation aspect). Currently not in scope for the 80% anyways.</p>",
        "id": 153981522,
        "sender_full_name": "René Spronk",
        "timestamp": 1533279630
    },
    {
        "content": "<p>Going to breathe some life into this discussion by taking it over to the implementers chat, and wonder if folks are interested in trying an experimental track at the May connectathon? To try and get some discussion, ideas and implementation considerations.</p>",
        "id": 160254598,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1552007951
    },
    {
        "content": "<p>IHE have done some work on this that can be found here<br>\n<a href=\"https://github.com/IHE/IT-Infrastructure/tree/master/PRIM\" target=\"_blank\" title=\"https://github.com/IHE/IT-Infrastructure/tree/master/PRIM\">https://github.com/IHE/IT-Infrastructure/tree/master/PRIM</a></p>",
        "id": 164982160,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1557149978
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191764\">@Cooper Thompson</span> <span class=\"user-mention\" data-user-id=\"196845\">@Charles Ye</span> <span class=\"user-mention\" data-user-id=\"191357\">@Andrew Torres</span> Wanting to prepare a Patient Merge connectathon proposal for the Atlanta connectathon. Anyone have any suggestions on what they might like to test at this event?<br>\nWill really be an experimentation workshop to try out a few ideas with some POC code/thoughts<br>\nTalking about this in the PA conference call today.</p>",
        "id": 171071841,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1563365354
    },
    {
        "content": "<p>Connectathon Proposal page<br>\n<a href=\"https://confluence.hl7.org/pages/viewpage.action?pageId=55939896\" target=\"_blank\" title=\"https://confluence.hl7.org/pages/viewpage.action?pageId=55939896\">https://confluence.hl7.org/pages/viewpage.action?pageId=55939896</a></p>",
        "id": 171072845,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1563366260
    },
    {
        "content": "<p>I am out of town until July 22. I can work on some ideas after I come back to the office and produce a draft for the team discussion by the end of this month.   - Charles</p>",
        "id": 171075048,
        "sender_full_name": "Charles Ye",
        "timestamp": 1563368098
    },
    {
        "content": "<p>Thanks Charles, we updated the page today, and hope to see you on the PA call on 24th if that is practical for you. We have some folks from NZ that are implementing an EMPI that would like to join the call for some discussions on maintaining their EPMI through a FHIR API. <span class=\"user-mention\" data-user-id=\"191321\">@David Hay</span></p>",
        "id": 171112242,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1563393520
    },
    {
        "content": "<p>Hi Brian, I responded to the review notes (<a href=\"https://confluence.hl7.org/display/PA/2019-07-03+Conference+Call\" target=\"_blank\" title=\"https://confluence.hl7.org/display/PA/2019-07-03+Conference+Call\">https://confluence.hl7.org/display/PA/2019-07-03+Conference+Call</a>), refer to my post at <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-EMPI\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-EMPI\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-EMPI</a>.  I also had a draft writeup for the FHIR patient merge and link test cases, see <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases</a> and <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases</a>. We can discuss it today. Thanks, @Brian Postlethwaite</p>",
        "id": 172137378,
        "sender_full_name": "Charles Ye",
        "timestamp": 1564586827
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"196845\">@Charles Ye</span> , I missed this before the call, and we can continue it over the week and on next weeks call</p>",
        "id": 172163868,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1564605795
    },
    {
        "content": "<p>The work item in IHE has focused and evolved last week at the IHE face-to-face meeting. It is now focused only on a central \"master\" Patient identity manager for a distributed set of organizations. Where organizations will use a FHIR message to feed the manager with requests to Create a new patient (e.g. birth), update a patient (e.g. demographics correction), add a link to some other identifiers (e.g. local organization MRN), and to \"MERGE\" two 'master' patient records that have been confirmed as being the same patient. Thus we are using message handling relative to CRUD, and using the .link element to represent RelatedPerson and peer Patient identities.  We think the .link would be used to identify the merge, with the deprecated Patient also getting the status updated. So we think we only need CRUD operations. <br>\nWe did not get to a Implementation Guide that met our quality criteria, so it will be continued to be improved over the next three months. <br>\nThis implementation guide could be used at FHIR connectathon.</p>",
        "id": 172164868,
        "sender_full_name": "John Moehrke",
        "timestamp": 1564606493
    },
    {
        "content": "<p>Note <span class=\"user-mention\" data-user-id=\"193299\">@Luke Duncan</span> is the prime author of this IHE work.</p>",
        "id": 172164917,
        "sender_full_name": "John Moehrke",
        "timestamp": 1564606519
    },
    {
        "content": "<p>Where can we find it for reference?</p>",
        "id": 172165043,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1564606580
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span> - Are you using actual FHIR messages to do these changes? (Rather than RESTful Patient updates)? This is of particular interest in NZ at the moment...  <a href=\"#narrow/stream/179178-new-zealand/topic/Updating.20the.20NHI\" title=\"#narrow/stream/179178-new-zealand/topic/Updating.20the.20NHI\">https://chat.fhir.org/#narrow/stream/179178-new-zealand/topic/Updating.20the.20NHI</a></p>",
        "id": 172267904,
        "sender_full_name": "David Hay",
        "timestamp": 1564699236
    },
    {
        "content": "<p>Here is our github directory where the PRIM stuff is being developed. It is in IHE supplement form, we have not yet transitioned to using the HL7 IG publication tooling.. but are working on that... <a href=\"https://github.com/IHE/IT-Infrastructure/tree/master/PRIM\" target=\"_blank\" title=\"https://github.com/IHE/IT-Infrastructure/tree/master/PRIM\">https://github.com/IHE/IT-Infrastructure/tree/master/PRIM</a></p>",
        "id": 172314256,
        "sender_full_name": "John Moehrke",
        "timestamp": 1564757062
    },
    {
        "content": "<p>Yes, we are prototyping this as a FHIR \"message\". There is a rational at the beginning of the text. Mostly because the use-case for this kind of cooperation among participants in an HIE seemed best served by this.  And, as a message, one can just confirm the message header and then treat the rest as if it is a batch/transaction. So we get some benefit from the message header, and very little downside.</p>",
        "id": 172314416,
        "sender_full_name": "John Moehrke",
        "timestamp": 1564757187
    },
    {
        "content": "<p>There are two types of scenarios of link: 1) manual link; 2) auto-link. The underlying EMPI automatically handles the auto-link cases based on its configured match policy. The auto-link is done through “CRUD” operations.  But, the EMPI is not always able to solve the cases of link automatically; these cases require the manual link operation.</p>",
        "id": 172650908,
        "sender_full_name": "Charles Ye",
        "timestamp": 1565155144
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>  For your reference, I updated <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Test-Cases</a> and <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Operation-Request-and-Response\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Operation-Request-and-Response\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Merge-Operation-Request-and-Response</a>.   Thanks</p>",
        "id": 172789891,
        "sender_full_name": "Charles Ye",
        "timestamp": 1565288548
    },
    {
        "content": "<p>Also, I updated the link-patient operation for your reference:  <a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Test-Cases</a> and <br>\n<a href=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Operation-Request-and-Response\" target=\"_blank\" title=\"https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Operation-Request-and-Response\">https://github.com/fastrivertech/fhir-mpi/wiki/FHIR-Link-Operation-Request-and-Response</a></p>",
        "id": 172823900,
        "sender_full_name": "Charles Ye",
        "timestamp": 1565323969
    },
    {
        "content": "<p>The operation definition draft has been updated significantly based on today's meeting (and some more cleanup by me)<br>\n<a href=\"https://confluence.hl7.org/display/PA/Merge+Operation\" target=\"_blank\" title=\"https://confluence.hl7.org/display/PA/Merge+Operation\">https://confluence.hl7.org/display/PA/Merge+Operation</a><br>\n<span class=\"user-mention\" data-user-id=\"191764\">@Cooper Thompson</span> , <span class=\"user-mention\" data-user-id=\"196845\">@Charles Ye</span>, <span class=\"user-mention\" data-user-id=\"191404\">@John Moehrke</span>  can you please take a look and let me know what you think.</p>",
        "id": 173833286,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1566422759
    },
    {
        "content": "<p>Not sure if this should be on there as well, but don't we want to describe behaviors of gets on merged patients?</p>",
        "id": 173835213,
        "sender_full_name": "Drew Torres",
        "timestamp": 1566424327
    },
    {
        "content": "<p>And the implications for related clinical data?</p>",
        "id": 173835224,
        "sender_full_name": "Drew Torres",
        "timestamp": 1566424341
    },
    {
        "content": "<p>Absolutely! - in progress - come help <span aria-label=\"wink\" class=\"emoji emoji-1f609\" role=\"img\" title=\"wink\">:wink:</span></p>",
        "id": 173835234,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1566424360
    },
    {
        "content": "<p>This is all feeding into the connectathon track that is <a href=\"https://confluence.hl7.org/display/PA/Connectathon+Sept+2019+at+WGM+%28Atlanta%29+Patient+%24Merge\" target=\"_blank\" title=\"https://confluence.hl7.org/display/PA/Connectathon+Sept+2019+at+WGM+%28Atlanta%29+Patient+%24Merge\">https://confluence.hl7.org/display/PA/Connectathon+Sept+2019+at+WGM+%28Atlanta%29+Patient+%24Merge</a><br>\nand will include that stuff too</p>",
        "id": 173835276,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1566424434
    },
    {
        "content": "<p>I am trying.</p>",
        "id": 173836814,
        "sender_full_name": "Drew Torres",
        "timestamp": 1566425669
    },
    {
        "content": "<p>Hopefully my time frees up soon.</p>",
        "id": 173836819,
        "sender_full_name": "Drew Torres",
        "timestamp": 1566425677
    },
    {
        "content": "<p>1. “this does not perform on the actual resource instance e.g. [base]/Patient/01/$merge - question: should it?” <br>\n       To be simplified and consistent, I suggest not to give this option.</p>\n<p>2. “result-patient”<br>\n     The parameter shall explicitly state which patient identifier(s) are expected to be merged such as a source MRN merged to a target MRN. This minimum information seems mandatory for the operation.</p>\n<p>3. “result-patient”  :  This resource MUST have the link property included referencing the source patient resource” <br>\n      It seems more reasonable that this link property is not mandatory because the surviving patient resource has actual link property referring to the source patient resource.</p>\n<p>4. The operation has succeeded with an HTTP status code of 200 OK. An HTTP status code of 202 Accepted returns for the situation that the operation accepted but the resource has been merged and the operation does not introduce any change or update.  <br>\n5. Questions:<br>\nQuestion: Should support for a simple query parameter form of the operation be permitted? (using the form used in search url|value for identifiers, and the resource references will just include the reference value (no identifiers)<br>\n To be concise, I suggest not support this query.</p>\n<p>Question: How should privacy-related meta tags be handled? It shall conform the security labels of the metadata of the source resource and target resource.</p>\n<p>Question: Should a Task resource be included to track things that might take longer to process?<br>\n I suggest not. The $merge operation is synchronous and expects an instant outcome. If the server expires the operation if the operation runs longer than allowed.</p>\n<p>Question: Should we be explicit about how the identifiers from the source resource should be copied into the target resource (and if they should be marked with use=old)<br>\n marking with use = old shall be reasonable enough, and \"result-patient\" defines how identifiers merge.</p>\n<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span></p>",
        "id": 174317576,
        "sender_full_name": "Charles Ye",
        "timestamp": 1566947044
    },
    {
        "content": "<p>Thanks Charles, the reason this might take some time is if it is going to be updating all referenced resources with the new Id, then that could take some time for some patients records.</p>",
        "id": 174318120,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1566947619
    },
    {
        "content": "<p>We have walked into that part of the behaviour yet.</p>",
        "id": 174318137,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1566947641
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191357\">@Andrew Torres</span> are you going to be at the connectathon and want to participate in this track?</p>",
        "id": 174398206,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1567024053
    },
    {
        "content": "<p>Not this time around :( Have some conflicts that prevent me from traveling.</p>",
        "id": 174452052,
        "sender_full_name": "Drew Torres",
        "timestamp": 1567084294
    }
]