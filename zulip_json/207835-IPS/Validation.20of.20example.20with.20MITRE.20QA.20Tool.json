[
    {
        "content": "<p>The IHE Europe Connectathon started today, and one of our folks is validating an IPS document using: <a href=\"https://inferno-qa.healthit.gov/validator\">https://inferno-qa.healthit.gov/validator</a>. When he uploads the document and selects the right advanced options, he gets an error message at the top that I cannot decipher. Can anyone lend some guidance? Is it related to the slice issues that show up later on the page? <a href=\"/user_uploads/10155/NBVzOe2kgwWAlwpa01Yge3Vu/Screen-Shot-2021-06-14-at-7.24.51-AM.png\">Screen-Shot-2021-06-14-at-7.24.51-AM.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/NBVzOe2kgwWAlwpa01Yge3Vu/Screen-Shot-2021-06-14-at-7.24.51-AM.png\" title=\"Screen-Shot-2021-06-14-at-7.24.51-AM.png\"><img src=\"/user_uploads/10155/NBVzOe2kgwWAlwpa01Yge3Vu/Screen-Shot-2021-06-14-at-7.24.51-AM.png\"></a></div>",
        "id": 242588637,
        "sender_full_name": "Stephen Moore",
        "timestamp": 1623673687
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194738\">@Stephen Moore</span>  Do we know which validator version is being used (I'm not sure if this issue is version-specific, but it's always good to know as it changes frequently - and hopefully it's the latest version)?  You could be right that this has some relation to the slicing issues.  But the actual error claims that there is no Composition resource (specifically Composition-uv-ips) in the Bundle, and the validator should be able to determine compliance with the Composition-uv-ips profile without having to rely on the slicing (which all should be open).</p>",
        "id": 242591745,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623675320
    },
    {
        "content": "<p>The first entry in the Bundle must contain a Composition resource. Is that the case with the bundle being verified?</p>",
        "id": 242593736,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1623676183
    },
    {
        "content": "<p>My assumption was that at least there was a Composition resource as the first bundle entry (it would be a pretty fundamental error if there wasn't), and that the validator for some reason wasn't recognizing it as an instance conforming to the Composition-uv-ips profile.  But that may not be right, because in the published IPS IG, which the IHE profile is based on, we didn't actually profile Bundle and require that the Composition instance conform to Composition-uv-ips.  We'll be changing that in the upcoming IPS STU update.  And maybe the IHE profile already made that constraint (I'll have to check)?</p>",
        "id": 242596006,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623677143
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> inferno-qa is using <code>org.hl7.fhir.validator</code> version <code>5.3.14</code>. Sorry that's not more intuitive in the UI, we're working on making it more useful.</p>",
        "id": 242596335,
        "sender_full_name": "Michael O'Keefe",
        "timestamp": 1623677281
    },
    {
        "content": "<p>I had in the past similar errors - like missing required entry even if that entry was there - each time the validator was not able to check the conformance with an IPS profile (typically due to unrecognized codeable concepts)</p>",
        "id": 242597275,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1623677666
    },
    {
        "content": "<p>This is common issue when validating a Bundle resource using FHIR vaidator jar (which the Inferno validate service internally use). What error message actually says is that the Composition entry in the Bundle is not a valid IPS Composition instance. But the validator does not give details about the errors in Composition resource</p>",
        "id": 242597546,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1623677785
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191647\">@Michael O'Keefe</span>.  So it looks like the validator version in Inferno is a little bit behind, as the latest version as of now is:</p>\n<div class=\"codehilite\"><pre><span></span><code>FHIR Validation tool Version 5.4.3 (Git# eb2d0a499a0c). Built 2021-06-05T01:17:28.684Z (9 days old)\n</code></pre></div>\n<p>I think that's pretty understandable, as it would be very difficult to keep up immediately with all of the changes.  I'm not sure that this difference in validator versions would have any effect on the error that is being seen (that seems unlikely, although I suppose it could).</p>",
        "id": 242597566,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623677797
    },
    {
        "content": "<p>and looking to the information message it  says that the bundle.entry[0] (the composition) doesn't match with any known slice</p>",
        "id": 242597577,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1623677799
    },
    {
        "content": "<p>Back to my point, though.  If this is being validated against the 1.0.0 published version of the FHIR IPS IG, we don't have an IPS profile on Bundle that would cause this error.  The error would be at the base standard level, which only requires that the first entry be a Composition resource (as Vassil said).  If the validation is being done from the IPS <code>connectathon</code> branch, that would be a different situation - in that case the Composition must be a Composition-uv-ips instance.</p>",
        "id": 242598278,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623678111
    },
    {
        "content": "<p>this is true ..but other similar errors at the section.entry level can be in any case experienced :-( <br>\n(but I've never tried with the very last validator version...)</p>",
        "id": 242598644,
        "sender_full_name": "Giorgio Cangioli",
        "timestamp": 1623678251
    },
    {
        "content": "<p>You are certainly right about the errors on Composition.section.entry, Giorgio.  But this particular error is on Bundle.entry.</p>",
        "id": 242598817,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623678346
    },
    {
        "content": "<p>I guess maybe the validator is doing some extrapolation (that I hadn't really thought about particularly before).  The IG declares that any Composition resource instance must conform to the Composition-uv-ips profile.  And since this Composition instance apparently doesn't conform to the IPS profile (or at least the validator doesn't think so, based on the slicing issues), then this Composition instance also can't be used to satisfy the Bundle requirement that the first entry must be a Composition resource (even though the instance itself is actually a valid Composition).  Hopefully that explanation is clear enough (if it isn't I can try to clarify it further).  If that is how the validator is behaving, I don't know if we've actually documented that anywhere as the correct and expected behavior?</p>",
        "id": 242600952,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623679308
    },
    {
        "content": "<p>If we want to get into this any further we may want to move the discussion to the <a href=\"#narrow/stream/179177-conformance\">conformance</a> stream.</p>",
        "id": 242601743,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623679592
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/V9VIwTPHO3l35zHeYFppBJBG/IPS-132_updated.json\">IPS-132_updated.json</a></p>",
        "id": 242607123,
        "sender_full_name": "Stephen Moore",
        "timestamp": 1623681667
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> I was thinking along those same lines, but am not savvy enough to know if the example I just posted matches that assumption.</p>",
        "id": 242607224,
        "sender_full_name": "Stephen Moore",
        "timestamp": 1623681715
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194738\">@Stephen Moore</span> I took a look of the Bundle resource you posted. The actual problem is that IPS Composition has three mandatory sections: Medications, Allergies, and Problems (<a href=\"http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/StructureDefinition-Composition-uv-ips.html\">http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/StructureDefinition-Composition-uv-ips.html</a>) The example you posted does not have sectionAllergies</p>",
        "id": 242625853,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1623688886
    },
    {
        "content": "<blockquote>\n<p>This is common issue when validating a Bundle resource using FHIR vaidator jar (which the Inferno validate service internally use). What error message actually says is that the Composition entry in the Bundle is not a valid IPS Composition instance. But the validator does not give details about the errors in Composition resource</p>\n</blockquote>\n<p>I don't understand this</p>",
        "id": 242627667,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623689661
    },
    {
        "content": "<blockquote>\n<p>I guess maybe the validator is doing some extrapolation (that I hadn't really thought about particularly before). The IG declares that any Composition resource instance must conform to the Composition-uv-ips profile. And since this Composition instance apparently doesn't conform to the IPS profile (or at least the validator doesn't think so, based on the slicing issues), then this Composition instance also can't be used to satisfy the Bundle requirement that the first entry must be a Composition resource (even though the instance itself is actually a valid Composition).</p>\n</blockquote>\n<p>No, it doesn't work like that</p>",
        "id": 242627709,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623689685
    },
    {
        "content": "<p>Fair enough.  I didn't think it worked that way, either.  But I was trying to figure out a reason for the behavior that was described.  I should have looked at the validation output more closely, though.  Because when I do that again now I can see that Inferno is validating the Bundle against the Bundle-uv-ips profile, which doesn't exist in the published 1.0.0 version of the IG.  As long as we understand that the validation is being done against the <code>connectathon</code> branch (presumably - or possibly the CI build?) then the behavior makes sense.</p>",
        "id": 242628556,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623690075
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> See the reply I put above</p>\n<blockquote>\n<p>The actual problem is that IPS Composition has three mandatory sections: Medications, Allergies, and Problems (<a href=\"http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/StructureDefinition-Composition-uv-ips.html\">http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/StructureDefinition-Composition-uv-ips.html</a>) The example you posted does not have sectionAllergies</p>\n</blockquote>\n<p>The error message from the validator </p>\n<blockquote>\n<p>Error @ Bundle (line 1, col2) : Bundle.entry:composition: minimum required = 1, but only found 0 (from <a href=\"http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips\">http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips</a>)</p>\n</blockquote>\n<p>is correct that Composition entry in Bundle is not a valid IPS Composition but it does not give the details that the Composition is missing a required section. So the tester has to manually inspect the entry to find where the error is.</p>",
        "id": 242631363,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1623691305
    },
    {
        "content": "<p>what's an example I can try this with?</p>",
        "id": 242631641,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623691435
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191506\">@Yunwei Wang</span>  Yes, the missing Allergies section certainly would cause the validation error.</p>",
        "id": 242632242,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623691660
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  You can use the example that Stephen posted above.</p>",
        "id": 242632248,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623691663
    },
    {
        "content": "<p>This has been extremely helpful to me. As I mentioned, I was not savvy enough to notice that the composition was missing the AllergyIntolerance data when I inspected by hand. I can go back to the person who gave me the sample and ask for an updated version.</p>",
        "id": 242639288,
        "sender_full_name": "Stephen Moore",
        "timestamp": 1623694839
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> this is confusing. Where is <a href=\"http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips\">http://hl7.org/fhir/uv/ips/StructureDefinition/Bundle-uv-ips</a> found?</p>",
        "id": 242650787,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623700426
    },
    {
        "content": "<p>Here: <a href=\"http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/profiles.html\">http://build.fhir.org/ig/HL7/fhir-ips/branches/connectathon/profiles.html</a></p>",
        "id": 242651875,
        "sender_full_name": "Yunwei Wang",
        "timestamp": 1623700965
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  Yes, it probably is a bit confusing.  MITRE began working with our updates for the Connectathon in the <a href=\"https://github.com/HL7/fhir-ips/tree/connectathon\">connectathon</a> branch.  That's where you will find Bundle-uv-ips.  I wasn't really expecting that the 'connectathon' branch was going to be used in the IHE Connectathon this week, but it probably is OK (and likely good) that it is, as long as everyone understands that.</p>",
        "id": 242651908,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1623700981
    },
    {
        "content": "<p>well, this is something the validator doesn't support - validating against branches of a spec</p>",
        "id": 242652172,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623701108
    },
    {
        "content": "<p>not sure what Mitre to do make it happen</p>",
        "id": 242652203,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623701118
    },
    {
        "content": "<p>guess the provide the bundle profile directly</p>",
        "id": 242653157,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623701574
    },
    {
        "content": "<p>so, unfortunately, this is not particularly easy to solve. The validator knows what a particular resource fails to meet the definition of a slice. What it can't know is whether you expected it to or not. </p>\n<p>So I can report either none of that information, or a huge dump of information that is overwhelming, with poor signal to noise ratio. </p>\n<p>There's a somewhat obtuse parameter named crumb-trails that does that, and from the next release, it will publish more information. Also, there will be an alias for the parameter -verbose</p>",
        "id": 242662952,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1623706977
    }
]