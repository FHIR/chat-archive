[
    {
        "content": "<p>Hi,</p>\n<p>I'm looking at <code>MolecularSequence</code> composite search parameters i.e. <code>referenceseqid-coordinate</code> and <code>chromosome-coordinate</code>. Taking an example for <code>chromosome-coordinate</code> (excerpt only):</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;code value=&quot;chromosome-coordinate&quot;/&gt;\n        &lt;base value=&quot;MolecularSequence&quot;/&gt;\n        &lt;type value=&quot;composite&quot;/&gt;\n        &lt;expression value=&quot;MolecularSequence&quot;/&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome&quot;/&gt;\n          &lt;expression value=&quot;referenceSeq.chromosome&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-start&quot;/&gt;\n          &lt;expression value=&quot;variant.start&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-end&quot;/&gt;\n          &lt;expression value=&quot;variant.end&quot;/&gt;\n        &lt;/component&gt;\n</pre></div>\n\n\n<p>Since <code>MolecularSequence.variant</code>'s cardinality allows it to appear more than once in the resource, I would think the aforementioned search parameter will allow the following search <code>[baseurl]/MolecularSequence?chromosome-coordinate=X$0$3</code> to match the resource below:</p>\n<div class=\"codehilite\"><pre><span></span>MolecularSequence:\n  referenceSeq:\n    chromosome:\n      system: whatever-system\n      code: X\n  variant:\n    start: 0\n    end: 1\n  variant:\n    start: 2\n    end: 3\n</pre></div>\n\n\n<p>i.e. start:0 is in the first <code>variant</code> property while end:3 is in the second <code>variant</code> property.</p>\n<p>Is that the expected behavior or is my understanding of composite search parameters incorrect?</p>",
        "id": 154018715,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1542270684
    },
    {
        "content": "<p>My assumption for this search parameter is that it would not match the resource above but would match this one instead (i.e. start:0 and end:3 are within the same variant property):</p>\n<div class=\"codehilite\"><pre><span></span>MolecularSequence:\n  referenceSeq:\n    chromosome:\n      system: whatever-system\n      code: X\n  variant:\n    start: 0\n    end: 3\n  variant:\n    start: 5\n    end: 6\n</pre></div>",
        "id": 154018718,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1542271253
    },
    {
        "content": "<p>I agree with your assessment.  You can do range searches on start/end if needed.</p>",
        "id": 154018863,
        "sender_full_name": "Kevin Power",
        "timestamp": 1542294936
    },
    {
        "content": "<p>Sorry I'm still confused. What's the expected behavior of this search parameter? Is it expected to match the first example or the second one?</p>\n<p>If the second example, then I would think the search parameter definition needs to be changed to:</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;code value=&quot;chromosome-coordinate&quot;/&gt;\n        &lt;base value=&quot;MolecularSequence&quot;/&gt;\n        &lt;type value=&quot;composite&quot;/&gt;\n        &lt;expression value=&quot;MolecularSequence.variant&quot;/&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome&quot;/&gt;\n          &lt;expression value=&quot;%resource.referenceSeq.chromosome&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-start&quot;/&gt;\n          &lt;expression value=&quot;start&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-end&quot;/&gt;\n          &lt;expression value=&quot;end&quot;/&gt;\n        &lt;/component&gt;\n</pre></div>\n\n\n<p>i.e. which is what this definition was in STU3.</p>",
        "id": 154019025,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1542335831
    },
    {
        "content": "<p>When I said I agree with your assessment, the intention is to match when a variant instance matches both the start and end criteria. I do remember that when I was adding the second composite search param, I was getting some build issues. I need to do some research into how to structure this search param.</p>",
        "id": 154019026,
        "sender_full_name": "Kevin Power",
        "timestamp": 1542337548
    },
    {
        "content": "<p>I have created a pull request with a fix, and have asked if it is possible to get the fix merged in.  While looking at the fix, I have made some additional changes as well. <br>\nSee the pull request <a href=\"https://github.com/HL7/fhir/pull/286\" target=\"_blank\" title=\"https://github.com/HL7/fhir/pull/286\">286</a><br>\nI created some new search params, and tried to make it clear how to search for sequences for given \"windows\", and also for sequences with variants at given locations.  I welcome comments/questions/concerns.<br>\n<span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> <span class=\"user-mention\" data-user-id=\"196553\">@James Jones</span> <span class=\"user-mention\" data-user-id=\"191916\">@ Bob Milius</span> <span class=\"user-mention\" data-user-id=\"191719\">@Gil Alterovitz</span> <span class=\"user-mention\" data-user-id=\"193952\">@Michael Calderero</span></p>",
        "id": 154019301,
        "sender_full_name": "Kevin Power",
        "timestamp": 1542407691
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span> The changes look right and good to me from how I understand the composite searches <span class=\"emoji emoji-1f44d\" title=\"thumbs up\">:thumbs_up:</span></p>",
        "id": 154019802,
        "sender_full_name": "Jamie Jones",
        "timestamp": 1542725860
    },
    {
        "content": "<p>Many thanks <span class=\"user-mention\" data-user-id=\"196553\">@James Jones</span></p>",
        "id": 154019803,
        "sender_full_name": "Kevin Power",
        "timestamp": 1542725895
    },
    {
        "content": "<p>looks good to me as well. I'm currently trying to get the Resources into hapi to be able to test it</p>",
        "id": 154019805,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1542726086
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> - Keep us updated on your progress with HAPI.</p>",
        "id": 154019810,
        "sender_full_name": "Kevin Power",
        "timestamp": 1542727136
    },
    {
        "content": "<p>FYI - Grahame merged the MolecularSequence search param changes. If anyone reviews the changes and has questions please respond here. <span class=\"user-mention\" data-user-id=\"193952\">@Michael Calderero</span></p>",
        "id": 154020831,
        "sender_full_name": "Kevin Power",
        "timestamp": 1543235921
    },
    {
        "content": "<p>I checked the updated definitions from <a href=\"http://build.fhir.org\" target=\"_blank\" title=\"http://build.fhir.org\">build.fhir.org</a> and I see the following:</p>\n<p>1. <a href=\"http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome-window-coordinate\" target=\"_blank\" title=\"http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome-window-coordinate\">http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome-window-coordinate</a> composite</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;expression value=&quot;MolecularSequence.referenceSeq&quot;/&gt;\n        &lt;xpathUsage value=&quot;normal&quot;/&gt;\n        &lt;multipleOr value=&quot;false&quot;/&gt;\n        &lt;multipleAnd value=&quot;true&quot;/&gt;\n        &lt;modifier value=&quot;missing&quot;/&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-chromosome&quot;/&gt;\n          &lt;expression value=&quot;chromosome&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-window-start&quot;/&gt;\n          &lt;expression value=&quot;start&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-window-end&quot;/&gt;\n          &lt;expression value=&quot;end&quot;/&gt;\n        &lt;/component&gt;\n</pre></div>\n\n\n<p>but MolecularSequence.referenceSeq doesn't have <code>start</code> and <code>end</code> properties. Perhaps the <code>windowStart</code> and <code>windowEnd</code> should have been used instead?</p>\n<p>2. <a href=\"http://hl7.org/fhir/SearchParameter/MolecularSequence-referenceseqid-window-coordinate\" target=\"_blank\" title=\"http://hl7.org/fhir/SearchParameter/MolecularSequence-referenceseqid-window-coordinate\">http://hl7.org/fhir/SearchParameter/MolecularSequence-referenceseqid-window-coordinate</a></p>\n<div class=\"codehilite\"><pre><span></span>        &lt;expression value=&quot;MolecularSequence.referenceSeq&quot;/&gt;\n        &lt;xpathUsage value=&quot;normal&quot;/&gt;\n        &lt;multipleOr value=&quot;false&quot;/&gt;\n        &lt;multipleAnd value=&quot;true&quot;/&gt;\n        &lt;modifier value=&quot;missing&quot;/&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-referenceseqid&quot;/&gt;\n          &lt;expression value=&quot;referenceSeqId&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-window-start&quot;/&gt;\n          &lt;expression value=&quot;start&quot;/&gt;\n        &lt;/component&gt;\n        &lt;component&gt;\n          &lt;definition value=&quot;http://hl7.org/fhir/SearchParameter/MolecularSequence-window-end&quot;/&gt;\n          &lt;expression value=&quot;end&quot;/&gt;\n        &lt;/component&gt;\n</pre></div>\n\n\n<p>Same as number 1 (i.e. I think <code>windowStart</code> and <code>windowEnd</code> should have been used instead).</p>\n<p><span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span></p>",
        "id": 154020987,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1543300975
    },
    {
        "content": "<p>You are right, both should use window start and end. Let me take a look later today.</p>",
        "id": 154021049,
        "sender_full_name": "Kevin Power",
        "timestamp": 1543322714
    },
    {
        "content": "<p><a href=\"https://github.com/HL7/fhir/pull/306\" target=\"_blank\" title=\"https://github.com/HL7/fhir/pull/306\">https://github.com/HL7/fhir/pull/306</a></p>",
        "id": 154021126,
        "sender_full_name": "Kevin Power",
        "timestamp": 1543344154
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191913\">@Kevin Power</span>  the update looks fine to me now. Thank you.</p>",
        "id": 154021156,
        "sender_full_name": "Michael Calderero",
        "timestamp": 1543353017
    },
    {
        "content": "<p>Great, thanks.  Sorry for taking an extra step on it - I missed the issue.</p>",
        "id": 154021158,
        "sender_full_name": "Kevin Power",
        "timestamp": 1543353293
    }
]