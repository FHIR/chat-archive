[
    {
        "content": "<p>Hi,</p>\n<p>I am validating below resource on HAPI FHIR JPA server:<br>\n{<br>\n  \"resourceType\": \"Observation\",<br>\n  \"id\": \"16012\",<br>\n  \"meta\": {<br>\n    \"versionId\": \"1\",<br>\n    \"lastUpdated\": \"2019-12-03T10:07:06.000-06:00\",<br>\n    \"profile\": [<br>\n      \"<a href=\"http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/medication-metabolism\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/medication-metabolism\">http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/medication-metabolism</a>\"<br>\n    ]<br>\n  },<br>\n  ...<br>\n  ...<br>\n  \"component\": [<br>\n    {<br>\n      \"extension\": [<br>\n        {<br>\n          \"url\": \"<a href=\"http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/RelatedArtifact\" target=\"_blank\" title=\"http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/RelatedArtifact\">http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/RelatedArtifact</a>\",<br>\n          \"valueRelatedArtifact\": {<br>\n            \"type\": \"justification\",<br>\n            \"url\": \"...\"<br>\n          }<br>\n        }<br>\n      ],<br>\n      \"code\": {<br>\n        \"coding\": [<br>\n          {<br>\n            \"system\": \"<a href=\"http://loinc.org\" target=\"_blank\" title=\"http://loinc.org\">http://loinc.org</a>\",<br>\n            \"code\": \"...\",<br>\n            \"display\": \"...\"<br>\n          }<br>\n        ]<br>\n      },<br>\n      \"valueCodeableConcept\": {<br>\n        \"coding\": [<br>\n          {<br>\n            \"system\": \"<a href=\"http://ncimeta.nci.nih.gov\" target=\"_blank\" title=\"http://ncimeta.nci.nih.gov\">http://ncimeta.nci.nih.gov</a>\",<br>\n            \"code\": \"...\",<br>\n            \"display\": \"...\"<br>\n          }<br>\n        ]<br>\n      }<br>\n    }<br>\n  ]<br>\n}</p>\n<p>I got below error:<br>\n{<br>\n      \"severity\": \"error\",<br>\n      \"code\": \"processing\",<br>\n      \"diagnostics\": \"Problem with use of resolve() - profile '[CanonicalType[http://hl7.org/fhir/uv/genomics-reporting/StructureDefinition/RelatedArtifact]]' on Observation.extension:RelatedArtifact could not be resolved\",<br>\n      \"location\": [<br>\n        \"Parameters.parameter[0].resource.extension[0]\"<br>\n      ]<br>\n}</p>\n<p>Any help will be appreciated. Thanks in advance.</p>\n<p>Fei</p>",
        "id": 182688399,
        "sender_full_name": "Fei Yan",
        "timestamp": 1575570720
    },
    {
        "content": "<p>Hi Fei,<br>\nIt looks like you are attempting to attach a relatedArtifact as an extension on Observation.component. RelatedArtifact using its current structure definition is defined as an extension in the context of base Observations and DiagnosticReports, not within components. I would first try moving the relatedArtifiact out of the component and confirm you do not see the error.</p>\n<p>Observation in particular can have multiple relatedArtifact extensions at the top level, and it is an open topic for this group to determine how best to link them to applicable components. It has been suggested by <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> to add internal reference ids to the components and refer to them from the relatedArtifact, but I do not see our current extension being able to support this computationally</p>",
        "id": 182694334,
        "sender_full_name": "Jamie Jones",
        "timestamp": 1575574207
    },
    {
        "content": "<p>As I see it with the extension we provided, you could mention the internal id of the component in <a href=\"http://hl7.org/fhir/metadatatypes-definitions.html#RelatedArtifact.label\" target=\"_blank\" title=\"http://hl7.org/fhir/metadatatypes-definitions.html#RelatedArtifact.label\">relatedArtifact.label</a>, which is \"A short label that can be used to reference the citation from elsewhere in the containing artifact, such as a footnote index.\"</p>",
        "id": 182694482,
        "sender_full_name": "Jamie Jones",
        "timestamp": 1575574294
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"196553\">@Jamie Jones</span> Thanks for your quick response!</p>",
        "id": 182697484,
        "sender_full_name": "Fei Yan",
        "timestamp": 1575575916
    },
    {
        "content": "<p>I <em>think</em> you could do it like this: <code>[base]/Observation/57#123</code> where 57 is the Observation and 123 is the id on the component you're referring to.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, is that a legal thing to do in a Reference?</p>",
        "id": 182716739,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575589945
    },
    {
        "content": "<p>yes</p>",
        "id": 182717076,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575590390
    },
    {
        "content": "<p>oh no hangon</p>",
        "id": 182717082,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575590399
    },
    {
        "content": "<p>only to contained resources</p>",
        "id": 182717122,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575590403
    },
    {
        "content": "<p>no, where is it from? If it's a Reference(X) then you can't since the target isn't an X</p>",
        "id": 182717166,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575590438
    },
    {
        "content": "<p>Then I guess we'd need an extension on the extension to indicate the specific component.</p>\n<p>Why are we wanting to point to a component?</p>",
        "id": 182726783,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575602564
    },
    {
        "content": "<p>I think this is what triggered it: <a href=\"#narrow/stream/189875-genomics-.2F.20eMerge.20Pilot/topic/relatedArtifact.20extension.20change.20request\" title=\"#narrow/stream/189875-genomics-.2F.20eMerge.20Pilot/topic/relatedArtifact.20extension.20change.20request\">https://chat.fhir.org/#narrow/stream/189875-genomics-.2F.20eMerge.20Pilot/topic/relatedArtifact.20extension.20change.20request</a></p>",
        "id": 182765326,
        "sender_full_name": "Kevin Power",
        "timestamp": 1575642651
    },
    {
        "content": "<p>And on a call, I think you made the suggestion to not add RA to Observation.component[] but rather keep RA on Observation and do something to reference</p>",
        "id": 182765414,
        "sender_full_name": "Kevin Power",
        "timestamp": 1575642717
    },
    {
        "content": "<p>Ok, as I look at the original use-case, I'm wondering if the problem is that we're using Component inappropriately.  If we want to say \"no significant impact for this variant and med\", the statement should be with respect to a single med, not to a whole collection of them.  If you evaluate 50 medications, that should actually be 50 Observations because it's actually 50 distinct statements.  If you determine that one of the assessments was in error, that shouldn't affect the others.  And if you do things that way, there's no need to point to a component.  (In reality you wouldn't be pointing to the component anyhow, you'd be pointing to the overall statement, but wanting to filter to the sub-assertion relevant to that medication.)</p>",
        "id": 182783526,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1575653267
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> -- Would you mind posting  your thoughts on the referenced thread since we have moved beyond just this particular validation issue.</p>",
        "id": 182790869,
        "sender_full_name": "Kevin Power",
        "timestamp": 1575658054
    }
]