[
    {
        "content": "<p>In the US Core Condition profile, the element <code>category</code> has a binding on a value set that includes codes from the system <code>http://hl7.org/fhir/us/core/CodeSystem/condition-category</code>. It resolves fine as a URL, but when using a code from this system in an example (see e.g. <a href=\"http://hl7.org/fhir/us/core/Condition-hc1.json\">this example from the US Core IG</a>), the validator throws the following error:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>Error @ Condition.category<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span>.coding<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span> <span class=\"o\">(</span>line <span class=\"m\">30</span>, col21<span class=\"o\">)</span> : Unknown Code System <span class=\"s1\">'http://hl7.org/fhir/us/core/CodeSystem/condition-category'</span>\n</code></pre></div>\n<p>Apparently, the validator expects to know this (HL7 domain), but doesn't. I seem to remember similar issue have been discussed previously, (didn't find the right thread, though) - is a fix in the making (in the IG or validator) or is there some way to side-step this problem?</p>",
        "id": 237282043,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1620114584
    },
    {
        "content": "<p>how did you run this? Show the full validator output please</p>",
        "id": 237435442,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1620185272
    },
    {
        "content": "<p>(it's not a problem for me)</p>",
        "id": 237435585,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1620185413
    },
    {
        "content": "<p>I run the following command with the latest validator (<em>test.json</em> contains <a href=\"user_uploads/10155/mVzys7ARBLtNLfaS7wbJpQwX/test.json\">the example from US Core I linked above</a> )</p>\n<div class=\"codehilite\"><pre><span></span><code>java -jar validator/validator_cli.jar -version 4.0.1 test.json\n</code></pre></div>\n<p>I find that I always get an error, but that the nature of the error depends on whether I remove the <code>meta.profile</code> element pointing to the US Core profile. The \"Unknown Code System\" error occurs when no profile is declared.</p>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Error message when meta.profile declares profile --&gt; No code provided error</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>FHIR Validation tool Version 5.3.11 (Git# 33fffe28ff6b). Built 2021-04-22T05:48:36.375Z (13 days old)<br>\n  Java:   1.8.0_222 from /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available<br>\n  Paths:  Current = [redacted], Package Cache = [redacted]/.fhir/packages<br>\n  Params: -version 4.0.1 test.json<br>\nLoading<br>\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1Creating Package manager?<br>\n - 4575 resources (00:04.0116)<br>\n  Load hl7.terminology#2.0.0 - 3749 resources (00:01.0174)<br>\n  Terminology server <a href=\"http://tx.fhir.org\">http://tx.fhir.org</a> - Version 1.9.372 (00:02.0333)<br>\n  Get set...  go (00:00.0049)<br>\nValidating<br>\n  Validate test.json  Load us.nlm.vsac#0.3.0 - 8916 resources (00:01.0352)<br>\n  Load hl7.fhir.us.core#3.2.0 - 142 resources (00:00.0021)<br>\n 00:00.0564<br>\nDone. Times: Loading: 00:07.0866, validation: 00:01.0938. Memory = 339Mb</p>\n<p><em>FAILURE</em>: 1 errors, 1 warnings, 0 notes<br>\n  Error @ Condition.code (line 39, col6) : No code provided, and a code is required from the value set <a href=\"http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code\">http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code</a> (<a href=\"http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code\">http://hl7.org/fhir/us/core/ValueSet/us-core-condition-code</a>)<br>\n  Warning @ Condition.category[0] (line 29, col19) : None of the codings provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a> (<a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a>), and a coding should come from this value set unless it has no suitable code (note that the validator cannot judge what is suitable) (codes = <a href=\"http://hl7.org/fhir/us/core/CodeSystem/condition-category#health-concern\">http://hl7.org/fhir/us/core/CodeSystem/condition-category#health-concern</a>)</p>\n</div></div>\n<div class=\"spoiler-block\"><div class=\"spoiler-header\">\n<p>Error message when meta.profile is removed --&gt; Unknown Code System error</p>\n</div><div class=\"spoiler-content\" aria-hidden=\"true\">\n<p>FHIR Validation tool Version 5.3.11 (Git# 33fffe28ff6b). Built 2021-04-22T05:48:36.375Z (13 days old)<br>\n  Java:   1.8.0_222 from /Library/Java/JavaVirtualMachines/adoptopenjdk-8.jdk/Contents/Home/jre on x86_64 (64bit). 3641MB available<br>\n  Paths:  Current =[redacted], Package Cache ==[redacted]/.fhir/packages<br>\n  Params: -version 4.0.1 test.json<br>\nLoading<br>\n  Load FHIR v4.0 from hl7.fhir.r4.core#4.0.1Creating Package manager?<br>\n - 4575 resources (00:04.0693)<br>\n  Load hl7.terminology#2.0.0 - 3749 resources (00:01.0235)<br>\n  Terminology server <a href=\"http://tx.fhir.org\">http://tx.fhir.org</a> - Version 1.9.372 (00:02.0227)<br>\n  Get set...  go (00:00.0057)<br>\nValidating<br>\n  Validate test.json  Load us.nlm.vsac#0.3.0 - 8916 resources (00:01.0808)<br>\n  Load hl7.fhir.us.core#3.2.0 - 142 resources (00:00.0048)<br>\n 00:00.0513<br>\nDone. Times: Loading: 00:08.0413, validation: 00:02.0371. Memory = 424Mb</p>\n<p><em>FAILURE</em>: 1 errors, 1 warnings, 0 notes<br>\n  Error @ Condition.category[0].coding[0] (line 25, col21) : Unknown Code System '<a href=\"http://hl7.org/fhir/us/core/CodeSystem/condition-category\">http://hl7.org/fhir/us/core/CodeSystem/condition-category</a>'<br>\n  Warning @ Condition.category[0] (line 24, col19) : None of the codings provided are in the value set <a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a> (<a href=\"http://hl7.org/fhir/ValueSet/condition-category\">http://hl7.org/fhir/ValueSet/condition-category</a>), and a coding should come from this value set unless it has no suitable code (note that the validator cannot judge what is suitable) (codes = <a href=\"http://hl7.org/fhir/us/core/CodeSystem/condition-category#health-concern\">http://hl7.org/fhir/us/core/CodeSystem/condition-category#health-concern</a>)</p>\n</div></div>\n<p>If I explicitly load the US Core IG using <code>-ig hl7.fhir.us.core#3.2.0</code>, I still get an error when the profile is declared (\"No code provided, and a code is required from the value set\"). If I remove <code>meta.profile</code>, I only get a warning (\"None of the codings provided are in the value set\").</p>",
        "id": 237448712,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1620197576
    },
    {
        "content": "<blockquote>\n<p>No code provided, and a code is required from the value set</p>\n</blockquote>\n<p>is a warning, as it should be. The other: I missed implicitly loading the US Core package when a code system is found (as opposed to a profile). This will be fixed in the next release</p>",
        "id": 237609702,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1620280953
    },
    {
        "content": "<p>Thanks, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>!</p>",
        "id": 237612117,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1620282965
    }
]