[
    {
        "content": "<p>Hi,<br>\nI am trying to understand the vision of query evaluation as laid out in the CQL Specification, specifically 5.3.4 Implementing Query Evaluation. Hopefully understanding this vision will help me understand the most complex aspects of the language.</p>\n<p>Using the following example:</p>\n<div class=\"codehilite\"><pre><span></span>define &quot;Encounters with overlapping Warfarin and Parenteral Therapies&quot;:\n    from &quot;Encounters&quot; E,\n         &quot;Warfarin Therapy&quot; W,\n         &quot;Parenteral Therapy&quot; P\n</pre></div>\n\n\n<p>Implementation step 1:<br>\n\"For each query source beyond the first, use a Times operation to produce a result with a tuple for each combination, named the same as the alias used to introduce the source in the query.\"</p>\n<p>What does this mean? And what would an example tuple look like for one of these combinations?</p>\n<p>Does this mean step 1 will result in a list of tuples that contains every possible combination of E, W, and P? As in ^2, ^3, or more?</p>\n<p>Is it expected to look something like this?</p>\n<div class=\"codehilite\"><pre><span></span>Tuple: {\n    Name: &#39;RetrieveCombination_1&#39;,\n    Values: [\n                Tuple: { DataElement: Entry1, Alias: &quot;E&quot; },\n                Tuple: { DataElement: Entry25, Alias: &quot;W&quot; },\n                Tuple: { DataElement: Entry31, Alias: &quot;P&quot; }\n            ]\n}, ...\n</pre></div>",
        "id": 153950607,
        "sender_full_name": "Matthew Dugal",
        "timestamp": 1522851519
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191473\">@Matthew Dugal</span> . Your understanding of multi-source queries is correct, but your expected result is incorrect. I think the easiest way to clear up your understanding is to run some example code. <br>\nHere are the steps to do that:<br>\n1. Navigate to <a href=\"http://cql-runner.dataphoria.org/\" target=\"_blank\" title=\"http://cql-runner.dataphoria.org/\">http://cql-runner.dataphoria.org/</a><br>\n2. Click the \"Config\" button in the menu bar, input Patient-12214 in the Patient Id field, and press OK<br>\n3. Run the following code:</p>\n<div class=\"codehilite\"><pre><span></span>library MultiSourceQueryExample version &#39;1.0&#39;\n\nusing FHIR version &#39;3.0.0&#39;\n\ncontext Patient\n\ndefine Conditions:\n    [Condition]\n\ndefine Procedures:\n    [Procedure]\n\ndefine &quot;Multisource Query&quot;:\n    from Conditions C,\n         Procedures P\n</pre></div>\n\n\n<p>4. The results will be displayed in the output window. The results will consist of the Patient resource and the resources from the expressions. Note that there are 5 Condition resources and 6 Procedure resources for the patient. The outcome of the multi-source query expression is a list of tuples with the 30 possible combinations.</p>\n<p>Hopefully that helps.</p>",
        "id": 153950993,
        "sender_full_name": "Christopher Schuler",
        "timestamp": 1522955270
    },
    {
        "content": "<p>This is actually very helpful. Thank you.</p>\n<p>It leads me into the part that I've been working through with some difficulty. And if you or someone could help, that would be much appreciated. For the slightly modified version of your query, what would the return values of \"overlaps\" look like and how would the \"and\" statement operate on them?</p>\n<div class=\"codehilite\"><pre><span></span>define &quot;Multisource Query&quot;:\n    from Conditions C,\n         Procedures P\n\n    with &quot;Encounters&quot; E\n      such that E.relevantPeriod overlaps C.prevalencePeriod\n            and E.relevantPeriod overlaps P.relevantPeriod\n</pre></div>",
        "id": 153951117,
        "sender_full_name": "Matthew Dugal",
        "timestamp": 1522983923
    },
    {
        "content": "<p>I think the problem I am having understanding this is that it feels so much like the what is described on page 2-2 of \"Implementing Computation of Specific Occurrences\". Am I wrong in thinking the only difference is the locality of combinations?</p>",
        "id": 153951166,
        "sender_full_name": "Matthew Dugal",
        "timestamp": 1523024258
    },
    {
        "content": "<p>Apologies for the very late response here, can you tell me what you mean by \"locality of combinations\"? I'm not sure I understand that part.</p>",
        "id": 153953498,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1524423232
    }
]