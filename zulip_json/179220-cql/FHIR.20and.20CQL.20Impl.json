[
    {
        "content": "<p>Trying to get my head around CQL and producing a real unit of work for a Usecase.</p>\n<p>Need some feed back on<br>\n1. CQL Execution<br>\n2. Actual Action Evaluation via PlanDef<br>\nDoes this flow look right?<br>\n<span class=\"user-mention\" data-user-id=\"191813\">@ArunSrinivasan</span> <span class=\"user-mention\" data-user-id=\"194273\">@Marcelo caldas</span> <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <a href=\"user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg\" target=\"_blank\" title=\"user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg\">download.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg\" target=\"_blank\" title=\"download.jpg\"><img src=\"user_uploads/10155/7oqr7d_dZfHMxF_6aeRuzKu1/download.jpg\"></a></div>",
        "id": 153958567,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1526138543
    },
    {
        "content": "<p>Can you give a little more context about what this is a depiction of?</p>",
        "id": 153958580,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526141116
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span>  Attached here is more context. There are muitiple usecases for this pattern. For simplicity I'll decribe one such usecase below. </p>\n<p>Paul Coverdell Stroke Registry <br>\nWhen Stroke Patients get discharged, there is a follow-up that happens by care provider orgs ,(eg: Hospice , In home care and many other entities).<br>\nThe follow up is usally a set of questions are are asked of the patient 7,14,30,... days after discharge. The key here is timeliness. Most of the time this identification of a cohort is a very manual process. Also a lot of Patients are missed in this manual identification of a cohort.</p>\n<p>The pattern is  -&gt; initial trigger -&gt; subsequent adjudication -&gt; Cohort Match found</p>\n<p>Now initial trigger could be a CDS Hooks based or Subscription based trigger.</p>\n<p>For subsequent adjudication , we liked the CQL approach and we think that it could scale. So we are trying to implement a Remote CDS Service , which loads CQL as a Resource. for eample stroke.cql would be exposed as  RemoteCDSSErviceURL/cds-services/stroke/ . The idea is for Triggering mechanisms to dump POST requests with resources as Payloads to this service.</p>\n<p>This would mean that the CDS Service will receive a FHIR Resource payload (or a ref) to it so the CQL mapped to that endpoint could be executed and measures calculated. These measures are then applied to PlanDef on the server. </p>\n<p>We were trying to validate our understanding and would welcome some feedback or course corrections.We are leveraging one of your implementations @github , trying to undertstand on how cqf-ruler or cqf-engine would fit the need(or develop our own tooling).</p>\n<p>Adding another diagram with a bit more context:</p>\n<p><a href=\"/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg\" target=\"_blank\" title=\"download-1.jpg\">download-1.jpg</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg\" target=\"_blank\" title=\"download-1.jpg\"><img src=\"/user_uploads/10155/eFLYYJZ9kaoZZAerdMFYi2pD/download-1.jpg\"></a></div><p><span class=\"user-mention\" data-user-id=\"191813\">@ArunSrinivasan</span> <span class=\"user-mention\" data-user-id=\"194273\">@Marcelo caldas</span></p>",
        "id": 153959592,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1526210986
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 153960540,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526316705
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> is more familiar w/ the FHIR Clinical Reasoning side of things, and particularly associated Operations, than I am. That said, my understanding of <code>$apply</code> (mostly from <a href=\"http://hl7.org/fhir/STU3/plandefinition-operations.html#apply\" target=\"_blank\" title=\"http://hl7.org/fhir/STU3/plandefinition-operations.html#apply\">here</a>) is that you can't POST the CQL results as input.  I think the <code>$apply</code> operation expects the FHIR server to execute the CQL as part of the operation -- so having a CQL exec service separate from the FHIR server probably doesn't work for this case.</p>",
        "id": 153960630,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526328272
    },
    {
        "content": "<p>If this was intended as a point-of-care clinical invocation, then you could probably wrap the CQL in a CDS Hooks service and return suggestion cards -- but it sounds like your use case is for this to be a bit more behind-the-scenes, not necessarily at or during the point of care.  Is that right, <span class=\"user-mention\" data-user-id=\"194261\">@Rishi Tarar</span>?</p>",
        "id": 153960632,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526328441
    },
    {
        "content": "<p>CQL can be loaded into a FHIR server for execution with the CQL engine using a Library resource. The CQF engine is a stand-alone component that can run CQL and access data from any FHIR server (you provide an endpoint as part of configuring the engine). The CQF ruler is a HAPI FHIR derivative that plugs a CQL engine in and loads CQL from Library resources on the server. In that configuration, the engine will use the JPA layer to access FHIR data in the local FHIR server.</p>",
        "id": 153960635,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526329302
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> -- is my understanding of <code>$apply</code> (see above) correct?  And if so, does CQF engine or CQF ruler support <code>$apply</code>?</p>",
        "id": 153960636,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526329444
    },
    {
        "content": "<p>So the middle layer here could either be a FHIR server (a modified CQF Ruler would work) or just a custom service that subscribes to the FHIR server generating the events, and then runs the CQL using the FHIR server that originated the event as the endpoint.</p>",
        "id": 153960637,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526329449
    },
    {
        "content": "<p>That's correct, $apply isn't a general CQL $evaluate, $apply is specifically about running a PlanDefinition.</p>",
        "id": 153960638,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526329475
    },
    {
        "content": "<p>Yes, the CQF Ruler supports $apply, that's what we use in the CDS Hooks servlet to process rules.</p>",
        "id": 153960639,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526329519
    },
    {
        "content": "<p>We've toyed with a general $evaluate operation ($cql maybe?) and it would be trivial to implement, but we haven't yet.</p>",
        "id": 153960640,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526329570
    },
    {
        "content": "<p>Does <code>$apply</code> actually post the resulting CarePlan to the server as well?  Or does it just return it and it's up to the caller to post it back if they want to save it?</p>",
        "id": 153960641,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526329739
    },
    {
        "content": "<p>It just returns it, it's up to the caller to decide what to do with it.</p>",
        "id": 153960707,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526331939
    },
    {
        "content": "<p>This is awesome feedback <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span> <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> .</p>\n<p>I am thinking of a way where the CDS Package which could constitute of <br>\n1. CQL <br>\n2. Associated Libraries (Terminology Valuesets etc)<br>\n3. Trigger Criteria (CDS Hook or Subscription )</p>\n<p><strong>On the flow: </strong><br>\nSo from what I understood a modified cqf-ruler (custom service) would work. See below<br>\n1. Input from either a CDS Hooks(UI Based) or Subscription callback rest hook(backend)<br>\n2. The said custom service then \"runs\" the CQL against the FHIR Server that originated the call<br>\n3. The CQL Output measure is determined and CDS SErvice takles and action (Send Card back for CDS Hooks , Take an Action to log a Match for a cohort for Subscription based triggering)</p>\n<p><strong>The \"runs\"  part</strong><br>\nRunning a CQL against the data from the FHIR Server<br>\n1. Looking at the cqf-ruler on git hub , it appears that CQL and Libs are loaded on cql-ruler<br>\n2. FHIR Server onbly provides the data </p>\n<p><strong>The Plan Definition</strong><br>\nIt appears Plan Definition and Care Plan are very specific to a FHIR Server and in-situ feedback on Clinical Workflow pathways.<br>\nIt seems to me they may not be relevant,  to what I am trying to achieve for sentinel background actions like the stroke usecase. </p>\n<p>A Custom CQF-RULER type service can meet our needs.</p>\n<p>Does this make sense?</p>",
        "id": 153960756,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1526339503
    },
    {
        "content": "<p>You're getting much deeper into <span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> 's territory than mine, so I'm afraid I can't provide much confirmation at this point -- as I don't really have any experience w/ cqf-ruler.</p>",
        "id": 153961414,
        "sender_full_name": "Chris Moesel",
        "timestamp": 1526440317
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194261\">@Rishi Tarar</span> , yes, from what I understand of the use case, this sounds reasonable and a modified CQF-Ruler or equivalent middle layer should be able to handle it.</p>",
        "id": 153961440,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526452764
    },
    {
        "content": "<p>You're right that PlanDefinition and CarePlan are about representing workflow, but I'll just note that PlanDefinition can be used to build Event-Condition-Action rules.</p>",
        "id": 153961441,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526452900
    },
    {
        "content": "<p>I'm still a little unclear about how CDS Hooks fits into what you're describing, but if it's part of a provider workflow and requires provider interaction then yes, that makes sense.</p>",
        "id": 153961442,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526452958
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191359\">@Bryn Rhodes</span> <span class=\"user-mention\" data-user-id=\"191469\">@Chris Moesel</span>  Thanks for clarifications.</p>\n<p>You are right Bryn. The abstract view is that CDS(verb) will have two types of usecases<br>\n1. UI Based .. where provider feed back is indeed required<br>\n2. Sentinel .. non UI scenarios </p>\n<p>The CDS mechanism to deliver \"the package\" differs for both of these as for UI based you could have PlanDef (Event-Condition-Action) and for Sentinel, you could have (Remote CDS and subsequent downstream actions without burdening the provider or the EHR)</p>\n<p>Most of the Pop Health and Public health use cases align well with the Sentinel Scenario. This is only a technical and standards aspect. However the Data USe and Security \"must\" be respected. And that could be the next level of conversation with the community.</p>\n<p>We will give cqf-ruler impl a try.. We are trying to <br>\n1. Package cqf-ruler as a Springboot App <br>\n2. Expose the cql-engine tooling <br>\n3. Try to modularize Loading of  \"CDS Package\" and expose it as an Endpoint.</p>\n<p>We may have some follow up questions.<br>\nThanks for all the feedback. We will see you guys at FHIRDevDays....<br>\n<span class=\"user-mention\" data-user-id=\"194273\">@Marcelo caldas</span> <span class=\"user-mention\" data-user-id=\"191813\">@ArunSrinivasan</span> <br>\n-RIshi</p>",
        "id": 153961874,
        "sender_full_name": "Rishi Tarar",
        "timestamp": 1526477459
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194261\">@Rishi Tarar</span> , that sounds fantastic, see you at FHIRDevDays!</p>",
        "id": 153961955,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1526482049
    }
]