[
    {
        "content": "<p>I have a question about the $cql operation currently available on CQF-Ruler. In the code for the operation, it looks like there's not  an option to define an external data source like for the Library $evaluate measure. Is this a known limitation of the operation, where the CQL has to be registered as a library on CQF-Ruler to be evaluated using an external data source or am I missing something? <span class=\"user-mention\" data-user-id=\"194178\">@JP</span> I think you would probably know best since you've helped my teammate with cqf-ruler stuff before</p>",
        "id": 259115224,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1635262463
    },
    {
        "content": "<p>The intent is for both those operations to support the same set of parameters so they can access data in the same way, but it sounds like accessing external data isn't wired up in the $cql operation. It should be a straightforward change because they're both running the cql-evaluator underneath, it sounds like the dataEndpoint parameter just needs to be wired up to a provider parameter to the evaluate call.</p>",
        "id": 259117355,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1635263301
    },
    {
        "content": "<p>Using the evaluator modules is still a WIP in the ruler. The current implementation is inline. Still hammering out the interfaces so that those modules can be reused with Android, VS Code, eCR Now, etc. Getting there, but it's slow going. <span aria-label=\"frown\" class=\"emoji emoji-1f641\" role=\"img\" title=\"frown\">:frown:</span></p>",
        "id": 259129042,
        "sender_full_name": "JP",
        "timestamp": 1635268182
    },
    {
        "content": "<p>Now im switching back to using Libraries and $evaluate but its giving an error in the logs saying \"Unknown element 'valueEndpoint' found while parsing\", and it worked a few days ago so I dont know what couldve happened to cause this. My post body is </p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Parameters&quot;,\n    &quot;parameter&quot;: [\n        {\n            &quot;name&quot;: &quot;patientId&quot;,\n            &quot;valueString&quot;: &quot;11364&quot;\n        },\n        {\n            &quot;name&quot;: &quot;context&quot;,\n            &quot;valueString&quot;: &quot;Patient&quot;\n        },\n        {\n            &quot;name&quot;: &quot;dataEndpoint&quot;,\n            &quot;valueEndpoint&quot;: &quot;Endpoint/1&quot;\n        }\n    ]\n}\n</code></pre></div>\n<p>where Endpoint/1 is a valid resource on the server</p>",
        "id": 259145065,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1635274970
    },
    {
        "content": "<p>Apologies for missing this Andy. The operation expects the actual Endpoint resource, not just a reference to an existing one.</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Parameters&quot;,\n    &quot;parameter&quot;: [\n        {\n            &quot;name&quot;: &quot;patientId&quot;,\n            &quot;valueString&quot;: &quot;11364&quot;\n        },\n        {\n            &quot;name&quot;: &quot;context&quot;,\n            &quot;valueString&quot;: &quot;Patient&quot;\n        },\n        {\n            &quot;name&quot;: &quot;dataEndpoint&quot;,\n            &quot;resource&quot;:  {\n                &quot;resourceType&quot;: &quot;Endpoint&quot;,\n               // The rest of the Endpoint here\n}\n        }\n    ]\n}\n</code></pre></div>",
        "id": 260168102,
        "sender_full_name": "JP",
        "timestamp": 1635960322
    },
    {
        "content": "<p>We could probably overload the operation to support an Endpoint reference. Endpoint references currently don't work well in OAuth environments because the headers are static, and in real-world environments it's expected that the refresh token will refresh periodically. The cqf-ruler currently doesn't support such a scenario.</p>",
        "id": 260168324,
        "sender_full_name": "JP",
        "timestamp": 1635960422
    }
]