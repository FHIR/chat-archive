[
    {
        "content": "<p>So I'm trying to use the $cql operation on CQF ruler to validate some CQL before persisting it, but when I POST, it returns 3 errors saying <br>\n<code>Invalid invocation target: org.hl7.elm.r1.ExpressionRef</code>. Looking at the locations in the CQL, it looks like it's referring to defines where i've used fluent functions. This is my library I'm testing my validation stuff with:</p>\n<div class=\"codehilite\"><pre><span></span><code>library demographics version &#39;1.0&#39;\n\nusing FHIR version &#39;4.0.0&#39;\n\ncontext Patient\n\ndefine &quot;first_name&quot;: Patient.name[0].given[0]\ndefine &quot;last_name&quot;: Patient.name[0].family\ndefine &quot;date_of_birth&quot;: Patient.birthDate\ndefine &quot;age&quot;: AgeInYears()\ndefine &quot;gender&quot;: Patient.gender\ndefine &quot;race&quot;: Patient.valueOmbCategoryRace()\ndefine &quot;ethnicity&quot;: Patient.valueOmbCategoryEthnicity()\ndefine &quot;birthsex&quot;: Patient.valueUSCoreBirthSex()\ndefine &quot;zip&quot;: Patient.address.postalCode[0]\ndefine &quot;state&quot;: Patient.address.state[0]\n\n// Helper Functions from FHIRCommon\ndefine function Extensions(domainResource DomainResource, url String):\n  domainResource.extension E\n      where E.url = url\n        return E\ndefine function Extensions(element Element, url String):\n  element.extension E\n      where E.url = url\n        return E\ndefine function Extension(domainResource DomainResource, url String):\n  singleton from &quot;Extensions&quot;(domainResource, url)\ndefine function Extension(element Element, url String):\n  singleton from Extensions(element, url)\n\ndefine fluent function valueOmbCategoryRace(patient Patient):\n  Extension(Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-race&#39;), &#39;ombCategory&#39;).value\ndefine fluent function valueOmbCategoryEthnicity(patient Patient):\n  Extension(Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-ethnicity&#39;), &#39;ombCategory&#39;).value\ndefine fluent function valueUSCoreBirthSex(patient Patient):\n  Extension(patient, &#39;http://hl7.org/fhir/us/core/StructureDefinition/us-core-birthsex&#39;).value\n</code></pre></div>\n<p>However, this library is already stored in CQF Ruler and runs perfectly fine when using the $evaluate operation. Is this error in relation to how the two operations operate? or is there something else wrong I'm not seeing?</p>",
        "id": 270579835,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1643906986
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"421123\">@Andy Stevens</span> , trying this in my local IDE, with the library addition above, I get errors in the comparison of the <code>url</code> attribute in the <code>Extensions</code> function definitions that I need to include FHIRHelpers. Once I include that it compiles. Is that include declaration missing here?</p>",
        "id": 270729042,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1643988165
    }
]