[
    {
        "content": "<p>An issue we ran into using CQF Ruler is that we kept getting stream timeouts while trying to run some CQL against a FHIR server (about 7 retrieve statements). We ended up running it against a basic (almost) empty HAPI FHIR server and looked at the logs to see what kind of FHIR queries CQF Ruler was making. </p>\n<p>We found out that having CQL in the form of <code>[Observation: code in \"concepts\"]</code> would make a FHIR query of an Observation with only the search parameter of subject=Patient.id, so it was returning all Observations for the patient, and when using against a server where a patient has 27,000 Observations, it causes a timeout. </p>\n<p>However, I then changed the CQL retrieve to <code>[Observation: \"concepts\"]</code> and the HAPI FHIR logs showed a FHIR query of an Observation with subject=Patient.id and code=all of the codes in the defined concept set, so that does the correct kind of query</p>\n<p>Is this an issue with how the ruler evaluates different cql syntax, or is there something else that we're missing here?</p>",
        "id": 261056259,
        "sender_full_name": "Andy Stevens",
        "timestamp": 1636579175
    },
    {
        "content": "<p>That is interesting that you are seeing different query behavior there, I just verified that the ELM output for those two is the same (assuming \"concepts\" is a reference to a value set?)</p>",
        "id": 261069984,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636586089
    },
    {
        "content": "<p>I will dig in and see if I can tell what's going on</p>",
        "id": 261070087,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1636586152
    },
    {
        "content": "<p>Bryn, is there an elm datastructure (trace?) we could send to help you  investigate?</p>",
        "id": 261149916,
        "sender_full_name": "Michael Riley",
        "timestamp": 1636645778
    }
]