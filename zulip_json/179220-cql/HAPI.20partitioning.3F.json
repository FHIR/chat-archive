[
    {
        "content": "<p>Can anyone tell me how $evaluate-measure is treated when HAPI's partitioning is turned on?</p>",
        "id": 242651144,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623700568
    },
    {
        "content": "<p>Can I load the Measure, Library and ValueSet resources onto the DEFAULT partition, and then $evaluate-measure against data in a different partition?</p>",
        "id": 242651220,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623700607
    },
    {
        "content": "<p>i.e.<br>\n/fhir/DEFAULT/Measure/SomeMeasure<br>\nand then execute<br>\n/fhir/SOME-OTHER-PARTITION/Measure/SomeMeasure/$evaluate-measure?periodStart=XXX&amp;periodEnd=YYY</p>",
        "id": 242651309,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623700644
    },
    {
        "content": "<p>I don't think cross-partition execution would be supported currently but I've never actually tried it.</p>",
        "id": 242656038,
        "sender_full_name": "JP",
        "timestamp": 1623703110
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194178\">@JP</span> any thoughts on what it <em>would</em> take to make that work?</p>",
        "id": 242657363,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623703814
    },
    {
        "content": "<p>Anything I can do to help that along?</p>",
        "id": 242657380,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623703825
    },
    {
        "content": "<p>(point me in the right direction?)</p>",
        "id": 242657387,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623703831
    },
    {
        "content": "<p>This is the class that does the data-access from the perspective of the cql evaluation:</p>\n<p><a href=\"https://github.com/hapifhir/hapi-fhir/blob/376a84d2134588eb8b62685c93166318a76bf5a7/hapi-fhir-jpaserver-cql/src/main/java/ca/uhn/fhir/cql/common/retrieve/JpaFhirRetrieveProvider.java#L46\">https://github.com/hapifhir/hapi-fhir/blob/376a84d2134588eb8b62685c93166318a76bf5a7/hapi-fhir-jpaserver-cql/src/main/java/ca/uhn/fhir/cql/common/retrieve/JpaFhirRetrieveProvider.java#L46</a></p>\n<p>It takes a DaoRegistry as a parameter which it is how it accesses the underlying HAPI database. If there were a way to configure the registry to point to a different partition or to inject a different registry you could in principle access different data. I don't have any experience with HAPI's partitioning scheme so I'm not sure if that's possible but that's where I'd start looking.</p>",
        "id": 242657929,
        "sender_full_name": "JP",
        "timestamp": 1623704142
    },
    {
        "content": "<p>Is that helpful?</p>",
        "id": 242657946,
        "sender_full_name": "JP",
        "timestamp": 1623704152
    },
    {
        "content": "<p>very</p>",
        "id": 242658453,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623704430
    },
    {
        "content": "<p>thanks</p>",
        "id": 242658457,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623704431
    },
    {
        "content": "<p>Ok. I setup a scenario where the Measure was loaded on DEFAULT partition, and data loaded on \"somePartition\" partition</p>",
        "id": 242661237,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623706072
    },
    {
        "content": "<p>Getting the following right now:</p>",
        "id": 242661251,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623706076
    },
    {
        "content": "<p>No interceptor provided a value for pointcut: STORAGE_PARTITION_IDENTIFY_READ</p>",
        "id": 242661255,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623706078
    },
    {
        "content": "<p>Trying to figure out what causes that...</p>",
        "id": 242661302,
        "sender_full_name": "Sean McIlvenna",
        "timestamp": 1623706084
    }
]