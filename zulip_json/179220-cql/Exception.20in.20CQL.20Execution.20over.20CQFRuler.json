[
    {
        "content": "<p>Hi all,</p>\n<p>I followed this walkthrough: <a href=\"https://github.com/cqframework/content-ig-walkthrough\">https://github.com/cqframework/content-ig-walkthrough</a> for my own CQL Library.</p>\n<p>On Atom, the CQL code is running correctly, I also tested it on this sandbox: <a href=\"https://cql-runner.dataphoria.org/\">https://cql-runner.dataphoria.org/</a> and everything want good.<br>\nHowever, when I try to test my CDS Service using the CDS Hooks sandbox I donâ€™t have any result displayed.</p>\n<p>So I tried to display the response from the CQFRuler for this http request using Postman and i got this message (see below), it seems that the CQFRuler is trying to transalte the CQL code even if the FHIR Library already contains the code translated to ELM, I'm a little bit lost ! many thanks for your help.</p>\n<p>**ERROR: Exception in CQL Execution.<br>\nUnable translate library epidyolex02pharmacist<br>\norg.opencds.cqf.cql.engine.exception.CqlException: Unable translate library epidyolex02pharmacist<br>\nat org.opencds.cqf.cql.evaluator.engine.execution.TranslatingLibraryLoader.translate(TranslatingLibraryLoader.java:147)<br>\nat org.opencds.cqf.cql.evaluator.engine.execution.TranslatingLibraryLoader.load(TranslatingLibraryLoader.java:88)<br>\nat org.opencds.cqf.cql.evaluator.engine.execution.CacheAwareLibraryLoaderDecorator.load(CacheAwareLibraryLoaderDecorator.java:49)<br>\nat ca.uhn.fhir.cql.r4.helper.LibraryHelper.resolveLibraryById(LibraryHelper.java:203)<br>\nat ca.uhn.fhir.cql.r4.helper.LibraryHelper.resolvePrimaryLibrary(LibraryHelper.java:227)<br>\nat org.opencds.cqf.r4.servlet.CdsHooksServlet.doPost(CdsHooksServlet.java:184)<br>\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:707)<br>\nat javax.servlet.http.HttpServlet.service(HttpServlet.java:790)<br>\nat org.eclipse.jetty.servlet.ServletHolder$NotAsync.service(ServletHolder.java:1459)<br>\nat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)<br>\nat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1631)<br>\nat org.eclipse.jetty.websocket.server.WebSocketUpgradeFilter.doFilter(WebSocketUpgradeFilter.java:228)<br>\nat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)<br>\nat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1601)<br>\nat org.eclipse.jetty.servlets.CrossOriginFilter.handle(CrossOriginFilter.java:319)<br>\nat org.eclipse.jetty.servlets.CrossOriginFilter.doFilter(CrossOriginFilter.java:273)<br>\nat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:201)<br>\nat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1601)<br>\nat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:548)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:143)<br>\nat org.eclipse.jetty.security.SecurityHandler.handle(SecurityHandler.java:600)<br>\nat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:235)<br>\nat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)<br>\nat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1434)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)<br>\nat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:501)<br>\nat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)<br>\nat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1349)<br>\nat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)<br>\nat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)<br>\nat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)<br>\nat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)<br>\nat org.eclipse.jetty.server.Server.handle(Server.java:516)<br>\nat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:400)<br>\nat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:645)<br>\nat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:392)<br>\nat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)<br>\nat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)<br>\nat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)<br>\nat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)<br>\nat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)<br>\nat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)<br>\nat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)<br>\nat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)<br>\nat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)<br>\nat org.eclipse.jetty.util.thread.QueuedThreadPool.runJob(QueuedThreadPool.java:883)<br>\nat org.eclipse.jetty.util.thread.QueuedThreadPool$Runner.run(QueuedThreadPool.java:1034)<br>\nat java.base/java.lang.Thread.run(Unknown Source)**</p>",
        "id": 272416585,
        "sender_full_name": "Abdelali Boussadi",
        "timestamp": 1645198756
    },
    {
        "content": "<p>Is there somewhere that you have the IG content posted so I can try to reproduce this?</p>",
        "id": 272962128,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645629371
    },
    {
        "content": "<p>Unfortunately not yet, however, I moved to an other issue since this post. I used the function called </p>\n<p>\"Is Opioid Analgesic with Ambulatory Misuse Potential\" from this library </p>\n<p><a href=\"https://build.fhir.org/ig/cqframework/opioid-cds-r4/Library-library-OpioidCDSCommon.html\">https://build.fhir.org/ig/cqframework/opioid-cds-r4/Library-library-OpioidCDSCommon.html</a>  in my CQL code. </p>\n<p>On Atom the code is showing no error but the Publisher displays this error and refuse to translate the CQL code </p>\n<p>ERROR: epidiolexCommon: Could not resolve call to operator AnyInValueSet with signature (list&lt;FHIR.code&gt;,System.ValueSet).</p>\n<p>below my CQL library</p>\n<p>library epidiolexCommon version '1.0.0'<br>\nusing FHIR version '4.0.1'<br>\ninclude \"FHIRHelpers\" version '4.0.1' called FHIRHelpers<br>\ncodesystem RXNORM: '2.16.840.1.113883.6.88'<br>\nvalueset \"SAM medication codes\": '<a href=\"https://smt.esante.gouv.fr/fhir/ValueSet/epidyolex01pharmacist-sam-ig\">https://smt.esante.gouv.fr/fhir/ValueSet/epidyolex01pharmacist-sam-ig</a>'<br>\n//code \"Epidiolex code\": '197685' from RXNORM display 'etodolac 300 MG'</p>\n<p>define function \"Is Epidiolex ?\"(value List&lt;MedicationRequest&gt;):<br>\n  value Rx<br>\n    let MedRef: if (Rx.medication is FHIR.Reference) then (Rx.medication as FHIR.Reference).reference else null,<br>\n      Med: if MedRef is null then (Rx.medication as FHIR.CodeableConcept).coding else SingletonFrom([Medication: id in (Last(Split(MedRef, '/')))] Med return Med.code.coding)<br>\n    where Med.code in \"SAM medication codes\"</p>\n<div class=\"codehilite\"><pre><span></span><code>return\n      MedicationRequest {\n        id: Rx.id,\n        status: Rx.status,\n        intent: Rx.intent,\n        category: Rx.category,\n        medication: FHIR.CodeableConcept{ coding: Med },\n        subject: Rx.subject,\n        authoredOn: Rx.authoredOn,\n        recorder: Rx.recorder,\n        dosageInstruction: Rx.dosageInstruction,\n        dispenseRequest: Rx.dispenseRequest\n      }\n</code></pre></div>",
        "id": 272966787,
        "sender_full_name": "Abdelali Boussadi",
        "timestamp": 1645631266
    },
    {
        "content": "<p>The publisher includes CQL translation, but uses an older version of the translator. If you use the _refresh script (in the <a href=\"https://github.com/cqframework/sample-content-ig\">Sample Content IG</a>, it will use the latest translator. It adds a step to the build in that whenever you change the CQL, you need to run _refresh and then run _genonce to build the IG. You also have to turn off the binary adjunct file loading in the publisher (remove the path-binary parameter from the IG).</p>",
        "id": 272971039,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645632961
    },
    {
        "content": "<p>We're working on an update to the publisher so that it will use the latest, but haven't gotten that submitted to the publisher yet.</p>",
        "id": 272971125,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645632979
    },
    {
        "content": "<p>All that is to say that the error you're getting above is a known issue with the translator that has since been addressed.</p>",
        "id": 272971172,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645633003
    },
    {
        "content": "<p>Sorry Bryn, I didn't get your last point: \"You also have to turn off the binary adjunct file loading in the publisher (remove the path-binary parameter from the IG).\" ?</p>",
        "id": 273060781,
        "sender_full_name": "Abdelali Boussadi",
        "timestamp": 1645692215
    },
    {
        "content": "<p>The publisher uses the 'path-binary' parameter to find CQL files to translate, so you have to turn that off:<br>\n<a href=\"https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119\">https://github.com/cqframework/sample-content-ig/blob/master/input/mycontentig.xml#L119</a></p>",
        "id": 273092245,
        "sender_full_name": "Bryn Rhodes",
        "timestamp": 1645711167
    },
    {
        "content": "<p>Hi Team,<br>\nCould you please let me know ,<br>\nhow can we create data model or customize schema like FHIR or QDM.<br>\nSo we can using customize schema instead of FHIR or QDM for CQL.<br>\nPlease provide me any example which will help me to create customise schema. Need your help. I am new in CQL.<br>\nAlso let me know the data format of FHIR and QDM.<br>\nHow does any customize data model like PHIR can read from CQL-ENGINE or CQL-Language-Server?</p>",
        "id": 274092044,
        "sender_full_name": "Sukanta Barai",
        "timestamp": 1646380297
    }
]