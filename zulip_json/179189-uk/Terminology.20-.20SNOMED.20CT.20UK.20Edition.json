[
    {
        "content": "<p>I want to push terminology validation in UK implementations (as it drives both SCT and validation). <br>\nAs the UK onto server is still in beta, what other options do we have.?</p>\n<p>Possibly could use the SCT built into the HL7 Validator?</p>",
        "id": 200748246,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592021665
    },
    {
        "content": "<p>What are your timeframes?</p>",
        "id": 200753220,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1592032253
    },
    {
        "content": "<p>as soon as its workable I think we should start recommending it.<br>\nI'm pushing validation as something developers should do early on. Terminology support helps that (and helps terminlogy)</p>",
        "id": 200753445,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592032782
    },
    {
        "content": "<p>See also <a href=\"#narrow/stream/179177-conformance/topic/FHIR.20Validator.20-sct.20option\">https://chat.fhir.org/#narrow/stream/179177-conformance/topic/FHIR.20Validator.20-sct.20option</a></p>",
        "id": 200753605,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592033149
    },
    {
        "content": "<p>I guess I'm wondering why not start with the current beta as it is there now?</p>",
        "id": 200753650,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1592033211
    },
    {
        "content": "<p>I've just tried using FHR Validator with this parameter -tx <a href=\"https://ontoserver.dataproducts.nhs.uk/fhir/\">https://ontoserver.dataproducts.nhs.uk/fhir/</a></p>",
        "id": 200753852,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592033562
    },
    {
        "content": "<p>Get this response</p>",
        "id": 200753864,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592033616
    },
    {
        "content": "<p>FHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (6 days old)<br>\nDetected Java version: 14.0.1 from /Users/kevinmayfield/Library/Java/JavaVirtualMachines/openjdk-14.0.1/Contents/Home on x86_64 (64bit). 8192MB available<br>\nArguments: Bundle-prescription-order.xml -version 4.0.1 -ig <a href=\"https://packages.simplifier.net/uk.core.r4/-/uk.core.r4-1.1.0.tgz\">https://packages.simplifier.net/uk.core.r4/-/uk.core.r4-1.1.0.tgz</a> -tx <a href=\"https://ontoserver.dataproducts.nhs.uk/fhir/\">https://ontoserver.dataproducts.nhs.uk/fhir/</a><br>\nDirectories: Current = /Users/kevinmayfield/github/nhsconnect/eps/Examples, Package Cache = /Users/kevinmayfield/.fhir/packages<br>\n  .. FHIR Version 4.0, definitions from hl7.fhir.r4.core#4.0.1<br>\n  .. connect to tx server @ <a href=\"https://ontoserver.dataproducts.nhs.uk/fhir/\">https://ontoserver.dataproducts.nhs.uk/fhir/</a><br>\nException in thread \"main\" org.hl7.fhir.exceptions.FHIRException: Unable to connect to terminology server. Use parameter '-tx n/a' tun run without using terminology services to validate LOINC, SNOMED, ICD-X etc. Error = Error parsing response message: Unknown Content acceptUnknown @  START_TAG seen ...&lt;fhirVersion value=\"3.0.2\"/&gt;&lt;acceptUnknown value=\"extensions\"/&gt;... @1:1239<br>\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:258)<br>\n    at org.hl7.fhir.validation.ValidationEngine.connectToTSServer(ValidationEngine.java:718)<br>\n    at org.hl7.fhir.validation.ValidationEngine.setTerminologyServer(ValidationEngine.java:309)<br>\n    at org.hl7.fhir.validation.ValidationEngine.&lt;init&gt;(ValidationEngine.java:339)<br>\n    at org.hl7.fhir.validation.cli.services.ValidationService.getValidator(ValidationService.java:180)<br>\n    at org.hl7.fhir.validation.Validator.main(Validator.java:175)<br>\nCaused by: org.hl7.fhir.r5.utils.client.EFhirClientException: Error parsing response message: Unknown Content acceptUnknown @  START_TAG seen ...&lt;fhirVersion value=\"3.0.2\"/&gt;&lt;acceptUnknown value=\"extensions\"/&gt;... @1:1239<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:352)<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:237)<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:219)<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.issueResourceRequest(ClientUtils.java:210)<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.issueGetResourceRequest(ClientUtils.java:146)<br>\n    at org.hl7.fhir.r5.utils.client.FHIRToolingClient.getCapabilitiesStatementQuick(FHIRToolingClient.java:181)<br>\n    at org.hl7.fhir.convertors.txClient.TerminologyClientR5.getCapabilitiesStatementQuick(TerminologyClientR5.java:94)<br>\n    at org.hl7.fhir.r5.context.SimpleWorkerContext.connectToTSServer(SimpleWorkerContext.java:256)<br>\n    ... 5 more<br>\nCaused by: org.hl7.fhir.exceptions.FHIRFormatError: Unknown Content acceptUnknown @  START_TAG seen ...&lt;fhirVersion value=\"3.0.2\"/&gt;&lt;acceptUnknown value=\"extensions\"/&gt;... @1:1239<br>\n    at org.hl7.fhir.r5.formats.XmlParserBase.unknownContent(XmlParserBase.java:312)<br>\n    at org.hl7.fhir.r5.formats.XmlParser.parseCapabilityStatement(XmlParser.java:3929)<br>\n    at org.hl7.fhir.r5.formats.XmlParser.parseResource(XmlParser.java:26381)<br>\n    at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:136)<br>\n    at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:120)<br>\n    at org.hl7.fhir.r5.formats.ParserBase.parse(ParserBase.java:61)<br>\n    at org.hl7.fhir.r5.utils.client.ClientUtils.unmarshalReference(ClientUtils.java:345)</p>",
        "id": 200753865,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592033618
    },
    {
        "content": "<p>I'll look into it tomorrow sometime</p>",
        "id": 200753924,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592033733
    },
    {
        "content": "<p>Does it work with <a href=\"https://r4.ontoserver.csiro.au/fhir\">https://r4.ontoserver.csiro.au/fhir</a> -- it also has SNOMED UK loaded</p>",
        "id": 200754322,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1592034572
    },
    {
        "content": "<p>Note, the UK Beta is STU3 not R4</p>",
        "id": 200754380,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1592034638
    },
    {
        "content": "<p>Yep, that did work.</p>",
        "id": 200763418,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592050366
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191687\">@Kevin Mayfield</span> if you run with the parameter -version 3.0 then -tx <a href=\"https://ontoserver.dataproducts.nhs.uk/fhir/\">https://ontoserver.dataproducts.nhs.uk/fhir/</a> should work</p>",
        "id": 200785661,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592082323
    },
    {
        "content": "<p>Yes the NHSD terminology server works (but then resource validation has errors).</p>\n<p>Which leads to: Should the terminology server be the same version as the IG?</p>",
        "id": 200800650,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592111208
    },
    {
        "content": "<p>Researched a little more and what I've found is:</p>\n<ul>\n<li>NHS Digital Terminology STU3 does validate codes in ValueSets</li>\n<li>ValueSet uri's are inconsistent between versions (this is logged)</li>\n<li>FHIR Validator does not like mixing versions (terminology and IG need to be same versions)</li>\n<li>Quality of validation using FHIR Validator and terminology server is very good</li>\n<li><a href=\"https://r4.ontoserver.csiro.au/fhir/\">https://r4.ontoserver.csiro.au/fhir/</a> doesn't contain UK Drug Extension</li>\n</ul>",
        "id": 200803830,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592118139
    },
    {
        "content": "<ul>\n<li>A terminology server (with UK SNOMED) is required (not using a -tx results in validation failure)</li>\n</ul>",
        "id": 200803930,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592118404
    },
    {
        "content": "<p>May need some workarounds to get a clean validation.</p>",
        "id": 200803936,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592118440
    },
    {
        "content": "<ul>\n<li><a href=\"https://ontoserver.dataproducts.nhs.uk\">https://ontoserver.dataproducts.nhs.uk</a> is on an old UK SNOMED version (20190807)</li>\n</ul>",
        "id": 200804036,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592118708
    },
    {
        "content": "<ul>\n<li><a href=\"https://r4.ontoserver.csiro.au\">https://r4.ontoserver.csiro.au</a> is on the current UK SNOMED version</li>\n</ul>",
        "id": 200804081,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592118766
    },
    {
        "content": "<blockquote>\n<p>FHIR Validator does not like mixing versions</p>\n</blockquote>\n<p>yes.</p>",
        "id": 200829869,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592162819
    },
    {
        "content": "<p>We are working to load the UK Edition on <a href=\"http://tx.fhir.org\">tx.fhir.org</a>. But the current loader code assumes that all of the content is provided in a single set of files, which isn't the case with the UK distribution. The Clinical and Drug extensions and the International edition are distributed in separate folders, which will need to be combined (accounting for the proper dependencies). I do have access to the distributions through TRUD, so that isn't a problem, but deciding what to load and how best to get it loaded is. Should we load the latest SNOMEDCT2_29.3.0_20200610000001 Clinical Edition release and the SNOMEDCT2_29.2.0_20200513000001 Drug Extension release (which I think is the latest - I need to double check that)? And maybe we should use the BETA releases, as that will be the structure going forward? The releases are pretty frequent, especially for the drugs and with the recent COVID-19 micro-releases, and we probably won't try to stay absolutely current with all of it. We appreciate any advice and help we can get from the UK community in figuring out what is the best way forward on this.</p>",
        "id": 201401820,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1592578941
    },
    {
        "content": "<p>@Michael Lawley may have some insights as I know they have worked with the peculiarities of the UK SNOMED edition.</p>",
        "id": 201420738,
        "sender_full_name": "Richard Kavanagh",
        "timestamp": 1592588600
    },
    {
        "content": "<p>Yes, I've discussed it a bit with Michael, already, and we'll likely discuss it further.  I think we're fairly clear on what needs to be done to load the content.  Long term I think that's going to need some changes to the loader code.  But I think what we most need to figure out right now is what extension/version/format combinations we should target for the initial content load and then how we plan to keep that content maintained (and on what frequency) going forward.</p>",
        "id": 201422062,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1592589320
    },
    {
        "content": "<p>what needs to change in the loader code?</p>",
        "id": 201782376,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592946005
    },
    {
        "content": "<p>The code needs to support specifying multiple source folders (snapshot or possibly full) for the content that need to be combined as the source of a complete edition, and then once the content has been combined to run the snapshot extraction algorithm on the combined content to create the edition that needs to be loaded.</p>",
        "id": 201783527,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1592946601
    },
    {
        "content": "<p>what's the combination rules? Everytime I've looked at something like this, there's redefinitions or versioning issues that mean that it's not just a matter of reading more files</p>",
        "id": 201783654,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592946655
    },
    {
        "content": "<p>That's the snapshot extraction algorithm.  I can locate a reference for you (or Michael can).  If you have other things to do (tongue in cheek question), I'm happy to take the lead on working on it (I'm sure with some of your help).</p>",
        "id": 201785009,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1592947237
    },
    {
        "content": "<p>sure a reference would be good</p>",
        "id": 201785579,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592947550
    },
    {
        "content": "<p>It's RF2 and because you're combining multiple packages you need to treat the content as if it conformed to the FULL ReleaseType and then compute a SNAPSHOT ReleaseType.  I'd like to be able to point at <a href=\"http://snomed.org/rf2\">http://snomed.org/rf2</a> but it seems that the real URL is <a href=\"http://snomed.org/rfs\">http://snomed.org/rfs</a><br>\nI had a quick look to try to point at the right page that talks about generating a SNAPSHOT from FULL, but failed -- I'm not sure such a page exists.</p>\n<p>You at least need to process the MDRS -  Module Dependency Reference Set (<a href=\"https://confluence.ihtsdotools.org/x/M4e2AQ\">https://confluence.ihtsdotools.org/x/M4e2AQ</a> or <a href=\"https://confluence.ihtsdotools.org/display/DOCRELFMT/5.2.12+Module+Dependency+Reference+Set\">https://confluence.ihtsdotools.org/display/DOCRELFMT/5.2.12+Module+Dependency+Reference+Set</a>) - which gives you a set of moduleId-effectiveTime pairs for the version you're importing.</p>\n<p>Then, for every \"component\" (identified by the id column) you take the row with the latest effectiveTime value as long as it is NOT GREATER than the effectiveTime from the corresponding pairs above with the same moduleId. (so it is not enough to just take the latest effective time; you always need to first filter against the MDRS pairs).</p>\n<p>All of this, and the fact that the files can't be assumed to be sorted in a useful manner, means that you need to load a huge pile of stuff into memory and/or do two passes over the content.</p>",
        "id": 201815381,
        "sender_full_name": "Michael Lawley",
        "timestamp": 1592980680
    },
    {
        "content": "<p>\"All of this, and the fact that the files can't be assumed to be sorted in a useful manner, means that you need to load a huge pile of stuff into memory and/or do two passes over the content.\"<br>\nYup used to blow stuff up when I was trying to combine the UK &amp; UK drugs into one..... eventually gave up as had other things to do.</p>",
        "id": 201959451,
        "sender_full_name": "Adam Flinton",
        "timestamp": 1593086408
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span> WRT your June 2020 post about the difficulty of loading the UK Edition onto <a href=\"http://tx.fhir.org\">tx.fhir.org</a>, because it was scattered across multiple files and zipped archives...you might try your luck again with the New! Simpler! Monolithic! Bundling of the UK extensions content. Its a snapshot-only distro across a single set of the 22-odd files that make up any well formatted SNOMED edition or extension release distro bundle. Content-wise, it therefore includes the union of the relevant International Edition plus (currently) the latest versions of the UK Clinical, Drug and Pathology extensions. Can be found on the dreaded TRUD here: <a href=\"https://isd.digital.nhs.uk/trud/users/guest/filters/0/categories/26/items/1799/releases\">https://isd.digital.nhs.uk/trud/users/guest/filters/0/categories/26/items/1799/releases</a>. New releases expected every 4 weeks, as per the schedule for releases of the UK Drug Extension component within.</p>",
        "id": 278722441,
        "sender_full_name": "Jeremy Rogers",
        "timestamp": 1649783190
    }
]