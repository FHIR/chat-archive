[
    {
        "content": "<p><a href=\"https://www.hl7.org/fhir/json.html#primitive\">https://www.hl7.org/fhir/json.html#primitive</a> We're using SOF python model classes to create a Bundle resource with MedicationRequest entries. The MedicationRequest resources we're trying to add as an entry are leveraging the concept of prepending an underscore to the \"intent\" element name because there's no data to populate from the backend. The open hapi FHIR server validates the \"_intent\" field with an extension but neither SOF fhirclient nor fhir.resources will validate \"_intent\". Has anyone else experienced this issue or have a suggestion?</p>",
        "id": 214788008,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1603850049
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269724\">Stephen Whitney</span> <a href=\"#narrow/stream/179218-python/topic/JSON.20representation.20of.20primitive.20elements.20(validation)/near/214788008\">said</a>:</p>\n<blockquote>\n<p><a href=\"https://www.hl7.org/fhir/json.html#primitive\">https://www.hl7.org/fhir/json.html#primitive</a> We're using SOF python model classes to create a Bundle resource with MedicationRequest entries. The MedicationRequest resources we're trying to add as an entry are leveraging the concept of prepending an underscore to the \"intent\" element name because there's no data to populate from the backend. The open hapi FHIR server validates the \"_intent\" field with an extension but neither SOF fhirclient nor fhir.resources will validate \"_intent\". Has anyone else experienced this issue or have a suggestion?</p>\n</blockquote>\n<p>adding <span class=\"user-mention\" data-user-id=\"191401\">@Eric Haas</span>  <span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span></p>",
        "id": 214834110,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1603891139
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span> I tested with beta 6.x.x version and this doesn't pass validation:</p>\n<p>\"_intent\": {<br>\n                    \"extension\": [<br>\n                        {<br>\n                            \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\">http://hl7.org/fhir/StructureDefinition/data-absent-reason</a>\",<br>\n                            \"valueCode\": \"unknown\"<br>\n                        }<br>\n                    ]<br>\n                },</p>\n<p>Am I doing something wrong? </p>\n<p>pydantic.error_wrappers.ValidationError: 1 validation error for MedicationRequest<br>\nintent<br>\n  field required (type=value_error.missing)</p>",
        "id": 214834853,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1603891498
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"269724\">@Stephen Whitney</span>  can you paste full json, so that I can test also</p>",
        "id": 214835283,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603891693
    },
    {
        "content": "<p>{<br>\n  \"resourceType\": \"MedicationRequest\",<br>\n  \"id\": \"1620518\",<br>\n  \"meta\": {<br>\n    \"versionId\": \"1\",<br>\n    \"lastUpdated\": \"2020-10-27T11:04:42.215+00:00\",<br>\n    \"source\": \"#z072VeAlQWM94jpc\",<br>\n    \"tag\": [ {<br>\n      \"system\": \"<a href=\"http://www.alpha.alp/use-case\">http://www.alpha.alp/use-case</a>\",<br>\n      \"code\": \"EX20\"<br>\n    } ]<br>\n  },<br>\n  \"text\": {<br>\n    \"status\": \"generated\",<br>\n    \"div\": \"&lt;div xmlns=\\\"http://www.w3.org/1999/xhtml\\\"&gt;\\n            &lt;p&gt;Prescription: Erythromycin 250 MG Oral Tablet\\n            &lt;/p&gt;\\n          &lt;/div&gt;\"<br>\n  },<br>\n  \"status\": \"completed\",<br>\n  \"_intent\": {<br>\n                    \"extension\": [<br>\n                        {<br>\n                            \"url\": \"<a href=\"http://hl7.org/fhir/StructureDefinition/data-absent-reason\">http://hl7.org/fhir/StructureDefinition/data-absent-reason</a>\",<br>\n                            \"valueCode\": \"unknown\"<br>\n                        }<br>\n                    ]<br>\n                },<br>\n  \"medicationReference\": {<br>\n    \"reference\": \"Medication/1620516\",<br>\n    \"display\": \"Erythromycin 250 MG Oral Tablet\"<br>\n  },<br>\n  \"subject\": {<br>\n    \"reference\": \"Patient/1620472\"<br>\n  },<br>\n  \"encounter\": {<br>\n    \"reference\": \"Encounter/1620506\",<br>\n    \"display\": \"Follow up encounter\"<br>\n  },<br>\n  \"authoredOn\": \"2018-06-16\",<br>\n  \"requester\": {<br>\n    \"reference\": \"Practitioner/1620502\",<br>\n    \"display\": \"Dr. Harold Hippocrates\"<br>\n  },<br>\n  \"reasonReference\": [ {<br>\n    \"reference\": \"Condition/1620514\",<br>\n    \"display\": \"Otitis Media\"<br>\n  } ],<br>\n  \"dosageInstruction\": [ {<br>\n    \"text\": \"250 mg 4 times per day for 10 days\",<br>\n    \"timing\": {<br>\n      \"repeat\": {<br>\n        \"boundsDuration\": {<br>\n          \"value\": 10,<br>\n          \"unit\": \"day\",<br>\n          \"system\": \"<a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>\",<br>\n          \"code\": \"d\"<br>\n        },<br>\n        \"frequency\": 4,<br>\n        \"period\": 1,<br>\n        \"periodUnit\": \"d\"<br>\n      }<br>\n    },<br>\n    \"doseAndRate\": [ {<br>\n      \"doseQuantity\": {<br>\n        \"value\": 250,<br>\n        \"unit\": \"mg\",<br>\n        \"system\": \"<a href=\"http://unitsofmeasure.org\">http://unitsofmeasure.org</a>\",<br>\n        \"code\": \"mg\"<br>\n      }<br>\n    } ]<br>\n  } ],<br>\n  \"priorPrescription\": {<br>\n    \"reference\": \"MedicationRequest/1620517\",<br>\n    \"display\": \"Amoxicillin prescription\"<br>\n  }<br>\n}</p>",
        "id": 214835656,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1603891857
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"269724\">@Stephen Whitney</span>  thanks a lot, I tested your json, there is nothing wrong with <code>_intent</code> value instead <code>intent</code> field value is missing as this field value is required.</p>",
        "id": 214836849,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603892382
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span> Does there need to be a preprocess to strip the _ from the incoming request or is there a more graceful way to handle? Responses with Data absence reason extension for primitive types coming from the HAPI framework need an _ to support the extension.</p>",
        "id": 214838928,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1603893302
    },
    {
        "content": "<p>I see thanks <span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span>. It passes validation using open hapi fhir server as written at <a href=\"http://hapi.fhir.org/baseR4/Bundle/$validate\">http://hapi.fhir.org/baseR4/Bundle/$validate</a></p>",
        "id": 214839115,
        "sender_full_name": "Stephen Whitney",
        "timestamp": 1603893368
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197108\">Jason Teeple</span> <a href=\"#narrow/stream/179218-python/topic/JSON.20representation.20of.20primitive.20elements.20(validation)/near/214838928\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"197422\">Md Nazrul Islam</span> Does there need to be a preprocess to strip the _ from the incoming request or is there a more graceful way to handle? Responses with Data absence reason extension for primitive types coming from the HAPI framework need an _ to support the extension.</p>\n</blockquote>\n<p>No,  it's fine with _, the problem here <code>intent</code> field is required</p>",
        "id": 214839830,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603893634
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"269724\">Stephen Whitney</span> <a href=\"#narrow/stream/179218-python/topic/JSON.20representation.20of.20primitive.20elements.20(validation)/near/214839115\">said</a>:</p>\n<blockquote>\n<p>I see thanks <span class=\"user-mention silent\" data-user-id=\"197422\">Md Nazrul Islam</span>. It passes validation using open hapi fhir server as written at <a href=\"http://hapi.fhir.org/baseR4/Bundle/$validate\">http://hapi.fhir.org/baseR4/Bundle/$validate</a></p>\n</blockquote>\n<p>Ok, that is something a little bit long discussion need to be done. Maybe there should be when <code>_intent</code> value is provided then the <code>intent</code> field should be optional.</p>",
        "id": 214840441,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603893851
    },
    {
        "content": "<p>I think intent being optional would be key - when our ETL process doesn't have a value, having to choose one is misleading. A third party app would have to know to look for an underscore value of an element to see if that element is to be trusted or not</p>",
        "id": 214850390,
        "sender_full_name": "Damian Smith",
        "timestamp": 1603898068
    },
    {
        "content": "<p>Added issue <a href=\"https://github.com/nazrulworld/fhir.resources/issues/40\">https://github.com/nazrulworld/fhir.resources/issues/40</a> here</p>",
        "id": 214894657,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603917634
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191315\">@Josh Mandel</span> Would you have any insights on how SOF would handle the above situation?</p>",
        "id": 214974580,
        "sender_full_name": "Jason Teeple",
        "timestamp": 1603982045
    },
    {
        "content": "<p>Certainly SMART doesn't impose any limits on how FHIR JSON works -- it sounds like there's some question about how FHIR treats extensions that are present <em>in place of</em> required elements.  <a href=\"https://www.hl7.org/fhir/extensibility.html#Special-Case\">https://www.hl7.org/fhir/extensibility.html#Special-Case</a> provides the official guidance to corroborate <span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span>'s note above that \"Maybe... when _intent value is provided then the intent field should be optional.\" -- indeed, required elements can be missing if extensions are provided.</p>",
        "id": 214981981,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1603984987
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> <a href=\"#narrow/stream/179218-python/topic/JSON.20representation.20of.20primitive.20elements.20(validation)/near/214981981\">said</a>:</p>\n<blockquote>\n<p>Certainly SMART doesn't impose any limits on how FHIR JSON works -- it sounds like there's some question about how FHIR treats extensions that are present <em>in place of</em> required elements.  <a href=\"https://www.hl7.org/fhir/extensibility.html#Special-Case\">https://www.hl7.org/fhir/extensibility.html#Special-Case</a> provides the official guidance to corroborate <span class=\"user-mention silent\" data-user-id=\"197422\">Md Nazrul Islam</span>'s note above that \"Maybe... when _intent value is provided then the intent field should be optional.\" -- indeed, required elements can be missing if extensions are provided.</p>\n</blockquote>\n<p>Thanks a lot for the clarification</p>",
        "id": 214982665,
        "sender_full_name": "Md Nazrul Islam",
        "timestamp": 1603985247
    },
    {
        "content": "<p>This is part of this issue: <a href=\"https://github.com/smart-on-fhir/client-py/issues/30\">https://github.com/smart-on-fhir/client-py/issues/30</a></p>",
        "id": 215004723,
        "sender_full_name": "Pascal Pfiffner",
        "timestamp": 1603994167
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"197108\">Jason Teeple</span> <a href=\"#narrow/stream/179218-python/topic/JSON.20representation.20of.20primitive.20elements.20(validation)/near/214974580\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191315\">Josh Mandel</span> Would you have any insights on how SOF would handle the above situation?</p>\n</blockquote>\n<p>I encountered the same problem. At the moment, with SOF you can't have extensions like dataAbsentReason on primitive types. The only workaround I found was handling extensions on primitives with Python's built-in json module outside of fhirclient.</p>",
        "id": 215125577,
        "sender_full_name": "Julian Sass",
        "timestamp": 1604078704
    },
    {
        "content": "<p>I see now you're referring not to SMART on FHIR in general, but to the python bindings at <a href=\"http://github.com/smart-on-fhir/client-py\">github.com/smart-on-fhir/client-py</a>. <span class=\"user-mention\" data-user-id=\"191660\">@Harold Solbrig</span> I wonder if you have eyes here?</p>",
        "id": 215129679,
        "sender_full_name": "Josh Mandel",
        "timestamp": 1604080752
    }
]