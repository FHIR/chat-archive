[
    {
        "content": "<p>I am trying to use fastAPI + fhir.resources.  However,  I am having some issues with it and the OpenAPI docs.  <br>\nhere is my attempt  in python 3.7.3 following the basic fastAPI tutorial but substituting in the fhir.resources model:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">fastapi</span> <span class=\"kn\">import</span> <span class=\"n\">FastAPI</span>\n<span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.practitioner</span> <span class=\"kn\">import</span> <span class=\"n\">Period</span>\n<span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.fhirtypes</span> <span class=\"kn\">import</span> <span class=\"n\">PeriodType</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">FastAPI</span><span class=\"p\">()</span>\n\n<span class=\"nd\">@app</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"p\">(</span><span class=\"s2\">\"/period/\"</span><span class=\"p\">,</span> <span class=\"n\">response_model</span><span class=\"o\">=</span><span class=\"n\">PeriodType</span><span class=\"p\">,</span> <span class=\"n\">response_model_exclude_unset</span><span class=\"o\">=</span><span class=\"kc\">False</span><span class=\"p\">,</span> <span class=\"n\">response_model_exclude_none</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span> <span class=\"nf\">create_item</span><span class=\"p\">(</span><span class=\"n\">period</span><span class=\"p\">:</span> <span class=\"n\">Period</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">period</span>\n</code></pre></div>\n<p>When trying to execute using this object in swagger:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n  <span class=\"nt\">\"resource_type\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Period\"</span><span class=\"p\">,</span>\n  <span class=\"nt\">\"id\"</span><span class=\"p\">:</span> <span class=\"s2\">\"string\"</span>\n<span class=\"p\">}</span>\n</code></pre></div>\n<p>I get this error:<br>\nTypeError: dict() got an unexpected keyword argument 'exclude_unset'</p>",
        "id": 234935249,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618615520
    },
    {
        "content": "<p>am I missing something obvious in fastAPI.. If we could use fastAPI and get swagger docs out of the box that would be huge.</p>",
        "id": 234935395,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618615637
    },
    {
        "content": "<p>more on this,  the models don't support all of <a href=\"https://pydantic-docs.helpmanual.io/usage/exporting_models/\">Pydantic's dict() method arguments</a>:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.period</span> <span class=\"kn\">import</span> <span class=\"n\">Period</span>\n<span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.fhirtypes</span> <span class=\"kn\">import</span> <span class=\"n\">PeriodType</span>\n\n<span class=\"n\">p</span> <span class=\"o\">=</span> <span class=\"n\">Period</span><span class=\"p\">()</span>\n<span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"n\">exclude_unset</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">))</span>\n\n<span class=\"n\">Traceback</span> <span class=\"p\">(</span><span class=\"n\">most</span> <span class=\"n\">recent</span> <span class=\"n\">call</span> <span class=\"n\">last</span><span class=\"p\">):</span>\n  <span class=\"n\">File</span> <span class=\"s2\">\"/Users/ehaas/Documents/Python/fastAPI_tutorial/main.py\"</span><span class=\"p\">,</span> <span class=\"n\">line</span> <span class=\"mi\">7</span><span class=\"p\">,</span> <span class=\"ow\">in</span> <span class=\"o\">&lt;</span><span class=\"n\">module</span><span class=\"o\">&gt;</span>\n    <span class=\"nb\">print</span><span class=\"p\">(</span><span class=\"n\">p</span><span class=\"o\">.</span><span class=\"n\">dict</span><span class=\"p\">(</span><span class=\"n\">exclude_unset</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">))</span>\n<span class=\"ne\">TypeError</span><span class=\"p\">:</span> <span class=\"nb\">dict</span><span class=\"p\">()</span> <span class=\"n\">got</span> <span class=\"n\">an</span> <span class=\"n\">unexpected</span> <span class=\"n\">keyword</span> <span class=\"n\">argument</span> <span class=\"s1\">'exclude_unset'</span>\n<span class=\"p\">[</span><span class=\"n\">Finished</span> <span class=\"ow\">in</span> <span class=\"mf\">0.33</span><span class=\"n\">s</span><span class=\"p\">]</span>\n</code></pre></div>",
        "id": 235201610,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618846552
    },
    {
        "content": "<p>looking at the inheritance of Period:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"p\">[</span><span class=\"o\">&lt;</span><span class=\"k\">class</span> <span class=\"err\">'</span><span class=\"nc\">fhir</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">period</span><span class=\"o\">.</span><span class=\"n\">Period</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"n\">fhir</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">element</span><span class=\"o\">.</span><span class=\"n\">Element</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"n\">fhir</span><span class=\"o\">.</span><span class=\"n\">resources</span><span class=\"o\">.</span><span class=\"n\">fhirabstractmodel</span><span class=\"o\">.</span><span class=\"n\">FHIRAbstractModel</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"n\">pydantic</span><span class=\"o\">.</span><span class=\"n\">main</span><span class=\"o\">.</span><span class=\"n\">BaseModel</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"n\">pydantic</span><span class=\"o\">.</span><span class=\"n\">utils</span><span class=\"o\">.</span><span class=\"n\">Representation</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"n\">abc</span><span class=\"o\">.</span><span class=\"n\">ABC</span><span class=\"s1\">'&gt;, &lt;class '</span><span class=\"nb\">object</span><span class=\"s1\">'&gt;]</span>\n</code></pre></div>",
        "id": 235203602,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618847362
    },
    {
        "content": "<p>I am in over my head with python subclassing and pydantic but the FHIRBaseClass seems to be passing these arguments through so why are the models not allowing it?</p>",
        "id": 235210773,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618850062
    },
    {
        "content": "<p>I'm not sure what's wrong - but I can't recreate your issue.</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>can@T410-W10 ~ <span class=\"o\">()</span> $ pip3 install fhir fhir.resources\nCollecting fhir\n  Using cached fhir-0.0.4.tar.gz <span class=\"o\">(</span><span class=\"m\">18</span> kB<span class=\"o\">)</span>\nBuilding wheels <span class=\"k\">for</span> collected packages: fhir\n  Building wheel <span class=\"k\">for</span> fhir <span class=\"o\">(</span>setup.py<span class=\"o\">)</span> ... <span class=\"k\">done</span>\n  Created wheel <span class=\"k\">for</span> fhir: <span class=\"nv\">filename</span><span class=\"o\">=</span>fhir-0.0.4-py3-none-any.whl <span class=\"nv\">size</span><span class=\"o\">=</span><span class=\"m\">16555</span> <span class=\"nv\">sha256</span><span class=\"o\">=</span>03bc66e2374d97729a7a856d49dd2a7318ba999205b306a6173ff5ca168296d9\n  Stored <span class=\"k\">in</span> directory: /Users/can/Library/Caches/pip/wheels/e6/ac/1b/7fecf3a4531dd5b8129e0b07c606f940bb30633a4b95ac6023\nSuccessfully built fhir\nInstalling collected packages: fhir\nSuccessfully installed fhir-0.0.4\nCollecting fhir.resources\n  Downloading fhir.resources-6.1.0-py2.py3-none-any.whl <span class=\"o\">(</span><span class=\"m\">2</span>.3 MB<span class=\"o\">)</span>\n     <span class=\"p\">|</span>████████████████████████████████<span class=\"p\">|</span> <span class=\"m\">2</span>.3 MB <span class=\"m\">1</span>.6 MB/s\nCollecting pydantic<span class=\"o\">[</span>email<span class=\"o\">]</span>&gt;<span class=\"o\">=</span><span class=\"m\">1</span>.7.2\n  Downloading pydantic-1.8.1-cp38-cp38-macosx_10_9_x86_64.whl <span class=\"o\">(</span><span class=\"m\">2</span>.6 MB<span class=\"o\">)</span>\n     <span class=\"p\">|</span>████████████████████████████████<span class=\"p\">|</span> <span class=\"m\">2</span>.6 MB <span class=\"m\">17</span>.5 MB/s\nCollecting typing-extensions&gt;<span class=\"o\">=</span><span class=\"m\">3</span>.7.4.3\n  Downloading typing_extensions-3.7.4.3-py3-none-any.whl <span class=\"o\">(</span><span class=\"m\">22</span> kB<span class=\"o\">)</span>\nCollecting email-validator&gt;<span class=\"o\">=</span><span class=\"m\">1</span>.0.3<span class=\"p\">;</span> <span class=\"nv\">extra</span> <span class=\"o\">==</span> <span class=\"s2\">\"email\"</span>\n  Downloading email_validator-1.1.2-py2.py3-none-any.whl <span class=\"o\">(</span><span class=\"m\">17</span> kB<span class=\"o\">)</span>\nRequirement already satisfied: idna&gt;<span class=\"o\">=</span><span class=\"m\">2</span>.0.0 <span class=\"k\">in</span> /usr/local/lib/python3.8/site-packages <span class=\"o\">(</span>from email-validator&gt;<span class=\"o\">=</span><span class=\"m\">1</span>.0.3<span class=\"p\">;</span> <span class=\"nv\">extra</span> <span class=\"o\">==</span> <span class=\"s2\">\"email\"</span>-&gt;pydantic<span class=\"o\">[</span>email<span class=\"o\">]</span>&gt;<span class=\"o\">=</span><span class=\"m\">1</span>.7.2-&gt;fhir.resources<span class=\"o\">)</span> <span class=\"o\">(</span><span class=\"m\">2</span>.10<span class=\"o\">)</span>\nCollecting dnspython&gt;<span class=\"o\">=</span><span class=\"m\">1</span>.15.0\n  Downloading dnspython-2.1.0-py3-none-any.whl <span class=\"o\">(</span><span class=\"m\">241</span> kB<span class=\"o\">)</span>\n     <span class=\"p\">|</span>████████████████████████████████<span class=\"p\">|</span> <span class=\"m\">241</span> kB <span class=\"m\">16</span>.7 MB/s\nInstalling collected packages: typing-extensions, dnspython, email-validator, pydantic, fhir.resources\nSuccessfully installed dnspython-2.1.0 email-validator-1.1.2 fhir.resources-6.1.0 pydantic-1.8.1 typing-extensions-3.7.4.3\n\ncan@T410-W10 ~ <span class=\"o\">()</span> $ ipython\nPython <span class=\"m\">3</span>.8.5 <span class=\"o\">(</span>default, Jul <span class=\"m\">21</span> <span class=\"m\">2020</span>, <span class=\"m\">10</span>:42:08<span class=\"o\">)</span>\nType <span class=\"s1\">'copyright'</span>, <span class=\"s1\">'credits'</span> or <span class=\"s1\">'license'</span> <span class=\"k\">for</span> more information\nIPython <span class=\"m\">7</span>.16.1 -- An enhanced Interactive Python. Type <span class=\"s1\">'?'</span> <span class=\"k\">for</span> help.\n\nIn <span class=\"o\">[</span><span class=\"m\">1</span><span class=\"o\">]</span>: %cpaste\nPasting code<span class=\"p\">;</span> enter <span class=\"s1\">'--'</span> alone on the line to stop or use Ctrl-D.\n:from fhir.resources.period import Period\nfrom fhir.resources.fhirtypes import PeriodType\n\n<span class=\"nv\">p</span> <span class=\"o\">=</span> Period<span class=\"o\">()</span>\nprint<span class=\"o\">(</span>p.dict<span class=\"o\">(</span><span class=\"nv\">exclude_unset</span><span class=\"o\">=</span>True<span class=\"o\">))</span>::::\n:--\n<span class=\"o\">{}</span>\n\nIn <span class=\"o\">[</span><span class=\"m\">2</span><span class=\"o\">]</span>:\n</code></pre></div>",
        "id": 235230569,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1618858574
    },
    {
        "content": "<p>However, the online docs for pydantic suggest that <code>exclude_unset</code> has replaced an older, deprecated keyword <code>skip_defaults</code> - so maybe your installed pydantic module is out of date...</p>",
        "id": 235231032,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1618858765
    },
    {
        "content": "<p>thanks <span class=\"user-mention\" data-user-id=\"233081\">@Carl Anderson</span>  I will check my environmental variables</p>",
        "id": 235235040,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618860412
    },
    {
        "content": "<p>You might try <code>pip show pydantic</code></p>",
        "id": 235238371,
        "sender_full_name": "Carl Anderson",
        "timestamp": 1618861922
    },
    {
        "content": "<p>I updated my environment from python 3.7.3 to latest version of python 3.9.4 and that seemed to do the trick.</p>",
        "id": 235246874,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618865636
    },
    {
        "content": "<p>also tried a new 3.7.3 environment and that works too</p>",
        "id": 235248143,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618866078
    },
    {
        "content": "<p>I am unable to get the swagger UI to display the resource_type on the response.  I have tried several method arguments and a couple of string values but does anyone know a simple way to get it  to display?</p>",
        "id": 235374388,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618936384
    },
    {
        "content": "<p>for example this code:</p>\n<div class=\"codehilite\" data-code-language=\"Python\"><pre><span></span><code><span class=\"kn\">from</span> <span class=\"nn\">fastapi</span> <span class=\"kn\">import</span> <span class=\"n\">FastAPI</span>\n<span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.period</span> <span class=\"kn\">import</span> <span class=\"n\">Period</span>\n<span class=\"kn\">from</span> <span class=\"nn\">fhir.resources.fhirtypes</span> <span class=\"kn\">import</span> <span class=\"n\">PeriodType</span>\n\n<span class=\"n\">app</span> <span class=\"o\">=</span> <span class=\"n\">FastAPI</span><span class=\"p\">()</span>\n\n<span class=\"nd\">@app</span><span class=\"o\">.</span><span class=\"n\">post</span><span class=\"p\">(</span><span class=\"s2\">\"/period/\"</span><span class=\"p\">,</span> <span class=\"n\">response_model</span><span class=\"o\">=</span><span class=\"n\">Period</span><span class=\"p\">,</span> <span class=\"n\">response_model_exclude_none</span><span class=\"o\">=</span><span class=\"kc\">True</span><span class=\"p\">)</span>\n<span class=\"k\">async</span> <span class=\"k\">def</span> <span class=\"nf\">create_item</span><span class=\"p\">(</span><span class=\"n\">period</span><span class=\"p\">:</span> <span class=\"n\">Period</span><span class=\"p\">):</span>\n    <span class=\"k\">return</span> <span class=\"n\">period</span>\n</code></pre></div>\n<p>results in this:</p>\n<p><a href=\"/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/OCKoLIYZFMTS4PwSppoJFooH/image.png\"></a></div>",
        "id": 235375143,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618936657
    },
    {
        "content": "<p>also <span class=\"user-mention\" data-user-id=\"197422\">@Md Nazrul Islam</span>  what is the difference in the the response_model being \"Period_type\" instead of  \"Period\".  I didn't see any difference in behavior in my simple little Swagger example?</p>",
        "id": 235375421,
        "sender_full_name": "Eric Haas",
        "timestamp": 1618936782
    }
]