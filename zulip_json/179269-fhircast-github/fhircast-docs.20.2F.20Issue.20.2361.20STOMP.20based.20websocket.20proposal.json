[
    {
        "content": "<p>gkustas <a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-468660259\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-468660259\">commented</a> on <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a></p>\n<blockquote>\n<p>@isaacvetter, @wmaethner  - What is the plan for putting this into the spec for the May ballot? I have some concerns about the status of this proposal as well as the proposal that websockets will be used for more than just notifications sent from the hub to the client. I think it may be overkill and hinder the efforts of PACS developers - especially those with limited resources. I am moving forward with a prototype that:</p>\n<p>1. Uses a \"proprietary\" authentication/authorization scheme in order for a client to obtain a topic (user session id). This is obviously essential for a working prototype. <br>\n2. Uses websockets for Hub-&gt;client notifications only. All other communication is done using the \"standard\" REST methods. NOTE: Subscibe is slightly altered for websocket clients per our modification to the FHIRCast spec.<br>\n3. Uses Raw data for json notifications and their responses. </p>\n<p>Other than these differences, the prototype will not veer from the original FHIRCast/FHIR/Websub specifications. </p>\n<p>Don't get me wrong - @bvdh has done an amazing job with this and other suggestions. I'm getting pushy because I am under pressure to get something \"working\" and demonstrable very soon. </p>\n</blockquote>",
        "id": 159711104,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1551445948
    },
    {
        "content": "<p>bvdh <a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404\">commented</a> on <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a></p>\n<blockquote>\n<p>I agree that we should decide on how to take this further.</p>\n<p>The reasoning behind suggesting STOMP were<br>\n    • open standard <br>\n    • defines an \"over the wire protocol\" that we need anyway (character coding, framing, message formats,  …)<br>\n    • has been implemented and is being used by many systems<br>\n    • libraries are available for all commonly used platforms (java, .net, angular, jquery,…)</p>\n<p>Basically, my thought was if something exists that contains the stuff we need, we better use it instead of defining something of our own.  Also, as there are libraries available, it should be easy to implement for most parties.</p>\n<p>I'm open for proposals that suggest alternatives for STOMP, but we should be careful to not step into the trap of trying to re-invent the wheel.</p>\n</blockquote>",
        "id": 159904682,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1551698283
    },
    {
        "content": "<p>gkustas <a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469320365\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469320365\">commented</a> on <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a></p>\n<blockquote>\n<p>I'll attempt to answer both of your points in one answer Bas. I've gave the<br>\nsame questions some thought as I began implementation.</p>\n<p>I also asked myself \"how should we identify the subscription\"? Then I<br>\nthought about it more and realized we don't. In my Hub, I accept the<br>\nsubscription if the the topic is validated, and store it (currently) in a<br>\ncollection of all subscribers, indexed by the topic. Remember, The topic is<br>\ncreated during authentication and can be validated in the database of<br>\nconfigured applications and user identities (see my proposal for<br>\nauthentication - I think the same should apply for an OAuth<br>\nimplementation).</p>\n<p>So... Per the WebSub spec, all subscribers receive events - even the<br>\npublisher of the  event. Therefor, when the Hub receives an event, it<br>\npublishes to every subscriber in my collection.</p>\n<p>As far as the STOMP protocol goes - I'll say again that the only \"message\"<br>\nwe currently have is the notification event, and that is already defined in<br>\nFHIR. So, if we add messages other than context (say for example, meta data<br>\nlike measurements, procedure details, etc.), they would also be defined by<br>\nFHIR. The FHIR spec already clearly defines the JSON and XML formats.<br>\nHowever - because we are talking \"WSS\" and not \"HTTPS\", there is the issue<br>\nof the headers. Martin Bellemeur had a nice recommendation, which I also<br>\nincluded in my \"Prototype Proposal\" document. We simply wrap the FHIR JSON<br>\nand header info into a simple JSON object:<br>\n{<br>\n\"header\" : { &lt;header data here&gt; }<br>\n\"body\": { &lt;FHIR object here&gt; }<br>\n}</p>\n<p>My personal opinion is that it is much easier to build simple classes i<br>\nnour Hub and Client, and \"bind\" them to JSON than it is to implement the<br>\nSTOMP protocol. If we provide numerous samples (Javascript, C#, Java,<br>\netc...), it should be easy for all vendors to implement.</p>\n<p>BUT... That's all my opinion and I'll go along with the consensus. The main<br>\nthing is to make FHIRCast a standard.</p>\n<p>I'll be glad to have a telephone conference at most times. I am flexible.</p>\n<p>On Mon, Mar 4, 2019 at 6:18 AM Bas van den Heuvel &lt;<a href=\"mailto:notifications@github.com\" title=\"mailto:notifications@github.com\">notifications@github.com</a>&gt;<br>\nwrote:</p>\n<blockquote>\n<p>I agree that we should decide on how to take this further.</p>\n<p>The reasoning behind suggesting STOMP were<br>\n• open standard<br>\n• defines an \"over the wire protocol\" that we need anyway (character<br>\ncoding, framing, message formats, …)<br>\n• has been implemented and is being used by many systems<br>\n• libraries are available for all commonly used platforms (java, .net,<br>\nangular, jquery,…)</p>\n<p>Basically, my thought was if something exists that contains the stuff we<br>\nneed, we better use it instead of defining something of our own. Also, as<br>\nthere are libraries available, it should be easy to implement for most<br>\nparties.</p>\n<p>I'm open for proposals that suggest alternatives for STOMP, but we should<br>\nbe careful to not step into the trap of trying to re-invent the wheel.</p>\n<p>—<br>\nYou are receiving this because you commented.<br>\nReply to this email directly, view it on GitHub<br>\n&lt;<a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404\">https://github.com/HL7/fhircast-docs/issues/61#issuecomment-469216404</a>&gt;,<br>\nor mute the thread<br>\n&lt;<a href=\"https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_\" target=\"_blank\" title=\"https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_\">https://github.com/notifications/unsubscribe-auth/AFw87tJ1-X_wVOU51LEKWAATnXJyIBFuks5vTQDrgaJpZM4aGLV_</a>&gt;<br>\n.</p>\n</blockquote>\n<p>-- <br>\nGeorge Kustas</p>\n</blockquote>",
        "id": 159928040,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1551717301
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839338\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839338\">commented</a> on <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a>:</p>\n<blockquote>\n<p>## :telephone_receiver: II Working Group Vote (5-22-2019)</p>\n<p>Meeting notes: <a href=\"https://confluence.hl7.org/display/IMIN/Teleconferences\" target=\"_blank\" title=\"https://confluence.hl7.org/display/IMIN/Teleconferences\">https://confluence.hl7.org/display/IMIN/Teleconferences</a></p>\n<p>@isaacvetter  moved the following disposition, seconded by @gkustas </p>\n<p><strong>Disposition:</strong> We will move forward with extending Websub to incorporate websocket support in lieu of the more complete and complex alternative messaging framework specified in <a href=\"https://stomp.github.io/stomp-specification-1.2.html\" target=\"_blank\" title=\"https://stomp.github.io/stomp-specification-1.2.html\">STOMP</a>. We will publish PR #57 on <a href=\"http://fhircast.org\" target=\"_blank\" title=\"http://fhircast.org\">fhircast.org</a>. We will modify the approach described in #57 to allow the subscriber to connect over <code>wss:</code> to a hub-provided url in the subscription response, instead of connecting directly to the <code>hub.topic</code> as a url. We will investigate replicating the verification of intent step from Websub when websockets is used. </p>\n<p><strong>Disposition Comment:</strong> Further, we will look to <a href=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_8.10.4.html\" target=\"_blank\" title=\"http://dicom.nema.org/medical/dicom/current/output/chtml/part18/sect_8.10.4.html\">DICOMWeb's use of websockets</a>.  </p>\n<p><span aria-label=\"+1\" class=\"emoji emoji-1f44d\" role=\"img\" title=\"+1\">:+1:</span> For: 13<br>\n<span aria-label=\"expressionless\" class=\"emoji emoji-1f611\" role=\"img\" title=\"expressionless\">:expressionless:</span> Abstain: 2<br>\n<span aria-label=\"-1\" class=\"emoji emoji-1f44e\" role=\"img\" title=\"-1\">:-1:</span> Against: 0</p>\n<p><span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span> The motion passed! <span aria-label=\"tada\" class=\"emoji emoji-1f389\" role=\"img\" title=\"tada\">:tada:</span></p>\n</blockquote>",
        "id": 166275800,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1558536986
    },
    {
        "content": "<p>isaacvetter <a href=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839517\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61#issuecomment-494839517\">commented</a> on <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a>:</p>\n<blockquote>\n<p>@bvdh - mind if I close this issue?</p>\n</blockquote>",
        "id": 166275831,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1558537010
    },
    {
        "content": "<p>bvdh closed <a href=\"https://github.com/HL7/fhircast-docs/issues/61\" target=\"_blank\" title=\"https://github.com/HL7/fhircast-docs/issues/61\">Issue #61</a>:</p>\n<blockquote>\n<p>Based on the discussions in the 20th connecthaton WGM, I wrote down a proposed fhir-cast websocket spec. This has been tested in the <a href=\"https://github.com/PhilipsOnFhir/fhir-cast\" target=\"_blank\" title=\"https://github.com/PhilipsOnFhir/fhir-cast\">https://github.com/PhilipsOnFhir/fhir-cast</a> repository.</p>\n<p># FHIR-CAST WEBSOCKET update<br>\nThis implementation implemnents some proposed changes of the FHIR cast <br>\nSplit the specification into(<a href=\"http://fhircast.org/\" target=\"_blank\" title=\"http://fhircast.org/\">http://fhircast.org/</a>) specification.</p>\n<p>## Specification format<br>\nWe propose to split the specifiaction into three layers:<br>\n 1. channel protocol<br>\n 2. subscribe/unsubscribe and event type<br>\n 3. Event definitions<br>\n## Channel protocols<br>\nChannel protocols are the the different protocols that fhir-cast can use to connect to clients.   <br>\nThis implementation of fhir-cast implements three different<br>\n 1. WebSub (exisiting spec)<br>\n 2. Websockets (see below)<br>\n 3. pull based context (exisiting spec)<br>\nIn order to separate the channels on different end-points:</p>\n<ul>\n<li>WebSub: \\&lt;baseurl&gt;/\\&lt;topic&gt;/websub  </li>\n<li>WebSocket: \\&lt;baseurl&gt;/websocket</li>\n<li>Context: \\&lt;baseurl&gt;/\\&lt;topic&gt;/context</li>\n</ul>\n<p>GET on \\&lt;baseurl&gt;/\\&lt;topic&gt; will give you a list of the supported protocols.</p>\n<p># Websocket<br>\nThe websocket part uses STOMP 1.2.   <br>\nSome functionality is not required for FHIR CAST. Clients and server SHALL implement the required functionality and SHOULD implement the other.</p>\n<p>## STOMP subset<br>\nWe will be using STOMP 1.2 over WebSocket. Not all functionality from STOM is required.<br>\nThe table below indicates the functionality that MAY be unsupported. It is RECOMMENDED that <br>\nthe client and server implement the other functionality required by STOMP although it will <br>\nnot be used by this specification.</p>\n<p>The following table shows the support requirements for the different STOMP messages.<br>\n| Message | Source | Status | Description |  <br>\n| --- | --- | --- | --- |   <br>\n| CONNECT | Client  REQUIRED    Connect to websocket<br>\n| SEND | Client REQUIRED    <br>\n| SUBSCRIBE | Client | REQUIRED | Subscribe to channel<br>\n| UNSUBSCRIBE | Client  | REQUIRED | Unsubscribe from channel<br>\n| BEGIN | Client | OPTIONAL | Start transaction<br>\n| COMMIT | Client | OPTIONAL | Commit transaction<br>\n| ABORT | Client | OPTIONAL | Abort transaction<br>\n| ACK | Client | REQUIRED | Acknowledge<br>\n| NACK | Client | REQUIRED | Not Acknowledge<br>\n| DISCONNECT | Client | REQUIRED | Disconnect websocket<br>\n| MESSAGE | Server | REQUIRED | Send message to client<br>\n| RECEIPT | Server | REQUIRED | Indicate receipt content<br>\n| ERROR Server | REQUIRED | Indicate error occurred</p>\n<p>## Destinations<br>\nClients send messages to destinations, a destination is a directory like name on the server.  <br>\nAll FhirCast destinations are targetting the hube will be prefixed with /hub/.  <br>\nAll FhirCast destinations are targetting the spplications will be prefixed with /app/.  </p>\n<p>### Client--&gt;Server <br>\nClient--&gt;Server  communication SHALL use the following pattern:<br>\n    /hub/fhircast/\\&lt;topic&gt;/<br>\nwhere<br>\n    \\&lt;clientid&gt;: is a unique id of the client, e.g. the client-id used in OAUth</p>\n<p>### Server -&gt;Client<br>\nServer -&gt;Client SHALL use the following destinations:<br>\n    /app/fhircast/&lt;topic&gt;/&lt;event&gt;<br>\nwhere<br>\n    \\&lt;clientid&gt;:    is a unique id of the client, e.g. the client-id used in Oauth<br>\n    \\&lt;event&gt;    is the event name/id the client sends a message to</p>\n<p>Implementations can distinguish on OAuth role, adding client-id makes it easier to filter who receives what.</p>\n<p>## Use cases<br>\n### Client Subscribe/ Unsubscribe<br>\nAll clients can register for events on the websocket endpoint.</p>\n<p><strong>SUBSCRIBE /hub/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>  <br>\n    subscribe app for event \\&lt;event&gt; on topic \\&lt;topic&gt;</p>\n<p><strong>UNSUBSCRIBE /hub/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>   <br>\n    Unsubscribe for the event on the topic.</p>\n<p><strong>Deny subscription</strong>   <br>\n    TBD</p>\n<p>### Sending events<br>\n#### Server sends event   <br>\n<strong>MESSAGE /app/fhircast/topic&gt;/&lt;event&gt; Event</strong>  <br>\nThe Event is formatted as a WebSub event. E.g. <br>\nTHe event is formated as is displayed below:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n<span class=\"err\">event</span><span class=\"nt\">&quot;: {</span>\n<span class=\"nt\">    &quot;</span><span class=\"err\">hub.topic</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">https</span><span class=\"p\">:</span><span class=\"err\">//hub.example.com/</span><span class=\"mi\">7</span><span class=\"err\">jaa</span><span class=\"mi\">86</span><span class=\"err\">kgdudewiaq</span><span class=\"mi\">0</span><span class=\"err\">wtu</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">    &quot;</span><span class=\"err\">hub.event</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">close-patient-chart</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">    &quot;</span><span class=\"err\">context</span><span class=\"s2\">&quot;: [</span>\n<span class=\"s2\">      {</span>\n<span class=\"s2\">        &quot;</span><span class=\"err\">key</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">patient</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">        &quot;</span><span class=\"err\">resource</span><span class=\"s2\">&quot;: {</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">resourceType</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">Patient</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">id</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mf\">798E4</span><span class=\"err\">MyMcpCWHab</span><span class=\"mi\">9</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">identifier</span><span class=\"s2\">&quot;: [</span>\n<span class=\"s2\">            {</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">system</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">urn</span><span class=\"p\">:</span><span class=\"err\">oid</span><span class=\"p\">:</span><span class=\"mf\">1.2</span><span class=\"err\">.</span><span class=\"mf\">840.114350</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">value</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mi\">1345687</span><span class=\"s2\">&quot;</span>\n<span class=\"s2\">            },</span>\n<span class=\"s2\">            {</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">system</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">urn</span><span class=\"p\">:</span><span class=\"err\">oid</span><span class=\"p\">:</span><span class=\"mf\">1.2</span><span class=\"err\">.</span><span class=\"mf\">840.114350</span><span class=\"err\">.</span><span class=\"mf\">1.13</span><span class=\"err\">.</span><span class=\"mf\">861.1</span><span class=\"err\">.</span><span class=\"mf\">7.5</span><span class=\"err\">.</span><span class=\"mf\">737384.27000</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">value</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mi\">7539</span><span class=\"err\">&quot;</span>\n            <span class=\"p\">}</span>\n          <span class=\"err\">]</span>\n        <span class=\"err\">}</span>\n      <span class=\"err\">}</span>\n    <span class=\"err\">]</span>\n<span class=\"err\">}</span>\n</pre></div>\n\n\n<p>#### Clients updates context<br>\n<strong>MESSAGE /app/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>  <br>\nSend the event to the event endpoint. The implementation SHALL refuse messages send to the wrong endpoint.</p>\n</blockquote>",
        "id": 166338092,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1558595411
    }
]