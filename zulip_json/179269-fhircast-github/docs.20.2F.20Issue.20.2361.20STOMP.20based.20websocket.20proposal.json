[
    {
        "content": "<p>bvdh opened <a href=\"https://github.com/fhircast/docs/issues/61\" target=\"_blank\" title=\"https://github.com/fhircast/docs/issues/61\">Issue #61</a></p>\n<blockquote>\n<p>Based on the discussions in the 20th connecthaton WGM, I wrote down a proposed fhir-cast websocket spec. This has been tested in the <a href=\"https://github.com/PhilipsOnFhir/fhir-cast\" target=\"_blank\" title=\"https://github.com/PhilipsOnFhir/fhir-cast\">https://github.com/PhilipsOnFhir/fhir-cast</a> repository.</p>\n<p># FHIR-CAST WEBSOCKET update<br>\nThis implementation implemnents some proposed changes of the FHIR cast <br>\nSplit the specification into(<a href=\"http://fhircast.org/\" target=\"_blank\" title=\"http://fhircast.org/\">http://fhircast.org/</a>) specification.</p>\n<p>## Specification format<br>\nWe propose to split the specifiaction into three layers:<br>\n 1. channel protocol<br>\n 2. subscribe/unsubscribe and event type<br>\n 3. Event definitions</p>\n<p>## Channel protocols<br>\nChannel protocols are the the different protocols that fhir-cast can use to connect to clients.   <br>\nThis implementation of fhir-cast implements three different<br>\n 1. WebSub (exisiting spec)<br>\n 2. Websockets (see below)<br>\n 3. pull based context (exisiting spec)</p>\n<p>In order to separate the channels on different end-points:<br>\n * WebSub: \\&lt;baseurl&gt;/\\&lt;topic&gt;/websub  <br>\n * WebSocket: \\&lt;baseurl&gt;/websocket<br>\n * Context: \\&lt;baseurl&gt;/\\&lt;topic&gt;/context</p>\n<p>GET on \\&lt;baseurl&gt;/\\&lt;topic&gt; will give you a list of the supported protocols.</p>\n<p># Websocket<br>\nThe websocket part uses STOMP 1.2.   <br>\nSome functionality is not required for FHIR CAST. Clients and server SHALL implement the required functionality and SHOULD implement the other.</p>\n<p>## STOMP subset<br>\nWe will be using STOMP 1.2 over WebSocket. Not all functionality from STOM is required.<br>\nThe table below indicates the functionality that MAY be unsupported. It is RECOMMENDED that <br>\nthe client and server implement the other functionality required by STOMP although it will <br>\nnot be used by this specification.</p>\n<p>The following table shows the support requirements for the different STOMP messages.<br>\n| Message | Source | Status | Description |  <br>\n| --- | --- | --- | --- |   <br>\n| CONNECT | Client  REQUIRED    Connect to websocket<br>\n| SEND | Client REQUIRED    <br>\n| SUBSCRIBE | Client | REQUIRED | Subscribe to channel<br>\n| UNSUBSCRIBE | Client  | REQUIRED | Unsubscribe from channel<br>\n| BEGIN | Client | OPTIONAL | Start transaction<br>\n| COMMIT | Client | OPTIONAL | Commit transaction<br>\n| ABORT | Client | OPTIONAL | Abort transaction<br>\n| ACK | Client | REQUIRED | Acknowledge<br>\n| NACK | Client | REQUIRED | Not Acknowledge<br>\n| DISCONNECT | Client | REQUIRED | Disconnect websocket<br>\n| MESSAGE | Server | REQUIRED | Send message to client<br>\n| RECEIPT | Server | REQUIRED | Indicate receipt content<br>\n| ERROR Server | REQUIRED | Indicate error occurred</p>\n<p>## Destinations<br>\nClients send messages to destinations, a destination is a directory like name on the server.  <br>\nAll FhirCast destinations are targetting the hube will be prefixed with /hub/.  <br>\nAll FhirCast destinations are targetting the spplications will be prefixed with /app/.  </p>\n<p>### Client--&gt;Server <br>\nClient--&gt;Server  communication SHALL use the following pattern:<br>\n    /hub/fhircast/\\&lt;topic&gt;/<br>\nwhere<br>\n    \\&lt;clientid&gt;: is a unique id of the client, e.g. the client-id used in OAUth</p>\n<p>### Server -&gt;Client<br>\nServer -&gt;Client SHALL use the following destinations:<br>\n    /app/fhircast/&lt;topic&gt;/&lt;event&gt;<br>\nwhere<br>\n    \\&lt;clientid&gt;:    is a unique id of the client, e.g. the client-id used in Oauth<br>\n    \\&lt;event&gt;    is the event name/id the client sends a message to</p>\n<p>Implementations can distinguish on OAuth role, adding client-id makes it easier to filter who receives what.</p>\n<p>## Use cases<br>\n### Client Subscribe/ Unsubscribe<br>\nAll clients can register for events on the websocket endpoint.</p>\n<p><strong>SUBSCRIBE /hub/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>  <br>\n    subscribe app for event \\&lt;event&gt; on topic \\&lt;topic&gt;</p>\n<p><strong>UNSUBSCRIBE /hub/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>   <br>\n    Unsubscribe for the event on the topic.</p>\n<p><strong>Deny subscription</strong>   <br>\n    TBD</p>\n<p>### Sending events<br>\n#### Server sends event   <br>\n<strong>MESSAGE /app/fhircast/topic&gt;/&lt;event&gt; Event</strong>  <br>\nThe Event is formatted as a WebSub event. E.g. <br>\nTHe event is formated as is displayed below:</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"p\">{</span>\n<span class=\"err\">event</span><span class=\"nt\">&quot;: {</span>\n<span class=\"nt\">    &quot;</span><span class=\"err\">hub.topic</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">https</span><span class=\"p\">:</span><span class=\"err\">//hub.example.com/</span><span class=\"mi\">7</span><span class=\"err\">jaa</span><span class=\"mi\">86</span><span class=\"err\">kgdudewiaq</span><span class=\"mi\">0</span><span class=\"err\">wtu</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">    &quot;</span><span class=\"err\">hub.event</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">close-patient-chart</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">    &quot;</span><span class=\"err\">context</span><span class=\"s2\">&quot;: [</span>\n<span class=\"s2\">      {</span>\n<span class=\"s2\">        &quot;</span><span class=\"err\">key</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">patient</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">        &quot;</span><span class=\"err\">resource</span><span class=\"s2\">&quot;: {</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">resourceType</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">Patient</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">id</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mf\">798E4</span><span class=\"err\">MyMcpCWHab</span><span class=\"mi\">9</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">          &quot;</span><span class=\"err\">identifier</span><span class=\"s2\">&quot;: [</span>\n<span class=\"s2\">            {</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">system</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">urn</span><span class=\"p\">:</span><span class=\"err\">oid</span><span class=\"p\">:</span><span class=\"mf\">1.2</span><span class=\"err\">.</span><span class=\"mf\">840.114350</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">value</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mi\">1345687</span><span class=\"s2\">&quot;</span>\n<span class=\"s2\">            },</span>\n<span class=\"s2\">            {</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">system</span><span class=\"s2\">&quot;: &quot;</span><span class=\"err\">urn</span><span class=\"p\">:</span><span class=\"err\">oid</span><span class=\"p\">:</span><span class=\"mf\">1.2</span><span class=\"err\">.</span><span class=\"mf\">840.114350</span><span class=\"err\">.</span><span class=\"mf\">1.13</span><span class=\"err\">.</span><span class=\"mf\">861.1</span><span class=\"err\">.</span><span class=\"mf\">7.5</span><span class=\"err\">.</span><span class=\"mf\">737384.27000</span><span class=\"s2\">&quot;,</span>\n<span class=\"s2\">              &quot;</span><span class=\"err\">value</span><span class=\"s2\">&quot;: &quot;</span><span class=\"mi\">7539</span><span class=\"err\">&quot;</span>\n            <span class=\"p\">}</span>\n          <span class=\"err\">]</span>\n        <span class=\"err\">}</span>\n      <span class=\"err\">}</span>\n    <span class=\"err\">]</span>\n<span class=\"err\">}</span>\n</pre></div>\n\n\n<p>#### Clients updates context<br>\n<strong>MESSAGE /app/fhircast/\\&lt;topic&gt;/\\&lt;event&gt;</strong>  <br>\nSend the event to the event endpoint. The implementation SHALL refuse messages send to the wrong endpoint.</p>\n</blockquote>",
        "id": 155348677,
        "sender_full_name": "Github Notifications (FHIRcast)",
        "timestamp": 1547742468
    }
]