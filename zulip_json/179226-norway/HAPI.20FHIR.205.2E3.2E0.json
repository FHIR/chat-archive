[
    {
        "content": "<p>Hei norske gutter (<span class=\"user-mention\" data-user-id=\"192681\">@Espen Stranger Seland</span> <span class=\"user-mention\" data-user-id=\"192856\">@Thomas Tveit Rosenlund</span>  <span class=\"user-mention\" data-user-id=\"192654\">@Øyvind Aassve</span> ) - jeg tænkte det ville være bra for jer at kende til en ny feature (<a href=\"https://github.com/hapifhir/hapi-fhir/pull/2264\">https://github.com/hapifhir/hapi-fhir/pull/2264</a>) i HAPI FHIR 5.3.0 som jeg har anvendt sammen med <span class=\"user-mention\" data-user-id=\"295892\">@MedCom FHIR Team</span> . Det gør at man kan validere en ressource på det tidspunkt hvor den gemmes. Sat sammen med featuren for at kunne loade Implementation Guide, så giver det muligheden for kunne sætte en hel FHIR server op med fuld validering fra en implementation guide. Dette har jeg gjort for MedCom i DK. Jeg tænker i bør overveje at gøre det samme. Giv lyd hvis I skal have hjælp til det.</p>",
        "id": 226689065,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613581257
    },
    {
        "content": "<p>Det blev en del af HAPI FHIR starter projektet med mit PR (<a href=\"https://github.com/hapifhir/hapi-fhir-jpaserver-starter/pull/210\">https://github.com/hapifhir/hapi-fhir-jpaserver-starter/pull/210</a>)</p>",
        "id": 226689530,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613581429
    },
    {
        "content": "<p>Interessant <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> <br>\n<span class=\"user-mention\" data-user-id=\"192715\">@Michal Cermak</span>  kanskje av interesse for deg også?</p>\n<p>Er det ved POST/PUT av ressurser til server som er use-caset her? <br>\nNoterer man da i meta hvilken profil definisjon instansen er validert  mot, og hvordan sier man i meta at det faktisk er gjort en validering?</p>",
        "id": 226700813,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1613585846
    },
    {
        "content": "<p>Korrekt (dokumentationen er her <a href=\"https://hapifhir.io/hapi-fhir/docs/validation/repository_validating_interceptor.html\">https://hapifhir.io/hapi-fhir/docs/validation/repository_validating_interceptor.html</a>). De ressourcer som der modtages via PUT/POST/PATCH, valideres i forhold til det som er angivet i meta.profile.</p>",
        "id": 226702893,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613586581
    },
    {
        "content": "<p>Så hvis I har en Implementation Guide, og denne installeres (det gøres nemt i HAPI FHIR starter), så vil alle resourcer der sendes til serveren validere i forhold til det som er angivet i selve ressourcen - automatisk.</p>",
        "id": 226703213,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613586646
    },
    {
        "content": "<p>Det gør der MEGET let at sætte servere op til test og prototype brug hvis man har en implementation guide.</p>",
        "id": 226703307,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613586681
    },
    {
        "content": "<p>faktisk behøves man ikk engang en implementation guide. Hvis blot man har sine StructureDefs og sidde gemmes på serveren, så er det også nok</p>",
        "id": 226703380,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613586715
    },
    {
        "content": "<p>Jeg kan godt give en demo næste gang vi tales ved</p>",
        "id": 226703459,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613586735
    },
    {
        "content": "<p>Det virker spennende - kanskje det kunne vært fint med en kort presentasjon på vår FHIR Fagforum? <span class=\"user-mention\" data-user-id=\"192856\">@Thomas Tveit Rosenlund</span> @*<em>Øyvind Aassve</em></p>",
        "id": 226772547,
        "sender_full_name": "Espen Stranger Seland",
        "timestamp": 1613632223
    },
    {
        "content": "<p>Ser ut som man kan tagge meta med valideringsresultat. Bra! Virker som en veldig nyttig funksjon.</p>",
        "id": 226775348,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1613634848
    },
    {
        "content": "<p>Hvis i kan give mig et link til en af jeres IG'er så laver vi en live demo</p>",
        "id": 226830751,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613663468
    },
    {
        "content": "<p>Må den ha en IG ressurs, eller kan den ta ting fra SIMPLIFIER?<br>\nVi publiserer foreløpig bare IG'er på SIMPLIFIER med pakker slik som denne: <br>\n<a href=\"https://simplifier.net/guide/masterpersonindexr4/servicesforpersoninformation\">https://simplifier.net/guide/masterpersonindexr4/servicesforpersoninformation</a><br>\n<a href=\"https://simplifier.net/Grunndata-R4/~packages\">https://simplifier.net/Grunndata-R4/~packages</a></p>",
        "id": 226927490,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1613718716
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span>the IG above - would that be listed in a registry / downloadable as a FHIR IG package.tgz file somewhere?</p>",
        "id": 226963118,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613741634
    },
    {
        "content": "<p>Nevermind ... found it at <a href=\"https://simplifier.net/packages/ehelse.fhir.no.grunndata/2.3.5\">https://simplifier.net/packages/ehelse.fhir.no.grunndata/2.3.5</a> under the npm tab</p>",
        "id": 226973334,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613746279
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"192856\">@Thomas Tveit Rosenlund</span> .... looks like there are issues with the IG:</p>\n<div class=\"codehilite\"><pre><span></span><code>StructureDefinition/no-basis-AllergyIntolerance\n    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:225)\n    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:175)\n    at ca.uhn.fhir.jpa.starter.BaseJpaRestfulServer.initialize(BaseJpaRestfulServer.java:360)\n    at ca.uhn.fhir.jpa.starter.JpaRestfulServer.initialize(JpaRestfulServer.java:22)\n    at ca.uhn.fhir.rest.server.RestfulServer.init(RestfulServer.java:1285)\n    at javax.servlet.GenericServlet.init(GenericServlet.java:203)\n    at org.apache.catalina.core.StandardWrapper.initServlet(StandardWrapper.java:1134)\n    at org.apache.catalina.core.StandardWrapper.load(StandardWrapper.java:986)\n    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.load(TomcatEmbeddedContext.java:82)\n    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.accept(ForEachOps.java:183)\n    at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n    at java.base/java.util.stream.ReferencePipeline$Head.forEach(ReferencePipeline.java:658)\n    at java.base/java.util.stream.ReferencePipeline$7$1.accept(ReferencePipeline.java:274)\n    at java.base/java.util.TreeMap$ValueSpliterator.forEachRemaining(TreeMap.java:3177)\n    at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:484)\n    at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:474)\n    at java.base/java.util.stream.ForEachOps$ForEachOp.evaluateSequential(ForEachOps.java:150)\n    at java.base/java.util.stream.ForEachOps$ForEachOp$OfRef.evaluateSequential(ForEachOps.java:173)\n    at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n    at java.base/java.util.stream.ReferencePipeline.forEach(ReferencePipeline.java:497)\n    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.lambda$deferredLoadOnStartup$0(TomcatEmbeddedContext.java:65)\n    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.doWithThreadContextClassLoader(TomcatEmbeddedContext.java:106)\n    at org.springframework.boot.web.embedded.tomcat.TomcatEmbeddedContext.deferredLoadOnStartup(TomcatEmbeddedContext.java:64)\n    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.performDeferredLoadOnStartup(TomcatWebServer.java:305)\n    at org.springframework.boot.web.embedded.tomcat.TomcatWebServer.start(TomcatWebServer.java:216)\n    at org.springframework.boot.web.servlet.context.WebServerStartStopLifecycle.start(WebServerStartStopLifecycle.java:43)\n    at org.springframework.context.support.DefaultLifecycleProcessor.doStart(DefaultLifecycleProcessor.java:178)\n    at org.springframework.context.support.DefaultLifecycleProcessor.access$200(DefaultLifecycleProcessor.java:54)\n    at org.springframework.context.support.DefaultLifecycleProcessor$LifecycleGroup.start(DefaultLifecycleProcessor.java:356)\n    at java.base/java.lang.Iterable.forEach(Iterable.java:75)\n    at org.springframework.context.support.DefaultLifecycleProcessor.startBeans(DefaultLifecycleProcessor.java:155)\n    at org.springframework.context.support.DefaultLifecycleProcessor.onRefresh(DefaultLifecycleProcessor.java:123)\n    at org.springframework.context.support.AbstractApplicationContext.finishRefresh(AbstractApplicationContext.java:940)\n    at org.springframework.context.support.AbstractApplicationContext.refresh(AbstractApplicationContext.java:591)\n    at org.springframework.boot.web.servlet.context.ServletWebServerApplicationContext.refresh(ServletWebServerApplicationContext.java:144)\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:767)\n    at org.springframework.boot.SpringApplication.refresh(SpringApplication.java:759)\n    at org.springframework.boot.SpringApplication.refreshContext(SpringApplication.java:426)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:326)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1309)\n    at org.springframework.boot.SpringApplication.run(SpringApplication.java:1298)\n    at ca.uhn.fhir.jpa.starter.Application.main(Application.java:33)\nCaused by: ca.uhn.fhir.jpa.packages.ImplementationGuideInstallationException: Failure when generating snapshot of StructureDefinition: StructureDefinition/no-basis-AllergyIntolerance\n    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.generateSnapshot(PackageInstallerSvcImpl.java:413)\n    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.install(PackageInstallerSvcImpl.java:221)\n    ... 41 common frames omitted\nCaused by: ca.uhn.fhir.rest.server.exceptions.InternalErrorException: Failed to generate snapshot\n    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:134)\n    at org.hl7.fhir.common.hapi.validation.support.ValidationSupportChain.generateSnapshot(ValidationSupportChain.java:66)\n    at org.hl7.fhir.common.hapi.validation.support.BaseValidationSupportWrapper.generateSnapshot(BaseValidationSupportWrapper.java:94)\n    at ca.uhn.fhir.jpa.packages.PackageInstallerSvcImpl.generateSnapshot(PackageInstallerSvcImpl.java:411)\n    ... 42 common frames omitted\nCaused by: org.hl7.fhir.exceptions.DefinitionException: Attempt to a slice an element that does not repeat: AllergyIntolerance.code/AllergyIntolerance.code from http://hl7.org/fhir/StructureDefinition/CodeableConcept in null, at element AllergyIntolerance.code (slice = ATC, FESTSubstance, FESTMedication)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.processPaths(ProfileUtilities.java:1389)\n    at org.hl7.fhir.r5.conformance.ProfileUtilities.generateSnapshot(ProfileUtilities.java:639)\n    at org.hl7.fhir.common.hapi.validation.support.SnapshotGeneratingValidationSupport.generateSnapshot(SnapshotGeneratingValidationSupport.java:104)\n    ... 45 common frames omitted\n</code></pre></div>",
        "id": 226984198,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613750474
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> I imagine that error (<span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span>) would also prevent you guys from loading the IG. Does simplifier list any warnings for the profiles once uploaded?</p>",
        "id": 227238725,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613985782
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span>,</p>\n<p>You can download any package from the UI, after logging in with free account:<br>\n<a href=\"/user_uploads/10155/5yq0Kc64qvMbLNrwJt8XCUnZ/image.png\">image.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/5yq0Kc64qvMbLNrwJt8XCUnZ/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/5yq0Kc64qvMbLNrwJt8XCUnZ/image.png\"></a></div><p>The validation of no-basis-AllergyIntolerance looks clean (at least on the development version of it) in <a href=\"http://Simplifier.net\">Simplifier.net</a>: <a href=\"https://simplifier.net/hl7norwayno-basis/nobasisallergyintolerance/$validate\">https://simplifier.net/hl7norwayno-basis/nobasisallergyintolerance/$validate</a><br>\nIt doesn't seem like the Firely .NET SDK snapshot generator has problems with generating a snapshot for that / the validator does not complain about slicing a non-repeating element. I'll check with the team whether they think we should/are working on that.</p>",
        "id": 227254318,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1613994524
    },
    {
        "content": "<p>lol (<span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> I ended up 'reverse engineering' what the download did fetch using the npm way - I didn't even see the download button <span aria-label=\"joy\" class=\"emoji emoji-1f602\" role=\"img\" title=\"joy\">:joy:</span> )</p>",
        "id": 227258352,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613996750
    },
    {
        "content": "<p>But great if you can get the team to confirm whether there's a bug in the java or the .net impl</p>",
        "id": 227258459,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613996790
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> So apparently, it's a long discussion whether slicing on non-repeating elements is allowed. I'll try to summarize what <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> relayed to me before he has time to respond:</p>\n<ul>\n<li>Feb 2017 thread: <a href=\"#narrow/stream/179166-implementers/topic/Slicing.20non-repeating.20elements.20to.20define.20a.20choice\">https://chat.fhir.org/#narrow/stream/179166-implementers/topic/Slicing.20non-repeating.20elements.20to.20define.20a.20choice</a></li>\n</ul>",
        "id": 227259510,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1613997381
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"372944\">@Firely Bot</span> issue show <a href=\"http://jira.hl7.org/browse/FHIR-28619\">FHIR-28619</a></p>",
        "id": 227259522,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1613997395
    },
    {
        "content": "<p><strong><a href=\"https://jira.hl7.org/browse/FHIR-28619\">FHIR-28619 Allow slicing of a non-repeating element to define a choice </a></strong><br>\nStatus: <strong>Resolved - No Change</strong>, Type: <strong>Change Request</strong></p>",
        "id": 227259534,
        "sender_full_name": "Firely Bot",
        "timestamp": 1613997405
    },
    {
        "content": "<p>Recent ticket <span aria-label=\"point up\" class=\"emoji emoji-1f446\" role=\"img\" title=\"point up\">:point_up:</span><br>\nConclusion seems to be our Snapshot generator is able to handle it, but for Java stack it would be hard to implement. So perhaps we should remove it again, given the ticket resolution.</p>",
        "id": 227259617,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1613997457
    },
    {
        "content": "<p>But <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> also wondered whether the situation in question isn't type slicing, where it still could be allowed.</p>",
        "id": 227259726,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1613997504
    },
    {
        "content": "<p>Oh my ... its 'just' a discussion going back to 2017 ... yikes</p>",
        "id": 227260584,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1613998037
    },
    {
        "content": "<p>Removing something that works well is soooo painful.</p>",
        "id": 227490070,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1614108894
    },
    {
        "content": "<p>This is where we remove it, and add it back using an Option setting in the validator.  \"Naughty validation mode\".</p>",
        "id": 227490182,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1614108938
    },
    {
        "content": "<p>I am aware of this bug in the no-basis profiles. One of the reasons we kept doing this for so long was that the .NET validator did not complain, however the java validator have been complaining for some time, this has not always been the case. Before our first release of these profiles I did validate everything using the java validator, and it was all OK (did not try snapshot generation in the IG publisher however). We have to fix this using one of the methods proposed in that old thread regarding slicing of non-repeating elements. </p>\n<p>Turns out we already have an issue to clean this up already, it has been down to time/resource related issues I guess... <a href=\"https://github.com/HL7Norway/basisprofiler-r4/issues/55\">https://github.com/HL7Norway/basisprofiler-r4/issues/55</a></p>",
        "id": 227761542,
        "sender_full_name": "Thomas Tveit Rosenlund",
        "timestamp": 1614257575
    }
]