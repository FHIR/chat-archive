[
    {
        "content": "<p>The <a href=\"https://www.hl7.org/fhir/mapping-language.html#7.7.0.7.1\" target=\"_blank\" title=\"https://www.hl7.org/fhir/mapping-language.html#7.7.0.7.1\">FHIR mapping language</a> specifies for the source where condition:</p>\n<blockquote>\n<p>where [condition]: a FHIRPath expression that is evaluated to boolean on the context. If the expression returns false, the source element has no match</p>\n</blockquote>\n<p>what is exactly 'evaluated to boolean <strong>on the context</strong>', is it context or context.element? context.element is defined as</p>\n<blockquote>\n<p>The element is an (optional) name of a child element of the context. If the name is not provided, the source is the context. If it is provided, the rule will apply once for each element on the context that matches this name.</p>\n</blockquote>\n<p>From this description I would assume the following where clauses to evaluate the length of source.a2 (context.element as context):</p>\n<div class=\"codehilite\"><pre><span></span>  source.a2 as a where length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b &quot;;\n  source.a2 as a where $this.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;\n  source.a2 as a where source.a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;\n  source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;\n</pre></div>\n\n\n<p>the Java fhir mapping language also evaluates the above rules, however the <a href=\"https://www.hl7.org/fhir/mapping-tutorial.html#step3\" target=\"_blank\" title=\"https://www.hl7.org/fhir/mapping-tutorial.html#step3\">tutorial</a> describe it the following way (context as context):</p>\n<div class=\"codehilite\"><pre><span></span>  source.a2 as a where a2.length()&lt;20 -&gt; target.a2 = a &quot;rule_a20b&quot;;\n</pre></div>\n\n\n<p>also the example in the spec itself: </p>\n<div class=\"codehilite\"><pre><span></span>src.value : integer 0..* default 10 first as vs0\n    where value &gt;= 10 check value &lt;= 100\n    log value\n</pre></div>\n\n\n<p>which cannot be evaluated with the java fhir mapping language. is this an implementation issue or need the examples be corrected? <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> <span class=\"user-mention\" data-user-id=\"191363\">@Vadim Peretokin</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 185159808,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1578519515
    },
    {
        "content": "<p>Context is properly defined by the StructureMap resource as: \"Type or variable this rule applies to\".  Meaning in this case the child element. So in your example it would be \"a2\". Always, at least to my interpretation.</p>",
        "id": 185160476,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1578520006
    },
    {
        "content": "<p>Therefore I would agree that the example is not correct and should be updated</p>",
        "id": 185160508,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1578520035
    },
    {
        "content": "<p><code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a \"rule_a20b\";</code> What is <code>%source</code> supposed to be here?</p>",
        "id": 185160635,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1578520142
    },
    {
        "content": "<blockquote>\n<p><code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a \"rule_a20b\";</code> What is <code>%source</code> supposed to be here?</p>\n</blockquote>\n<p>I have the group defined as: group  tutorial(source source : TLeft, target target : TRight) and then I can also access the source parameter in the fhirpath expression as a variable with %source</p>",
        "id": 185161579,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1578520781
    },
    {
        "content": "<p>Ahh, yes, of course. Then <code>source.a2 as a where %source.a2.length()&lt;20 -&gt; target.a2 = a \"rule_a20b\";</code>should also work.</p>",
        "id": 185263415,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1578609015
    },
    {
        "content": "<p>Would the first one be valid? Or only the second one? The third option would only work, in my opinion, if a2 would have a child called \"source\".</p>",
        "id": 185263639,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1578609163
    },
    {
        "content": "<blockquote>\n<p>Would the first one be valid? Or only the second one? The third option would only work, in my opinion, if a2 would have a child called \"source\".</p>\n</blockquote>\n<p>I think 1 (length()&lt;20 ), 2 ($this.length()&lt;20) and 4 (%source.a2.length()&lt;20 if source is a variable) should be valid, but not 3  source.a2.length()&lt;20.</p>",
        "id": 185264237,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1578609544
    }
]