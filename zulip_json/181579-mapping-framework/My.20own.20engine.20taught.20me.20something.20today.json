[
    {
        "content": "<p>While I was working on my implementation of a mapping engine, I debugged what I thought was incorrect behaviour.  This is what I had:</p>\n<div class=\"codehilite\"><pre><span></span>data.values as values where (blockindex = 1 and groupindex = 0 and itemid = &#39;id_1125&#39;) then\n{\n    values.value as value -&gt; tgt.name as name then\n     {\n           value -&gt; name.given\n     }\n}  &quot;rule_select_name&quot;;\n</pre></div>\n\n\n<p>To my surprise, my engine only generated an empty \"given\" element within an \"name\" element in the target.  </p>\n<p>While debugging I discovered the engine did what it was supposed to do.  Although I interpreted the rule <code>value -&gt; name.given</code> as a rule that would copy the contents of value into given, this is not what it is supposed to do, since it is not a \"simple form\" according to <a href=\"https://www.hl7.org/fhir/mapping-language.html#simple\" target=\"_blank\" title=\"https://www.hl7.org/fhir/mapping-language.html#simple\">https://www.hl7.org/fhir/mapping-language.html#simple</a>. </p>\n<p>So what it did was for all occurrences in \"value\" (1 instance), run the target rule. Which does nothing more that create the target element.</p>\n<p>I guess what I should have done is:</p>\n<div class=\"codehilite\"><pre><span></span>   values.value as value -&gt; tgt.name as name, name.given = value;\n</pre></div>\n\n\n<p>Which does indeed work fine.</p>\n<p>Is this the intended behaviour? If so, isn't the syntax a bit confusing?  Or should be allow x -&gt; y.z to be a \"simple form\" too?</p>",
        "id": 166725705,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1559056035
    },
    {
        "content": "<p>maybe it would be useful, though would we have cardinality restrictions on the inner?</p>",
        "id": 166757309,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559076153
    },
    {
        "content": "<p>Yes, the inner should be 0..1, to not mess with the logic that everywhere the context itself is 0..1, and the context variable name (its children) may select repeating items.</p>",
        "id": 166790230,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1559114554
    },
    {
        "content": "<p>Though in the end, it means there's two ways to do it, and the \"correct\" one is shorter too.</p>",
        "id": 166790316,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1559114662
    }
]