[
    {
        "content": "<p>I'm looking at the <a href=\"https://github.com/FHIR/interversion/blob/master/r4/R3toR4/DocumentReference.map\" target=\"_blank\" title=\"https://github.com/FHIR/interversion/blob/master/r4/R3toR4/DocumentReference.map\">STU3 -&gt; R4 map for DocumentReference (on Github)</a> and cannot quite understand the mapping rule for the reference field \"author\". According to the <a href=\"https://www.hl7.org/fhir/diff.html\" target=\"_blank\" title=\"https://www.hl7.org/fhir/diff.html\">diff summary</a>, all that has changed for this field is that one can now also reference PractitionerRole. But the mapping rule is the following:</p>\n<div class=\"codehilite\"><pre><span></span>src.author as s -&gt; tgt.agent as t then agent(s, t);\n(...)\ngroup agent(source src, target tgt) extends BackboneElement {\n  src -&gt;  tgt.type as cc,  cc.coding as c,  c.system = &#39;http://terminology.hl7.org/CodeSystem/v3-ParticipationType&#39;,  c.code = &#39;AUT&#39; &quot;author&quot;;\n  src -&gt; tgt.who as vt0 then Reference(src, vt0) &quot;who&quot;;\n}\n</pre></div>\n\n\n<p>Why is this needed?</p>",
        "id": 185476328,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1578907326
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 185500466,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1578927655
    },
    {
        "content": "<p>looks like an error to me</p>",
        "id": 185559737,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1578969085
    },
    {
        "content": "<p>Should I put in a change request or  is it easier \"off the books\"?</p>",
        "id": 185570955,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1578986947
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"194703\">@Morten Ernebjerg</span>  I'm curious if You could execute the migration scripts from the github repository? I'm also in the process of learning the mapping language and tried to get a Patient mapping running, but when I try to run anything but an empty Resource, a get various errors for the different datatypes</p>",
        "id": 185608909,
        "sender_full_name": "Johannes Oehm",
        "timestamp": 1579017296
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"250685\">@Johannes Oehm</span> I actually haven't tried to run the mapping yet - I was looking it at to get a better understanding of what STU3 -&gt; R4 transformation of resources involves.</p>",
        "id": 185679895,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1579079234
    },
    {
        "content": "<p>hi <span class=\"user-mention\" data-user-id=\"250685\">@Johannes Oehm</span> you should be able to execute the maps directly via the validator, for an example see the <a href=\"https://github.com/ahdis/fhir-mapping-tutorial\" target=\"_blank\" title=\"https://github.com/ahdis/fhir-mapping-tutorial\">fhir tutorial with the java validator</a> or with a <a href=\"https://github.com/ahdis/matchbox/blob/master/matchbox-fml.md\" target=\"_blank\" title=\"https://github.com/ahdis/matchbox/blob/master/matchbox-fml.md\">local setup</a></p>",
        "id": 185955971,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1579294600
    },
    {
        "content": "<p>@Oliver Egger Yes, I also tried your patched version of the FHIR validator, but I'm getting the following message: <br>\nC:\\Users\\oehmj\\VSCodeProjects\\fhir-mapping-tutorial&gt; java -jar org.hl7.fhir.validator.jar C:\\Users\\oehmj\\IdeaProjects\\org.hl7.fhir.core\\patient.fhir.json -transform <a href=\"http://hl7.org/fhir/StructureMap/Patient4to3\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureMap/Patient4to3\">http://hl7.org/fhir/StructureMap/Patient4to3</a> -version 4.0.1 -ig ..\\fhir-mapping\\R4toR3\\ -log test.txt -output ./r4tor3out.xml<br>\nFHIR Validation tool Version 4.1.38-SNAPSHOT (Git# 363b38be9bc0). Built 2020-01-05T21:22:05.612+01:00 (14 days old)<br>\nDetected Java version: 1.8.0_241 from C:\\Program Files\\Java\\jre1.8.0_241 on amd64 (64bit). 2711MB available<br>\nArguments: C:\\Users\\oehmj\\IdeaProjects\\org.hl7.fhir.core\\patient.fhir.json -transform <a href=\"http://hl7.org/fhir/StructureMap/Patient4to3\" target=\"_blank\" title=\"http://hl7.org/fhir/StructureMap/Patient4to3\">http://hl7.org/fhir/StructureMap/Patient4to3</a> -version 4.0.1 -ig ..\\fhir-mapping\\R4toR3\\ -log test.txt -output ./r4tor3out.xml<br>\nDirectories: Current = C:\\Users\\oehmj\\VSCodeProjects\\fhir-mapping-tutorial, Package Cache = C:\\Users\\oehmj\\.fhir\\packages<br>\n  .. FHIR Version 4.0, definitions from hl7.fhir.r4.core#4.0.1<br>\n  .. connect to tx server @ <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">http://tx.fhir.org</a><br>\n    (v4.0.1)</p>\n<ul>\n<li>.. load IG from ..\\fhir-mapping\\R4toR3\\<br>\n ...Failure: Unable to determine StructureDefinition for target type<br>\norg.hl7.fhir.exceptions.FHIRException: Unable to determine StructureDefinition for target type<br>\n        at org.hl7.fhir.r5.validation.ValidationEngine.getTargetResourceFromStructureMap(ValidationEngine.java:1260)<br>\n        at org.hl7.fhir.r5.validation.ValidationEngine.transform(ValidationEngine.java:1234)<br>\n        at org.hl7.fhir.r5.validation.ValidationEngine.transform(ValidationEngine.java:1222)<br>\n        at org.hl7.fhir.r5.validation.Validator.main(Validator.java:592)</li>\n</ul>\n<p>The official version of the Validator gets into an NPE when it's trying to load the maps vom the ImplementationGuide, I also tried a local fix for that problem, but then imports in the mapping script seem to be unresolved.</p>",
        "id": 186104427,
        "sender_full_name": "Johannes Oehm",
        "timestamp": 1579529132
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"250685\">@Johannes Oehm</span> sorry that was maybe a misunderstanding, executing the mappings for version conversion R4toR3 is not directly possible with the java validator. The fhir java build uses the maps to transform them, but adjusts the StructureDefinitions that multiple versions are possible.</p>",
        "id": 186422889,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1579806289
    },
    {
        "content": "<p>see <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator#UsingtheFHIRValidator-VersionConversion\" target=\"_blank\" title=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator#UsingtheFHIRValidator-VersionConversion\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator#UsingtheFHIRValidator-VersionConversion</a> for new instructions</p>",
        "id": 189567963,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1583218622
    }
]