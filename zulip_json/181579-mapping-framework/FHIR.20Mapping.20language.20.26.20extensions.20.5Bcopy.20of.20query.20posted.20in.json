[
    {
        "content": "<p>Hopefully a quick and easy question/answer. We are looking at transforming STU3 profiles into R4 profiles. Most of the mappings are provided on the R4 resources on the \"R3 Conversions\" tab. It looks like there's a general format to the syntax in that elements that are on the base resouce and not in a backbone element are addressed directly (for example src.identifier -&gt; tgt.identifier;) those in a backbone element are put into their own group and dealt with. I'm a bit unsure as to what to do with extensions. For example, is the source (STU3 profile) has a complex extension that part of now belongs on a R4 element - what's the mapping language syntax? For example, within a STU3 MedicationRequest we have a complex extension that has information about repeat medication<br>\nExtension url:https:[base]/StructureDefinition/Extension-MedicationRepeatInformation<br>\nextension url: numberOfRepeatPrescriptionsAllowed (as an integer)<br>\nextension url: numberOfRepeatPrescriptionsIssued (as an integer)<br>\nThe numberOfRepeatPrescriptionsAllowed now maps to the R4 element MedicationRequest.dispenseRequest.numberOfRepeatsAllowed<br>\nHow would we represent this in FHIR mapping language? - in terms of how do you reference an element in a complex extension?</p>",
        "id": 260635744,
        "sender_full_name": "Dave Barnet",
        "timestamp": 1636365613
    },
    {
        "content": "<p>you match first the complex extension and match then within the complex extension, same as you would do with a backbone element. <br>\nI don't have an example for R3 to R4, but for R4 to CDA we do the following (where ch-emed-ext-treatmentplan is a complex extension):</p>\n<p><a href=\"https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L433\">https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L433</a></p>\n<div class=\"codehilite\"><pre><span></span><code>  medicationDispense.extension as extension where url=&#39;http://fhir.ch/ig/ch-emed/StructureDefinition/ch-emed-ext-treatmentplan&#39;\n    -&gt; supply.entryRelationship as entryRelationship, entryRelationship.typeCode=&#39;REFR&#39;,\n        entryRelationship.substanceAdministration as substanceAdministration\n          then MTPReferenceEntryContentModule(extension, substanceAdministration) &quot;MTP-Reference&quot;;\n</code></pre></div>\n<p>and then <a href=\"https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L286\">https://github.com/hl7ch/cda-fhir-maps/blob/master/input/maps/BundleToCdaChEmed.map#L286</a></p>\n<div class=\"codehilite\"><pre><span></span><code>group MTPReferenceEntryContentModule(source ext: Extension, target substanceAdministration : SubstanceAdministration) {\n ext.extension as extension where $this.url=&#39;id&#39; then {\n    extension.valueIdentifier as valueIdentifier -&gt; substanceAdministration.id as id then IdentifierII(valueIdentifier, id) &quot;id&quot;;\n  } &quot;id&quot;;\n</code></pre></div>\n<p>you can do this also without a group and list the rules after then.</p>",
        "id": 261908929,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1637230990
    }
]