[
    {
        "content": "<p>I am looking at the <a href=\"http://hl7.org/fhir/R4/questionnaireresponse-version-maps.html\">R4 -&gt; STU3 maps of <code>QuestionnaireResponse</code></a>. The field <code>questionnaire</code> changed type, from a reference (STU3) to a canonical URL (R4). However, the mapping (in either direction) is simply</p>\n<div class=\"codehilite\"><pre><span></span><code>src.questionnaire -&gt; tgt.questionnaire;\n</code></pre></div>\n\n\n<p>Is there some automatic mapping done (behind the scenes) when the R4 type is <code>canonical</code>?</p>",
        "id": 198892976,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1590587464
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 198895793,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1590588633
    },
    {
        "content": "<p>well, it's not done behind the scenes, but in one of the libraries:</p>\n<div class=\"codehilite\"><pre><span></span><code>group canonical2Reference(source src : canonical, target tgt : ReferenceR3) &lt;&lt;types&gt;&gt; {\n  src.id -&gt; tgt.id &quot;Element-id&quot;;\n  src.extension where (url.startsWith(&#39;http://hl7.org/fhir/3.0/StructureDefinition&#39;).not() and (url != &#39;http://hl7.org/fhir/StructureDefinition/rendered-value&#39;)) -&gt; tgt.extension &quot;Element-extensions&quot;;\n  src.value -&gt; tgt.reference &quot;reference&quot;;\n  src.extension as e where url = &#39;http://hl7.org/fhir/StructureDefinition/rendered-value&#39; then {\n    e.value -&gt; tgt.display;\n  };\n}\n</code></pre></div>\n\n\n<p>And the equivalent exists in R3 -&gt; R4</p>",
        "id": 199697385,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591234993
    },
    {
        "content": "<p>Ok, but is that statement valid in the FHIR mapping language?</p>",
        "id": 199702642,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1591242775
    },
    {
        "content": "<p>umm. yes? I mean, it compiles and executes ok...</p>",
        "id": 199702656,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1591242810
    },
    {
        "content": "<p>Just to make sure I get this right: the \"trivial map\" <code>src.x -&gt; tgt.y</code> can actually involve a standard type transformation if  <code>src.x</code> and <code>tgt.y</code> have different types? If so, is there a list of the type pairs where this happens?</p>",
        "id": 199756849,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1591281743
    },
    {
        "content": "<p>Yes, that happens for all types for which there is a group with a &lt;&lt;types&gt;&gt; annotation</p>",
        "id": 199759844,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1591282921
    },
    {
        "content": "<p>Have a look here: <a href=\"https://github.com/FHIR/interversion/blob/master/r4/R4toR3/primitives.map\">https://github.com/FHIR/interversion/blob/master/r4/R4toR3/primitives.map</a></p>",
        "id": 199760019,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1591282978
    },
    {
        "content": "<p>Great, thanks <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> !</p>",
        "id": 199803385,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1591301947
    }
]