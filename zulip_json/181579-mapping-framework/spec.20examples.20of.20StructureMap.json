[
    {
        "content": "<p>Checking this page here, is it just me, or is the rendering for the Raw StructureMap format not correct here?<br>\n<a href=\"http://build.fhir.org/structuremap-supplyrequest-transform.html\">http://build.fhir.org/structuremap-supplyrequest-transform.html</a><br>\nIt's all run together (not as a pre block)<br>\nthere are no brackets around parameters<br>\nthere are no {} brackets around the rules in the group<br>\nthe name for the rule is at the start and not the end...</p>",
        "id": 252110135,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630885581
    },
    {
        "content": "<p>and the grammar for the targetlistmode is only singular in cardinality, however the FHIR resource definition permits multiple</p>",
        "id": 252110348,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630885895
    },
    {
        "content": "<p>grammar has dependent as singular cardinality, structuremap has multiple</p>",
        "id": 252112082,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630887902
    },
    {
        "content": "<p>Is this rule in the grammar intended to mean that you must have at least 2 parameters? (or should the + be a * here)<br>\n<code>'(' parameter (',' parameter)+ ')'</code></p>",
        "id": 252115421,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630891821
    },
    {
        "content": "<p>I'm putting together a serialization to convert StructureMap resources into the FHIR Mapping Language format in c#<br>\n<a href=\"https://gist.github.com/brianpos/2f2d33a0f22ef566947bc4a5b7dc1eb8#file-structuremap_serializer-cs-L310\">https://gist.github.com/brianpos/2f2d33a0f22ef566947bc4a5b7dc1eb8#file-structuremap_serializer-cs-L310</a><br>\nAnyone else done anything similar?<br>\nThe section highlighted is where I'm struggling a bit...</p>",
        "id": 252130004,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1630907776
    },
    {
        "content": "<p>And the conversion the other way around (FML -&gt; StructureMap) is coming along nicely too, maybe that will answer more questions as I compelete that.<br>\n<a href=\"https://gist.github.com/brianpos/e4fd4575a6d39290c8cc258f3100a2ac\">https://gist.github.com/brianpos/e4fd4575a6d39290c8cc258f3100a2ac</a><br>\nThis particular code will probably end up in the HL7 FHIR Nuget Packages</p>",
        "id": 252297688,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631018135
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> The example still uses the STU3 syntax. Written using the current spec it would look something like this:</p>\n<div class=\"codehilite\"><pre><span></span><code>map &quot;http://hl7.org/fhir/StructureMap/supplyrequest-transform&quot; = supplyRequestTransform\n\nuses &quot;http://hl7.org/fhir/StructureDefinition/ActivityDefinition&quot; as source\nuses &quot;http://hl7.org/fhir/StructureDefinition/SupplyRequest&quot; as target\n\ngroup main(source `source`: ActivityDefinition, target `target`: SupplyRequest)\n{\n    `source`.id -&gt; target.status = &#39;draft&#39; &quot;status&quot;;\n    `source`.id -&gt; target.category = &#39;non-stock&#39; &quot;category&quot;;\n    `source`.id -&gt; target.priority = &#39;routine&#39; &quot;priority&quot;;\n    `source`.quantity as quantity -&gt; target.orderedItem as orderedItem, orderedItem.quantity = quantity &quot;quantity&quot;;\n    `source`.code as code -&gt; target.orderedItem as orderedItem, orderedItem.itemCodeableConcept = code &quot;item&quot;;\n    `source`.id -&gt; target.occurrence = (&#39;now()&#39;) &quot;when&quot;;\n    `source`.id -&gt; target.authoredOn = (&#39;now()&#39;) &quot;authoredOn&quot;;\n}\n</code></pre></div>",
        "id": 252373019,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631049301
    },
    {
        "content": "<p>To make things a bit less confusing, you can skip the \".id\" part of the source selection and simply use </p>\n<div class=\"codehilite\"><pre><span></span><code>`source` -&gt; tgt [...]\n</code></pre></div>\n<p>I'm still have the wish that we allow a wildcard token here, e.g. \"_ -&gt; tgt.element\"</p>",
        "id": 252373313,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631049444
    },
    {
        "content": "<p>Is there a good collection of samples, or just grab the entire spec 3-4 conversions file?</p>",
        "id": 252373496,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631049548
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191367\">Brian Postlethwaite</span> <a href=\"#narrow/stream/181579-mapping-framework/topic/spec.20examples.20of.20StructureMap/near/252110348\">said</a>:</p>\n<blockquote>\n<p>and the grammar for the targetlistmode is only singular in cardinality, however the FHIR resource definition permits multiple</p>\n</blockquote>\n<p>Not sure how multiple target list modes would work. Might be a simple mistake in the spec.</p>",
        "id": 252373552,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631049593
    },
    {
        "content": "<p>Mapping files for the tutorial can be found here: <a href=\"https://github.com/ahdis/fhir-mapping-tutorial\">https://github.com/ahdis/fhir-mapping-tutorial</a>. Those maps have been tested over the last connectathons. It's a good starting point.</p>",
        "id": 252374003,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631049828
    },
    {
        "content": "<p>I personally used the following map as part of the DevDays tutorials: <a href=\"https://github.com/FirelyTeam/Firely.FhirMapper.Examples/tree/FakeInpatientDrugChart-STU3\">https://github.com/FirelyTeam/Firely.FhirMapper.Examples/tree/FakeInpatientDrugChart-STU3</a></p>",
        "id": 252374116,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631049887
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> is there a fhir mapping session at the fhir connectathon next week?<br>\nWould like to go over these issues,</p>",
        "id": 252554342,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631147718
    },
    {
        "content": "<p>I wouldn't be aware of any scheduled sessions. If you like we could schedule a break-out session and go over it. Maybe we can get a few people to join.</p>",
        "id": 252579867,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631170857
    },
    {
        "content": "<p>count me in for the break-out session</p>",
        "id": 252583748,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1631173183
    },
    {
        "content": "<p>Come in over to the questionnaires track and we'll give it a whirl.</p>",
        "id": 252595493,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631179245
    },
    {
        "content": "<p>My parser is now basically working, however loading in some of the samples that I've found, there are some issues around the fhirpath type and string.<br>\nThe hunger vital signs map<br>\n<a href=\"http://hl7.org/fhir/us/sdoh-clinicalcare/STU1/mapping_instructions.html\">http://hl7.org/fhir/us/sdoh-clinicalcare/STU1/mapping_instructions.html</a><br>\nhas a rule</p>\n<div class=\"codehilite\"><pre><span></span><code>src.item as answerItem1 where &quot;linkId = &#39;/88122-7&#39;&quot; -&gt; bundle.entry as entry\n</code></pre></div>\n<p>the fml grammar states that the where clause is a <code>fhirpath</code> element</p>\n<div class=\"codehilite\"><pre><span></span><code>whereClause\n    : &#39;where&#39; fhirPath\n    ;\n</code></pre></div>\n<p>and <code>fhirpath</code> is declared as a <code>literal</code> which includes <code>STRING</code> which is defined as single quoted content.<br>\nHowever as seen in this example, it is declared using \" (double quotes) which are used for <code>DELIMITEDIDENTIFIER</code> elements<br>\nWhich is wrong?<br>\n<a href=\"http://hl7.org/fhir/mapping.g4\">http://hl7.org/fhir/mapping.g4</a></p>",
        "id": 252706037,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631226718
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> what does the Java fml engine do here?</p>",
        "id": 252708098,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631227978
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> what does your fhirpath engine do with this?</p>",
        "id": 252711079,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631229949
    },
    {
        "content": "<p>I think both engines only except double quotes here</p>",
        "id": 252734316,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631251295
    },
    {
        "content": "<p>Thers’s also an unapplied change request to change it the double quotes to parentheses due to some grammar ambiguity</p>",
        "id": 252734496,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631251451
    },
    {
        "content": "<p>double quotes are not accepted by the java fml engine (see <a href=\"https://github.com/ahdis/fhir-mapping-tutorial/blob/90ea3d7daba86846c6c5bf9ee305cc4bbf1da5af/maptutorial/step4/map/step4b.map\">example</a>), the examples are using fhirPath not quoted eg:</p>\n<div class=\"codehilite\"><pre><span></span><code>  src.a21 as a where a21.matches(&#39;[0-9]+&#39;) -&gt; tgt.a21 = a &quot;rule_a21b&quot;;\n</code></pre></div>",
        "id": 252738327,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1631254718
    },
    {
        "content": "<p>So is this more or less implying that \" and ' mean the same thing in the FML then?<br>\n(and bactic ` is used for delimiting identifiers?)</p>",
        "id": 252741197,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631256868
    },
    {
        "content": "<p>Yes, bactics are used for delimited identifiers. The current spec still states that you can also use double quotes for delimited identifiers (<a href=\"https://www.hl7.org/fhir/mapping-language.html#syntax\">https://www.hl7.org/fhir/mapping-language.html#syntax</a>). But we got rid of this as well, but the ticket has not yet been applied.</p>",
        "id": 252746991,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631260553
    },
    {
        "content": "<p>Single quotes would then only be used within FHIRPath statements for strings, no?</p>",
        "id": 252747154,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631260655
    },
    {
        "content": "<p>I'll check with that assumption in mind to see what comes out.</p>",
        "id": 252753053,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631263729
    },
    {
        "content": "<p>Is the \\ still used for delimiting the backtics, or double back tic ``</p>",
        "id": 252787410,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631280856
    },
    {
        "content": "<p>How about this rule from the example... <span class=\"user-mention\" data-user-id=\"193430\">@Alexander Zautke</span> </p>\n<div class=\"codehilite\"><pre><span></span><code>  //for each answer item in the questionnareResponse, create an Observation and add it to the groupObservation\n  src.item as answerItem1 where &quot;linkId = &#39;/88122-7&#39;&quot; -&gt; bundle.entry as entry, entry.resource = create(&#39;sdohccObservation&#39;) as observation1 then\n    TransformObservation(src, answerItem1, observation1, entry), TransformObservation1(src, answerItem1, observation1, entry);\n</code></pre></div>\n<p>According to the grammar, dependent invocations can't repeat (only rules can)</p>\n<div class=\"codehilite\"><pre><span></span><code>dependent\n    : &#39;then&#39; (invocation | rules)\n    ;\n</code></pre></div>\n<p>Is there intended to be an <code>invocations</code> node in the grammar?</p>",
        "id": 252891993,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631347414
    },
    {
        "content": "<p>My first FHL =&gt; StructureMap resource conversion<br>\n<a href=\"https://sqlonfhir-r4.azurewebsites.net/fhir/StructureMap/Hunger-Vital-Sign\">https://sqlonfhir-r4.azurewebsites.net/fhir/StructureMap/Hunger-Vital-Sign</a><br>\n(ignore the narrative shown in it, that part is in progress still, and yet to do the QA checks on the mapping to ensure that I've correctly mapped it)<br>\n<a href=\"http://hl7.org/fhir/us/sdoh-clinicalcare/STU1/mapping_instructions.html#hvs\">http://hl7.org/fhir/us/sdoh-clinicalcare/STU1/mapping_instructions.html#hvs</a></p>",
        "id": 252937922,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631397121
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> I have some free time over the next hours, would now be a good time to take a look at these issues?</p>",
        "id": 253303440,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631645629
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191478\">@Oliver Egger</span> would this work for you, too?</p>",
        "id": 253303532,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631645652
    },
    {
        "content": "<p>Come on over to the questionnaire track if you like</p>",
        "id": 253303556,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1631645662
    },
    {
        "content": "<p>I don't see any active sessions in Whova for the Questionnaire track, which one are you using?</p>",
        "id": 253304854,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631646123
    },
    {
        "content": "<p><a href=\"http://jira.hl7.org/browse/FHIR-20841\">FHIR-20841</a> - Rule source 'default' should be of type string<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20844\">FHIR-20844</a> - Add date, time and dateTime to StructureMap.group.rule.target.parameter.value[x]<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20842\">FHIR-20842</a> - Dependent variables should be of type “id” - StructureMap Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-25286\">FHIR-25286</a> - Harmonize delimitedIdentifiers in FHIRPath and Mapping Language - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-28465\">FHIR-28465</a> - Replace isInteger with convertsToInteger() in Mapping Language Tutorial - Tutorial Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20840\">FHIR-20840</a> - Document that repeating dependent rules are allowed - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20848\">FHIR-20848</a> - Can dependent rules and nested rules be combined?<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-25266\">FHIR-25266</a> - StructureMap does not account for escaped identifiers in id fields - StructureMap change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-21642\">FHIR-21642</a> - Add \"const\" keyword to the mapping language - Syntax change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-22110\">FHIR-22110</a> - Add \"doccomments\" facility to the mapping language - Syntax change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-22622\">FHIR-22622</a> - Is the Mapping \"map\" statement followed by a string or an identifier? - Syntax change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-27915\">FHIR-27915</a> - Replace \"map\" statement with shorthand synatx - Syntax change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20577\">FHIR-20577</a> - Add Media Type for FHIR Mapping Language - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20845\">FHIR-20845</a> - Can 'type' and 'min'/'max' be used independently? - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20846\">FHIR-20846</a> - Should we align transforms and FhirPath? - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20905\">FHIR-20905</a> - How to hande an element with a choice of types as the target in a mapping rule - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-21641\">FHIR-21641</a> - Allow for a source statement to walk deeper into the children - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-21643\">FHIR-21643</a> - Document listmode and update ANTLR grammar - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-22774\">FHIR-22774</a> - Document support for implicit casts in mapping language - Documentation change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-23007\">FHIR-23007</a> - In mapping language, talk about trees instead of DAGs - Documentation change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-23010\">FHIR-23010</a> - In mapping language, state that rule application order is implementation-dependent - Documentation change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-25220\">FHIR-25220</a> - Clarify language around invoking multiple groups - Documentation change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-25376\">FHIR-25376</a> - Clarify behaviour for matching multiple source statements - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-27140\">FHIR-27140</a> - Mapping Language - type parameter of cast function should contain model info - Documentation Change<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20847\">FHIR-20847</a> - What's the purpose of target.contextType?<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20849\">FHIR-20849</a> - Make name optional for mapping rules<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20849\">FHIR-20849</a> - Make name optional for mapping rules<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20843\">FHIR-20843</a> - Consider removing 'none' from StructureMapGroupTypeMode<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-20839\">FHIR-20839</a> - Allow mapping groups with 0 rules<br>\n<a href=\"http://jira.hl7.org/browse/FHIR-23937\">FHIR-23937</a> - Document parameters of dateOp</p>",
        "id": 253318780,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1631651318
    },
    {
        "content": "<p>I'm not sure. is there open issues from this thread?</p>",
        "id": 254098557,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1632163615
    },
    {
        "content": "<p>The inconsistencies I noted were in this list, but hadn't been applied to the R5 spec yet.<br>\n(and I'm working with R4 not R5, which didn't help me either)</p>",
        "id": 254102587,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1632165234
    }
]