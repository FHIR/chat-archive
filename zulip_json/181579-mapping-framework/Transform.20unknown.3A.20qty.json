[
    {
        "content": "<p>I'm trying to use qty to transform a string into a Quantity resource. More generally I am trying to map a part in a QuestionnaireResponse (QR) to a quantity, specifically to Medication.strength.numerator. When I try to post my mapping to <a href=\"https://test.ahdis.ch/r4/StructureMap\">this URL</a> it's successfully converts the mapping to a StructureMap.<br>\nThe part in the mapping that uses qty is <code>strength.numerator = qty(val)</code>, where <code>val</code> is the answer as  a string such as \"5 mg\".<br>\nWhen I POST the QR I get the error \"Failed to call access method: java.lang.Error: Rule \\\"value\\\": Transform Unknown: qty\".<br>\nI've also been trying to use <a href=\"https://www.hl7.org/fhir/mapping-language.html\">evaluate</a> and <a href=\"http://hl7.org/fhirpath/\">FHIRpath expressions</a>,<br>\nI didn't fully understand the syntax described for evaluate, so any examples would be useful.<br>\nEventually I tried <code>evaluate(val, toQuantity)</code> in the mapping which was then converted to StructureMap w/ no errors, but when posting the QR  I got the following error, where \"val\" in the QR == \"23.4 mg\"<br>\n<code>\"Failed to call access method: org.hl7.fhir.exceptions.FHIRException: Exception executing transform strength.numerator = evaluate(valtoQuantity) on Rule \\\"value\\\": Error @1, 2: Premature ExpressionNode termination at unexpected token \\\"mg\\\"\"</code></p>",
        "id": 241577776,
        "sender_full_name": "Corey Wen",
        "timestamp": 1622832481
    },
    {
        "content": "<p>I was also getting that error when I tried using qty(val) so as a work-around, I just call create('Quantity') like below:</p>\n<div class=\"codehilite\" data-code-language=\"answeritem\"><pre><span></span><code>    answerItem.answer as answer -&gt; observation.value = create('Quantity') as newQty then {\n      answer.value as vs -&gt; newQty.value = vs;\n      src -&gt; newQty.unit = '/a';\n      src -&gt; newQty.system = 'http://unitsofmeasure.org';\n      src -&gt; newQty.code = '/a';\n    };\n  };\n</code></pre></div>",
        "id": 241583045,
        "sender_full_name": "Joee Garcia",
        "timestamp": 1622835340
    },
    {
        "content": "<p>Why is newQty .unit and .code set equal to <code>'/a'</code>? Also, in your example, is answer.value a string or is it guaranteed to be a number?<br>\nIn the case answer.value is \"12.3 mg\" how can the .value of Quantity be assigned? Is there a way to parse out the number and unit without the qty transform?<br>\nI believe qty accepts strings in the form <code>[comparator]value[space]unit</code> which is why I've looking to use it.</p>",
        "id": 241592396,
        "sender_full_name": "Corey Wen",
        "timestamp": 1622840347
    }
]