[
    {
        "content": "<p>I am trying to fix some reported Forge issues and need a bit of clarification on new named slices in derived profiles.</p>\n<p>A derived profile can introduce new named slices to an existing slice group.<br>\nBy default, the new slices are appended to the existing named slices in the base profile.</p>\n<p>Example 1:</p>\n<p>Base profile:<br>\n- Patient.identifier<br>\n- Patient.identifier:foo<br>\n- Patient.identifier:bar</p>\n<p>Derived profile differential:<br>\n- Patient.identifier:baz</p>\n<p>=&gt; Derived profile snapshot:<br>\n- Patient.identifier<br>\n- Patient.identifier:foo<br>\n- Patient.identifier:bar<br>\n- Patient.identifier:baz  &lt;= Append new named slice after all existing named slices</p>\n<p>I am wondering if FHIR also allows a derived profile to _insert_ new named slices into an existing (ordered) slice group?</p>\n<p>Example 2, with same base profile:</p>\n<p>Derived profile differential:<br>\n- Patient.identifier:baz<br>\n- Patient.identifier:foo</p>\n<p>=&gt; Derived profile snapshot:<br>\n- Patient.identifier<br>\n- Patient.identifier:baz  &lt;= Insert new named slice before \"foo\" ?<br>\n- Patient.identifier:foo<br>\n- Patient.identifier:bar</p>\n<p>This would require the snapshot generator to perform some kind of \"peek ahead\",<br>\nwhich seems quite complicated to implement reliably and without breaking any existing behavior (if possible at all...?).<br>\nSo first I'd like to verify whether FHIR even allows this.</p>\n<p>I guess this also depends on the exact definition of an ordered slice group.<br>\n<a href=\"http://hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.slicing.ordered\" target=\"_blank\" title=\"http://hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.slicing.ordered\">http://hl7.org/fhir/elementdefinition-definitions.html#ElementDefinition.slicing.ordered</a><br>\n\"If the matching elements have to occur in the same order as defined in the profile.\"<br>\nAssuming the slice group in the base profile above is ordered, what is the correct interpretation?</p>\n<p>Interpretation 1:<br>\nIf an instance contains a \"foo\" slice, it cannot not be preceded by any other slice (i.e. must be the very first slice).<br>\nIf an instance contains a \"bar\" slice, it can only be preceded by a \"foo\" slice (i.e. must be first or second slice).<br>\n=&gt; other named slices may only occur after any \"foo\" and/or \"bar\" slices.<br>\n=&gt; a derived profile is only allowed to append new named slices, not insert them.</p>\n<p>Interpretation 2:<br>\nIf an instance contains both \"foo\" and \"bar\" slices, then \"foo\" must preceed \"bar\" (not necessarily immediate neighbours)<br>\n=&gt; other named slices may occur before, in between or after \"foo\" and \"bar\".<br>\n=&gt; a derived profile is allowed to introduce new named slices in any position.</p>\n<p>Questions:<br>\n- What is the correct interpretation of an \"ordered\" slice?<br>\n- Does FHIR allow derived profiles to _insert_ new named slices (such as in Example 2)?</p>",
        "id": 153966708,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1528132073
    },
    {
        "content": "<p>have you seen build\\tests\\resources\\snapshot-generation-tests.xml ?</p>",
        "id": 153966727,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528136424
    },
    {
        "content": "<p>it doesn't include that, so we can say with confidence that it's not tested behaviour</p>",
        "id": 153966728,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528136603
    },
    {
        "content": "<p>certainly if the slice is ordered, you cannot insert</p>",
        "id": 153966729,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528136644
    },
    {
        "content": "<p>if the slicing is not ordered, I don't see what the need for inseertion is</p>",
        "id": 153966730,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1528136680
    },
    {
        "content": "<blockquote>\n<p>certainly if the slice is ordered, you cannot insert</p>\n</blockquote>\n<p>That answers my question. Thanks Grahame.</p>",
        "id": 153967013,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1528190321
    },
    {
        "content": "<p>Just for clarity here, we have both (1) if the slice is ordered, you cannot insert and (2) if the slicing is not ordered there is no need or use for insertion (my slight paraphrase).  So, basically it would make sense to disallow insertion and to allow append and handle them the same whether the slicing is ordered or unordered, correct?</p>",
        "id": 153967147,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1528226762
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>, indeed, I drew the same conclusion.</p>",
        "id": 153967295,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1528278770
    },
    {
        "content": "<p>This also ensures that the logic is actually implementable, which is kinda nice.</p>",
        "id": 153967296,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1528278792
    },
    {
        "content": "<p>yes</p>",
        "id": 153967381,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1528296292
    }
]