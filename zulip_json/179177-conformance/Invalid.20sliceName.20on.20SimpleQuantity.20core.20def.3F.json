[
    {
        "content": "<p>We recently received a bug report on the .NET snapshot generator concerning unexpected slice names in the snapshot.</p>\n<p>After closer analysis, I noticed that the core definition of the SimpleQuantity datatype specifies an explicit slice name on the root element:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;differential&gt;\n  &lt;element id=&quot;Quantity:simplequantity&quot;&gt;\n    &lt;path value=&quot;Quantity&quot; /&gt;\n    &lt;sliceName value=&quot;SimpleQuantity&quot; /&gt;\n    &lt;!-- ... --&gt;\n</pre></div>\n\n\n<p>Currently, because of the way the snapshot generator works,  profiles that reference the SimpleQuantity datatype automatically inherit the slice name from the core definition. This confuses the profile author and causes unexpected tooling issues.</p>\n<p>This seems incorrect? As in general, I never expect slice names to occur in core defs and neither on root elements.</p>\n<p>Suggestions:<br>\n1) Remove the invalid slice name from the root element of the official SimpleQuantity datatype definition in the FHIR spec<br>\n2) Implement additional rule in the snapshot generator to generate warnings when slice names are found on core definitions and/or root elements.  The snapshot generator could then pro-actively delete/ignore the specified slice name. This would automatically detect and fix any future errors in the core spec.</p>",
        "id": 153901593,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1502369647
    },
    {
        "content": "<p>Agree that there should be no sliceName on the root element.  Grahame - is this something we can fix with a patch?</p>",
        "id": 153901622,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1502378037
    },
    {
        "content": "<p>Maybe the official build could run a simple validation rule to verify that core defs do not contain any non-null slice names? This way, future regressions would be detected immediately.</p>",
        "id": 153901624,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1502378218
    },
    {
        "content": "<p>Well, the true validation is that sliceName should only appear when there's slicing in scope - either from the current resource definition or on the path inherited from the parent</p>",
        "id": 153901628,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1502379003
    },
    {
        "content": "<p>I'm not convinced that this is wrong. I think we should talk about this in San Diego</p>",
        "id": 153901800,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1502399976
    },
    {
        "content": "<p>This has been discussed at length in the past - it's not valid to have a sliceName on the root element.</p>",
        "id": 153901801,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1502400037
    },
    {
        "content": "<p>It's an artifact from pre-STU3 where \"name\" was used to simply label things.</p>",
        "id": 153901803,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1502400103
    },
    {
        "content": "<p>i don't think it's so simple. In this case, the slice name is used to make the ids on the ElementDefinition unique across the buld</p>",
        "id": 153901804,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1502400176
    },
    {
        "content": "<p>Why should element ids be unique across the build?  They're only supposed to be unique in the context of a model.  It makes no sense to use a sliceName when you're not slicing.</p>",
        "id": 153901819,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1502401365
    },
    {
        "content": "<p>it's useful, if you're taking a data element based look at the spec, to have unique names for the data elements</p>",
        "id": 153901823,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1502402708
    },
    {
        "content": "<p>What does the slice name (value=\"SimpleQuantity\") give you that is not in the id (id=\"Quantity:simplequantity\")?</p>",
        "id": 153901901,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1502410405
    },
    {
        "content": "<p>The unique name is <code>http://hl7.org/fhir/StructureDefinition/SimpleQuantity#Quantity</code></p>",
        "id": 153901902,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1502410460
    },
    {
        "content": "<p>id=\"Quantity:simplequantity\" - that is the slice name right there</p>",
        "id": 153901913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1502410590
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191682\">@Richard Townley-O'Neill</span> the id only includes the <code>:simplequantity</code> part if the sliceName is populated (elementdefinition ids are calculated).</p>",
        "id": 153901914,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1502410593
    },
    {
        "content": "<p>Is that a requirement of FHIR (hard to change) or a convenient way of generating the id (maybe easier to change)?</p>",
        "id": 153901915,
        "sender_full_name": "Richard Townley-O'Neill",
        "timestamp": 1502411032
    },
    {
        "content": "<p>yes and yes</p>",
        "id": 153901917,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1502411058
    },
    {
        "content": "<p>Data elements aren't elements.  I'm fine with you prefixing the data element with the model id if the root element isn't the model id.  But you don't need to mess up the element ids to do that, nor do you need to abuse sliceName.  sliceName's semantics are clear.  The way you're using it is clearly in violation of the definition and also unnecessary.</p>",
        "id": 153902000,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1502424888
    },
    {
        "content": "<p>I tend to agree with Chris &amp; Lloyd on this issue. FHIR requires that element id's are unique within the context of a resource (except repeated in snap/diff). However there is no guarantee or expectation that generated id's are globally unique.  (Ab-)using the root element slice name for this purpose causes unexpected behavior in derived profiles downstream, due to the way snapshot generation currently works. I'm not sure if a snapshot generator could handle this reliably, as I suspect that this could introduce ambiguities...?</p>",
        "id": 153902058,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1502441713
    },
    {
        "content": "<p>Maybe we could allow this by introducing a special rule stating that slice names on root elements are never inherited by the referencing profile when applied as an element type profile?<br>\nBut frankly, I'm reluctant to introduce additional complexity to slicing... rather not.</p>",
        "id": 153902065,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1502442207
    }
]