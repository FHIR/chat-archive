[
    {
        "content": "<p>I created this profile: <a href=\"https://simplifier.net/BasisprofilDE/address-de-basis\" target=\"_blank\" title=\"https://simplifier.net/BasisprofilDE/address-de-basis\">https://simplifier.net/BasisprofilDE/address-de-basis</a><br>\nIt has two extensions on Adress.line: one for the house number and one for the street name<br>\nI added a constraint to each which is supposed to test whether the extensions are populated and make sure, that Address.line is also filled.<br>\nThe point is to prevent implementers from only using the extensions without populating the Adress.line element.</p>\n<p>However, this  doesn't seem to work:</p>\n<div class=\"codehilite\"><pre><span></span>            <span class=\"nt\">&lt;constraint&gt;</span>\n                <span class=\"nt\">&lt;key</span> <span class=\"na\">value=</span><span class=\"s\">&quot;add-1&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;severity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;error&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;human</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Wenn die Extension Hausnummer verwendet wird, muss auch die Adress-Zeile gef√ºllt werden&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;expression</span> <span class=\"na\">value=</span><span class=\"s\">&quot;line.extension:Hausnummer.empty() or line.exists()&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/constraint&gt;</span>\n</pre></div>\n\n\n<p>When I try to validate the example on Simplifier, I get this error:<br>\nEvaluation of FhirPath for constraint 'add-1' failed: Compilation failed: Parsing failure: unexpected ':'; expected end of input (Line 1, Column 15); recently consumed: .extension </p>\n<p>Location: Organization.address[0] </p>\n<p>Apparently my expression is wrong...</p>",
        "id": 153888516,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1494259295
    },
    {
        "content": "<p>I think it should be :</p>\n<p><code>line.extension(http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName).empty() or line.exists()</code></p>",
        "id": 153888521,
        "sender_full_name": "Marten Smits",
        "timestamp": 1494261795
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>line.extension(&#39;http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName&#39;).empty() or line.exists()\n</pre></div>",
        "id": 153888527,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1494263817
    },
    {
        "content": "<p>Thank you! That helped!<br>\nI think the FHIRPath documentation could need an example for this...<br>\nI had trouble finding hints at <a href=\"http://hl7.org/fhirpath/\" target=\"_blank\" title=\"http://hl7.org/fhirpath/\">http://hl7.org/fhirpath/</a> about how to deal with extensions like this.</p>",
        "id": 153888601,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1494318329
    },
    {
        "content": "<p>I agree, that documentation page needs some love. Happy to help with that!</p>",
        "id": 153888603,
        "sender_full_name": "Marten Smits",
        "timestamp": 1494318870
    },
    {
        "content": "<p>you can create tasks for FHIRPath in gForge</p>",
        "id": 153888605,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1494319297
    },
    {
        "content": "<p><a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13350\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13350\">GF#13350</a></p>",
        "id": 153888608,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1494319810
    },
    {
        "content": "<p>BTW: Gforge still lists only \"fluentpath\" in the HTML Page(s) box</p>",
        "id": 153888610,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1494319842
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> please rename fluentpath to fhirpath</p>",
        "id": 153888620,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1494321750
    },
    {
        "content": "<p>Done</p>",
        "id": 153888649,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1494332104
    },
    {
        "content": "<p>About this: </p>\n<div class=\"codehilite\"><pre><span></span>line.extension(&#39;http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName&#39;).empty() or line.exists()\n</pre></div>\n\n\n<p>does line.exists() return true if it's value is empty but it has extensions?<br>\nThe invariant doesn't seem to work (at least not on simplifier, currently)</p>",
        "id": 153895561,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1498686466
    },
    {
        "content": "<p>yes. Looks like it needs .hasValue()</p>",
        "id": 153895600,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1498717240
    },
    {
        "content": "<p>not .exists()</p>",
        "id": 153895601,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1498717244
    },
    {
        "content": "<p>Sounds obvious, when you don't stumble upon such things around midnight <img alt=\":joy:\" class=\"emoji\" src=\"/static/generated/emoji/images/emoji/joy.png\" title=\":joy:\"><br>\nI also just confirmed it's not a Simplifier issue; same behaviour for the official validator.</p>",
        "id": 153895629,
        "sender_full_name": "Stefan Lang",
        "timestamp": 1498723035
    },
    {
        "content": "<p>Can anyone explain, why this example</p>\n<div class=\"codehilite\"><pre><span></span><span class=\"nt\">&lt;Patient&gt;</span>\n    <span class=\"nt\">&lt;meta&gt;</span>\n        <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhir.de/StructureDefinition/patient-de-basis&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/meta&gt;</span>\n    <span class=\"nt\">&lt;identifier&gt;</span>\n        <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://fhir.de/NamingSystem/gkv/kvid-10&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;G995030567&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/identifier&gt;</span>\n    <span class=\"nt\">&lt;name&gt;</span>\n        <span class=\"nt\">&lt;family</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Mustermann&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;given</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Max&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/name&gt;</span>\n    <span class=\"nt\">&lt;address&gt;</span>\n        <span class=\"nt\">&lt;line&gt;</span>\n            <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName&quot;</span><span class=\"nt\">&gt;</span>\n                <span class=\"nt\">&lt;valueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Testwegs&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/extension&gt;</span>\n        <span class=\"nt\">&lt;/line&gt;</span>\n    <span class=\"nt\">&lt;/address&gt;</span>\n<span class=\"nt\">&lt;/Patient&gt;</span>\n</pre></div>\n\n\n<p><a href=\"https://simplifier.net/LHITCSandbox/Patient-example345/~xml\" target=\"_blank\" title=\"https://simplifier.net/LHITCSandbox/Patient-example345/~xml\">https://simplifier.net/LHITCSandbox/Patient-example345/~xml</a><br>\nsuccessfully validates against this Patient profile<br>\n<a href=\"https://simplifier.net/BasisprofilDE/patient-de-basis\" target=\"_blank\" title=\"https://simplifier.net/BasisprofilDE/patient-de-basis\">https://simplifier.net/BasisprofilDE/patient-de-basis</a><br>\nwhich references this Address profile<br>\n<a href=\"https://simplifier.net/BasisprofilDE/address-de-basis\" target=\"_blank\" title=\"https://simplifier.net/BasisprofilDE/address-de-basis\">https://simplifier.net/BasisprofilDE/address-de-basis</a><br>\nwhich has this constraint on the streetname-extension:<br>\n<code>line.extension('http://hl7.org/fhir/StructureDefinition/iso21090-ADXP-streetName').empty() or line.hasValue())</code></p>\n<p>What we're trying to accomplish here is to enforce that the address.line value is populated, whenever one of the line-extensions is populated</p>",
        "id": 153895635,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1498726107
    },
    {
        "content": "<p>Ok, I did two things:<br>\na) I moved the invariants from the extensions to the Address. I assume the FHIR-Path expressions are always relative to the node to which they are assigned? In that case of course the expression couldn't be evaluated, as the extensions themselves don't have a line attribute<br>\nb) opened and saved the patient profile in forge and re- commited it to simplifier <br>\nI didn't realize, the address profile is embedded in the snapshot of the patient profile!<br>\nI thought that was a reference that's evaluated at runtime during validation. But apparently not.</p>\n<p>Anyway: it's working now!</p>",
        "id": 153895689,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1498765287
    },
    {
        "content": "<p>\"I didn't realize, the address profile is embedded in the snapshot of the patient profile!\"</p>\n<p>Yes, if a differential adds a constraint on an element that is a datatype (in this case of type Address), the node will be expanded into the profile, to be able to express that constraint. All non-changed properties of the datatype will then also be copied into the snapshot....</p>",
        "id": 153895823,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1498821563
    },
    {
        "content": "<p>Makes sense. It's a bit tricky on Simplifier though, to maintain consistency among the profiles, as we have to maually recreate all dependent snapshots with Forge and reupload them, when changing the profile of a datatype. </p>",
        "id": 153895826,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1498823816
    },
    {
        "content": "<p>Would a console-type app help that you could run over all profiles?</p>",
        "id": 153895842,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1498831171
    },
    {
        "content": "<p>This is of course the classic case where a dependency changes, and we need to update all the snapshots.  I don't think this should be done automatically - the author of the referring SD might want to decide for him/herself when to do this....</p>",
        "id": 153895843,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1498831242
    },
    {
        "content": "<p>I think the best thing would be to have a button at the profile page in simplifier to rebuild the snapshot and one on the project page to rebuild all snapshots (once simplifier is able to create snapshots...) <br>\nUntil then a console app that goes through the contents of a folder and recreates all the snapshots would be a nice workaround.</p>",
        "id": 153895896,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1498894484
    },
    {
        "content": "<p>Doesn't the official IG publisher do that?</p>",
        "id": 153895907,
        "sender_full_name": "Stefan Lang",
        "timestamp": 1498928715
    },
    {
        "content": "<p>yes the IG Publisher regenerates all the snapshots. But you might not be using that </p>",
        "id": 153895927,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1499055458
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> \"a button at the profile page\" -- we are working on that right now.</p>",
        "id": 153896062,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1499241457
    }
]