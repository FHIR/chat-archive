[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span> I'm still chipping away at the zib snapshot generation issues. When the snapshot generator runs into the construct below, it returns this error:</p>\n<p><code>Unable to generate snapshot for http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-PregnancyDuration because Error at path Observation.value[x] in http://nictiz.nl/fhir/StructureDefinition/zib-Pregnancy-PregnancyDuration: Type slicing with slicing.discriminator.type != 'type'</code></p>\n<p>The differential in question says this:</p>\n<div class=\"codehilite\"><pre><span></span>   <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;slicing&gt;</span>\n        <span class=\"nt\">&lt;discriminator&gt;</span>\n          <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;value&quot;</span> <span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;code&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/discriminator&gt;</span>\n        <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;closed&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/slicing&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>\n\n\n<p>I don't understand what this is trying to do - to slice an polymorphic element that can't repeat by anything other than type, and the validator doesn't support this. I don't see that it makes sense either, and so I think this is an error in your profiles, but I'm interested in discussion here.</p>",
        "id": 182197894,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575053797
    },
    {
        "content": "<p>btw, here's the first slice:</p>\n<div class=\"codehilite\"><pre><span></span>   <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationDays&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDurationDays&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDuration&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Duration of the pregnancy on the day on which the patient was asked. The duration can be entered in days (d) or weeks (wk).&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;alias</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Zwangerschapsduur&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Quantity&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;hcim-pregnancy-v3.1-2017EN&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;NL-CM:7.14.4&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;comment</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDuration&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationDays.unit&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].unit&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;defaultValueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;days&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationDays.system&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].system&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedUri</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationDays.code&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].code&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedCode</span> <span class=\"na\">value=</span><span class=\"s\">&quot;d&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 182198017,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575053950
    },
    {
        "content": "<p>and here's the second:</p>\n<div class=\"codehilite\"><pre><span></span>   <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationWeeks&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x]&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDurationWeeks&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDuration&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Duration of the pregnancy on the day on which the patient was asked. The duration can be entered in days (d) or weeks (wk).&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;alias</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Zwangerschapsduur&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Quantity&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;hcim-pregnancy-v3.1-2017EN&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;NL-CM:7.14.4&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;comment</span> <span class=\"na\">value=</span><span class=\"s\">&quot;PregnancyDuration&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationWeeks.unit&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].unit&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;defaultValueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;weeks&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationWeeks.system&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].system&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedUri</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;Observation.value[x]:PregnancyDurationWeeks.code&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Observation.value[x].code&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;fixedCode</span> <span class=\"na\">value=</span><span class=\"s\">&quot;wk&quot;</span> <span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 182198037,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575053997
    },
    {
        "content": "<p>I can't see how these are usefully different to each other except to set the default value for the unit. Which you shouldn't be doing anyway, and I'm surprised isn't an error (though it might be  the discriminator would be found first)</p>",
        "id": 182198148,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575054089
    },
    {
        "content": "<p>I see we did not make a formal invariant for that rule until R4. but it has been in narrative from the beginning</p>",
        "id": 182198305,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575054268
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> This 'little gem' comes from the functional model <a href=\"https://zibs.nl/wiki/Pregnancy-v3.1(2017EN)\" target=\"_blank\" title=\"https://zibs.nl/wiki/Pregnancy-v3.1(2017EN)\">HCIM Pregnancy</a>. This lists a concept PregnancyDuration in either days or weeks. Hence we'd like to say that you may use PregnancyDuration using code d or code wk.</p>\n<p>I suppose you could achieve the same thing using a  UCUM value set binding containing d/wk on valueQuantity as implicit slice? If you think that is a better solution, we can update for that.</p>",
        "id": 182230256,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575102960
    },
    {
        "content": "<p>I've checked in the suggested update for the profile in the develop branch under commit id <a href=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/commit/af6423d57f4f67996d4619f93d91ae90822bad74\" target=\"_blank\" title=\"https://github.com/Nictiz/Nictiz-STU3-Zib2017/commit/af6423d57f4f67996d4619f93d91ae90822bad74\">af6423d57f4f67996d4619f93d91ae90822bad74</a>. Let me know if that solved this issue.</p>",
        "id": 182231601,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575105745
    },
    {
        "content": "<p>Ok, I’ll look. I definitely think that a value set is a much simpler way to meet this requirement for everyone</p>",
        "id": 182231656,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1575105853
    },
    {
        "content": "<p>Well it sure makes for easier reading :-)</p>",
        "id": 182231660,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575105875
    },
    {
        "content": "<p>Mental note to <span class=\"user-mention\" data-user-id=\"216303\">@Pieter Edelman</span>: if this is the better way to go, we should update our profiling guidelines for how to attach units to quantities.</p>",
        "id": 182231672,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1575105935
    },
    {
        "content": "<p>Agree that this is much more elegant. I'll update our guidelines.</p>",
        "id": 182322506,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1575273335
    }
]