[
    {
        "content": "<p>When validating some resources against the vital signs profiles in the core spec, the additional constraint on <code>effective[x]</code> is raising a question for me, e.g. on <a href=\"http://hl7.org/fhir/StructureDefinition/bodyweight\">http://hl7.org/fhir/StructureDefinition/bodyweight</a>. I was expecting to be allowed to use the <code>dataAbsentReason</code> extension on <code>effectiveDateTime</code> in case the time is unknown, but the validator throws an error due to <code>vs-1: if Observation.effective[x] is dateTime and has a value then that value shall be precise to the day</code>. I can see that  with <code>($this as dateTime).toString().length() &gt;= 8\"</code> the extension is treated as dateTime which returns an empty result which is then evaluated and raises the error. Now from a conformance perspective, is the profile's intent here to make the actual value of type dateTime mandatory? Because my understanding of the invariant's human-readable description is less strict and would allow the use of extensions.</p>",
        "id": 234665779,
        "sender_full_name": "Julian Sass",
        "timestamp": 1618489724
    },
    {
        "content": "<p>The way the invariant is written, it doesn't allow for extensions.  This is addressed in R5, but I'm afraid it's broken in R4.</p>",
        "id": 234749169,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1618519326
    },
    {
        "content": "<p>Thanks for the clarification</p>",
        "id": 234804330,
        "sender_full_name": "Julian Sass",
        "timestamp": 1618556621
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"343284\">@Cornelius Erbelding</span> fyi</p>",
        "id": 234825245,
        "sender_full_name": "Julian Sass",
        "timestamp": 1618566715
    },
    {
        "content": "<p>Looking at <a href=\"http://jira.hl7.org/browse/FHIR-29654\">J#29654</a> and the proposed solution here: <a href=\"#narrow/stream/179309-inferno/topic/Single.20Patient.20API.20Observation.20Tests\">https://chat.fhir.org/#narrow/stream/179309-inferno/topic/Single.20Patient.20API.20Observation.20Tests</a></p>\n<p>Wouldn't it be necessary to add a hasValue check to the existence check for Observation.effectiveDateTime? Like \"Observation.effectiveDateTime.hasValue() implies Observation.effectiveDateTime.toString().length() &gt;= 8\"?</p>",
        "id": 236673895,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1619703474
    },
    {
        "content": "<p>Yes.  Can you post a comment to the issue?</p>",
        "id": 236683768,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1619707079
    },
    {
        "content": "<p>I put <code>($this.exists() is dateTime) implies ($this.exists().toString().length() &gt;=8)</code> on effectiveDateTime and it seems to work. Never knew about the other solution :)</p>",
        "id": 236683956,
        "sender_full_name": "Julian Sass",
        "timestamp": 1619707149
    },
    {
        "content": "<p>exists would return a boolean and should never <em>be</em> dateTime.  And exists().toString() ought to be 'true' or 'false' and thus never &gt;= 8...</p>",
        "id": 236684350,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1619707288
    },
    {
        "content": "<p>Arg right, it doesn't check the date properly.</p>",
        "id": 236685325,
        "sender_full_name": "Julian Sass",
        "timestamp": 1619707603
    },
    {
        "content": "<p>ok.. how does <code>implies</code> work exactly? I mean if I have <code>(expression1) implies (expression2)</code> and <code>expression1</code> is false, does <code>implies</code> mean that <code>expression2</code> won't have to be proven? Or does FHIRPath still look into <code>expression2</code> anyways?</p>",
        "id": 236687730,
        "sender_full_name": "Andrea Essenwanger",
        "timestamp": 1619708419
    },
    {
        "content": "<p>See <a href=\"http://hl7.org/fhirpath/#implies\">http://hl7.org/fhirpath/#implies</a></p>",
        "id": 236690656,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1619708986
    }
]