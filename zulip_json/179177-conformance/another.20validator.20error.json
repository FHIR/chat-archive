[
    {
        "content": "<p>I'm getting this error (which I haven't seen before) with the latest 3.8.15-SNAPSHOT validator when I run it standalone on the IPS example bundle <a href=\"https://build.fhir.org/ig/HL7/fhir-ips/Bundle-IPS-examples-Bundle-01.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/fhir-ips/Bundle-IPS-examples-Bundle-01.html\">here</a>:</p>\n<div class=\"codehilite\"><pre><span></span>FHIR Validation tool Version 3.8.15-SNAPSHOT - Built 2019-07-31T04:48:42.259Z - Git 654153671a8c\nArguments: /Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01.xml -ig hl7.fhir.uv.ips\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#current\n    (v4.0.0)\n+  .. load IG from hl7.fhir.uv.ips\n   ... Using version 0.3.0\n ..file: ValueSet-imaging-area-measure-code-uv-ips.json ..file: StructureDefinition-Observation-member-laboratory-uv-ips.json ..file: ValueSet-condition-severity-uv-ips.json ..file: StructureDefinition-abatement-dateTime-uv-ips.json ..file: ValueSet-imaging-numobs-uv-ips.json ..file: StructureDefinition-Organization-laboratory-uv-ips.json ..file: ValueSet-absent-or-unknown-allergies-uv-ips.json ..file: ValueSet-lab-blood-abo-rh-grp-uv-ips.json ..file: ValueSet-procedures-uv-ips.json ..file: StructureDefinition-Quantity-uv-ips.json ..file: ValueSet-target-site-uv-ips.json ..file: StructureDefinition-Specimen-uv-ips.json ..file: ValueSet-whoatc-uv-ips.json ..file: ValueSet-laboratory-and-vital-signs-observations.json ..file: ValueSet-edd-method-uv-ips.json ..file: ValueSet-absent-or-unknown-immunizations-uv-ips.json ..file: ValueSet-allergy-reaction-uv-ips.json ..file: StructureDefinition-Observation-alcoholuse-uv-ips.json ..file: StructureDefinition-Observation-pregnancy-status-uv-ips.json ..file: ValueSet-medicine-active-substances-uv-ips.json ..file: ValueSet-pathology-and-vital-signs-observations.json ..file: ValueSet-imaging-txtobs-code-uv-ips.json ..file: ValueSet-core-problem-list-disorders-uv-ips.json ..file: ValueSet-imaging-volume-measure-code-uv-ips.json ..file: StructureDefinition-Observation-tobaccouse-uv-ips.json ..file: StructureDefinition-Ratio-uv-ips.json ..file: ValueSet-medicine-route-of-administration.json ..file: StructureDefinition-Medication-uv-ips.json ..file: ValueSet-absent-or-unknown-devices-uv-ips.json ..file: StructureDefinition-Observation-pregnancy-edd-uv-ips.json ..file: StructureDefinition-DiagnosticReport-uv-ips.json ..file: ValueSet-absent-or-unknown-procedures-uv-ips.json ..file: ValueSet-vaccines-uv-ips.json ..file: ValueSet-med-uv-ips.json ..file: ValueSet-absent-or-unknown-problems-uv-ips.json ..file: StructureDefinition-MedicationStatement-uv-ips.json ..file: StructureDefinition-AllergyIntolerance-uv-ips.json ..file: ValueSet-medical-devices-uv-ips.json ..file: ValueSet-sub-observation-category-uv-ips.json ..file: ValueSet-specimen-collection-method-uv-ips.json ..file: StructureDefinition-Observation-member-pathology-uv-ips.json ..file: ValueSet-absent-or-unknown-medications-uv-ips.json ..file: StructureDefinition-Procedure-uv-ips.json ..file: ValueSet-allergy-intolerance-substance-condition-uv-ips.json ..file: ValueSet-personal-relationship-uv-ips.json ..file: StructureDefinition-ImagingStudy-uv-ips.json ..file: StructureDefinition-Device-uv-ips.json ..file: ValueSet-imaging-linear-measure-code-uv-ips.json ..file: ValueSet-laboratory-tests-and-panels-uv-ips.json ..file: ValueSet-pregnancy-status-uv-ips.json ..file: StructureDefinition-Condition-uv-ips.json ..file: StructureDefinition-CodeableConcept-uv-ips.json ..file: StructureDefinition-Range-uv-ips.json ..file: StructureDefinition-DeviceUseStatement-uv-ips.json ..file: ValueSet-lab-result-coded-value-uv-ips.json ..file: StructureDefinition-Observation-pregnancy-outcome-uv-ips.json ..file: ValueSet-microorganism-uv-ips.json ..file: ValueSet-observation-codes-uv-ips.json ..file: StructureDefinition-Observation-laboratory-uv-ips.json ..file: StructureDefinition-Organization-observation-uv-ips.json ..file: StructureDefinition-Observation-pathology-uv-ips.json ..file: StructureDefinition-Composition-uv-ips.json ..file: ValueSet-pathology-result-coded-value-uv-ips.json ..file: ImplementationGuide-ig-uv-ips.json ..file: ValueSet-lab-absence-presence-uv-ips.json ..file: ValueSet-medicine-doseform.json ..file: StructureDefinition-Coding-uv-ips.json ..file: ValueSet-imaging-observations-uv-ips.json ..file: CodeSystem-absent-unknown-uv-ips.json ..file: ValueSet-specimen-type-uv-ips.json ..file: ValueSet-current-smoking-status-uv-ips.json ..file: StructureDefinition-Immunization-uv-ips.json ..file: StructureDefinition-Observation-media-uv-ips.json ..file: StructureDefinition-Practitioner-uv-ips.json ..file: StructureDefinition-Observation-uv-ips.json ..file: StructureDefinition-Device-observer-uv-ips.json ..file: StructureDefinition-Patient-uv-ips.json ..file: ValueSet-pregnancies-summary-uv-ips.json ..file: ValueSet-problem-type-uv-ips.json ..file: StructureDefinition-Observation-member-imaging-uv-ips.json ..file: StructureDefinition-Observation-imaging-uv-ips.json ..file: StructureDefinition-participant-uv-ips.json  .. validate [/Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01.xml]\nTerminology server: Check for supported code systems for http://loinc.org\nException in thread &quot;main&quot; java.lang.Error: Not done yet - resolve Condition/c64139e7-f02d-409c-bf34-75e8bf23bc80 locally (2)\n    at org.hl7.fhir.r5.validation.InstanceValidator$ValidatorHostServices.resolveReference(InstanceValidator.java:236)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.funcResolve(FHIRPathEngine.java:3291)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateFunction(FHIRPathEngine.java:2721)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1136)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.execute(FHIRPathEngine.java:1163)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluate(FHIRPathEngine.java:540)\n    at org.hl7.fhir.r5.utils.FHIRPathEngine.evaluateToBoolean(FHIRPathEngine.java:596)\n    at org.hl7.fhir.r5.validation.InstanceValidator.evaluateSlicingExpression(InstanceValidator.java:2732)\n    at org.hl7.fhir.r5.validation.InstanceValidator.sliceMatches(InstanceValidator.java:2724)\n    at org.hl7.fhir.r5.validation.InstanceValidator.matchSlice(InstanceValidator.java:4226)\n    at org.hl7.fhir.r5.validation.InstanceValidator.assignChildren(InstanceValidator.java:4140)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:3855)\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:3990)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:3862)\n    at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:2895)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:4439)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateContains(InstanceValidator.java:3812)\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:3985)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:3862)\n    at org.hl7.fhir.r5.validation.InstanceValidator.checkChild(InstanceValidator.java:3990)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateElement(InstanceValidator.java:3862)\n    at org.hl7.fhir.r5.validation.InstanceValidator.start(InstanceValidator.java:2874)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validateResource(InstanceValidator.java:4439)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:768)\n    at org.hl7.fhir.r5.validation.InstanceValidator.validate(InstanceValidator.java:601)\n    at org.hl7.fhir.r5.validation.ValidationEngine.validate(ValidationEngine.java:926)\n    at org.hl7.fhir.r5.validation.ValidationEngine.validate(ValidationEngine.java:840)\n    at org.hl7.fhir.r5.validation.Validator.main(Validator.java:450)\n</pre></div>\n\n\n<p>The interesting thing is (unless I'm somehow mis-reading it) is that it seems to be working in the build (local or other).  I'm getting specific validation messages in the QA for that example file.</p>",
        "id": 172134352,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564584764
    },
    {
        "content": "<p>how can I reproduce this?</p>",
        "id": 172169851,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564610251
    },
    {
        "content": "<p>OK, I can give a little more detail.  Download the example bundle (link above) and then run the validator against it on the command line.  The command I'm using (in my current environment) is <code>java -jar ~/Downloads/org.hl7.fhir.validator.jar ~/git-repo/fhir-ips/examples/IPS-bundle-01.xml -ig hl7.fhir.uv.ips</code>.</p>",
        "id": 172187220,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564629818
    },
    {
        "content": "<p>fixed next release</p>",
        "id": 172195634,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564641331
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  When do you expect the next release?</p>",
        "id": 172268158,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564699445
    },
    {
        "content": "<p>today</p>",
        "id": 172269102,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564700575
    },
    {
        "content": "<p>With the new validator I've found a serious issue that's preventing me from using it on the command line (for some reason it seems to still be working in the build?).  Basically, it seems to no longer be able to recognize StructureDefinitions that are local to the IG (even though the ig package is being specified).  The local command I'm using is: <code>java -jar ~/Downloads/org.hl7.fhir.validator.jar ~/git-repo/fhir-ips/examples/IPS-bundle-01.xml -ig hl7.fhir.uv.ips</code>, and I'm getting:</p>\n<div class=\"codehilite\"><pre><span></span>FHIR Validation tool Version 3.8.19-SNAPSHOT - Built 2019-08-02T12:59:22.146Z - Git fb446cf1e27c\nArguments: /Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01.xml -ig hl7.fhir.uv.ips\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#current\n    (v4.0.0)\n+  .. load IG from hl7.fhir.uv.ips\n   ... Using version 0.3.0\n ..file: ImplementationGuide-hl7.fhir.uv.ips.json  .. validate [/Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01.xml]\nTerminology server: Check for supported code systems for http://loinc.org\n*FAILURE* validating /Users/rhausam/git-repo/fhir-ips/examples/IPS-bundle-01.xml:  error:1 warn:21 info:2\n  Error @ Bundle.entry[19].resource.code.coding[0] (line 1066, col14) : Unknown Code System http://hl7.org/fhir/uv/ips/CodeSystem/absent-unknown-uv-ips\n  Information @ Bundle.entry[4].resource.severity (line 441, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/condition-severity (http://hl7.org/fhir/ValueSet/condition-severity, and a code is recommended to come from this value set) (codes = http://loinc.org#LA6751-7)\n  Information @ Bundle.entry[10].resource.severity (line 710, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/condition-severity (http://hl7.org/fhir/ValueSet/condition-severity, and a code is recommended to come from this value set) (codes = http://loinc.org#LA6750-9)\n  Warning @ Bundle.entry[1].resource.contact[0].relationship[0] (line 327, col20) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/patient-contactrelationship (http://hl7.org/fhir/ValueSet/patient-contactrelationship, and a code should come from this value set unless it has no suitable code) (codes = http://terminology.hl7.org/CodeSystem/v3-RoleCode#MTH)\n  Warning @ Bundle.entry[4].resource.subject.resource.contact[0].relationship[0] (line 327, col20) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/patient-contactrelationship (http://hl7.org/fhir/ValueSet/patient-contactrelationship, and a code should come from this value set unless it has no suitable code) (codes = http://terminology.hl7.org/CodeSystem/v3-RoleCode#MTH)\n  Warning @ Bundle.entry[4].resource.category[0] (line 434, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/condition-category (http://hl7.org/fhir/ValueSet/condition-category, and a code should come from this value set unless it has no suitable code) (codes = http://loinc.org#75326-9)\n  Warning @ Bundle.entry[10].resource.category[0] (line 703, col15) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/condition-category (http://hl7.org/fhir/ValueSet/condition-category, and a code should come from this value set unless it has no suitable code) (codes = http://loinc.org#75326-9)\n  Warning @ Bundle.entry[0].resource.meta.profile[0] (line 16, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Composition-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[1].resource.meta.profile[0] (line 298, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Patient-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[4].resource.meta.profile[0] (line 412, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Condition-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[5].resource.meta.profile[0] (line 480, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[6].resource.meta.profile[0] (line 536, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[7].resource.meta.profile[0] (line 571, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Medication-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[8].resource.meta.profile[0] (line 605, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Medication-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[9].resource.meta.profile[0] (line 639, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/AllergyIntolerance-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[10].resource.meta.profile[0] (line 681, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Condition-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[12].resource.meta.profile[0] (line 766, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[13].resource.meta.profile[0] (line 803, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[14].resource.meta.profile[0] (line 840, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[15].resource.meta.profile[0] (line 877, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[16].resource.meta.profile[0] (line 914, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[17].resource.meta.profile[0] (line 955, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[18].resource.meta.profile[0] (line 997, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-laboratory-uv-ips&quot; could not be resolved\n  Warning @ Bundle.entry[19].resource.meta.profile[0] (line 1040, col13) : StructureDefinition reference &quot;http://hl7.org/fhir/uv/ips/StructureDefinition/AllergyIntolerance-uv-ips&quot; could not be resolved\n</pre></div>\n\n\n<p>It's also behaving the same way when attempting to validate other instances and in other IGs (specifically livd).  The way it is right now it's impossible to obtain any useful information about the validity of a particular instance.</p>",
        "id": 172421460,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564866695
    },
    {
        "content": "<p>I'm not sure how the output is linked to the problem?</p>",
        "id": 172421567,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564866922
    },
    {
        "content": "<p>Not sure that I get your question, but the issue is that the validation output is invalid - the code system that it is giving the error on and the missing StructureDefinitions that it's warning about are all there in the ig package.  I think that's true of the missing codes in the value sets, too, but I haven't checked all of them.  If it doesn't recognize these items then it can't actually validate anything.</p>",
        "id": 172421742,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564867276
    },
    {
        "content": "<p>ok I think that the issue is one Lloyd already reported. I'm going to issue a new IG publisher to fix it, but let's confirm. can you find your package cache (see <a href=\"https://wiki.hl7.org/FHIR_Package_Cache\" target=\"_blank\" title=\"https://wiki.hl7.org/FHIR_Package_Cache\">https://wiki.hl7.org/FHIR_Package_Cache</a>) and find your package?</p>",
        "id": 172421866,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564867540
    },
    {
        "content": "<p>I didn't see a report from Lloyd on it - if I had I probably would have just +1'ed it.  Looking at the package cache is one of the first things that I did, but earlier I hadn't drilled further into the details.  And now when I do, it's weird.  I haven't made any structural or configuration changes in the ig, but now it appears that all of the generated SD and other files are ending up in the example folder in the package, rather than in the package folder.  That seems to be partly true in livd, too (in livd some of them are in package and some in example).  I assume this won't be too hard to fix, but at the moment I don't know why it's occurring.</p>",
        "id": 172422413,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564868691
    },
    {
        "content": "<p>he didn't report it in Zulip, but you wouldn't have recognised the link</p>",
        "id": 172422428,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564868754
    },
    {
        "content": "<p>but it's certainly the same issue. I assumed that the example[x] element in the ig reosurce would only be present it it was true. But that's not always the case.</p>",
        "id": 172422479,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564868818
    },
    {
        "content": "<p>Packages are looking good now, and validator is working.</p>",
        "id": 172423028,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564869880
    }
]