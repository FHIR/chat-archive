[
    {
        "content": "<p>I came across a transaction bundle that contains a  single POST request for a Condition resource which</p>\n<ol>\n<li>has no <code>fullUrl</code> assigned, and</li>\n<li>contains a relative reference (<code>Patient/1234</code>)</li>\n</ol>\n<p>My question is whether this is allowed (or whether it is up to the validator implementer). The .NET and Java validators disagree on this, the former issuing only a warning for the Bundle, the latter two errors (see below for example).</p>\n<p>The spec says that \"For transactions and batches, entries MAY not have fullURLs when the entry.request.method = POST\" (<a href=\"http://www.hl7.org/FHIR/r4/bundle.html#bundle-unique\">here</a>). However, <a href=\"http://www.hl7.org/FHIR/r4/bundle.html#references\">the rules for reference resolution in a Bundle</a> imply that if the fullUrl of a resource is missing, the resolution of a relative reference fails and the reference \"has no defined meaning within this specification\". However, I have not been able to find a statement on whether this renders the resource invalid or not (or whether that classification is left up to the implementer).  Even if it is a free choice, it seems to be something the validators should ideally align on.</p>\n<p>A simple example is the resource below. The .NET validator <a href=\"https://simplifier.net/validate\">https://simplifier.net/validate</a> gives only a warning about not being able to resolve the reference in <code>subject</code>, but the Java CLI validator (version 5.4.9) gives two errors:</p>\n<div class=\"codehilite\" data-code-language=\"Bash\"><pre><span></span><code>*FAILURE*: <span class=\"m\">2</span> errors, <span class=\"m\">0</span> warnings, <span class=\"m\">0</span> notes\n  Error @ Bundle.entry<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span>.resource.ofType<span class=\"o\">(</span>Condition<span class=\"o\">)</span>.subject : Relative Reference appears inside Bundle whose entry is missing a fullUrl\n  Error @ Bundle.entry<span class=\"o\">[</span><span class=\"m\">0</span><span class=\"o\">]</span> <span class=\"o\">(</span>line <span class=\"m\">4</span>, col16<span class=\"o\">)</span> : Bundle entry missing fullUrl\n</code></pre></div>\n<p>Example Bundle:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"p\">{</span>\n    <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Bundle\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"type\"</span><span class=\"p\">:</span> <span class=\"s2\">\"transaction\"</span><span class=\"p\">,</span>\n    <span class=\"nt\">\"entry\"</span><span class=\"p\">:</span> <span class=\"p\">[{</span>\n        <span class=\"nt\">\"resource\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"resourceType\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Condition\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"subject\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n                <span class=\"nt\">\"reference\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Patient/1234\"</span>\n            <span class=\"p\">}</span>\n        <span class=\"p\">},</span>\n        <span class=\"nt\">\"request\"</span><span class=\"p\">:</span> <span class=\"p\">{</span>\n            <span class=\"nt\">\"method\"</span><span class=\"p\">:</span> <span class=\"s2\">\"POST\"</span><span class=\"p\">,</span>\n            <span class=\"nt\">\"url\"</span><span class=\"p\">:</span> <span class=\"s2\">\"Condition\"</span>\n        <span class=\"p\">}</span>\n    <span class=\"p\">}]</span>\n<span class=\"p\">}</span>\n</code></pre></div>",
        "id": 249074528,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1628665298
    },
    {
        "content": "<p>The Java validator might well be right - this part of the validation in the .NET engine has been written during the STU3 timeframe, and I know we've made some changes to the spec since. I am interested to know the outcome - if necessary we will update the .NET validator to align better with the Java one.</p>",
        "id": 249075841,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1628666462
    },
    {
        "content": "<p>The rules for reference resolution in Bundle have been further clarified for R5, but I don't know if the changes have made it yet to <a href=\"https://build.fhir.org\">https://build.fhir.org</a></p>",
        "id": 249199734,
        "sender_full_name": "Vassil Peytchev",
        "timestamp": 1628746856
    }
]