[
    {
        "content": "<p>Hi, I'm having issues with the following profile:<br>\n<a href=\"https://simplifier.net/medikationsplanplus/medicationstatement-1\" target=\"_blank\" title=\"https://simplifier.net/medikationsplanplus/medicationstatement-1\">https://simplifier.net/medikationsplanplus/medicationstatement-1</a><br>\nI have 5 slices for MedicationStatement.dosage:<br>\nmorning, noon, evening, night and freetext.<br>\nI am currently slicing by dosage.timing.code.coding.code with the first four slices having distinct fixed codes each.<br>\nThe fifth slice however is supposed to define the dosage as free text, with dosage.timing.code set to 0..0.</p>\n<p>The following example should match with the \"morning/morgens\" slice due to the fixed code \"CM\", but apparently, the validator matches it with the  last  freetext/freitext slice:</p>\n<div class=\"codehilite\"><pre><span></span>    <span class=\"nt\">&lt;dosage&gt;</span>\n        <span class=\"nt\">&lt;timing&gt;</span>\n            <span class=\"nt\">&lt;code&gt;</span>\n                <span class=\"nt\">&lt;coding&gt;</span>\n                    <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/v3/TimingEvent&quot;</span> <span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;CM&quot;</span> <span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/coding&gt;</span>\n            <span class=\"nt\">&lt;/code&gt;</span>\n        <span class=\"nt\">&lt;/timing&gt;</span>\n        <span class=\"nt\">&lt;doseQuantity&gt;</span>\n            <span class=\"nt\">&lt;value</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;unit</span> <span class=\"na\">value=</span><span class=\"s\">&quot;{Stück}&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;system</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://unitsofmeasure.org&quot;</span> <span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;{Stück}&quot;</span> <span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/doseQuantity&gt;</span>\n    <span class=\"nt\">&lt;/dosage&gt;</span>\n</pre></div>\n\n\n<p><a href=\"https://simplifier.net/medikationsplanplus/MedicationStatement-example-4\" target=\"_blank\" title=\"https://simplifier.net/medikationsplanplus/MedicationStatement-example-4\">https://simplifier.net/medikationsplanplus/MedicationStatement-example-4</a><br>\nIs the slicing definition incorrect or is the validator off?</p>",
        "id": 153941742,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519987103
    },
    {
        "content": "<p>Normally, I would have defined the last slice as @default slice, so the instance will only be matched against this slice, if all others don't match.<br>\nBut that's not working in STU3 due to the invariant that doesn't allow the slice name \"@default\". Does anyone have an idea for a workaround?</p>",
        "id": 153941743,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519987220
    },
    {
        "content": "<p>I'm currently experimenting with adding a type=exists path=timing.code discriminator, but that doesn't seem to make any difference...</p>",
        "id": 153941745,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519989396
    },
    {
        "content": "<p>Nah. I don't get it. IMO the instance should clearly match against the first slice, but the validator insist on matching it against the last. No idea what's going on here...</p>",
        "id": 153941747,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519990317
    },
    {
        "content": "<p>I have now fixed timing.code.coding.code in the \"freitext\" slice to the Dummy Code \"FREE\", now the validator seems to match the instance correctly to the first \"Morgens\"-slice. So the problem appears to be that while the first slice matches correctly, the instance <em>also</em> matches against the last slice, which evetually takes precedence.</p>\n<p>...so I guess the workaround I am looking for might be to move the freitext-slice to the top of the list..</p>",
        "id": 153941748,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519992479
    },
    {
        "content": "<p>Nope. Even with the freitext-slice moved to the top, the instance doesn't validate :(</p>",
        "id": 153941749,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1519992926
    },
    {
        "content": "<p>Can you create a test-case for us in build\\tests\\validation-examples and raise a tracker item?</p>",
        "id": 153941788,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1520005264
    },
    {
        "content": "<p>ok. where do I need to put the profile? Or is it sufficient if it's published on Simplifier?</p>",
        "id": 153941797,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1520012555
    },
    {
        "content": "<p>It can go in that same folder</p>",
        "id": 153941798,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1520014032
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span>, invariant eld-16 for sliceName has a couple of issues:<br>\n<a href=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemBrowse&amp;tracker_id=677&amp;summary=eld-16\" target=\"_blank\" title=\"https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemBrowse&amp;tracker_id=677&amp;summary=eld-16\">https://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemBrowse&amp;tracker_id=677&amp;summary=eld-16</a><br>\nWe should fix this invariant to allow for:</p>\n<ul>\n<li>/ forward slashes (for reslicing)</li>\n<li>[ and ] characters (for type slicing)</li>\n<li>@default</li>\n</ul>",
        "id": 153942351,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1520243894
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> can you add a tracker ASAP?</p>",
        "id": 153942369,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1520262619
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span>,gForge already contains a number of issues concerning eld-16:<br>\n<a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13217\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13217\">GF#13217</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13769\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13769\">GF#13769</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13771\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=13771\">GF#13771</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14389\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=14389\">GF#14389</a>, <a href=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=15133\" target=\"_blank\" title=\"http://gforge.hl7.org/gf/project/fhir/tracker/?action=TrackerItemEdit&amp;tracker_item_id=15133\">GF#15133</a></p>",
        "id": 153942393,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1520264459
    },
    {
        "content": "<p>it's on my list for this week</p>",
        "id": 153942394,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1520264481
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> <span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> : we fixed a problem with the ValueSet, now HAPI validates the example successfully, but Simplifier still gives an error. Could this be an issue with the .NET-Validator?</p>",
        "id": 153943656,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1520780578
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> Could be. Ewout just returned from HIMSS. I'll ask him to investigate.</p>",
        "id": 153943795,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1520861550
    },
    {
        "content": "<p>This could be the same issue that i was looking at @michel.</p>",
        "id": 153944226,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1520929705
    },
    {
        "content": "<p>Yes, could be.</p>",
        "id": 153944228,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1520929734
    },
    {
        "content": "<blockquote>\n<p>This could be the same issue that i was looking at @michel.</p>\n</blockquote>\n<p>What is this about?</p>",
        "id": 153945053,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1521122595
    },
    {
        "content": "<p>The only solution I can think of so far is to remodel the whole dosage-part by using invariants instead of slicing, but I'd much rather not  :-/<br>\nThe idea I had about using a dummy code for the freetext slice fell flat, because I'd need to introduce a new code but the binding is \"required\".</p>",
        "id": 153946178,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1521462288
    },
    {
        "content": "<p>...any news about this issue?</p>",
        "id": 153950723,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1522872234
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span> <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> <span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span></p>",
        "id": 153950724,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1522872268
    },
    {
        "content": "<blockquote>\n<p>...any news about this issue?</p>\n</blockquote>\n<p>Yes, I think <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> created a fix for this, which I will look at today or tomorrow to pull it in.  <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>, is this the issue fixed here (<a href=\"https://github.com/ewoutkramer/fhir-net-api/pull/558\" target=\"_blank\" title=\"https://github.com/ewoutkramer/fhir-net-api/pull/558\">https://github.com/ewoutkramer/fhir-net-api/pull/558</a>)?</p>",
        "id": 153951421,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1523261177
    },
    {
        "content": "<p>Yes, this is the one.<br>\nPlease look at it with a critical eye, as I'm not certain of it, just that it resolved my immediate issue.</p>",
        "id": 153951427,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1523265683
    },
    {
        "content": "<p>I expect it to be a temporary fix, since we need to change the way we deal with discriminators....</p>",
        "id": 153951431,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1523268355
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span>  do you have any information of whether the fix has been deployed to Simplifier? Because my validation still errors...</p>",
        "id": 153957770,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526041101
    },
    {
        "content": "<blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191328\">@Ewout Kramer</span>  do you have any information of whether the fix has been deployed to Simplifier? Because my validation still errors...</p>\n</blockquote>\n<p>It has been deployed in the new 0.95 version of the .NET API - but it takes a bit of time before Simplifier will upgrade....  <span class=\"user-mention\" data-user-id=\"191335\">@Martijn Harthoorn</span> knows more about that!</p>",
        "id": 153958468,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1526133333
    },
    {
        "content": "<p>0.95.0-alpha1.</p>",
        "id": 153960820,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1526371418
    },
    {
        "content": "<p>We can upgrade this week if necessary.</p>",
        "id": 153960821,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1526371452
    },
    {
        "content": "<blockquote>\n<p>0.95.0-alpha1.</p>\n</blockquote>\n<p>alpha1 is the currently used version?  Ok, that makes sense since we fixed it in the final 0.95 as it was published last month, but was not yet fixed in the alpha.</p>",
        "id": 153960847,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1526372941
    },
    {
        "content": "<p>ok. Will do an update this week.</p>",
        "id": 153960850,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1526373023
    },
    {
        "content": "<p>Thanks guys! On a similar note: do you plan on adding support for discriminators testing for existence of elements?</p>",
        "id": 153961033,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526387867
    },
    {
        "content": "<p>Does this even need a special construct? If you discriminate on a certain child element, then I would expect missing elements to be matched separately (in their own bucket/slice).</p>",
        "id": 153961477,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1526455908
    },
    {
        "content": "<p>I get an \"unsupported\" message from Simplifier validation: <a href=\"https://simplifier.net/medikationsplanplus/medicationstatement-example/$validate\" target=\"_blank\" title=\"https://simplifier.net/medikationsplanplus/medicationstatement-example/$validate\">https://simplifier.net/medikationsplanplus/medicationstatement-example/$validate</a></p>",
        "id": 153961488,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1526457163
    }
]