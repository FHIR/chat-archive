[
    {
        "content": "<p>For the vitalsign profile, the rule \"vs-1\" requires that effective datetimes \"shall be precise to the day\".</p>\n<p>Is this intended to be shall be at least date granularity or exactly date only?</p>\n<p>Having a Vitalsign observation with</p>\n<p>\"effectivePeriod\": {<br>\n    \"start\": \"2021-11-08T10:00:00+01:00\",<br>\n    \"end\": \"2021-11-08T11:00:00+01:00\"<br>\n  }</p>\n<p>Is this \"valid\"? </p>\n<p>At least hapi currently complain about this date. The validation seems to allow a date only.<br>\n<a href=\"https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/schema/vitalsigns.sch#L56\">https://github.com/hapifhir/hapi-fhir/blob/master/hapi-fhir-validation-resources-r4/src/main/resources/org/hl7/fhir/r4/model/schema/vitalsigns.sch#L56</a></p>\n<p>Is the validation in hapi too strict here or this expected behavior?</p>",
        "id": 270168501,
        "sender_full_name": "Thomas Papke",
        "timestamp": 1643704289
    },
    {
        "content": "<p>the formal definition of the invariant is <code>($this as dateTime).toString().length() &gt;= 8</code></p>",
        "id": 270177755,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643708513
    },
    {
        "content": "<p>but the schematron doesn't specify the end pattern must match. So the schematron looks right to me</p>",
        "id": 270178043,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643708647
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> : Thank you for verifing. If the specification and the schematron are valid, i am still wondering wheter the mentioned example is valid or not? Currently a vitalsign with the given effectivePeriod above is rejected by the schematron rule:</p>\n<p>\"severity\": \"error\",<br>\n         \"code\": \"processing\",<br>\n         \"diagnostics\": \"vs-1: 'if Observation.effective[x] is dateTime and has a value then that value shall be precise to the day' Rule 'if Observation.effective[x] is dateTime and has a value then that value shall be precise to the day' Failed\",<br>\n         \"location\":          [<br>\n            \"Observation.effective.ofType(Period)\",<br>\n            \"Line 3, Col 42\"<br>\n         ]</p>",
        "id": 270345525,
        "sender_full_name": "Thomas Papke",
        "timestamp": 1643788071
    },
    {
        "content": "<p>it shouldn't be rejected</p>",
        "id": 270354910,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643793778
    },
    {
        "content": "<p>I think the problem is in the vitalsign profile that the \"vs-1\" invariant is defined on <code>effective[x]</code> but should be on <code>effectiveDateTime</code> to work. Because <code>$this as dateTime</code> returns an empty result if <code>$this</code> is of type Period.</p>",
        "id": 270363430,
        "sender_full_name": "Julian Sass",
        "timestamp": 1643798134
    },
    {
        "content": "<p>oh interesting. Yes, that'll be the problem, and HAPI will be using the FHIRPath not the schematron - I should've paid attention to that.</p>",
        "id": 270449389,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1643832445
    },
    {
        "content": "<p>Hello <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> . If i understand your remark correctly, this is a short bug in hapi and it make sense to create a ticket for this in hapi?</p>",
        "id": 270548571,
        "sender_full_name": "Thomas Papke",
        "timestamp": 1643895020
    },
    {
        "content": "<p>It's a bug in the specification. See <a href=\"https://jira.hl7.org/browse/FHIR-29654\">https://jira.hl7.org/browse/FHIR-29654</a></p>",
        "id": 270555972,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1643898143
    },
    {
        "content": "<p>It's a bit worrying that we are moving towards R5 and this change has not been applied yet</p>",
        "id": 270556188,
        "sender_full_name": "Alexander Zautke",
        "timestamp": 1643898231
    },
    {
        "content": "<p>We have 800 outstanding unapplied change requests.  Volunteers to help are welcome...</p>",
        "id": 270565623,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1643901731
    }
]