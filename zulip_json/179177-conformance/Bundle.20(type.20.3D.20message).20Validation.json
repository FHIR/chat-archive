[
    {
        "content": "<p>I've started creating a simple validation extension using MessageDefinition to control the (HAPI) validation.</p>\n<p>Initial thought was to replace profile conformance  listed in the meta sections to match MessageDefinition requirements. <br>\nSo if the MessageDefinition states conformance against DM-MedicationRequest it will add that profile to MedicationRequest resources and so on.</p>",
        "id": 201688457,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592889180
    },
    {
        "content": "<p>That works but in some cases I will references to say UKCore-Patient but I've changed the Patient to DM-Patient. <br>\nThe validator will throw up an error as it can't find a candidate UK-Core-Patient .... but DM-Patient is a derived profile of UKCore-Patient. So this should be ok?? &lt;-- This is the bit I'm unsure about. <br>\nSo </p>\n<div class=\"codehilite\"><pre><span></span><code>  <span class=\"nt\">&lt;issue&gt;</span>\n        <span class=\"nt\">&lt;severity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;error&quot;</span><span class=\"nt\">&gt;&lt;/severity&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;processing&quot;</span><span class=\"nt\">&gt;&lt;/code&gt;</span>\n        <span class=\"nt\">&lt;diagnostics</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Unable to find matching profile for urn:uuid:C6750CAA-3CA9-4F29-A282-6EE1AA5D7D4C among choices: https://fhir.nhs.uk/R4/StructureDefinition/DM-Patient&quot;</span><span class=\"nt\">&gt;&lt;/diagnostics&gt;</span>\n        <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Bundle.entry[2].resource.ofType(MedicationRequest).subject&quot;</span><span class=\"nt\">&gt;&lt;/location&gt;</span>\n        <span class=\"nt\">&lt;location</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Line 41, Col 408&quot;</span><span class=\"nt\">&gt;&lt;/location&gt;</span>\n    <span class=\"nt\">&lt;/issue&gt;</span>\n</code></pre></div>",
        "id": 201688902,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592889863
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/I-kmVIcHbzSW32wSqxjCNc-T/Screenshot-2020-06-23-at-06.31.29.png\">Screenshot-2020-06-23-at-06.31.29.png</a> </p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/I-kmVIcHbzSW32wSqxjCNc-T/Screenshot-2020-06-23-at-06.31.29.png\" title=\"Screenshot-2020-06-23-at-06.31.29.png\"><img src=\"/user_uploads/10155/I-kmVIcHbzSW32wSqxjCNc-T/Screenshot-2020-06-23-at-06.31.29.png\"></a></div><p>I think this shows where I'm unsure. I'm seeing that reference as either saying</p>\n<ul>\n<li>The reference should validate as DM-Patient</li>\n<li>The reference should have a meta tag that says its DM-Patient and validates as DM-Patient.</li>\n</ul>\n<p>I think the former is correct.</p>",
        "id": 201689310,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592890497
    },
    {
        "content": "<p>Background: The reason for not stating profile conformance in resources is to encourage reuse. E.g. the Patient resource X is sourced from service P and used to assemble a Bundle. Patient resource X is a UKCore-Patient, also P-Patient and also DM-Patient.</p>",
        "id": 201689478,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592890723
    },
    {
        "content": "<p>There should be an accompanying Info message that tells you <em>why</em> the instance wasn't a valid DM-Patient</p>",
        "id": 201733004,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592922490
    },
    {
        "content": "<p>There's no need to declare the profile in the instance - that's not what it's yelling about.</p>",
        "id": 201733038,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592922509
    },
    {
        "content": "<p>I'll investigate more and double check that.  It is right the MessageDefinition defines the Bundle though? (I'm matching bundles to MessageDefinitions on event coding at the moment)</p>",
        "id": 201738234,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592924780
    },
    {
        "content": "<p>The MessageDefinition defines the content of the Bundle - via the focus profile or the GraphDefinition.  I don't think the GraphDefinition would actually describe the containing Bundle though.</p>",
        "id": 201739803,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1592925493
    },
    {
        "content": "<p>Thanks <span class=\"user-mention\" data-user-id=\"191320\">@Lloyd McKenzie</span> that was the issue. I was mislead by the error message.</p>",
        "id": 201816077,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1592981580
    }
]