[
    {
        "content": "<p>One of our derived profiles is based on the stu3 questionnaire resource when we try to use the snapshot of this resource in the firely .NET sdk it creates a stack overflow exception.</p>\n<p>The reason for this seems to be that the snapshot that we create using the HL7 validator (several version tried including the latest, 18th March 2022) creates an absolute reference instead of an relative reference.</p>\n<p><code>\"contentReference\": \"http://hl7.org/fhir/StructureDefinition/Questionnaire#Questionnaire.item\",</code></p>\n<p>When I view the snapshot on the HL7 website it has an relative reference.</p>\n<p><code>&lt;contentReference value=\"#Questionnaire.item\"/&gt; </code></p>\n<p>Also when I create the snapshot of our derived profile usign the Firely terminal the generated snapshot has an relative reference.</p>\n<p>The derived profile only adds metadata and does not contrain or influence the questionnaire.item.</p>\n<p>In our build pipeline we are using the HL7 validator for snapshot generation, validation etc. How can we usign the HL7 validator makes sure the snapshot has the relative reference instead of the absolute reference?</p>",
        "id": 276856349,
        "sender_full_name": "Hans van Amstel",
        "timestamp": 1648465450
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 276878096,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1648476481
    },
    {
        "content": "<p>no the relative content references must be replaced with absolute content references when a snapshot is generated</p>",
        "id": 276935595,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1648504087
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/276935595\">said</a>:</p>\n<blockquote>\n<p>no the relative content references must be replaced with absolute content references when a snapshot is generated</p>\n</blockquote>\n<p>As <span class=\"user-mention\" data-user-id=\"218569\">@Hans van Amstel</span> indicated, that is not what is in the HL7 FHIR downloadable specs, <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> :<br>\nfrom <code>https://hl7.org/fhir/R4/definitions.xml.zip</code>, line 381561:</p>\n<div class=\"codehilite\"><pre><span></span><code>          &lt;element id=&quot;Questionnaire.item.item&quot;&gt;\n            &lt;path value=&quot;Questionnaire.item.item&quot;/&gt;\n            &lt;short value=&quot;Nested questionnaire items&quot;/&gt;\n            &lt;definition value=&quot;Text, questions and other groups to be nested beneath a question or group.&quot;/&gt;\n            &lt;comment value=&quot;There is no specified limit to the depth of nesting.  However, Questionnaire authors are encouraged to consider the impact on the user and user interface of overly deep nesting.&quot;/&gt;\n            &lt;requirements value=&quot;Reports can consist of complex nested groups.&quot;/&gt;\n            &lt;min value=&quot;0&quot;/&gt;\n            &lt;max value=&quot;*&quot;/&gt;\n            &lt;base&gt;\n              &lt;path value=&quot;Questionnaire.item.item&quot;/&gt;\n              &lt;min value=&quot;0&quot;/&gt;\n              &lt;max value=&quot;*&quot;/&gt;\n            &lt;/base&gt;\n            &lt;contentReference value=&quot;#Questionnaire.item&quot;/&gt;        &lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt;&lt; line 381561\n            &lt;condition value=&quot;que-1&quot;/&gt;\n            &lt;constraint&gt;\n              &lt;key value=&quot;ele-1&quot;/&gt;\n              &lt;severity value=&quot;error&quot;/&gt;\n              &lt;human value=&quot;All FHIR elements must have a @value or children&quot;/&gt;\n              &lt;expression value=&quot;hasValue() or (children().count() &amp;gt; id.count())&quot;/&gt;\n              &lt;xpath value=&quot;@value|f:*|h:div&quot;/&gt;\n              &lt;source value=&quot;http://hl7.org/fhir/StructureDefinition/Element&quot;/&gt;\n            &lt;/constraint&gt;\n            &lt;isModifier value=&quot;false&quot;/&gt;\n            &lt;isSummary value=&quot;false&quot;/&gt;\n            &lt;mapping&gt;\n              &lt;identity value=&quot;rim&quot;/&gt;\n              &lt;map value=&quot;.outboundRelationship[typeCode=COMP].target&quot;/&gt;\n            &lt;/mapping&gt;\n          &lt;/element&gt;\n        &lt;/snapshot&gt;\n</code></pre></div>",
        "id": 278523804,
        "sender_full_name": "David Simons",
        "timestamp": 1649666760
    },
    {
        "content": "<p>I believe you, but that's basically considered in error retrospectively</p>",
        "id": 278524460,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1649667140
    },
    {
        "content": "<p>oh no - that's the base questionnaire definition, right?</p>",
        "id": 278524485,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1649667152
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/278524485\">said</a>:</p>\n<blockquote>\n<p>oh no - that's the base questionnaire definition, right?</p>\n</blockquote>\n<p>correct - I am fine either way - but we now have a discrepancy that is causing conformance challenges using snapshots generated with one toolset in another toolset (which I am guessing is using this base definition)</p>",
        "id": 278526081,
        "sender_full_name": "David Simons",
        "timestamp": 1649668114
    },
    {
        "content": "<p>in the base definition, it is a local reference, so that's not wrong</p>",
        "id": 278529390,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1649670070
    },
    {
        "content": "<p>anyway, I believe that this is a dot net tool problem, so you should take it up with <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span>'s team somewhere</p>",
        "id": 278529458,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1649670115
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179177-conformance/topic/STU3.20Qustionnaire.20snapshot.20generation/near/278529458\">said</a>:</p>\n<blockquote>\n<p>anyway, I believe that this is a dot net tool problem, so you should take it up with <span class=\"user-mention silent\" data-user-id=\"203235\">Ward Weistra</span>'s team somewhere</p>\n</blockquote>\n<p>Thank you - for clarifying - you're saying that in a dependent profile snapshot it has to become an absolute uri - to the base definition - since no longer within that base.</p>\n<p><code>\"contentReference\": \"http://hl7.org/fhir/StructureDefinition/Questionnaire#Questionnaire.item\",</code></p>\n<p>We have started that conversation with <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> at Firely on the .Net tooling.</p>",
        "id": 278531647,
        "sender_full_name": "David Simons",
        "timestamp": 1649671434
    },
    {
        "content": "<p>Reported as <a href=\"https://github.com/FirelyTeam/firely-net-sdk/issues/2039\">https://github.com/FirelyTeam/firely-net-sdk/issues/2039</a></p>",
        "id": 278594330,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1649700536
    }
]