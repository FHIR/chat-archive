[
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>, </p>\n<p>The normative-version extension has context 'element: StructureDefinition': <a href=\"https://www.hl7.org/fhir/extension-structuredefinition-normative-version.html\" title=\"https://www.hl7.org/fhir/extension-structuredefinition-normative-version.html\">https://www.hl7.org/fhir/extension-structuredefinition-normative-version.html</a><br>\nHowever, it seems to also be used in non-StructureDefinitions, like this OperationDefinition: <a href=\"https://www.hl7.org/fhir/operation-codesystem-lookup.xml.html#DomainResource.text.div-end\" title=\"https://www.hl7.org/fhir/operation-codesystem-lookup.xml.html#DomainResource.text.div-end\">https://www.hl7.org/fhir/operation-codesystem-lookup.xml.html#DomainResource.text.div-end</a><br>\nAlso on, for example, the profile for the data type Identifier the extensions are both used on the StructureDefinition level (good), but also on deeper Element levels (bad): <a href=\"https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/82704/~xml\" title=\"https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/82704/~xml\">https://simplifier.net/packages/hl7.fhir.r4.core/4.0.1/files/82704/~xml</a></p>\n<p>Since last release Forge copies the extensions on these elements to derived profiles. When validating these with the Java validator the error is thrown:<br>\n<code>error: The extension http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version is not allowed to be used at this point (allowed = e:StructureDefinition; this element is [[StructureDefinition.differential.element, BackboneElement.element, ElementDefinition])</code></p>\n<p>cc <span class=\"user-mention\" data-user-id=\"221719\">@Abel Enthoven</span> <span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span></p>",
        "id": 191752020,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1585146192
    },
    {
        "content": "<p>Not sure why <a href=\"http://hl7.org/fhir/OperationDefinition/CodeSystem-lookup\" title=\"http://hl7.org/fhir/OperationDefinition/CodeSystem-lookup\">http://hl7.org/fhir/OperationDefinition/CodeSystem-lookup</a> has these claims at all:</p>\n<div class=\"codehilite\"><pre><span></span>  <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-fmm&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;valueInteger</span> <span class=\"na\">value=</span><span class=\"s\">&quot;5&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/extension&gt;</span>\n  <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;valueCode</span> <span class=\"na\">value=</span><span class=\"s\">&quot;normative&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/extension&gt;</span>\n  <span class=\"nt\">&lt;extension</span> <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version&quot;</span><span class=\"nt\">&gt;</span>\n    <span class=\"nt\">&lt;valueCode</span> <span class=\"na\">value=</span><span class=\"s\">&quot;4.0.1&quot;</span><span class=\"nt\">/&gt;</span>\n  <span class=\"nt\">&lt;/extension&gt;</span>\n</pre></div>\n\n\n<p>since <a href=\"http://hl7.org/fhir/operation-codesystem-lookup.html\" title=\"http://hl7.org/fhir/operation-codesystem-lookup.html\">http://hl7.org/fhir/operation-codesystem-lookup.html</a> lists it as Maturity Level: N/A and Standards Status: Informative</p>",
        "id": 191775673,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1585154439
    },
    {
        "content": "<p>it should not have those claims. And the context of use for the structure definition is too narrow; we use it in more places than that</p>",
        "id": 192189966,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585510076
    },
    {
        "content": "<p>both issues added to my list of future technical corrections</p>",
        "id": 192190007,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585510095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Should I create a Jira issue and/or add it to <a href=\"https://confluence.hl7.org/display/FHIR/Known+Issues+with+the+published+FHIR+Specifications\" title=\"https://confluence.hl7.org/display/FHIR/Known+Issues+with+the+published+FHIR+Specifications\">https://confluence.hl7.org/display/FHIR/Known+Issues+with+the+published+FHIR+Specifications</a> ?</p>",
        "id": 192359214,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1585643836
    },
    {
        "content": "<p>both, I think</p>",
        "id": 192361394,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1585645151
    },
    {
        "content": "<p>Created <a href=\"http://jira.hl7.org/browse/FHIR-26671\" title=\"http://jira.hl7.org/browse/FHIR-26671\">FHIR#26671</a> and <a href=\"http://jira.hl7.org/browse/FHIR-26672\" title=\"http://jira.hl7.org/browse/FHIR-26672\">FHIR#26672</a> for this.</p>",
        "id": 192401207,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1585666875
    },
    {
        "content": "<p>Could this issue be resolved short term? Not copying the extension in Forge <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> ? This bugs currently breaks all my CI pipelines (if i don't remove the element in a filter step, which i dislike)</p>",
        "id": 193452638,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586440312
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> I understand this is causing pain. Though, since Forge seems to align with the desired result, isn't it better to suppress this warning in the validator instead?</p>",
        "id": 193453324,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1586440627
    },
    {
        "content": "<p>Hmm yes you are right. Ideally should be fixed in the package, but this would need another TC. So filtering the error in the Java Validator would be the fastest way i guess.</p>",
        "id": 193453548,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586440709
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> ?</p>",
        "id": 193453557,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586440713
    },
    {
        "content": "<p>Ok i experimented more with the roundtrip: IG creator -&gt; Forge -&gt; FHIR Validator:</p>\n<ul>\n<li>if i open: <a href=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\" title=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\">http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html</a> in Forge, rename the profile and save it again without any further changes i get these errors in the java validator: <code>Error @ StructureDefinition.text.div (line 6, col4) : The URL {{[id]}}-definitions.html#Observation is not valid</code></li>\n</ul>",
        "id": 194025239,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955592
    },
    {
        "content": "<p>Forge seems to replace this: <code>&lt;a href=\\\"haplotype-definitions.html#Observation</code> the original link in the div</p>",
        "id": 194025406,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955655
    },
    {
        "content": "<p>so \"haplotype\" ist replaced with: \"{{[id]}}\"</p>",
        "id": 194025464,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955675
    },
    {
        "content": "<ul>\n<li>if i then switch on snapshot creation in Forge i end up with: <em>FAILURE</em> validating Haplotype-copy.StructureDefinition.json:  error:206 warn:6 info:0</li>\n</ul>",
        "id": 194025476,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955680
    },
    {
        "content": "<p>Many of these: <code> Error @ StructureDefinition.snapshot.element[0].constraint[0].source (line 88, col12) : Canonical URLs must be absolute URLs if they are not fragment references (DomainResource)</code></p>",
        "id": 194026105,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955946
    },
    {
        "content": "<p>also the known one mentioned above: <code>http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version</code></p>",
        "id": 194026238,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586955984
    },
    {
        "content": "<p>The warnings are all: <code>Warning @ StructureDefinition.snapshot.element[35].type[0].code (line 2795, col12) : The value provided (\"http://hl7.org/fhirpath/System.String\") is not in the value set http://hl7.org/fhir/ValueSet/defined-types (http://hl7.org/fhir/ValueSet/defined-types), and a code should come from this value set unless it has no suitable code) (error message = The code system \"\" is not known (encountered paired with code = \"http://hl7.org/fhirpath/System.String\"); The code provided (#http://hl7.org/fhirpath/System.String) is not  valid in the value set FHIRDefinedType)</code></p>",
        "id": 194026400,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586956046
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>",
        "id": 194026453,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586956065
    },
    {
        "content": "<p>To reproduce: d/l <a href=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\" title=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\">http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html</a>, open it in Forge, save it with snapshot. Validate it with the java validator</p>",
        "id": 194026582,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586956111
    },
    {
        "content": "<p>after the roundtrip: <a href=\"https://gist.github.com/patrick-werner/caccff7cf45f4772bb12967e59032b72\" title=\"https://gist.github.com/patrick-werner/caccff7cf45f4772bb12967e59032b72\">https://gist.github.com/patrick-werner/caccff7cf45f4772bb12967e59032b72</a></p>",
        "id": 194026695,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586956167
    },
    {
        "content": "<p>I'm not clear what you think the actual problem is here</p>",
        "id": 194027934,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1586956645
    },
    {
        "content": "<p>Problems:</p>\n<ul>\n<li>(Java Validator) throws the <a href=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version\" title=\"http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version\">http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version</a> errors (could be filtered until the context is fixed in R4.0.2?)</li>\n</ul>",
        "id": 194029389,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586957183
    },
    {
        "content": "<ul>\n<li>Forge replaces strings in <code>StructureDefinition.text.div</code>causing the java validator to throw errors (forge problem)</li>\n</ul>",
        "id": 194029548,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586957259
    },
    {
        "content": "<ul>\n<li>Forge snapshot expansion leads to <code>Warning @ StructureDefinition.snapshot.element[35].type[0].code (line 2795, col12) : The value provided (\"http://hl7.org/fhirpath/System.String\") is not in the value set http://hl7.org/fhir/ValueSet/defined-types (http://hl7.org/fhir/ValueSet/defined-types), and a code should come from this value set unless it has no suitable code) (error message = The code system \"\" is not known (encountered paired with code = \"http://hl7.org/fhirpath/System.String\"); The code provided (#http://hl7.org/fhirpath/System.String) is not  valid in the value set FHIRDefinedType)</code> Warnings</li>\n</ul>",
        "id": 194029793,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586957348
    },
    {
        "content": "<p>Is this caused because String is not written in lowercase? (forge problem)</p>",
        "id": 194029897,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586957400
    },
    {
        "content": "<ul>\n<li>the validator returns: <code>(error message = The code system \"\" is not known</code> why is the code system = \"\" ? (Validator / TX Server Problem)</li>\n</ul>",
        "id": 194030126,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586957511
    },
    {
        "content": "<p>Thanks for the reports <span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span>, we'll look into the two Forge issues! <img alt=\":forge:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/10155/emoji/images/11736.png\" title=\"forge\"></p>",
        "id": 194034086,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1586959062
    },
    {
        "content": "<p>Thanks!</p>",
        "id": 194034116,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586959075
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> we have trouble recreating the second issue. What were the steps:</p>\n<ul>\n<li>Open <a href=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\" title=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\">http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html</a> in Forge</li>\n<li>Switch on Options &gt; Persistence Options &gt; Save Snapshot component?</li>\n</ul>\n<p>That doesn't give us the errors yet.</p>",
        "id": 194036057,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1586959848
    },
    {
        "content": "<p>then you have to validate it: <code>java -jar org.hl7.fhir.validator.jar Haplotype.StructureDefinition.json -ig hl7.fhir.uv.genomics-reporting -version 4.0</code></p>",
        "id": 194044145,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586962955
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span></p>",
        "id": 194050888,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1586965577
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> The .json at <a href=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\" title=\"http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html\">http://build.fhir.org/ig/HL7/genomics-reporting/haplotype.profile.json.html</a> already contains a snapshot. Am I correct to assume that this snapshot is created by Forge as well?</p>",
        "id": 194289534,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1587036705
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span>  nope. This Snapshot is created by the IG Tooling (Spreadsheets).</p>",
        "id": 194289853,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1587036865
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> Strange, when I download your entire IG and directly validate StructureDefinition-haplotype.json from the IG, I get </p>\n<p>A few errors:   Error @ StructureDefinition.text.div (line 7, col4) : The URL {{[id]}}-definitions.html#Observation is not valid<br>\nSame as you mentioned.</p>\n<p>And a couple of these warnings:  Warning @ StructureDefinition.snapshot.element[1].type[0].code (line 197, col12) : The value provided (\"<a href=\"http://hl7.org/fhirpath/System.String\" title=\"http://hl7.org/fhirpath/System.String\">http://hl7.org/fhirpath/System.String</a>\") is not in the value set <a href=\"http://hl7.org/fhir/ValueSet/defined-types\" title=\"http://hl7.org/fhir/ValueSet/defined-types\">http://hl7.org/fhir/ValueSet/defined-types</a> (<a href=\"http://hl7.org/fhir/ValueSet/defined-types\" title=\"http://hl7.org/fhir/ValueSet/defined-types\">http://hl7.org/fhir/ValueSet/defined-types</a>), and a code should come from this value set unless it has no suitable code) (error message = The code system \"\" is not known (encountered paired with code = \"<a href=\"http://hl7.org/fhirpath/System.String\" title=\"http://hl7.org/fhirpath/System.String\">http://hl7.org/fhirpath/System.String</a>\"); The code provided (#http://hl7.org/fhirpath/System.String) is not  valid in the value set FHIRDefinedType)</p>\n<p>So, to me, it seems that these aren't caused by Forge. Or am I missing something?</p>",
        "id": 194290826,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1587037499
    },
    {
        "content": "<p>ohhhhh! let me double check.</p>",
        "id": 194290864,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1587037527
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"259036\">@Matthijs van der Wielen</span> <br>\nSorry for reporting this. You are absolutely right. This is already contained in our IG. Didn't see this as the {{[id]}}- definitions are not shown if you look and c&amp;p the resource from the IG pages.</p>",
        "id": 194291426,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1587037897
    },
    {
        "content": "<p>This is clearly an IG publisher issue. Sorry again.</p>",
        "id": 194291459,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1587037918
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> No problem!</p>",
        "id": 194291785,
        "sender_full_name": "Matthijs van der Wielen",
        "timestamp": 1587038079
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> For resources that rightfully have the <code>http://hl7.org/fhir/StructureDefinition/structuredefinition-standards-status</code> and <code>http://hl7.org/fhir/StructureDefinition/structuredefinition-normative-version</code> extension, should they both be at the StructureDefinition level and on the root element level? (besides normative-version currently only being allowed on SDs; <a href=\"http://jira.hl7.org/browse/FHIR-26671\" title=\"http://jira.hl7.org/browse/FHIR-26671\">FHIR#26671</a>)<br>\n<a href=\"/user_uploads/10155/Ci214Lf604sOTPs7Q4CzVXfU/2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png\" title=\"2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png\">2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/Ci214Lf604sOTPs7Q4CzVXfU/2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png\" title=\"2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png\"><img src=\"/user_uploads/10155/Ci214Lf604sOTPs7Q4CzVXfU/2020-05-07-18_04_26-Element.profile.json-FHIR-v4.0.1.png\"></a></div>",
        "id": 196794346,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1588868062
    },
    {
        "content": "<p>Both levels - some elements can be STU within a normative resource</p>",
        "id": 196807316,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588874094
    },
    {
        "content": "<p>there's a task to fix the definition of that extension since it's used in lots of places, not just StructureDefinition</p>",
        "id": 196825100,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1588882731
    },
    {
        "content": "<p>Can we fix the value as well so it inheriting isn't going to cause a problem?</p>",
        "id": 196834324,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588887958
    },
    {
        "content": "<p>sounds difficult to me but all the options aren't great</p>",
        "id": 196851620,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1588903703
    },
    {
        "content": "<p>If we made the extension complex, we could do this:<br>\n<code>    &lt;extension url=\"http://hl7.org/fhir/StructureDefinition/metadata-standards-status\"&gt;\n      &lt;extension url=\"model\"&gt;\n        &lt;valueCanonical value=\"http://hl7.org/fhir/Patient|4.0.0\"/&gt;\n      &lt;/extension&gt;\n      &lt;extension url=\"status\"&gt;\n        &lt;valueCode value=\"Normative\"/&gt;\n      &lt;/extension&gt;\n    &lt;/extension&gt;</code></p>",
        "id": 196856776,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588911900
    },
    {
        "content": "<p>If we preferred to split the model and the version into separate components, we could do that too</p>",
        "id": 196856801,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588911936
    },
    {
        "content": "<p>Each layer in the profile hierarchy could then add its own declaration of status - and the artifact and version in which that status took effect.</p>",
        "id": 196856870,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588911978
    },
    {
        "content": "<p>Not super-pretty, but not horrid...</p>",
        "id": 196856876,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1588911993
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191451\">@Patrick Werner</span> This week's Forge release will no longer copy the <code>structuredefinition-standards-status</code> and <code>structuredefinition-normative-version</code> extensions everywhere and will remove them from opened profiles: <a href=\"https://simplifier.net/organization/firely/news/87\">https://simplifier.net/organization/firely/news/87</a></p>",
        "id": 197561994,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1589465991
    },
    {
        "content": "<p>already saw that, and was very happy about it <span aria-label=\"slight smile\" class=\"emoji emoji-1f642\" role=\"img\" title=\"slight smile\">:slight_smile:</span></p>",
        "id": 197563269,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1589466664
    },
    {
        "content": "<p><img alt=\":forge:\" class=\"emoji\" src=\"https://zulip-avatars.s3.amazonaws.com/10155/emoji/images/11736.png\" title=\"forge\"></p>",
        "id": 197563289,
        "sender_full_name": "Patrick Werner",
        "timestamp": 1589466674
    },
    {
        "content": "<p>Created <a href=\"http://jira.hl7.org/browse/FHIR-27535\">FHIR#27535</a> for the extension inheritance issue.</p>",
        "id": 198209329,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1589986168
    }
]