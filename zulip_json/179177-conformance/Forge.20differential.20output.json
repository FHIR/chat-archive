[
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> Hi Michel, I've noticed a variation in the output of the differential section when changing the snapshot generation on and off.  When snapshot generation is off, element definitions in the differential section only have individual fields which have changed, when turned on the element definitions have all fields.  Is this intentional?  Which version is \"correct\"?</p>",
        "id": 153852485,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476140106
    },
    {
        "content": "<p>Hi <span class=\"user-mention\" data-user-id=\"191495\">@Jonny Rylands</span> this sounds like a bug. The differential component should only contain actual constraints (sparse tree). The snapshot component represents the fully expanded profile.<br>\nRecently I've been working on a complete re-implementation of snapshot generation, as part of our open source FHIR .NET API library. The next Forge release will be based on this new logic. Also I am now reimplementing Forge change tracking logic, which is crucial for filtering the diffential. It's quite a bit of work, but this will improve the quality and stability of the generated output.</p>",
        "id": 153852540,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1476183545
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> Just to be clear - it's not that the differential output contains unchanged elements in snapshot mode - it's that the individual fields within the changed elements vary.</p>",
        "id": 153852541,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476183879
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191495\">@Jonny Rylands</span> So you are referring to element properties? Forge should also try to exclude unconstrained properties from the differential, but apparently you have discovered that this is currently not reliable.</p>",
        "id": 153852542,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1476184021
    },
    {
        "content": "<p>Anyway, the current change tracking logic is in dire need of refactoring. So we decided to focus on fully reimplementing this layer, instead of trying to keep fixing bugs (and introducing new regressions).</p>",
        "id": 153852543,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1476184135
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> Yes that's right.  So for example if you change cardinality from 0..* to 0..1.   With snapshot generation turned OFF, the differential for this element will contain only MAX.  With snapshot generation turned ON, the differential for this element with contain both MIN and MAX (along with all other unchanged properties).</p>",
        "id": 153852544,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476184251
    },
    {
        "content": "<p>I understand that snapshot generation is supposed to output everything, but I believe this shouldn't affect the differential output - only the snapshot output.</p>",
        "id": 153852545,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476184286
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191495\">@Jonny Rylands</span> correct, so the Forge behavior is indeed a bug.</p>",
        "id": 153852548,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1476186818
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> OK, so the correct differential output is that made when snapshot generation is turned off?</p>",
        "id": 153852551,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476186989
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191495\">@Jonny Rylands</span> that is correct. According to FHIR spec, the differential component should only contain actual constraints (on elements &amp; element properties) with respect to the base profile.</p>",
        "id": 153852555,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1476187421
    },
    {
        "content": "<p>OK thanks.</p>",
        "id": 153852556,
        "sender_full_name": "Jonny Rylands",
        "timestamp": 1476187454
    }
]