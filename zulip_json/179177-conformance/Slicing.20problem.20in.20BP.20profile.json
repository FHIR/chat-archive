[
    {
        "content": "<p>if you look at the snapshot in <a href=\"http://hl7.org/fhir/bp.html\" target=\"_blank\" title=\"http://hl7.org/fhir/bp.html\">http://hl7.org/fhir/bp.html</a>, you'll see that Observation.component is sliced with a discriminator which is value:code.coding.code, value:code.coding.system</p>",
        "id": 166224271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558482847
    },
    {
        "content": "<p>but the code.coding is also sliced, by code, and system</p>",
        "id": 166224297,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558482906
    },
    {
        "content": "<p>the validator doesn't know how to deal with this - it goes looking for the fixed value for the outer slicing, and runs into the inner slicing.</p>",
        "id": 166224469,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558483088
    },
    {
        "content": "<p>it's not clear to me, as I consider how to make the validator work, what the rules are for an element that is in the path of a slicing target that is itself sliced. Do we say that it has to have a 1..1 slice itself that meets the slicing requirements? (this case does)</p>",
        "id": 166224744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558483438
    },
    {
        "content": "<p>I think that's reasonable</p>",
        "id": 166226667,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1558485408
    },
    {
        "content": "<p>What does \"Do we say that it has to have a 1..1 slice itself that meets the slicing requirements?\" mean?</p>",
        "id": 166248005,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1558514663
    },
    {
        "content": "<p>The outer discriminator specifies to match component slices by inspecting a complex child element (<code>code.coding</code>). The slicing on the child element itself further constraints the list of allowed options for coding.</p>\n<p>However the inner slice does not influence the behavior of the outer slice? For all components should still specify a unique combination for <code>{ code.coding.code and code.coding.system }</code>.</p>\n<p>This suggests that a validator can evaluate the outer slice and match individual components to slices w/o having to inspect the internal slice?</p>",
        "id": 166250832,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1558517125
    },
    {
        "content": "<p>I donâ€™t know how to ignore the inner slice. I have to iterate it somehow. For now, I can only deal with inner slicing that has a fixed 1..1 slice</p>",
        "id": 166263867,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1558529466
    },
    {
        "content": "<p>Yeah, I'd agree with <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> (I think) - if you slice by value, then the target of that can only be a single, fixed value.  In this case, the better option would be to slice component by pattern at <code>code</code> - that would leave the inner slice reasonable.</p>",
        "id": 166850525,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1559159650
    },
    {
        "content": "<p>well, I deal with it now</p>",
        "id": 166852018,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559160561
    },
    {
        "content": "<p>How?</p>",
        "id": 166852393,
        "sender_full_name": "Chris Grenz",
        "timestamp": 1559160749
    },
    {
        "content": "<p>if there's a fixed 1..1 slice, I can deal with it</p>",
        "id": 166852510,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559160819
    },
    {
        "content": "<p>What about patterns?</p>",
        "id": 166855241,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1559162673
    },
    {
        "content": "<p>I have a similar problem: I want to slice Identifier (by Identifier.type) to check for existence of two distinct types of Identifiers. Both Identifiers are defined as Identifier-Profiles which each have a slicing on Identifier.type to require one specific coding (fixed value) for Identifier.type but leave it open to use alternative codings additionally. The (.NET-)validator doesn't get it...</p>\n<p>Here's the profile: <a href=\"https://simplifier.net/Basisprofil-DE-R4/PractitionerDeBasis/~overview\" target=\"_blank\" title=\"https://simplifier.net/Basisprofil-DE-R4/PractitionerDeBasis/~overview\">https://simplifier.net/Basisprofil-DE-R4/PractitionerDeBasis/~overview</a><br>\nand an example (that doesn't validate): <a href=\"https://simplifier.net/basisprofil-de-r4/practitioner-example/$validate\" target=\"_blank\" title=\"https://simplifier.net/basisprofil-de-r4/practitioner-example/$validate\">https://simplifier.net/basisprofil-de-r4/practitioner-example/$validate</a></p>\n<p>I would like to understand how to us patterns to fix this....</p>",
        "id": 172758057,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565265515
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> , see <a href=\"http://build.fhir.org/ig/hl7ch/ch-core/StructureDefinition-ch-core-patient.html\" target=\"_blank\" title=\"http://build.fhir.org/ig/hl7ch/ch-core/StructureDefinition-ch-core-patient.html\">http://build.fhir.org/ig/hl7ch/ch-core/StructureDefinition-ch-core-patient.html</a> as an example how to use pattern to slice the identifier on type.</p>",
        "id": 172763008,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1565270001
    },
    {
        "content": "<p>Ok, apparently <em>not</em> the solution for the .NET validator...</p>\n<blockquote>\n<p>NotSupported : Slicing with a discriminator of type 'Pattern' is not yet supported by this validator</p>\n</blockquote>\n<p>Thanks, though!</p>",
        "id": 172763460,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565270320
    },
    {
        "content": "<p>Maybe if I use Pattern to fix the Identifier.types in the Profiles instead of slicing them...?<br>\nWhat's the semantical difference between <br>\na) slicing Identifier.type.coding by system (unordered, open) and define a 1..1 slice with fixed values for system and code<br>\nand<br>\nb) define a pattern on Identifier.type.coding with fixed values for system and code</p>\n<p>I assume that other than slicing, pattern would still match even if system matched in one slice and code in another...?<br>\nNot sure though... I'm still struggling trying to wrap my head around <code>pattern</code>...</p>",
        "id": 172767363,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565273016
    },
    {
        "content": "<p>But I don't think so. Wouldn't pattern make it even harder for the validator to find the fixed values in the slice...</p>",
        "id": 172767715,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565273243
    },
    {
        "content": "<p>I thought I would give it a try validating with the Java validator, but it needs some additional <a href=\"http://fhir.de\" target=\"_blank\" title=\"http://fhir.de\">fhir.de</a> profiles (like <a href=\"http://fhir.de/StructureDefinition/identifier-lanr\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/identifier-lanr\">http://fhir.de/StructureDefinition/identifier-lanr</a> and <a href=\"http://fhir.de/StructureDefinition/identifier-zanr\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/identifier-zanr\">http://fhir.de/StructureDefinition/identifier-zanr</a>, etc.).  Is there a package?</p>",
        "id": 172787652,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565287098
    },
    {
        "content": "<p>Which version of the dotnet client are you using, I was pretty sure it does pattern.. My fork definitely does it, and I thought that change went into core.</p>",
        "id": 172802924,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1565298010
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span>  I created a package: <a href=\"https://simplifier.net/packages/de.basisprofil.r4/0.9.0\" target=\"_blank\" title=\"https://simplifier.net/packages/de.basisprofil.r4/0.9.0\">https://simplifier.net/packages/de.basisprofil.r4/0.9.0</a></p>",
        "id": 172827922,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565330880
    },
    {
        "content": "<blockquote>\n<p>Which version of the dotnet client are you using, I was pretty sure it does pattern.. My fork definitely does it, and I thought that change went into core.</p>\n</blockquote>\n<p><span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span>  I was running the validation on Simplifier. Here's the example: <a href=\"https://simplifier.net/basisprofil-de-r4/practitioner-example\" target=\"_blank\" title=\"https://simplifier.net/basisprofil-de-r4/practitioner-example\">https://simplifier.net/basisprofil-de-r4/practitioner-example</a><br>\nPress the \"validate\" button and you'll see the resulting error.</p>",
        "id": 172827972,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565330952
    },
    {
        "content": "<p>oh wait. you can't validate unless you're a project member I suppose...</p>",
        "id": 172827978,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565330990
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191450\">@Simone Heckmann</span> I expanded and re-organized the package a bit and then validated and got this:</p>\n<div class=\"codehilite\"><pre><span></span>RHausamMacbookPro:fhir-ips rhausam$ java -jar ~/Downloads/org.hl7.fhir.validator.jar ~/Downloads/Practitioner-example.xml -ig ~/Downloads/de.basisprofil.r4-0.9.0\nFHIR Validation tool Version 3.8.24-SNAPSHOT - Built 2019-08-09T04:44:53.224+10:00 - Git 2a234a81c24f\nArguments: /Users/rhausam/Downloads/Practitioner-example.xml -ig /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#current\n    (v4.0.0)\n+  .. load IG from /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0\n  .. validate [/Users/rhausam/Downloads/Practitioner-example.xml]\nTerminology server: Check for supported code systems for http://fhir.de/CodeSystem/identifier-type-de-basis\nSuccess...validating /Users/rhausam/Downloads/Practitioner-example.xml:  error:0 warn:3 info:0\n  Warning @ Practitioner.identifier[0].type (line 7, col11) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/identifier-type (http://hl7.org/fhir/ValueSet/identifier-type, and a code should come from this value set unless it has no suitable code) (codes = http://terminology.hl7.org/CodeSystem/v2-0203#LANR)\n  Warning @ Practitioner.identifier[1].type (line 17, col11) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/identifier-type (http://hl7.org/fhir/ValueSet/identifier-type, and a code should come from this value set unless it has no suitable code) (codes = http://fhir.de/CodeSystem/identifier-type-de-basis#ZANR)\n  Warning @ Practitioner.meta.profile[0] (line 2, col43) : StructureDefinition reference &quot;http://fhir.de/StructureDefinition/practitioner-de-basis&quot; could not be resolved\n</pre></div>\n\n\n<p>Getting \"Success\" is nice! :)  But the warning that 'StructureDefinition reference \"<a href=\"http://fhir.de/StructureDefinition/practitioner-de-basis\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/practitioner-de-basis\">http://fhir.de/StructureDefinition/practitioner-de-basis</a>\" could not be resolved' certainly means something isn't right, and I haven't looked at that yet.</p>",
        "id": 172854829,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565360255
    },
    {
        "content": "<p>The warning about the Type Code is justified! I accidentially used the old STU3 URL (fixed it!)<br>\nBut I guess the fact that the Profile URL didn't resolve means that your validation just ran the example against the core spec...</p>",
        "id": 172855412,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565360730
    },
    {
        "content": "<p>I assume that's the case.  Can try to figure out what the issue is there.</p>",
        "id": 172856103,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565361313
    },
    {
        "content": "<p>I had to explicitly include each profile, rather than the package (not sure why), but this is what I get now:</p>\n<div class=\"codehilite\"><pre><span></span>RHausamMacbookPro:fhir-ips rhausam$ java -jar ~/Downloads/org.hl7.fhir.validator.jar ~/Downloads/Practitioner-example.xml -ig ~/Downloads/de.basisprofil.r4-0.9.0/package/Practitioner-de-basis.json -ig ~/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-lanr.json -ig ~/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-zanr.json\nFHIR Validation tool Version 3.8.24-SNAPSHOT - Built 2019-08-09T04:44:53.224+10:00 - Git 2a234a81c24f\nArguments: /Users/rhausam/Downloads/Practitioner-example.xml -ig /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Practitioner-de-basis.json -ig /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-lanr.json -ig /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-zanr.json\n  .. connect to tx server @ http://tx.fhir.org\n  .. definitions from hl7.fhir.core#current\n    (v4.0.0)\n+  .. load IG from /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Practitioner-de-basis.json\n+  .. load IG from /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-lanr.json\n+  .. load IG from /Users/rhausam/Downloads/de.basisprofil.r4-0.9.0/package/Profile-identifier-zanr.json\n  .. validate [/Users/rhausam/Downloads/Practitioner-example.xml]\nTerminology server: Check for supported code systems for http://fhir.de/CodeSystem/identifier-type-de-basis\n*FAILURE* validating /Users/rhausam/Downloads/Practitioner-example.xml:  error:4 warn:2 info:2\n  Error @ Practitioner.identifier[0] (line 6, col15) : Could not match discriminator ([$this]) for slice Practitioner.identifier:LANR in profile http://fhir.de/StructureDefinition/practitioner-de-basis - the discriminator [$this] does not have fixed value, binding or existence assertions\n  Error @ Practitioner.identifier[0] (line 6, col15) : Could not match discriminator ([$this]) for slice Practitioner.identifier:ZANR in profile http://fhir.de/StructureDefinition/practitioner-de-basis - the discriminator [$this] does not have fixed value, binding or existence assertions\n  Error @ Practitioner.identifier[1] (line 16, col15) : Could not match discriminator ([$this]) for slice Practitioner.identifier:LANR in profile http://fhir.de/StructureDefinition/practitioner-de-basis - the discriminator [$this] does not have fixed value, binding or existence assertions\n  Error @ Practitioner.identifier[1] (line 16, col15) : Could not match discriminator ([$this]) for slice Practitioner.identifier:ZANR in profile http://fhir.de/StructureDefinition/practitioner-de-basis - the discriminator [$this] does not have fixed value, binding or existence assertions\n  Information @ Practitioner (line 2, col43) : Profile http://fhir.de/StructureDefinition/practitioner-de-basis, Element &#39;Practitioner.identifier[LANR]&#39;&#39;: Unable to check minimum required (1) due to lack of slicing validation\n  Information @ Practitioner (line 2, col43) : Profile http://fhir.de/StructureDefinition/practitioner-de-basis, Element &#39;Practitioner.identifier[ZANR]&#39;&#39;: Unable to check minimum required (1) due to lack of slicing validation\n  Warning @ Practitioner.identifier[0].type (line 7, col11) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/identifier-type (http://hl7.org/fhir/ValueSet/identifier-type, and a code should come from this value set unless it has no suitable code) (codes = http://terminology.hl7.org/CodeSystem/v2-0203#LANR)\n  Warning @ Practitioner.identifier[1].type (line 17, col11) : None of the codes provided are in the value set http://hl7.org/fhir/ValueSet/identifier-type (http://hl7.org/fhir/ValueSet/identifier-type, and a code should come from this value set unless it has no suitable code) (codes = http://fhir.de/CodeSystem/identifier-type-de-basis#ZANR)\n</pre></div>\n\n\n<p>Now need to look closer at the discriminators and slice definitions and see what the issues are.</p>",
        "id": 172859941,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565364101
    },
    {
        "content": "<blockquote>\n<p>Ok, apparently <em>not</em> the solution for the .NET validator...</p>\n<blockquote>\n<p>NotSupported : Slicing with a discriminator of type 'Pattern' is not yet supported by this validator</p>\n</blockquote>\n<p>Thanks, though!</p>\n</blockquote>\n<p>It <em>does</em> support it, but I had disabled the code for it (by accident).  <span class=\"user-mention\" data-user-id=\"191367\">@Brian Postlethwaite</span> corrected that, and it should work again in version 1.3 of the API.  Oops ;-)</p>",
        "id": 173019722,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1565613870
    },
    {
        "content": "<p>This is the PR: <a href=\"https://github.com/FirelyTeam/fhir-net-api/pull/995\" target=\"_blank\" title=\"https://github.com/FirelyTeam/fhir-net-api/pull/995\">https://github.com/FirelyTeam/fhir-net-api/pull/995</a></p>\n<p>If you are doing this in your own code, you could upgrade to 1.3 now.  I don't know which version is active in Simplifier though. <span class=\"user-mention\" data-user-id=\"191335\">@Martijn Harthoorn</span> knows for sure ;-)</p>",
        "id": 173019831,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1565613969
    },
    {
        "content": "<p>Simplifier upgraded to 1.3 last week.</p>",
        "id": 173188068,
        "sender_full_name": "Martijn Harthoorn",
        "timestamp": 1565775071
    },
    {
        "content": "<p>Ok, the \"not-supported\" error message is gone now, but validation still fails spectacularly.<br>\nI will have to investigate further...</p>",
        "id": 173192469,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565780120
    },
    {
        "content": "<p>Yes, I tried going a little further with it and ran into other significant validation errors - mainly related to slicing and the Profile-identifier-lanr and Profile-identifier-zanr profiles.  I didn't have time to chase them down more.</p>",
        "id": 173238200,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1565813973
    },
    {
        "content": "<p>Got it:<br>\nSolution: remove Identifier.type-slicing in the Coding-Profiles and use pattern instead, slice Identifier by pattern:type instead of pattern:$this.</p>\n<p>Thanks to all who helped <span aria-label=\"thank you\" class=\"emoji emoji-1f64f\" role=\"img\" title=\"thank you\">:thank_you:</span></p>",
        "id": 173272492,
        "sender_full_name": "Simone Heckmann",
        "timestamp": 1565856035
    }
]