[
    {
        "content": "<p>Hi All, where does <a href=\"http://validator.fhir.org\">validator.fhir.org</a> get its list of IGs from?</p>",
        "id": 271908420,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1644883887
    },
    {
        "content": "<p>the package server</p>",
        "id": 271908532,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1644883944
    },
    {
        "content": "<p>Hmm, and that pulls from the registry?</p>\n<p>I'm trying to figure out why my IG (ca.infoway.io.psca) isn't showing up on the list.</p>",
        "id": 271908701,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1644884068
    },
    {
        "content": "<p>it's not on <a href=\"http://packages.fhir.org\">packages.fhir.org</a> then</p>",
        "id": 271908775,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1644884128
    },
    {
        "content": "<p>and the registry also builds on <a href=\"http://packages.fhir.org\">packages.fhir.org</a>. (and other places)</p>",
        "id": 271908807,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1644884156
    },
    {
        "content": "<p>It is listed on <a href=\"http://packages.fhir.org\">packages.fhir.org</a>, and I've previously tried building dependent IGs from it, so I'm pretty sure that part is working.</p>",
        "id": 271908959,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1644884261
    },
    {
        "content": "<p>where is it listed?</p>",
        "id": 271911834,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1644886395
    },
    {
        "content": "<p><a href=\"http://packages.fhir.org\">packages.fhir.org</a> (<a href=\"https://simplifier.net/packages\">https://simplifier.net/packages</a>)</p>\n<p><a href=\"/user_uploads/10155/kSgay3pmFOdE9z9lKhbS3VjE/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/kSgay3pmFOdE9z9lKhbS3VjE/image.png\" title=\"image.png\"><img src=\"/user_uploads/10155/kSgay3pmFOdE9z9lKhbS3VjE/image.png\"></a></div>",
        "id": 271912091,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1644886562
    },
    {
        "content": "<p>hmm I don't know then. <span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> is working on the validator right now</p>",
        "id": 271912283,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1644886710
    },
    {
        "content": "<p>OK. Thanks.</p>",
        "id": 271912324,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1644886748
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> Let me know if you need more information to get the data from the FHIR package registry.<br>\nThe API for the registry is documented here: <a href=\"https://app.swaggerhub.com/apis-docs/firely/Simplifier.net_FHIR_Package_API\">https://app.swaggerhub.com/apis-docs/firely/Simplifier.net_FHIR_Package_API</a></p>",
        "id": 272245597,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1645097158
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  thanks, looking into it. At the moment, the validator-wrapper is using the PackageClient from org.fl7.fhir.core, which is actually querying <a href=\"https://raw.githubusercontent.com/FHIR/ig-registry/master/fhir-ig-list.json?nocache=\">https://raw.githubusercontent.com/FHIR/ig-registry/master/fhir-ig-list.json?nocache=</a></p>\n<p>This gives a list that doesn't contain ca.infoway.io.psca, while <code>https://packages.simplifier.net/catalog?prerelease=false</code> contains it.</p>\n<p>Should these two not have the same listings?</p>",
        "id": 272272031,
        "sender_full_name": "David Otasek",
        "timestamp": 1645110216
    },
    {
        "content": "<p>hmm. I think we're using the wrong feature there, though it's probably the way I decided.</p>",
        "id": 272319017,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645130121
    },
    {
        "content": "<p>actually, <span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> I think that's because the package registry is unreliable - the desired query here is a top level list of all conformance packages, and there's a couple of problems with that:</p>\n<ul>\n<li>the type of package is not evident on the package API, so you have to download every package to find out whether it's something that you can validate against (we could ignore that for now, I guess, since 95%+ of the packages are)</li>\n<li>the registry only returns the first N matches (25 I think) and there's no way to get more. And this query needs everything. I think there's several hundred now. </li>\n</ul>\n<p>That's why we queried the other repository, but that's not the right solution long term</p>\n<p><span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> the right approach is to list everything in the package registry, but list what's in the fhir-ig-list.json file first</p>\n<p>Anyway <span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> you have your answer as to why it's not listed - list it in <a href=\"https://github.com/FHIR/ig-registry/blob/master/fhir-ig-list.json\">https://github.com/FHIR/ig-registry/blob/master/fhir-ig-list.json</a> (make a PR) and it'll appear in the list</p>",
        "id": 272321180,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645131325
    },
    {
        "content": "<p>(deleted)</p>",
        "id": 272335956,
        "sender_full_name": "David Otasek",
        "timestamp": 1645138354
    },
    {
        "content": "<p>This is a reminder (mostly to myself) that there are actually two  FHIR registries: The Simplifier-powered registry at <a href=\"https://registry.fhir.org\">https://registry.fhir.org</a>, and the one that reads from the github fhir-ig-list.json mentioned above (<a href=\"http://fhir.org/guides/registry/\">http://fhir.org/guides/registry/</a>).</p>",
        "id": 272345405,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1645145051
    },
    {
        "content": "<p>I've added my IG to fhir-ig-list.json, and made a PR.</p>",
        "id": 272345486,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1645145117
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> , thanks for merging my PR. </p>\n<p>My IG is now showing up in the IG selection dropdown on <a href=\"https://validator.fhir.org\">https://validator.fhir.org</a>. However, when I try to validate, I get an error of \"Cannot parse entered text as valid JSON/XML.\" Running the validator locally on the same resource instance (and now that I've got past the packaging issue, running the Inferno validator on that instance) don't show any problem. Is there any way of getting more diagnostics from the online validator?</p>\n<p>I'm not sure if it is connected, but the url in the dropdown is the page from which to download the package. It isn't the canonical of the IG. I assume this is populated from editions.url in the fhir-ig-list.json.</p>",
        "id": 272466277,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1645222999
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span></p>",
        "id": 272621713,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645396982
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I'll add a request to expose <code>type</code> on the package endpoint.<br>\nOn returning N matches only: the current endpoints should be enough to create an autocomplete box that queries the package endpoint based on what the user types. Perhaps it could additionally remember the packages that have most often/recently been selected and list them beforehand?</p>",
        "id": 272681500,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1645446384
    },
    {
        "content": "<p>perhaps. But the UI doesn't prompt the user to type to find (rather than filter). I'll talk to <span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> about it</p>",
        "id": 272743099,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645484658
    },
    {
        "content": "<p>type will be good</p>",
        "id": 272743106,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645484665
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> I tried replicating your issue with the online validator, and I can see something that could explain why it's not functioning. On the server side logs, I can see that it's not getting the package in tgz format. According to the simplifier API, we should be passing <code>application/tar+gzip</code> as the <code>accept</code> header, but for some reason, that's not happening.</p>\n<p>How are you executing this using the command line? If that's working, maybe there's a step that the online validator is missing.</p>",
        "id": 273012387,
        "sender_full_name": "David Otasek",
        "timestamp": 1645650870
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> Is the validator pulling that from fhir-ig-list.json's <code>guides.editions.url</code> element or somewhere else?</p>",
        "id": 273019136,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1645654549
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191380\">@Elliot Silver</span> That's the only place I see it.</p>",
        "id": 273022575,
        "sender_full_name": "David Otasek",
        "timestamp": 1645656339
    },
    {
        "content": "<p>OK, I'll update fhir-ig-list and do a PR. I'll update the readme too, but I'm not sure what it should say. I don't know how that url gets turned into the retrieve of  the package.</p>",
        "id": 273022908,
        "sender_full_name": "Elliot Silver",
        "timestamp": 1645656552
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  I'm looking at adding <a href=\"http://simplifier.net\">simplifier.net</a> packages to the validator interface, and some versioning needs to be resolved.</p>\n<p>Right now, we're getting the interface's SemVer versions from org.hl7.fhir.org's code (1.0.2, 1.4.0, 3.0.2, 4.0.1, 4.1.0, 4.3.0, 5.0, 4.6.0).</p>\n<p>However, the return from <a href=\"http://simplifier.net\">simplifier.net</a> uses the code (DSTU2, STU3, R4)</p>\n<p>Example:</p>\n<div class=\"codehilite\" data-code-language=\"JSON\"><pre><span></span><code><span class=\"err\">...</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"nt\">\"versions\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"nt\">\"1.0.2\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"name\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"slicebugtest\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"version\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"1.0.2\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"description\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"This is a package to test a slice bug.\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"dist\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"p\">{</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"shasum\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"71600cccef5dd56ca3e05145951c14302ce1d27d\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">                </span><span class=\"nt\">\"tarball\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://packages.simplifier.net/slicebugtest/1.0.2\"</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"p\">},</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"fhirVersion\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"STU3\"</span><span class=\"p\">,</span><span class=\"w\"></span>\n<span class=\"w\">            </span><span class=\"nt\">\"url\"</span><span class=\"p\">:</span><span class=\"w\"> </span><span class=\"s2\">\"https://packages.simplifier.net/slicebugtest/1.0.2\"</span><span class=\"w\"></span>\n<span class=\"w\">        </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"w\">    </span><span class=\"p\">}</span><span class=\"w\"></span>\n<span class=\"err\">...</span><span class=\"w\"></span>\n</code></pre></div>\n<p>I'm looking for resolution in the validator code for this, otherwise, validating 4.1.0 or 4.3.0 could be problematic.</p>",
        "id": 273136159,
        "sender_full_name": "David Otasek",
        "timestamp": 1645730314
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> One more, with regards to the API. To pre-populate the popup in the validator-wrapper UI, I can limit my queries to <a href=\"http://simplifier.net\">simplifier.net</a> based on version (once we resolve the version issue above). But I'm getting a weird behaviour when searching for unmatched versions. I believe the following should be returning 0 results, but it looks like it's giving me the same result as having no search fields:</p>\n<p><a href=\"https://packages.simplifier.net/catalog?fhirVersion=R5&amp;prerelease=false\">https://packages.simplifier.net/catalog?fhirVersion=R5&amp;prerelease=false</a></p>",
        "id": 273137423,
        "sender_full_name": "David Otasek",
        "timestamp": 1645730894
    },
    {
        "content": "<p>simplifier only supports the three versions at the moment. it doesn't contain packages for the other versions, so not point querying it for those.</p>",
        "id": 273140072,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645731989
    },
    {
        "content": "<p>I'm not sure where the version code issue surfaces - the java interface should use FHIRVersion, and automatically handle the fact that simplifier doesn't</p>",
        "id": 273140127,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1645732023
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span> Does Grahame's reply answer your question? Otherwise, you can of course open up the package and look at the FHIR versions and core package dependencies in the <code>package.json</code></p>",
        "id": 273247027,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1645804962
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"203235\">@Ward Weistra</span> <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> yes, this is making the picture clearer. I believe the online validator is attempting to narrow down the available selection of IGs based on the semantic version, and appears to also be explicitly setting the version when it validates. Filtering is probably helping that IGs dropdown perform more responsively, but if we're to expand the IGs included, it may have to be adjusted.</p>",
        "id": 273285953,
        "sender_full_name": "David Otasek",
        "timestamp": 1645823858
    },
    {
        "content": "<p>Good to hear <span class=\"user-mention\" data-user-id=\"453078\">@David Otasek</span>. The API can also tell you what the latest released version of a package/IG is or list all versions for a user to choose from.</p>",
        "id": 273466250,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1646042034
    }
]