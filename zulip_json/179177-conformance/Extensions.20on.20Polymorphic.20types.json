[
    {
        "content": "<p>I am looking at a problem in IPS for <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span></p>",
        "id": 154026538,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545277839
    },
    {
        "content": "<p>The current differential looks like this:</p>",
        "id": 154026539,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545277858
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;slicing&gt;</span>\n                <span class=\"nt\">&lt;discriminator&gt;</span>\n                    <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;type&quot;</span><span class=\"nt\">/&gt;</span>\n                    <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;$this&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;/discriminator&gt;</span>\n                <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;open&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/slicing&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effectiveDateTime&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;dateTime&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime:data-absent-reason&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime.extension&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effectivePeriod&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Period&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod:data-absent-reason&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod.extension&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 154026540,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545277922
    },
    {
        "content": "<p>summary:</p>\n<ul>\n<li>the effective[x] element is must-support + sliced by type</li>\n<li>on both of the types, the data-absent extension is must-support</li>\n</ul>",
        "id": 154026541,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545277998
    },
    {
        "content": "<p>I don't think it should be sliced. So I think it should be like this:</p>",
        "id": 154026542,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278013
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;dateTime&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectiveDateTime.extension&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Period&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effectivePeriod.extension&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 154026543,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278083
    },
    {
        "content": "<p>e..g just take the slicing out.</p>",
        "id": 154026544,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278090
    },
    {
        "content": "<p>but this is even simpler:</p>",
        "id": 154026545,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278097
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n        <span class=\"nt\">&lt;element&gt;</span>\n            <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x].extension&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;sliceName</span> <span class=\"na\">value=</span><span class=\"s\">&quot;data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;type&gt;</span>\n                <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n                <span class=\"nt\">&lt;profile</span> <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n            <span class=\"nt\">&lt;/type&gt;</span>\n            <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 154026546,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278112
    },
    {
        "content": "<p>that is - just define the extension on the choice type</p>",
        "id": 154026547,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278140
    },
    {
        "content": "<p>the great thing is the snapshot generater/validator don't actually work for any of these combinations...</p>",
        "id": 154026548,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278169
    },
    {
        "content": "<p>there's a rule that you can't do the second, because how you can define children for no type... unless they are extensions....</p>",
        "id": 154026549,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1545278210
    },
    {
        "content": "<p>If I understand correctly, according to the new new rules for choice types in R4 (that I still need to implement in dotnet API...), a slicing introduction is no longer required when introducing constraints on specific choice types.<br>\nAs for the second, even shorter version; theoretically a slice introduction can define constraints on the common base type for the whole slice group - in this case <code>Element</code>, which defines the common <code>Element.extension</code> child element. This implies that it should be possible (well defined/parseable) to introduce common extensions inside of a slice group, and even nested/complex extensions.<br>\nNot claiming that the dotnet API currently supports the proposed behavior - I suspect that we haven't implemented this (yet).</p>",
        "id": 154560313,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1546858735
    },
    {
        "content": "<p>Decision after discussion on Tuesday evening in San Antonio:</p>",
        "id": 155253257,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547645450
    },
    {
        "content": "<p>the last form is supported for extension only as a special case. modifierExtension (applicable in truly corner cases) is not supported</p>",
        "id": 155253284,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547645486
    },
    {
        "content": "<p>Seems like I missed out on a fun discussion ;p<br>\nToo my understanding, a profile is allowed to introduce _any_ constraints on (child elements of) <code>MedicationStatement.effective[x]</code>, and such constraints apply to all specific types in the type slice.<br>\nSo why is this particular example special? i.e. why do we need additional rules?</p>",
        "id": 155322266,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1547718090
    },
    {
        "content": "<p>in effect, we ruled that it wasn't special; I was just confirming that other people agreed with that</p>",
        "id": 155338160,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1547734853
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  It appears that the fix for this isn't complete?</p>\n<div class=\"codehilite\"><pre><span></span>process res: Medication-uv-ips                                                   (35.0253sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Medication-uv-ips.structuredefinition - overriding from 0.1 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips because MedicationStatement.effective[x] has children (MedicationStatement.effective[x].extension) and multiple types (dateTime, Period) in profile MedicationStatement-uv-ips\n</pre></div>",
        "id": 157368077,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549041148
    },
    {
        "content": "<p>hmm how did you get the igpublisher you used for that?</p>",
        "id": 157385190,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1549054571
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Just now saw this.  I used the IG Publisher from the latest current build (as of this morning).</p>",
        "id": 157406549,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549081175
    },
    {
        "content": "<p>so  Idon't know why you're getting different results to me. are you current against the latest version of IPS?</p>",
        "id": 157438578,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1549141744
    },
    {
        "content": "<p>Yes, all current.  I'll refresh and recheck all of it and try again - and if I get the same errors I'll give you all of the details.</p>",
        "id": 157467922,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549199881
    },
    {
        "content": "<p>After wiping the temp and output folders and the ips cache, that error went away (not sure which one of those fixed it).</p>",
        "id": 157493867,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549245643
    },
    {
        "content": "<p>strange</p>",
        "id": 157495440,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1549248765
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Well, I guess I was wrong - missed the error on the last look, but it's still there (and there are more instances now after making the extension usage consistent):</p>\n<div class=\"codehilite\"><pre><span></span>process res: Device-uv-ips                                                       (21.0084sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Device-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/DeviceUseStatement-uv-ips because DeviceUseStatement.timing[x] has children (DeviceUseStatement.timing[x].extension) and multiple types (Timing, Period, dateTime) in profile DeviceUseStatement-uv-ips\nprocess res: ImagingStudy-uv-ips                                                 (21.0095sec)\nprocess res: Immunization-uv-ips                                                 (21.0112sec)\nprocess res: MedicationStatement-uv-ips                                          (21.0138sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Immunization-uv-ips because Immunization.occurrence[x] has children (Immunization.occurrence[x].extension) and multiple types (dateTime, string) in profile Immunization-uv-ips\nprocess res: Medication-uv-ips                                                   (21.0163sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Medication-uv-ips.structuredefinition - overriding from 0.1 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips because MedicationStatement.effective[x] has children (MedicationStatement.effective[x].extension) and multiple types (dateTime, Period) in profile MedicationStatement-uv-ips\nprocess res: Observation-alcoholuse-uv-ips                                       (21.0182sec)\nprocess res: Observation-media-uv-ips                                            (21.0198sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-alcoholuse-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-alcoholuse-uv-ips\nprocess res: Observation-imaging-uv-ips                                          (21.0210sec)\nError in snapshot generation: Differential for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-media-uv-ips with id: Media.context has an element that is not marked with a snapshot match\nprocess res: Observation-laboratory-uv-ips                                       (21.0248sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Observation-laboratory-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-imaging-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-imaging-uv-ips\nprocess res: Observation-member-imaging-uv-ips                                   (21.0296sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-laboratory-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-laboratory-uv-ips\nprocess res: Observation-member-laboratory-uv-ips                                (21.0316sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Observation-member-laboratory-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-imaging-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-member-imaging-uv-ips\nprocess res: Observation-member-pathology-uv-ips                                 (21.0340sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Observation-member-pathology-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-laboratory-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-member-laboratory-uv-ips\nprocess res: Observation-pathology-uv-ips                                        (21.0365sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Observation-pathology-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-member-pathology-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-member-pathology-uv-ips\nprocess res: Observation-pregnancy-edd-uv-ips                                    (21.0388sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-pathology-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-pathology-uv-ips\nprocess res: Observation-pregnancy-outcome-uv-ips                                (21.0404sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-pregnancy-edd-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-pregnancy-edd-uv-ips\nprocess res: Observation-pregnancy-status-uv-ips                                 (21.0428sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-pregnancy-outcome-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-pregnancy-outcome-uv-ips\nprocess res: Observation-tobaccouse-uv-ips                                       (21.0443sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-pregnancy-status-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-pregnancy-status-uv-ips\nprocess res: Observation-uv-ips                                                  (21.0457sec)\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-tobaccouse-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-tobaccouse-uv-ips\nprocess res: Organization-laboratory-uv-ips                                      (21.0472sec)\nBusiness version mismatch in /Users/rhausam/git-repo/fhir-ips/resources/Organization-laboratory-uv-ips.structuredefinition - overriding from 0.2 to 0.2.0\nUnable to generate snapshot for http://hl7.org/fhir/uv/ips/StructureDefinition/Observation-uv-ips because Observation.effective[x] has children (Observation.effective[x].extension) and multiple types (dateTime, Period, Timing, instant) in profile Observation-uv-ips\n</pre></div>\n\n\n<p>Whenever it hits the effective[x] or timing[x] element that triggers the \"Unable to generate snapshot\" error, the snapshot generation appears as being truncated at that point (prior to rendering the extension in the snapshot):<br>\n<a href=\"/user_uploads/10155/6VYSkBGYs34ByxUp2ZIf0Eo0/Screen-Shot-2019-02-03-at-23.22.47.png\" target=\"_blank\" title=\"Screen-Shot-2019-02-03-at-23.22.47.png\">Screen-Shot-2019-02-03-at-23.22.47.png</a> <a href=\"/user_uploads/10155/mjl1pCyIi-sq88VqsRwtZ_b6/Screen-Shot-2019-02-03-at-23.23.52.png\" target=\"_blank\" title=\"Screen-Shot-2019-02-03-at-23.23.52.png\">Screen-Shot-2019-02-03-at-23.23.52.png</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/6VYSkBGYs34ByxUp2ZIf0Eo0/Screen-Shot-2019-02-03-at-23.22.47.png\" target=\"_blank\" title=\"Screen-Shot-2019-02-03-at-23.22.47.png\"><img src=\"/user_uploads/10155/6VYSkBGYs34ByxUp2ZIf0Eo0/Screen-Shot-2019-02-03-at-23.22.47.png\"></a></div><div class=\"message_inline_image\"><a href=\"/user_uploads/10155/mjl1pCyIi-sq88VqsRwtZ_b6/Screen-Shot-2019-02-03-at-23.23.52.png\" target=\"_blank\" title=\"Screen-Shot-2019-02-03-at-23.23.52.png\"><img src=\"/user_uploads/10155/mjl1pCyIi-sq88VqsRwtZ_b6/Screen-Shot-2019-02-03-at-23.23.52.png\"></a></div>",
        "id": 157500736,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549257921
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> Have you had a chance yet to look at the snapshot issues with this?</p>",
        "id": 157727415,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1549488132
    },
    {
        "content": "<p>ok will commit fix soon</p>",
        "id": 157738447,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1549497083
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span>  One thing I think it never occurred to me (until now) to clarify - are all of the fixes to this expected to be available for use with the current R4 release based on using the newer validator and IG publisher, or do they depend also on further updates to the R4 spec itself (i.e. CI build or R5, or maybe R4 technical correction)?</p>",
        "id": 172142953,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564591218
    },
    {
        "content": "<p>I think the intention is to:<br>\n1) improve tooling implementations, fix bugs<br>\n2) Publish R4 technical correction<br>\nIf feasible, i.e. if the required changes are compatible. However incompatible changes will need to wait for R5.</p>",
        "id": 172143420,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1564591626
    },
    {
        "content": "<p>So, I think you are confirming that an IG and profiles that are based on the current released version of R4 (4.0.0), using the latest tooling, wouldn't be able to make use of these enhancements?</p>",
        "id": 172144127,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564592247
    },
    {
        "content": "<p>It depends... If we succeed to address this by improving tooling, then you may be able to use this on R4 (4.0.0). If something requires a correction or change in the FHIR spec, then you will need to wait for R4.1 (or R5).</p>",
        "id": 172144359,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1564592410
    },
    {
        "content": "<p>Right.  That's what I would like to clarify - where exactly are we now with that?</p>",
        "id": 172144446,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564592468
    },
    {
        "content": "<p>I guess we're currently still investigating...</p>",
        "id": 172144488,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1564592491
    },
    {
        "content": "<p>Maybe <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> can shed some more light?</p>",
        "id": 172144781,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1564592683
    },
    {
        "content": "<p>There is something wrong (or at least incomplete) about this.  When we add the dataAbsentReason extension to MedicationStatement.effective[x] in the IPS <a href=\"https://build.fhir.org/ig/HL7/fhir-ips/StructureDefinition-MedicationStatement-uv-ips.html\" target=\"_blank\" title=\"https://build.fhir.org/ig/HL7/fhir-ips/StructureDefinition-MedicationStatement-uv-ips.html\">profile</a>, that itself seems to work OK, but then in both the differential and the snapshot the IG Publisher no longer renders the effectiveDateTime and effectivePeriod choices.  And if instead you try to slice it, that does show the choices but with all three elements as siblings, and then it's not really obvious that effectiveDateTime and effectivePeriod are actually the choices for effective[x] (and that effective[x] itself can't actually exist).</p>\n<p>And when you are just adding the extension to the base effective[x] element (not explicitly slicing) the build qa shows these information messages (at least they're not errors):</p>\n<div class=\"codehilite\"><pre><span></span>Bundle/IPS-examples-Bundle-01: Bundle.entry[5].resource.effective.ofType(Period).start  information Could not verify slice for profile http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips\nBundle/IPS-examples-Bundle-01: Bundle.entry[6].resource.effective.ofType(Period).start  information Could not verify slice for profile http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips\n</pre></div>\n\n\n<p>And if instead I explicitly slice the two types, in addition to the sibling element rendering that I mentioned before I also get a broken link error that it can't resolve the effective[x].extension (I don't have a copy of that error message at the moment).</p>",
        "id": 172167439,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564608364
    },
    {
        "content": "<p>how do I reproduce this?</p>",
        "id": 172169927,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564610308
    },
    {
        "content": "<p>the non-sliced version is in the IPS IG repo, if you build that<br>\nand the code for the (implicit) slicing is commented out in MedicationStatement-uv-ips.structuredefinition.xml in lines 158-177</p>",
        "id": 172180658,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564620880
    },
    {
        "content": "<p>ok, the non-sliced version, since you shouldn't slice. Here's the diff:</p>\n<div class=\"codehilite\"><pre><span></span> <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x].extension&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x].extension&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;profile</span>\n                 <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 172181395,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621830
    },
    {
        "content": "<p>and here's the rendering:</p>",
        "id": 172181400,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621837
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/XfrF1Z7W5eYeHlVl5iJo_6LN/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/XfrF1Z7W5eYeHlVl5iJo_6LN/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/XfrF1Z7W5eYeHlVl5iJo_6LN/pasted_image.png\"></a></div>",
        "id": 172181433,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621884
    },
    {
        "content": "<p>that seems exactly what is expected to me</p>",
        "id": 172181441,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621891
    },
    {
        "content": "<p>turning to the snapshot:</p>",
        "id": 172181493,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621924
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span>   <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;short</span>\n             <span class=\"na\">value=</span><span class=\"s\">&quot;The date/time or interval when the medication is/was/will be taken&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span>\n                  <span class=\"na\">value=</span><span class=\"s\">&quot;The interval of time during which it is being asserted that the patient is/was/will be taking the medication (or was not taking, when the MedicationStatement.taken element is No).&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;comment</span>\n               <span class=\"na\">value=</span><span class=\"s\">&quot;This attribute reflects the period over which the patient consumed the medication and is expected to be populated on the majority of Medication Statements. If the medication is still being taken at the time the statement is recorded, the &amp;quot;end&amp;quot; date will be omitted.  The date/time attribute supports a variety of dates - year, year/month and exact date.  If something more than this is required, this should be conveyed as text.&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;base&gt;</span>\n        <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x]&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/base&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;dateTime&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Period&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;isModifier</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;isSummary</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;workflow&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Event.occurrence[x]&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;w5&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;FiveWs.done[x]&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;rim&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;.effectiveTime&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x].id&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x].id&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;representation</span> <span class=\"na\">value=</span><span class=\"s\">&quot;xmlAttr&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Unique id for inter-element referencing&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span>\n                  <span class=\"na\">value=</span><span class=\"s\">&quot;Unique id for the element within a resource (for internal references). This may be any string value that does not contain spaces.&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;base&gt;</span>\n        <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Element.id&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/base&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code&gt;</span>\n          <span class=\"nt\">&lt;extension</span>\n                     <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-json-type&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;valueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;string&quot;</span><span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;/extension&gt;</span>\n          <span class=\"nt\">&lt;extension</span>\n                     <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-xml-type&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;valueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;xsd:string&quot;</span><span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;/extension&gt;</span>\n          <span class=\"nt\">&lt;extension</span>\n                     <span class=\"na\">url=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/structuredefinition-rdf-type&quot;</span><span class=\"nt\">&gt;</span>\n            <span class=\"nt\">&lt;valueString</span> <span class=\"na\">value=</span><span class=\"s\">&quot;xsd:string&quot;</span><span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;/extension&gt;</span>\n        <span class=\"nt\">&lt;/code&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;isModifier</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;isSummary</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;rim&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;n/a&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n    <span class=\"nt\">&lt;element</span> <span class=\"na\">id=</span><span class=\"s\">&quot;MedicationStatement.effective[x].extension&quot;</span><span class=\"nt\">&gt;</span>\n      <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;MedicationStatement.effective[x].extension&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;slicing&gt;</span>\n        <span class=\"nt\">&lt;discriminator&gt;</span>\n          <span class=\"nt\">&lt;type</span> <span class=\"na\">value=</span><span class=\"s\">&quot;value&quot;</span><span class=\"nt\">/&gt;</span>\n          <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;url&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;/discriminator&gt;</span>\n        <span class=\"nt\">&lt;description</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extensions are always sliced by (at least) url&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;rules</span> <span class=\"na\">value=</span><span class=\"s\">&quot;open&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/slicing&gt;</span>\n      <span class=\"nt\">&lt;short</span> <span class=\"na\">value=</span><span class=\"s\">&quot;effective[x] absence reason&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;definition</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Provides a reason why the effective is missing.&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;1&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;base&gt;</span>\n        <span class=\"nt\">&lt;path</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Element.extension&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;min</span> <span class=\"na\">value=</span><span class=\"s\">&quot;0&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;max</span> <span class=\"na\">value=</span><span class=\"s\">&quot;*&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/base&gt;</span>\n      <span class=\"nt\">&lt;type&gt;</span>\n        <span class=\"nt\">&lt;code</span> <span class=\"na\">value=</span><span class=\"s\">&quot;Extension&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;profile</span>\n                 <span class=\"na\">value=</span><span class=\"s\">&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/type&gt;</span>\n      <span class=\"nt\">&lt;mustSupport</span> <span class=\"na\">value=</span><span class=\"s\">&quot;true&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;isModifier</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;isSummary</span> <span class=\"na\">value=</span><span class=\"s\">&quot;false&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;mapping&gt;</span>\n        <span class=\"nt\">&lt;identity</span> <span class=\"na\">value=</span><span class=\"s\">&quot;rim&quot;</span><span class=\"nt\">/&gt;</span>\n        <span class=\"nt\">&lt;map</span> <span class=\"na\">value=</span><span class=\"s\">&quot;ANY.nullFlavor&quot;</span><span class=\"nt\">/&gt;</span>\n      <span class=\"nt\">&lt;/mapping&gt;</span>\n    <span class=\"nt\">&lt;/element&gt;</span>\n</pre></div>",
        "id": 172181530,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564621971
    },
    {
        "content": "<p>that also seems right to me</p>",
        "id": 172181561,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564622012
    },
    {
        "content": "<p>and the rendering:</p>",
        "id": 172181567,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564622016
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/1cUlC8IFuOTKTzzQ9xJurUPL/pasted_image.png\" target=\"_blank\" title=\"pasted_image.png\">pasted image</a></p>\n<div class=\"message_inline_image\"><a href=\"/user_uploads/10155/1cUlC8IFuOTKTzzQ9xJurUPL/pasted_image.png\" target=\"_blank\" title=\"pasted image\"><img src=\"/user_uploads/10155/1cUlC8IFuOTKTzzQ9xJurUPL/pasted_image.png\"></a></div>",
        "id": 172181627,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564622052
    },
    {
        "content": "<p>the id is missing a type.... I think otherwise it is how I expect it to be</p>",
        "id": 172181642,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564622069
    },
    {
        "content": "<p>it may be that this is working different for me, since I have a few unreleased fixes. <span class=\"user-mention\" data-user-id=\"191405\">@Rob Hausam</span></p>",
        "id": 172181819,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564622313
    },
    {
        "content": "<p>yes, I saw that you made more changes - I might do a local build to check, unless you are going to be releasing imminently</p>",
        "id": 172183265,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564624313
    },
    {
        "content": "<p>it's building, but that takes 90min right now</p>",
        "id": 172183744,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564624998
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  With the new 0.9.47 IG Publisher I'm not seeing any difference (that I've been able to notice) with what was there before.  It still does seem strange to me that the effectiveDateTime and effectivePeriod choices aren't being rendered in the snapshot, whereas they are in the core spec.  That doesn't seem great to me, but I can probably live with it.  I'm also still getting the \"Could not verify slice\" information messages in the qa  that I posted above.  Do we just ignore those?</p>",
        "id": 172188838,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564631838
    },
    {
        "content": "<p>oh - the way they are in the core spec - that's a different set of code.</p>",
        "id": 172188957,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564632001
    },
    {
        "content": "<p>but it raises an interesting question - the rendering of children would run into the rendering of choices if I brought the choice rendering across - they're not differentiated</p>",
        "id": 172189023,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564632034
    },
    {
        "content": "<p>I'll look into the slice validation</p>",
        "id": 172189030,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1564632045
    },
    {
        "content": "<p>ok</p>",
        "id": 172189047,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564632070
    },
    {
        "content": "<p>yes, the choice and child rendering is in the same space so they have the potential to collide or be confused - but maybe there is some way to differentiate them and indicate that they are distinct?</p>",
        "id": 172189233,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1564632259
    },
    {
        "content": "<p>I'm resurrecting this somewhat old thread, as I'm not sure exactly where we've gotten with it (in the R4 technical correction, particularly).  When I build the IPS IG with the latest publisher I'm getting a snapshot error on the MedicationStatement-uv-ips profile, which uses the data-absent-reason extension on effective[x]:</p>\n<div class=\"codehilite\"><pre><span></span>Error in snapshot generation: The profile http://hl7.org/fhir/uv/ips/StructureDefinition/MedicationStatement-uv-ips has 2 elements in the differential (id: MedicationStatement.effective[x], id: MedicationStatement.effective[x]:data-absent-reason) that don&#39;t have a matching element in the snapshot: check that the path and definitions are legal in the differential (including order)\nDifferential:\n  MedicationStatement : [0..null]\n  MedicationStatement.id : [0..null]\n  MedicationStatement.status : [0..null]\n  MedicationStatement.medication[x] : CodeableConcept([CanonicalType[http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips]])|Reference[0..null]\n  MedicationStatement.effective[x] : [1..1]\n  MedicationStatement.effective[x].extension : Extension([CanonicalType[http://hl7.org/fhir/StructureDefinition/data-absent-reason]])[0..1]\n  MedicationStatement.subject : Reference[0..null]\n  MedicationStatement.subject.reference : [1..null]\n  MedicationStatement.informationSource : [0..null]\n  MedicationStatement.dosage : [0..null]\n  MedicationStatement.dosage.text : [0..null]\n  MedicationStatement.dosage.timing : [0..null]\n  MedicationStatement.dosage.route : CodeableConcept([CanonicalType[http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips]])[0..null]\nSnapshot:\n  MedicationStatement : [0..*]  constraints=5\n  MedicationStatement.id : string[0..1]\n  MedicationStatement.meta : Meta[0..1]  constraints=1\n  MedicationStatement.implicitRules : uri[0..1]  constraints=1\n  MedicationStatement.language : code[0..1]  constraints=1\n  MedicationStatement.text : Narrative[0..1]  constraints=1\n  MedicationStatement.contained : Resource[0..*]\n  MedicationStatement.extension : Extension[0..*]  constraints=2\n  MedicationStatement.modifierExtension : Extension[0..*]  constraints=2\n  MedicationStatement.identifier : Identifier[0..*]  constraints=1\n  MedicationStatement.basedOn : Reference[0..*]  constraints=1\n  MedicationStatement.partOf : Reference[0..*]  constraints=1\n  MedicationStatement.status : code[1..1]  constraints=1\n  MedicationStatement.statusReason : CodeableConcept[0..*]  constraints=1\n  MedicationStatement.category : CodeableConcept[0..1]  constraints=1\n  MedicationStatement.medication[x] : CodeableConcept([CanonicalType[http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips]])|Reference[1..1]  constraints=1\n  MedicationStatement.subject : Reference[1..1]  constraints=1\n  MedicationStatement.subject.id : string[0..1]\n  MedicationStatement.subject.extension : Extension[0..*] (slicing by url)  constraints=2\n  MedicationStatement.subject.reference : string[1..1]  constraints=1\n  MedicationStatement.subject.type : uri[0..1]  constraints=1\n  MedicationStatement.subject.identifier : Identifier[0..1]  constraints=1\n  MedicationStatement.subject.display : string[0..1]  constraints=1\n  MedicationStatement.context : Reference[0..1]  constraints=1\n  MedicationStatement.effective[x] : dateTime|Period[0..1]  constraints=1\n  MedicationStatement.dateAsserted : dateTime[0..1]  constraints=1\n  MedicationStatement.informationSource : Reference[0..1]  constraints=1\n  MedicationStatement.derivedFrom : Reference[0..*]  constraints=1\n  MedicationStatement.reasonCode : CodeableConcept[0..*]  constraints=1\n  MedicationStatement.reasonReference : Reference[0..*]  constraints=1\n  MedicationStatement.note : Annotation[0..*]  constraints=1\n  MedicationStatement.dosage : Dosage[0..*]  constraints=1\n  MedicationStatement.dosage.id : string[0..1]\n  MedicationStatement.dosage.extension : Extension[0..*] (slicing by url)  constraints=2\n  MedicationStatement.dosage.modifierExtension : Extension[0..*]  constraints=2\n  MedicationStatement.dosage.sequence : integer[0..1]  constraints=1\n  MedicationStatement.dosage.text : string[0..1]  constraints=1\n  MedicationStatement.dosage.additionalInstruction : CodeableConcept[0..*]  constraints=1\n  MedicationStatement.dosage.patientInstruction : string[0..1]  constraints=1\n  MedicationStatement.dosage.timing : Timing[0..1]  constraints=1\n  MedicationStatement.dosage.asNeeded[x] : boolean|CodeableConcept[0..1]  constraints=1\n  MedicationStatement.dosage.site : CodeableConcept[0..1]  constraints=1\n  MedicationStatement.dosage.route : CodeableConcept([CanonicalType[http://hl7.org/fhir/uv/ips/StructureDefinition/CodeableConcept-uv-ips]])[0..1]  constraints=1\n  MedicationStatement.dosage.method : CodeableConcept[0..1]  constraints=1\n  MedicationStatement.dosage.doseAndRate : Element[0..*]  constraints=1\n  MedicationStatement.dosage.doseAndRate.id : string[0..1]\n  MedicationStatement.dosage.doseAndRate.extension : Extension[0..*] (slicing by url)  constraints=2\n  MedicationStatement.dosage.doseAndRate.type : CodeableConcept[0..1]  constraints=1\n  MedicationStatement.dosage.doseAndRate.dose[x] : Range|Quantity([CanonicalType[http://hl7.org/fhir/StructureDefinition/SimpleQuantity]])[0..1]  constraints=1\n  MedicationStatement.dosage.doseAndRate.rate[x] : Ratio|Range|Quantity([CanonicalType[http://hl7.org/fhir/StructureDefinition/SimpleQuantity]])[0..1]  constraints=1\n  MedicationStatement.dosage.maxDosePerPeriod : Ratio[0..1]  constraints=1\n  MedicationStatement.dosage.maxDosePerAdministration : Quantity([CanonicalType[http://hl7.org/fhir/StructureDefinition/SimpleQuantity]])[0..1]  constraints=1\n  MedicationStatement.dosage.maxDosePerLifetime : Quantity([CanonicalType[http://hl7.org/fhir/StructureDefinition/SimpleQuantity]])[0..1]  constraints=1\n</pre></div>\n\n\n<p>This appears to be related to the use of the extension on the polymorphic type.  Maybe there is something that we need to change for this in the <a href=\"/user_uploads/10155/j3QIhn7YdzkM5rnxjnRHzoGp/MedicationStatement-uv-ips.structuredefinition.xml\" target=\"_blank\" title=\"MedicationStatement-uv-ips.structuredefinition.xml\">profile</a>?:</p>\n<div class=\"codehilite\"><pre><span></span>        &lt;element id=&quot;MedicationStatement.effective[x]&quot;&gt;\n            &lt;path value=&quot;MedicationStatement.effective[x]&quot;/&gt;\n            &lt;min value=&quot;1&quot;/&gt;\n            &lt;max value=&quot;1&quot;/&gt;\n            &lt;mustSupport value=&quot;true&quot;/&gt;\n        &lt;/element&gt;\n        &lt;element id=&quot;MedicationStatement.effective[x]:data-absent-reason&quot;&gt;\n            &lt;path value=&quot;MedicationStatement.effective[x].extension&quot;/&gt;\n            &lt;short value=&quot;effective[x] absence reason&quot;/&gt;\n            &lt;definition value=&quot;Provides a reason why the effective is missing.&quot;/&gt;\n            &lt;max value=&quot;1&quot;/&gt;\n            &lt;type&gt;\n                &lt;code value=&quot;Extension&quot;/&gt;\n                &lt;profile value=&quot;http://hl7.org/fhir/StructureDefinition/data-absent-reason&quot;/&gt;\n            &lt;/type&gt;\n            &lt;mustSupport value=&quot;true&quot;/&gt;\n        &lt;/element&gt;\n</pre></div>\n\n\n<p>Or maybe this hasn't been fully implemented in the snapshot generator?  I don't know if we have any explicit documentation on it - I didn't see any in the <a href=\"http://hl7.org/fhir/extensibility.html#2.5.0\" target=\"_blank\" title=\"http://hl7.org/fhir/extensibility.html#2.5.0\">Extensibility</a> section.  <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>?</p>",
        "id": 186128027,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1579549016
    },
    {
        "content": "<p>is this in the currently committed IPS?</p>",
        "id": 186128808,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579549774
    },
    {
        "content": "<p>yes</p>",
        "id": 186128820,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1579549788
    },
    {
        "content": "<p>By the way, this particular snapshot generation error and two others that I fixed (by re-ordering the elements correctly) didn't show up in the IG build qa page on in the report of errors,  warnings and info at the end of the build.  I assume that they should?  They are quite easy to overlook, otherwise, being buried in the rather voluminous build log output.</p>",
        "id": 186130111,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1579551160
    },
    {
        "content": "<p>actually, the reason is much more prosaic - you have the elements out of order in your differential, and you're not getting an error because the IG publisher sorts your differential before it processes it directly, but composition depends on it and so it gets the snapshot generated internally without sorting. So you see the error associated with that internal iteration, but not the later one which would be linked to qa.</p>",
        "id": 186141415,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579563877
    },
    {
        "content": "<p>Yes, thanks (and apologies for bothering you with it).  The order was what I first thought about and looked at, but somehow I still missed that effective[x] and subject were still in the wrong order. :(</p>",
        "id": 186143840,
        "sender_full_name": "Rob Hausam",
        "timestamp": 1579567629
    },
    {
        "content": "<p>well, in the future it will be an explicit error</p>",
        "id": 186143853,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1579567666
    }
]