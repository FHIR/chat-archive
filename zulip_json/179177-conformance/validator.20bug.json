[
    {
        "content": "<p>The validator has a bug when loading parameters it seems:</p>\n<div class=\"codehilite\"><pre><span></span><code>jvi@Jenss-MacBook-Pro-2 Downloads % file params.json\nparams.json: JSON data\njvi@Jenss-MacBook-Pro-2 Downloads % java -jar org.hl7.fhir.validator.jar -source params.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (9 days old)\nDetected Java version: 11.0.7 from /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: -source params.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nDirectories: Current = /Users/jvi/Downloads, Package Cache = /Users/jvi/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\n  .. validate [-source, params.json]\nException in thread &quot;main&quot; java.io.IOException: File -source does not exist\n    at org.hl7.fhir.validation.ValidationEngine.handleSource(ValidationEngine.java:1071)\n    at org.hl7.fhir.validation.ValidationEngine.handleSources(ValidationEngine.java:1046)\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:1006)\n    at org.hl7.fhir.validation.cli.services.ValidationService.validateSources(ValidationService.java:54)\n    at org.hl7.fhir.validation.Validator.main(Validator.java:202)\njvi@Jenss-MacBook-Pro-2 Downloads % code params.json\n</code></pre></div>\n\n\n<p>contents of the params.json:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;Parameters&quot;,\n  &quot;parameter&quot;: [\n    {\n      &quot;name&quot;: &quot;resource&quot;,\n      &quot;resource&quot;: {\n        &quot;resourceType&quot;: &quot;Communication&quot;,\n        &quot;meta&quot;: {\n          &quot;profile&quot;: [\n            &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message&quot;\n          ]\n        },\n        &quot;extension&quot;: [\n          {\n            &quot;url&quot;: &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-communication-recipientCareTeam&quot;,\n            &quot;valueReference&quot;: {\n              &quot;reference&quot;: &quot;https://inttest.ehealth.sundhed.dk/organization/fhir/CareTeam/50&quot;\n            }\n          },\n          {\n            &quot;url&quot;: &quot;http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-restriction-category&quot;,\n            &quot;valueCodeableConcept&quot;: {\n              &quot;coding&quot;: [\n                {\n                  &quot;system&quot;: &quot;http://ehealth.sundhed.dk/cs/restriction-category&quot;,\n                  &quot;code&quot;: &quot;None&quot;\n                }\n              ]\n            }\n          }\n        ],\n        &quot;partOf&quot;: [\n          {\n            &quot;reference&quot;: &quot;http://careplan.fut.trifork.com/CarePlan/42&quot;\n          }\n        ],\n        &quot;status&quot;: &quot;preparation&quot;,\n        &quot;category&quot;: [\n          {\n            &quot;coding&quot;: [\n              {\n                &quot;system&quot;: &quot;http://ehealth.sundhed.dk/cs/message-category&quot;,\n                &quot;code&quot;: &quot;message&quot;\n              }\n            ],\n            &quot;text&quot;: &quot;Besked&quot;\n          }\n        ],\n        &quot;medium&quot;: [\n          {\n            &quot;coding&quot;: [\n              {\n                &quot;system&quot;: &quot;http://terminology.hl7.org/CodeSystem/v3-ParticipationMode&quot;,\n                &quot;code&quot;: &quot;WRITTEN&quot;\n              }\n            ],\n            &quot;text&quot;: &quot;WRITTEN&quot;\n          }\n        ],\n        &quot;sender&quot;: {\n          &quot;reference&quot;: &quot;http://inttest.ehealth.sundhed.dk/trifork-fhir-server/Patient/100&quot;\n        },\n        &quot;reasonCode&quot;: [\n          {\n            &quot;coding&quot;: [\n              {\n                &quot;system&quot;: &quot;http://ehealth.sundhed.dk/cs/task-category&quot;,\n                &quot;code&quot;: &quot;MissingMeasurementResolving&quot;\n              }\n            ]\n          }\n        ],\n        &quot;payload&quot;: [\n          {\n            &quot;contentString&quot;: &quot;Hello world&quot;\n          }\n        ]\n      }\n    }\n  ]\n}\n</code></pre></div>",
        "id": 200983690,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592294570
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> can you look at this one</p>",
        "id": 200997876,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592304705
    },
    {
        "content": "<p>on it</p>",
        "id": 201017190,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592315311
    },
    {
        "content": "<p>I can 100% replicate it</p>",
        "id": 201019020,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316043
    },
    {
        "content": "<p>Alright, so I can get this to work by taking out the -source argument. For some reason the validator is reading in -source as the file name, and not the file name itself.</p>",
        "id": 201019269,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316133
    },
    {
        "content": "<p>if you run <code>java -jar &lt;path_to_the_jar&gt; &lt;path_to_your_file&gt; -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz</code></p>",
        "id": 201019388,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316186
    },
    {
        "content": "<p>it works and produces the proper output</p>",
        "id": 201019438,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316210
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>java -jar org.hl7.fhir.validation.cli/target/org.hl7.fhir.validation.cli-5.0.7-SNAPSHOT.jar org.hl7.fhir.validation.cli/target/params.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 1f0419b82255). Built 2020-06-11T17:02:55.58-04:00 (4 days old)\nDetected Java version: 1.8.0_202 from /home/mark/.sdkman/candidates/java/8.0.202-zulu/jre on amd64 (64bit). 7136MB available\nArguments: org.hl7.fhir.validation.cli/target/params.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nDirectories: Current = /home/mark/Documents/Projects/FHIR/org.hl7.fhir.core, Package Cache = /home/mark/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\n  .. validate [org.hl7.fhir.validation.cli/target/params.json]\n*FAILURE* validating org.hl7.fhir.validation.cli/target/params.json:  error:5 warn:1 info:1\n  Error @ Parameters.parameter[0].resource (line 63, col24) : Unrecognised property &#39;@reasonCode&#39;\n  Error @ Parameters.parameter[0].resource.ofType(Communication).payload[0] (line 74, col12) : Profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message, Element &#39;Parameters.parameter[0].resource.ofType(Communication).payload[0].content[x]&#39;: minimum required = 1, but only found 0\n  Error @ Parameters.parameter[0].resource.ofType(Communication).payload[0] (line 74, col12) : Profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message, Element &#39;Parameters.parameter[0].resource.ofType(Communication).payload[0].content[x][contentString]&#39;: minimum required = 1, but only found 0\n  Error @ Parameters.parameter[0].resource.ofType(Communication).payload[0] (line 74, col12) : Profile http://hl7.org/fhir/StructureDefinition/Communication, Element &#39;Parameters.parameter[0].resource.ofType(Communication).payload[0].content[x]&#39;: minimum required = 1, but only found 0\n  Error @ Parameters.parameter[0].resource.payload[0] (line 76, col12) : Unrecognised property &#39;@contentString&#39;\n  Information @ Parameters.parameter[0].resource.ofType(Communication).medium[0] (line 50, col12) : This element does not match any known slice defined in the profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message\n  Warning @ Parameters.parameter[0].resource.ofType(Communication).medium[0] (line 50, col12) : ValueSet http://hl7.org/fhir/ValueSet/v3-ParticipationMode not found by validator\n</code></pre></div>",
        "id": 201019450,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316214
    },
    {
        "content": "<p>So, use that as a workaround for now, but I'll look at why the -source arg is messing everything up right now</p>",
        "id": 201019561,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592316251
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span> So, it's actually working as intended.</p>",
        "id": 201027141,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319285
    },
    {
        "content": "<p>If you look at the documentation here: <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator</a></p>",
        "id": 201027158,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319293
    },
    {
        "content": "<p>There is no <code>-source</code> tag</p>",
        "id": 201027177,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319302
    },
    {
        "content": "<p>you just list the input files as parameters, without any identifier</p>",
        "id": 201027274,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319343
    },
    {
        "content": "<p>When you included the <code>-source</code> param, it caused the cli to search for a file named \"-source\", that's why you got the <code>java.io.IOException: File -source does not exist</code> exception</p>",
        "id": 201027436,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319393
    },
    {
        "content": "<p>Just don't include the -source flag and you're golden</p>",
        "id": 201027460,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319406
    },
    {
        "content": "<p>Please let me know if you have any other questions.</p>",
        "id": 201027494,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592319420
    },
    {
        "content": "<p>Right, copy that, thx</p>",
        "id": 201028946,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592320028
    },
    {
        "content": "<p>Makes sense</p>",
        "id": 201028965,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592320034
    },
    {
        "content": "<p>Guess I've been around docker too much lately and got used to tagging my arguments</p>",
        "id": 201029172,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592320115
    },
    {
        "content": "<p>Maybe this is a feature request instead then</p>",
        "id": 201029274,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592320153
    },
    {
        "content": "<p>Most cli tools (at least on *nix) tags their inputs</p>",
        "id": 201029364,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592320194
    },
    {
        "content": "<p><span aria-label=\"ok\" class=\"emoji emoji-1f44c\" role=\"img\" title=\"ok\">:ok:</span></p>",
        "id": 201035985,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592322879
    },
    {
        "content": "<p>Let me know if you have any other issues</p>",
        "id": 201036012,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592322892
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> maybe if we can't find a file and the name we can't find looks like a parameter that we don't recognise, we can be smart in the error message</p>",
        "id": 201048639,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592328644
    },
    {
        "content": "<p>so filter for if the 'filename' starts with '-'</p>",
        "id": 201048739,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592328696
    },
    {
        "content": "<p>I'll add a more verbose output for now, one that actually says what's going on outside of a stack trace</p>",
        "id": 201048850,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592328733
    },
    {
        "content": "<p>y. not in how things work, but in the error message - something like 'no file -source, and it's not a parameter we recognise'</p>",
        "id": 201048862,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592328739
    },
    {
        "content": "<p>okay, adding it now</p>",
        "id": 201049543,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592329109
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> how is this for a more verbose output:</p>",
        "id": 201053372,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592330984
    },
    {
        "content": "<div class=\"codehilite\"><pre><span></span><code>Directories: Current = /home/mark/Documents/Projects/FHIR/org.hl7.fhir.core, Package Cache = /home/mark/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\n  .. validate [-source, org.hl7.fhir.validation.cli/target/params.json]\n\n**********\n* The file name you passed in, &quot;-source&quot;, doesn&#39;t exist on the local filesystem.\n* Please verify that this is valid file location.\n**********\n\nException in thread &quot;main&quot; java.io.IOException: File -source does not exist\n        at org.hl7.fhir.validation.ValidationEngine.handleSource(ValidationEngine.java:1076)\n        at org.hl7.fhir.validation.ValidationEngine.handleSources(ValidationEngine.java:1048)\n        at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:1008)\n        at org.hl7.fhir.validation.cli.services.ValidationService.validateSources(ValidationService.java:54)\n        at org.hl7.fhir.validation.Validator.main(Validator.java:202)\n</code></pre></div>",
        "id": 201053379,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592330991
    },
    {
        "content": "<p>that works for me</p>",
        "id": 201053566,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592331100
    },
    {
        "content": "<p>ok i'll throw up a quick PR</p>",
        "id": 201053593,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592331119
    },
    {
        "content": "<p>Should work on both cli and non cli implementations, I use both System.condole().prinf, and System.out.println depending on where it's run from</p>",
        "id": 201053685,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592331154
    },
    {
        "content": "<p>ok - another thing <span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> : </p>\n<div class=\"codehilite\"><pre><span></span><code>java -jar org.hl7.fhir.validator.jar ./comm.json -ig ~/gitlab/implementationguide/resources/\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (16 days old)\nDetected Java version: 11.0.7 from /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: ./comm.json -ig /Users/jvi/gitlab/implementationguide/resources/\nDirectories: Current = /Users/jvi/Downloads, Package Cache = /Users/jvi/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from /Users/jvi/gitlab/implementationguide/resources/\nException in thread &quot;main&quot; java.io.FileNotFoundException: /Users/jvi/gitlab/implementationguide/resources/structuredefinition (Is a directory)\n    at java.base/java.io.FileInputStream.open0(Native Method)\n    at java.base/java.io.FileInputStream.open(FileInputStream.java:219)\n    at java.base/java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:157)\n    at org.hl7.fhir.utilities.TextFile.fileToBytes(TextFile.java:199)\n    at org.hl7.fhir.validation.ValidationEngine.checkIsResource(ValidationEngine.java:709)\n    at org.hl7.fhir.validation.ValidationEngine.scanDirectory(ValidationEngine.java:558)\n    at org.hl7.fhir.validation.ValidationEngine.loadIgSource(ValidationEngine.java:464)\n    at org.hl7.fhir.validation.ValidationEngine.loadIg(ValidationEngine.java:742)\n    at org.hl7.fhir.validation.cli.services.ValidationService.getValidator(ValidationService.java:185)\n    at org.hl7.fhir.validation.Validator.main(Validator.java:175)\n</code></pre></div>\n\n\n<p>Whats the problem here?  The doc says:</p>\n<div class=\"codehilite\"><pre><span></span><code>-ig [package|file|folder|url]: an IG or profile definition to load. Can be\n     the URL of an implementation guide or a package ([id]-[ver]) for\n     a built implementation guide or a local folder that contains a\n     set of conformance resources.\n     No default value. This parameter can appear any number of times\n</code></pre></div>\n\n\n<p>I thought I just passed a folder containing the conformance resources of an IG - but apparently not?</p>",
        "id": 201706155,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592905493
    },
    {
        "content": "<p>wait ... seems like a bug on my side ...</p>",
        "id": 201706631,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592905874
    },
    {
        "content": "<p>what happens if you drop the trailing slash?</p>",
        "id": 201714579,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1592912665
    },
    {
        "content": "<p>The contents of the IG was not generated ... Apparently this is the kind of error the validator throws if it cannot find any conformance resources. You can reproduce it by pointing it to any other folder. <span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> - feature request: make it cough up a bit differently, please ;)</p>",
        "id": 201717600,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592914878
    },
    {
        "content": "<p>I've found another bug. Take a look at the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>java -jar org.hl7.fhir.validator.jar ./comm.xml -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (16 days old)\nDetected Java version: 11.0.7 from /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: ./comm.xml -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nDirectories: Current = /Users/jvi/Downloads, Package Cache = /Users/jvi/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\n  .. validate [./comm.xml]\nValidation Infrastructure fail validating ./comm.xml: Unable to find type string for element contentString with path Communication.payload.content[x]\nException in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRException: Unable to find type string for element contentString with path Communication.payload.content[x]\n    at org.hl7.fhir.r5.elementmodel.Property.getChildProperties(Property.java:334)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parseChildren(XmlParser.java:258)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parseChildren(XmlParser.java:369)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parseChildren(XmlParser.java:369)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parse(XmlParser.java:199)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parse(XmlParser.java:183)\n    at org.hl7.fhir.r5.elementmodel.XmlParser.parse(XmlParser.java:153)\n    at org.hl7.fhir.validation.instance.InstanceValidator.validate(InstanceValidator.java:514)\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:1107)\n    at org.hl7.fhir.validation.ValidationEngine.validate(ValidationEngine.java:1014)\n    at org.hl7.fhir.validation.cli.services.ValidationService.validateSources(ValidationService.java:54)\n    at org.hl7.fhir.validation.Validator.main(Validator.java:202)\njvi@Jenss-MacBook-Pro-2 Downloads % java -jar org.hl7.fhir.validator.jar ./comm.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (16 days old)\nDetected Java version: 11.0.7 from /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: ./comm.json -ig https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\nDirectories: Current = /Users/jvi/Downloads, Package Cache = /Users/jvi/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n+  .. load IG from https://docs.ehealth.sundhed.dk/latest/ig/package.tgz\n  .. validate [./comm.json]\n*FAILURE* validating ./comm.json:  error:5 warn:1 info:1\n  Error @ Communication (line 58, col17) : Unrecognised property &#39;@reasonCode&#39;\n  Error @ Communication.payload[0] (line 69, col4) : Profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message, Element &#39;Communication.payload[0].content[x]&#39;: minimum required = 1, but only found 0\n  Error @ Communication.payload[0] (line 69, col4) : Profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message, Element &#39;Communication.payload[0].content[x][contentString]&#39;: minimum required = 1, but only found 0\n  Error @ Communication.payload[0] (line 69, col4) : Profile http://hl7.org/fhir/StructureDefinition/Communication, Element &#39;Communication.payload[0].content[x]&#39;: minimum required = 1, but only found 0\n  Error @ Communication.payload[0] (line 71, col4) : Unrecognised property &#39;@contentString&#39;\n  Information @ Communication.medium[0] (line 45, col4) : This element does not match any known slice defined in the profile http://ehealth.sundhed.dk/fhir/StructureDefinition/ehealth-message\n  Warning @ Communication.medium[0] (line 45, col4) : ValueSet http://hl7.org/fhir/ValueSet/v3-ParticipationMode not found by validator\n</code></pre></div>\n\n\n<p><a href=\"/user_uploads/10155/-znzCZmkJWeTUQFXcHCWysnX/comm.json\">comm.json</a> <a href=\"/user_uploads/10155/7eZwRPd8ONzqUgKFVZRcg02Z/comm.xml\">comm.xml</a></p>",
        "id": 201717807,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592915030
    },
    {
        "content": "<p>(<span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> I'm working on providing you with the test case we talked about last week)</p>",
        "id": 201717920,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592915106
    },
    {
        "content": "<p>1) It seems like there's a bug somewhere. The attached files should be equal to each other - its just different formats, but the XML version seems to be a problem for the validator<br>\n2) I don't understand what the problem is in the use of payload in the resource. The profile narrows down payload to be of type string content- that's it. Why the validator chokes is a mystery to me</p>",
        "id": 201718269,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592915338
    },
    {
        "content": "<p>Alright, I'll take a look into this today. I'm just working on another task first.</p>",
        "id": 201724675,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1592918750
    },
    {
        "content": "<p>And btw - its not directly related to the profile as far as I can tell</p>",
        "id": 201751530,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592930868
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  ..... hmmmm ... looks like your work when you prepared for r5: <a href=\"https://github.com/hapifhir/org.hl7.fhir.core/blame/344d778a87d446f36717c9f895a854eec762fbb6/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/elementmodel/Property.java#L334\">https://github.com/hapifhir/org.hl7.fhir.core/blame/344d778a87d446f36717c9f895a854eec762fbb6/org.hl7.fhir.r5/src/main/java/org/hl7/fhir/r5/elementmodel/Property.java#L334</a></p>",
        "id": 201837468,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1592999095
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"248736\">@Mark Iantorno</span> have you had the chance to have a look?</p>",
        "id": 201898981,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593030230
    },
    {
        "content": "<p>Sorry I have not. I will do this tomorrow. I am just finishing up another task.</p>",
        "id": 201900497,
        "sender_full_name": "Mark Iantorno",
        "timestamp": 1593031081
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> as far as I can see, the test case 'slicing-types-by-string' should cover it - but simply running the following:</p>\n<div class=\"codehilite\"><pre><span></span><code>java -jar org.hl7.fhir.validator.jar comm.json\nFHIR Validation tool Version 5.0.7-SNAPSHOT (Git# 6bc790d98b04). Built 2020-06-07T08:35:37.25+10:00 (17 days old)\nDetected Java version: 11.0.7 from /Library/Java/JavaVirtualMachines/adoptopenjdk-11.jdk/Contents/Home on x86_64 (64bit). 4096MB available\nArguments: comm.json\nDirectories: Current = /Users/jkv/Downloads, Package Cache = /Users/jkv/.fhir/packages\n  .. FHIR Version current, definitions from hl7.fhir.r5.core#current\n  .. connect to tx server @ http://tx.fhir.org\n    (vcurrent)\n  .. validate [comm.json]\n*FAILURE* validating comm.json:  error:4 warn:0 info:0\n  Error @ Communication.payload[0] (line 4, col5) : Profile http://hl7.org/fhir/StructureDefinition/Communication, Element &#39;Communication.payload[0].content[x]&#39;: minimum required = 1, but only found 0\n  Error @ Communication.payload[0] (line 6, col5) : Unrecognised property &#39;@contentString&#39;\n  Error @ Communication.payload[1].content.ofType(Attachment) (line 10, col4) : Attachments have data and/or url, or else must have either contentType and/oor language\n  Error @ Communication.payload[2].content.ofType(Attachment) (line 15, col4) : Attachments have data and/or url, or else must have either contentType and/oor language\n</code></pre></div>\n\n\n<ul>\n<li>with contents of the file 'comm.json' (copied from the test case):</li>\n</ul>\n<div class=\"codehilite\"><pre><span></span><code>{\n    &quot;resourceType&quot;: &quot;Communication&quot;,\n    &quot;payload&quot;: [\n      {\n        &quot;contentString&quot;: &quot;test&quot;\n      },\n      {\n        &quot;contentAttachment&quot;: {\n          &quot;title&quot;: &quot;some title&quot;\n        }\n      },\n      {\n        &quot;contentAttachment&quot;: {\n          &quot;title&quot;: &quot;some other title&quot;\n        }\n      }\n    ],\n    &quot;status&quot;: &quot;in-progress&quot;\n  }\n</code></pre></div>\n\n\n<p>gives an error on the payload: ' Error @ Communication.payload[0] (line 6, col5) : Unrecognised property '@contentString''</p>",
        "id": 201902011,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593031862
    },
    {
        "content": "<p>well, it is unrecognised content. That's because you didn't tell the validator what version it is, and it defaults to R5. contentString is not valid in R5 but is valid in R3. So -version 3.0 <span class=\"user-mention\" data-user-id=\"191427\">@Jens Villadsen</span></p>",
        "id": 201913427,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593039208
    },
    {
        "content": "<p><a href=\"user_uploads/10155/C7MvxiM0dLt0T6EYudLMb3xe/image.png\">image.png</a></p>\n<div class=\"message_inline_image\"><a href=\"user_uploads/10155/C7MvxiM0dLt0T6EYudLMb3xe/image.png\" title=\"image.png\"><img src=\"user_uploads/10155/C7MvxiM0dLt0T6EYudLMb3xe/image.png\"></a></div>",
        "id": 201936044,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593066197
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> that part makes sense - however that does not explain why it fails when I point it to an IG that is based on STU3. Shouldn't that be setting the FHIR version?</p>",
        "id": 201936217,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593066414
    },
    {
        "content": "<p>I mean, its errorprone if you can pass an IG that is bound to one version and then you explicitly can throw another version at the validator.</p>",
        "id": 201936304,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593066511
    },
    {
        "content": "<p>it is error prone and fixing it is on my wish list but it's a total redesign</p>",
        "id": 201937027,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593067515
    },
    {
        "content": "<p>because you need to reverse the order for getting the version?</p>",
        "id": 201937085,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593067573
    },
    {
        "content": "<p>right. the very first thing is setting the version. I'd have to totally redesign the entire validator and hapi context framework to load the version late</p>",
        "id": 201937106,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593067622
    },
    {
        "content": "<p>because fetching the IG (if specified) it not fetched up front?</p>",
        "id": 201937178,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593067747
    },
    {
        "content": "<p>you can specify multiple IGs and validate against multiple versions. There's lots of great things about the way it works now. You just can't default to the IG version if only one is specified</p>",
        "id": 201937193,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593067790
    },
    {
        "content": "<p>its a feature that you can specify multiple IG's that are allowed to differ in the FHIR version?</p>",
        "id": 201937251,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593067843
    },
    {
        "content": "<p>yes indeed it is though it's not a feature that's good for beginners.</p>",
        "id": 201937271,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593067888
    },
    {
        "content": "<p>right - I can certainly see the benefit of verifying whether a given resource is allowed across multiple IG's. However shouldn't one make suchs users aware with eg. an explicit 'versionVariance' parameter? It could provide users with a false hope of conformance or are there already  output that explains that a given resource is actually verified against multiple versions?</p>",
        "id": 201938242,
        "sender_full_name": "Jens Villadsen",
        "timestamp": 1593069125
    },
    {
        "content": "<p>I'm not defending the current user experience</p>",
        "id": 201939421,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1593070364
    }
]