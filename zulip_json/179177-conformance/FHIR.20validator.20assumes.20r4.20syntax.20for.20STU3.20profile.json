[
    {
        "content": "<p>I'm use the latest snapshot of the validator (Version 3.7.43-SNAPSHOT - Built 2019-06-04T14:04:54.0+10:00 - Git 9621a0f7cf06) to validate an STU3 example against a profile with the following ValueSetReference section:</p>\n<div class=\"codehilite\"><pre><span></span>&lt;valueSetReference&gt;\n    &lt;reference value=&quot;http://...&quot; /&gt;\n&lt;/valueSetReference&gt;\n</pre></div>\n\n\n<p>I'm using the option <code>-version 3.0.1</code> to make sure the validator uses STU3 (the profile also contains <code>&lt;fhirVersion value=\"3.0.1\" /&gt;</code>). However, it crashes with the following stack trace:</p>\n<div class=\"codehilite\"><pre><span></span>Exception in thread &quot;main&quot; org.hl7.fhir.exceptions.FHIRFormatError: Unknown Content valueSetReference @  START_TAG seen ...n value=&quot;AdemhalingScoreCodelijst&quot; /&gt;\\r\\n        &lt;valueSetReference&gt;... @281:28\n        at org.hl7.fhir.r5.formats.XmlParserBase.unknownContent(XmlParserBase.java:300)\n        at org.hl7.fhir.r5.formats.XmlParser.parseElementDefinitionElementDefinitionBindingComponent(XmlParser.java:1993)\n        at org.hl7.fhir.r5.formats.XmlParser.parseElementDefinitionContent(XmlParser.java:1806)\n        at org.hl7.fhir.r5.formats.XmlParser.parseElementDefinition(XmlParser.java:1731)\n        at org.hl7.fhir.r5.formats.XmlParser.parseStructureDefinitionStructureDefinitionDifferentialComponentContent(XmlParser.java:20080)\n        at org.hl7.fhir.r5.formats.XmlParser.parseStructureDefinitionStructureDefinitionDifferentialComponent(XmlParser.java:20069)\n        at org.hl7.fhir.r5.formats.XmlParser.parseStructureDefinitionContent(XmlParser.java:19980)\n        at org.hl7.fhir.r5.formats.XmlParser.parseStructureDefinition(XmlParser.java:19917)\n        at org.hl7.fhir.r5.formats.XmlParser.parseResource(XmlParser.java:23961)\n        at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:126)\n        at org.hl7.fhir.r5.formats.XmlParserBase.parse(XmlParserBase.java:110)\n        at org.hl7.fhir.r5.formats.ParserBase.parse(ParserBase.java:79)\n        at org.hl7.fhir.r5.validation.ValidationEngine.snapshot(ValidationEngine.java:1026)\n        at org.hl7.fhir.r5.validation.Validator.main(Validator.java:417)\n</pre></div>\n\n\n<p>I looks like the validator doesn't properly switch to STU3 syntax. If I change the ValueSet reference to the r4 syntax:<br>\n<code>&lt;ValueSet value=\"http://...\" /&gt;</code><br>\nthe validator does accept the input.</p>",
        "id": 167272236,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1559638817
    },
    {
        "content": "<p>Whatâ€™s the printed output prior to the error message?</p>",
        "id": 167288577,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559652387
    },
    {
        "content": "<p>Not too much:</p>\n<div class=\"codehilite\"><pre><span></span>$ java -jar ../Downloads/org.hl7.fhir.validator.jar -version 3.0.1 -snapshot Profiles\\ -\\ ZIB\\ 2017/zib-ApgarScore.xml -tx &#39;n/a&#39;\nFHIR Validation tool Version 3.7.43-SNAPSHOT - Built 2019-06-04T14:04:54.0+10:00 - Git 9621a0f7cf06\nArguments: -version 3.0.1 -snapshot &quot;Profiles - ZIB 2017/zib-ApgarScore.xml&quot; -tx n/a\n  .. connect to tx server @ null\n  .. definitions from hl7.fhir.core#3.0.1\n    (v3.0.1)\n</pre></div>",
        "id": 167289425,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1559652874
    },
    {
        "content": "<p>can you send me your profiles directory so I can test? (can do so privately so it won't be public)</p>",
        "id": 167292913,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1559655055
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/sj0Lws4UGSUx8mme8dJCvG88/zib-ApgarScore-example.xml\" target=\"_blank\" title=\"zib-ApgarScore-example.xml\">zib-ApgarScore-example.xml</a> <a href=\"/user_uploads/10155/myZeSzWw-DEU2GXtmPwDjgEu/zib-ApgarScore.xml\" target=\"_blank\" title=\"zib-ApgarScore.xml\">zib-ApgarScore.xml</a></p>",
        "id": 167363474,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1559718662
    },
    {
        "content": "<p>This is the profile and the example (no secrets here). There error occurs in the Observation.component.valueCodeableConcept slices and can be fixed by changing to the r4 syntax. I also tried to make a synthetic example, but I can't reproduce the error there.</p>",
        "id": 167363661,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1559718933
    },
    {
        "content": "<p>so I don't get any issue here with the latest validator? (sorry for taking so long...)</p>",
        "id": 167797708,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560201723
    },
    {
        "content": "<p>oh no. oops. I need <a href=\"http://fhir.nl/fhir/StructureDefinition/nl-core-observation\" target=\"_blank\" title=\"http://fhir.nl/fhir/StructureDefinition/nl-core-observation\">http://fhir.nl/fhir/StructureDefinition/nl-core-observation</a></p>",
        "id": 167797759,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560201751
    },
    {
        "content": "<p><a href=\"/user_uploads/10155/njmZskCWjcbikUeJFlD4HBBQ/nl-core-observation.xml\" target=\"_blank\" title=\"nl-core-observation.xml\">nl-core-observation.xml</a> </p>\n<p>there you go</p>",
        "id": 167838374,
        "sender_full_name": "Sebastiaan Raap",
        "timestamp": 1560249900
    },
    {
        "content": "<p>ok so I put them in my test directory, and then ran this command line:</p>",
        "id": 167840387,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251804
    },
    {
        "content": "<p><code>-version 3.0 -ig C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore.xml -ig C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-core-observation.xml C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore-example.xml</code></p>",
        "id": 167840412,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251826
    },
    {
        "content": "<p>and then I got this output:</p>",
        "id": 167840419,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251835
    },
    {
        "content": "<p>```FHIR Validation tool Version 3.8.3-SNAPSHOT - Built 2019-06-11T07:46:57.733+10:00 - Git 9a344b251c77<br>\nArguments: -version 3.0 -ig C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore.xml -ig C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-core-observation.xml C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore-example.xml<br>\n  .. connect to tx server @ <a href=\"http://tx.fhir.org\" target=\"_blank\" title=\"http://tx.fhir.org\">http://tx.fhir.org</a><br>\n  .. definitions from hl7.fhir.core#3.0.1<br>\n    (v3.0.1)<br>\n+  .. load IG from C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore.xml<br>\n ..file: C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore.xml+  .. load IG from C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-core-observation.xml<br>\n ..file: C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-core-observation.xml  .. validate [C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore-example.xml]<br>\nTerminology server: Check for supported code systems for <a href=\"http://loinc.org\" target=\"_blank\" title=\"http://loinc.org\">http://loinc.org</a><br>\nSuccess...validating C:\\work\\org.hl7.fhir\\org.hl7.fhir.core\\org.hl7.fhir.validation\\src\\test\\resources\\validation-examples\\zib-ApgarScore-example.xml:  error:0 warn:15 info:0<br>\n  Warning @ Observation.component[1].code.coding (line 28, col21) : The display \"AdemhalingsScore\" is not a valid display for the code {http://loinc.org}32410-3 - should be one of [\"1 minute Apgar Respiratory effort\",\"1M Apgar Resp effort\"]<br>\n  Warning @ Observation.component[1].valueCodeableConcept (line 34, col31) : ValueSet <a href=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.1--20171231000000\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.1--20171231000000\">http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.1--20171231000000</a> not found<br>\n  Warning @ Observation.component[1].valueCodeableConcept.coding (line 35, col21) : The display \"Flink huilen en goed doorademen\" is not a valid display for the code {http://loinc.org}LA6727-7 - should be one of [\"Good, strong cry; normal rate and effort of breathing\"]<br>\n  Warning @ Observation.component[2].code.coding (line 46, col21) : The display \"Huidskleurscore\" is not a valid display for the code {http://loinc.org}32406-1 - should be one of [\"1 minute Apgar Color\",\"1M Apgar Color\"]<br>\n  Warning @ Observation.component[2].valueCodeableConcept (line 52, col31) : ValueSet <a href=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.4--20171231000000\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.4--20171231000000\">http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.4--20171231000000</a> not found<br>\n  Warning @ Observation.component[2].valueCodeableConcept.coding (line 53, col21) : The display \"Roze lijfje, maar blauwachtige armen en benen\" is not a valid display for the code {http://loinc.org}LA6723-6 - should be one of [\"Good color in body with bluish hands or feet\"]<br>\n  Warning @ Observation.component[3].code.coding (line 64, col21) : The display \"HartslagScore\" is not a valid display for the code {http://loinc.org}32407-9 - should be one of [\"1 minute Apgar Heart rate\",\"1M Apgar Heart rate\"]<br>\n  Warning @ Observation.component[3].valueCodeableConcept (line 70, col31) : ValueSet <a href=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.2--20171231000000\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.2--20171231000000\">http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.2--20171231000000</a> not found<br>\n  Warning @ Observation.component[3].valueCodeableConcept.coding (line 71, col21) : The display \"Een hartslag van minder dan 100 slagen per minuut\" is not a valid display for the code {http://loinc.org}LA6717-8 - should be one of [\"Fewer than 100 beats per minute\"]<br>\n  Warning @ Observation.component[4].code.coding (line 82, col21) : The display \"ReflexenScore\" is not a valid display for the code {http://loinc.org}32409-5 - should be one of [\"1 minute Apgar Reflex irritability\",\"1M Apgar Reflex irritability\"]<br>\n  Warning @ Observation.component[4].valueCodeableConcept (line 88, col31) : ValueSet <a href=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.5--20171231000000\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.5--20171231000000\">http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.5--20171231000000</a> not found<br>\n  Warning @ Observation.component[4].valueCodeableConcept.coding (line 89, col21) : The display \"Reageert door te huilen, te hoesten of te niezen\" is not a valid display for the code {http://loinc.org}LA6721-0 - should be one of [\"Grimace and pulling away, cough, or sneeze during suctioning\"]<br>\n  Warning @ Observation.component[5].code.coding (line 100, col21) : The display \"SpierspanningScore\" is not a valid display for the code {http://loinc.org}32408-7 - should be one of [\"1 minute Apgar Muscle tone\",\"1M Apgar Muscle tone\"]<br>\n  Warning @ Observation.component[5].valueCodeableConcept (line 106, col31) : ValueSet <a href=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.3--20171231000000\" target=\"_blank\" title=\"http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.3--20171231000000\">http://decor.nictiz.nl/fhir/ValueSet/2.16.840.1.113883.2.4.3.11.60.40.2.12.16.3--20171231000000</a> not found<br>\n  Warning @ Observation.component[5].valueCodeableConcept.coding (line 107, col21) : The display \"Beweegt armpjes en beentjes goed\" is not a valid display for the code {http://loinc.org}LA6715-2 - should be one of [\"Active motion\"]</p>\n<div class=\"codehilite\"><pre><span></span>\n</pre></div>",
        "id": 167840432,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251856
    },
    {
        "content": "<p>is that different from what you would expect?</p>",
        "id": 167840463,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251883
    },
    {
        "content": "<p>btw.... that does make me think that we need to invest some in NL loinc support. Is it part of the standard LOINC distribution? (<span class=\"user-mention\" data-user-id=\"191375\">@Alexander Henket</span>)</p>",
        "id": 167840563,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560251989
    },
    {
        "content": "<p>LOINC calls them \"<a href=\"https://loinc.org/file-access/download-id/8989/\" target=\"_blank\" title=\"https://loinc.org/file-access/download-id/8989/\">linguistic variants</a>\" [sic] but yes, you can find that in the LOINC downloads</p>",
        "id": 167840916,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560252311
    },
    {
        "content": "<p>We discussed the notion of a warning for display mismatches with <span class=\"user-mention\" data-user-id=\"191370\">@Richard Ettema</span> for Touchstone and lowered that to INFO level. The idea that a ValueSet will ever be complete in its listing of valid display names seems false ioho. We run a LOINC and SNOMED CT NRC that produces new translations all the time. Any ValueSet is always behind on the number of allowable displays.</p>",
        "id": 167841095,
        "sender_full_name": "Alexander Henket",
        "timestamp": 1560252539
    },
    {
        "content": "<blockquote>\n<p>is that different from what you would expect?</p>\n</blockquote>\n<p>No, this is what I would expect. I just tried it out with the latest snapshot and got the same result, so it seems the error has been fixed in the meantime. Thanks!</p>",
        "id": 167841119,
        "sender_full_name": "Pieter Edelman",
        "timestamp": 1560252583
    },
    {
        "content": "<p>ok thanks</p>",
        "id": 167857469,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1560264694
    }
]