[
    {
        "content": "<p>I am seeing a curious validation error with the latest Java JAR validator when using slicing with an Exists-discriminator in a derived profile: </p>\n<p>Here is what I did (working in Forge):<br>\n1. Create a new derived profile from the following profile (German base profile for Patient): <a href=\"http://fhir.de/StructureDefinition/patient-de-basis/0.2\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/patient-de-basis/0.2\">http://fhir.de/StructureDefinition/patient-de-basis/0.2</a> . This Profile does not itself slice <code>name</code> field, but it does specify a custom profile for it (viz. <a href=\"http://fhir.de/StructureDefinition/humanname-de-basis/0.2\" target=\"_blank\" title=\"http://fhir.de/StructureDefinition/humanname-de-basis/0.2\">http://fhir.de/StructureDefinition/humanname-de-basis/0.2</a>)<br>\n2. Slice the <code>name</code>field, with a discriminator of type \"Exists\" on <code>period.end</code><br>\n3. Add a slice and in this slice, set the cardinality of <code>period.end</code>to 0..0<br>\n4. Validate using the latest Java JAR validator against a <code>Patient</code> example that contains the <code>name</code>field with only <code>name.given</code> filled in (at least the <code>name</code>field has to be there)</p>\n<p>This gives the following error (despite step 3):</p>\n<div class=\"codehilite\"><pre><span></span>*FAILURE* validating examples\\patient-example-minimal.xml:  error:1 warn:0 info:0\n  Error @ Patient.name (line 6, col11) : Discriminator (period.end) is based on element existence, but slice Patient.name:sliceName neither sets min&gt;=1 or max=0\n</pre></div>\n\n\n<p>Curiously, if I do exactly the same, but base my profile on the standard STU3 Patient resource, it works. Doe slicing in derived field somehow work differently?</p>",
        "id": 154025298,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1544697457
    },
    {
        "content": "<p>I sort of understand the error - does it make sense to have a discriminator on an element that has set it's cardinality to 0..0.  It seems the error should say: \"but slice ........ EITHER sets min&gt;=1 or max=0\" - so maybe I just don't understand what's going on.</p>\n<p>That said, the german profile on humanname does not make any changes to the period element, so there should not be changes in behaviour. <span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span> <span class=\"user-mention\" data-user-id=\"191336\">@Michel Rutten</span> ?</p>",
        "id": 154026056,
        "sender_full_name": "Ewout Kramer",
        "timestamp": 1545128022
    },
    {
        "content": "<p>Forge helps users to design valid StructureDefinitions, but ultimately verification is left up to the validator. I don't fully understand the warning message from the Java validator...</p>",
        "id": 154026058,
        "sender_full_name": "Michel Rutten",
        "timestamp": 1545128951
    },
    {
        "content": "<p>In this case, I am not restricting the cardinality of <code>period.end</code>in general, only in a particular slice where I removed it (0..0). This was based on my understanding  that to use the Exists-discriminator, one needs to fix the \"existence status\" of the corresponding element to either \"never\" (cardinality = 0) or \"always\" (cardinality &gt; 1) in slices. But if I  read the error message right, it seems to tell me that I failed to do exactly that, which is what confused me.</p>",
        "id": 154026069,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1545132923
    },
    {
        "content": "<p>That's constraining to 0..0 could be to validate that this slice isn't to be used.</p>",
        "id": 154026070,
        "sender_full_name": "Brian Postlethwaite",
        "timestamp": 1545132935
    },
    {
        "content": "<p>(BTW, the usecase background is that I want to define a slice that picks out a name entry for which(among other properties)  no end-date has been specified so that this name is guaranteed to still be valid)</p>",
        "id": 154026074,
        "sender_full_name": "Morten Ernebjerg",
        "timestamp": 1545133236
    },
    {
        "content": "<p>If you're using \"exists\", you expect one slice to be 1..x and one to be 0..0.</p>",
        "id": 154026099,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1545145197
    }
]