[
    {
        "content": "<p>So I'm trying to validate an example JSON against a Profile but I just can't get it to work. Starting to suspect it could be something with the Profile. All I'm doing is this:<br>\njava -jar validator_cli.jar rx.json -profile <a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a></p>\n<p>Where the URL above gives me a JSON with a StructureDefinition and rx.json contains a file with:</p>\n<div class=\"codehilite\"><pre><span></span><code>    &quot;versionId&quot;: &quot;1&quot;,\n    &quot;profile&quot;: [\n      &quot;http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest&quot;\n    ]\n  }\n</code></pre></div>\n<p>And it seems like NLLMedicationRequest defined in the StructureDefinition above. The error is:</p>\n<p>Validate rx.jsonException in thread \"main\" java.lang.Error: Unable to resolve profile <a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a></p>\n<p>Have I misunderstood something?</p>",
        "id": 217856874,
        "sender_full_name": "Håkan MacLean",
        "timestamp": 1606293642
    },
    {
        "content": "<p>where is your profile? with the -profile parameter you specify against which profile you want to validate (canonical url)</p>",
        "id": 217858126,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606294551
    },
    {
        "content": "<p>with the -ig parameter you can specify the profiles, however the link you listed above does not return currently the resource</p>",
        "id": 217858253,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606294630
    },
    {
        "content": "<p>see docu also here for the parameters: <a href=\"https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator\">https://confluence.hl7.org/display/FHIR/Using+the+FHIR+Validator</a></p>",
        "id": 217858277,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606294653
    },
    {
        "content": "<blockquote>\n<p>the link you listed above does not return currently the resource</p>\n</blockquote>\n<p>That's the key</p>",
        "id": 217858386,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606294717
    },
    {
        "content": "<p>if it actually comes from somewhere else, you need to tell the publisher where to find it using an -ig parameter</p>",
        "id": 217858417,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606294750
    },
    {
        "content": "<p>I apologise for my previous confusing post. I tried having the url in both -ig and -profile and pasted the wrong one. So I have also tried<br>\njava -jar validator_cli.jar rx.json -profile <a href=\"http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest\">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a> -ig <a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a></p>\n<p>With the same error about not being to resolve the profile. When I curl <a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a> I get back a StructureDefinition, containing a definition of <a href=\"http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest\">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a>, which indicates to me it should work?</p>\n<p>I just now tried downloading the StructureDefinition to a file and use it locally, like the documentation suggests:<br>\njava -jar validator_cli.jar rx.json -profile <a href=\"http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest\">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a> -ig ./nllmedicationrequest.json</p>\n<p>And now I seem to be getting closer, but I receive the following error:<br>\nError @ MedicationRequest (line 1, col2) : StructureDefinition has no snapshot - validation is against the snapshot, so it must be provided</p>\n<p>Is there something fundamental I have misunderstood? <br>\nI'm just trying to test against the Swedish Government MedicationRequestProfile. Its canonical URL is <a href=\"http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest\">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a>, which if I've understood things correct means there is no actual information to download at this url, it's just a name. The content of the actual profile is in a StructureDefinition, that is available here: <a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a>. I thought this would be like the most basic thing in the world to test when learning FHIR, but there must be something I've misunderstood :)</p>",
        "id": 217867006,
        "sender_full_name": "Håkan MacLean",
        "timestamp": 1606299994
    },
    {
        "content": "<ol>\n<li>the address you provide (<a href=\"https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075\">https://fhir.simplifier.net/SwedishNationalMedicationList/StructureDefinition/dcae1550-a48a-4d44-a431-73c47c9dd075</a>.) does not allow myself to download the structuredefinition</li>\n</ol>",
        "id": 217869268,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606301613
    },
    {
        "content": "<ol start=\"2\">\n<li>you need a StructureDefintion with a snapshot, you can download a version from that with simplifier with Download, Download snapshots as ...</li>\n</ol>",
        "id": 217869534,
        "sender_full_name": "Oliver Egger",
        "timestamp": 1606301769
    },
    {
        "content": "<blockquote>\n<p>StructureDefinition has no snapshot - validation is against the snapshot, so it must be provided</p>\n</blockquote>\n<p>weird.... that definitely should not happen. It's absolutely an unexpected bug. I'll investigate tomorrow.</p>",
        "id": 217869555,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606301785
    },
    {
        "content": "<p>the validator generates it's own snapshot.</p>",
        "id": 217869580,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606301811
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191478\">Oliver Egger</span> <a href=\"#narrow/stream/179177-conformance/topic/Using.20the.20FHIR.20Validator.20against.20a.20Profile/near/217869534\">said</a>:</p>\n<blockquote>\n<ol start=\"2\">\n<li>you need a StructureDefintion with a snapshot, you can download a version from that with simplifier with Download, Download snapshots as ...</li>\n</ol>\n</blockquote>\n<p>So I tried downloading the json with a snapshot (thanks for the tip!). Then when I run:</p>\n<p>java -jar validator_cli.jar rx_small.json -profile <a href=\"http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest\">http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest</a> -ig ./NLLMedicationRequest.json</p>\n<p>I get an exception:<br>\nValidating<br>\n  Profiles: [http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest]<br>\n  Validate rx_small.jsonException in thread \"main\" java.lang.Error: <strong>Not done yet</strong><br>\n    at org.hl7.fhir.validation.cli.services.StandAloneValidatorFetcher.fetch(StandAloneValidatorFetcher.java:41)<br>\n    at org.hl7.fhir.validation.ValidationEngine.fetch(ValidationEngine.java:1864)<br>\n    at org.hl7.fhir.validation.instance.InstanceValidator.checkReference(InstanceValidator.java:2458)</p>\n<p>This is my super simple MedicationRequest:</p>\n<div class=\"codehilite\"><pre><span></span><code>{\n  &quot;resourceType&quot;: &quot;MedicationRequest&quot;,\n  &quot;meta&quot;: {\n    &quot;versionId&quot;: &quot;1&quot;,\n    &quot;profile&quot;: [\n      &quot;http://electronichealth.se/fhir/StructureDefinition/NLLMedicationRequest&quot;\n    ]\n  },\n  &quot;status&quot;: &quot;active&quot;,\n  &quot;intent&quot;: &quot;plan&quot;,\n  &quot;subject&quot;: {\n    &quot;reference&quot;: &quot;Patient/21e495cf-aab6-482e-b630-cdd87b437cab&quot;\n  },\n  &quot;authoredOn&quot;: &quot;2020-11-11T10:58:14.768528&quot;,\n  &quot;requester&quot;: {\n    &quot;reference&quot;: &quot;#1505724e-2d13-4790-ab25-e9ae2fa8d272&quot;\n  }\n</code></pre></div>",
        "id": 217870876,
        "sender_full_name": "Håkan MacLean",
        "timestamp": 1606302523
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"364590\">@Håkan MacLean</span> Not one of your references to the profile you're working with resolve for me. I consistently get \"this site can't be reached\" for the <a href=\"http://electronichealth.se\">electronichealth.se</a> and <a href=\"https://fhir.simplifier.net\">https://fhir.simplifier.net</a> references, though <a href=\"http://simplifier.net\">simplifier.net</a> etc do resolve for me</p>",
        "id": 217933776,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606335315
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span>  The <a href=\"http://electronichealth.se\">electronichealth.se</a> urls are the Canonical urls, so they are not expected to be resolved, right? The link to <a href=\"http://simplifier.net\">simplifier.net</a> is the one I got from here: <a href=\"https://simplifier.net/swedishnationalmedicationlist/nllmedicationrequest\">https://simplifier.net/swedishnationalmedicationlist/nllmedicationrequest</a> and then clicking on the API-link. It doesn't resolve in my browser, but works when I use curl.</p>\n<p>But if I reverse the question: How should I go about validating a simple FHIR MedicationRequest.json file that I have created  (shown above) against the profile described here: <a href=\"https://simplifier.net/swedishnationalmedicationlist\">https://simplifier.net/swedishnationalmedicationlist</a>? I have tried both pointing the validator to the url mentioned above and to downloading the resources in different ways locally, but it always fails. Is there perhaps something wrong with the profile? N.B. I haven't created the profile, it's the official profile from the Swedish government.</p>",
        "id": 217946120,
        "sender_full_name": "Håkan MacLean",
        "timestamp": 1606342818
    },
    {
        "content": "<p>If you want to point to a profile by URL with the validator, it must resolve or must be defined in an IG .tgz package you refer to with -ig.  You can't reference an ImplementationGuide resource, you must refer to an ig package (and that package must contain the profile or must refer to a package that exists in the package registry that has the profile)</p>",
        "id": 217949987,
        "sender_full_name": "Lloyd McKenzie",
        "timestamp": 1606346074
    },
    {
        "content": "<p>If it helps. For the English Medication profiles we have this page <a href=\"https://simplifier.net/guide/NHSDigitalSpine/TestingandValidation\">https://simplifier.net/guide/NHSDigitalSpine/TestingandValidation</a> <br>\nWhich has a number of examples for validation resources using a simplifier IG. <br>\nThe <strong>Digital Medicine IG</strong> section refers to England NHS Meds.</p>",
        "id": 217972843,
        "sender_full_name": "Kevin Mayfield",
        "timestamp": 1606376937
    },
    {
        "content": "<p>ok I had time to look at this. </p>\n<p><code>Not done yet</code></p>\n<p>Is caused by a bug in the validator. No use having 100s of tests if your deployed version has a bug not in the tests. Fix will be released some time today</p>",
        "id": 218035330,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606421619
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191347\">@Mirjam Baltus</span> more generally, this is something that is pretty obscure to <a href=\"http://simplifier.net\">simplifier.net</a> users - the canonical doesn't resolve. The validator will try to resolve it (and do so much more coherently from next release) but even if it can resolved, it'll be slower and more trouble prone than asking the validator to get the package. So I think that simplifier should document this somewhere where users will find it</p>",
        "id": 218041394,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606428208
    },
    {
        "content": "<p>btw, <span class=\"user-mention\" data-user-id=\"364590\">@Håkan MacLean</span> the reason it failed with not done yet is actually a bug related to the contained reference, nothing to do with the profile</p>",
        "id": 218041578,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606428437
    },
    {
        "content": "<p>fyi <a href=\"https://github.com/FHIR/fhir-test-cases/commit/972f06b6dd4c97778b501031bdb2585ebab56313\">https://github.com/FHIR/fhir-test-cases/commit/972f06b6dd4c97778b501031bdb2585ebab56313</a> if interested</p>",
        "id": 218041674,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606428569
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179177-conformance/topic/Using.20the.20FHIR.20Validator.20against.20a.20Profile/near/218041394\">said</a>:</p>\n<blockquote>\n<p><span class=\"user-mention silent\" data-user-id=\"191347\">Mirjam Baltus</span> more generally, this is something that is pretty obscure to <a href=\"http://simplifier.net\">simplifier.net</a> users - the canonical doesn't resolve. The validator will try to resolve it (and do so much more coherently from next release) but even if it can resolved, it'll be slower and more trouble prone than asking the validator to get the package. So I think that simplifier should document this somewhere where users will find it</p>\n</blockquote>\n<p>Thanks for the suggestion. The suggestion is to better document how a <a href=\"http://Simplifier.net\">Simplifier.net</a> user can use the Java validator to validate against their <a href=\"http://Simplifier.net\">Simplifier.net</a> project, right? (Indeed, publishing a FHIR package would be my answer. Unless the Java validator also has the option to be pointed to a FHIR server to get the resources from)</p>\n<p><span class=\"user-mention\" data-user-id=\"364590\">@Håkan MacLean</span> I'm sure you've already seen <a href=\"http://simplifier.net/validate\">simplifier.net/validate</a> and the validation options when you'd upload that example JSON to your project, right?</p>",
        "id": 218269777,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1606732258
    },
    {
        "content": "<blockquote>\n<p>Unless the Java validator also has the option to be pointed to a FHIR server to get the resources from)</p>\n</blockquote>\n<p>well, it does,  but that's not a terribly practical thing right now, since it downloads profiles at their URL.. doesn't work for a the whole package. Unless we do something about that</p>",
        "id": 218269936,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606732366
    },
    {
        "content": "<blockquote>\n<p>Indeed, publishing a FHIR package would be my answer.</p>\n</blockquote>\n<p>So, for a random user, is it published? What's the package name? is that visible from the web page for the profile?</p>",
        "id": 218270121,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606732454
    },
    {
        "content": "<p><span class=\"user-mention\" data-user-id=\"191316\">@Grahame Grieve</span></p>\n<ul>\n<li>A <a href=\"http://Simplifier.net\">Simplifier.net</a> FHIR development project (like <a href=\"https://simplifier.net/ACMEBaseProfilesR4\">https://simplifier.net/ACMEBaseProfilesR4</a>) is not exposed as a dev/current package right now to the outside world. But a user can make a package from the project at any time (eg via <a href=\"https://simplifier.net/ACMEBaseProfilesR4/~packages\">https://simplifier.net/ACMEBaseProfilesR4/~packages</a>, can even be prerelease packages like <code>1.0.0-releasecandidate1</code>) which will then directly be available via the package API, so also to the Java validator/IG Publisher.</li>\n<li>At <a href=\"https://simplifier.net/validate\">https://simplifier.net/validate</a> you can validate against any package (eg <a href=\"https://simplifier.net/validate?fhirVersion=R4&amp;scope=acme.base.r4@4.0.2\">https://simplifier.net/validate?fhirVersion=R4&amp;scope=acme.base.r4@4.0.2</a>), but also against the live resources in the development project (via <a href=\"https://simplifier.net/validate?fhirVersion=R4&amp;scope=ACMEBaseProfilesR4@current\">https://simplifier.net/validate?fhirVersion=R4&amp;scope=ACMEBaseProfilesR4@current</a> for that project). Resources within a project validate against the resources in that project and the package dependencies of the project.</li>\n<li>Every development project has a FHIR server exposed that contains all the resources of the project (<a href=\"https://fhir.simplifier.net/ACMEBaseProfilesR4\">https://fhir.simplifier.net/ACMEBaseProfilesR4</a> for that project).</li>\n</ul>",
        "id": 218389437,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1606809540
    },
    {
        "content": "<blockquote>\n<p>But a user can make a package from the project at any time</p>\n</blockquote>\n<p>I presume that is a simplifier admin kind of user, not any person in the world?</p>",
        "id": 218401617,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606817433
    },
    {
        "content": "<p>if an authorised user has created a package, will any other person in the world know that this has happened?</p>",
        "id": 218401720,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606817517
    },
    {
        "content": "<p><span class=\"user-mention silent\" data-user-id=\"191316\">Grahame Grieve</span> <a href=\"#narrow/stream/179177-conformance/topic/Using.20the.20FHIR.20Validator.20against.20a.20Profile/near/218401617\">said</a>:</p>\n<blockquote>\n<p>I presume that is a simplifier admin kind of user, not any person in the world?</p>\n</blockquote>\n<p>Anyone person in the world can create a free <a href=\"http://Simplifier.net\">Simplifier.net</a> account and one public development project.<br>\nAny project member with admin rights on the project can create a new (version of a) package from it.</p>\n<blockquote>\n<p>Grahame Grieve: if an authorised user has created a package, will any other person in the world know that this has happened?</p>\n</blockquote>\n<p>There is no notification system for newly created packages, but users can then find the new package (version) on the package page on <a href=\"http://Simplifier.net\">Simplifier.net</a>, <a href=\"http://registry.fhir.org\">registry.fhir.org</a> or via the package API.</p>",
        "id": 218410129,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1606822808
    },
    {
        "content": "<p>so I think it would be appropriate for a random user to see on the page what package a profile is in, and whether it's been released. Otherwise they are in a world of confusion</p>",
        "id": 218410197,
        "sender_full_name": "Grahame Grieve",
        "timestamp": 1606822864
    },
    {
        "content": "<p>Ah, like that: Show on the page for a resource in a project (like <a href=\"https://simplifier.net/acmebaseprofilesr4/acmebasepatient-duplicate-2\">this ACME patient</a>) that it has been published in a package (link to <a href=\"https://simplifier.net/packages/acme.base.r4/4.0.2\">this package</a>). Yes, that's something we will start to do!</p>\n<p>We're still working through the major shift of projects being the entry point for consumers to packages being that. Our path on that will roughly be:</p>\n<ul>\n<li>Improve <a href=\"http://Simplifier.net\">Simplifier.net</a> search to also search in packages and likely in packages by default</li>\n<li>Make package pages prettier (all the smarts currently projects already have, like easier search in its resources)</li>\n<li>Steer consumers from projects to packages, where available</li>\n</ul>",
        "id": 218410736,
        "sender_full_name": "Ward Weistra",
        "timestamp": 1606823240
    }
]